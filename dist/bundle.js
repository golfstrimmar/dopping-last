/*! For license information please see bundle.js.LICENSE.txt */
!(function () {
  var e = {
      "./node_modules/plyr/dist/plyr.min.js": function (e, t, n) {
        var i = ["premium", "referrerPolicy"];
        function a(e) {
          return (
            (function (e) {
              if (Array.isArray(e)) return p(e);
            })(e) ||
            (function (e) {
              if (
                ("undefined" != typeof Symbol && null != e[Symbol.iterator]) ||
                null != e["@@iterator"]
              )
                return Array.from(e);
            })(e) ||
            h(e) ||
            (function () {
              throw new TypeError(
                "Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."
              );
            })()
          );
        }
        function r(e, t) {
          if (!(e instanceof t))
            throw new TypeError("Cannot call a class as a function");
        }
        function s(e, t) {
          for (var n = 0; n < t.length; n++) {
            var i = t[n];
            (i.enumerable = i.enumerable || !1),
              (i.configurable = !0),
              "value" in i && (i.writable = !0),
              Object.defineProperty(e, i.key, i);
          }
        }
        function o(e, t, n) {
          return (
            t && s(e.prototype, t),
            n && s(e, n),
            Object.defineProperty(e, "prototype", { writable: !1 }),
            e
          );
        }
        function l(e, t) {
          var n = Object.keys(e);
          if (Object.getOwnPropertySymbols) {
            var i = Object.getOwnPropertySymbols(e);
            t &&
              (i = i.filter(function (t) {
                return Object.getOwnPropertyDescriptor(e, t).enumerable;
              })),
              n.push.apply(n, i);
          }
          return n;
        }
        function c(e) {
          for (var t = 1; t < arguments.length; t++) {
            var n = null != arguments[t] ? arguments[t] : {};
            t % 2
              ? l(Object(n), !0).forEach(function (t) {
                  u(e, t, n[t]);
                })
              : Object.getOwnPropertyDescriptors
              ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(n))
              : l(Object(n)).forEach(function (t) {
                  Object.defineProperty(
                    e,
                    t,
                    Object.getOwnPropertyDescriptor(n, t)
                  );
                });
          }
          return e;
        }
        function u(e, t, n) {
          return (
            t in e
              ? Object.defineProperty(e, t, {
                  value: n,
                  enumerable: !0,
                  configurable: !0,
                  writable: !0,
                })
              : (e[t] = n),
            e
          );
        }
        function d(e, t) {
          return (
            (function (e) {
              if (Array.isArray(e)) return e;
            })(e) ||
            (function (e, t) {
              var n =
                null == e
                  ? null
                  : ("undefined" != typeof Symbol && e[Symbol.iterator]) ||
                    e["@@iterator"];
              if (null != n) {
                var i,
                  a,
                  r = [],
                  s = !0,
                  o = !1;
                try {
                  for (
                    n = n.call(e);
                    !(s = (i = n.next()).done) &&
                    (r.push(i.value), !t || r.length !== t);
                    s = !0
                  );
                } catch (e) {
                  (o = !0), (a = e);
                } finally {
                  try {
                    s || null == n.return || n.return();
                  } finally {
                    if (o) throw a;
                  }
                }
                return r;
              }
            })(e, t) ||
            h(e, t) ||
            (function () {
              throw new TypeError(
                "Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."
              );
            })()
          );
        }
        function h(e, t) {
          if (e) {
            if ("string" == typeof e) return p(e, t);
            var n = Object.prototype.toString.call(e).slice(8, -1);
            return (
              "Object" === n && e.constructor && (n = e.constructor.name),
              "Map" === n || "Set" === n
                ? Array.from(e)
                : "Arguments" === n ||
                  /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)
                ? p(e, t)
                : void 0
            );
          }
        }
        function p(e, t) {
          (null == t || t > e.length) && (t = e.length);
          for (var n = 0, i = new Array(t); n < t; n++) i[n] = e[n];
          return i;
        }
        "object" == typeof navigator &&
          (e.exports = (function () {
            "use strict";
            function e(e, t, n) {
              return (
                t in e
                  ? Object.defineProperty(e, t, {
                      value: n,
                      enumerable: !0,
                      configurable: !0,
                      writable: !0,
                    })
                  : (e[t] = n),
                e
              );
            }
            function t(e, t) {
              for (var n = 0; n < t.length; n++) {
                var i = t[n];
                (i.enumerable = i.enumerable || !1),
                  (i.configurable = !0),
                  "value" in i && (i.writable = !0),
                  Object.defineProperty(e, i.key, i);
              }
            }
            function s(e, t, n) {
              return (
                t in e
                  ? Object.defineProperty(e, t, {
                      value: n,
                      enumerable: !0,
                      configurable: !0,
                      writable: !0,
                    })
                  : (e[t] = n),
                e
              );
            }
            function l(e, t) {
              var n = Object.keys(e);
              if (Object.getOwnPropertySymbols) {
                var i = Object.getOwnPropertySymbols(e);
                t &&
                  (i = i.filter(function (t) {
                    return Object.getOwnPropertyDescriptor(e, t).enumerable;
                  })),
                  n.push.apply(n, i);
              }
              return n;
            }
            function u(e) {
              for (var t = 1; t < arguments.length; t++) {
                var n = null != arguments[t] ? arguments[t] : {};
                t % 2
                  ? l(Object(n), !0).forEach(function (t) {
                      s(e, t, n[t]);
                    })
                  : Object.getOwnPropertyDescriptors
                  ? Object.defineProperties(
                      e,
                      Object.getOwnPropertyDescriptors(n)
                    )
                  : l(Object(n)).forEach(function (t) {
                      Object.defineProperty(
                        e,
                        t,
                        Object.getOwnPropertyDescriptor(n, t)
                      );
                    });
              }
              return e;
            }
            var h = { addCSS: !0, thumbWidth: 15, watch: !0 };
            function p(e, t) {
              return function () {
                return Array.from(document.querySelectorAll(t)).includes(this);
              }.call(e, t);
            }
            var m = function (e) {
                return null != e ? e.constructor : null;
              },
              f = function (e, t) {
                return !!(e && t && e instanceof t);
              },
              g = function (e) {
                return m(e) === String;
              },
              y = function (e) {
                return Array.isArray(e);
              },
              v = function (e) {
                return f(e, NodeList);
              },
              b = g,
              w = y,
              k = v,
              T = function (e) {
                return f(e, Element);
              },
              S = function (e) {
                return f(e, Event);
              },
              A = function (e) {
                return (
                  (function (e) {
                    return null == e;
                  })(e) ||
                  ((g(e) || y(e) || v(e)) && !e.length) ||
                  ((function (e) {
                    return m(e) === Object;
                  })(e) &&
                    !Object.keys(e).length)
                );
              };
            var C = (function () {
                function e(t, n) {
                  (function (e, t) {
                    if (!(e instanceof t))
                      throw new TypeError("Cannot call a class as a function");
                  })(this, e),
                    T(t)
                      ? (this.element = t)
                      : b(t) && (this.element = document.querySelector(t)),
                    T(this.element) &&
                      A(this.element.rangeTouch) &&
                      ((this.config = u({}, h, {}, n)), this.init());
                }
                return (
                  (function (e, n, i) {
                    n && t(e.prototype, n), i && t(e, i);
                  })(
                    e,
                    [
                      {
                        key: "init",
                        value: function () {
                          e.enabled &&
                            (this.config.addCSS &&
                              ((this.element.style.userSelect = "none"),
                              (this.element.style.webKitUserSelect = "none"),
                              (this.element.style.touchAction =
                                "manipulation")),
                            this.listeners(!0),
                            (this.element.rangeTouch = this));
                        },
                      },
                      {
                        key: "destroy",
                        value: function () {
                          e.enabled &&
                            (this.config.addCSS &&
                              ((this.element.style.userSelect = ""),
                              (this.element.style.webKitUserSelect = ""),
                              (this.element.style.touchAction = "")),
                            this.listeners(!1),
                            (this.element.rangeTouch = null));
                        },
                      },
                      {
                        key: "listeners",
                        value: function (e) {
                          var t = this,
                            n = e ? "addEventListener" : "removeEventListener";
                          ["touchstart", "touchmove", "touchend"].forEach(
                            function (e) {
                              t.element[n](
                                e,
                                function (e) {
                                  return t.set(e);
                                },
                                !1
                              );
                            }
                          );
                        },
                      },
                      {
                        key: "get",
                        value: function (t) {
                          if (!e.enabled || !S(t)) return null;
                          var n,
                            i = t.target,
                            a = t.changedTouches[0],
                            r = parseFloat(i.getAttribute("min")) || 0,
                            s = parseFloat(i.getAttribute("max")) || 100,
                            o = parseFloat(i.getAttribute("step")) || 1,
                            l = i.getBoundingClientRect(),
                            c =
                              ((100 / l.width) * (this.config.thumbWidth / 2)) /
                              100;
                          return (
                            0 > (n = (100 / l.width) * (a.clientX - l.left))
                              ? (n = 0)
                              : 100 < n && (n = 100),
                            50 > n
                              ? (n -= (100 - 2 * n) * c)
                              : 50 < n && (n += 2 * (n - 50) * c),
                            r +
                              (function (e, t) {
                                if (1 > t) {
                                  var n = (function (e) {
                                    var t = ""
                                      .concat(e)
                                      .match(
                                        /(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/
                                      );
                                    return t
                                      ? Math.max(
                                          0,
                                          (t[1] ? t[1].length : 0) -
                                            (t[2] ? +t[2] : 0)
                                        )
                                      : 0;
                                  })(t);
                                  return parseFloat(e.toFixed(n));
                                }
                                return Math.round(e / t) * t;
                              })((n / 100) * (s - r), o)
                          );
                        },
                      },
                      {
                        key: "set",
                        value: function (t) {
                          e.enabled &&
                            S(t) &&
                            !t.target.disabled &&
                            (t.preventDefault(),
                            (t.target.value = this.get(t)),
                            (function (e, t) {
                              if (e && t) {
                                var n = new Event(t, { bubbles: !0 });
                                e.dispatchEvent(n);
                              }
                            })(
                              t.target,
                              "touchend" === t.type ? "change" : "input"
                            ));
                        },
                      },
                    ],
                    [
                      {
                        key: "setup",
                        value: function (t) {
                          var n =
                              1 < arguments.length && void 0 !== arguments[1]
                                ? arguments[1]
                                : {},
                            i = null;
                          if (
                            (A(t) || b(t)
                              ? (i = Array.from(
                                  document.querySelectorAll(
                                    b(t) ? t : 'input[type="range"]'
                                  )
                                ))
                              : T(t)
                              ? (i = [t])
                              : k(t)
                              ? (i = Array.from(t))
                              : w(t) && (i = t.filter(T)),
                            A(i))
                          )
                            return null;
                          var a = u({}, h, {}, n);
                          if (b(t) && a.watch) {
                            var r = new MutationObserver(function (n) {
                              Array.from(n).forEach(function (n) {
                                Array.from(n.addedNodes).forEach(function (n) {
                                  T(n) && p(n, t) && new e(n, a);
                                });
                              });
                            });
                            r.observe(document.body, {
                              childList: !0,
                              subtree: !0,
                            });
                          }
                          return i.map(function (t) {
                            return new e(t, n);
                          });
                        },
                      },
                      {
                        key: "enabled",
                        get: function () {
                          return "ontouchstart" in document.documentElement;
                        },
                      },
                    ]
                  ),
                  e
                );
              })(),
              E = function (e) {
                return null != e ? e.constructor : null;
              },
              P = function (e, t) {
                return Boolean(e && t && e instanceof t);
              },
              M = function (e) {
                return null == e;
              },
              x = function (e) {
                return E(e) === Object;
              },
              L = function (e) {
                return E(e) === String;
              },
              j = function (e) {
                return E(e) === Function;
              },
              N = function (e) {
                return Array.isArray(e);
              },
              I = function (e) {
                return P(e, NodeList);
              },
              _ = function (e) {
                return (
                  M(e) ||
                  ((L(e) || N(e) || I(e)) && !e.length) ||
                  (x(e) && !Object.keys(e).length)
                );
              },
              O = M,
              q = x,
              D = function (e) {
                return E(e) === Number && !Number.isNaN(e);
              },
              H = L,
              F = function (e) {
                return E(e) === Boolean;
              },
              R = j,
              V = N,
              B = I,
              U = function (e) {
                return (
                  null !== e &&
                  "object" == typeof e &&
                  1 === e.nodeType &&
                  "object" == typeof e.style &&
                  "object" == typeof e.ownerDocument
                );
              },
              W = function (e) {
                return P(e, Event);
              },
              z = function (e) {
                return P(e, KeyboardEvent);
              },
              K = function (e) {
                return P(e, TextTrack) || (!M(e) && L(e.kind));
              },
              Y = function (e) {
                if (P(e, window.URL)) return !0;
                if (!L(e)) return !1;
                var t = e;
                (e.startsWith("http://") && e.startsWith("https://")) ||
                  (t = "http://".concat(e));
                try {
                  return !_(new URL(t).hostname);
                } catch (e) {
                  return !1;
                }
              },
              $ = _,
              Q = (function () {
                var e = document.createElement("span"),
                  t = {
                    WebkitTransition: "webkitTransitionEnd",
                    MozTransition: "transitionend",
                    OTransition: "oTransitionEnd otransitionend",
                    transition: "transitionend",
                  },
                  n = Object.keys(t).find(function (t) {
                    return void 0 !== e.style[t];
                  });
                return !!H(n) && t[n];
              })();
            function X(e, t) {
              setTimeout(function () {
                try {
                  (e.hidden = !0), e.offsetHeight, (e.hidden = !1);
                } catch (e) {}
              }, t);
            }
            var J = {
              isIE: Boolean(window.document.documentMode),
              isEdge: window.navigator.userAgent.includes("Edge"),
              isWebkit:
                "WebkitAppearance" in document.documentElement.style &&
                !/Edge/.test(navigator.userAgent),
              isIPhone: /(iPhone|iPod)/gi.test(navigator.platform),
              isIos:
                ("MacIntel" === navigator.platform &&
                  navigator.maxTouchPoints > 1) ||
                /(iPad|iPhone|iPod)/gi.test(navigator.platform),
            };
            function G(e, t) {
              return t.split(".").reduce(function (e, t) {
                return e && e[t];
              }, e);
            }
            function Z() {
              for (
                var e =
                    arguments.length > 0 && void 0 !== arguments[0]
                      ? arguments[0]
                      : {},
                  t = arguments.length,
                  n = new Array(t > 1 ? t - 1 : 0),
                  i = 1;
                i < t;
                i++
              )
                n[i - 1] = arguments[i];
              if (!n.length) return e;
              var a = n.shift();
              return q(a)
                ? (Object.keys(a).forEach(function (t) {
                    q(a[t])
                      ? (Object.keys(e).includes(t) ||
                          Object.assign(e, { [t]: {} }),
                        Z(e[t], a[t]))
                      : Object.assign(e, { [t]: a[t] });
                  }),
                  Z.apply(void 0, [e].concat(n)))
                : e;
            }
            function ee(e, t) {
              var n = e.length ? e : [e];
              Array.from(n)
                .reverse()
                .forEach(function (e, n) {
                  var i = n > 0 ? t.cloneNode(!0) : t,
                    a = e.parentNode,
                    r = e.nextSibling;
                  i.appendChild(e), r ? a.insertBefore(i, r) : a.appendChild(i);
                });
            }
            function te(e, t) {
              U(e) &&
                !$(t) &&
                Object.entries(t)
                  .filter(function (e) {
                    var t = d(e, 2)[1];
                    return !O(t);
                  })
                  .forEach(function (t) {
                    var n = d(t, 2),
                      i = n[0],
                      a = n[1];
                    return e.setAttribute(i, a);
                  });
            }
            function ne(e, t, n) {
              var i = document.createElement(e);
              return q(t) && te(i, t), H(n) && (i.innerText = n), i;
            }
            function ie(e, t, n, i) {
              U(t) && t.appendChild(ne(e, n, i));
            }
            function ae(e) {
              B(e) || V(e)
                ? Array.from(e).forEach(ae)
                : U(e) && U(e.parentNode) && e.parentNode.removeChild(e);
            }
            function re(e) {
              if (U(e))
                for (var t = e.childNodes.length; t > 0; )
                  e.removeChild(e.lastChild), (t -= 1);
            }
            function se(e, t) {
              return U(t) && U(t.parentNode) && U(e)
                ? (t.parentNode.replaceChild(e, t), e)
                : null;
            }
            function oe(e, t) {
              if (!H(e) || $(e)) return {};
              var n = {},
                i = Z({}, t);
              return (
                e.split(",").forEach(function (e) {
                  var t = e.trim(),
                    a = t.replace(".", ""),
                    r = t.replace(/[[\]]/g, "").split("="),
                    s = d(r, 1)[0],
                    o = r.length > 1 ? r[1].replace(/["']/g, "") : "";
                  switch (t.charAt(0)) {
                    case ".":
                      H(i.class)
                        ? (n.class = "".concat(i.class, " ").concat(a))
                        : (n.class = a);
                      break;
                    case "#":
                      n.id = t.replace("#", "");
                      break;
                    case "[":
                      n[s] = o;
                  }
                }),
                Z(i, n)
              );
            }
            function le(e, t) {
              if (U(e)) {
                var n = t;
                F(n) || (n = !e.hidden), (e.hidden = n);
              }
            }
            function ce(e, t, n) {
              if (B(e))
                return Array.from(e).map(function (e) {
                  return ce(e, t, n);
                });
              if (U(e)) {
                var i = "toggle";
                return (
                  void 0 !== n && (i = n ? "add" : "remove"),
                  e.classList[i](t),
                  e.classList.contains(t)
                );
              }
              return !1;
            }
            function ue(e, t) {
              return U(e) && e.classList.contains(t);
            }
            function de(e, t) {
              var n = Element.prototype;
              return (
                n.matches ||
                n.webkitMatchesSelector ||
                n.mozMatchesSelector ||
                n.msMatchesSelector ||
                function () {
                  return Array.from(document.querySelectorAll(t)).includes(
                    this
                  );
                }
              ).call(e, t);
            }
            function he(e) {
              return this.elements.container.querySelectorAll(e);
            }
            function pe(e) {
              return this.elements.container.querySelector(e);
            }
            function me() {
              var e =
                  arguments.length > 0 && void 0 !== arguments[0]
                    ? arguments[0]
                    : null,
                t =
                  arguments.length > 1 &&
                  void 0 !== arguments[1] &&
                  arguments[1];
              U(e) &&
                (e.focus({ preventScroll: !0 }),
                t && ce(e, this.config.classNames.tabFocus));
            }
            var fe = {
                "audio/ogg": "vorbis",
                "audio/wav": "1",
                "video/webm": "vp8, vorbis",
                "video/mp4": "avc1.42E01E, mp4a.40.2",
                "video/ogg": "theora",
              },
              ge = {
                audio: "canPlayType" in document.createElement("audio"),
                video: "canPlayType" in document.createElement("video"),
                check(e, t, n) {
                  var i = J.isIPhone && n && ge.playsinline,
                    a = ge[e] || "html5" !== t;
                  return {
                    api: a,
                    ui:
                      a && ge.rangeInput && ("video" !== e || !J.isIPhone || i),
                  };
                },
                pip: !(
                  J.isIPhone ||
                  (!R(ne("video").webkitSetPresentationMode) &&
                    (!document.pictureInPictureEnabled ||
                      ne("video").disablePictureInPicture))
                ),
                airplay: R(window.WebKitPlaybackTargetAvailabilityEvent),
                playsinline: "playsInline" in document.createElement("video"),
                mime(e) {
                  if ($(e)) return !1;
                  var t = d(e.split("/"), 1)[0],
                    n = e;
                  if (!this.isHTML5 || t !== this.type) return !1;
                  Object.keys(fe).includes(n) &&
                    (n += '; codecs="'.concat(fe[e], '"'));
                  try {
                    return Boolean(
                      n && this.media.canPlayType(n).replace(/no/, "")
                    );
                  } catch (e) {
                    return !1;
                  }
                },
                textTracks: "textTracks" in document.createElement("video"),
                rangeInput: (function () {
                  var e = document.createElement("input");
                  return (e.type = "range"), "range" === e.type;
                })(),
                touch: "ontouchstart" in document.documentElement,
                transitions: !1 !== Q,
                reducedMotion:
                  "matchMedia" in window &&
                  window.matchMedia("(prefers-reduced-motion)").matches,
              },
              ye = (function () {
                var e = !1;
                try {
                  var t = Object.defineProperty({}, "passive", {
                    get: function () {
                      return (e = !0), null;
                    },
                  });
                  window.addEventListener("test", null, t),
                    window.removeEventListener("test", null, t);
                } catch (e) {}
                return e;
              })();
            function ve(e, t, n) {
              var i = this,
                a =
                  arguments.length > 3 &&
                  void 0 !== arguments[3] &&
                  arguments[3],
                r =
                  !(arguments.length > 4 && void 0 !== arguments[4]) ||
                  arguments[4],
                s =
                  arguments.length > 5 &&
                  void 0 !== arguments[5] &&
                  arguments[5];
              if (e && "addEventListener" in e && !$(t) && R(n)) {
                var o = t.split(" "),
                  l = s;
                ye && (l = { passive: r, capture: s }),
                  o.forEach(function (t) {
                    i &&
                      i.eventListeners &&
                      a &&
                      i.eventListeners.push({
                        element: e,
                        type: t,
                        callback: n,
                        options: l,
                      }),
                      e[a ? "addEventListener" : "removeEventListener"](
                        t,
                        n,
                        l
                      );
                  });
              }
            }
            function be(e) {
              var t =
                  arguments.length > 1 && void 0 !== arguments[1]
                    ? arguments[1]
                    : "",
                n = arguments.length > 2 ? arguments[2] : void 0,
                i =
                  !(arguments.length > 3 && void 0 !== arguments[3]) ||
                  arguments[3],
                a =
                  arguments.length > 4 &&
                  void 0 !== arguments[4] &&
                  arguments[4];
              ve.call(this, e, t, n, !0, i, a);
            }
            function we(e) {
              var t =
                  arguments.length > 1 && void 0 !== arguments[1]
                    ? arguments[1]
                    : "",
                n = arguments.length > 2 ? arguments[2] : void 0,
                i =
                  !(arguments.length > 3 && void 0 !== arguments[3]) ||
                  arguments[3],
                a =
                  arguments.length > 4 &&
                  void 0 !== arguments[4] &&
                  arguments[4];
              ve.call(this, e, t, n, !1, i, a);
            }
            function ke(e) {
              var t = this,
                n =
                  arguments.length > 1 && void 0 !== arguments[1]
                    ? arguments[1]
                    : "",
                i = arguments.length > 2 ? arguments[2] : void 0,
                a =
                  !(arguments.length > 3 && void 0 !== arguments[3]) ||
                  arguments[3],
                r =
                  arguments.length > 4 &&
                  void 0 !== arguments[4] &&
                  arguments[4],
                s = function s() {
                  for (
                    var o = arguments.length, l = new Array(o), c = 0;
                    c < o;
                    c++
                  )
                    l[c] = arguments[c];
                  we(e, n, s, a, r), i.apply(t, l);
                };
              ve.call(this, e, n, s, !0, a, r);
            }
            function Te(e) {
              var t =
                  arguments.length > 1 && void 0 !== arguments[1]
                    ? arguments[1]
                    : "",
                n =
                  arguments.length > 2 &&
                  void 0 !== arguments[2] &&
                  arguments[2],
                i =
                  arguments.length > 3 && void 0 !== arguments[3]
                    ? arguments[3]
                    : {};
              if (U(e) && !$(t)) {
                var a = new CustomEvent(t, {
                  bubbles: n,
                  detail: c(c({}, i), {}, { plyr: this }),
                });
                e.dispatchEvent(a);
              }
            }
            function Se() {
              this &&
                this.eventListeners &&
                (this.eventListeners.forEach(function (e) {
                  var t = e.element,
                    n = e.type,
                    i = e.callback,
                    a = e.options;
                  t.removeEventListener(n, i, a);
                }),
                (this.eventListeners = []));
            }
            function Ae() {
              var e = this;
              return new Promise(function (t) {
                return e.ready
                  ? setTimeout(t, 0)
                  : be.call(e, e.elements.container, "ready", t);
              }).then(function () {});
            }
            function Ce(e) {
              (function (e) {
                return P(e, Promise) && j(e.then);
              })(e) && e.then(null, function () {});
            }
            function Ee(e) {
              return V(e)
                ? e.filter(function (t, n) {
                    return e.indexOf(t) === n;
                  })
                : e;
            }
            function Pe(e, t) {
              return V(e) && e.length
                ? e.reduce(function (e, n) {
                    return Math.abs(n - t) < Math.abs(e - t) ? n : e;
                  })
                : null;
            }
            function Me(e) {
              return !(!window || !window.CSS) && window.CSS.supports(e);
            }
            var xe = [
              [1, 1],
              [4, 3],
              [3, 4],
              [5, 4],
              [4, 5],
              [3, 2],
              [2, 3],
              [16, 10],
              [10, 16],
              [16, 9],
              [9, 16],
              [21, 9],
              [9, 21],
              [32, 9],
              [9, 32],
            ].reduce(function (e, t) {
              var n = d(t, 2),
                i = n[0],
                a = n[1];
              return c(c({}, e), {}, { [i / a]: [i, a] });
            }, {});
            function Le(e) {
              return (
                !!(V(e) || (H(e) && e.includes(":"))) &&
                (V(e) ? e : e.split(":")).map(Number).every(D)
              );
            }
            function je(e) {
              if (!V(e) || !e.every(D)) return null;
              var t = d(e, 2),
                n = t[0],
                i = t[1],
                a = (function e(t, n) {
                  return 0 === n ? t : e(n, t % n);
                })(n, i);
              return [n / a, i / a];
            }
            function Ne(e) {
              var t = function (e) {
                  return Le(e) ? e.split(":").map(Number) : null;
                },
                n = t(e);
              if (
                (null === n && (n = t(this.config.ratio)),
                null === n &&
                  !$(this.embed) &&
                  V(this.embed.ratio) &&
                  (n = this.embed.ratio),
                null === n && this.isHTML5)
              ) {
                var i = this.media;
                n = [i.videoWidth, i.videoHeight];
              }
              return je(n);
            }
            function Ie(e) {
              if (!this.isVideo) return {};
              var t = this.elements.wrapper,
                n = Ne.call(this, e);
              if (!V(n)) return {};
              var i = d(je(n), 2),
                a = i[0],
                r = i[1],
                s = (100 / a) * r;
              if (
                (Me("aspect-ratio: ".concat(a, "/").concat(r))
                  ? (t.style.aspectRatio = "".concat(a, "/").concat(r))
                  : (t.style.paddingBottom = "".concat(s, "%")),
                this.isVimeo && !this.config.vimeo.premium && this.supported.ui)
              ) {
                var o =
                    (100 / this.media.offsetWidth) *
                    parseInt(
                      window.getComputedStyle(this.media).paddingBottom,
                      10
                    ),
                  l = (o - s) / (o / 50);
                this.fullscreen.active
                  ? (t.style.paddingBottom = null)
                  : (this.media.style.transform = "translateY(-".concat(
                      l,
                      "%)"
                    ));
              } else
                this.isHTML5 &&
                  t.classList.add(this.config.classNames.videoFixedRatio);
              return { padding: s, ratio: n };
            }
            function _e(e, t) {
              var n =
                  arguments.length > 2 && void 0 !== arguments[2]
                    ? arguments[2]
                    : 0.05,
                i = e / t,
                a = Pe(Object.keys(xe), i);
              return Math.abs(a - i) <= n ? xe[a] : [e, t];
            }
            var Oe = {
              getSources() {
                var e = this;
                return this.isHTML5
                  ? Array.from(this.media.querySelectorAll("source")).filter(
                      function (t) {
                        var n = t.getAttribute("type");
                        return !!$(n) || ge.mime.call(e, n);
                      }
                    )
                  : [];
              },
              getQualityOptions() {
                return this.config.quality.forced
                  ? this.config.quality.options
                  : Oe.getSources
                      .call(this)
                      .map(function (e) {
                        return Number(e.getAttribute("size"));
                      })
                      .filter(Boolean);
              },
              setup() {
                if (this.isHTML5) {
                  var e = this;
                  (e.options.speed = e.config.speed.options),
                    $(this.config.ratio) || Ie.call(e),
                    Object.defineProperty(e.media, "quality", {
                      get() {
                        var t = Oe.getSources.call(e).find(function (t) {
                          return t.getAttribute("src") === e.source;
                        });
                        return t && Number(t.getAttribute("size"));
                      },
                      set(t) {
                        if (e.quality !== t) {
                          if (
                            e.config.quality.forced &&
                            R(e.config.quality.onChange)
                          )
                            e.config.quality.onChange(t);
                          else {
                            var n = Oe.getSources.call(e).find(function (e) {
                              return Number(e.getAttribute("size")) === t;
                            });
                            if (!n) return;
                            var i = e.media,
                              a = i.currentTime,
                              r = i.paused,
                              s = i.preload,
                              o = i.readyState,
                              l = i.playbackRate;
                            (e.media.src = n.getAttribute("src")),
                              ("none" !== s || o) &&
                                (e.once("loadedmetadata", function () {
                                  (e.speed = l),
                                    (e.currentTime = a),
                                    r || Ce(e.play());
                                }),
                                e.media.load());
                          }
                          Te.call(e, e.media, "qualitychange", !1, {
                            quality: t,
                          });
                        }
                      },
                    });
                }
              },
              cancelRequests() {
                this.isHTML5 &&
                  (ae(Oe.getSources.call(this)),
                  this.media.setAttribute("src", this.config.blankVideo),
                  this.media.load(),
                  this.debug.log("Cancelled network requests"));
              },
            };
            function qe(e) {
              for (
                var t = arguments.length,
                  n = new Array(t > 1 ? t - 1 : 0),
                  i = 1;
                i < t;
                i++
              )
                n[i - 1] = arguments[i];
              return $(e)
                ? e
                : e.toString().replace(/{(\d+)}/g, function (e, t) {
                    return n[t].toString();
                  });
            }
            var De = function () {
                var e =
                    arguments.length > 1 && void 0 !== arguments[1]
                      ? arguments[1]
                      : "",
                  t =
                    arguments.length > 2 && void 0 !== arguments[2]
                      ? arguments[2]
                      : "";
                return (
                  arguments.length > 0 && void 0 !== arguments[0]
                    ? arguments[0]
                    : ""
                ).replace(
                  new RegExp(
                    e.toString().replace(/([.*+?^=!:${}()|[\]/\\])/g, "\\$1"),
                    "g"
                  ),
                  t.toString()
                );
              },
              He = function () {
                return (
                  arguments.length > 0 && void 0 !== arguments[0]
                    ? arguments[0]
                    : ""
                )
                  .toString()
                  .replace(/\w\S*/g, function (e) {
                    return e.charAt(0).toUpperCase() + e.slice(1).toLowerCase();
                  });
              };
            function Fe(e) {
              var t = document.createElement("div");
              return t.appendChild(e), t.innerHTML;
            }
            var Re = {
                pip: "PIP",
                airplay: "AirPlay",
                html5: "HTML5",
                vimeo: "Vimeo",
                youtube: "YouTube",
              },
              Ve = {
                get() {
                  var e =
                      arguments.length > 0 && void 0 !== arguments[0]
                        ? arguments[0]
                        : "",
                    t =
                      arguments.length > 1 && void 0 !== arguments[1]
                        ? arguments[1]
                        : {};
                  if ($(e) || $(t)) return "";
                  var n = G(t.i18n, e);
                  if ($(n)) return Object.keys(Re).includes(e) ? Re[e] : "";
                  var i = { "{seektime}": t.seekTime, "{title}": t.title };
                  return (
                    Object.entries(i).forEach(function (e) {
                      var t = d(e, 2),
                        i = t[0],
                        a = t[1];
                      n = De(n, i, a);
                    }),
                    n
                  );
                },
              },
              Be = (function () {
                function t(n) {
                  var i = this;
                  r(this, t),
                    e(this, "get", function (e) {
                      if (!t.supported || !i.enabled) return null;
                      var n = window.localStorage.getItem(i.key);
                      if ($(n)) return null;
                      var a = JSON.parse(n);
                      return H(e) && e.length ? a[e] : a;
                    }),
                    e(this, "set", function (e) {
                      if (t.supported && i.enabled && q(e)) {
                        var n = i.get();
                        $(n) && (n = {}), Z(n, e);
                        try {
                          window.localStorage.setItem(i.key, JSON.stringify(n));
                        } catch (e) {}
                      }
                    }),
                    (this.enabled = n.config.storage.enabled),
                    (this.key = n.config.storage.key);
                }
                return (
                  o(t, null, [
                    {
                      key: "supported",
                      get: function () {
                        try {
                          if (!("localStorage" in window)) return !1;
                          var e = "___test";
                          return (
                            window.localStorage.setItem(e, e),
                            window.localStorage.removeItem(e),
                            !0
                          );
                        } catch (e) {
                          return !1;
                        }
                      },
                    },
                  ]),
                  t
                );
              })();
            function Ue(e) {
              var t =
                arguments.length > 1 && void 0 !== arguments[1]
                  ? arguments[1]
                  : "text";
              return new Promise(function (n, i) {
                try {
                  var a = new XMLHttpRequest();
                  if (!("withCredentials" in a)) return;
                  a.addEventListener("load", function () {
                    if ("text" === t)
                      try {
                        n(JSON.parse(a.responseText));
                      } catch (e) {
                        n(a.responseText);
                      }
                    else n(a.response);
                  }),
                    a.addEventListener("error", function () {
                      throw new Error(a.status);
                    }),
                    a.open("GET", e, !0),
                    (a.responseType = t),
                    a.send();
                } catch (e) {
                  i(e);
                }
              });
            }
            function We(e, t) {
              if (H(e)) {
                var n = H(t),
                  i = function () {
                    return null !== document.getElementById(t);
                  },
                  a = function (e, t) {
                    (e.innerHTML = t),
                      (n && i()) ||
                        document.body.insertAdjacentElement("afterbegin", e);
                  };
                if (!n || !i()) {
                  var r = Be.supported,
                    s = document.createElement("div");
                  if (
                    (s.setAttribute("hidden", ""),
                    n && s.setAttribute("id", t),
                    r)
                  ) {
                    var o = window.localStorage.getItem("cache-".concat(t));
                    if (null !== o) {
                      var l = JSON.parse(o);
                      a(s, l.content);
                    }
                  }
                  Ue(e)
                    .then(function (e) {
                      if (!$(e)) {
                        if (r)
                          try {
                            window.localStorage.setItem(
                              "cache-".concat(t),
                              JSON.stringify({ content: e })
                            );
                          } catch (e) {}
                        a(s, e);
                      }
                    })
                    .catch(function () {});
                }
              }
            }
            var ze = function (e) {
              return Math.trunc((e / 60 / 60) % 60, 10);
            };
            function Ke() {
              var e =
                  arguments.length > 0 && void 0 !== arguments[0]
                    ? arguments[0]
                    : 0,
                t =
                  arguments.length > 1 &&
                  void 0 !== arguments[1] &&
                  arguments[1],
                n =
                  arguments.length > 2 &&
                  void 0 !== arguments[2] &&
                  arguments[2];
              if (!D(e)) return Ke(void 0, t, n);
              var i,
                a = function (e) {
                  return "0".concat(e).slice(-2);
                },
                r = ze(e),
                s = ((i = e), Math.trunc((i / 60) % 60, 10)),
                o = (function (e) {
                  return Math.trunc(e % 60, 10);
                })(e);
              return (
                (r = t || r > 0 ? "".concat(r, ":") : ""),
                ""
                  .concat(n && e > 0 ? "-" : "")
                  .concat(r)
                  .concat(a(s), ":")
                  .concat(a(o))
              );
            }
            var Ye = {
              getIconUrl() {
                var e = new URL(this.config.iconUrl, window.location),
                  t = window.location.host
                    ? window.location.host
                    : window.top.location.host,
                  n = e.host !== t || (J.isIE && !window.svg4everybody);
                return { url: this.config.iconUrl, cors: n };
              },
              findElements() {
                try {
                  return (
                    (this.elements.controls = pe.call(
                      this,
                      this.config.selectors.controls.wrapper
                    )),
                    (this.elements.buttons = {
                      play: he.call(this, this.config.selectors.buttons.play),
                      pause: pe.call(this, this.config.selectors.buttons.pause),
                      restart: pe.call(
                        this,
                        this.config.selectors.buttons.restart
                      ),
                      rewind: pe.call(
                        this,
                        this.config.selectors.buttons.rewind
                      ),
                      fastForward: pe.call(
                        this,
                        this.config.selectors.buttons.fastForward
                      ),
                      mute: pe.call(this, this.config.selectors.buttons.mute),
                      pip: pe.call(this, this.config.selectors.buttons.pip),
                      airplay: pe.call(
                        this,
                        this.config.selectors.buttons.airplay
                      ),
                      settings: pe.call(
                        this,
                        this.config.selectors.buttons.settings
                      ),
                      captions: pe.call(
                        this,
                        this.config.selectors.buttons.captions
                      ),
                      fullscreen: pe.call(
                        this,
                        this.config.selectors.buttons.fullscreen
                      ),
                    }),
                    (this.elements.progress = pe.call(
                      this,
                      this.config.selectors.progress
                    )),
                    (this.elements.inputs = {
                      seek: pe.call(this, this.config.selectors.inputs.seek),
                      volume: pe.call(
                        this,
                        this.config.selectors.inputs.volume
                      ),
                    }),
                    (this.elements.display = {
                      buffer: pe.call(
                        this,
                        this.config.selectors.display.buffer
                      ),
                      currentTime: pe.call(
                        this,
                        this.config.selectors.display.currentTime
                      ),
                      duration: pe.call(
                        this,
                        this.config.selectors.display.duration
                      ),
                    }),
                    U(this.elements.progress) &&
                      (this.elements.display.seekTooltip =
                        this.elements.progress.querySelector(
                          ".".concat(this.config.classNames.tooltip)
                        )),
                    !0
                  );
                } catch (e) {
                  return (
                    this.debug.warn(
                      "It looks like there is a problem with your custom controls HTML",
                      e
                    ),
                    this.toggleNativeControls(!0),
                    !1
                  );
                }
              },
              createIcon(e, t) {
                var n = "http://www.w3.org/2000/svg",
                  i = Ye.getIconUrl.call(this),
                  a = ""
                    .concat(i.cors ? "" : i.url, "#")
                    .concat(this.config.iconPrefix),
                  r = document.createElementNS(n, "svg");
                te(r, Z(t, { "aria-hidden": "true", focusable: "false" }));
                var s = document.createElementNS(n, "use"),
                  o = "".concat(a, "-").concat(e);
                return (
                  "href" in s &&
                    s.setAttributeNS("http://www.w3.org/1999/xlink", "href", o),
                  s.setAttributeNS(
                    "http://www.w3.org/1999/xlink",
                    "xlink:href",
                    o
                  ),
                  r.appendChild(s),
                  r
                );
              },
              createLabel(e) {
                var t =
                    arguments.length > 1 && void 0 !== arguments[1]
                      ? arguments[1]
                      : {},
                  n = Ve.get(e, this.config);
                return ne(
                  "span",
                  c(
                    c({}, t),
                    {},
                    {
                      class: [t.class, this.config.classNames.hidden]
                        .filter(Boolean)
                        .join(" "),
                    }
                  ),
                  n
                );
              },
              createBadge(e) {
                if ($(e)) return null;
                var t = ne("span", {
                  class: this.config.classNames.menu.value,
                });
                return (
                  t.appendChild(
                    ne("span", { class: this.config.classNames.menu.badge }, e)
                  ),
                  t
                );
              },
              createButton(e, t) {
                var n = this,
                  i = Z({}, t),
                  a = (function () {
                    var e = (
                      arguments.length > 0 && void 0 !== arguments[0]
                        ? arguments[0]
                        : ""
                    ).toString();
                    return (
                      (e = (function () {
                        var e = (
                          arguments.length > 0 && void 0 !== arguments[0]
                            ? arguments[0]
                            : ""
                        ).toString();
                        return (
                          (e = De(e, "-", " ")),
                          (e = De(e, "_", " ")),
                          (e = He(e)),
                          De(e, " ", "")
                        );
                      })(e)),
                      e.charAt(0).toLowerCase() + e.slice(1)
                    );
                  })(e),
                  r = {
                    element: "button",
                    toggle: !1,
                    label: null,
                    icon: null,
                    labelPressed: null,
                    iconPressed: null,
                  };
                switch (
                  (["element", "icon", "label"].forEach(function (e) {
                    Object.keys(i).includes(e) && ((r[e] = i[e]), delete i[e]);
                  }),
                  "button" !== r.element ||
                    Object.keys(i).includes("type") ||
                    (i.type = "button"),
                  Object.keys(i).includes("class")
                    ? i.class.split(" ").some(function (e) {
                        return e === n.config.classNames.control;
                      }) ||
                      Z(i, {
                        class: ""
                          .concat(i.class, " ")
                          .concat(this.config.classNames.control),
                      })
                    : (i.class = this.config.classNames.control),
                  e)
                ) {
                  case "play":
                    (r.toggle = !0),
                      (r.label = "play"),
                      (r.labelPressed = "pause"),
                      (r.icon = "play"),
                      (r.iconPressed = "pause");
                    break;
                  case "mute":
                    (r.toggle = !0),
                      (r.label = "mute"),
                      (r.labelPressed = "unmute"),
                      (r.icon = "volume"),
                      (r.iconPressed = "muted");
                    break;
                  case "captions":
                    (r.toggle = !0),
                      (r.label = "enableCaptions"),
                      (r.labelPressed = "disableCaptions"),
                      (r.icon = "captions-off"),
                      (r.iconPressed = "captions-on");
                    break;
                  case "fullscreen":
                    (r.toggle = !0),
                      (r.label = "enterFullscreen"),
                      (r.labelPressed = "exitFullscreen"),
                      (r.icon = "enter-fullscreen"),
                      (r.iconPressed = "exit-fullscreen");
                    break;
                  case "play-large":
                    (i.class += " ".concat(
                      this.config.classNames.control,
                      "--overlaid"
                    )),
                      (a = "play"),
                      (r.label = "play"),
                      (r.icon = "play");
                    break;
                  default:
                    $(r.label) && (r.label = a), $(r.icon) && (r.icon = e);
                }
                var s = ne(r.element);
                return (
                  r.toggle
                    ? (s.appendChild(
                        Ye.createIcon.call(this, r.iconPressed, {
                          class: "icon--pressed",
                        })
                      ),
                      s.appendChild(
                        Ye.createIcon.call(this, r.icon, {
                          class: "icon--not-pressed",
                        })
                      ),
                      s.appendChild(
                        Ye.createLabel.call(this, r.labelPressed, {
                          class: "label--pressed",
                        })
                      ),
                      s.appendChild(
                        Ye.createLabel.call(this, r.label, {
                          class: "label--not-pressed",
                        })
                      ))
                    : (s.appendChild(Ye.createIcon.call(this, r.icon)),
                      s.appendChild(Ye.createLabel.call(this, r.label))),
                  Z(i, oe(this.config.selectors.buttons[a], i)),
                  te(s, i),
                  "play" === a
                    ? (V(this.elements.buttons[a]) ||
                        (this.elements.buttons[a] = []),
                      this.elements.buttons[a].push(s))
                    : (this.elements.buttons[a] = s),
                  s
                );
              },
              createRange(e, t) {
                var n = ne(
                  "input",
                  Z(
                    oe(this.config.selectors.inputs[e]),
                    {
                      type: "range",
                      min: 0,
                      max: 100,
                      step: 0.01,
                      value: 0,
                      autocomplete: "off",
                      role: "slider",
                      "aria-label": Ve.get(e, this.config),
                      "aria-valuemin": 0,
                      "aria-valuemax": 100,
                      "aria-valuenow": 0,
                    },
                    t
                  )
                );
                return (
                  (this.elements.inputs[e] = n),
                  Ye.updateRangeFill.call(this, n),
                  C.setup(n),
                  n
                );
              },
              createProgress(e, t) {
                var n = ne(
                  "progress",
                  Z(
                    oe(this.config.selectors.display[e]),
                    {
                      min: 0,
                      max: 100,
                      value: 0,
                      role: "progressbar",
                      "aria-hidden": !0,
                    },
                    t
                  )
                );
                if ("volume" !== e) {
                  n.appendChild(ne("span", null, "0"));
                  var i = { played: "played", buffer: "buffered" }[e],
                    a = i ? Ve.get(i, this.config) : "";
                  n.innerText = "% ".concat(a.toLowerCase());
                }
                return (this.elements.display[e] = n), n;
              },
              createTime(e, t) {
                var n = oe(this.config.selectors.display[e], t),
                  i = ne(
                    "div",
                    Z(n, {
                      class: ""
                        .concat(n.class ? n.class : "", " ")
                        .concat(this.config.classNames.display.time, " ")
                        .trim(),
                      "aria-label": Ve.get(e, this.config),
                    }),
                    "00:00"
                  );
                return (this.elements.display[e] = i), i;
              },
              bindMenuItemShortcuts(e, t) {
                var n = this;
                be.call(
                  this,
                  e,
                  "keydown keyup",
                  function (i) {
                    if (
                      ["Space", "ArrowUp", "ArrowDown", "ArrowRight"].includes(
                        i.key
                      ) &&
                      (i.preventDefault(),
                      i.stopPropagation(),
                      "keydown" !== i.type)
                    ) {
                      var a,
                        r = de(e, '[role="menuitemradio"]');
                      !r && ["Space", "ArrowRight"].includes(i.key)
                        ? Ye.showMenuPanel.call(n, t, !0)
                        : "Space" !== i.key &&
                          ("ArrowDown" === i.key ||
                          (r && "ArrowRight" === i.key)
                            ? ((a = e.nextElementSibling),
                              U(a) || (a = e.parentNode.firstElementChild))
                            : ((a = e.previousElementSibling),
                              U(a) || (a = e.parentNode.lastElementChild)),
                          me.call(n, a, !0));
                    }
                  },
                  !1
                ),
                  be.call(this, e, "keyup", function (e) {
                    "Return" === e.key &&
                      Ye.focusFirstMenuItem.call(n, null, !0);
                  });
              },
              createMenuItem(e) {
                var t = this,
                  n = e.value,
                  i = e.list,
                  a = e.type,
                  r = e.title,
                  s = e.badge,
                  o = void 0 === s ? null : s,
                  l = e.checked,
                  c = void 0 !== l && l,
                  u = oe(this.config.selectors.inputs[a]),
                  d = ne(
                    "button",
                    Z(u, {
                      type: "button",
                      role: "menuitemradio",
                      class: ""
                        .concat(this.config.classNames.control, " ")
                        .concat(u.class ? u.class : "")
                        .trim(),
                      "aria-checked": c,
                      value: n,
                    })
                  ),
                  h = ne("span");
                (h.innerHTML = r),
                  U(o) && h.appendChild(o),
                  d.appendChild(h),
                  Object.defineProperty(d, "checked", {
                    enumerable: !0,
                    get: function () {
                      return "true" === d.getAttribute("aria-checked");
                    },
                    set(e) {
                      e &&
                        Array.from(d.parentNode.children)
                          .filter(function (e) {
                            return de(e, '[role="menuitemradio"]');
                          })
                          .forEach(function (e) {
                            return e.setAttribute("aria-checked", "false");
                          }),
                        d.setAttribute("aria-checked", e ? "true" : "false");
                    },
                  }),
                  this.listeners.bind(
                    d,
                    "click keyup",
                    function (e) {
                      if (!z(e) || "Space" === e.key) {
                        switch (
                          (e.preventDefault(),
                          e.stopPropagation(),
                          (d.checked = !0),
                          a)
                        ) {
                          case "language":
                            t.currentTrack = Number(n);
                            break;
                          case "quality":
                            t.quality = n;
                            break;
                          case "speed":
                            t.speed = parseFloat(n);
                        }
                        Ye.showMenuPanel.call(t, "home", z(e));
                      }
                    },
                    a,
                    !1
                  ),
                  Ye.bindMenuItemShortcuts.call(this, d, a),
                  i.appendChild(d);
              },
              formatTime() {
                var e =
                    arguments.length > 0 && void 0 !== arguments[0]
                      ? arguments[0]
                      : 0,
                  t =
                    arguments.length > 1 &&
                    void 0 !== arguments[1] &&
                    arguments[1];
                return D(e) ? Ke(e, ze(this.duration) > 0, t) : e;
              },
              updateTimeDisplay() {
                var e =
                    arguments.length > 0 && void 0 !== arguments[0]
                      ? arguments[0]
                      : null,
                  t =
                    arguments.length > 1 && void 0 !== arguments[1]
                      ? arguments[1]
                      : 0,
                  n =
                    arguments.length > 2 &&
                    void 0 !== arguments[2] &&
                    arguments[2];
                U(e) && D(t) && (e.innerText = Ye.formatTime(t, n));
              },
              updateVolume() {
                this.supported.ui &&
                  (U(this.elements.inputs.volume) &&
                    Ye.setRange.call(
                      this,
                      this.elements.inputs.volume,
                      this.muted ? 0 : this.volume
                    ),
                  U(this.elements.buttons.mute) &&
                    (this.elements.buttons.mute.pressed =
                      this.muted || 0 === this.volume));
              },
              setRange(e) {
                var t =
                  arguments.length > 1 && void 0 !== arguments[1]
                    ? arguments[1]
                    : 0;
                U(e) && ((e.value = t), Ye.updateRangeFill.call(this, e));
              },
              updateProgress(e) {
                var t = this;
                if (this.supported.ui && W(e)) {
                  var n,
                    i,
                    a = 0;
                  if (e)
                    switch (e.type) {
                      case "timeupdate":
                      case "seeking":
                      case "seeked":
                        (n = this.currentTime),
                          (i = this.duration),
                          (a =
                            0 === n ||
                            0 === i ||
                            Number.isNaN(n) ||
                            Number.isNaN(i)
                              ? 0
                              : ((n / i) * 100).toFixed(2)),
                          "timeupdate" === e.type &&
                            Ye.setRange.call(
                              this,
                              this.elements.inputs.seek,
                              a
                            );
                        break;
                      case "playing":
                      case "progress":
                        !(function (e, n) {
                          var i = D(n) ? n : 0,
                            a = U(e) ? e : t.elements.display.buffer;
                          if (U(a)) {
                            a.value = i;
                            var r = a.getElementsByTagName("span")[0];
                            U(r) && (r.childNodes[0].nodeValue = i);
                          }
                        })(this.elements.display.buffer, 100 * this.buffered);
                    }
                }
              },
              updateRangeFill(e) {
                var t = W(e) ? e.target : e;
                if (U(t) && "range" === t.getAttribute("type")) {
                  if (de(t, this.config.selectors.inputs.seek)) {
                    t.setAttribute("aria-valuenow", this.currentTime);
                    var n = Ye.formatTime(this.currentTime),
                      i = Ye.formatTime(this.duration),
                      a = Ve.get("seekLabel", this.config);
                    t.setAttribute(
                      "aria-valuetext",
                      a.replace("{currentTime}", n).replace("{duration}", i)
                    );
                  } else if (de(t, this.config.selectors.inputs.volume)) {
                    var r = 100 * t.value;
                    t.setAttribute("aria-valuenow", r),
                      t.setAttribute(
                        "aria-valuetext",
                        "".concat(r.toFixed(1), "%")
                      );
                  } else t.setAttribute("aria-valuenow", t.value);
                  J.isWebkit &&
                    t.style.setProperty(
                      "--value",
                      (t.value / t.max) * 100 + "%"
                    );
                }
              },
              updateSeekTooltip(e) {
                var t, n;
                if (
                  this.config.tooltips.seek &&
                  U(this.elements.inputs.seek) &&
                  U(this.elements.display.seekTooltip) &&
                  0 !== this.duration
                ) {
                  var i = this.elements.display.seekTooltip,
                    a = "".concat(this.config.classNames.tooltip, "--visible"),
                    r = function (e) {
                      return ce(i, a, e);
                    };
                  if (this.touch) r(!1);
                  else {
                    var s = 0,
                      o = this.elements.progress.getBoundingClientRect();
                    if (W(e)) s = (100 / o.width) * (e.pageX - o.left);
                    else {
                      if (!ue(i, a)) return;
                      s = parseFloat(i.style.left, 10);
                    }
                    s < 0 ? (s = 0) : s > 100 && (s = 100);
                    var l = (this.duration / 100) * s;
                    i.innerText = Ye.formatTime(l);
                    var c =
                      null === (t = this.config.markers) ||
                      void 0 === t ||
                      null === (n = t.points) ||
                      void 0 === n
                        ? void 0
                        : n.find(function (e) {
                            return e.time === Math.round(l);
                          });
                    c &&
                      i.insertAdjacentHTML(
                        "afterbegin",
                        "".concat(c.label, "<br>")
                      ),
                      (i.style.left = "".concat(s, "%")),
                      W(e) &&
                        ["mouseenter", "mouseleave"].includes(e.type) &&
                        r("mouseenter" === e.type);
                  }
                }
              },
              timeUpdate(e) {
                var t =
                  !U(this.elements.display.duration) && this.config.invertTime;
                Ye.updateTimeDisplay.call(
                  this,
                  this.elements.display.currentTime,
                  t ? this.duration - this.currentTime : this.currentTime,
                  t
                ),
                  (e && "timeupdate" === e.type && this.media.seeking) ||
                    Ye.updateProgress.call(this, e);
              },
              durationUpdate() {
                if (
                  this.supported.ui &&
                  (this.config.invertTime || !this.currentTime)
                ) {
                  if (this.duration >= Math.pow(2, 32))
                    return (
                      le(this.elements.display.currentTime, !0),
                      void le(this.elements.progress, !0)
                    );
                  U(this.elements.inputs.seek) &&
                    this.elements.inputs.seek.setAttribute(
                      "aria-valuemax",
                      this.duration
                    );
                  var e = U(this.elements.display.duration);
                  !e &&
                    this.config.displayDuration &&
                    this.paused &&
                    Ye.updateTimeDisplay.call(
                      this,
                      this.elements.display.currentTime,
                      this.duration
                    ),
                    e &&
                      Ye.updateTimeDisplay.call(
                        this,
                        this.elements.display.duration,
                        this.duration
                      ),
                    this.config.markers.enabled && Ye.setMarkers.call(this),
                    Ye.updateSeekTooltip.call(this);
                }
              },
              toggleMenuButton(e, t) {
                le(this.elements.settings.buttons[e], !t);
              },
              updateSetting(e, t, n) {
                var i = this.elements.settings.panels[e],
                  a = null,
                  r = t;
                if ("captions" === e) a = this.currentTrack;
                else {
                  if (
                    ((a = $(n) ? this[e] : n),
                    $(a) && (a = this.config[e].default),
                    !$(this.options[e]) && !this.options[e].includes(a))
                  )
                    return void this.debug.warn(
                      "Unsupported value of '".concat(a, "' for ").concat(e)
                    );
                  if (!this.config[e].options.includes(a))
                    return void this.debug.warn(
                      "Disabled value of '".concat(a, "' for ").concat(e)
                    );
                }
                if (
                  (U(r) || (r = i && i.querySelector('[role="menu"]')), U(r))
                ) {
                  this.elements.settings.buttons[e].querySelector(
                    ".".concat(this.config.classNames.menu.value)
                  ).innerHTML = Ye.getLabel.call(this, e, a);
                  var s = r && r.querySelector('[value="'.concat(a, '"]'));
                  U(s) && (s.checked = !0);
                }
              },
              getLabel(e, t) {
                switch (e) {
                  case "speed":
                    return 1 === t
                      ? Ve.get("normal", this.config)
                      : "".concat(t, "&times;");
                  case "quality":
                    if (D(t)) {
                      var n = Ve.get("qualityLabel.".concat(t), this.config);
                      return n.length ? n : "".concat(t, "p");
                    }
                    return He(t);
                  case "captions":
                    return Xe.getLabel.call(this);
                  default:
                    return null;
                }
              },
              setQualityMenu(e) {
                var t = this;
                if (U(this.elements.settings.panels.quality)) {
                  var n = "quality",
                    i =
                      this.elements.settings.panels.quality.querySelector(
                        '[role="menu"]'
                      );
                  V(e) &&
                    (this.options.quality = Ee(e).filter(function (e) {
                      return t.config.quality.options.includes(e);
                    }));
                  var a =
                    !$(this.options.quality) && this.options.quality.length > 1;
                  if (
                    (Ye.toggleMenuButton.call(this, n, a),
                    re(i),
                    Ye.checkMenu.call(this),
                    a)
                  ) {
                    var r = function (e) {
                      var n = Ve.get("qualityBadge.".concat(e), t.config);
                      return n.length ? Ye.createBadge.call(t, n) : null;
                    };
                    this.options.quality
                      .sort(function (e, n) {
                        var i = t.config.quality.options;
                        return i.indexOf(e) > i.indexOf(n) ? 1 : -1;
                      })
                      .forEach(function (e) {
                        Ye.createMenuItem.call(t, {
                          value: e,
                          list: i,
                          type: n,
                          title: Ye.getLabel.call(t, "quality", e),
                          badge: r(e),
                        });
                      }),
                      Ye.updateSetting.call(this, n, i);
                  }
                }
              },
              setCaptionsMenu() {
                var e = this;
                if (U(this.elements.settings.panels.captions)) {
                  var t = "captions",
                    n =
                      this.elements.settings.panels.captions.querySelector(
                        '[role="menu"]'
                      ),
                    i = Xe.getTracks.call(this),
                    a = Boolean(i.length);
                  if (
                    (Ye.toggleMenuButton.call(this, t, a),
                    re(n),
                    Ye.checkMenu.call(this),
                    a)
                  ) {
                    var r = i.map(function (t, i) {
                      return {
                        value: i,
                        checked: e.captions.toggled && e.currentTrack === i,
                        title: Xe.getLabel.call(e, t),
                        badge:
                          t.language &&
                          Ye.createBadge.call(e, t.language.toUpperCase()),
                        list: n,
                        type: "language",
                      };
                    });
                    r.unshift({
                      value: -1,
                      checked: !this.captions.toggled,
                      title: Ve.get("disabled", this.config),
                      list: n,
                      type: "language",
                    }),
                      r.forEach(Ye.createMenuItem.bind(this)),
                      Ye.updateSetting.call(this, t, n);
                  }
                }
              },
              setSpeedMenu() {
                var e = this;
                if (U(this.elements.settings.panels.speed)) {
                  var t = "speed",
                    n =
                      this.elements.settings.panels.speed.querySelector(
                        '[role="menu"]'
                      );
                  this.options.speed = this.options.speed.filter(function (t) {
                    return t >= e.minimumSpeed && t <= e.maximumSpeed;
                  });
                  var i =
                    !$(this.options.speed) && this.options.speed.length > 1;
                  Ye.toggleMenuButton.call(this, t, i),
                    re(n),
                    Ye.checkMenu.call(this),
                    i &&
                      (this.options.speed.forEach(function (i) {
                        Ye.createMenuItem.call(e, {
                          value: i,
                          list: n,
                          type: t,
                          title: Ye.getLabel.call(e, "speed", i),
                        });
                      }),
                      Ye.updateSetting.call(this, t, n));
                }
              },
              checkMenu() {
                var e = this.elements.settings.buttons,
                  t =
                    !$(e) &&
                    Object.values(e).some(function (e) {
                      return !e.hidden;
                    });
                le(this.elements.settings.menu, !t);
              },
              focusFirstMenuItem(e) {
                var t =
                  arguments.length > 1 &&
                  void 0 !== arguments[1] &&
                  arguments[1];
                if (!this.elements.settings.popup.hidden) {
                  var n = e;
                  U(n) ||
                    (n = Object.values(this.elements.settings.panels).find(
                      function (e) {
                        return !e.hidden;
                      }
                    ));
                  var i = n.querySelector('[role^="menuitem"]');
                  me.call(this, i, t);
                }
              },
              toggleMenu(e) {
                var t = this.elements.settings.popup,
                  n = this.elements.buttons.settings;
                if (U(t) && U(n)) {
                  var i = t.hidden,
                    a = i;
                  if (F(e)) a = e;
                  else if (z(e) && "Escape" === e.key) a = !1;
                  else if (W(e)) {
                    var r = R(e.composedPath) ? e.composedPath()[0] : e.target,
                      s = t.contains(r);
                    if (s || (!s && e.target !== n && a)) return;
                  }
                  n.setAttribute("aria-expanded", a),
                    le(t, !a),
                    ce(
                      this.elements.container,
                      this.config.classNames.menu.open,
                      a
                    ),
                    a && z(e)
                      ? Ye.focusFirstMenuItem.call(this, null, !0)
                      : a || i || me.call(this, n, z(e));
                }
              },
              getMenuSize(e) {
                var t = e.cloneNode(!0);
                (t.style.position = "absolute"),
                  (t.style.opacity = 0),
                  t.removeAttribute("hidden"),
                  e.parentNode.appendChild(t);
                var n = t.scrollWidth,
                  i = t.scrollHeight;
                return ae(t), { width: n, height: i };
              },
              showMenuPanel() {
                var e = this,
                  t =
                    arguments.length > 0 && void 0 !== arguments[0]
                      ? arguments[0]
                      : "",
                  n =
                    arguments.length > 1 &&
                    void 0 !== arguments[1] &&
                    arguments[1],
                  i = this.elements.container.querySelector(
                    "#plyr-settings-".concat(this.id, "-").concat(t)
                  );
                if (U(i)) {
                  var a = i.parentNode,
                    r = Array.from(a.children).find(function (e) {
                      return !e.hidden;
                    });
                  if (ge.transitions && !ge.reducedMotion) {
                    (a.style.width = "".concat(r.scrollWidth, "px")),
                      (a.style.height = "".concat(r.scrollHeight, "px"));
                    var s = Ye.getMenuSize.call(this, i);
                    be.call(this, a, Q, function t(n) {
                      n.target === a &&
                        ["width", "height"].includes(n.propertyName) &&
                        ((a.style.width = ""),
                        (a.style.height = ""),
                        we.call(e, a, Q, t));
                    }),
                      (a.style.width = "".concat(s.width, "px")),
                      (a.style.height = "".concat(s.height, "px"));
                  }
                  le(r, !0), le(i, !1), Ye.focusFirstMenuItem.call(this, i, n);
                }
              },
              setDownloadUrl() {
                var e = this.elements.buttons.download;
                U(e) && e.setAttribute("href", this.download);
              },
              create(e) {
                var t = this,
                  n = Ye.bindMenuItemShortcuts,
                  i = Ye.createButton,
                  a = Ye.createProgress,
                  r = Ye.createRange,
                  s = Ye.createTime,
                  o = Ye.setQualityMenu,
                  l = Ye.setSpeedMenu,
                  c = Ye.showMenuPanel;
                (this.elements.controls = null),
                  V(this.config.controls) &&
                    this.config.controls.includes("play-large") &&
                    this.elements.container.appendChild(
                      i.call(this, "play-large")
                    );
                var u = ne("div", oe(this.config.selectors.controls.wrapper));
                this.elements.controls = u;
                var d = { class: "plyr__controls__item" };
                return (
                  Ee(
                    V(this.config.controls) ? this.config.controls : []
                  ).forEach(function (o) {
                    if (
                      ("restart" === o &&
                        u.appendChild(i.call(t, "restart", d)),
                      "rewind" === o && u.appendChild(i.call(t, "rewind", d)),
                      "play" === o && u.appendChild(i.call(t, "play", d)),
                      "fast-forward" === o &&
                        u.appendChild(i.call(t, "fast-forward", d)),
                      "progress" === o)
                    ) {
                      var l = ne("div", {
                          class: "".concat(
                            d.class,
                            " plyr__progress__container"
                          ),
                        }),
                        h = ne("div", oe(t.config.selectors.progress));
                      if (
                        (h.appendChild(
                          r.call(t, "seek", { id: "plyr-seek-".concat(e.id) })
                        ),
                        h.appendChild(a.call(t, "buffer")),
                        t.config.tooltips.seek)
                      ) {
                        var p = ne(
                          "span",
                          { class: t.config.classNames.tooltip },
                          "00:00"
                        );
                        h.appendChild(p), (t.elements.display.seekTooltip = p);
                      }
                      (t.elements.progress = h),
                        l.appendChild(t.elements.progress),
                        u.appendChild(l);
                    }
                    if (
                      ("current-time" === o &&
                        u.appendChild(s.call(t, "currentTime", d)),
                      "duration" === o &&
                        u.appendChild(s.call(t, "duration", d)),
                      "mute" === o || "volume" === o)
                    ) {
                      var m = t.elements.volume;
                      if (
                        ((U(m) && u.contains(m)) ||
                          ((m = ne(
                            "div",
                            Z({}, d, {
                              class: "".concat(d.class, " plyr__volume").trim(),
                            })
                          )),
                          (t.elements.volume = m),
                          u.appendChild(m)),
                        "mute" === o && m.appendChild(i.call(t, "mute")),
                        "volume" === o && !J.isIos)
                      ) {
                        var f = { max: 1, step: 0.05, value: t.config.volume };
                        m.appendChild(
                          r.call(
                            t,
                            "volume",
                            Z(f, { id: "plyr-volume-".concat(e.id) })
                          )
                        );
                      }
                    }
                    if (
                      ("captions" === o &&
                        u.appendChild(i.call(t, "captions", d)),
                      "settings" === o && !$(t.config.settings))
                    ) {
                      var g = ne(
                        "div",
                        Z({}, d, {
                          class: "".concat(d.class, " plyr__menu").trim(),
                          hidden: "",
                        })
                      );
                      g.appendChild(
                        i.call(t, "settings", {
                          "aria-haspopup": !0,
                          "aria-controls": "plyr-settings-".concat(e.id),
                          "aria-expanded": !1,
                        })
                      );
                      var y = ne("div", {
                          class: "plyr__menu__container",
                          id: "plyr-settings-".concat(e.id),
                          hidden: "",
                        }),
                        v = ne("div"),
                        b = ne("div", {
                          id: "plyr-settings-".concat(e.id, "-home"),
                        }),
                        w = ne("div", { role: "menu" });
                      b.appendChild(w),
                        v.appendChild(b),
                        (t.elements.settings.panels.home = b),
                        t.config.settings.forEach(function (i) {
                          var a = ne(
                            "button",
                            Z(oe(t.config.selectors.buttons.settings), {
                              type: "button",
                              class: ""
                                .concat(t.config.classNames.control, " ")
                                .concat(
                                  t.config.classNames.control,
                                  "--forward"
                                ),
                              role: "menuitem",
                              "aria-haspopup": !0,
                              hidden: "",
                            })
                          );
                          n.call(t, a, i),
                            be.call(t, a, "click", function () {
                              c.call(t, i, !1);
                            });
                          var r = ne("span", null, Ve.get(i, t.config)),
                            s = ne("span", {
                              class: t.config.classNames.menu.value,
                            });
                          (s.innerHTML = e[i]),
                            r.appendChild(s),
                            a.appendChild(r),
                            w.appendChild(a);
                          var o = ne("div", {
                              id: "plyr-settings-".concat(e.id, "-").concat(i),
                              hidden: "",
                            }),
                            l = ne("button", {
                              type: "button",
                              class: ""
                                .concat(t.config.classNames.control, " ")
                                .concat(t.config.classNames.control, "--back"),
                            });
                          l.appendChild(
                            ne(
                              "span",
                              { "aria-hidden": !0 },
                              Ve.get(i, t.config)
                            )
                          ),
                            l.appendChild(
                              ne(
                                "span",
                                { class: t.config.classNames.hidden },
                                Ve.get("menuBack", t.config)
                              )
                            ),
                            be.call(
                              t,
                              o,
                              "keydown",
                              function (e) {
                                "ArrowLeft" === e.key &&
                                  (e.preventDefault(),
                                  e.stopPropagation(),
                                  c.call(t, "home", !0));
                              },
                              !1
                            ),
                            be.call(t, l, "click", function () {
                              c.call(t, "home", !1);
                            }),
                            o.appendChild(l),
                            o.appendChild(ne("div", { role: "menu" })),
                            v.appendChild(o),
                            (t.elements.settings.buttons[i] = a),
                            (t.elements.settings.panels[i] = o);
                        }),
                        y.appendChild(v),
                        g.appendChild(y),
                        u.appendChild(g),
                        (t.elements.settings.popup = y),
                        (t.elements.settings.menu = g);
                    }
                    if (
                      ("pip" === o &&
                        ge.pip &&
                        u.appendChild(i.call(t, "pip", d)),
                      "airplay" === o &&
                        ge.airplay &&
                        u.appendChild(i.call(t, "airplay", d)),
                      "download" === o)
                    ) {
                      var k = Z({}, d, {
                        element: "a",
                        href: t.download,
                        target: "_blank",
                      });
                      t.isHTML5 && (k.download = "");
                      var T = t.config.urls.download;
                      !Y(T) &&
                        t.isEmbed &&
                        Z(k, {
                          icon: "logo-".concat(t.provider),
                          label: t.provider,
                        }),
                        u.appendChild(i.call(t, "download", k));
                    }
                    "fullscreen" === o &&
                      u.appendChild(i.call(t, "fullscreen", d));
                  }),
                  this.isHTML5 && o.call(this, Oe.getQualityOptions.call(this)),
                  l.call(this),
                  u
                );
              },
              inject() {
                var e = this;
                if (this.config.loadSprite) {
                  var t = Ye.getIconUrl.call(this);
                  t.cors && We(t.url, "sprite-plyr");
                }
                this.id = Math.floor(1e4 * Math.random());
                var n = null;
                this.elements.controls = null;
                var i,
                  a = {
                    id: this.id,
                    seektime: this.config.seekTime,
                    title: this.config.title,
                  },
                  r = !0;
                if (
                  (R(this.config.controls) &&
                    (this.config.controls = this.config.controls.call(this, a)),
                  this.config.controls || (this.config.controls = []),
                  U(this.config.controls) || H(this.config.controls)
                    ? (n = this.config.controls)
                    : ((n = Ye.create.call(this, {
                        id: this.id,
                        seektime: this.config.seekTime,
                        speed: this.speed,
                        quality: this.quality,
                        captions: Xe.getLabel.call(this),
                      })),
                      (r = !1)),
                  r &&
                    H(this.config.controls) &&
                    (n = (function (e) {
                      var t = e;
                      return (
                        Object.entries(a).forEach(function (e) {
                          var n = d(e, 2),
                            i = n[0],
                            a = n[1];
                          t = De(t, "{".concat(i, "}"), a);
                        }),
                        t
                      );
                    })(n)),
                  H(this.config.selectors.controls.container) &&
                    (i = document.querySelector(
                      this.config.selectors.controls.container
                    )),
                  U(i) || (i = this.elements.container),
                  i[U(n) ? "insertAdjacentElement" : "insertAdjacentHTML"](
                    "afterbegin",
                    n
                  ),
                  U(this.elements.controls) || Ye.findElements.call(this),
                  !$(this.elements.buttons))
                ) {
                  var s = function (t) {
                    var n = e.config.classNames.controlPressed;
                    Object.defineProperty(t, "pressed", {
                      enumerable: !0,
                      get: function () {
                        return ue(t, n);
                      },
                      set() {
                        ce(
                          t,
                          n,
                          arguments.length > 0 &&
                            void 0 !== arguments[0] &&
                            arguments[0]
                        );
                      },
                    });
                  };
                  Object.values(this.elements.buttons)
                    .filter(Boolean)
                    .forEach(function (e) {
                      V(e) || B(e)
                        ? Array.from(e).filter(Boolean).forEach(s)
                        : s(e);
                    });
                }
                if ((J.isEdge && X(i), this.config.tooltips.controls)) {
                  var o = this.config,
                    l = o.classNames,
                    c = o.selectors,
                    u = ""
                      .concat(c.controls.wrapper, " ")
                      .concat(c.labels, " .")
                      .concat(l.hidden),
                    h = he.call(this, u);
                  Array.from(h).forEach(function (t) {
                    ce(t, e.config.classNames.hidden, !1),
                      ce(t, e.config.classNames.tooltip, !0);
                  });
                }
              },
              setMediaMetadata() {
                try {
                  "mediaSession" in navigator &&
                    (navigator.mediaSession.metadata = new window.MediaMetadata(
                      {
                        title: this.config.mediaMetadata.title,
                        artist: this.config.mediaMetadata.artist,
                        album: this.config.mediaMetadata.album,
                        artwork: this.config.mediaMetadata.artwork,
                      }
                    ));
                } catch (e) {}
              },
              setMarkers() {
                var e,
                  t,
                  n = this;
                if (this.duration && !this.elements.markers) {
                  var i =
                    null === (e = this.config.markers) ||
                    void 0 === e ||
                    null === (t = e.points) ||
                    void 0 === t
                      ? void 0
                      : t.filter(function (e) {
                          var t = e.time;
                          return t > 0 && t < n.duration;
                        });
                  if (null != i && i.length) {
                    var a = document.createDocumentFragment(),
                      r = document.createDocumentFragment(),
                      s = null,
                      o = "".concat(
                        this.config.classNames.tooltip,
                        "--visible"
                      ),
                      l = function (e) {
                        return ce(s, o, e);
                      };
                    i.forEach(function (e) {
                      var t = ne(
                          "span",
                          { class: n.config.classNames.marker },
                          ""
                        ),
                        i = (e.time / n.duration) * 100 + "%";
                      s &&
                        (t.addEventListener("mouseenter", function () {
                          e.label ||
                            ((s.style.left = i),
                            (s.innerHTML = e.label),
                            l(!0));
                        }),
                        t.addEventListener("mouseleave", function () {
                          l(!1);
                        })),
                        t.addEventListener("click", function () {
                          n.currentTime = e.time;
                        }),
                        (t.style.left = i),
                        r.appendChild(t);
                    }),
                      a.appendChild(r),
                      this.config.tooltips.seek ||
                        ((s = ne(
                          "span",
                          { class: this.config.classNames.tooltip },
                          ""
                        )),
                        a.appendChild(s)),
                      (this.elements.markers = { points: r, tip: s }),
                      this.elements.progress.appendChild(a);
                  }
                }
              },
            };
            function $e(e) {
              var t = e;
              if (
                !(arguments.length > 1 && void 0 !== arguments[1]) ||
                arguments[1]
              ) {
                var n = document.createElement("a");
                (n.href = t), (t = n.href);
              }
              try {
                return new URL(t);
              } catch (e) {
                return null;
              }
            }
            function Qe(e) {
              var t = new URLSearchParams();
              return (
                q(e) &&
                  Object.entries(e).forEach(function (e) {
                    var n = d(e, 2),
                      i = n[0],
                      a = n[1];
                    t.set(i, a);
                  }),
                t
              );
            }
            var Xe = {
                setup() {
                  if (this.supported.ui)
                    if (
                      !this.isVideo ||
                      this.isYouTube ||
                      (this.isHTML5 && !ge.textTracks)
                    )
                      V(this.config.controls) &&
                        this.config.controls.includes("settings") &&
                        this.config.settings.includes("captions") &&
                        Ye.setCaptionsMenu.call(this);
                    else {
                      var e, t;
                      if (
                        (U(this.elements.captions) ||
                          ((this.elements.captions = ne(
                            "div",
                            oe(this.config.selectors.captions)
                          )),
                          (e = this.elements.captions),
                          (t = this.elements.wrapper),
                          U(e) &&
                            U(t) &&
                            t.parentNode.insertBefore(e, t.nextSibling)),
                        J.isIE && window.URL)
                      ) {
                        var n = this.media.querySelectorAll("track");
                        Array.from(n).forEach(function (e) {
                          var t = e.getAttribute("src"),
                            n = $e(t);
                          null !== n &&
                            n.hostname !== window.location.href.hostname &&
                            ["http:", "https:"].includes(n.protocol) &&
                            Ue(t, "blob")
                              .then(function (t) {
                                e.setAttribute(
                                  "src",
                                  window.URL.createObjectURL(t)
                                );
                              })
                              .catch(function () {
                                ae(e);
                              });
                        });
                      }
                      var i = Ee(
                          (
                            navigator.languages || [
                              navigator.language ||
                                navigator.userLanguage ||
                                "en",
                            ]
                          ).map(function (e) {
                            return e.split("-")[0];
                          })
                        ),
                        a = (
                          this.storage.get("language") ||
                          this.config.captions.language ||
                          "auto"
                        ).toLowerCase();
                      "auto" === a && (a = d(i, 1)[0]);
                      var r = this.storage.get("captions");
                      if (
                        (F(r) || (r = this.config.captions.active),
                        Object.assign(this.captions, {
                          toggled: !1,
                          active: r,
                          language: a,
                          languages: i,
                        }),
                        this.isHTML5)
                      ) {
                        var s = this.config.captions.update
                          ? "addtrack removetrack"
                          : "removetrack";
                        be.call(
                          this,
                          this.media.textTracks,
                          s,
                          Xe.update.bind(this)
                        );
                      }
                      setTimeout(Xe.update.bind(this), 0);
                    }
                },
                update() {
                  var e = this,
                    t = Xe.getTracks.call(this, !0),
                    n = this.captions,
                    i = n.active,
                    a = n.language,
                    r = n.meta,
                    s = n.currentTrackNode,
                    o = Boolean(
                      t.find(function (e) {
                        return e.language === a;
                      })
                    );
                  this.isHTML5 &&
                    this.isVideo &&
                    t
                      .filter(function (e) {
                        return !r.get(e);
                      })
                      .forEach(function (t) {
                        e.debug.log("Track added", t),
                          r.set(t, { default: "showing" === t.mode }),
                          "showing" === t.mode && (t.mode = "hidden"),
                          be.call(e, t, "cuechange", function () {
                            return Xe.updateCues.call(e);
                          });
                      }),
                    ((o && this.language !== a) || !t.includes(s)) &&
                      (Xe.setLanguage.call(this, a),
                      Xe.toggle.call(this, i && o)),
                    this.elements &&
                      ce(
                        this.elements.container,
                        this.config.classNames.captions.enabled,
                        !$(t)
                      ),
                    V(this.config.controls) &&
                      this.config.controls.includes("settings") &&
                      this.config.settings.includes("captions") &&
                      Ye.setCaptionsMenu.call(this);
                },
                toggle(e) {
                  var t = this,
                    n =
                      !(arguments.length > 1 && void 0 !== arguments[1]) ||
                      arguments[1];
                  if (this.supported.ui) {
                    var i = this.captions.toggled,
                      r = this.config.classNames.captions.active,
                      s = O(e) ? !i : e;
                    if (s !== i) {
                      if (
                        (n ||
                          ((this.captions.active = s),
                          this.storage.set({ captions: s })),
                        !this.language && s && !n)
                      ) {
                        var o = Xe.getTracks.call(this),
                          l = Xe.findTrack.call(
                            this,
                            [this.captions.language].concat(
                              a(this.captions.languages)
                            ),
                            !0
                          );
                        return (
                          (this.captions.language = l.language),
                          void Xe.set.call(this, o.indexOf(l))
                        );
                      }
                      this.elements.buttons.captions &&
                        (this.elements.buttons.captions.pressed = s),
                        ce(this.elements.container, r, s),
                        (this.captions.toggled = s),
                        Ye.updateSetting.call(this, "captions"),
                        Te.call(
                          this,
                          this.media,
                          s ? "captionsenabled" : "captionsdisabled"
                        );
                    }
                    setTimeout(function () {
                      s &&
                        t.captions.toggled &&
                        (t.captions.currentTrackNode.mode = "hidden");
                    });
                  }
                },
                set(e) {
                  var t =
                      !(arguments.length > 1 && void 0 !== arguments[1]) ||
                      arguments[1],
                    n = Xe.getTracks.call(this);
                  if (-1 !== e)
                    if (D(e))
                      if (e in n) {
                        if (this.captions.currentTrack !== e) {
                          this.captions.currentTrack = e;
                          var i = n[e],
                            a = (i || {}).language;
                          (this.captions.currentTrackNode = i),
                            Ye.updateSetting.call(this, "captions"),
                            t ||
                              ((this.captions.language = a),
                              this.storage.set({ language: a })),
                            this.isVimeo && this.embed.enableTextTrack(a),
                            Te.call(this, this.media, "languagechange");
                        }
                        Xe.toggle.call(this, !0, t),
                          this.isHTML5 &&
                            this.isVideo &&
                            Xe.updateCues.call(this);
                      } else this.debug.warn("Track not found", e);
                    else this.debug.warn("Invalid caption argument", e);
                  else Xe.toggle.call(this, !1, t);
                },
                setLanguage(e) {
                  var t =
                    !(arguments.length > 1 && void 0 !== arguments[1]) ||
                    arguments[1];
                  if (H(e)) {
                    var n = e.toLowerCase();
                    this.captions.language = n;
                    var i = Xe.getTracks.call(this),
                      a = Xe.findTrack.call(this, [n]);
                    Xe.set.call(this, i.indexOf(a), t);
                  } else this.debug.warn("Invalid language argument", e);
                },
                getTracks() {
                  var e = this,
                    t =
                      arguments.length > 0 &&
                      void 0 !== arguments[0] &&
                      arguments[0];
                  return Array.from((this.media || {}).textTracks || [])
                    .filter(function (n) {
                      return !e.isHTML5 || t || e.captions.meta.has(n);
                    })
                    .filter(function (e) {
                      return ["captions", "subtitles"].includes(e.kind);
                    });
                },
                findTrack(e) {
                  var t,
                    n = this,
                    i =
                      arguments.length > 1 &&
                      void 0 !== arguments[1] &&
                      arguments[1],
                    a = Xe.getTracks.call(this),
                    r = function (e) {
                      return Number((n.captions.meta.get(e) || {}).default);
                    },
                    s = Array.from(a).sort(function (e, t) {
                      return r(t) - r(e);
                    });
                  return (
                    e.every(function (e) {
                      return (
                        (t = s.find(function (t) {
                          return t.language === e;
                        })),
                        !t
                      );
                    }),
                    t || (i ? s[0] : void 0)
                  );
                },
                getCurrentTrack() {
                  return Xe.getTracks.call(this)[this.currentTrack];
                },
                getLabel(e) {
                  var t = e;
                  return (
                    !K(t) &&
                      ge.textTracks &&
                      this.captions.toggled &&
                      (t = Xe.getCurrentTrack.call(this)),
                    K(t)
                      ? $(t.label)
                        ? $(t.language)
                          ? Ve.get("enabled", this.config)
                          : e.language.toUpperCase()
                        : t.label
                      : Ve.get("disabled", this.config)
                  );
                },
                updateCues(e) {
                  if (this.supported.ui)
                    if (U(this.elements.captions))
                      if (O(e) || Array.isArray(e)) {
                        var t = e;
                        if (!t) {
                          var n = Xe.getCurrentTrack.call(this);
                          t = Array.from((n || {}).activeCues || [])
                            .map(function (e) {
                              return e.getCueAsHTML();
                            })
                            .map(Fe);
                        }
                        var i = t
                          .map(function (e) {
                            return e.trim();
                          })
                          .join("\n");
                        if (i !== this.elements.captions.innerHTML) {
                          re(this.elements.captions);
                          var a = ne("span", oe(this.config.selectors.caption));
                          (a.innerHTML = i),
                            this.elements.captions.appendChild(a),
                            Te.call(this, this.media, "cuechange");
                        }
                      } else this.debug.warn("updateCues: Invalid input", e);
                    else this.debug.warn("No captions element to render to");
                },
              },
              Je = {
                enabled: !0,
                title: "",
                debug: !1,
                autoplay: !1,
                autopause: !0,
                playsinline: !0,
                seekTime: 10,
                volume: 1,
                muted: !1,
                duration: null,
                displayDuration: !0,
                invertTime: !0,
                toggleInvert: !0,
                ratio: null,
                clickToPlay: !0,
                hideControls: !0,
                resetOnEnd: !1,
                disableContextMenu: !0,
                loadSprite: !0,
                iconPrefix: "plyr",
                iconUrl: "https://cdn.plyr.io/3.7.2/plyr.svg",
                blankVideo: "https://cdn.plyr.io/static/blank.mp4",
                quality: {
                  default: 576,
                  options: [
                    4320, 2880, 2160, 1440, 1080, 720, 576, 480, 360, 240,
                  ],
                  forced: !1,
                  onChange: null,
                },
                loop: { active: !1 },
                speed: {
                  selected: 1,
                  options: [0.5, 0.75, 1, 1.25, 1.5, 1.75, 2, 4],
                },
                keyboard: { focused: !0, global: !1 },
                tooltips: { controls: !1, seek: !0 },
                captions: { active: !1, language: "auto", update: !1 },
                fullscreen: { enabled: !0, fallback: !0, iosNative: !1 },
                storage: { enabled: !0, key: "plyr" },
                controls: [
                  "play-large",
                  "play",
                  "progress",
                  "current-time",
                  "mute",
                  "volume",
                  "captions",
                  "settings",
                  "pip",
                  "airplay",
                  "fullscreen",
                ],
                settings: ["captions", "quality", "speed"],
                i18n: {
                  restart: "Restart",
                  rewind: "Rewind {seektime}s",
                  play: "Play",
                  pause: "Pause",
                  fastForward: "Forward {seektime}s",
                  seek: "Seek",
                  seekLabel: "{currentTime} of {duration}",
                  played: "Played",
                  buffered: "Buffered",
                  currentTime: "Current time",
                  duration: "Duration",
                  volume: "Volume",
                  mute: "Mute",
                  unmute: "Unmute",
                  enableCaptions: "Enable captions",
                  disableCaptions: "Disable captions",
                  download: "Download",
                  enterFullscreen: "Enter fullscreen",
                  exitFullscreen: "Exit fullscreen",
                  frameTitle: "Player for {title}",
                  captions: "Captions",
                  settings: "Settings",
                  pip: "PIP",
                  menuBack: "Go back to previous menu",
                  speed: "Speed",
                  normal: "Normal",
                  quality: "Quality",
                  loop: "Loop",
                  start: "Start",
                  end: "End",
                  all: "All",
                  reset: "Reset",
                  disabled: "Disabled",
                  enabled: "Enabled",
                  advertisement: "Ad",
                  qualityBadge: {
                    2160: "4K",
                    1440: "HD",
                    1080: "HD",
                    720: "HD",
                    576: "SD",
                    480: "SD",
                  },
                },
                urls: {
                  download: null,
                  vimeo: {
                    sdk: "https://player.vimeo.com/api/player.js",
                    iframe: "https://player.vimeo.com/video/{0}?{1}",
                    api: "https://vimeo.com/api/oembed.json?url={0}",
                  },
                  youtube: {
                    sdk: "https://www.youtube.com/iframe_api",
                    api: "https://noembed.com/embed?url=https://www.youtube.com/watch?v={0}",
                  },
                  googleIMA: {
                    sdk: "https://imasdk.googleapis.com/js/sdkloader/ima3.js",
                  },
                },
                listeners: {
                  seek: null,
                  play: null,
                  pause: null,
                  restart: null,
                  rewind: null,
                  fastForward: null,
                  mute: null,
                  volume: null,
                  captions: null,
                  download: null,
                  fullscreen: null,
                  pip: null,
                  airplay: null,
                  speed: null,
                  quality: null,
                  loop: null,
                  language: null,
                },
                events: [
                  "ended",
                  "progress",
                  "stalled",
                  "playing",
                  "waiting",
                  "canplay",
                  "canplaythrough",
                  "loadstart",
                  "loadeddata",
                  "loadedmetadata",
                  "timeupdate",
                  "volumechange",
                  "play",
                  "pause",
                  "error",
                  "seeking",
                  "seeked",
                  "emptied",
                  "ratechange",
                  "cuechange",
                  "download",
                  "enterfullscreen",
                  "exitfullscreen",
                  "captionsenabled",
                  "captionsdisabled",
                  "languagechange",
                  "controlshidden",
                  "controlsshown",
                  "ready",
                  "statechange",
                  "qualitychange",
                  "adsloaded",
                  "adscontentpause",
                  "adscontentresume",
                  "adstarted",
                  "adsmidpoint",
                  "adscomplete",
                  "adsallcomplete",
                  "adsimpression",
                  "adsclick",
                ],
                selectors: {
                  editable: "input, textarea, select, [contenteditable]",
                  container: ".plyr",
                  controls: { container: null, wrapper: ".plyr__controls" },
                  labels: "[data-plyr]",
                  buttons: {
                    play: '[data-plyr="play"]',
                    pause: '[data-plyr="pause"]',
                    restart: '[data-plyr="restart"]',
                    rewind: '[data-plyr="rewind"]',
                    fastForward: '[data-plyr="fast-forward"]',
                    mute: '[data-plyr="mute"]',
                    captions: '[data-plyr="captions"]',
                    download: '[data-plyr="download"]',
                    fullscreen: '[data-plyr="fullscreen"]',
                    pip: '[data-plyr="pip"]',
                    airplay: '[data-plyr="airplay"]',
                    settings: '[data-plyr="settings"]',
                    loop: '[data-plyr="loop"]',
                  },
                  inputs: {
                    seek: '[data-plyr="seek"]',
                    volume: '[data-plyr="volume"]',
                    speed: '[data-plyr="speed"]',
                    language: '[data-plyr="language"]',
                    quality: '[data-plyr="quality"]',
                  },
                  display: {
                    currentTime: ".plyr__time--current",
                    duration: ".plyr__time--duration",
                    buffer: ".plyr__progress__buffer",
                    loop: ".plyr__progress__loop",
                    volume: ".plyr__volume--display",
                  },
                  progress: ".plyr__progress",
                  captions: ".plyr__captions",
                  caption: ".plyr__caption",
                },
                classNames: {
                  type: "plyr--{0}",
                  provider: "plyr--{0}",
                  video: "plyr__video-wrapper",
                  embed: "plyr__video-embed",
                  videoFixedRatio: "plyr__video-wrapper--fixed-ratio",
                  embedContainer: "plyr__video-embed__container",
                  poster: "plyr__poster",
                  posterEnabled: "plyr__poster-enabled",
                  ads: "plyr__ads",
                  control: "plyr__control",
                  controlPressed: "plyr__control--pressed",
                  playing: "plyr--playing",
                  paused: "plyr--paused",
                  stopped: "plyr--stopped",
                  loading: "plyr--loading",
                  hover: "plyr--hover",
                  tooltip: "plyr__tooltip",
                  cues: "plyr__cues",
                  marker: "plyr__progress__marker",
                  hidden: "plyr__sr-only",
                  hideControls: "plyr--hide-controls",
                  isIos: "plyr--is-ios",
                  isTouch: "plyr--is-touch",
                  uiSupported: "plyr--full-ui",
                  noTransition: "plyr--no-transition",
                  display: { time: "plyr__time" },
                  menu: {
                    value: "plyr__menu__value",
                    badge: "plyr__badge",
                    open: "plyr--menu-open",
                  },
                  captions: {
                    enabled: "plyr--captions-enabled",
                    active: "plyr--captions-active",
                  },
                  fullscreen: {
                    enabled: "plyr--fullscreen-enabled",
                    fallback: "plyr--fullscreen-fallback",
                  },
                  pip: {
                    supported: "plyr--pip-supported",
                    active: "plyr--pip-active",
                  },
                  airplay: {
                    supported: "plyr--airplay-supported",
                    active: "plyr--airplay-active",
                  },
                  tabFocus: "plyr__tab-focus",
                  previewThumbnails: {
                    thumbContainer: "plyr__preview-thumb",
                    thumbContainerShown: "plyr__preview-thumb--is-shown",
                    imageContainer: "plyr__preview-thumb__image-container",
                    timeContainer: "plyr__preview-thumb__time-container",
                    scrubbingContainer: "plyr__preview-scrubbing",
                    scrubbingContainerShown:
                      "plyr__preview-scrubbing--is-shown",
                  },
                },
                attributes: {
                  embed: {
                    provider: "data-plyr-provider",
                    id: "data-plyr-embed-id",
                    hash: "data-plyr-embed-hash",
                  },
                },
                ads: { enabled: !1, publisherId: "", tagUrl: "" },
                previewThumbnails: { enabled: !1, src: "" },
                vimeo: {
                  byline: !1,
                  portrait: !1,
                  title: !1,
                  speed: !0,
                  transparent: !1,
                  customControls: !0,
                  referrerPolicy: null,
                  premium: !1,
                },
                youtube: {
                  rel: 0,
                  showinfo: 0,
                  iv_load_policy: 3,
                  modestbranding: 1,
                  customControls: !0,
                  noCookie: !1,
                },
                mediaMetadata: {
                  title: "",
                  artist: "",
                  album: "",
                  artwork: [],
                },
                markers: { enabled: !1, points: [] },
              },
              Ge = "picture-in-picture",
              Ze = { html5: "html5", youtube: "youtube", vimeo: "vimeo" },
              et = "video",
              tt = function () {},
              nt = (function () {
                function e() {
                  var t =
                    arguments.length > 0 &&
                    void 0 !== arguments[0] &&
                    arguments[0];
                  r(this, e),
                    (this.enabled = window.console && t),
                    this.enabled && this.log("Debugging enabled");
                }
                return (
                  o(e, [
                    {
                      key: "log",
                      get: function () {
                        return this.enabled
                          ? Function.prototype.bind.call(console.log, console)
                          : tt;
                      },
                    },
                    {
                      key: "warn",
                      get: function () {
                        return this.enabled
                          ? Function.prototype.bind.call(console.warn, console)
                          : tt;
                      },
                    },
                    {
                      key: "error",
                      get: function () {
                        return this.enabled
                          ? Function.prototype.bind.call(console.error, console)
                          : tt;
                      },
                    },
                  ]),
                  e
                );
              })(),
              it = (function () {
                function t(n) {
                  var i = this;
                  r(this, t),
                    e(this, "onChange", function () {
                      if (i.enabled) {
                        var e = i.player.elements.buttons.fullscreen;
                        U(e) && (e.pressed = i.active);
                        var t =
                          i.target === i.player.media
                            ? i.target
                            : i.player.elements.container;
                        Te.call(
                          i.player,
                          t,
                          i.active ? "enterfullscreen" : "exitfullscreen",
                          !0
                        );
                      }
                    }),
                    e(this, "toggleFallback", function () {
                      var e =
                        arguments.length > 0 &&
                        void 0 !== arguments[0] &&
                        arguments[0];
                      if (
                        (e
                          ? (i.scrollPosition = {
                              x: window.scrollX || 0,
                              y: window.scrollY || 0,
                            })
                          : window.scrollTo(
                              i.scrollPosition.x,
                              i.scrollPosition.y
                            ),
                        (document.body.style.overflow = e ? "hidden" : ""),
                        ce(
                          i.target,
                          i.player.config.classNames.fullscreen.fallback,
                          e
                        ),
                        J.isIos)
                      ) {
                        var t = document.head.querySelector(
                            'meta[name="viewport"]'
                          ),
                          n = "viewport-fit=cover";
                        t ||
                          (t = document.createElement("meta")).setAttribute(
                            "name",
                            "viewport"
                          );
                        var a = H(t.content) && t.content.includes(n);
                        e
                          ? ((i.cleanupViewport = !a),
                            a || (t.content += ",".concat(n)))
                          : i.cleanupViewport &&
                            (t.content = t.content
                              .split(",")
                              .filter(function (e) {
                                return e.trim() !== n;
                              })
                              .join(","));
                      }
                      i.onChange();
                    }),
                    e(this, "trapFocus", function (e) {
                      if (!J.isIos && i.active && "Tab" === e.key) {
                        var t = document.activeElement,
                          n = he.call(
                            i.player,
                            "a[href], button:not(:disabled), input:not(:disabled), [tabindex]"
                          ),
                          a = d(n, 1)[0],
                          r = n[n.length - 1];
                        t !== r || e.shiftKey
                          ? t === a &&
                            e.shiftKey &&
                            (r.focus(), e.preventDefault())
                          : (a.focus(), e.preventDefault());
                      }
                    }),
                    e(this, "update", function () {
                      var e;
                      i.enabled
                        ? ((e = i.forceFallback
                            ? "Fallback (forced)"
                            : t.native
                            ? "Native"
                            : "Fallback"),
                          i.player.debug.log(
                            "".concat(e, " fullscreen enabled")
                          ))
                        : i.player.debug.log(
                            "Fullscreen not supported and fallback disabled"
                          ),
                        ce(
                          i.player.elements.container,
                          i.player.config.classNames.fullscreen.enabled,
                          i.enabled
                        );
                    }),
                    e(this, "enter", function () {
                      i.enabled &&
                        (J.isIos && i.player.config.fullscreen.iosNative
                          ? i.player.isVimeo
                            ? i.player.embed.requestFullscreen()
                            : i.target.webkitEnterFullscreen()
                          : !t.native || i.forceFallback
                          ? i.toggleFallback(!0)
                          : i.prefix
                          ? $(i.prefix) ||
                            i.target[
                              "".concat(i.prefix, "Request").concat(i.property)
                            ]()
                          : i.target.requestFullscreen({
                              navigationUI: "hide",
                            }));
                    }),
                    e(this, "exit", function () {
                      if (i.enabled)
                        if (J.isIos && i.player.config.fullscreen.iosNative)
                          i.target.webkitExitFullscreen(), Ce(i.player.play());
                        else if (!t.native || i.forceFallback)
                          i.toggleFallback(!1);
                        else if (i.prefix) {
                          if (!$(i.prefix)) {
                            var e = "moz" === i.prefix ? "Cancel" : "Exit";
                            document[
                              "".concat(i.prefix).concat(e).concat(i.property)
                            ]();
                          }
                        } else
                          (
                            document.cancelFullScreen || document.exitFullscreen
                          ).call(document);
                    }),
                    e(this, "toggle", function () {
                      i.active ? i.exit() : i.enter();
                    }),
                    (this.player = n),
                    (this.prefix = t.prefix),
                    (this.property = t.property),
                    (this.scrollPosition = { x: 0, y: 0 }),
                    (this.forceFallback =
                      "force" === n.config.fullscreen.fallback),
                    (this.player.elements.fullscreen =
                      n.config.fullscreen.container &&
                      (function (e, t) {
                        return (
                          Element.prototype.closest ||
                          function () {
                            var e = this;
                            do {
                              if (de.matches(e, t)) return e;
                              e = e.parentElement || e.parentNode;
                            } while (null !== e && 1 === e.nodeType);
                            return null;
                          }
                        ).call(e, t);
                      })(
                        this.player.elements.container,
                        n.config.fullscreen.container
                      )),
                    be.call(
                      this.player,
                      document,
                      "ms" === this.prefix
                        ? "MSFullscreenChange"
                        : "".concat(this.prefix, "fullscreenchange"),
                      function () {
                        i.onChange();
                      }
                    ),
                    be.call(
                      this.player,
                      this.player.elements.container,
                      "dblclick",
                      function (e) {
                        (U(i.player.elements.controls) &&
                          i.player.elements.controls.contains(e.target)) ||
                          i.player.listeners.proxy(e, i.toggle, "fullscreen");
                      }
                    ),
                    be.call(
                      this,
                      this.player.elements.container,
                      "keydown",
                      function (e) {
                        return i.trapFocus(e);
                      }
                    ),
                    this.update();
                }
                return (
                  o(
                    t,
                    [
                      {
                        key: "usingNative",
                        get: function () {
                          return t.native && !this.forceFallback;
                        },
                      },
                      {
                        key: "enabled",
                        get: function () {
                          return (
                            (t.native ||
                              this.player.config.fullscreen.fallback) &&
                            this.player.config.fullscreen.enabled &&
                            this.player.supported.ui &&
                            this.player.isVideo
                          );
                        },
                      },
                      {
                        key: "active",
                        get: function () {
                          if (!this.enabled) return !1;
                          if (!t.native || this.forceFallback)
                            return ue(
                              this.target,
                              this.player.config.classNames.fullscreen.fallback
                            );
                          var e = this.prefix
                            ? this.target.getRootNode()[
                                ""
                                  .concat(this.prefix)
                                  .concat(this.property, "Element")
                              ]
                            : this.target.getRootNode().fullscreenElement;
                          return e && e.shadowRoot
                            ? e === this.target.getRootNode().host
                            : e === this.target;
                        },
                      },
                      {
                        key: "target",
                        get: function () {
                          return J.isIos &&
                            this.player.config.fullscreen.iosNative
                            ? this.player.media
                            : this.player.elements.fullscreen ||
                                this.player.elements.container;
                        },
                      },
                    ],
                    [
                      {
                        key: "native",
                        get: function () {
                          return !!(
                            document.fullscreenEnabled ||
                            document.webkitFullscreenEnabled ||
                            document.mozFullScreenEnabled ||
                            document.msFullscreenEnabled
                          );
                        },
                      },
                      {
                        key: "prefix",
                        get: function () {
                          if (R(document.exitFullscreen)) return "";
                          var e = "";
                          return (
                            ["webkit", "moz", "ms"].some(function (t) {
                              return !(
                                (!R(document["".concat(t, "ExitFullscreen")]) &&
                                  !R(
                                    document["".concat(t, "CancelFullScreen")]
                                  )) ||
                                ((e = t), 0)
                              );
                            }),
                            e
                          );
                        },
                      },
                      {
                        key: "property",
                        get: function () {
                          return "moz" === this.prefix
                            ? "FullScreen"
                            : "Fullscreen";
                        },
                      },
                    ]
                  ),
                  t
                );
              })();
            function at(e) {
              var t =
                arguments.length > 1 && void 0 !== arguments[1]
                  ? arguments[1]
                  : 1;
              return new Promise(function (n, i) {
                var a = new Image(),
                  r = function () {
                    delete a.onload,
                      delete a.onerror,
                      (a.naturalWidth >= t ? n : i)(a);
                  };
                Object.assign(a, { onload: r, onerror: r, src: e });
              });
            }
            var rt = {
                addStyleHook() {
                  ce(
                    this.elements.container,
                    this.config.selectors.container.replace(".", ""),
                    !0
                  ),
                    ce(
                      this.elements.container,
                      this.config.classNames.uiSupported,
                      this.supported.ui
                    );
                },
                toggleNativeControls() {
                  arguments.length > 0 &&
                  void 0 !== arguments[0] &&
                  arguments[0] &&
                  this.isHTML5
                    ? this.media.setAttribute("controls", "")
                    : this.media.removeAttribute("controls");
                },
                build() {
                  var e = this;
                  if ((this.listeners.media(), !this.supported.ui))
                    return (
                      this.debug.warn(
                        "Basic support only for "
                          .concat(this.provider, " ")
                          .concat(this.type)
                      ),
                      void rt.toggleNativeControls.call(this, !0)
                    );
                  U(this.elements.controls) ||
                    (Ye.inject.call(this), this.listeners.controls()),
                    rt.toggleNativeControls.call(this),
                    this.isHTML5 && Xe.setup.call(this),
                    (this.volume = null),
                    (this.muted = null),
                    (this.loop = null),
                    (this.quality = null),
                    (this.speed = null),
                    Ye.updateVolume.call(this),
                    Ye.timeUpdate.call(this),
                    Ye.durationUpdate.call(this),
                    rt.checkPlaying.call(this),
                    ce(
                      this.elements.container,
                      this.config.classNames.pip.supported,
                      ge.pip && this.isHTML5 && this.isVideo
                    ),
                    ce(
                      this.elements.container,
                      this.config.classNames.airplay.supported,
                      ge.airplay && this.isHTML5
                    ),
                    ce(
                      this.elements.container,
                      this.config.classNames.isIos,
                      J.isIos
                    ),
                    ce(
                      this.elements.container,
                      this.config.classNames.isTouch,
                      this.touch
                    ),
                    (this.ready = !0),
                    setTimeout(function () {
                      Te.call(e, e.media, "ready");
                    }, 0),
                    rt.setTitle.call(this),
                    this.poster &&
                      rt.setPoster
                        .call(this, this.poster, !1)
                        .catch(function () {}),
                    this.config.duration && Ye.durationUpdate.call(this),
                    this.config.mediaMetadata && Ye.setMediaMetadata.call(this);
                },
                setTitle() {
                  var e = Ve.get("play", this.config);
                  if (
                    (H(this.config.title) &&
                      !$(this.config.title) &&
                      (e += ", ".concat(this.config.title)),
                    Array.from(this.elements.buttons.play || []).forEach(
                      function (t) {
                        t.setAttribute("aria-label", e);
                      }
                    ),
                    this.isEmbed)
                  ) {
                    var t = pe.call(this, "iframe");
                    if (!U(t)) return;
                    var n = $(this.config.title) ? "video" : this.config.title,
                      i = Ve.get("frameTitle", this.config);
                    t.setAttribute("title", i.replace("{title}", n));
                  }
                },
                togglePoster(e) {
                  ce(
                    this.elements.container,
                    this.config.classNames.posterEnabled,
                    e
                  );
                },
                setPoster(e) {
                  var t = this;
                  return (arguments.length > 1 &&
                    void 0 !== arguments[1] &&
                    !arguments[1]) ||
                    !this.poster
                    ? (this.media.setAttribute("data-poster", e),
                      this.elements.poster.removeAttribute("hidden"),
                      Ae.call(this)
                        .then(function () {
                          return at(e);
                        })
                        .catch(function (n) {
                          throw (
                            (e === t.poster && rt.togglePoster.call(t, !1), n)
                          );
                        })
                        .then(function () {
                          if (e !== t.poster)
                            throw new Error(
                              "setPoster cancelled by later call to setPoster"
                            );
                        })
                        .then(function () {
                          return (
                            Object.assign(t.elements.poster.style, {
                              backgroundImage: "url('".concat(e, "')"),
                              backgroundSize: "",
                            }),
                            rt.togglePoster.call(t, !0),
                            e
                          );
                        }))
                    : Promise.reject(new Error("Poster already set"));
                },
                checkPlaying(e) {
                  var t = this;
                  ce(
                    this.elements.container,
                    this.config.classNames.playing,
                    this.playing
                  ),
                    ce(
                      this.elements.container,
                      this.config.classNames.paused,
                      this.paused
                    ),
                    ce(
                      this.elements.container,
                      this.config.classNames.stopped,
                      this.stopped
                    ),
                    Array.from(this.elements.buttons.play || []).forEach(
                      function (e) {
                        Object.assign(e, { pressed: t.playing }),
                          e.setAttribute(
                            "aria-label",
                            Ve.get(t.playing ? "pause" : "play", t.config)
                          );
                      }
                    ),
                    (W(e) && "timeupdate" === e.type) ||
                      rt.toggleControls.call(this);
                },
                checkLoading(e) {
                  var t = this;
                  (this.loading = ["stalled", "waiting"].includes(e.type)),
                    clearTimeout(this.timers.loading),
                    (this.timers.loading = setTimeout(
                      function () {
                        ce(
                          t.elements.container,
                          t.config.classNames.loading,
                          t.loading
                        ),
                          rt.toggleControls.call(t);
                      },
                      this.loading ? 250 : 0
                    ));
                },
                toggleControls(e) {
                  var t = this.elements.controls;
                  if (t && this.config.hideControls) {
                    var n = this.touch && this.lastSeekTime + 2e3 > Date.now();
                    this.toggleControls(
                      Boolean(
                        e ||
                          this.loading ||
                          this.paused ||
                          t.pressed ||
                          t.hover ||
                          n
                      )
                    );
                  }
                },
                migrateStyles() {
                  var e = this;
                  Object.values(c({}, this.media.style))
                    .filter(function (e) {
                      return !$(e) && H(e) && e.startsWith("--plyr");
                    })
                    .forEach(function (t) {
                      e.elements.container.style.setProperty(
                        t,
                        e.media.style.getPropertyValue(t)
                      ),
                        e.media.style.removeProperty(t);
                    }),
                    $(this.media.style) && this.media.removeAttribute("style");
                },
              },
              st = (function () {
                function t(n) {
                  var i = this;
                  r(this, t),
                    e(this, "firstTouch", function () {
                      var e = i.player,
                        t = e.elements;
                      (e.touch = !0),
                        ce(t.container, e.config.classNames.isTouch, !0);
                    }),
                    e(this, "setTabFocus", function (e) {
                      var t = i.player,
                        n = t.elements,
                        a = e.key,
                        r = e.type,
                        s = e.timeStamp;
                      if (
                        (clearTimeout(i.focusTimer),
                        "keydown" !== r || "Tab" === a)
                      ) {
                        "keydown" === r && (i.lastKeyDown = s);
                        var o = s - i.lastKeyDown <= 20;
                        ("focus" !== r || o) &&
                          ((function () {
                            var e = t.config.classNames.tabFocus;
                            ce(he.call(t, ".".concat(e)), e, !1);
                          })(),
                          "focusout" !== r &&
                            (i.focusTimer = setTimeout(function () {
                              var e = document.activeElement;
                              n.container.contains(e) &&
                                ce(
                                  document.activeElement,
                                  t.config.classNames.tabFocus,
                                  !0
                                );
                            }, 10)));
                      }
                    }),
                    e(this, "global", function () {
                      var e =
                          !(arguments.length > 0 && void 0 !== arguments[0]) ||
                          arguments[0],
                        t = i.player;
                      t.config.keyboard.global &&
                        ve.call(t, window, "keydown keyup", i.handleKey, e, !1),
                        ve.call(t, document.body, "click", i.toggleMenu, e),
                        ke.call(t, document.body, "touchstart", i.firstTouch),
                        ve.call(
                          t,
                          document.body,
                          "keydown focus blur focusout",
                          i.setTabFocus,
                          e,
                          !1,
                          !0
                        );
                    }),
                    e(this, "container", function () {
                      var e = i.player,
                        t = e.config,
                        n = e.elements,
                        a = e.timers;
                      !t.keyboard.global &&
                        t.keyboard.focused &&
                        be.call(
                          e,
                          n.container,
                          "keydown keyup",
                          i.handleKey,
                          !1
                        ),
                        be.call(
                          e,
                          n.container,
                          "mousemove mouseleave touchstart touchmove enterfullscreen exitfullscreen",
                          function (t) {
                            var i = n.controls;
                            i &&
                              "enterfullscreen" === t.type &&
                              ((i.pressed = !1), (i.hover = !1));
                            var r = 0;
                            ["touchstart", "touchmove", "mousemove"].includes(
                              t.type
                            ) &&
                              (rt.toggleControls.call(e, !0),
                              (r = e.touch ? 3e3 : 2e3)),
                              clearTimeout(a.controls),
                              (a.controls = setTimeout(function () {
                                return rt.toggleControls.call(e, !1);
                              }, r));
                          }
                        );
                      var r = function () {
                          if (e.isVimeo && !e.config.vimeo.premium) {
                            var t = n.wrapper,
                              i = e.fullscreen.active,
                              a = d(Ne.call(e), 2),
                              r = a[0],
                              s = a[1],
                              o = Me(
                                "aspect-ratio: ".concat(r, " / ").concat(s)
                              );
                            if (i) {
                              var l = [
                                  Math.max(
                                    document.documentElement.clientWidth || 0,
                                    window.innerWidth || 0
                                  ),
                                  Math.max(
                                    document.documentElement.clientHeight || 0,
                                    window.innerHeight || 0
                                  ),
                                ],
                                c = l[1],
                                u = l[0] / c > r / s;
                              o
                                ? ((t.style.width = u ? "auto" : "100%"),
                                  (t.style.height = u ? "100%" : "auto"))
                                : ((t.style.maxWidth = u
                                    ? (c / s) * r + "px"
                                    : null),
                                  (t.style.margin = u ? "0 auto" : null));
                            } else
                              o
                                ? ((t.style.width = null),
                                  (t.style.height = null))
                                : ((t.style.maxWidth = null),
                                  (t.style.margin = null));
                          }
                        },
                        s = function () {
                          clearTimeout(a.resized),
                            (a.resized = setTimeout(r, 50));
                        };
                      be.call(
                        e,
                        n.container,
                        "enterfullscreen exitfullscreen",
                        function (t) {
                          e.fullscreen.target === n.container &&
                            ((!e.isEmbed && $(e.config.ratio)) ||
                              (r(),
                              ("enterfullscreen" === t.type ? be : we).call(
                                e,
                                window,
                                "resize",
                                s
                              )));
                        }
                      );
                    }),
                    e(this, "media", function () {
                      var e = i.player,
                        t = e.elements;
                      if (
                        (be.call(
                          e,
                          e.media,
                          "timeupdate seeking seeked",
                          function (t) {
                            return Ye.timeUpdate.call(e, t);
                          }
                        ),
                        be.call(
                          e,
                          e.media,
                          "durationchange loadeddata loadedmetadata",
                          function (t) {
                            return Ye.durationUpdate.call(e, t);
                          }
                        ),
                        be.call(e, e.media, "ended", function () {
                          e.isHTML5 &&
                            e.isVideo &&
                            e.config.resetOnEnd &&
                            (e.restart(), e.pause());
                        }),
                        be.call(
                          e,
                          e.media,
                          "progress playing seeking seeked",
                          function (t) {
                            return Ye.updateProgress.call(e, t);
                          }
                        ),
                        be.call(e, e.media, "volumechange", function (t) {
                          return Ye.updateVolume.call(e, t);
                        }),
                        be.call(
                          e,
                          e.media,
                          "playing play pause ended emptied timeupdate",
                          function (t) {
                            return rt.checkPlaying.call(e, t);
                          }
                        ),
                        be.call(
                          e,
                          e.media,
                          "waiting canplay seeked playing",
                          function (t) {
                            return rt.checkLoading.call(e, t);
                          }
                        ),
                        e.supported.ui && e.config.clickToPlay && !e.isAudio)
                      ) {
                        var n = pe.call(
                          e,
                          ".".concat(e.config.classNames.video)
                        );
                        if (!U(n)) return;
                        be.call(e, t.container, "click", function (a) {
                          ([t.container, n].includes(a.target) ||
                            n.contains(a.target)) &&
                            ((e.touch && e.config.hideControls) ||
                              (e.ended
                                ? (i.proxy(a, e.restart, "restart"),
                                  i.proxy(
                                    a,
                                    function () {
                                      Ce(e.play());
                                    },
                                    "play"
                                  ))
                                : i.proxy(
                                    a,
                                    function () {
                                      Ce(e.togglePlay());
                                    },
                                    "play"
                                  )));
                        });
                      }
                      e.supported.ui &&
                        e.config.disableContextMenu &&
                        be.call(
                          e,
                          t.wrapper,
                          "contextmenu",
                          function (e) {
                            e.preventDefault();
                          },
                          !1
                        ),
                        be.call(e, e.media, "volumechange", function () {
                          e.storage.set({ volume: e.volume, muted: e.muted });
                        }),
                        be.call(e, e.media, "ratechange", function () {
                          Ye.updateSetting.call(e, "speed"),
                            e.storage.set({ speed: e.speed });
                        }),
                        be.call(e, e.media, "qualitychange", function (t) {
                          Ye.updateSetting.call(
                            e,
                            "quality",
                            null,
                            t.detail.quality
                          );
                        }),
                        be.call(e, e.media, "ready qualitychange", function () {
                          Ye.setDownloadUrl.call(e);
                        });
                      var a = e.config.events
                        .concat(["keyup", "keydown"])
                        .join(" ");
                      be.call(e, e.media, a, function (n) {
                        var i = n.detail,
                          a = void 0 === i ? {} : i;
                        "error" === n.type && (a = e.media.error),
                          Te.call(e, t.container, n.type, !0, a);
                      });
                    }),
                    e(this, "proxy", function (e, t, n) {
                      var a = i.player,
                        r = a.config.listeners[n],
                        s = !0;
                      R(r) && (s = r.call(a, e)),
                        !1 !== s && R(t) && t.call(a, e);
                    }),
                    e(this, "bind", function (e, t, n, a) {
                      var r =
                          !(arguments.length > 4 && void 0 !== arguments[4]) ||
                          arguments[4],
                        s = i.player,
                        o = s.config.listeners[a],
                        l = R(o);
                      be.call(
                        s,
                        e,
                        t,
                        function (e) {
                          return i.proxy(e, n, a);
                        },
                        r && !l
                      );
                    }),
                    e(this, "controls", function () {
                      var e = i.player,
                        t = e.elements,
                        n = J.isIE ? "change" : "input";
                      if (
                        (t.buttons.play &&
                          Array.from(t.buttons.play).forEach(function (t) {
                            i.bind(
                              t,
                              "click",
                              function () {
                                Ce(e.togglePlay());
                              },
                              "play"
                            );
                          }),
                        i.bind(
                          t.buttons.restart,
                          "click",
                          e.restart,
                          "restart"
                        ),
                        i.bind(
                          t.buttons.rewind,
                          "click",
                          function () {
                            (e.lastSeekTime = Date.now()), e.rewind();
                          },
                          "rewind"
                        ),
                        i.bind(
                          t.buttons.fastForward,
                          "click",
                          function () {
                            (e.lastSeekTime = Date.now()), e.forward();
                          },
                          "fastForward"
                        ),
                        i.bind(
                          t.buttons.mute,
                          "click",
                          function () {
                            e.muted = !e.muted;
                          },
                          "mute"
                        ),
                        i.bind(t.buttons.captions, "click", function () {
                          return e.toggleCaptions();
                        }),
                        i.bind(
                          t.buttons.download,
                          "click",
                          function () {
                            Te.call(e, e.media, "download");
                          },
                          "download"
                        ),
                        i.bind(
                          t.buttons.fullscreen,
                          "click",
                          function () {
                            e.fullscreen.toggle();
                          },
                          "fullscreen"
                        ),
                        i.bind(
                          t.buttons.pip,
                          "click",
                          function () {
                            e.pip = "toggle";
                          },
                          "pip"
                        ),
                        i.bind(
                          t.buttons.airplay,
                          "click",
                          e.airplay,
                          "airplay"
                        ),
                        i.bind(
                          t.buttons.settings,
                          "click",
                          function (t) {
                            t.stopPropagation(),
                              t.preventDefault(),
                              Ye.toggleMenu.call(e, t);
                          },
                          null,
                          !1
                        ),
                        i.bind(
                          t.buttons.settings,
                          "keyup",
                          function (t) {
                            ["Space", "Enter"].includes(t.key) &&
                              ("Enter" !== t.key
                                ? (t.preventDefault(),
                                  t.stopPropagation(),
                                  Ye.toggleMenu.call(e, t))
                                : Ye.focusFirstMenuItem.call(e, null, !0));
                          },
                          null,
                          !1
                        ),
                        i.bind(t.settings.menu, "keydown", function (t) {
                          "Escape" === t.key && Ye.toggleMenu.call(e, t);
                        }),
                        i.bind(
                          t.inputs.seek,
                          "mousedown mousemove",
                          function (e) {
                            var n = t.progress.getBoundingClientRect(),
                              i = (100 / n.width) * (e.pageX - n.left);
                            e.currentTarget.setAttribute("seek-value", i);
                          }
                        ),
                        i.bind(
                          t.inputs.seek,
                          "mousedown mouseup keydown keyup touchstart touchend",
                          function (t) {
                            var n = t.currentTarget,
                              i = "play-on-seeked";
                            if (
                              !z(t) ||
                              ["ArrowLeft", "ArrowRight"].includes(t.key)
                            ) {
                              e.lastSeekTime = Date.now();
                              var a = n.hasAttribute(i),
                                r = ["mouseup", "touchend", "keyup"].includes(
                                  t.type
                                );
                              a && r
                                ? (n.removeAttribute(i), Ce(e.play()))
                                : !r &&
                                  e.playing &&
                                  (n.setAttribute(i, ""), e.pause());
                            }
                          }
                        ),
                        J.isIos)
                      ) {
                        var a = he.call(e, 'input[type="range"]');
                        Array.from(a).forEach(function (e) {
                          return i.bind(e, n, function (e) {
                            return X(e.target);
                          });
                        });
                      }
                      i.bind(
                        t.inputs.seek,
                        n,
                        function (t) {
                          var n = t.currentTarget,
                            i = n.getAttribute("seek-value");
                          $(i) && (i = n.value),
                            n.removeAttribute("seek-value"),
                            (e.currentTime = (i / n.max) * e.duration);
                        },
                        "seek"
                      ),
                        i.bind(
                          t.progress,
                          "mouseenter mouseleave mousemove",
                          function (t) {
                            return Ye.updateSeekTooltip.call(e, t);
                          }
                        ),
                        i.bind(t.progress, "mousemove touchmove", function (t) {
                          var n = e.previewThumbnails;
                          n && n.loaded && n.startMove(t);
                        }),
                        i.bind(
                          t.progress,
                          "mouseleave touchend click",
                          function () {
                            var t = e.previewThumbnails;
                            t && t.loaded && t.endMove(!1, !0);
                          }
                        ),
                        i.bind(
                          t.progress,
                          "mousedown touchstart",
                          function (t) {
                            var n = e.previewThumbnails;
                            n && n.loaded && n.startScrubbing(t);
                          }
                        ),
                        i.bind(t.progress, "mouseup touchend", function (t) {
                          var n = e.previewThumbnails;
                          n && n.loaded && n.endScrubbing(t);
                        }),
                        J.isWebkit &&
                          Array.from(he.call(e, 'input[type="range"]')).forEach(
                            function (t) {
                              i.bind(t, "input", function (t) {
                                return Ye.updateRangeFill.call(e, t.target);
                              });
                            }
                          ),
                        e.config.toggleInvert &&
                          !U(t.display.duration) &&
                          i.bind(t.display.currentTime, "click", function () {
                            0 !== e.currentTime &&
                              ((e.config.invertTime = !e.config.invertTime),
                              Ye.timeUpdate.call(e));
                          }),
                        i.bind(
                          t.inputs.volume,
                          n,
                          function (t) {
                            e.volume = t.target.value;
                          },
                          "volume"
                        ),
                        i.bind(
                          t.controls,
                          "mouseenter mouseleave",
                          function (n) {
                            t.controls.hover =
                              !e.touch && "mouseenter" === n.type;
                          }
                        ),
                        t.fullscreen &&
                          Array.from(t.fullscreen.children)
                            .filter(function (e) {
                              return !e.contains(t.container);
                            })
                            .forEach(function (n) {
                              i.bind(n, "mouseenter mouseleave", function (n) {
                                t.controls &&
                                  (t.controls.hover =
                                    !e.touch && "mouseenter" === n.type);
                              });
                            }),
                        i.bind(
                          t.controls,
                          "mousedown mouseup touchstart touchend touchcancel",
                          function (e) {
                            t.controls.pressed = [
                              "mousedown",
                              "touchstart",
                            ].includes(e.type);
                          }
                        ),
                        i.bind(t.controls, "focusin", function () {
                          var n = e.config,
                            a = e.timers;
                          ce(t.controls, n.classNames.noTransition, !0),
                            rt.toggleControls.call(e, !0),
                            setTimeout(function () {
                              ce(t.controls, n.classNames.noTransition, !1);
                            }, 0);
                          var r = i.touch ? 3e3 : 4e3;
                          clearTimeout(a.controls),
                            (a.controls = setTimeout(function () {
                              return rt.toggleControls.call(e, !1);
                            }, r));
                        }),
                        i.bind(
                          t.inputs.volume,
                          "wheel",
                          function (t) {
                            var n = t.webkitDirectionInvertedFromDevice,
                              i = [t.deltaX, -t.deltaY].map(function (e) {
                                return n ? -e : e;
                              }),
                              a = d(i, 2),
                              r = a[0],
                              s = a[1],
                              o = Math.sign(Math.abs(r) > Math.abs(s) ? r : s);
                            e.increaseVolume(o / 50);
                            var l = e.media.volume;
                            ((1 === o && l < 1) || (-1 === o && l > 0)) &&
                              t.preventDefault();
                          },
                          "volume",
                          !1
                        );
                    }),
                    (this.player = n),
                    (this.lastKey = null),
                    (this.focusTimer = null),
                    (this.lastKeyDown = null),
                    (this.handleKey = this.handleKey.bind(this)),
                    (this.toggleMenu = this.toggleMenu.bind(this)),
                    (this.setTabFocus = this.setTabFocus.bind(this)),
                    (this.firstTouch = this.firstTouch.bind(this));
                }
                return (
                  o(t, [
                    {
                      key: "handleKey",
                      value: function (e) {
                        var t,
                          n = this.player,
                          i = n.elements,
                          a = e.key,
                          r = e.type,
                          s = e.altKey,
                          o = e.ctrlKey,
                          l = e.metaKey,
                          c = e.shiftKey,
                          u = "keydown" === r,
                          d = u && a === this.lastKey;
                        if (!(s || o || l || c) && a)
                          if (u) {
                            var h = document.activeElement;
                            if (U(h)) {
                              var p = n.config.selectors.editable;
                              if (h !== i.inputs.seek && de(h, p)) return;
                              if (
                                "Space" === e.key &&
                                de(h, 'button, [role^="menuitem"]')
                              )
                                return;
                            }
                            switch (
                              ([
                                "Space",
                                "ArrowLeft",
                                "ArrowUp",
                                "ArrowRight",
                                "ArrowDown",
                                "0",
                                "1",
                                "2",
                                "3",
                                "4",
                                "5",
                                "6",
                                "7",
                                "8",
                                "9",
                                "c",
                                "f",
                                "k",
                                "l",
                                "m",
                              ].includes(a) &&
                                (e.preventDefault(), e.stopPropagation()),
                              a)
                            ) {
                              case "0":
                              case "1":
                              case "2":
                              case "3":
                              case "4":
                              case "5":
                              case "6":
                              case "7":
                              case "8":
                              case "9":
                                d ||
                                  ((t = parseInt(a, 10)),
                                  (n.currentTime = (n.duration / 10) * t));
                                break;
                              case "Space":
                              case "k":
                                d || Ce(n.togglePlay());
                                break;
                              case "ArrowUp":
                                n.increaseVolume(0.1);
                                break;
                              case "ArrowDown":
                                n.decreaseVolume(0.1);
                                break;
                              case "m":
                                d || (n.muted = !n.muted);
                                break;
                              case "ArrowRight":
                                n.forward();
                                break;
                              case "ArrowLeft":
                                n.rewind();
                                break;
                              case "f":
                                n.fullscreen.toggle();
                                break;
                              case "c":
                                d || n.toggleCaptions();
                                break;
                              case "l":
                                n.loop = !n.loop;
                            }
                            "Escape" === a &&
                              !n.fullscreen.usingNative &&
                              n.fullscreen.active &&
                              n.fullscreen.toggle(),
                              (this.lastKey = a);
                          } else this.lastKey = null;
                      },
                    },
                    {
                      key: "toggleMenu",
                      value: function (e) {
                        Ye.toggleMenu.call(this.player, e);
                      },
                    },
                  ]),
                  t
                );
              })();
            "undefined" != typeof globalThis
              ? globalThis
              : "undefined" != typeof window
              ? window
              : void 0 !== n.g
              ? n.g
              : "undefined" != typeof self && self;
            var ot = (function (e, t) {
              return (
                (function (e, t) {
                  e.exports = (function () {
                    var e = function () {},
                      t = {},
                      n = {},
                      i = {};
                    function a(e, t) {
                      e = e.push ? e : [e];
                      var a,
                        r,
                        s,
                        o = [],
                        l = e.length,
                        c = l;
                      for (
                        a = function (e, n) {
                          n.length && o.push(e), --c || t(o);
                        };
                        l--;

                      )
                        (r = e[l]),
                          (s = n[r]) ? a(r, s) : (i[r] = i[r] || []).push(a);
                    }
                    function r(e, t) {
                      if (e) {
                        var a = i[e];
                        if (((n[e] = t), a))
                          for (; a.length; ) a[0](e, t), a.splice(0, 1);
                      }
                    }
                    function s(t, n) {
                      t.call && (t = { success: t }),
                        n.length ? (t.error || e)(n) : (t.success || e)(t);
                    }
                    function o(t, n, i, a) {
                      var r,
                        s,
                        l = document,
                        c = i.async,
                        u = (i.numRetries || 0) + 1,
                        d = i.before || e,
                        h = t.replace(/[\?|#].*$/, ""),
                        p = t.replace(/^(css|img)!/, "");
                      (a = a || 0),
                        /(^css!|\.css$)/.test(h)
                          ? (((s = l.createElement("link")).rel = "stylesheet"),
                            (s.href = p),
                            (r = "hideFocus" in s) &&
                              s.relList &&
                              ((r = 0), (s.rel = "preload"), (s.as = "style")))
                          : /(^img!|\.(png|gif|jpg|svg|webp)$)/.test(h)
                          ? ((s = l.createElement("img")).src = p)
                          : (((s = l.createElement("script")).src = t),
                            (s.async = void 0 === c || c)),
                        (s.onload =
                          s.onerror =
                          s.onbeforeload =
                            function (e) {
                              var l = e.type[0];
                              if (r)
                                try {
                                  s.sheet.cssText.length || (l = "e");
                                } catch (e) {
                                  18 != e.code && (l = "e");
                                }
                              if ("e" == l) {
                                if ((a += 1) < u) return o(t, n, i, a);
                              } else if ("preload" == s.rel && "style" == s.as)
                                return (s.rel = "stylesheet");
                              n(t, l, e.defaultPrevented);
                            }),
                        !1 !== d(t, s) && l.head.appendChild(s);
                    }
                    function l(e, t, n) {
                      var i,
                        a,
                        r = (e = e.push ? e : [e]).length,
                        s = r,
                        l = [];
                      for (
                        i = function (e, n, i) {
                          if (("e" == n && l.push(e), "b" == n)) {
                            if (!i) return;
                            l.push(e);
                          }
                          --r || t(l);
                        },
                          a = 0;
                        a < s;
                        a++
                      )
                        o(e[a], i, n);
                    }
                    function c(e, n, i) {
                      var a, o;
                      if (
                        (n && n.trim && (a = n), (o = (a ? i : n) || {}), a)
                      ) {
                        if (a in t) throw "LoadJS";
                        t[a] = !0;
                      }
                      function c(t, n) {
                        l(
                          e,
                          function (e) {
                            s(o, e),
                              t && s({ success: t, error: n }, e),
                              r(a, e);
                          },
                          o
                        );
                      }
                      if (o.returnPromise) return new Promise(c);
                      c();
                    }
                    return (
                      (c.ready = function (e, t) {
                        return (
                          a(e, function (e) {
                            s(t, e);
                          }),
                          c
                        );
                      }),
                      (c.done = function (e) {
                        r(e, []);
                      }),
                      (c.reset = function () {
                        (t = {}), (n = {}), (i = {});
                      }),
                      (c.isDefined = function (e) {
                        return e in t;
                      }),
                      c
                    );
                  })();
                })((t = { exports: {} })),
                t.exports
              );
            })();
            function lt(e) {
              return new Promise(function (t, n) {
                ot(e, { success: t, error: n });
              });
            }
            function ct(e) {
              e && !this.embed.hasPlayed && (this.embed.hasPlayed = !0),
                this.media.paused === e &&
                  ((this.media.paused = !e),
                  Te.call(this, this.media, e ? "play" : "pause"));
            }
            var ut = {
              setup() {
                var e = this;
                ce(e.elements.wrapper, e.config.classNames.embed, !0),
                  (e.options.speed = e.config.speed.options),
                  Ie.call(e),
                  q(window.Vimeo)
                    ? ut.ready.call(e)
                    : lt(e.config.urls.vimeo.sdk)
                        .then(function () {
                          ut.ready.call(e);
                        })
                        .catch(function (t) {
                          e.debug.warn(
                            "Vimeo SDK (player.js) failed to load",
                            t
                          );
                        });
              },
              ready() {
                var e = this,
                  t = this,
                  n = t.config.vimeo,
                  a = n.premium,
                  r = n.referrerPolicy,
                  s = (function (e, t) {
                    if (null == e) return {};
                    var n,
                      i,
                      a = (function (e, t) {
                        if (null == e) return {};
                        var n,
                          i,
                          a = {},
                          r = Object.keys(e);
                        for (i = 0; i < r.length; i++)
                          (n = r[i]), t.indexOf(n) >= 0 || (a[n] = e[n]);
                        return a;
                      })(e, t);
                    if (Object.getOwnPropertySymbols) {
                      var r = Object.getOwnPropertySymbols(e);
                      for (i = 0; i < r.length; i++)
                        (n = r[i]),
                          t.indexOf(n) >= 0 ||
                            (Object.prototype.propertyIsEnumerable.call(e, n) &&
                              (a[n] = e[n]));
                    }
                    return a;
                  })(n, i),
                  o = t.media.getAttribute("src"),
                  l = "";
                $(o)
                  ? ((o = t.media.getAttribute(t.config.attributes.embed.id)),
                    (l = t.media.getAttribute(t.config.attributes.embed.hash)))
                  : (l = (function (e) {
                      var t = e.match(
                        /^.*(vimeo.com\/|video\/)(\d+)(\?.*&*h=|\/)+([\d,a-f]+)/
                      );
                      return t && 5 === t.length ? t[4] : null;
                    })(o));
                var u = l ? { h: l } : {};
                a && Object.assign(s, { controls: !1, sidedock: !1 });
                var h,
                  p = Qe(
                    c(
                      c(
                        {
                          loop: t.config.loop.active,
                          autoplay: t.autoplay,
                          muted: t.muted,
                          gesture: "media",
                          playsinline: !this.config.fullscreen.iosNative,
                        },
                        u
                      ),
                      s
                    )
                  ),
                  m = $((h = o))
                    ? null
                    : D(Number(h))
                    ? h
                    : h.match(/^.*(vimeo.com\/|video\/)(\d+).*/)
                    ? RegExp.$2
                    : h,
                  f = ne("iframe"),
                  g = qe(t.config.urls.vimeo.iframe, m, p);
                if (
                  (f.setAttribute("src", g),
                  f.setAttribute("allowfullscreen", ""),
                  f.setAttribute(
                    "allow",
                    [
                      "autoplay",
                      "fullscreen",
                      "picture-in-picture",
                      "encrypted-media",
                      "accelerometer",
                      "gyroscope",
                    ].join("; ")
                  ),
                  $(r) || f.setAttribute("referrerPolicy", r),
                  a || !n.customControls)
                )
                  f.setAttribute("data-poster", t.poster),
                    (t.media = se(f, t.media));
                else {
                  var y = ne("div", {
                    class: t.config.classNames.embedContainer,
                    "data-poster": t.poster,
                  });
                  y.appendChild(f), (t.media = se(y, t.media));
                }
                n.customControls ||
                  Ue(qe(t.config.urls.vimeo.api, g)).then(function (e) {
                    !$(e) &&
                      e.thumbnail_url &&
                      rt.setPoster
                        .call(t, e.thumbnail_url)
                        .catch(function () {});
                  }),
                  (t.embed = new window.Vimeo.Player(f, {
                    autopause: t.config.autopause,
                    muted: t.muted,
                  })),
                  (t.media.paused = !0),
                  (t.media.currentTime = 0),
                  t.supported.ui && t.embed.disableTextTrack(),
                  (t.media.play = function () {
                    return ct.call(t, !0), t.embed.play();
                  }),
                  (t.media.pause = function () {
                    return ct.call(t, !1), t.embed.pause();
                  }),
                  (t.media.stop = function () {
                    t.pause(), (t.currentTime = 0);
                  });
                var v = t.media.currentTime;
                Object.defineProperty(t.media, "currentTime", {
                  get: function () {
                    return v;
                  },
                  set(e) {
                    var n = t.embed,
                      i = t.media,
                      a = t.paused,
                      r = t.volume,
                      s = a && !n.hasPlayed;
                    (i.seeking = !0),
                      Te.call(t, i, "seeking"),
                      Promise.resolve(s && n.setVolume(0))
                        .then(function () {
                          return n.setCurrentTime(e);
                        })
                        .then(function () {
                          return s && n.pause();
                        })
                        .then(function () {
                          return s && n.setVolume(r);
                        })
                        .catch(function () {});
                  },
                });
                var b = t.config.speed.selected;
                Object.defineProperty(t.media, "playbackRate", {
                  get: function () {
                    return b;
                  },
                  set(e) {
                    t.embed
                      .setPlaybackRate(e)
                      .then(function () {
                        (b = e), Te.call(t, t.media, "ratechange");
                      })
                      .catch(function () {
                        t.options.speed = [1];
                      });
                  },
                });
                var w = t.config.volume;
                Object.defineProperty(t.media, "volume", {
                  get: function () {
                    return w;
                  },
                  set(e) {
                    t.embed.setVolume(e).then(function () {
                      (w = e), Te.call(t, t.media, "volumechange");
                    });
                  },
                });
                var k = t.config.muted;
                Object.defineProperty(t.media, "muted", {
                  get: function () {
                    return k;
                  },
                  set(e) {
                    var n = !!F(e) && e;
                    t.embed
                      .setVolume(n ? 0 : t.config.volume)
                      .then(function () {
                        (k = n), Te.call(t, t.media, "volumechange");
                      });
                  },
                });
                var T,
                  S = t.config.loop;
                Object.defineProperty(t.media, "loop", {
                  get: function () {
                    return S;
                  },
                  set(e) {
                    var n = F(e) ? e : t.config.loop.active;
                    t.embed.setLoop(n).then(function () {
                      S = n;
                    });
                  },
                }),
                  t.embed
                    .getVideoUrl()
                    .then(function (e) {
                      (T = e), Ye.setDownloadUrl.call(t);
                    })
                    .catch(function (t) {
                      e.debug.warn(t);
                    }),
                  Object.defineProperty(t.media, "currentSrc", {
                    get: function () {
                      return T;
                    },
                  }),
                  Object.defineProperty(t.media, "ended", {
                    get: function () {
                      return t.currentTime === t.duration;
                    },
                  }),
                  Promise.all([
                    t.embed.getVideoWidth(),
                    t.embed.getVideoHeight(),
                  ]).then(function (n) {
                    var i = d(n, 2),
                      a = i[0],
                      r = i[1];
                    (t.embed.ratio = _e(a, r)), Ie.call(e);
                  }),
                  t.embed.setAutopause(t.config.autopause).then(function (e) {
                    t.config.autopause = e;
                  }),
                  t.embed.getVideoTitle().then(function (n) {
                    (t.config.title = n), rt.setTitle.call(e);
                  }),
                  t.embed.getCurrentTime().then(function (e) {
                    (v = e), Te.call(t, t.media, "timeupdate");
                  }),
                  t.embed.getDuration().then(function (e) {
                    (t.media.duration = e),
                      Te.call(t, t.media, "durationchange");
                  }),
                  t.embed.getTextTracks().then(function (e) {
                    (t.media.textTracks = e), Xe.setup.call(t);
                  }),
                  t.embed.on("cuechange", function (e) {
                    var n = e.cues,
                      i = (void 0 === n ? [] : n).map(function (e) {
                        return (function (e) {
                          var t = document.createDocumentFragment(),
                            n = document.createElement("div");
                          return (
                            t.appendChild(n),
                            (n.innerHTML = e),
                            t.firstChild.innerText
                          );
                        })(e.text);
                      });
                    Xe.updateCues.call(t, i);
                  }),
                  t.embed.on("loaded", function () {
                    t.embed.getPaused().then(function (e) {
                      ct.call(t, !e), e || Te.call(t, t.media, "playing");
                    }),
                      U(t.embed.element) &&
                        t.supported.ui &&
                        t.embed.element.setAttribute("tabindex", -1);
                  }),
                  t.embed.on("bufferstart", function () {
                    Te.call(t, t.media, "waiting");
                  }),
                  t.embed.on("bufferend", function () {
                    Te.call(t, t.media, "playing");
                  }),
                  t.embed.on("play", function () {
                    ct.call(t, !0), Te.call(t, t.media, "playing");
                  }),
                  t.embed.on("pause", function () {
                    ct.call(t, !1);
                  }),
                  t.embed.on("timeupdate", function (e) {
                    (t.media.seeking = !1),
                      (v = e.seconds),
                      Te.call(t, t.media, "timeupdate");
                  }),
                  t.embed.on("progress", function (e) {
                    (t.media.buffered = e.percent),
                      Te.call(t, t.media, "progress"),
                      1 === parseInt(e.percent, 10) &&
                        Te.call(t, t.media, "canplaythrough"),
                      t.embed.getDuration().then(function (e) {
                        e !== t.media.duration &&
                          ((t.media.duration = e),
                          Te.call(t, t.media, "durationchange"));
                      });
                  }),
                  t.embed.on("seeked", function () {
                    (t.media.seeking = !1), Te.call(t, t.media, "seeked");
                  }),
                  t.embed.on("ended", function () {
                    (t.media.paused = !0), Te.call(t, t.media, "ended");
                  }),
                  t.embed.on("error", function (e) {
                    (t.media.error = e), Te.call(t, t.media, "error");
                  }),
                  n.customControls &&
                    setTimeout(function () {
                      return rt.build.call(t);
                    }, 0);
              },
            };
            function dt(e) {
              e && !this.embed.hasPlayed && (this.embed.hasPlayed = !0),
                this.media.paused === e &&
                  ((this.media.paused = !e),
                  Te.call(this, this.media, e ? "play" : "pause"));
            }
            function ht(e) {
              return e.noCookie
                ? "https://www.youtube-nocookie.com"
                : "http:" === window.location.protocol
                ? "http://www.youtube.com"
                : void 0;
            }
            var pt = {
                setup() {
                  var e = this;
                  if (
                    (ce(
                      this.elements.wrapper,
                      this.config.classNames.embed,
                      !0
                    ),
                    q(window.YT) && R(window.YT.Player))
                  )
                    pt.ready.call(this);
                  else {
                    var t = window.onYouTubeIframeAPIReady;
                    (window.onYouTubeIframeAPIReady = function () {
                      R(t) && t(), pt.ready.call(e);
                    }),
                      lt(this.config.urls.youtube.sdk).catch(function (t) {
                        e.debug.warn("YouTube API failed to load", t);
                      });
                  }
                },
                getTitle(e) {
                  var t = this;
                  Ue(qe(this.config.urls.youtube.api, e))
                    .then(function (e) {
                      if (q(e)) {
                        var n = e.title,
                          i = e.height,
                          a = e.width;
                        (t.config.title = n),
                          rt.setTitle.call(t),
                          (t.embed.ratio = _e(a, i));
                      }
                      Ie.call(t);
                    })
                    .catch(function () {
                      Ie.call(t);
                    });
                },
                ready() {
                  var e = this,
                    t = e.config.youtube,
                    n = e.media && e.media.getAttribute("id");
                  if ($(n) || !n.startsWith("youtube-")) {
                    var i = e.media.getAttribute("src");
                    $(i) &&
                      (i = e.media.getAttribute(
                        this.config.attributes.embed.id
                      ));
                    var a,
                      r = $((a = i))
                        ? null
                        : a.match(
                            /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/
                          )
                        ? RegExp.$2
                        : a,
                      s = ne("div", {
                        id: ""
                          .concat(e.provider, "-")
                          .concat(Math.floor(1e4 * Math.random())),
                        "data-poster": t.customControls ? e.poster : void 0,
                      });
                    if (((e.media = se(s, e.media)), t.customControls)) {
                      var o = function (e) {
                        return "https://i.ytimg.com/vi/"
                          .concat(r, "/")
                          .concat(e, "default.jpg");
                      };
                      at(o("maxres"), 121)
                        .catch(function () {
                          return at(o("sd"), 121);
                        })
                        .catch(function () {
                          return at(o("hq"));
                        })
                        .then(function (t) {
                          return rt.setPoster.call(e, t.src);
                        })
                        .then(function (t) {
                          t.includes("maxres") ||
                            (e.elements.poster.style.backgroundSize = "cover");
                        })
                        .catch(function () {});
                    }
                    e.embed = new window.YT.Player(e.media, {
                      videoId: r,
                      host: ht(t),
                      playerVars: Z(
                        {},
                        {
                          autoplay: e.config.autoplay ? 1 : 0,
                          hl: e.config.hl,
                          controls: e.supported.ui && t.customControls ? 0 : 1,
                          disablekb: 1,
                          playsinline: e.config.fullscreen.iosNative ? 0 : 1,
                          cc_load_policy: e.captions.active ? 1 : 0,
                          cc_lang_pref: e.config.captions.language,
                          widget_referrer: window ? window.location.href : null,
                        },
                        t
                      ),
                      events: {
                        onError(t) {
                          if (!e.media.error) {
                            var n = t.data,
                              i =
                                {
                                  2: "The request contains an invalid parameter value. For example, this error occurs if you specify a video ID that does not have 11 characters, or if the video ID contains invalid characters, such as exclamation points or asterisks.",
                                  5: "The requested content cannot be played in an HTML5 player or another error related to the HTML5 player has occurred.",
                                  100: "The video requested was not found. This error occurs when a video has been removed (for any reason) or has been marked as private.",
                                  101: "The owner of the requested video does not allow it to be played in embedded players.",
                                  150: "The owner of the requested video does not allow it to be played in embedded players.",
                                }[n] || "An unknown error occured";
                            (e.media.error = { code: n, message: i }),
                              Te.call(e, e.media, "error");
                          }
                        },
                        onPlaybackRateChange(t) {
                          var n = t.target;
                          (e.media.playbackRate = n.getPlaybackRate()),
                            Te.call(e, e.media, "ratechange");
                        },
                        onReady(n) {
                          if (!R(e.media.play)) {
                            var i = n.target;
                            pt.getTitle.call(e, r),
                              (e.media.play = function () {
                                dt.call(e, !0), i.playVideo();
                              }),
                              (e.media.pause = function () {
                                dt.call(e, !1), i.pauseVideo();
                              }),
                              (e.media.stop = function () {
                                i.stopVideo();
                              }),
                              (e.media.duration = i.getDuration()),
                              (e.media.paused = !0),
                              (e.media.currentTime = 0),
                              Object.defineProperty(e.media, "currentTime", {
                                get: function () {
                                  return Number(i.getCurrentTime());
                                },
                                set(t) {
                                  e.paused &&
                                    !e.embed.hasPlayed &&
                                    e.embed.mute(),
                                    (e.media.seeking = !0),
                                    Te.call(e, e.media, "seeking"),
                                    i.seekTo(t);
                                },
                              }),
                              Object.defineProperty(e.media, "playbackRate", {
                                get: function () {
                                  return i.getPlaybackRate();
                                },
                                set(e) {
                                  i.setPlaybackRate(e);
                                },
                              });
                            var a = e.config.volume;
                            Object.defineProperty(e.media, "volume", {
                              get: function () {
                                return a;
                              },
                              set(t) {
                                (a = t),
                                  i.setVolume(100 * a),
                                  Te.call(e, e.media, "volumechange");
                              },
                            });
                            var s = e.config.muted;
                            Object.defineProperty(e.media, "muted", {
                              get: function () {
                                return s;
                              },
                              set(t) {
                                var n = F(t) ? t : s;
                                (s = n),
                                  i[n ? "mute" : "unMute"](),
                                  i.setVolume(100 * a),
                                  Te.call(e, e.media, "volumechange");
                              },
                            }),
                              Object.defineProperty(e.media, "currentSrc", {
                                get: function () {
                                  return i.getVideoUrl();
                                },
                              }),
                              Object.defineProperty(e.media, "ended", {
                                get: function () {
                                  return e.currentTime === e.duration;
                                },
                              });
                            var o = i.getAvailablePlaybackRates();
                            (e.options.speed = o.filter(function (t) {
                              return e.config.speed.options.includes(t);
                            })),
                              e.supported.ui &&
                                t.customControls &&
                                e.media.setAttribute("tabindex", -1),
                              Te.call(e, e.media, "timeupdate"),
                              Te.call(e, e.media, "durationchange"),
                              clearInterval(e.timers.buffering),
                              (e.timers.buffering = setInterval(function () {
                                (e.media.buffered = i.getVideoLoadedFraction()),
                                  (null === e.media.lastBuffered ||
                                    e.media.lastBuffered < e.media.buffered) &&
                                    Te.call(e, e.media, "progress"),
                                  (e.media.lastBuffered = e.media.buffered),
                                  1 === e.media.buffered &&
                                    (clearInterval(e.timers.buffering),
                                    Te.call(e, e.media, "canplaythrough"));
                              }, 200)),
                              t.customControls &&
                                setTimeout(function () {
                                  return rt.build.call(e);
                                }, 50);
                          }
                        },
                        onStateChange(n) {
                          var i = n.target;
                          switch (
                            (clearInterval(e.timers.playing),
                            e.media.seeking &&
                              [1, 2].includes(n.data) &&
                              ((e.media.seeking = !1),
                              Te.call(e, e.media, "seeked")),
                            n.data)
                          ) {
                            case -1:
                              Te.call(e, e.media, "timeupdate"),
                                (e.media.buffered = i.getVideoLoadedFraction()),
                                Te.call(e, e.media, "progress");
                              break;
                            case 0:
                              dt.call(e, !1),
                                e.media.loop
                                  ? (i.stopVideo(), i.playVideo())
                                  : Te.call(e, e.media, "ended");
                              break;
                            case 1:
                              t.customControls &&
                              !e.config.autoplay &&
                              e.media.paused &&
                              !e.embed.hasPlayed
                                ? e.media.pause()
                                : (dt.call(e, !0),
                                  Te.call(e, e.media, "playing"),
                                  (e.timers.playing = setInterval(function () {
                                    Te.call(e, e.media, "timeupdate");
                                  }, 50)),
                                  e.media.duration !== i.getDuration() &&
                                    ((e.media.duration = i.getDuration()),
                                    Te.call(e, e.media, "durationchange")));
                              break;
                            case 2:
                              e.muted || e.embed.unMute(), dt.call(e, !1);
                              break;
                            case 3:
                              Te.call(e, e.media, "waiting");
                          }
                          Te.call(e, e.elements.container, "statechange", !1, {
                            code: n.data,
                          });
                        },
                      },
                    });
                  }
                },
              },
              mt = {
                setup() {
                  this.media
                    ? (ce(
                        this.elements.container,
                        this.config.classNames.type.replace("{0}", this.type),
                        !0
                      ),
                      ce(
                        this.elements.container,
                        this.config.classNames.provider.replace(
                          "{0}",
                          this.provider
                        ),
                        !0
                      ),
                      this.isEmbed &&
                        ce(
                          this.elements.container,
                          this.config.classNames.type.replace("{0}", "video"),
                          !0
                        ),
                      this.isVideo &&
                        ((this.elements.wrapper = ne("div", {
                          class: this.config.classNames.video,
                        })),
                        ee(this.media, this.elements.wrapper),
                        (this.elements.poster = ne("div", {
                          class: this.config.classNames.poster,
                        })),
                        this.elements.wrapper.appendChild(
                          this.elements.poster
                        )),
                      this.isHTML5
                        ? Oe.setup.call(this)
                        : this.isYouTube
                        ? pt.setup.call(this)
                        : this.isVimeo && ut.setup.call(this))
                    : this.debug.warn("No media element found!");
                },
              },
              ft = (function () {
                function t(n) {
                  var i = this;
                  r(this, t),
                    e(this, "load", function () {
                      i.enabled &&
                        (q(window.google) && q(window.google.ima)
                          ? i.ready()
                          : lt(i.player.config.urls.googleIMA.sdk)
                              .then(function () {
                                i.ready();
                              })
                              .catch(function () {
                                i.trigger(
                                  "error",
                                  new Error("Google IMA SDK failed to load")
                                );
                              }));
                    }),
                    e(this, "ready", function () {
                      var e;
                      i.enabled ||
                        ((e = i).manager && e.manager.destroy(),
                        e.elements.displayContainer &&
                          e.elements.displayContainer.destroy(),
                        e.elements.container.remove()),
                        i.startSafetyTimer(12e3, "ready()"),
                        i.managerPromise.then(function () {
                          i.clearSafetyTimer("onAdsManagerLoaded()");
                        }),
                        i.listeners(),
                        i.setupIMA();
                    }),
                    e(this, "setupIMA", function () {
                      (i.elements.container = ne("div", {
                        class: i.player.config.classNames.ads,
                      })),
                        i.player.elements.container.appendChild(
                          i.elements.container
                        ),
                        google.ima.settings.setVpaidMode(
                          google.ima.ImaSdkSettings.VpaidMode.ENABLED
                        ),
                        google.ima.settings.setLocale(
                          i.player.config.ads.language
                        ),
                        google.ima.settings.setDisableCustomPlaybackForIOS10Plus(
                          i.player.config.playsinline
                        ),
                        (i.elements.displayContainer =
                          new google.ima.AdDisplayContainer(
                            i.elements.container,
                            i.player.media
                          )),
                        (i.loader = new google.ima.AdsLoader(
                          i.elements.displayContainer
                        )),
                        i.loader.addEventListener(
                          google.ima.AdsManagerLoadedEvent.Type
                            .ADS_MANAGER_LOADED,
                          function (e) {
                            return i.onAdsManagerLoaded(e);
                          },
                          !1
                        ),
                        i.loader.addEventListener(
                          google.ima.AdErrorEvent.Type.AD_ERROR,
                          function (e) {
                            return i.onAdError(e);
                          },
                          !1
                        ),
                        i.requestAds();
                    }),
                    e(this, "requestAds", function () {
                      var e = i.player.elements.container;
                      try {
                        var t = new google.ima.AdsRequest();
                        (t.adTagUrl = i.tagUrl),
                          (t.linearAdSlotWidth = e.offsetWidth),
                          (t.linearAdSlotHeight = e.offsetHeight),
                          (t.nonLinearAdSlotWidth = e.offsetWidth),
                          (t.nonLinearAdSlotHeight = e.offsetHeight),
                          (t.forceNonLinearFullSlot = !1),
                          t.setAdWillPlayMuted(!i.player.muted),
                          i.loader.requestAds(t);
                      } catch (e) {
                        i.onAdError(e);
                      }
                    }),
                    e(this, "pollCountdown", function () {
                      if (
                        !(
                          arguments.length > 0 &&
                          void 0 !== arguments[0] &&
                          arguments[0]
                        )
                      )
                        return (
                          clearInterval(i.countdownTimer),
                          void i.elements.container.removeAttribute(
                            "data-badge-text"
                          )
                        );
                      i.countdownTimer = setInterval(function () {
                        var e = Ke(Math.max(i.manager.getRemainingTime(), 0)),
                          t = ""
                            .concat(
                              Ve.get("advertisement", i.player.config),
                              " - "
                            )
                            .concat(e);
                        i.elements.container.setAttribute("data-badge-text", t);
                      }, 100);
                    }),
                    e(this, "onAdsManagerLoaded", function (e) {
                      if (i.enabled) {
                        var t = new google.ima.AdsRenderingSettings();
                        (t.restoreCustomPlaybackStateOnAdBreakComplete = !0),
                          (t.enablePreloading = !0),
                          (i.manager = e.getAdsManager(i.player, t)),
                          (i.cuePoints = i.manager.getCuePoints()),
                          i.manager.addEventListener(
                            google.ima.AdErrorEvent.Type.AD_ERROR,
                            function (e) {
                              return i.onAdError(e);
                            }
                          ),
                          Object.keys(google.ima.AdEvent.Type).forEach(
                            function (e) {
                              i.manager.addEventListener(
                                google.ima.AdEvent.Type[e],
                                function (e) {
                                  return i.onAdEvent(e);
                                }
                              );
                            }
                          ),
                          i.trigger("loaded");
                      }
                    }),
                    e(this, "addCuePoints", function () {
                      $(i.cuePoints) ||
                        i.cuePoints.forEach(function (e) {
                          if (0 !== e && -1 !== e && e < i.player.duration) {
                            var t = i.player.elements.progress;
                            if (U(t)) {
                              var n = (100 / i.player.duration) * e,
                                a = ne("span", {
                                  class: i.player.config.classNames.cues,
                                });
                              (a.style.left = "".concat(n.toString(), "%")),
                                t.appendChild(a);
                            }
                          }
                        });
                    }),
                    e(this, "onAdEvent", function (e) {
                      var t = i.player.elements.container,
                        n = e.getAd(),
                        a = e.getAdData();
                      switch (
                        ((function (e) {
                          Te.call(
                            i.player,
                            i.player.media,
                            "ads".concat(e.replace(/_/g, "").toLowerCase())
                          );
                        })(e.type),
                        e.type)
                      ) {
                        case google.ima.AdEvent.Type.LOADED:
                          i.trigger("loaded"),
                            i.pollCountdown(!0),
                            n.isLinear() ||
                              ((n.width = t.offsetWidth),
                              (n.height = t.offsetHeight));
                          break;
                        case google.ima.AdEvent.Type.STARTED:
                          i.manager.setVolume(i.player.volume);
                          break;
                        case google.ima.AdEvent.Type.ALL_ADS_COMPLETED:
                          i.player.ended
                            ? i.loadAds()
                            : i.loader.contentComplete();
                          break;
                        case google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED:
                          i.pauseContent();
                          break;
                        case google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED:
                          i.pollCountdown(), i.resumeContent();
                          break;
                        case google.ima.AdEvent.Type.LOG:
                          a.adError &&
                            i.player.debug.warn(
                              "Non-fatal ad error: ".concat(
                                a.adError.getMessage()
                              )
                            );
                      }
                    }),
                    e(this, "onAdError", function (e) {
                      i.cancel(), i.player.debug.warn("Ads error", e);
                    }),
                    e(this, "listeners", function () {
                      var e,
                        t = i.player.elements.container;
                      i.player.on("canplay", function () {
                        i.addCuePoints();
                      }),
                        i.player.on("ended", function () {
                          i.loader.contentComplete();
                        }),
                        i.player.on("timeupdate", function () {
                          e = i.player.currentTime;
                        }),
                        i.player.on("seeked", function () {
                          var t = i.player.currentTime;
                          $(i.cuePoints) ||
                            i.cuePoints.forEach(function (n, a) {
                              e < n &&
                                n < t &&
                                (i.manager.discardAdBreak(),
                                i.cuePoints.splice(a, 1));
                            });
                        }),
                        window.addEventListener("resize", function () {
                          i.manager &&
                            i.manager.resize(
                              t.offsetWidth,
                              t.offsetHeight,
                              google.ima.ViewMode.NORMAL
                            );
                        });
                    }),
                    e(this, "play", function () {
                      var e = i.player.elements.container;
                      i.managerPromise || i.resumeContent(),
                        i.managerPromise
                          .then(function () {
                            i.manager.setVolume(i.player.volume),
                              i.elements.displayContainer.initialize();
                            try {
                              i.initialized ||
                                (i.manager.init(
                                  e.offsetWidth,
                                  e.offsetHeight,
                                  google.ima.ViewMode.NORMAL
                                ),
                                i.manager.start()),
                                (i.initialized = !0);
                            } catch (e) {
                              i.onAdError(e);
                            }
                          })
                          .catch(function () {});
                    }),
                    e(this, "resumeContent", function () {
                      (i.elements.container.style.zIndex = ""),
                        (i.playing = !1),
                        Ce(i.player.media.play());
                    }),
                    e(this, "pauseContent", function () {
                      (i.elements.container.style.zIndex = 3),
                        (i.playing = !0),
                        i.player.media.pause();
                    }),
                    e(this, "cancel", function () {
                      i.initialized && i.resumeContent(),
                        i.trigger("error"),
                        i.loadAds();
                    }),
                    e(this, "loadAds", function () {
                      i.managerPromise
                        .then(function () {
                          i.manager && i.manager.destroy(),
                            (i.managerPromise = new Promise(function (e) {
                              i.on("loaded", e), i.player.debug.log(i.manager);
                            })),
                            (i.initialized = !1),
                            i.requestAds();
                        })
                        .catch(function () {});
                    }),
                    e(this, "trigger", function (e) {
                      for (
                        var t = arguments.length,
                          n = new Array(t > 1 ? t - 1 : 0),
                          a = 1;
                        a < t;
                        a++
                      )
                        n[a - 1] = arguments[a];
                      var r = i.events[e];
                      V(r) &&
                        r.forEach(function (e) {
                          R(e) && e.apply(i, n);
                        });
                    }),
                    e(this, "on", function (e, t) {
                      return (
                        V(i.events[e]) || (i.events[e] = []),
                        i.events[e].push(t),
                        i
                      );
                    }),
                    e(this, "startSafetyTimer", function (e, t) {
                      i.player.debug.log(
                        "Safety timer invoked from: ".concat(t)
                      ),
                        (i.safetyTimer = setTimeout(function () {
                          i.cancel(), i.clearSafetyTimer("startSafetyTimer()");
                        }, e));
                    }),
                    e(this, "clearSafetyTimer", function (e) {
                      O(i.safetyTimer) ||
                        (i.player.debug.log(
                          "Safety timer cleared from: ".concat(e)
                        ),
                        clearTimeout(i.safetyTimer),
                        (i.safetyTimer = null));
                    }),
                    (this.player = n),
                    (this.config = n.config.ads),
                    (this.playing = !1),
                    (this.initialized = !1),
                    (this.elements = {
                      container: null,
                      displayContainer: null,
                    }),
                    (this.manager = null),
                    (this.loader = null),
                    (this.cuePoints = null),
                    (this.events = {}),
                    (this.safetyTimer = null),
                    (this.countdownTimer = null),
                    (this.managerPromise = new Promise(function (e, t) {
                      i.on("loaded", e), i.on("error", t);
                    })),
                    this.load();
                }
                return (
                  o(t, [
                    {
                      key: "enabled",
                      get: function () {
                        var e = this.config;
                        return (
                          this.player.isHTML5 &&
                          this.player.isVideo &&
                          e.enabled &&
                          (!$(e.publisherId) || Y(e.tagUrl))
                        );
                      },
                    },
                    {
                      key: "tagUrl",
                      get: function () {
                        var e = this.config;
                        return Y(e.tagUrl)
                          ? e.tagUrl
                          : "https://go.aniview.com/api/adserver6/vast/?".concat(
                              Qe({
                                AV_PUBLISHERID: "58c25bb0073ef448b1087ad6",
                                AV_CHANNELID: "5a0458dc28a06145e4519d21",
                                AV_URL: window.location.hostname,
                                cb: Date.now(),
                                AV_WIDTH: 640,
                                AV_HEIGHT: 480,
                                AV_CDIM2: e.publisherId,
                              })
                            );
                      },
                    },
                  ]),
                  t
                );
              })();
            function gt() {
              var e =
                  arguments.length > 0 && void 0 !== arguments[0]
                    ? arguments[0]
                    : 0,
                t =
                  arguments.length > 1 && void 0 !== arguments[1]
                    ? arguments[1]
                    : 0,
                n =
                  arguments.length > 2 && void 0 !== arguments[2]
                    ? arguments[2]
                    : 255;
              return Math.min(Math.max(e, t), n);
            }
            var yt,
              vt = function (e) {
                var t = [];
                return (
                  e.split(/\r\n\r\n|\n\n|\r\r/).forEach(function (e) {
                    var n = {};
                    e.split(/\r\n|\n|\r/).forEach(function (e) {
                      if (D(n.startTime)) {
                        if (!$(e.trim()) && $(n.text)) {
                          var t,
                            i,
                            a = e.trim().split("#xywh=");
                          (t = d(a, 1)),
                            (n.text = t[0]),
                            a[1] &&
                              ((i = d(a[1].split(","), 4)),
                              (n.x = i[0]),
                              (n.y = i[1]),
                              (n.w = i[2]),
                              (n.h = i[3]));
                        }
                      } else {
                        var r = e.match(
                          /([0-9]{2})?:?([0-9]{2}):([0-9]{2}).([0-9]{2,3})( ?--> ?)([0-9]{2})?:?([0-9]{2}):([0-9]{2}).([0-9]{2,3})/
                        );
                        r &&
                          ((n.startTime =
                            60 * Number(r[1] || 0) * 60 +
                            60 * Number(r[2]) +
                            Number(r[3]) +
                            Number("0.".concat(r[4]))),
                          (n.endTime =
                            60 * Number(r[6] || 0) * 60 +
                            60 * Number(r[7]) +
                            Number(r[8]) +
                            Number("0.".concat(r[9]))));
                      }
                    }),
                      n.text && t.push(n);
                  }),
                  t
                );
              },
              bt = function (e, t) {
                var n = {};
                return (
                  e > t.width / t.height
                    ? ((n.width = t.width), (n.height = (1 / e) * t.width))
                    : ((n.height = t.height), (n.width = e * t.height)),
                  n
                );
              },
              wt = (function () {
                function t(n) {
                  var i = this;
                  r(this, t),
                    e(this, "load", function () {
                      i.player.elements.display.seekTooltip &&
                        (i.player.elements.display.seekTooltip.hidden =
                          i.enabled),
                        i.enabled &&
                          i.getThumbnails().then(function () {
                            i.enabled &&
                              (i.render(),
                              i.determineContainerAutoSizing(),
                              (i.loaded = !0));
                          });
                    }),
                    e(this, "getThumbnails", function () {
                      return new Promise(function (e) {
                        var t = i.player.config.previewThumbnails.src;
                        if ($(t))
                          throw new Error(
                            "Missing previewThumbnails.src config attribute"
                          );
                        var n = function () {
                          i.thumbnails.sort(function (e, t) {
                            return e.height - t.height;
                          }),
                            i.player.debug.log(
                              "Preview thumbnails",
                              i.thumbnails
                            ),
                            e();
                        };
                        if (R(t))
                          t(function (e) {
                            (i.thumbnails = e), n();
                          });
                        else {
                          var a = (H(t) ? [t] : t).map(function (e) {
                            return i.getThumbnail(e);
                          });
                          Promise.all(a).then(n);
                        }
                      });
                    }),
                    e(this, "getThumbnail", function (e) {
                      return new Promise(function (t) {
                        Ue(e).then(function (n) {
                          var a = {
                            frames: vt(n),
                            height: null,
                            urlPrefix: "",
                          };
                          a.frames[0].text.startsWith("/") ||
                            a.frames[0].text.startsWith("http://") ||
                            a.frames[0].text.startsWith("https://") ||
                            (a.urlPrefix = e.substring(
                              0,
                              e.lastIndexOf("/") + 1
                            ));
                          var r = new Image();
                          (r.onload = function () {
                            (a.height = r.naturalHeight),
                              (a.width = r.naturalWidth),
                              i.thumbnails.push(a),
                              t();
                          }),
                            (r.src = a.urlPrefix + a.frames[0].text);
                        });
                      });
                    }),
                    e(this, "startMove", function (e) {
                      if (
                        i.loaded &&
                        W(e) &&
                        ["touchmove", "mousemove"].includes(e.type) &&
                        i.player.media.duration
                      ) {
                        if ("touchmove" === e.type)
                          i.seekTime =
                            i.player.media.duration *
                            (i.player.elements.inputs.seek.value / 100);
                        else {
                          var t,
                            n,
                            a =
                              i.player.elements.progress.getBoundingClientRect(),
                            r = (100 / a.width) * (e.pageX - a.left);
                          (i.seekTime = i.player.media.duration * (r / 100)),
                            i.seekTime < 0 && (i.seekTime = 0),
                            i.seekTime > i.player.media.duration - 1 &&
                              (i.seekTime = i.player.media.duration - 1),
                            (i.mousePosX = e.pageX),
                            (i.elements.thumb.time.innerText = Ke(i.seekTime));
                          var s =
                            null === (t = i.player.config.markers) ||
                            void 0 === t ||
                            null === (n = t.points) ||
                            void 0 === n
                              ? void 0
                              : n.find(function (e) {
                                  return e.time === Math.round(i.seekTime);
                                });
                          s &&
                            i.elements.thumb.time.insertAdjacentHTML(
                              "afterbegin",
                              "".concat(s.label, "<br>")
                            );
                        }
                        i.showImageAtCurrentTime();
                      }
                    }),
                    e(this, "endMove", function () {
                      i.toggleThumbContainer(!1, !0);
                    }),
                    e(this, "startScrubbing", function (e) {
                      (O(e.button) || !1 === e.button || 0 === e.button) &&
                        ((i.mouseDown = !0),
                        i.player.media.duration &&
                          (i.toggleScrubbingContainer(!0),
                          i.toggleThumbContainer(!1, !0),
                          i.showImageAtCurrentTime()));
                    }),
                    e(this, "endScrubbing", function () {
                      (i.mouseDown = !1),
                        Math.ceil(i.lastTime) ===
                        Math.ceil(i.player.media.currentTime)
                          ? i.toggleScrubbingContainer(!1)
                          : ke.call(
                              i.player,
                              i.player.media,
                              "timeupdate",
                              function () {
                                i.mouseDown || i.toggleScrubbingContainer(!1);
                              }
                            );
                    }),
                    e(this, "listeners", function () {
                      i.player.on("play", function () {
                        i.toggleThumbContainer(!1, !0);
                      }),
                        i.player.on("seeked", function () {
                          i.toggleThumbContainer(!1);
                        }),
                        i.player.on("timeupdate", function () {
                          i.lastTime = i.player.media.currentTime;
                        });
                    }),
                    e(this, "render", function () {
                      (i.elements.thumb.container = ne("div", {
                        class:
                          i.player.config.classNames.previewThumbnails
                            .thumbContainer,
                      })),
                        (i.elements.thumb.imageContainer = ne("div", {
                          class:
                            i.player.config.classNames.previewThumbnails
                              .imageContainer,
                        })),
                        i.elements.thumb.container.appendChild(
                          i.elements.thumb.imageContainer
                        );
                      var e = ne("div", {
                        class:
                          i.player.config.classNames.previewThumbnails
                            .timeContainer,
                      });
                      (i.elements.thumb.time = ne("span", {}, "00:00")),
                        e.appendChild(i.elements.thumb.time),
                        i.elements.thumb.imageContainer.appendChild(e),
                        U(i.player.elements.progress) &&
                          i.player.elements.progress.appendChild(
                            i.elements.thumb.container
                          ),
                        (i.elements.scrubbing.container = ne("div", {
                          class:
                            i.player.config.classNames.previewThumbnails
                              .scrubbingContainer,
                        })),
                        i.player.elements.wrapper.appendChild(
                          i.elements.scrubbing.container
                        );
                    }),
                    e(this, "destroy", function () {
                      i.elements.thumb.container &&
                        i.elements.thumb.container.remove(),
                        i.elements.scrubbing.container &&
                          i.elements.scrubbing.container.remove();
                    }),
                    e(this, "showImageAtCurrentTime", function () {
                      i.mouseDown
                        ? i.setScrubbingContainerSize()
                        : i.setThumbContainerSizeAndPos();
                      var e = i.thumbnails[0].frames.findIndex(function (e) {
                          return (
                            i.seekTime >= e.startTime && i.seekTime <= e.endTime
                          );
                        }),
                        t = e >= 0,
                        n = 0;
                      i.mouseDown || i.toggleThumbContainer(t),
                        t &&
                          (i.thumbnails.forEach(function (t, a) {
                            i.loadedImages.includes(t.frames[e].text) &&
                              (n = a);
                          }),
                          e !== i.showingThumb &&
                            ((i.showingThumb = e), i.loadImage(n)));
                    }),
                    e(this, "loadImage", function () {
                      var e =
                          arguments.length > 0 && void 0 !== arguments[0]
                            ? arguments[0]
                            : 0,
                        t = i.showingThumb,
                        n = i.thumbnails[e],
                        a = n.urlPrefix,
                        r = n.frames[t],
                        s = n.frames[t].text,
                        o = a + s;
                      if (
                        i.currentImageElement &&
                        i.currentImageElement.dataset.filename === s
                      )
                        i.showImage(i.currentImageElement, r, e, t, s, !1),
                          (i.currentImageElement.dataset.index = t),
                          i.removeOldImages(i.currentImageElement);
                      else {
                        i.loadingImage &&
                          i.usingSprites &&
                          (i.loadingImage.onload = null);
                        var l = new Image();
                        (l.src = o),
                          (l.dataset.index = t),
                          (l.dataset.filename = s),
                          (i.showingThumbFilename = s),
                          i.player.debug.log("Loading image: ".concat(o)),
                          (l.onload = function () {
                            return i.showImage(l, r, e, t, s, !0);
                          }),
                          (i.loadingImage = l),
                          i.removeOldImages(l);
                      }
                    }),
                    e(this, "showImage", function (e, t, n, a, r) {
                      var s =
                        !(arguments.length > 5 && void 0 !== arguments[5]) ||
                        arguments[5];
                      i.player.debug.log(
                        "Showing thumb: "
                          .concat(r, ". num: ")
                          .concat(a, ". qual: ")
                          .concat(n, ". newimg: ")
                          .concat(s)
                      ),
                        i.setImageSizeAndOffset(e, t),
                        s &&
                          (i.currentImageContainer.appendChild(e),
                          (i.currentImageElement = e),
                          i.loadedImages.includes(r) || i.loadedImages.push(r)),
                        i
                          .preloadNearby(a, !0)
                          .then(i.preloadNearby(a, !1))
                          .then(i.getHigherQuality(n, e, t, r));
                    }),
                    e(this, "removeOldImages", function (e) {
                      Array.from(i.currentImageContainer.children).forEach(
                        function (t) {
                          if ("img" === t.tagName.toLowerCase()) {
                            var n = i.usingSprites ? 500 : 1e3;
                            if (
                              t.dataset.index !== e.dataset.index &&
                              !t.dataset.deleting
                            ) {
                              t.dataset.deleting = !0;
                              var a = i.currentImageContainer;
                              setTimeout(function () {
                                a.removeChild(t),
                                  i.player.debug.log(
                                    "Removing thumb: ".concat(
                                      t.dataset.filename
                                    )
                                  );
                              }, n);
                            }
                          }
                        }
                      );
                    }),
                    e(this, "preloadNearby", function (e) {
                      var t =
                        !(arguments.length > 1 && void 0 !== arguments[1]) ||
                        arguments[1];
                      return new Promise(function (n) {
                        setTimeout(function () {
                          var a = i.thumbnails[0].frames[e].text;
                          if (i.showingThumbFilename === a) {
                            var r;
                            r = t
                              ? i.thumbnails[0].frames.slice(e)
                              : i.thumbnails[0].frames.slice(0, e).reverse();
                            var s = !1;
                            r.forEach(function (e) {
                              var t = e.text;
                              if (t !== a && !i.loadedImages.includes(t)) {
                                (s = !0),
                                  i.player.debug.log(
                                    "Preloading thumb filename: ".concat(t)
                                  );
                                var r = i.thumbnails[0].urlPrefix + t,
                                  o = new Image();
                                (o.src = r),
                                  (o.onload = function () {
                                    i.player.debug.log(
                                      "Preloaded thumb filename: ".concat(t)
                                    ),
                                      i.loadedImages.includes(t) ||
                                        i.loadedImages.push(t),
                                      n();
                                  });
                              }
                            }),
                              s || n();
                          }
                        }, 300);
                      });
                    }),
                    e(this, "getHigherQuality", function (e, t, n, a) {
                      if (e < i.thumbnails.length - 1) {
                        var r = t.naturalHeight;
                        i.usingSprites && (r = n.h),
                          r < i.thumbContainerHeight &&
                            setTimeout(function () {
                              i.showingThumbFilename === a &&
                                (i.player.debug.log(
                                  "Showing higher quality thumb for: ".concat(a)
                                ),
                                i.loadImage(e + 1));
                            }, 300);
                      }
                    }),
                    e(this, "toggleThumbContainer", function () {
                      var e =
                          arguments.length > 0 &&
                          void 0 !== arguments[0] &&
                          arguments[0],
                        t =
                          arguments.length > 1 &&
                          void 0 !== arguments[1] &&
                          arguments[1],
                        n =
                          i.player.config.classNames.previewThumbnails
                            .thumbContainerShown;
                      i.elements.thumb.container.classList.toggle(n, e),
                        !e &&
                          t &&
                          ((i.showingThumb = null),
                          (i.showingThumbFilename = null));
                    }),
                    e(this, "toggleScrubbingContainer", function () {
                      var e =
                          arguments.length > 0 &&
                          void 0 !== arguments[0] &&
                          arguments[0],
                        t =
                          i.player.config.classNames.previewThumbnails
                            .scrubbingContainerShown;
                      i.elements.scrubbing.container.classList.toggle(t, e),
                        e ||
                          ((i.showingThumb = null),
                          (i.showingThumbFilename = null));
                    }),
                    e(this, "determineContainerAutoSizing", function () {
                      (i.elements.thumb.imageContainer.clientHeight > 20 ||
                        i.elements.thumb.imageContainer.clientWidth > 20) &&
                        (i.sizeSpecifiedInCSS = !0);
                    }),
                    e(this, "setThumbContainerSizeAndPos", function () {
                      var e = i.elements.thumb.imageContainer;
                      if (i.sizeSpecifiedInCSS) {
                        if (e.clientHeight > 20 && e.clientWidth < 20) {
                          var t = Math.floor(
                            e.clientHeight * i.thumbAspectRatio
                          );
                          e.style.width = "".concat(t, "px");
                        } else if (e.clientHeight < 20 && e.clientWidth > 20) {
                          var n = Math.floor(
                            e.clientWidth / i.thumbAspectRatio
                          );
                          e.style.height = "".concat(n, "px");
                        }
                      } else {
                        var a = Math.floor(
                          i.thumbContainerHeight * i.thumbAspectRatio
                        );
                        (e.style.height = "".concat(
                          i.thumbContainerHeight,
                          "px"
                        )),
                          (e.style.width = "".concat(a, "px"));
                      }
                      i.setThumbContainerPos();
                    }),
                    e(this, "setThumbContainerPos", function () {
                      var e =
                          i.player.elements.progress.getBoundingClientRect(),
                        t = i.player.elements.container.getBoundingClientRect(),
                        n = i.elements.thumb.container,
                        a = t.left - e.left + 10,
                        r = t.right - e.left - n.clientWidth - 10,
                        s = i.mousePosX - e.left - n.clientWidth / 2,
                        o = gt(s, a, r);
                      (n.style.left = "".concat(o, "px")),
                        n.style.setProperty(
                          "--preview-arrow-offset",
                          s - o + "px"
                        );
                    }),
                    e(this, "setScrubbingContainerSize", function () {
                      var e = bt(i.thumbAspectRatio, {
                          width: i.player.media.clientWidth,
                          height: i.player.media.clientHeight,
                        }),
                        t = e.width,
                        n = e.height;
                      (i.elements.scrubbing.container.style.width = "".concat(
                        t,
                        "px"
                      )),
                        (i.elements.scrubbing.container.style.height =
                          "".concat(n, "px"));
                    }),
                    e(this, "setImageSizeAndOffset", function (e, t) {
                      if (i.usingSprites) {
                        var n = i.thumbContainerHeight / t.h;
                        (e.style.height = e.naturalHeight * n + "px"),
                          (e.style.width = e.naturalWidth * n + "px"),
                          (e.style.left = "-".concat(t.x * n, "px")),
                          (e.style.top = "-".concat(t.y * n, "px"));
                      }
                    }),
                    (this.player = n),
                    (this.thumbnails = []),
                    (this.loaded = !1),
                    (this.lastMouseMoveTime = Date.now()),
                    (this.mouseDown = !1),
                    (this.loadedImages = []),
                    (this.elements = { thumb: {}, scrubbing: {} }),
                    this.load();
                }
                return (
                  o(t, [
                    {
                      key: "enabled",
                      get: function () {
                        return (
                          this.player.isHTML5 &&
                          this.player.isVideo &&
                          this.player.config.previewThumbnails.enabled
                        );
                      },
                    },
                    {
                      key: "currentImageContainer",
                      get: function () {
                        return this.mouseDown
                          ? this.elements.scrubbing.container
                          : this.elements.thumb.imageContainer;
                      },
                    },
                    {
                      key: "usingSprites",
                      get: function () {
                        return Object.keys(
                          this.thumbnails[0].frames[0]
                        ).includes("w");
                      },
                    },
                    {
                      key: "thumbAspectRatio",
                      get: function () {
                        return this.usingSprites
                          ? this.thumbnails[0].frames[0].w /
                              this.thumbnails[0].frames[0].h
                          : this.thumbnails[0].width /
                              this.thumbnails[0].height;
                      },
                    },
                    {
                      key: "thumbContainerHeight",
                      get: function () {
                        return this.mouseDown
                          ? bt(this.thumbAspectRatio, {
                              width: this.player.media.clientWidth,
                              height: this.player.media.clientHeight,
                            }).height
                          : this.sizeSpecifiedInCSS
                          ? this.elements.thumb.imageContainer.clientHeight
                          : Math.floor(
                              this.player.media.clientWidth /
                                this.thumbAspectRatio /
                                4
                            );
                      },
                    },
                    {
                      key: "currentImageElement",
                      get: function () {
                        return this.mouseDown
                          ? this.currentScrubbingImageElement
                          : this.currentThumbnailImageElement;
                      },
                      set: function (e) {
                        this.mouseDown
                          ? (this.currentScrubbingImageElement = e)
                          : (this.currentThumbnailImageElement = e);
                      },
                    },
                  ]),
                  t
                );
              })(),
              kt = {
                insertElements(e, t) {
                  var n = this;
                  H(t)
                    ? ie(e, this.media, { src: t })
                    : V(t) &&
                      t.forEach(function (t) {
                        ie(e, n.media, t);
                      });
                },
                change(e) {
                  var t = this;
                  G(e, "sources.length")
                    ? (Oe.cancelRequests.call(this),
                      this.destroy.call(
                        this,
                        function () {
                          (t.options.quality = []),
                            ae(t.media),
                            (t.media = null),
                            U(t.elements.container) &&
                              t.elements.container.removeAttribute("class");
                          var n = e.sources,
                            i = e.type,
                            a = d(n, 1)[0],
                            r = a.provider,
                            s = void 0 === r ? Ze.html5 : r,
                            o = a.src,
                            l = "html5" === s ? i : "div",
                            c = "html5" === s ? {} : { src: o };
                          Object.assign(t, {
                            provider: s,
                            type: i,
                            supported: ge.check(i, s, t.config.playsinline),
                            media: ne(l, c),
                          }),
                            t.elements.container.appendChild(t.media),
                            F(e.autoplay) && (t.config.autoplay = e.autoplay),
                            t.isHTML5 &&
                              (t.config.crossorigin &&
                                t.media.setAttribute("crossorigin", ""),
                              t.config.autoplay &&
                                t.media.setAttribute("autoplay", ""),
                              $(e.poster) || (t.poster = e.poster),
                              t.config.loop.active &&
                                t.media.setAttribute("loop", ""),
                              t.config.muted &&
                                t.media.setAttribute("muted", ""),
                              t.config.playsinline &&
                                t.media.setAttribute("playsinline", "")),
                            rt.addStyleHook.call(t),
                            t.isHTML5 && kt.insertElements.call(t, "source", n),
                            (t.config.title = e.title),
                            mt.setup.call(t),
                            t.isHTML5 &&
                              Object.keys(e).includes("tracks") &&
                              kt.insertElements.call(t, "track", e.tracks),
                            (t.isHTML5 || (t.isEmbed && !t.supported.ui)) &&
                              rt.build.call(t),
                            t.isHTML5 && t.media.load(),
                            $(e.previewThumbnails) ||
                              (Object.assign(
                                t.config.previewThumbnails,
                                e.previewThumbnails
                              ),
                              t.previewThumbnails &&
                                t.previewThumbnails.loaded &&
                                (t.previewThumbnails.destroy(),
                                (t.previewThumbnails = null)),
                              t.config.previewThumbnails.enabled &&
                                (t.previewThumbnails = new wt(t))),
                            t.fullscreen.update();
                        },
                        !0
                      ))
                    : this.debug.warn("Invalid source format");
                },
              },
              Tt = (function () {
                function t(n, i) {
                  var a = this;
                  if (
                    (r(this, t),
                    e(this, "play", function () {
                      return R(a.media.play)
                        ? (a.ads &&
                            a.ads.enabled &&
                            a.ads.managerPromise
                              .then(function () {
                                return a.ads.play();
                              })
                              .catch(function () {
                                return Ce(a.media.play());
                              }),
                          a.media.play())
                        : null;
                    }),
                    e(this, "pause", function () {
                      return a.playing && R(a.media.pause)
                        ? a.media.pause()
                        : null;
                    }),
                    e(this, "togglePlay", function (e) {
                      return (F(e) ? e : !a.playing) ? a.play() : a.pause();
                    }),
                    e(this, "stop", function () {
                      a.isHTML5
                        ? (a.pause(), a.restart())
                        : R(a.media.stop) && a.media.stop();
                    }),
                    e(this, "restart", function () {
                      a.currentTime = 0;
                    }),
                    e(this, "rewind", function (e) {
                      a.currentTime -= D(e) ? e : a.config.seekTime;
                    }),
                    e(this, "forward", function (e) {
                      a.currentTime += D(e) ? e : a.config.seekTime;
                    }),
                    e(this, "increaseVolume", function (e) {
                      var t = a.media.muted ? 0 : a.volume;
                      a.volume = t + (D(e) ? e : 0);
                    }),
                    e(this, "decreaseVolume", function (e) {
                      a.increaseVolume(-e);
                    }),
                    e(this, "airplay", function () {
                      ge.airplay && a.media.webkitShowPlaybackTargetPicker();
                    }),
                    e(this, "toggleControls", function (e) {
                      if (a.supported.ui && !a.isAudio) {
                        var t = ue(
                            a.elements.container,
                            a.config.classNames.hideControls
                          ),
                          n = void 0 === e ? void 0 : !e,
                          i = ce(
                            a.elements.container,
                            a.config.classNames.hideControls,
                            n
                          );
                        if (
                          (i &&
                            V(a.config.controls) &&
                            a.config.controls.includes("settings") &&
                            !$(a.config.settings) &&
                            Ye.toggleMenu.call(a, !1),
                          i !== t)
                        ) {
                          var r = i ? "controlshidden" : "controlsshown";
                          Te.call(a, a.media, r);
                        }
                        return !i;
                      }
                      return !1;
                    }),
                    e(this, "on", function (e, t) {
                      be.call(a, a.elements.container, e, t);
                    }),
                    e(this, "once", function (e, t) {
                      ke.call(a, a.elements.container, e, t);
                    }),
                    e(this, "off", function (e, t) {
                      we(a.elements.container, e, t);
                    }),
                    e(this, "destroy", function (e) {
                      var t =
                        arguments.length > 1 &&
                        void 0 !== arguments[1] &&
                        arguments[1];
                      if (a.ready) {
                        var n = function () {
                          (document.body.style.overflow = ""),
                            (a.embed = null),
                            t
                              ? (Object.keys(a.elements).length &&
                                  (ae(a.elements.buttons.play),
                                  ae(a.elements.captions),
                                  ae(a.elements.controls),
                                  ae(a.elements.wrapper),
                                  (a.elements.buttons.play = null),
                                  (a.elements.captions = null),
                                  (a.elements.controls = null),
                                  (a.elements.wrapper = null)),
                                R(e) && e())
                              : (Se.call(a),
                                Oe.cancelRequests.call(a),
                                se(a.elements.original, a.elements.container),
                                Te.call(
                                  a,
                                  a.elements.original,
                                  "destroyed",
                                  !0
                                ),
                                R(e) && e.call(a.elements.original),
                                (a.ready = !1),
                                setTimeout(function () {
                                  (a.elements = null), (a.media = null);
                                }, 200));
                        };
                        a.stop(),
                          clearTimeout(a.timers.loading),
                          clearTimeout(a.timers.controls),
                          clearTimeout(a.timers.resized),
                          a.isHTML5
                            ? (rt.toggleNativeControls.call(a, !0), n())
                            : a.isYouTube
                            ? (clearInterval(a.timers.buffering),
                              clearInterval(a.timers.playing),
                              null !== a.embed &&
                                R(a.embed.destroy) &&
                                a.embed.destroy(),
                              n())
                            : a.isVimeo &&
                              (null !== a.embed && a.embed.unload().then(n),
                              setTimeout(n, 200));
                      }
                    }),
                    e(this, "supports", function (e) {
                      return ge.mime.call(a, e);
                    }),
                    (this.timers = {}),
                    (this.ready = !1),
                    (this.loading = !1),
                    (this.failed = !1),
                    (this.touch = ge.touch),
                    (this.media = n),
                    H(this.media) &&
                      (this.media = document.querySelectorAll(this.media)),
                    ((window.jQuery && this.media instanceof jQuery) ||
                      B(this.media) ||
                      V(this.media)) &&
                      (this.media = this.media[0]),
                    (this.config = Z(
                      {},
                      Je,
                      t.defaults,
                      i || {},
                      (function () {
                        try {
                          return JSON.parse(
                            a.media.getAttribute("data-plyr-config")
                          );
                        } catch (e) {
                          return {};
                        }
                      })()
                    )),
                    (this.elements = {
                      container: null,
                      fullscreen: null,
                      captions: null,
                      buttons: {},
                      display: {},
                      progress: {},
                      inputs: {},
                      settings: {
                        popup: null,
                        menu: null,
                        panels: {},
                        buttons: {},
                      },
                    }),
                    (this.captions = {
                      active: null,
                      currentTrack: -1,
                      meta: new WeakMap(),
                    }),
                    (this.fullscreen = { active: !1 }),
                    (this.options = { speed: [], quality: [] }),
                    (this.debug = new nt(this.config.debug)),
                    this.debug.log("Config", this.config),
                    this.debug.log("Support", ge),
                    !O(this.media) && U(this.media))
                  )
                    if (this.media.plyr)
                      this.debug.warn("Target already setup");
                    else if (this.config.enabled)
                      if (ge.check().api) {
                        var s = this.media.cloneNode(!0);
                        (s.autoplay = !1), (this.elements.original = s);
                        var o = this.media.tagName.toLowerCase(),
                          l = null,
                          c = null;
                        switch (o) {
                          case "div":
                            if (
                              ((l = this.media.querySelector("iframe")), U(l))
                            ) {
                              if (
                                ((c = $e(l.getAttribute("src"))),
                                (this.provider = (function (e) {
                                  return /^(https?:\/\/)?(www\.)?(youtube\.com|youtube-nocookie\.com|youtu\.?be)\/.+$/.test(
                                    e
                                  )
                                    ? Ze.youtube
                                    : /^https?:\/\/player.vimeo.com\/video\/\d{0,9}(?=\b|\/)/.test(
                                        e
                                      )
                                    ? Ze.vimeo
                                    : null;
                                })(c.toString())),
                                (this.elements.container = this.media),
                                (this.media = l),
                                (this.elements.container.className = ""),
                                c.search.length)
                              ) {
                                var u = ["1", "true"];
                                u.includes(c.searchParams.get("autoplay")) &&
                                  (this.config.autoplay = !0),
                                  u.includes(c.searchParams.get("loop")) &&
                                    (this.config.loop.active = !0),
                                  this.isYouTube
                                    ? ((this.config.playsinline = u.includes(
                                        c.searchParams.get("playsinline")
                                      )),
                                      (this.config.youtube.hl =
                                        c.searchParams.get("hl")))
                                    : (this.config.playsinline = !0);
                              }
                            } else
                              (this.provider = this.media.getAttribute(
                                this.config.attributes.embed.provider
                              )),
                                this.media.removeAttribute(
                                  this.config.attributes.embed.provider
                                );
                            if (
                              $(this.provider) ||
                              !Object.values(Ze).includes(this.provider)
                            )
                              return void this.debug.error(
                                "Setup failed: Invalid provider"
                              );
                            this.type = et;
                            break;
                          case "video":
                          case "audio":
                            (this.type = o),
                              (this.provider = Ze.html5),
                              this.media.hasAttribute("crossorigin") &&
                                (this.config.crossorigin = !0),
                              this.media.hasAttribute("autoplay") &&
                                (this.config.autoplay = !0),
                              (this.media.hasAttribute("playsinline") ||
                                this.media.hasAttribute(
                                  "webkit-playsinline"
                                )) &&
                                (this.config.playsinline = !0),
                              this.media.hasAttribute("muted") &&
                                (this.config.muted = !0),
                              this.media.hasAttribute("loop") &&
                                (this.config.loop.active = !0);
                            break;
                          default:
                            return void this.debug.error(
                              "Setup failed: unsupported type"
                            );
                        }
                        (this.supported = ge.check(
                          this.type,
                          this.provider,
                          this.config.playsinline
                        )),
                          this.supported.api
                            ? ((this.eventListeners = []),
                              (this.listeners = new st(this)),
                              (this.storage = new Be(this)),
                              (this.media.plyr = this),
                              U(this.elements.container) ||
                                ((this.elements.container = ne("div", {
                                  tabindex: 0,
                                })),
                                ee(this.media, this.elements.container)),
                              rt.migrateStyles.call(this),
                              rt.addStyleHook.call(this),
                              mt.setup.call(this),
                              this.config.debug &&
                                be.call(
                                  this,
                                  this.elements.container,
                                  this.config.events.join(" "),
                                  function (e) {
                                    a.debug.log("event: ".concat(e.type));
                                  }
                                ),
                              (this.fullscreen = new it(this)),
                              (this.isHTML5 ||
                                (this.isEmbed && !this.supported.ui)) &&
                                rt.build.call(this),
                              this.listeners.container(),
                              this.listeners.global(),
                              this.config.ads.enabled &&
                                (this.ads = new ft(this)),
                              this.isHTML5 &&
                                this.config.autoplay &&
                                this.once("canplay", function () {
                                  return Ce(a.play());
                                }),
                              (this.lastSeekTime = 0),
                              this.config.previewThumbnails.enabled &&
                                (this.previewThumbnails = new wt(this)))
                            : this.debug.error("Setup failed: no support");
                      } else this.debug.error("Setup failed: no support");
                    else this.debug.error("Setup failed: disabled by config");
                  else
                    this.debug.error(
                      "Setup failed: no suitable element passed"
                    );
                }
                return (
                  o(
                    t,
                    [
                      {
                        key: "isHTML5",
                        get: function () {
                          return this.provider === Ze.html5;
                        },
                      },
                      {
                        key: "isEmbed",
                        get: function () {
                          return this.isYouTube || this.isVimeo;
                        },
                      },
                      {
                        key: "isYouTube",
                        get: function () {
                          return this.provider === Ze.youtube;
                        },
                      },
                      {
                        key: "isVimeo",
                        get: function () {
                          return this.provider === Ze.vimeo;
                        },
                      },
                      {
                        key: "isVideo",
                        get: function () {
                          return this.type === et;
                        },
                      },
                      {
                        key: "isAudio",
                        get: function () {
                          return "audio" === this.type;
                        },
                      },
                      {
                        key: "playing",
                        get: function () {
                          return Boolean(
                            this.ready && !this.paused && !this.ended
                          );
                        },
                      },
                      {
                        key: "paused",
                        get: function () {
                          return Boolean(this.media.paused);
                        },
                      },
                      {
                        key: "stopped",
                        get: function () {
                          return Boolean(this.paused && 0 === this.currentTime);
                        },
                      },
                      {
                        key: "ended",
                        get: function () {
                          return Boolean(this.media.ended);
                        },
                      },
                      {
                        key: "currentTime",
                        get: function () {
                          return Number(this.media.currentTime);
                        },
                        set: function (e) {
                          if (this.duration) {
                            var t = D(e) && e > 0;
                            (this.media.currentTime = t
                              ? Math.min(e, this.duration)
                              : 0),
                              this.debug.log(
                                "Seeking to ".concat(
                                  this.currentTime,
                                  " seconds"
                                )
                              );
                          }
                        },
                      },
                      {
                        key: "buffered",
                        get: function () {
                          var e = this.media.buffered;
                          return D(e)
                            ? e
                            : e && e.length && this.duration > 0
                            ? e.end(0) / this.duration
                            : 0;
                        },
                      },
                      {
                        key: "seeking",
                        get: function () {
                          return Boolean(this.media.seeking);
                        },
                      },
                      {
                        key: "duration",
                        get: function () {
                          var e = parseFloat(this.config.duration),
                            t = (this.media || {}).duration,
                            n = D(t) && t !== 1 / 0 ? t : 0;
                          return e || n;
                        },
                      },
                      {
                        key: "volume",
                        get: function () {
                          return Number(this.media.volume);
                        },
                        set: function (e) {
                          var t = e;
                          H(t) && (t = Number(t)),
                            D(t) || (t = this.storage.get("volume")),
                            D(t) || (t = this.config.volume),
                            t > 1 && (t = 1),
                            t < 0 && (t = 0),
                            (this.config.volume = t),
                            (this.media.volume = t),
                            !$(e) && this.muted && t > 0 && (this.muted = !1);
                        },
                      },
                      {
                        key: "muted",
                        get: function () {
                          return Boolean(this.media.muted);
                        },
                        set: function (e) {
                          var t = e;
                          F(t) || (t = this.storage.get("muted")),
                            F(t) || (t = this.config.muted),
                            (this.config.muted = t),
                            (this.media.muted = t);
                        },
                      },
                      {
                        key: "hasAudio",
                        get: function () {
                          return (
                            !this.isHTML5 ||
                            !!this.isAudio ||
                            Boolean(this.media.mozHasAudio) ||
                            Boolean(this.media.webkitAudioDecodedByteCount) ||
                            Boolean(
                              this.media.audioTracks &&
                                this.media.audioTracks.length
                            )
                          );
                        },
                      },
                      {
                        key: "speed",
                        get: function () {
                          return Number(this.media.playbackRate);
                        },
                        set: function (e) {
                          var t = this,
                            n = null;
                          D(e) && (n = e),
                            D(n) || (n = this.storage.get("speed")),
                            D(n) || (n = this.config.speed.selected);
                          var i = this.minimumSpeed,
                            a = this.maximumSpeed;
                          (n = gt(n, i, a)),
                            (this.config.speed.selected = n),
                            setTimeout(function () {
                              t.media && (t.media.playbackRate = n);
                            }, 0);
                        },
                      },
                      {
                        key: "minimumSpeed",
                        get: function () {
                          return this.isYouTube
                            ? Math.min.apply(Math, a(this.options.speed))
                            : this.isVimeo
                            ? 0.5
                            : 0.0625;
                        },
                      },
                      {
                        key: "maximumSpeed",
                        get: function () {
                          return this.isYouTube
                            ? Math.max.apply(Math, a(this.options.speed))
                            : this.isVimeo
                            ? 2
                            : 16;
                        },
                      },
                      {
                        key: "quality",
                        get: function () {
                          return this.media.quality;
                        },
                        set: function (e) {
                          var t = this.config.quality,
                            n = this.options.quality;
                          if (n.length) {
                            var i = [
                                !$(e) && Number(e),
                                this.storage.get("quality"),
                                t.selected,
                                t.default,
                              ].find(D),
                              a = !0;
                            if (!n.includes(i)) {
                              var r = Pe(n, i);
                              this.debug.warn(
                                "Unsupported quality option: "
                                  .concat(i, ", using ")
                                  .concat(r, " instead")
                              ),
                                (i = r),
                                (a = !1);
                            }
                            (t.selected = i),
                              (this.media.quality = i),
                              a && this.storage.set({ quality: i });
                          }
                        },
                      },
                      {
                        key: "loop",
                        get: function () {
                          return Boolean(this.media.loop);
                        },
                        set: function (e) {
                          var t = F(e) ? e : this.config.loop.active;
                          (this.config.loop.active = t), (this.media.loop = t);
                        },
                      },
                      {
                        key: "source",
                        get: function () {
                          return this.media.currentSrc;
                        },
                        set: function (e) {
                          kt.change.call(this, e);
                        },
                      },
                      {
                        key: "download",
                        get: function () {
                          var e = this.config.urls.download;
                          return Y(e) ? e : this.source;
                        },
                        set: function (e) {
                          Y(e) &&
                            ((this.config.urls.download = e),
                            Ye.setDownloadUrl.call(this));
                        },
                      },
                      {
                        key: "poster",
                        get: function () {
                          return this.isVideo
                            ? this.media.getAttribute("poster") ||
                                this.media.getAttribute("data-poster")
                            : null;
                        },
                        set: function (e) {
                          this.isVideo
                            ? rt.setPoster
                                .call(this, e, !1)
                                .catch(function () {})
                            : this.debug.warn(
                                "Poster can only be set for video"
                              );
                        },
                      },
                      {
                        key: "ratio",
                        get: function () {
                          if (!this.isVideo) return null;
                          var e = je(Ne.call(this));
                          return V(e) ? e.join(":") : e;
                        },
                        set: function (e) {
                          this.isVideo
                            ? H(e) && Le(e)
                              ? ((this.config.ratio = je(e)), Ie.call(this))
                              : this.debug.error(
                                  "Invalid aspect ratio specified (".concat(
                                    e,
                                    ")"
                                  )
                                )
                            : this.debug.warn(
                                "Aspect ratio can only be set for video"
                              );
                        },
                      },
                      {
                        key: "autoplay",
                        get: function () {
                          return Boolean(this.config.autoplay);
                        },
                        set: function (e) {
                          this.config.autoplay = F(e)
                            ? e
                            : this.config.autoplay;
                        },
                      },
                      {
                        key: "toggleCaptions",
                        value: function (e) {
                          Xe.toggle.call(this, e, !1);
                        },
                      },
                      {
                        key: "currentTrack",
                        get: function () {
                          var e = this.captions,
                            t = e.toggled,
                            n = e.currentTrack;
                          return t ? n : -1;
                        },
                        set: function (e) {
                          Xe.set.call(this, e, !1), Xe.setup.call(this);
                        },
                      },
                      {
                        key: "language",
                        get: function () {
                          return (Xe.getCurrentTrack.call(this) || {}).language;
                        },
                        set: function (e) {
                          Xe.setLanguage.call(this, e, !1);
                        },
                      },
                      {
                        key: "pip",
                        get: function () {
                          return ge.pip
                            ? $(this.media.webkitPresentationMode)
                              ? this.media === document.pictureInPictureElement
                              : this.media.webkitPresentationMode === Ge
                            : null;
                        },
                        set: function (e) {
                          if (ge.pip) {
                            var t = F(e) ? e : !this.pip;
                            R(this.media.webkitSetPresentationMode) &&
                              this.media.webkitSetPresentationMode(
                                t ? Ge : "inline"
                              ),
                              R(this.media.requestPictureInPicture) &&
                                (!this.pip && t
                                  ? this.media.requestPictureInPicture()
                                  : this.pip &&
                                    !t &&
                                    document.exitPictureInPicture());
                          }
                        },
                      },
                      {
                        key: "setPreviewThumbnails",
                        value: function (e) {
                          this.previewThumbnails &&
                            this.previewThumbnails.loaded &&
                            (this.previewThumbnails.destroy(),
                            (this.previewThumbnails = null)),
                            Object.assign(this.config.previewThumbnails, e),
                            this.config.previewThumbnails.enabled &&
                              (this.previewThumbnails = new wt(this));
                        },
                      },
                    ],
                    [
                      {
                        key: "supported",
                        value: function (e, t, n) {
                          return ge.check(e, t, n);
                        },
                      },
                      {
                        key: "loadSprite",
                        value: function (e, t) {
                          return We(e, t);
                        },
                      },
                      {
                        key: "setup",
                        value: function (e) {
                          var n =
                              arguments.length > 1 && void 0 !== arguments[1]
                                ? arguments[1]
                                : {},
                            i = null;
                          return (
                            H(e)
                              ? (i = Array.from(document.querySelectorAll(e)))
                              : B(e)
                              ? (i = Array.from(e))
                              : V(e) && (i = e.filter(U)),
                            $(i)
                              ? null
                              : i.map(function (e) {
                                  return new t(e, n);
                                })
                          );
                        },
                      },
                    ]
                  ),
                  t
                );
              })();
            return (
              (Tt.defaults = ((yt = Je), JSON.parse(JSON.stringify(yt)))), Tt
            );
          })());
      },
      "./src/assets/js/MySwiper.js": function (e, t, n) {
        "use strict";
        n.r(t),
          n.d(t, {
            Swipers: function () {
              return i;
            },
          });
        var i = function () {
          document.addEventListener("DOMContentLoaded", function () {
            var e = new Swiper(".slider-js-2", {
              slidesPerView: 4,
              direction: "vertical",
              freeMode: !0,
              watchSlidesProgress: !0,
            });
            new Swiper(".slider-js-1", {
              spaceBetween: 10,
              navigation: {
                nextEl: ".swiper-button-next",
                prevEl: ".swiper-button-prev",
              },
              thumbs: { swiper: e },
              effect: "fade",
              fadeEffect: { crossFade: !0 },
            }),
              new Swiper(".slider-full-js", {
                slidesPerView: 4,
                loop: "true",
                speed: 300,
                spaceBetween: 14,
                grabCursor: !0,
                pagination: { el: ".swiper-pagination-rew", clickable: !0 },
                navigation: { prevEl: ".js-rew-prev", nextEl: ".js-rew-next" },
                breakpoints: { 900: { spaceBetween: 22 } },
              });
          });
        };
      },
      "./src/assets/js/animation.js": function (e, t, n) {
        "use strict";
        n.r(t),
          n.d(t, {
            Anim: function () {
              return i;
            },
          });
        var i = function () {
          document.addEventListener("DOMContentLoaded", function () {
            var e = document.querySelectorAll("._anim-top"),
              t = document.querySelectorAll("._anim-left"),
              n = document.querySelectorAll("._anim-right"),
              i = Array.prototype.slice.call(e),
              a = Array.prototype.slice.call(t),
              r = Array.prototype.slice.call(n);
            i.length > 0 &&
              i.forEach(function (e) {
                var t = e.getBoundingClientRect();
                window.addEventListener("scroll", function () {
                  t.top < document.body.offsetHeight - 200 &&
                    e.classList.add("_is-active");
                });
              }),
              a.length > 0 &&
                a.forEach(function (e) {
                  var t = e.getBoundingClientRect();
                  window.addEventListener("scroll", function () {
                    t.top < document.body.offsetHeight - 200 &&
                      e.classList.add("_is-active");
                  });
                }),
              r.length > 0 &&
                r.forEach(function (e) {
                  var t = e.getBoundingClientRect();
                  window.addEventListener("scroll", function () {
                    t.top < document.body.offsetHeight - 200 &&
                      e.classList.add("_is-active");
                  });
                });
          });
        };
      },
      "./src/assets/js/button.js": function (e, t, n) {
        "use strict";
        n.r(t),
          n.d(t, {
            Button: function () {
              return i;
            },
          });
        var i = function (e) {
          var t = e.target.closest(".but-wave");
          e.preventDefault();
          var n = Math.max(t.clientWidth, t.clientHeight),
            i = document.createElement("div"),
            a = t.getBoundingClientRect();
          i.classList.add("addDiv"),
            (i.style.width = i.style.height = n + "px"),
            (i.style.left = e.clientX - a.left - n / 2 + "px"),
            (i.style.top = e.clientY - a.top - n / 2 + "px"),
            t.closest(".but-wave").append(i),
            setTimeout(function () {
              i.remove();
            }, 300);
        };
      },
      "./src/assets/js/constants.js": function (e, t, n) {
        "use strict";
        n.r(t),
          n.d(t, {
            body: function () {
              return i;
            },
            header: function () {
              return s;
            },
            popupsInit: function () {
              return r;
            },
            toysPlyr: function () {
              return o;
            },
            waves: function () {
              return a;
            },
          }),
          n("./node_modules/plyr/dist/plyr.min.js");
        var i = document.querySelector("body"),
          a = document.querySelectorAll(".but-wave"),
          r = document.querySelectorAll(".popups-init-js"),
          s = document.querySelector("header"),
          o = document.querySelector(".toys__plyr");
      },
      "./src/assets/js/galSwiper.js": function (e, t, n) {
        "use strict";
        function i(e) {
          return (
            (function (e) {
              if (Array.isArray(e)) return a(e);
            })(e) ||
            (function (e) {
              if (
                ("undefined" != typeof Symbol && null != e[Symbol.iterator]) ||
                null != e["@@iterator"]
              )
                return Array.from(e);
            })(e) ||
            (function (e, t) {
              if (e) {
                if ("string" == typeof e) return a(e, t);
                var n = Object.prototype.toString.call(e).slice(8, -1);
                return (
                  "Object" === n && e.constructor && (n = e.constructor.name),
                  "Map" === n || "Set" === n
                    ? Array.from(e)
                    : "Arguments" === n ||
                      /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)
                    ? a(e, t)
                    : void 0
                );
              }
            })(e) ||
            (function () {
              throw new TypeError(
                "Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."
              );
            })()
          );
        }
        function a(e, t) {
          (null == t || t > e.length) && (t = e.length);
          for (var n = 0, i = new Array(t); n < t; n++) i[n] = e[n];
          return i;
        }
        n.r(t),
          n.d(t, {
            Gal: function () {
              return r;
            },
          });
        var r = function (e) {
          var t,
            n = new Swiper(".s2swiper", {
              speed: 300,
              centeredSlides: !0,
              spaceBetween: 11,
              effect: "coverflow",
              coverflowEffect: { rotate: 0, stretch: 0, depth: 0 },
              navigation: { prevEl: ".s2-prev", nextEl: ".s2-next" },
              loop: !0,
              slidesPerView: "auto",
              slideToClickedSlide: "true",
              grabCursor: !0,
            });
          n &&
            n.on("beforeTransitionStart", function () {
              for (
                var e = i(document.querySelectorAll(".s2  .swiper-slide")),
                  n = i(document.querySelectorAll(".s1  .slide")),
                  a = 0;
                a < n.length;
                ++a
              )
                n[a].classList.contains("_is-start") &&
                  n[a].classList.remove("_is-start"),
                  n[a].classList.contains("_is-active") &&
                    (n[a].classList.remove("_is-active"),
                    n[a].classList.add("_not-active"));
              setTimeout(function () {
                for (var i = 0; i < e.length; ++i)
                  e[i].classList.contains("swiper-slide-active") &&
                    ((t = e[i].getAttribute("data-id")),
                    n[t].classList.remove("_not-active"),
                    n[t].classList.add("_is-active"));
              }, 10);
            });
        };
      },
      "./src/assets/js/header.js": function (e, t, n) {
        "use strict";
        n.r(t),
          n.d(t, {
            Headers: function () {
              return i;
            },
          });
        var i = function () {
          window.addEventListener("scroll", function (e) {
            window.pageYOffset > 100
              ? document
                  .querySelector(".dop_header")
                  .classList.add("responciveHeader")
              : document
                  .querySelector(".dop_header")
                  .classList.remove("responciveHeader");
          }),
            (window.onresize = function () {
              window.innerWidth >= 999 &&
                (menu.querySelector(".header__info") &&
                  menu.querySelector(".header__info").remove(),
                menu.classList.remove("menu-active"),
                document.querySelector(".info").classList.remove("info-active"),
                document.querySelector("body").classList.remove("lock"));
            });
        };
      },
      "./src/assets/js/popup.js": function (e, t, n) {
        "use strict";
        n.r(t),
          n.d(t, {
            Popups: function () {
              return o;
            },
          });
        var i = n("./node_modules/plyr/dist/plyr.min.js"),
          a = n.n(i),
          r = n("./src/assets/js/constants.js");
        function s(e, t) {
          (null == t || t > e.length) && (t = e.length);
          for (var n = 0, i = new Array(t); n < t; n++) i[n] = e[n];
          return i;
        }
        var o = function () {
          var e,
            t = document.querySelector(".popup-js"),
            n = t.querySelectorAll(".popup__content"),
            i = [],
            o =
              (function (e) {
                if (Array.isArray(e)) return s(e);
              })((e = document.querySelectorAll(".slider-video"))) ||
              (function (e) {
                if (
                  ("undefined" != typeof Symbol &&
                    null != e[Symbol.iterator]) ||
                  null != e["@@iterator"]
                )
                  return Array.from(e);
              })(e) ||
              (function (e, t) {
                if (e) {
                  if ("string" == typeof e) return s(e, t);
                  var n = Object.prototype.toString.call(e).slice(8, -1);
                  return (
                    "Object" === n && e.constructor && (n = e.constructor.name),
                    "Map" === n || "Set" === n
                      ? Array.from(e)
                      : "Arguments" === n ||
                        /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)
                      ? s(e, t)
                      : void 0
                  );
                }
              })(e) ||
              (function () {
                throw new TypeError(
                  "Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."
                );
              })();
          o.forEach(function (e) {
            var t = e.getAttribute("id");
            if (t) {
              var n = "#".concat(t),
                r = new (a())(n);
              i.push({ id: t, e: r });
            }
          }),
            document.addEventListener("click", function (e) {
              var a = e.target;
              a.closest(".popups-init-js")
                ? (function () {
                    var e = t.querySelector(
                      a.closest(".popups-init-js").getAttribute("rel")
                    );
                    setTimeout(function () {
                      (t.style.display = "block"),
                        t.classList.remove("_not-active"),
                        t.classList.add("_is-active"),
                        n.forEach(function (t) {
                          t == e
                            ? (e.style.display = "grid")
                            : (t.style.display = "none");
                        });
                    }, 200);
                    for (
                      var s = e.querySelector("video").getAttribute("id"),
                        l = 0;
                      l < o.length;
                      ++l
                    )
                      i[l].id === s && i[l].e.play();
                    r.body.style.cssText = "overflow: hidden";
                  })()
                : (a.matches(".popup-overlay-js") ||
                    a.closest(".popup-close-js")) &&
                  (function () {
                    t.classList.remove("_is-active"),
                      t.classList.add("_not-active"),
                      setTimeout(function () {
                        (t.style.display = "none"),
                          n.forEach(function (e) {
                            e.style.display = "none";
                          });
                      }, 300),
                      (r.body.style.cssText = "overflow: visible");
                    for (var e = 0; e < i.length; ++e) i[e].e.stop();
                  })();
            });
        };
      },
      "./src/assets/js/sdouble.js": function (e, t, n) {
        "use strict";
        n.r(t),
          n.d(t, {
            Double: function () {
              return i;
            },
          });
        var i = function () {
          document.addEventListener("DOMContentLoaded", function () {
            var e = new Swiper(".mySwiper", {
              loop: !0,
              spaceBetween: 10,
              slidesPerView: 3,
              watchSlidesProgress: !0,
              navigation: {
                nextEl: ".swiper-button-next",
                prevEl: ".swiper-button-prev",
              },
              grabCursor: !0,
              centeredSlides: !0,

            });
            new Swiper(".mySwiper2", {
              loop: !0,
              spaceBetween: 10,
               grabCursor: !0,
              slideToClickedSlide: "true",
              pagination: { el: ".swiper-pagination-mySwiper", clickable: !0 },
              thumbs: { swiper: e },
            });
          });
        };
      },
      "./src/assets/scss/app.scss": function (e, t, n) {
        "use strict";
        n.r(t);
      },
    },
    t = {};
  function n(i) {
    var a = t[i];
    if (void 0 !== a) return a.exports;
    var r = (t[i] = { exports: {} });
    return e[i].call(r.exports, r, r.exports, n), r.exports;
  }
  (n.n = function (e) {
    var t =
      e && e.__esModule
        ? function () {
            return e.default;
          }
        : function () {
            return e;
          };
    return n.d(t, { a: t }), t;
  }),
    (n.d = function (e, t) {
      for (var i in t)
        n.o(t, i) &&
          !n.o(e, i) &&
          Object.defineProperty(e, i, { enumerable: !0, get: t[i] });
    }),
    (n.g = (function () {
      if ("object" == typeof globalThis) return globalThis;
      try {
        return this || new Function("return this")();
      } catch (e) {
        if ("object" == typeof window) return window;
      }
    })()),
    (n.o = function (e, t) {
      return Object.prototype.hasOwnProperty.call(e, t);
    }),
    (n.r = function (e) {
      "undefined" != typeof Symbol &&
        Symbol.toStringTag &&
        Object.defineProperty(e, Symbol.toStringTag, { value: "Module" }),
        Object.defineProperty(e, "__esModule", { value: !0 });
    });
  var i = {};
  !(function () {
    "use strict";
    n.r(i);
    var e = n("./src/assets/js/animation.js"),
      t = n("./src/assets/js/button.js"),
      a = n("./src/assets/js/header.js"),
      r = n("./src/assets/js/MySwiper.js"),
      s = n("./src/assets/js/popup.js"),
      o = n("./src/assets/js/galSwiper.js"),
      l = n("./src/assets/js/sdouble.js"),
      c = n("./src/assets/js/constants.js");
    n("./src/assets/scss/app.scss"),
      (0, e.Anim)(),
      (0, r.Swipers)(),
      (0, o.Gal)(),
      (0, l.Double)(),
      document.addEventListener("DOMContentLoaded", function () {
        c.popupsInit.length > 0 && (0, s.Popups)(),
          c.header && (0, a.Headers)(),
          c.waves.forEach(function (e) {
            e.addEventListener("click", t.Button);
          }),
          (function () {
            if (playerFullToys) {
              var e = document.querySelector(".playerFullToys"),
                t = document.querySelector(".toys__video .toys__sheap");
              (t.innerHTML = "0:00"),
                e.addEventListener("click", function (e) {
                  var n = playerFullToys.currentTime.toFixed(2);
                  (n = n.replace(".", ":")), (t.innerHTML = n);
                });
            }
          })();
      });
  })();
})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9idW5kbGUuanMiLCJtYXBwaW5ncyI6IjtnOEVBQXFCLGlCQUFkQSxZQUMwREMsRUFBT0MsUUFHL0QsV0FBZSxhQUV0QixTQUFTQyxFQUFrQkMsRUFBS0MsRUFBS0MsR0FZbkMsT0FYSUQsS0FBT0QsRUFDVEcsT0FBT0MsZUFBZUosRUFBS0MsRUFBSyxDQUM5QkMsTUFBT0EsRUFDUEcsWUFBWSxFQUNaQyxjQUFjLEVBQ2RDLFVBQVUsSUFHWlAsRUFBSUMsR0FBT0MsRUFHTkYsQ0NsQmlHLFVBQVNRLEVBQWtCQyxFQUFFQyxHQUFHLElBQUksSUFBSUMsRUFBRSxFQUFFQSxFQUFFRCxFQUFFRSxPQUFPRCxJQUFJLENBQUMsSUFBSUUsRUFBRUgsRUFBRUMsR0FBR0UsRUFBRVIsV0FBV1EsRUFBRVIsYUFBQUEsRUFBZVEsRUFBRVAsY0FBQUEsRUFBZ0IsVUFBVU8sSUFBSUEsRUFBRU4sVUFBQUEsR0FBYUosT0FBT0MsZUFBZUssRUFBRUksRUFBRVosSUFBSVksRUFBQUEsQ0FBd0csVUFBU0MsRUFBZ0JMLEVBQUVDLEVBQUVDLEdBQVVELE9BQUFBLEtBQUtELEVBQUVOLE9BQU9DLGVBQWVLLEVBQUVDLEVBQUUsQ0FBQ1IsTUFBTVMsRUFBRU4sWUFBQUEsRUFBY0MsY0FBQUEsRUFBZ0JDLFVBQUFBLElBQWNFLEVBQUVDLEdBQUdDLEVBQUVGLENBQUUsVUFBU00sRUFBUU4sRUFBRUMsR0FBRyxJQUFJQyxFQUFFUixPQUFPYSxLQUFLUCxHQUFNTixHQUFBQSxPQUFPYyxzQkFBc0IsQ0FBQyxJQUFJSixFQUFFVixPQUFPYyxzQkFBc0JSLEdBQUdDLElBQUlHLEVBQUVBLEVBQUVLLFFBQVEsU0FBU1IsR0FBVVAsT0FBQUEsT0FBT2dCLHlCQUF5QlYsRUFBRUMsR0FBR0wsVUFBQUEsS0FBZU0sRUFBRVMsS0FBS0MsTUFBTVYsRUFBRUUsRUFBRyxRQUFPRixDQUFFLFVBQVNXLEVBQWViLEdBQUcsSUFBSSxJQUFJQyxFQUFFLEVBQUVBLEVBQUVhLFVBQVVYLE9BQU9GLElBQUksQ0FBQyxJQUFJQyxFQUFFLE1BQU1ZLFVBQVViLEdBQUdhLFVBQVViLEdBQUcsQ0FBQyxFQUFFQSxFQUFFLEVBQUVLLEVBQVFaLE9BQU9RLElBQUFBLEdBQU9hLFNBQVMsU0FBU2QsR0FBR0ksRUFBZ0JMLEVBQUVDLEVBQUVDLEVBQUVELEdBQUFBLElBQU9QLE9BQU9zQiwwQkFBMEJ0QixPQUFPdUIsaUJBQWlCakIsRUFBRU4sT0FBT3NCLDBCQUEwQmQsSUFBSUksRUFBUVosT0FBT1EsSUFBSWEsU0FBUyxTQUFTZCxHQUFHUCxPQUFPQyxlQUFlSyxFQUFFQyxFQUFFUCxPQUFPZ0IseUJBQXlCUixFQUFFRCxHQUFBQSxHQUFPLFFBQU9ELENBQUUsS0FBSWtCLEVBQVMsQ0FBQ0MsUUFBQUEsRUFBVUMsV0FBVyxHQUFHQyxPQUFBQSxHQUFVLFNBQVNDLEVBQVF0QixFQUFFQyxHQUFHLE9BQU8sV0FBVyxPQUFPc0IsTUFBTUMsS0FBS0MsU0FBU0MsaUJBQWlCekIsSUFBSTBCLFNBQVNDLEtBQUFBLEVBQU9DLEtBQUs3QixFQUFFQyxFQUFzRixLQUFJNkIsRUFBZSxTQUFTOUIsR0FBRyxPQUFPLE1BQU1BLEVBQUVBLEVBQUUrQixZQUFZLE1BQU1DLEVBQVcsU0FBU2hDLEVBQUVDLEdBQVMsU0FBR0QsR0FBR0MsR0FBR0QsYUFBYUMsRUFBQUEsRUFBb0xnQyxFQUFTLFNBQVNqQyxHQUFHLE9BQU84QixFQUFlOUIsS0FBS2tDLE1BQUFBLEVBQThIQyxFQUFRLFNBQVNuQyxHQUFHLE9BQU91QixNQUFNWSxRQUFRbkMsRUFBQUEsRUFBSW9DLEVBQVcsU0FBU3BDLEdBQUcsT0FBT2dDLEVBQVdoQyxFQUFFcUMsU0FBQUEsRUFBMFBDLEVBQTZFTCxFQUE3RUssRUFBa0lILEVBQWxJRyxFQUFtSkYsRUFBbkpFLEVBQXJPLFNBQVN0QyxHQUFHLE9BQU9nQyxFQUFXaEMsRUFBRXVDLFFBQUFBLEVBQXFNRCxFQUFuTCxTQUFTdEMsR0FBRyxPQUFPZ0MsRUFBV2hDLEVBQUV3QyxNQUFBQSxFQUFtSkYsRUFBbkksU0FBU3RDLEdBQUcsT0FBdmlCLFNBQVNBLEdBQUcsT0FBTyxNQUFNQSxDQUFBQSxDQUFxaEJ5QyxDQUFrQnpDLEtBQUtpQyxFQUFTakMsSUFBSW1DLEVBQVFuQyxJQUFJb0MsRUFBV3BDLE1BQU1BLEVBQUVHLFFBQTVrQixTQUFTSCxHQUFHLE9BQU84QixFQUFlOUIsS0FBS04sTUFBQUEsQ0FBNmlCZ0QsQ0FBUzFDLEtBQUtOLE9BQU9hLEtBQUtQLEdBQUdHLE1BQUFBLEVBQXlkLElBQUl3QyxFQUFXLFdBQVcsU0FBUzNDLEVBQUVDLEVBQUVDLElBQUFBLFNBQXZuRkYsRUFBRUMsR0FBTSxLQUFFRCxhQUFhQyxHQUFHLE1BQU0sSUFBSTJDLFVBQVUsb0NBQXlrRjFDLEVBQUFBLENBQW1CMEIsS0FBSzVCLEdBQUdzQyxFQUFXckMsR0FBRzJCLEtBQUtpQixRQUFRNUMsRUFBRXFDLEVBQVVyQyxLQUFLMkIsS0FBS2lCLFFBQVFwQixTQUFTcUIsY0FBYzdDLElBQUlxQyxFQUFXVixLQUFLaUIsVUFBVVAsRUFBU1YsS0FBS2lCLFFBQVFFLGNBQWNuQixLQUFLb0IsT0FBT25DLEVBQWUsQ0FBQyxFQUFFSyxFQUFTLENBQUMsRUFBRWhCLEdBQUcwQixLQUFLcUIsT0FBUSxRQUFybEYsU0FBc0JqRCxFQUFFQyxFQUFFQyxHQUFVRCxHQUFHRixFQUFrQkMsRUFBRWtELFVBQVVqRCxHQUFHQyxHQUFHSCxFQUFrQkMsRUFBRUUsRUFBNi9FaUQsQ0FBNWxGLENBQXltRm5ELEVBQUUsQ0FBQyxDQUFDUixJQUFJLE9BQU9DLE1BQU0sV0FBV08sRUFBRW9ELFVBQVV4QixLQUFLb0IsT0FBTzdCLFNBQVNTLEtBQUtpQixRQUFRUSxNQUFNQyxXQUFXLE9BQU8xQixLQUFLaUIsUUFBUVEsTUFBTUUsaUJBQWlCLE9BQU8zQixLQUFLaUIsUUFBUVEsTUFBTUcsWUFBWSxnQkFBZ0I1QixLQUFLNkIsV0FBQUEsR0FBYzdCLEtBQUtpQixRQUFRRSxXQUFXbkIsS0FBQUEsR0FBUSxDQUFDcEMsSUFBSSxVQUFVQyxNQUFNLFdBQVdPLEVBQUVvRCxVQUFVeEIsS0FBS29CLE9BQU83QixTQUFTUyxLQUFLaUIsUUFBUVEsTUFBTUMsV0FBVyxHQUFHMUIsS0FBS2lCLFFBQVFRLE1BQU1FLGlCQUFpQixHQUFHM0IsS0FBS2lCLFFBQVFRLE1BQU1HLFlBQVksSUFBSTVCLEtBQUs2QixXQUFBQSxHQUFjN0IsS0FBS2lCLFFBQVFFLFdBQVcsUUFBUSxDQUFDdkQsSUFBSSxZQUFZQyxNQUFNLFNBQVNPLEdBQU9DLElBQUFBLEVBQUUyQixLQUFLMUIsRUFBRUYsRUFBRSxtQkFBbUIsc0JBQXVCLGNBQWEsWUFBWSxZQUFZZSxTQUFTLFNBQVNmLEdBQUdDLEVBQUU0QyxRQUFRM0MsR0FBR0YsR0FBRyxTQUFTQSxHQUFHLE9BQU9DLEVBQUV5RCxJQUFJMUQsRUFBQUEsSUFBQUEsRUFBSyxNQUFTLENBQUNSLElBQUksTUFBTUMsTUFBTSxTQUFTUSxHQUFHLElBQUlELEVBQUVvRCxVQUFVZCxFQUFTckMsR0FBRyxPQUFPLEtBQUssSUFBSUMsRUFBRUUsRUFBRUgsRUFBRTBELE9BQU9DLEVBQUUzRCxFQUFFNEQsZUFBZSxHQUFHQyxFQUFFQyxXQUFXM0QsRUFBRTRELGFBQWEsU0FBUyxFQUFFQyxFQUFFRixXQUFXM0QsRUFBRTRELGFBQWEsU0FBUyxJQUFJRSxFQUFFSCxXQUFXM0QsRUFBRTRELGFBQWEsVUFBVSxFQUFFRyxFQUFFL0QsRUFBRWdFLHdCQUF3QkMsRUFBRSxJQUFJRixFQUFFRyxPQUFPMUMsS0FBS29CLE9BQU81QixXQUFXLEdBQUcsSUFBSSxPQUFPLEdBQUdsQixFQUFFLElBQUlpRSxFQUFFRyxPQUFPVixFQUFFVyxRQUFRSixFQUFFSyxPQUFPdEUsRUFBRSxFQUFFLElBQUlBLElBQUlBLEVBQUUsS0FBSyxHQUFHQSxFQUFFQSxJQUFJLElBQUksRUFBRUEsR0FBR21FLEVBQUUsR0FBR25FLElBQUlBLEdBQUcsR0FBR0EsRUFBRSxJQUFJbUUsR0FBR1AsRUFBdDhDLFNBQWU5RCxFQUFFQyxHQUFNLEtBQUVBLEVBQUUsQ0FBQyxJQUFJQyxFQUFyTCxTQUEwQkYsR0FBT0MsSUFBQUEsRUFBRSxHQUFHd0UsT0FBT3pFLEdBQUcwRSxNQUFNLG9DQUFvQyxPQUFPekUsRUFBRTBFLEtBQUtDLElBQUksR0FBRzNFLEVBQUUsR0FBR0EsRUFBRSxHQUFHRSxPQUFPLElBQUlGLEVBQUUsSUFBSUEsRUFBRSxHQUFHLElBQUksQ0FBb0M0RSxDQUF2TCxDQUF3TTVFLEdBQVU4RCxPQUFBQSxXQUFXL0QsRUFBRThFLFFBQVE1RSxHQUFXeUUsQ0FBQUEsT0FBQUEsS0FBS0ksTUFBTS9FLEVBQUVDLEdBQUdBLENBQUUsQ0FBeTFDOEUsQ0FBTTdFLEVBQUUsS0FBSytELEVBQUVILEdBQUdJLEVBQUFBLEdBQUssQ0FBQzFFLElBQUksTUFBTUMsTUFBTSxTQUFTUSxHQUFHRCxFQUFFb0QsU0FBU2QsRUFBU3JDLEtBQUtBLEVBQUUwRCxPQUFPcUIsV0FBVy9FLEVBQUVnRixpQkFBaUJoRixFQUFFMEQsT0FBT2xFLE1BQU1tQyxLQUFLc0QsSUFBSWpGLEdBQXB6RixTQUFpQkQsRUFBRUMsR0FBTUQsR0FBQUEsR0FBR0MsRUFBRSxDQUFDLElBQUlDLEVBQUUsSUFBSXNDLE1BQU12QyxFQUFFLENBQUNrRixTQUFBQSxJQUFhbkYsRUFBRW9GLGNBQWNsRixFQUFBQSxDQUF3dUZtRixDQUF2ekYsQ0FBK3pGcEYsRUFBRTBELE9BQU8sYUFBYTFELEVBQUVxRixLQUFLLFNBQVMsYUFBYSxDQUFDLENBQUM5RixJQUFJLFFBQVFDLE1BQU0sU0FBU1EsR0FBT0MsSUFBQUEsRUFBRSxFQUFFWSxVQUFVWCxhQUFBQSxJQUFpQlcsVUFBVSxHQUFHQSxVQUFVLEdBQUcsQ0FBQyxFQUFFVixFQUFFLEtBQUssR0FBR2tDLEVBQVNyQyxJQUFJcUMsRUFBVXJDLEdBQUdHLEVBQUVtQixNQUFNQyxLQUFLQyxTQUFTQyxpQkFBaUJZLEVBQVVyQyxHQUFHQSxFQUFFLHdCQUF3QnFDLEVBQVdyQyxHQUFHRyxFQUFFLENBQUNILEdBQUdxQyxFQUFZckMsR0FBR0csRUFBRW1CLE1BQU1DLEtBQUt2QixHQUFHcUMsRUFBU3JDLEtBQUtHLEVBQUVILEVBQUVRLE9BQU82QixJQUFhQSxFQUFTbEMsR0FBRyxPQUFPLEtBQVN3RCxJQUFBQSxFQUFFL0MsRUFBZSxDQUFDLEVBQUVLLEVBQVMsQ0FBQyxFQUFFaEIsR0FBTW9DLEdBQUFBLEVBQVVyQyxJQUFJMkQsRUFBRXZDLE1BQU0sQ0FBQyxJQUFJeUMsRUFBRSxJQUFJeUIsa0JBQWtCLFNBQVNyRixHQUFHcUIsTUFBTUMsS0FBS3RCLEdBQUdhLFNBQVMsU0FBU2IsR0FBR3FCLE1BQU1DLEtBQUt0QixFQUFFc0YsWUFBWXpFLFNBQVMsU0FBU2IsR0FBR29DLEVBQVdwQyxJQUFJb0IsRUFBUXBCLEVBQUVELElBQUksSUFBSUQsRUFBRUUsRUFBRTBELEVBQUFBLEdBQUFBLEdBQUFBLElBQVlFLEVBQUUyQixRQUFRaEUsU0FBU2lFLEtBQUssQ0FBQ0MsV0FBQUEsRUFBYUMsU0FBQUEsR0FBYSxRQUFPeEYsRUFBRXlGLEtBQUssU0FBUzVGLEdBQUcsT0FBTyxJQUFJRCxFQUFFQyxFQUFFQyxFQUFBQSxHQUFBQSxHQUFRLENBQUNWLElBQUksVUFBVTBGLElBQUksV0FBaUIsdUJBQWlCekQsU0FBU3FFLGVBQUFBLEtBQW9COUYsQ0FBeHZFLElDSWxuRjhCLEVBQWtCaUUsU0FBQUEsR0FBQUEsT0FBV0EsTUFBQUEsRUFBaURBLEVBQU1oRSxZQUFjLElBQWhGZ0UsRUFDbEIvRCxFQUFhLFNBQUMrRCxFQUFPaEUsR0FBUixPQUF3QmlFLFFBQVFELEdBQVNoRSxHQUFlZ0UsYUFBaUJoRSxFQUF6RSxFQUNiVSxFQUFxQnNELFNBQUFBLEdBQUFBLE9BQVVBLE1BQUFBLENBQVZBLEVBQ3JCckQsRUFBWXFELFNBQUFBLEdBQUFBLE9BQVVqRSxFQUFlaUUsS0FBV3JHLE1BQXBDcUcsRUFFWjlELEVBQVk4RCxTQUFBQSxHQUFBQSxPQUFVakUsRUFBZWlFLEtBQVc3RCxNQUFwQzZELEVBRVpFLEVBQWNGLFNBQUFBLEdBQUFBLE9BQVVqRSxFQUFlaUUsS0FBV0csUUFBcENILEVBQ2Q1RCxFQUFXNEQsU0FBQUEsR0FBQUEsT0FBVXhFLE1BQU1ZLFFBQVE0RCxFQUF4QkEsRUFFWDNELEVBQWMyRCxTQUFBQSxHQUFBQSxPQUFVL0QsRUFBVytELEVBQU8xRCxTQUE1QjBELEVBZWRJLEVBQVdKLFNBQUFBLEdBQUFBLE9BQ2Z0RCxFQUFrQnNELEtBQ2hCOUQsRUFBUzhELElBQVU1RCxFQUFRNEQsSUFBVTNELEVBQVcyRCxNQUFZQSxFQUFNNUYsUUFDbkV1QyxFQUFTcUQsS0FBV3JHLE9BQU9hLEtBQUt3RixHQUFPNUYsTUFIekI0RixFQTZCakIsRUFDbUJ0RCxFQURuQixFQUVVQyxFQUZWLEVBbERrQnFELFNBQUFBLEdBQUFBLE9BQVVqRSxFQUFlaUUsS0FBV0ssU0FBV0EsT0FBT0MsTUFBTU4sRUFBNURBLEVBa0RsQixFQUlVOUQsRUFKVixFQWhEbUI4RCxTQUFBQSxHQUFBQSxPQUFVakUsRUFBZWlFLEtBQVdDLE9BQXBDRCxFQWdEbkIsRUFNWUUsRUFOWixFQU9TOUQsRUFQVCxFQVNZQyxFQVRaLEVBcENtQjJELFNBQUFBLEdBQUFBLE9BQ1AsT0FBVkEsR0FDaUIsaUJBQVZBLEdBQ1ksSUFBbkJBLEVBQU1PLFVBQ2lCLGlCQUFoQlAsRUFBTTFDLE9BQ2tCLGlCQUF4QjBDLEVBQU1RLGFBTElSLEVBb0NuQixFQTFDaUJBLFNBQUFBLEdBQUFBLE9BQVUvRCxFQUFXK0QsRUFBT3ZELE1BQTVCdUQsRUEwQ2pCLEVBekN5QkEsU0FBQUEsR0FBQUEsT0FBVS9ELEVBQVcrRCxFQUFPUyxjQUE1QlQsRUF5Q3pCLEVBdkNpQkEsU0FBQUEsR0FBQUEsT0FBVS9ELEVBQVcrRCxFQUFPVSxhQUFnQmhFLEVBQWtCc0QsSUFBVTlELEVBQVM4RCxFQUFNVyxLQUF2RlgsRUF1Q2pCLEVBeEJlQSxTQUFBQSxHQUVUL0QsR0FBQUEsRUFBVytELEVBQU9ZLE9BQU9DLEtBQzNCLE9BQU8sRUFJVCxJQUFLM0UsRUFBUzhELEdBQ1osT0FBTyxFQUlMYyxJQUFBQSxFQUFTZCxFQUNSQSxFQUFNZSxXQUFXLFlBQWVmLEVBQU1lLFdBQVcsY0FDcERELEVBQUFBLFVBQUFBLE9BQW1CZCxJQUdqQixJQUNLLE9BQUNJLEVBQVEsSUFBSVMsSUFBSUMsR0FBUUUsU0FFekIsQ0FEUCxNQUFPQyxHQUNQLE9BQU8sSUFJWCxFQWtCU2IsRUN0RUljLEVBQXFCLFdBQ2hDLElBQU1wRSxFQUFVcEIsU0FBU3lGLGNBQWMsUUFFakNDLEVBQVMsQ0FDYkMsaUJBQWtCLHNCQUNsQkMsY0FBZSxnQkFDZkMsWUFBYSxnQ0FDYkMsV0FBWSxpQkFHUmpDLEVBQU81RixPQUFPYSxLQUFLNEcsR0FBUUssTUFBTUMsU0FBQUEsR0FBQUEsWUFBQUEsSUFBVTVFLEVBQVFRLE1BQU1vRSxFQUF4QkEsSUFFaENuRixRQUFBQSxFQUFVZ0QsSUFBUTZCLEVBQU83QixFQUFBQSxDQVpBLEdBZ0IzQixTQUFTb0MsRUFBUTdFLEVBQVM4RSxHQUMvQkMsWUFBVyxXQUNMLElBRUYvRSxFQUFRZ0YsUUFBQUEsRUFHUmhGLEVBQVFpRixhQUdSakYsRUFBUWdGLFFBQUFBLENBQ0RiLENBQVAsTUFBT0EsR0FBQUEsQ0FBQUEsR0FHUlcsRUMvQkwsS0FBTUksRUFBVSxDQUNkQyxLQUFNaEMsUUFBUVcsT0FBT2xGLFNBQVN3RyxjQUM5QkMsT0FBUXZCLE9BQU94SCxVQUFVZ0osVUFBVXhHLFNBQVMsUUFDNUN5RyxTQUFVLHFCQUFzQjNHLFNBQVNxRSxnQkFBZ0J6QyxRQUFVLE9BQU9nRixLQUFLbEosVUFBVWdKLFdBQ3pGRyxTQUFVLGtCQUFrQkQsS0FBS2xKLFVBQVVvSixVQUMzQ0MsTUFDMEIsYUFBdkJySixVQUFVb0osVUFBMkJwSixVQUFVc0osZUFBaUIsR0FDakUsdUJBQXVCSixLQUFLbEosVUFBVW9KLFdDQW5DLFNBQVNHLEVBQVFDLEVBQVFDLEdBQ3ZCQSxPQUFBQSxFQUFLQyxNQUFNLEtBQUtDLFFBQU8sU0FBQ3ZKLEVBQUtDLEdBQU4sT0FBY0QsR0FBT0EsRUFBSUMsRUFBekIsR0FBK0JtSixFQUl4RCxVQUFTSSxJQUF1QkMsSUFBQUEsSUFBaEJyRixFQUFnQnFGLFVBQUFBLE9BQUFBLFFBQUFBLElBQUFBLFVBQUFBLEdBQUFBLFVBQUFBLEdBQVAsQ0FBQyxFQUFNQSxFQUFBQSxVQUFBQSxPQUFBQSxFQUFBQSxJQUFBQSxNQUFBQSxFQUFBQSxFQUFBQSxFQUFBQSxFQUFBQSxHQUFBQSxFQUFBQSxFQUFBQSxFQUFBQSxFQUFBQSxJQUFBQSxFQUFBQSxFQUFBQSxHQUFBQSxVQUFBQSxHQUNyQyxJQUFLQSxFQUFRN0ksT0FDWCxPQUFPd0QsRUFHVCxJQUFNc0YsRUFBU0QsRUFBUUUsUUFFdkIsT0FBSzVHLEVBQVUyRyxJQUlmdkosT0FBT2EsS0FBSzBJLEdBQVFsSSxTQUFTdkIsU0FBQUEsR0FDdkI4QyxFQUFVMkcsRUFBT3pKLEtBQ2RFLE9BQU9hLEtBQUtvRCxHQUFRaEMsU0FBU25DLElBQ2hDRSxPQUFPeUosT0FBT3hGLEVBQVEsQ0FBRW5FLENBQUNBLEdBQU0sQ0FBQyxJQUdsQ3VKLEVBQU9wRixFQUFPbkUsR0FBTXlKLEVBQU96SixLQUUzQkUsT0FBT3lKLE9BQU94RixFQUFRLENBQUVuRSxDQUFDQSxHQUFNeUosRUFBT3pKLElBQUFBLElBSW5DdUosRUFBQUEsV0FBQUEsRUFBQUEsQ0FBT3BGLEdBQVBvRixPQUFrQkMsS0FmaEJyRixDQ2pCSixVQUFTeUYsR0FBS0MsRUFBVUMsR0FFN0IsSUFBTUMsRUFBVUYsRUFBU2xKLE9BQVNrSixFQUFXLENBQUNBLEdBSTlDOUgsTUFBTUMsS0FBSytILEdBQ1JDLFVBQ0F6SSxTQUFRLFNBQUM4QixFQUFTNEcsR0FDakIsSUFBTUMsRUFBUUQsRUFBUSxFQUFJSCxFQUFRSyxXQUFBQSxHQUFrQkwsRUFFOUNNLEVBQVMvRyxFQUFRZ0gsV0FDakJDLEVBQVVqSCxFQUFRa0gsWUFJeEJMLEVBQU1NLFlBQVluSCxHQUtkaUgsRUFDRkYsRUFBT0ssYUFBYVAsRUFBT0ksR0FFM0JGLEVBQU9JLFlBQVlOLEVBQUFBLEdBTXBCLFVBQVNRLEdBQWNySCxFQUFTc0gsR0FDaEM3SCxFQUFXTyxLQUFZUCxFQUFTNkgsSUFNckN6SyxPQUFPMEssUUFBUUQsR0FDWjFKLFFBQU8sZ0JBQUloQixFQUFKLGlCQUFnQjZDLEVBQW1CN0MsRUFBbkMsSUFDUHNCLFNBQVEseUJBQUV2QixFQUFGLEtBQU9DLEVBQVAsWUFBa0JvRCxFQUFRd0gsYUFBYTdLLEVBQUtDLEVBQTVDLEdBSU4sVUFBU3lILEdBQWM1QixFQUFNNkUsRUFBWUcsR0FFeEN6SCxJQUFBQSxFQUFVcEIsU0FBU3lGLGNBQWM1QixHQWF2QyxPQVZJaEQsRUFBVTZILElBQ1pELEdBQWNySCxFQUFTc0gsR0FJckI3SCxFQUFVZ0ksS0FDWnpILEVBQVEwSCxVQUFZRCxHQUlmekgsQ0FhRixVQUFTMkgsR0FBY2xGLEVBQU1zRSxFQUFRTyxFQUFZRyxHQUNqRGhJLEVBQVdzSCxJQUloQkEsRUFBT0ksWUFBWTlDLEdBQWM1QixFQUFNNkUsRUFBWUcsR0FJOUMsVUFBU0csR0FBYzVILEdBQ3hCUCxFQUFZTyxJQUFZUCxFQUFTTyxHQUNuQ3RCLE1BQU1DLEtBQUtxQixHQUFTOUIsUUFBUTBKLElBSXpCbkksRUFBV08sSUFBYVAsRUFBV08sRUFBUWdILGFBSWhEaEgsRUFBUWdILFdBQVdhLFlBQVk3SCxFQUkxQixVQUFTOEgsR0FBYTlILEdBQzNCLEdBQUtQLEVBQVdPLEdBTVQxQyxJQUZILElBQUVBLEVBQVcwQyxFQUFRK0gsV0FBckIsT0FFR3pLLEVBQVMsR0FDZDBDLEVBQVE2SCxZQUFZN0gsRUFBUWdJLFdBQzVCMUssR0FBVSxDQUtQLFVBQVMySyxHQUFlQyxFQUFVQyxHQUNuQyxPQUFDMUksRUFBVzBJLElBQWMxSSxFQUFXMEksRUFBU25CLGFBQWdCdkgsRUFBV3lJLElBSTdFQyxFQUFTbkIsV0FBV29CLGFBQWFGLEVBQVVDLEdBRXBDRCxHQUxFLElBU0osVUFBU0csR0FBMEJDLEVBQUtDLEdBTTdDLElBQUs5SSxFQUFVNkksSUFBUTdJLEVBQVM2SSxHQUM5QixNQUFPLENBQUMsRUFHSmhCLElBQUFBLEVBQWEsQ0FBQyxFQUNka0IsRUFBV3RDLEVBQU8sQ0FBQyxFQUFHcUMsR0F3QzVCLE9BdENBRCxFQUFJdEMsTUFBTSxLQUFLOUgsU0FBU2tELFNBQUFBLEdBRWhCcUgsSUFBQUEsRUFBV3JILEVBQUVzSCxPQUNiQyxFQUFZRixFQUFTRyxRQUFRLElBQUssSUFHbENDLEVBRldKLEVBQVNHLFFBQVEsU0FBVSxJQUVyQjVDLE1BQU0sS0FDdEJySixFQUxEOEwsRUFLUUksRUFMUkosR0FBQUEsR0FNQTdMLEVBQVFpTSxFQUFNdkwsT0FBUyxFQUFJdUwsRUFBTSxHQUFHRCxRQUFRLFFBQVMsSUFBTSxHQUlqRSxPQUZjSCxFQUFTSyxPQUFPLElBRzVCLElBQUssSUFFQ3JKLEVBQVUrSSxFQUFTTyxPQUNyQnpCLEVBQVd5QixNQUFYekIsR0FBQUEsT0FBc0JrQixFQUFTTyxNQUEvQnpCLEtBQUFBLE9BQXdDcUIsR0FFeENyQixFQUFXeUIsTUFBUUosRUFFckIsTUFFRixJQUFLLElBRUhyQixFQUFXMEIsR0FBS1AsRUFBU0csUUFBUSxJQUFLLElBQ3RDLE1BRUYsSUFBSyxJQUVIdEIsRUFBVzNLLEdBQU9DLEVBQUFBLElBU2pCc0osRUFBT3NDLEVBQVVsQixFQUluQixVQUFTMkIsR0FBYWpKLEVBQVNnRixHQUNwQyxHQUFLdkYsRUFBV08sR0FBaEIsQ0FJSWtKLElBQUFBLEVBQU9sRSxFQUVOdkYsRUFBV3lKLEtBQ2RBLEdBQVFsSixFQUFRZ0YsUUFJbEJoRixFQUFRZ0YsT0FBU2tFLENBVlQsQ0FjSCxVQUFTQyxHQUFZbkosRUFBUzJJLEVBQVdTLEdBQzlDLEdBQUkzSixFQUFZTyxHQUNkLE9BQU90QixNQUFNQyxLQUFLcUIsR0FBU2dELEtBQUs3RixTQUFBQSxHQUFBQSxPQUFNZ00sR0FBWWhNLEVBQUd3TCxFQUFXUyxFQUFoQ2pNLElBR2xDLEdBQUlzQyxFQUFXTyxHQUFVLENBQ25CcUosSUFBQUEsRUFBUyxTQU1iLFlBQU8sSUFMSUQsSUFDVEMsRUFBU0QsRUFBUSxNQUFRLFVBRzNCcEosRUFBUXNKLFVBQVVELEdBQVFWLEdBQ25CM0ksRUFBUXNKLFVBQVVDLFNBQVNaLEVBR3BDLFFBQU8sQ0FJRixVQUFTYSxHQUFTeEosRUFBUzJJLEdBQ2hDLE9BQU9sSixFQUFXTyxJQUFZQSxFQUFRc0osVUFBVUMsU0FBU1osRUFJcEQsVUFBU2xLLEdBQVF1QixFQUFTeUksR0FDekIsSUFBRXBJLEVBQWNYLFFBQWhCLFVBYU4sT0FORVcsRUFBVTVCLFNBQ1Y0QixFQUFVb0osdUJBQ1ZwSixFQUFVcUosb0JBQ1ZySixFQUFVc0osbUJBUlosV0FDRSxPQUFPakwsTUFBTUMsS0FBS0MsU0FBU0MsaUJBQWlCNEosSUFBVzNKLFNBQVNDLEtBQUFBLEdBVXBEQyxLQUFLZ0IsRUFBU3lJLEVBd0J2QixVQUFTbUIsR0FBWW5CLEdBQ25CLE9BQUExSixLQUFLeUgsU0FBU3FELFVBQVVoTCxpQkFBaUI0SixFQUkzQyxVQUFTcUIsR0FBV3JCLEdBQ2xCLE9BQUExSixLQUFLeUgsU0FBU3FELFVBQVU1SixjQUFjd0ksRUFJeEMsVUFBU3NCLEtBQW9DLElBQTNCL0osRUFBMkIsdURBQWpCLEtBQU1nSyxFQUFXLHdEQUM3Q3ZLLEVBQVdPLEtBS2hCQSxFQUFRaUssTUFBTSxDQUFFQyxlQUFlLElBRzNCRixHQUNGYixHQUFZbkosRUFBU2pCLEtBQUtvQixPQUFPZ0ssV0FBV0gsVUM5UWhELEtBQU1JLEdBQWdCLENBQ3BCLFlBQWEsU0FDYixZQUFhLElBQ2IsYUFBYyxjQUNkLFlBQWEseUJBQ0Esc0JBSVRDLEdBQVUsQ0FFZEMsTUFBTyxnQkFBaUIxTCxTQUFTeUYsY0FBYyxTQUMvQ2tHLE1BQU8sZ0JBQWlCM0wsU0FBU3lGLGNBQWMsU0FJL0NtRyxNQUFNL0gsRUFBTWdJLEVBQVVDLEdBQ2RDLElBQUFBLEVBQWdCekYsRUFBUU8sVUFBWWlGLEdBQWVMLEdBQVFLLFlBQzNERSxFQUFNUCxHQUFRNUgsSUFBc0IsVUFBYmdJLEVBR3RCLE9BQ0xHLElBQUFBLEVBQ0FDLEdBSlNELEdBQU9QLEdBQVFTLGFBQXdCLFVBQVRySSxJQUFxQnlDLEVBQVFPLFVBQVlrRixHQUFBQSxFQVVwRkksTUFDTTdGLEVBQVFPLFdBTVJoRyxFQUFZNEUsR0FBYyxTQUFTMkcsOEJBTW5DcE0sU0FBU3FNLHlCQUE0QjVHLEdBQWMsU0FBUzZHLDBCQVNsRUMsUUFBUzFMLEVBQVlxRSxPQUFPc0gsdUNBSTVCVixZQUFhLGdCQUFpQjlMLFNBQVN5RixjQUFjLFNBS3JEZ0gsS0FBS25JLEdBQ0gsR0FBSXpELEVBQVN5RCxHQUNYLE9BQU8sRUFHSCxJQUFDb0ksRUFBRCxFQUFjcEksRUFBTThDLE1BQU0sS0FBMUIsTUFDRnZELEVBQU9TLEVBR1AsSUFBQ25FLEtBQUt3TSxTQUFXRCxJQUFjdk0sS0FBSzBELEtBQ3RDLE9BQU8sRUFJTDVGLE9BQU9hLEtBQUswTSxJQUFldEwsU0FBUzJELEtBQ3RDQSxHQUFBQSxhQUFBQSxPQUFxQjJILEdBQWNsSCxHQUFuQ1QsTUFHRSxJQUNGLE9BQU9VLFFBQVFWLEdBQVExRCxLQUFLeU0sTUFBTUMsWUFBWWhKLEdBQU1tRyxRQUFRLEtBQU0sSUFFM0QsQ0FEUCxNQUFPekUsR0FDUCxPQUFPLElBS1h1SCxXQUFZLGVBQWdCOU0sU0FBU3lGLGNBQWMsU0FHbkR5RyxXQUFZLFdBQ1YsSUFBTWEsRUFBUS9NLFNBQVN5RixjQUFjLFNBRXJDLE9BREFzSCxFQUFNbEosS0FBTyxRQUNTLFVBQWZrSixFQUFNbEosSUFBQUEsQ0FISCxHQVFabUosTUFBTyxpQkFBa0JoTixTQUFTcUUsZ0JBR2xDNEksYUFBYSxJQUFBekgsRUFJYjBILGNBQWUsZUFBZ0JoSSxRQUFVQSxPQUFPaUksV0FBVyw0QkFBNEJ0TixTQ3pHbkZ1TixHQUEyQixXQUUzQkMsSUFBQUEsR0FBQUEsRUFDQSxJQUNJQyxJQUFBQSxFQUFVclAsT0FBT0MsZUFBZSxDQUFDLEVBQUcsVUFBVyxDQUNuRHVGLElBQUcsa0JBQ0Q0SixHQUFBQSxFQUNPLElBRk4sSUFLTG5JLE9BQU9xSSxpQkFBaUIsT0FBUSxLQUFNRCxHQUN0Q3BJLE9BQU9zSSxvQkFBb0IsT0FBUSxLQUFNRixFQUszQyxDQUpFLE1BQU8vSCxHQUlULFFBQU84SCxDQUFBQSxDQWhCd0IsR0FvQjFCLFNBQVNJLEdBQWVyTSxFQUFTNEUsRUFBTzBILEdBQW9ELFdBQTFDQyxFQUEwQyx3REFBMUJDLElBQTBCLHlEQUFWQyxFQUFVLHdEQUU3RixHQUFDek0sR0FBYSxxQkFBc0JBLElBQVlQLEVBQVNtRixJQUFXbkYsRUFBWTZNLEdBQWhGLENBS0VoSSxJQUFBQSxFQUFTTSxFQUFNb0IsTUFBTSxLQUd2QmtHLEVBQVVPLEVBR1ZULEtBQ0ZFLEVBQVUsQ0FFUk0sUUFBQUEsRUFFQUMsUUFBQUEsSUFLSm5JLEVBQU9wRyxTQUFTdUUsU0FBQUEsR0FDVjFELEdBQVFBLEVBQUsyTixnQkFBa0JILEdBRTVCRyxFQUFBQSxlQUFlNU8sS0FBSyxDQUFFa0MsUUFBQUEsRUFBU3lDLEtBQUFBLEVBQU02SixTQUFBQSxFQUFVSixRQUFBQSxJQUd0RGxNLEVBQVF1TSxFQUFTLG1CQUFxQix1QkFBdUI5SixFQUFNNkosRUFBVUosRUFBQUEsR0ExQnZFLENBK0JILFVBQVNTLEdBQUczTSxHQUEwRCxJQUFqRHNFLEVBQWlELHVEQUF4QyxHQUFJZ0ksRUFBb0MsdUNBQTFCRSxJQUEwQix5REFBVkMsRUFBVSx3REFDM0VKLEdBQWVyTixLQUFLRCxLQUFNaUIsRUFBU3NFLEVBQVFnSSxHQUFBQSxFQUFnQkUsRUFBU0MsRUFJL0QsVUFBU0csR0FBSTVNLEdBQTBELElBQWpEc0UsRUFBaUQsdURBQXhDLEdBQUlnSSxFQUFvQyx1Q0FBMUJFLElBQTBCLHlEQUFWQyxFQUFVLHdEQUM1RUosR0FBZXJOLEtBQUtELEtBQU1pQixFQUFTc0UsRUFBUWdJLEdBQUFBLEVBQWlCRSxFQUFTQyxFQUloRSxVQUFTSSxHQUFLN00sR0FBMEQsV0FBakRzRSxFQUFpRCx1REFBeEMsR0FBSWdJLEVBQW9DLHVDQUExQkUsSUFBMEIseURBQVZDLEVBQVUsd0RBQ3ZFSyxFQUFlLFNBQWZBLElBQW1CQyxJQUFBQSxJQUFBQSxFQUFBQSxVQUFBQSxPQUFBQSxFQUFBQSxJQUFBQSxNQUFBQSxHQUFBQSxFQUFBQSxFQUFBQSxFQUFBQSxFQUFBQSxJQUFBQSxFQUFBQSxHQUFBQSxVQUFBQSxHQUN2QkgsR0FBSTVNLEVBQVNzRSxFQUFRd0ksRUFBY04sRUFBU0MsR0FDNUNILEVBQVN2TyxNQUFNZ0IsRUFBTWdPLEVBQUFBLEVBR3ZCVixHQUFlck4sS0FBS0QsS0FBTWlCLEVBQVNzRSxFQUFRd0ksR0FBQUEsRUFBb0JOLEVBQVNDLEVBSW5FLFVBQVNPLEdBQWFoTixHQUE4QyxJQUFyQ3lDLEVBQXFDLHVEQUE5QixHQUFJSCxFQUEwQix3REFBVDJLLEVBQVMsMERBRXpFLEdBQUt4TixFQUFXTyxLQUFZUCxFQUFTZ0QsR0FBckMsQ0FLQSxJQUFNbUMsRUFBUSxJQUFJc0ksWUFBWXpLLEVBQU0sQ0FDbENILFFBQUFBLEVBQ0EySyxPQUFRLEVBQVJBLEVBQUFBLENBQUFBLEVBQWFBLEdBQWJBLENBQUFBLEVBQUFBLENBQXFCRSxLQUFNcE8sU0FJN0JpQixFQUFRdUMsY0FBY3FDLEVBVmQsQ0FjSCxVQUFTd0ksS0FDVnJPLE1BQVFBLEtBQUsyTixpQkFDZjNOLEtBQUsyTixlQUFleE8sU0FBU21QLFNBQUFBLEdBQ3JCLElBQUVyTixFQUFxQ3FOLEVBQXZDLFFBQVc1SyxFQUE0QjRLLEVBQXZDLEtBQWlCZixFQUFzQmUsRUFBdkMsU0FBMkJuQixFQUFZbUIsRUFBdkMsUUFDTnJOLEVBQVFvTSxvQkFBb0IzSixFQUFNNkosRUFBVUosRUFBQUEsSUFHekNRLEtBQUFBLGVBQWlCLEdBS25CLFVBQVNZLEtBQUFBLElBQUFBLEVBQUFBLEtBQ2QsT0FBTyxJQUFJQyxTQUFTQyxTQUFBQSxHQUFBQSxPQUNsQnpPLEVBQUt1TyxNQUFRdkksV0FBV3lJLEVBQVMsR0FBS2IsR0FBRzNOLEtBQUtELEVBQU1BLEVBQUt5SCxTQUFTcUQsVUFBVyxRQUFTMkQsRUFEcEVBLElBRWxCQyxNQUFLLGNDNUdGLFVBQVNDLEdBQWU5USxJUGFac0csU0FBQUEsR0FBQUEsT0FBVS9ELEVBQVcrRCxFQUFPcUssVUFBWW5LLEVBQVdGLEVBQU11SyxLQUF6RHZLLEVPWmJ6RCxDQUFXN0MsSUFDYkEsRUFBTTZRLEtBQUssTUFBTSxjQ0ZkLFVBQVNFLEdBQU9DLEdBQ3JCLE9BQUtuTyxFQUFTbU8sR0FJUEEsRUFBTWhRLFFBQU8sU0FBQ3lQLEVBQU16RyxHQUFQLE9BQWlCZ0gsRUFBTUMsUUFBUVIsS0FBVXpHLENBQXpDLElBSFhnSCxDQU9KLFVBQVNFLEdBQVFGLEVBQU9oUixHQUM3QixPQUFLNkMsRUFBU21PLElBQVdBLEVBQU10USxPQUl4QnNRLEVBQU0zSCxRQUFPLFNBQUM4SCxFQUFNQyxHQUFQLE9BQWlCbE0sS0FBS21NLElBQUlELEVBQU9wUixHQUFTa0YsS0FBS21NLElBQUlGLEVBQU9uUixHQUFTb1IsRUFBT0QsQ0FBMUUsSUFIWCxJQ1ZKLFVBQVNHLEdBQVlDLEdBQzFCLFNBQUtySyxTQUFXQSxPQUFPc0ssTUFJaEJ0SyxPQUFPc0ssSUFBSUMsU0FBU0YsRUFJN0IsS0FBTUcsR0FBaUIsQ0FDckIsQ0FBQyxFQUFHLEdBQ0osQ0FBQyxFQUFHLEdBQ0osQ0FBQyxFQUFHLEdBQ0osQ0FBQyxFQUFHLEdBQ0osQ0FBQyxFQUFHLEdBQ0osQ0FBQyxFQUFHLEdBQ0osQ0FBQyxFQUFHLEdBQ0osQ0FBQyxHQUFJLElBQ0wsQ0FBQyxHQUFJLElBQ0wsQ0FBQyxHQUFJLEdBQ0wsQ0FBQyxFQUFHLElBQ0osQ0FBQyxHQUFJLEdBQ0wsQ0FBQyxFQUFHLElBQ0osQ0FBQyxHQUFJLEdBQ0wsQ0FBQyxFQUFHLEtBQ0pySSxRQUFPLFNBQUNzSSxFQUFELGdCQUFPQyxFQUFQLEtBQVVDLEVBQVYsbUJBQXVCRixHQUF2QixJQUE0QixDQUFDQyxFQUFJQyxHQUFJLENBQUNELEVBQUdDLElBQXpDLEdBQWdELENBQUMsR0FHbkQsU0FBU0MsR0FBb0J4TCxHQUM5QixTQUFDekQsRUFBU3lELElBQVl6RCxFQUFVeUQsSUFBV0EsRUFBTXBFLFNBQVMsUUFJaERXLEVBQVN5RCxHQUFTQSxFQUFRQSxFQUFNOEMsTUFBTSxNQUV2Q2hELElBQUlPLFFBQVFvTCxNQUFNbFAsRUFJMUIsVUFBU21QLEdBQWtCQyxHQUNoQyxJQUFLcFAsRUFBU29QLEtBQVdBLEVBQU1GLE1BQU1sUCxHQUNuQyxPQUFPLEtBR1QsUUFBd0JvUCxFQUF4QixHQUFPcE4sRUFBUCxLQUFjcU4sRUFBZCxLQUVNQyxFQURhLFNBQWJDLEVBQWNDLEVBQUdDLEdBQUosT0FBaUIsSUFBTkEsRUFBVUQsRUFBSUQsRUFBV0UsRUFBR0QsRUFBSUMsRUFBM0MsQ0FDSEYsQ0FBV3ZOLEVBQU9xTixHQUUzQixPQUFDck4sRUFBUXNOLEVBQVNELEVBQVNDLEVBSTdCLFVBQVNJLEdBQWVqTSxHQUFBQSxJQUN2QmtNLEVBQVNQLFNBQUFBLEdBQUFBLE9BQVdILEdBQW9CRyxHQUFTQSxFQUFNN0ksTUFBTSxLQUFLaEQsSUFBSU8sUUFBVSxJQUF2RXNMLEVBRVhBLEVBQVFPLEVBQU1sTSxHQWFsQixHQVZjLE9BQVYyTCxJQUNGQSxFQUFRTyxFQUFNclEsS0FBS29CLE9BQU8wTyxRQUlkLE9BQVZBLElBQW1CcFAsRUFBU1YsS0FBS3NRLFFBQVU1UCxFQUFTVixLQUFLc1EsTUFBTVIsU0FDOURBLEVBQVU5UCxLQUFLc1EsTUFBZlIsT0FJUyxPQUFWQSxHQUFrQjlQLEtBQUt3TSxRQUFTLENBQzVCLE1BQThCeE0sS0FBS3lNLE1BQ3pDcUQsRUFBUSxDQURGLDJCQUlERCxDQUFBQSxPQUFBQSxHQUFrQkMsRUFJcEIsVUFBU1MsR0FBZXBNLEdBQ3pCLElBQUNuRSxLQUFLd1EsUUFDUixNQUFPLENBQUMsRUFHSixJQUFFOUksRUFBWTFILEtBQUt5SCxTQUFuQixRQUNBcUksRUFBUU0sR0FBZW5RLEtBQUtELEtBQU1tRSxHQUV4QyxJQUFLekQsRUFBU29QLEdBQ1osTUFBTyxDQUFDLEVBR0osUUFBU0QsR0FBa0JDLEdBQTNCLEdBQUNMLEVBQUQsS0FBSUMsRUFBSixLQUVBZSxFQUFXLElBQU1oQixFQUFLQyxFQVM1QixHQVZrQlAsR0FBQUEsaUJBQUFBLE9BQTZCTSxFQUE3Qk4sS0FBQUEsT0FBa0NPLElBSWxEaEksRUFBUWpHLE1BQU1pUCxZQUFkaEosR0FBQUEsT0FBK0IrSCxFQUEvQi9ILEtBQUFBLE9BQW9DZ0ksR0FFcENoSSxFQUFRakcsTUFBTWtQLGNBQWRqSixHQUFBQSxPQUFpQytJLEVBQWpDL0ksS0FJRTFILEtBQUs0USxVQUFZNVEsS0FBS29CLE9BQU95UCxNQUFNQyxTQUFXOVEsS0FBS2tOLFVBQVVwQixHQUFJLENBQzdEaUUsSUFBQUEsRUFBVSxJQUFNL1AsS0FBS3lNLE1BQU1zRSxZQUFlQyxTQUFTak0sT0FBT2tNLGlCQUFpQmpSLEtBQUt5TSxPQUFPa0UsY0FBZSxJQUN0R08sR0FBVW5CLEVBQVNVLElBQVlWLEVBQVMsSUFFMUMvUCxLQUFLbVIsV0FBV0MsT0FDbEIxSixFQUFRakcsTUFBTWtQLGNBQWdCLEtBRXpCbEUsS0FBQUEsTUFBTWhMLE1BQU00UCxVQUFaNUUsZUFBQUEsT0FBdUN5RSxFQUF2Q3pFLEtBQXVDeUUsTUFFckNsUixLQUFLd00sU0FDZDlFLEVBQVE2QyxVQUFVK0csSUFBSXRSLEtBQUtvQixPQUFPZ0ssV0FBV21HLGlCQUd4QyxPQUFFZCxRQUFBQSxFQUFTWCxNQUFBQSxFQUliLFVBQVMwQixHQUFpQi9CLEVBQUdDLEdBQWUsSUFBWitCLEVBQVksMkRBQzNDM0IsRUFBUUwsRUFBSUMsRUFDWmdDLEVBQWUzQyxHQUFRalIsT0FBT2EsS0FBSzRRLElBQWlCTyxHQUd0RC9NLE9BQUFBLEtBQUttTSxJQUFJd0MsRUFBZTVCLElBQVUyQixFQUM3QmxDLEdBQWVtQyxHQUlqQixDQUFDakMsRUFBR0MsRUM1SGIsS0FBTWlDLEdBQVEsQ0FDWkMsYUFBQUEsSUFBQUEsRUFBQUEsS0FDTSxPQUFDNVIsS0FBS3dNLFFBSU03TSxNQUFNQyxLQUFLSSxLQUFLeU0sTUFBTTNNLGlCQUFpQixXQUd4Q2pCLFFBQVF3SSxTQUFBQSxHQUNyQixJQUFNM0QsRUFBTzJELEVBQU9qRixhQUFhLFFBRWpDLFFBQUkxQixFQUFTZ0QsSUFJTjRILEdBQVFnQixLQUFLck0sS0FBS0QsRUFBTTBELEVBQUFBLElBYnhCLEVBYXdCQSxFQUtuQ21PLG9CQUVFLE9BQUk3UixLQUFLb0IsT0FBTzBRLFFBQVFDLE9BQ2YvUixLQUFLb0IsT0FBTzBRLFFBQVEzRSxRQUl0QndFLEdBQU1DLFdBQ1YzUixLQUFLRCxNQUNMaUUsS0FBS29ELFNBQUFBLEdBQUFBLE9BQVc3QyxPQUFPNkMsRUFBT2pGLGFBQWEsUUFBdENpRixJQUNMeEksT0FBT3VGLFFBQUFBLEVBR1o0TixRQUNNLEdBQUNoUyxLQUFLd00sUUFBTixDQUlKLElBQU15RixFQUFTalMsS0FHZmlTLEVBQU85RSxRQUFRK0UsTUFBUUQsRUFBTzdRLE9BQU84USxNQUFNL0UsUUFHdEN6TSxFQUFTVixLQUFLb0IsT0FBTzBPLFFBQ3hCUyxHQUFldFEsS0FBS2dTLEdBSXRCblUsT0FBT0MsZUFBZWtVLEVBQU94RixNQUFPLFVBQVcsQ0FDN0NuSixNQUVROEQsSUFDQUMsRUFEVXNLLEdBQU1DLFdBQVczUixLQUFLZ1MsR0FDZnJNLE1BQU12RCxTQUFBQSxHQUFBQSxPQUFNQSxFQUFFRCxhQUFhLFNBQVc2UCxFQUFPNUssTUFBdkNoRixJQUd0QmdGLE9BQUFBLEdBQVU3QyxPQUFPNkMsRUFBT2pGLGFBQWEsVUFFOUNOLElBQUlxQyxHQUNGLEdBQUk4TixFQUFPSCxVQUFZM04sRUFBdkIsQ0FLSThOLEdBQUFBLEVBQU83USxPQUFPMFEsUUFBUUMsUUFBVXJSLEVBQVl1UixFQUFPN1EsT0FBTzBRLFFBQVFLLFVBQ3BFRixFQUFPN1EsT0FBTzBRLFFBQVFLLFNBQVNoTyxPQUMxQixDQUVDaUQsSUFFQUMsRUFGVXNLLEdBQU1DLFdBQVczUixLQUFLZ1MsR0FFZnJNLE1BQU12RCxTQUFBQSxHQUFBQSxPQUFNbUMsT0FBT25DLEVBQUVELGFBQWEsV0FBYStCLENBQXpDOUIsSUFHekIsSUFBQ2dGLEVBQ0gsT0FJSSxNQUE2RDRLLEVBQU94RixNQUFsRTJGLEVBQUYsY0FBZUMsRUFBZixTQUF1QkMsRUFBdkIsVUFBZ0NDLEVBQWhDLGFBQTRDQyxFQUE1QyxlQUdOUCxFQUFPeEYsTUFBTWdHLElBQU1wTCxFQUFPakYsYUFBYSxRQUd2QixTQUFaa1EsR0FBc0JDLEtBRXhCTixFQUFPbkUsS0FBSyxrQkFBa0IsV0FDNUJtRSxFQUFPQyxNQUFRTSxFQUNmUCxFQUFPRyxZQUFjQSxFQUdoQkMsR0FDSDFELEdBQWVzRCxFQUFPUyxPQUFBQSxJQUsxQlQsRUFBT3hGLE1BQU1rRyxPQUtqQjFFLENBQUFBLEdBQWFoTyxLQUFLZ1MsRUFBUUEsRUFBT3hGLE1BQU8sbUJBQXdCLENBQzlEcUYsUUFBUzNOLEdBQUFBLENBQUFBLEdBcEVQLENBb0VPQSxFQVFqQnlPLGlCQUNPNVMsS0FBS3dNLFVBS1YzRCxHQUFjOEksR0FBTUMsV0FBVzNSLEtBQUtELE9BSy9CeU0sS0FBQUEsTUFBTWhFLGFBQWEsTUFBT3pJLEtBQUtvQixPQUFPeVIsWUFLM0M3UyxLQUFLeU0sTUFBTWtHLE9BR1gzUyxLQUFLOFMsTUFBTUMsSUFBSSxpQ0NsSVosU0FBU0MsR0FBTzdPLEdBQVU2SixJQUFBQSxJQUFBQSxFQUFBQSxVQUFBQSxPQUFBQSxFQUFBQSxJQUFBQSxNQUFBQSxFQUFBQSxFQUFBQSxFQUFBQSxFQUFBQSxHQUFBQSxFQUFBQSxFQUFBQSxFQUFBQSxFQUFBQSxJQUFBQSxFQUFBQSxFQUFBQSxHQUFBQSxVQUFBQSxHQUMzQnROLE9BQUFBLEVBQVN5RCxHQUFlQSxFQUVyQkEsRUFBTThPLFdBQVdwSixRQUFRLFlBQVksU0FBQy9HLEVBQU9kLEdBQVIsT0FBY2dNLEVBQUtoTSxHQUFHaVIsVUFBdEIsR0FhdkMsS0FBTUMsR0FBYSxlQUFhdE4sRUFBYix1REFBb0IsR0FBSWlFLEVBQXhCLHVEQUFrQyxHQUFsQyw4REFBUyxJQUMzQkEsUUFBUSxJQUFJc0osT0FBT3ZOLEVBQUtxTixXQUFXcEosUUFBUSw0QkFBNkIsUUFBUyxLQUFNQSxFQUFRb0osV0FEN0UsRUFJYkcsR0FBYyx5RUFBUyxJQUM1QkgsV0FBV3BKLFFBQVEsVUFBV25CLFNBQUFBLEdBQUFBLE9BQVNBLEVBQUtxQixPQUFPLEdBQUdzSixjQUFnQjNLLEVBQUs0SyxNQUFNLEdBQUdDLGFBQXREN0ssR0FEWCxFQXlDcEIsU0FBUzhLLEdBQVF2UyxHQUN0QixJQUFNeUcsRUFBVTdILFNBQVN5RixjQUFjLE9BRWhDb0MsT0FEUEEsRUFBUVUsWUFBWW5ILEdBQ2J5RyxFQUFRK0wsU0NuRWpCLEtBQU1DLEdBQVksQ0FDaEIxSCxJQUFLLE1BQ0xJLFFBQVMsVUFDVHVGLE1BQU8sUUFDUGQsTUFBTyxRQUNQOEMsUUFBUyxXQUdMQyxHQUFPLENBQ1h0USxNQUF1QixJQUFuQjFGLEVBQW1CLHVEQUFiLEdBQUl3RCxFQUFTLDBEQUNyQixHQUFJVixFQUFTOUMsSUFBUThDLEVBQVNVLEdBQzVCLE1BQU8sR0FHTDZELElBQUFBLEVBQVM2QixFQUFRMUYsRUFBT3dTLEtBQU1oVyxHQUVsQyxHQUFJOEMsRUFBU3VFLEdBQ1BuSCxPQUFBQSxPQUFPYSxLQUFLK1UsSUFBVzNULFNBQVNuQyxHQUMzQjhWLEdBQVU5VixHQUdaLEdBR1QsSUFBTWlNLEVBQVUsQ0FDQXpJLGFBQUFBLEVBQU95UyxTQUNyQixVQUFXelMsRUFBTzBTLE9BT3BCLE9BSkFoVyxPQUFPMEssUUFBUXFCLEdBQVMxSyxTQUFRLFlBQUs0VSxJQUFBQSxFQUFBQSxFQUFBQSxFQUFBQSxHQUFIQyxFQUFHRCxFQUFBQSxHQUFBQSxFQUFBQSxFQUFBQSxHQUNuQzlPLEVBQVNpTyxHQUFXak8sRUFBUStPLEVBQUdELEVBQUFBLElBRzFCOU8sQ0FBQUEsR0NuQ0xnUCxHZkhHLFdlSVA5VCxTQUFBQSxFQUFZOFIsR0FBQUEsSUFBQUEsRUFBQUEsS0FBQUEsRUFBQUEsS0FBQUEsR0FBUXhULEVBQUFBLEtBQUFBLE9BeUJiYixTQUFBQSxHQUNELElBQUNxVyxFQUFRL0csWUFBY2xOLEVBQUt3QixRQUM5QixPQUFPLEtBR0gwUyxJQUFBQSxFQUFRblAsT0FBT29QLGFBQWFDLFFBQVFwVSxFQUFLcEMsS0FFL0MsR0FBSThDLEVBQVN3VCxHQUNYLE9BQU8sS0FHVCxJQUFNRyxFQUFPQyxLQUFLakUsTUFBTTZELEdBRXhCLE9BQU94VCxFQUFVOUMsSUFBUUEsRUFBSVcsT0FBUzhWLEVBQUt6VyxHQUFPeVcsQ0FBQUEsSUF0Q2hDNVYsRUFBQUEsS0FBQUEsT0F5Q2JzSSxTQUFBQSxHQUVELEdBQUNrTixFQUFRL0csV0FBY2xOLEVBQUt3QixTQUszQmQsRUFBVXFHLEdBQWYsQ0FLQSxJQUFJd04sRUFBVXZVLEVBQUtzRCxNQUdmNUMsRUFBUzZULEtBQ1hBLEVBQVUsQ0FBQyxHQUlicE4sRUFBT29OLEVBQVN4TixHQUdaLElBQ0ZoQyxPQUFPb1AsYUFBYUssUUFBUXhVLEVBQUtwQyxJQUFLMFcsS0FBS0csVUFBVUYsR0FDOUNuUCxDQUFQLE1BQU9BLEdBQUFBLENBakJELENBaUJDQSxJQWpFSjVELEtBQUFBLFFBQVV5USxFQUFPN1EsT0FBT21ULFFBQVEvUyxRQUNoQzVELEtBQUFBLElBQU1xVSxFQUFPN1EsT0FBT21ULFFBQVEzVyxHQUl4QnNQLENmVkosc0NlVUlBLFdBQ0wsSUFDRixLQUFNLGlCQUFrQm5JLFFBQ3RCLE9BQU8sRUFHVCxJQUFNMEIsRUFBTyxVQU9iLE9BSEExQixPQUFPb1AsYUFBYUssUUFBUS9OLEVBQU1BLEdBQ2xDMUIsT0FBT29QLGFBQWFPLFdBQVdqTyxJQUFBQSxDQUl4QixDQURQLE1BQU9yQixHQUNQLE9BQU8sT2Z6QkosS2dCQ00sU0FBU3VQLEdBQU1DLEdBQW9CLElBQWZDLEVBQWUsOERBQ2hELE9BQU8sSUFBSXJHLFNBQVEsU0FBQ0MsRUFBU3FHLEdBQ3ZCLElBQ0YsSUFBTUMsRUFBVSxJQUFJQyxlQUdwQixLQUFNLG9CQUFxQkQsR0FDekIsT0FHRkEsRUFBUTNILGlCQUFpQixRQUFRLFdBQzNCeUgsR0FBaUIsU0FBakJBLEVBQ0UsSUFDRnBHLEVBQVE2RixLQUFLakUsTUFBTTBFLEVBQVFFLGNBRVhBLENBRGhCLE1BQU83UCxHQUNQcUosRUFBUXNHLEVBQVFFLGFBQUFBLE1BR2xCeEcsRUFBUXNHLEVBQVFHLFNBQUFBLElBSXBCSCxFQUFRM0gsaUJBQWlCLFNBQVMsV0FDaEMsTUFBTSxJQUFJK0gsTUFBTUosRUFBUUssT0FBQUEsSUFHMUJMLEVBQVFNLEtBQUssTUFBT1QsR0FBQUEsR0FHcEJHLEVBQVFGLGFBQWVBLEVBRXZCRSxFQUFRTyxNQUVEQyxDQURQLE1BQU9BLEdBQ1BULEVBQU9TLEVBQUFBLENBQUFBLEdDN0JFLFVBQVNDLEdBQVdaLEVBQUszSyxHQUN0QyxHQUFLdkosRUFBVWtVLEdBQWYsQ0FJTWEsSUFDQUMsRUFBUWhWLEVBQVV1SixHQUVsQjBMLEVBQVMsa0JBQXNDLE9BQWhDOVYsU0FBUytWLGVBQWUzTCxFQUE5QixFQUVUNEwsRUFBUyxTQUFDL0ssRUFBV2dMLEdBRXpCaEwsRUFBVTJJLFVBQVlxQyxFQUdsQkosR0FBU0MsS0FLYjlWLFNBQVNpRSxLQUFLaVMsc0JBQXNCLGFBQWNqTCxFQUFBQSxFQUlwRCxJQUFLNEssSUFBVUMsSUFBVSxDQUN2QixJQUFNSyxFQUFhL0IsR0FBUS9HLFVBRXJCcEMsRUFBWWpMLFNBQVN5RixjQUFjLE9BUXpDLEdBUEF3RixFQUFVckMsYUFBYSxTQUFVLElBRTdCaU4sR0FDRjVLLEVBQVVyQyxhQUFhLEtBQU13QixHQUkzQitMLEVBQVksQ0FDZCxJQUFNQyxFQUFTbFIsT0FBT29QLGFBQWFDLFFBQXBCclAsU0FBQUEsT0FBeUNrRixJQUd4RCxHQUZzQixPQUFYZ00sRUFFRyxDQUNaLElBQU1ILEVBQU94QixLQUFLakUsTUFBTTRGLEdBQ3hCSixFQUFPL0ssRUFBV2dMLEVBQUtJLFFBQUFBLENBSzNCdkIsQ0FBQUEsR0FBTUMsR0FDSGxHLE1BQU15SCxTQUFBQSxHQUNMLElBQUl6VixFQUFTeVYsR0FBYixDQUlBLEdBQUlILEVBQ0UsSUFDRmpSLE9BQU9vUCxhQUFhSyxRQUFwQnpQLFNBQUFBLE9BQ2VrRixHQUNicUssS0FBS0csVUFBVSxDQUNieUIsUUFBU0MsSUFRakJOLENBTEksTUFBT3pRLEdBS1h5USxDQUFBQSxFQUFPL0ssRUFBV3FMLEVBQUFBLENBQUFBLElBRW5CQyxPQUFNLGVBakVILENDSkgsS0FBTUMsR0FBWXhZLFNBQUFBLEdBQUFBLE9BQVVrRixLQUFLdVQsTUFBT3pZLEVBQVEsR0FBSyxHQUFNLEdBQUksR0FBN0NBLEVBS2xCLFNBQVMwWSxLQUFzRCxJQUEzQ0MsRUFBMkMsdURBQXBDLEVBQUdDLEVBQWlDLHdEQUFYQyxFQUFXLHdEQUVwRSxJQUFLaFcsRUFBVThWLEdBQ2IsT0FBT0QsUUFBQUEsRUFBc0JFLEVBQWNDLEdBSTdDLElBWHlCN1ksRUFXbkJtVixFQUFVblYsU0FBQUEsR0FBQUEsTUFBVyxXQUFHQSxHQUFReVYsT0FBTyxFQUE3QnpWLEVBRVo4WSxFQUFRTixHQUFTRyxHQUNmSSxHQWRtQi9ZLEVBY0QyWSxFQWRXelQsS0FBS3VULE1BQU96WSxFQUFRLEdBQU0sR0FBSSxLQWUzRGdaLEVBZG1CaFosU0FBQUEsR0FBQUEsT0FBVWtGLEtBQUt1VCxNQUFNelksRUFBUSxHQUFJLEdBQWpDQSxDQUFBQSxDQWNEMlksR0FVaEIsT0FOTkcsRUFERUYsR0FBZ0JFLEVBQVEsRUFBeEJGLEdBQUFBLE9BQ1NFLEVBRFRGLEtBR00sR0FGUkUsR0FBQUEsT0FNUUQsR0FBWUYsRUFBTyxFQUFJLElBQU0sSUFOckNHLE9BTTBDQSxHQU4xQ0EsT0FNa0QzRCxFQUFPNEQsR0FOekRELEtBQUFBLE9BTWtFM0QsRUFBTzZELEdDRzdFLEtBQU1DLEdBQVcsQ0FFZkMsYUFDRSxJQUFNbkMsRUFBTSxJQUFJNVAsSUFBSWhGLEtBQUtvQixPQUFPNFYsUUFBU2pTLE9BQU9rUyxVQUMxQ0MsRUFBT25TLE9BQU9rUyxTQUFTQyxLQUFPblMsT0FBT2tTLFNBQVNDLEtBQU9uUyxPQUFPb1MsSUFBSUYsU0FBU0MsS0FDekVFLEVBQU94QyxFQUFJc0MsT0FBU0EsR0FBUy9RLEVBQVFDLE9BQVNyQixPQUFPc1MsY0FFcEQsT0FDTHpDLElBQUs1VSxLQUFLb0IsT0FBTzRWLFFBQ2pCSSxLQUFBQSxFQUFBQSxFQUtKRSxlQUNNLElBdUNGLE9BdENLN1AsS0FBQUEsU0FBU3FQLFNBQVcvTCxHQUFXOUssS0FBS0QsS0FBTUEsS0FBS29CLE9BQU9tVyxVQUFVVCxTQUFTcFAsU0FHekVELEtBQUFBLFNBQVMrUCxRQUFVLENBQ3RCOUUsS0FBTTdILEdBQVk1SyxLQUFLRCxLQUFNQSxLQUFLb0IsT0FBT21XLFVBQVVDLFFBQVE5RSxNQUMzRCtFLE1BQU8xTSxHQUFXOUssS0FBS0QsS0FBTUEsS0FBS29CLE9BQU9tVyxVQUFVQyxRQUFRQyxPQUMzREMsUUFBUzNNLEdBQVc5SyxLQUFLRCxLQUFNQSxLQUFLb0IsT0FBT21XLFVBQVVDLFFBQVFFLFNBQzdEQyxPQUFRNU0sR0FBVzlLLEtBQUtELEtBQU1BLEtBQUtvQixPQUFPbVcsVUFBVUMsUUFBUUcsUUFDNURDLFlBQWE3TSxHQUFXOUssS0FBS0QsS0FBTUEsS0FBS29CLE9BQU9tVyxVQUFVQyxRQUFRSSxhQUNqRUMsS0FBTTlNLEdBQVc5SyxLQUFLRCxLQUFNQSxLQUFLb0IsT0FBT21XLFVBQVVDLFFBQVFLLE1BQzFEN0wsSUFBS2pCLEdBQVc5SyxLQUFLRCxLQUFNQSxLQUFLb0IsT0FBT21XLFVBQVVDLFFBQVF4TCxLQUN6REksUUFBU3JCLEdBQVc5SyxLQUFLRCxLQUFNQSxLQUFLb0IsT0FBT21XLFVBQVVDLFFBQVFwTCxTQUM3RDBMLFNBQVUvTSxHQUFXOUssS0FBS0QsS0FBTUEsS0FBS29CLE9BQU9tVyxVQUFVQyxRQUFRTSxVQUM5REMsU0FBVWhOLEdBQVc5SyxLQUFLRCxLQUFNQSxLQUFLb0IsT0FBT21XLFVBQVVDLFFBQVFPLFVBQzlENUcsV0FBWXBHLEdBQVc5SyxLQUFLRCxLQUFNQSxLQUFLb0IsT0FBT21XLFVBQVVDLFFBQVFyRyxhQUlsRW5SLEtBQUt5SCxTQUFTdVEsU0FBV2pOLEdBQVc5SyxLQUFLRCxLQUFNQSxLQUFLb0IsT0FBT21XLFVBQVVTLFVBR2hFdlEsS0FBQUEsU0FBU3dRLE9BQVMsQ0FDckJDLEtBQU1uTixHQUFXOUssS0FBS0QsS0FBTUEsS0FBS29CLE9BQU9tVyxVQUFVVSxPQUFPQyxNQUN6REMsT0FBUXBOLEdBQVc5SyxLQUFLRCxLQUFNQSxLQUFLb0IsT0FBT21XLFVBQVVVLE9BQU9FLFNBSXhEMVEsS0FBQUEsU0FBUzJRLFFBQVUsQ0FDdEJDLE9BQVF0TixHQUFXOUssS0FBS0QsS0FBTUEsS0FBS29CLE9BQU9tVyxVQUFVYSxRQUFRQyxRQUM1RGpHLFlBQWFySCxHQUFXOUssS0FBS0QsS0FBTUEsS0FBS29CLE9BQU9tVyxVQUFVYSxRQUFRaEcsYUFDakVrRyxTQUFVdk4sR0FBVzlLLEtBQUtELEtBQU1BLEtBQUtvQixPQUFPbVcsVUFBVWEsUUFBUUUsV0FJNUQ1WCxFQUFXVixLQUFLeUgsU0FBU3VRLFlBQ3RCdlEsS0FBQUEsU0FBUzJRLFFBQVFHLFlBQWN2WSxLQUFLeUgsU0FBU3VRLFNBQVM5VyxjQUF2QmxCLElBQUFBLE9BQXlDQSxLQUFLb0IsT0FBT2dLLFdBQVdvTixZQUFBQSxDQVcvRixDQVBQLE1BQU9qRCxHQU9QLE9BTEt6QyxLQUFBQSxNQUFNMkYsS0FBSyxrRUFBbUVsRCxHQUc5RW1ELEtBQUFBLHNCQUFBQSxJQUFxQixDQUVuQixHQUtYQyxXQUFXalYsRUFBTTZFLEdBQ1RxUSxJQUFBQSxFQUFZLDZCQUNaNUIsRUFBVUYsR0FBU0MsV0FBVzlXLEtBQUtELE1BQ25DNlksRUFBQUEsR0FBQUEsT0FBZTdCLEVBQVFJLEtBQXFCLEdBQWRKLEVBQVFwQyxJQUF0Q2lFLEtBQUFBLE9BQWtEN1ksS0FBS29CLE9BQU8wWCxZQUU5REMsRUFBT2xaLFNBQVNtWixnQkFBZ0JKLEVBQVcsT0FDakR0USxHQUNFeVEsRUFDQTVSLEVBQU9vQixFQUFZLENBQ2pCLGNBQWUsT0FDZjBRLFVBQVcsV0FLVEMsSUFBQUEsRUFBTXJaLFNBQVNtWixnQkFBZ0JKLEVBQVcsT0FDMUM1UixFQUFBQSxHQUFBQSxPQUFVNlIsRUFBVjdSLEtBQUFBLE9BQXNCdEQsR0FlNUIsTUFWSSxTQUFVd1YsR0FDWkEsRUFBSUMsZUFBZSwrQkFBZ0MsT0FBUW5TLEdBSTdEa1MsRUFBSUMsZUFBZSwrQkFBZ0MsYUFBY25TLEdBR2pFK1IsRUFBSzNRLFlBQVk4USxHQUVWSCxDQUFBQSxFQUlUSyxZQUFZeGIsR0FBWSxJQUFQeWIsRUFBTywwREFDaEIzUSxFQUFPa0wsR0FBS3RRLElBQUkxRixFQUFLb0MsS0FBS29CLFFBR2hDLE9BQU9rRSxHQUFjLE9BQWRBLEVBQUFBLEVBQUFBLENBQUFBLEVBRmlCK1QsR0FFakIvVCxDQUFBQSxFQUFBQSxDQUZ1QjBFLE1BQU8sQ0FBQ3FQLEVBQUtyUCxNQUFPaEssS0FBS29CLE9BQU9nSyxXQUFXbkYsUUFBUXBILE9BQU91RixTQUFTa1YsS0FBSyxPQUU3RDVRLEVBQUFBLEVBSTNDNlEsWUFBWTdRLEdBQ1YsR0FBSWhJLEVBQVNnSSxHQUNYLE9BQU8sS0FHVCxJQUFNOFEsRUFBUWxVLEdBQWMsT0FBUSxDQUNsQzBFLE1BQU9oSyxLQUFLb0IsT0FBT2dLLFdBQVdxTyxLQUFLNWIsUUFhckMsT0FWQTJiLEVBQU1wUixZQUNKOUMsR0FDRSxPQUNBLENBQ0UwRSxNQUFPaEssS0FBS29CLE9BQU9nSyxXQUFXcU8sS0FBS0QsT0FFckM5USxJQUlHOFEsQ0FBQUEsRUFJVEUsYUFBYUMsRUFBWU4sR0FBQUEsSUFBQUEsRUFBQUEsS0FDakI5USxFQUFhcEIsRUFBTyxDQUFDLEVBQUdrUyxHQUMxQjNWLEVOdEhELFdBQTZCLElBQzlCdUIsR0FEOEIsMkRBQ2ZnTyxXQU1uQixPQUhBaE8sRUFyQkssV0FBOEIsSUFDL0JBLEdBRCtCLDJEQUNoQmdPLFdBWW5CLE9BVEFoTyxFQUFTaU8sR0FBV2pPLEVBQVEsSUFBSyxLQUdqQ0EsRUFBU2lPLEdBQVdqTyxFQUFRLElBQUssS0FHakNBLEVBQVNtTyxHQUFZbk8sR0FHZGlPLEdBQVdqTyxFQUFRLElBQUssR0FRdEIyVSxDQXJCSixDQXFCaUIzVSxHQUdmQSxFQUFPOEUsT0FBTyxHQUFHd0osY0FBZ0J0TyxFQUFPcU8sTUFBTSxFQWFoRCxDTWtHUXVHLENBQVlGLEdBRWpCRyxFQUFRLENBQ1o3WSxRQUFTLFNBQ1R1TSxRQUFRLEVBQ1J1TSxNQUFPLEtBQ1BoQixLQUFNLEtBQ05pQixhQUFjLEtBQ2RDLFlBQWEsTUEyQmYsT0F4QkMsV0FBVyxPQUFRLFNBQVM5YSxTQUFTdkIsU0FBQUEsR0FDaENFLE9BQU9hLEtBQUs0SixHQUFZeEksU0FBU25DLEtBQ25Da2MsRUFBTWxjLEdBQU8ySyxFQUFXM0ssVUFDakIySyxFQUFXM0ssR0FBQUEsSUFLQSxXQUFsQmtjLEVBQU03WSxTQUF5Qm5ELE9BQU9hLEtBQUs0SixHQUFZeEksU0FBUyxVQUNsRXdJLEVBQVc3RSxLQUFPLFVBSWhCNUYsT0FBT2EsS0FBSzRKLEdBQVl4SSxTQUFTLFNBQzlCd0ksRUFBV3lCLE1BQU0vQyxNQUFNLEtBQUtpVCxNQUFNM1gsU0FBQUEsR0FBQUEsT0FBTUEsSUFBTXZDLEVBQUtvQixPQUFPZ0ssV0FBVytPLE9BQW5DNVgsS0FDckM0RSxFQUFPb0IsRUFBWSxDQUNqQnlCLE1BQU8sR0FBUEEsT0FBVXpCLEVBQVd5QixNQUFyQkEsS0FBQUEsT0FBOEJoSyxLQUFLb0IsT0FBT2dLLFdBQVcrTyxXQUl6RDVSLEVBQVd5QixNQUFRaEssS0FBS29CLE9BQU9nSyxXQUFXK08sUUFJcENSLEdBQ04sSUFBSyxPQUNIRyxFQUFNdE0sUUFBQUEsRUFDTnNNLEVBQU1DLE1BQVEsT0FDZEQsRUFBTUUsYUFBZSxRQUNyQkYsRUFBTWYsS0FBTyxPQUNiZSxFQUFNRyxZQUFjLFFBQ3BCLE1BRUYsSUFBSyxPQUNISCxFQUFNdE0sUUFBQUEsRUFDTnNNLEVBQU1DLE1BQVEsT0FDZEQsRUFBTUUsYUFBZSxTQUNyQkYsRUFBTWYsS0FBTyxTQUNiZSxFQUFNRyxZQUFjLFFBQ3BCLE1BRUYsSUFBSyxXQUNISCxFQUFNdE0sUUFBQUEsRUFDTnNNLEVBQU1DLE1BQVEsaUJBQ2RELEVBQU1FLGFBQWUsa0JBQ3JCRixFQUFNZixLQUFPLGVBQ2JlLEVBQU1HLFlBQWMsY0FDcEIsTUFFRixJQUFLLGFBQ0hILEVBQU10TSxRQUFBQSxFQUNOc00sRUFBTUMsTUFBUSxrQkFDZEQsRUFBTUUsYUFBZSxpQkFDckJGLEVBQU1mLEtBQU8sbUJBQ2JlLEVBQU1HLFlBQWMsa0JBQ3BCLE1BRUYsSUFBSyxhQUNIMVIsRUFBV3lCLE9BQVh6QixJQUFBQSxPQUF3QnZJLEtBQUtvQixPQUFPZ0ssV0FBVytPLFFBQS9DNVIsY0FDQTdFLEVBQU8sT0FDUG9XLEVBQU1DLE1BQVEsT0FDZEQsRUFBTWYsS0FBTyxPQUNiLE1BRUYsUUFDTXJZLEVBQVNvWixFQUFNQyxTQUNqQkQsRUFBTUMsTUFBUXJXLEdBRVpoRCxFQUFTb1osRUFBTWYsUUFDakJlLEVBQU1mLEtBQU9ZLEdBSWJTLElBQUFBLEVBQVM5VSxHQUFjd1UsRUFBTTdZLFNBK0NuQyxPQTVDSTZZLEVBQU10TSxRQUVSNE0sRUFBT2hTLFlBQ0wwTyxHQUFTNkIsV0FBVzFZLEtBQUtELEtBQU04WixFQUFNRyxZQUFhLENBQ2hEalEsTUFBTyxtQkFHWG9RLEVBQU9oUyxZQUNMME8sR0FBUzZCLFdBQVcxWSxLQUFLRCxLQUFNOFosRUFBTWYsS0FBTSxDQUN6Qy9PLE1BQU8sdUJBS1hvUSxFQUFPaFMsWUFDTDBPLEdBQVNzQyxZQUFZblosS0FBS0QsS0FBTThaLEVBQU1FLGFBQWMsQ0FDbERoUSxNQUFPLG9CQUdYb1EsRUFBT2hTLFlBQ0wwTyxHQUFTc0MsWUFBWW5aLEtBQUtELEtBQU04WixFQUFNQyxNQUFPLENBQzNDL1AsTUFBTywwQkFJWG9RLEVBQU9oUyxZQUFZME8sR0FBUzZCLFdBQVcxWSxLQUFLRCxLQUFNOFosRUFBTWYsT0FDeERxQixFQUFPaFMsWUFBWTBPLEdBQVNzQyxZQUFZblosS0FBS0QsS0FBTThaLEVBQU1DLFNBSTNENVMsRUFBT29CLEVBQVllLEdBQTBCdEosS0FBS29CLE9BQU9tVyxVQUFVQyxRQUFROVQsR0FBTzZFLElBQ2xGRCxHQUFjOFIsRUFBUTdSLEdBR1QsU0FBVDdFLEdBQ0doRCxFQUFTVixLQUFLeUgsU0FBUytQLFFBQVE5VCxNQUNsQzFELEtBQUt5SCxTQUFTK1AsUUFBUTlULEdBQVEsSUFHM0IrRCxLQUFBQSxTQUFTK1AsUUFBUTlULEdBQU0zRSxLQUFLcWIsSUFFakNwYSxLQUFLeUgsU0FBUytQLFFBQVE5VCxHQUFRMFcsRUFHekJBLENBQUFBLEVBSVRDLFlBQVkzVyxFQUFNNkUsR0FFVnBFLElBQUFBLEVBQVFtQixHQUNaLFFBQ0E2QixFQUNFbUMsR0FBMEJ0SixLQUFLb0IsT0FBT21XLFVBQVVVLE9BQU92VSxJQUN2RCxDQUNFQSxLQUFNLFFBQ040VyxJQUFLLEVBQ0x0WCxJQUFLLElBQ0x1WCxLQUFNLElBQ04xYyxNQUFPLEVBQ1AyYyxhQUFjLE1BRWRDLEtBQU0sU0FDUTdHLGFBQUFBLEdBQUt0USxJQUFJSSxFQUFNMUQsS0FBS29CLFFBQ2xDLGdCQUFpQixFQUNqQixnQkFBaUIsSUFDQSxtQkFFbkJtSCxJQVlKLE9BUktkLEtBQUFBLFNBQVN3USxPQUFPdlUsR0FBUVMsRUFHN0IyUyxHQUFTNEQsZ0JBQWdCemEsS0FBS0QsS0FBTW1FLEdBR3BDcEQsRUFBV2lSLE1BQU03TixHQUVWQSxDQUFBQSxFQUlUd1csZUFBZWpYLEVBQU02RSxHQUNieVAsSUFBQUEsRUFBVzFTLEdBQ2YsV0FDQTZCLEVBQ0VtQyxHQUEwQnRKLEtBQUtvQixPQUFPbVcsVUFBVWEsUUFBUTFVLElBQ3hELENBQ0U0VyxJQUFLLEVBQ0x0WCxJQUFLLElBQ0xuRixNQUFPLEVBQ1A0YyxLQUFNLGNBQ1Msa0JBRWpCbFMsSUFLQTdFLEdBQVMsV0FBVEEsRUFBbUIsQ0FDckJzVSxFQUFTNVAsWUFBWTlDLEdBQWMsT0FBUSxLQUFNLE1BRWpELElBQU1zVixFQUFZLENBQ2hCQyxPQUFRLFNBQ1J4QyxPQUFRLFlBQ1IzVSxHQUNJb1gsRUFBU0YsRUFBWWhILEdBQUt0USxJQUFJc1gsRUFBVzVhLEtBQUtvQixRQUFVLEdBRTlENFcsRUFBU3JQLFVBQVRxUCxLQUFBQSxPQUEwQjhDLEVBQU92SCxjQUtuQyxRQUZBdlQsS0FBS3lILFNBQVMyUSxRQUFRMVUsR0FBUXNVLEVBRXZCQSxDQUFBQSxFQUlUK0MsV0FBV3JYLEVBQU1zWCxHQUNmLElBQU16UyxFQUFhZSxHQUEwQnRKLEtBQUtvQixPQUFPbVcsVUFBVWEsUUFBUTFVLEdBQU9zWCxHQUU1RWxRLEVBQVl4RixHQUNoQixNQUNBNkIsRUFBT29CLEVBQVksQ0FDakJ5QixNQUFRLFVBQUV6QixFQUFXeUIsTUFBUXpCLEVBQVd5QixNQUFRLEdBQXhDLFlBQThDaEssS0FBS29CLE9BQU9nSyxXQUFXZ04sUUFBUTVCLEtBQTdFLEtBQXFGN00sT0FDN0YsYUFBY2lLLEdBQUt0USxJQUFJSSxFQUFNMUQsS0FBS29CLFVBRXBDLFNBTUYsT0FGQXBCLEtBQUt5SCxTQUFTMlEsUUFBUTFVLEdBQVFvSCxFQUV2QkEsQ0FBQUEsRUFNVG1RLHNCQUFzQkMsRUFBVXhYLEdBQUFBLElBQUFBLEVBQUFBLEtBRTlCa0ssR0FBRzNOLEtBQ0RELEtBQ0FrYixFQUNBLGlCQUNDclYsU0FBQUEsR0FFQyxHQUFLLENBQUMsUUFBUyxVQUFXLFlBQWEsY0FBYzlGLFNBQVM4RixFQUFNakksT0FLcEVpSSxFQUFNeEMsaUJBQ053QyxFQUFNc1Ysa0JBR2EsWUFBZnRWLEVBQU1uQyxNQUFWLENBSU0wWCxJQU1BclosRUFOQXFaLEVBQWdCMWIsR0FBUXdiLEVBQVUsMkJBR25DRSxHQUFpQixDQUFDLFFBQVMsY0FBY3JiLFNBQVM4RixFQUFNakksS0FDM0RrWixHQUFTdUUsY0FBY3BiLEtBQUtELEVBQU0wRCxHQUFBQSxHQUloQixVQUFkbUMsRUFBTWpJLE1BQ1UsY0FBZGlJLEVBQU1qSSxLQUF3QndkLEdBQStCLGVBQWR2VixFQUFNakksS0FDdkRtRSxFQUFTbVosRUFBU0ksbUJBRWI1YSxFQUFXcUIsS0FDZEEsRUFBU21aLEVBQVNqVCxXQUFXc1QscUJBRy9CeFosRUFBU21aLEVBQVNNLHVCQUViOWEsRUFBV3FCLEtBQ2RBLEVBQVNtWixFQUFTalQsV0FBV3dULG1CQUlqQ3pRLEdBQVMvSyxLQUFLRCxFQUFNK0IsR0FBQUEsR0ExQmhCLENBMEJ3QixPQVNwQzZMLEdBQUczTixLQUFLRCxLQUFNa2IsRUFBVSxTQUFVclYsU0FBQUEsR0FDZCxXQUFkQSxFQUFNakksS0FFVmtaLEdBQVM0RSxtQkFBbUJ6YixLQUFLRCxFQUFNLFFBQU0sS0FLakQyYixlQUFlLEdBQW9ELFdBQWxEOWQsRUFBa0QsRUFBcERBLE1BQVMrZCxFQUEyQyxFQUFwREEsS0FBZWxZLEVBQXFDLEVBQXBEQSxLQUFxQm9RLEVBQStCLEVBQXBEQSxNQUFvRCxJQUFwRDBGLE1BQTRCQSxPQUF3QixNQUFoQixLQUFnQixNQUFwRHFDLFFBQTBDQSxPQUFVLFNBQzNEdFQsRUFBYWUsR0FBMEJ0SixLQUFLb0IsT0FBT21XLFVBQVVVLE9BQU92VSxJQUVwRXdYLEVBQVc1VixHQUNmLFNBQ0E2QixFQUFPb0IsRUFBWSxDQUNqQjdFLEtBQU0sU0FDTitXLEtBQU0sZ0JBQ056USxNQUFRLFVBQUVoSyxLQUFLb0IsT0FBT2dLLFdBQVcrTyxRQUF6QixZQUFvQzVSLEVBQVd5QixNQUFRekIsRUFBV3lCLE1BQVEsSUFBS0wsT0FDdkYsZUFBZ0JrUyxFQUNoQmhlLE1BQUFBLEtBSUVpZSxFQUFPeFcsR0FBYyxRQUczQndXLEVBQUtySSxVQUFZSyxFQUVicFQsRUFBVzhZLElBQ2JzQyxFQUFLMVQsWUFBWW9SLEdBR25CMEIsRUFBUzlTLFlBQVkwVCxHQUdyQmhlLE9BQU9DLGVBQWVtZCxFQUFVLFVBQVcsQ0FDekNsZCxZQUFZLEVBQ1pzRixJQUFHLGlCQUNnRCxTQUExQzRYLEVBQVM5WSxhQUFhLGVBRDVCLEVBR0hOLElBQUkySixHQUVFQSxHQUNGOUwsTUFBTUMsS0FBS3NiLEVBQVNqVCxXQUFXOFQsVUFDNUJsZCxRQUFRbWQsU0FBQUEsR0FBQUEsT0FBU3RjLEdBQVFzYyxFQUFNLHlCQUF2QkEsSUFDUjdjLFNBQVM2YyxTQUFBQSxHQUFBQSxPQUFTQSxFQUFLdlQsYUFBYSxlQUFnQixRQUEzQ3VULElBR2RkLEVBQVN6UyxhQUFhLGVBQWdCZ0QsRUFBUSxPQUFTLFlBSXRENUosS0FBQUEsVUFBVW9hLEtBQ2JmLEVBQ0EsZUFDQ3JWLFNBQUFBLEdBQ0tuRixJQUFBQSxFQUFpQm1GLElBQXdCLFVBQWRBLEVBQU1qSSxJQUFqQzhDLENBU0osT0FMQW1GLEVBQU14QyxpQkFDTndDLEVBQU1zVixrQkFFTkQsRUFBU1csU0FBQUEsRUFFRG5ZLEdBQ04sSUFBSyxXQUNIMUQsRUFBS2tjLGFBQWUxWCxPQUFPM0csR0FDM0IsTUFFRixJQUFLLFVBQ0VpVSxFQUFBQSxRQUFValUsRUFDZixNQUVGLElBQUssUUFDSG1DLEVBQUtrUyxNQUFRL1AsV0FBV3RFLEdBTzVCaVosR0FBU3VFLGNBQWNwYixLQUFLRCxFQUFNLE9BQVFVLEVBQWlCbUYsR0FBQUEsQ0FBQUEsR0FFN0RuQyxHQUFBQSxHQUlGb1QsR0FBU21FLHNCQUFzQmhiLEtBQUtELEtBQU1rYixFQUFVeFgsR0FFcERrWSxFQUFLeFQsWUFBWThTLEVBQUFBLEVBSW5CM0UsYUFBZ0MsSUFBckJDLEVBQXFCLHVEQUFkLEVBQUdFLEVBQVcsd0RBRTlCLE9BQUtoVyxFQUFVOFYsR0FPUkQsR0FBV0MsRUFGQ0gsR0FBU3JXLEtBQUtzWSxVQUFZLEVBRVQ1QixHQU4zQkYsQ0FNMkJFLEVBSXRDeUYsb0JBQXNELElBQXBDcGEsRUFBb0MsdURBQTNCLEtBQU15VSxFQUFxQix1REFBZCxFQUFHRSxFQUFXLHdEQUUvQ2hXLEVBQVdxQixJQUFZckIsRUFBVThWLEtBS3RDelUsRUFBTzRHLFVBQVltTyxHQUFTUCxXQUFXQyxFQUFNRSxHQUFBQSxFQUkvQzBGLGVBQ09wYyxLQUFLa04sVUFBVXBCLEtBS2hCcEwsRUFBV1YsS0FBS3lILFNBQVN3USxPQUFPRSxTQUNsQ3JCLEdBQVN1RixTQUFTcGMsS0FBS0QsS0FBTUEsS0FBS3lILFNBQVN3USxPQUFPRSxPQUFRblksS0FBS3NjLE1BQVEsRUFBSXRjLEtBQUttWSxRQUk5RXpYLEVBQVdWLEtBQUt5SCxTQUFTK1AsUUFBUUssUUFDbkM3WCxLQUFLeUgsU0FBUytQLFFBQVFLLEtBQUswRSxRQUFVdmMsS0FBS3NjLE9BQXlCLElBQWhCdGMsS0FBS21ZLFFBQUFBLEVBSzVEa0UsU0FBU3RhLEdBQWdCLElBQVJsRSxFQUFRLHlEQUNsQjZDLEVBQVdxQixLQUtoQkEsRUFBT2xFLE1BQVFBLEVBR2ZpWixHQUFTNEQsZ0JBQWdCemEsS0FBS0QsS0FBTStCLEdBQUFBLEVBSXRDeWEsZUFBZTNXLEdBQUFBLElBQUFBLEVBQUFBLEtBQ2IsR0FBSzdGLEtBQUtrTixVQUFVcEIsSUFBT3BMLEVBQVNtRixHQUFwQyxDQUlJaEksSU54a0JzQjRlLEVBQVN6WixFTXdrQi9CbkYsRUFBUSxFQWtCWixHQUFJZ0ksRUFDTUEsT0FBQUEsRUFBTW5DLE1BRVosSUFBSyxhQUNMLElBQUssVUFDTCxJQUFLLFNOL2xCaUIrWSxFTWdtQkV6YyxLQUFLb1MsWU5obUJFcFAsRU1nbUJXaEQsS0FBS3NZLFNBQTdDemEsRU4vbEJRLElBQVo0ZSxHQUF5QixJQUFSelosR0FBYXdCLE9BQU9DLE1BQU1nWSxJQUFZalksT0FBT0MsTUFBTXpCLEdBQy9ELEdBR0F5WixFQUFVelosRUFBTyxLQUFLRSxRQUFRLEdNOGxCWixlQUFmMkMsRUFBTW5DLE1BQ1JvVCxHQUFTdUYsU0FBU3BjLEtBQUtELEtBQU1BLEtBQUt5SCxTQUFTd1EsT0FBT0MsS0FBTXJhLEdBRzFELE1BR0YsSUFBSyxVQUNMLElBQUssWUFqQ1csU0FBQ2tFLEVBQVFvQyxHQUNyQnVZLElBQUFBLEVBQU1oYyxFQUFVeUQsR0FBU0EsRUFBUSxFQUNqQzZULEVBQVd0WCxFQUFXcUIsR0FBVUEsRUFBUy9CLEVBQUt5SCxTQUFTMlEsUUFBUUMsT0FHckUsR0FBSTNYLEVBQVdzWCxHQUFXLENBQ3hCQSxFQUFTbmEsTUFBUTZlLEVBR1gzQyxJQUFBQSxFQUFRL0IsRUFBUzJFLHFCQUFxQixRQUFRLEdBQ2hEamMsRUFBV3FaLEtBQ2JBLEVBQU0vUSxXQUFXLEdBQUc0VCxVQUFZRixFQUFBQSxDQUFBQSxDQXVCaENHLENBQVk3YyxLQUFLeUgsU0FBUzJRLFFBQVFDLE9BQXdCLElBQWhCclksS0FBSzhjLFVBdkM3QyxDTnJrQjJCOVosRU11bkJyQzBYLGdCQUFnQjNZLEdBRWQsSUFBTTZLLEVBQVFsTSxFQUFTcUIsR0FBVUEsRUFBT0EsT0FBU0EsRUFHakQsR0FBS3JCLEVBQVdrTSxJQUF5QyxVQUEvQkEsRUFBTXhLLGFBQWEsUUFBN0MsQ0FLQSxHQUFJMUMsR0FBUWtOLEVBQU81TSxLQUFLb0IsT0FBT21XLFVBQVVVLE9BQU9DLE1BQU8sQ0FDckR0TCxFQUFNbkUsYUFBYSxnQkFBaUJ6SSxLQUFLb1MsYUFDbkNBLElBQUFBLEVBQWMwRSxHQUFTUCxXQUFXdlcsS0FBS29TLGFBQ3ZDa0csRUFBV3hCLEdBQVNQLFdBQVd2VyxLQUFLc1ksVUFDcEN0RixFQUFTWSxHQUFLdFEsSUFBSSxZQUFhdEQsS0FBS29CLFFBQzFDd0wsRUFBTW5FLGFBQ0osaUJBQ0F1SyxFQUFPbkosUUFBUSxnQkFBaUJ1SSxHQUFhdkksUUFBUSxhQUFjeU8sR0FBQUEsTUFFaEUsR0FBSTVZLEdBQVFrTixFQUFPNU0sS0FBS29CLE9BQU9tVyxVQUFVVSxPQUFPRSxRQUFTLENBQzlELElBQU00RSxFQUF3QixJQUFkblEsRUFBTS9PLE1BQ3RCK08sRUFBTW5FLGFBQWEsZ0JBQWlCc1UsR0FDcENuUSxFQUFNbkUsYUFBYSxpQkFBbkJtRSxHQUFBQSxPQUF3Q21RLEVBQVE3WixRQUFRLEdBQXhEMEosS0FBd0QsTUFFeERBLEVBQU1uRSxhQUFhLGdCQUFpQm1FLEVBQU0vTyxPQUl2Q3NJLEVBQVFLLFVBS2JvRyxFQUFNbkwsTUFBTXViLFlBQVksVUFBZXBRLEVBQU0vTyxNQUFRK08sRUFBTTVKLElBQU8sSUFBOUIsT0FJdENpYSxrQkFBa0JwWCxHQUFPLFFBRXZCLEdBQ0c3RixLQUFLb0IsT0FBTzhiLFNBQVNoRixNQUNyQnhYLEVBQVdWLEtBQUt5SCxTQUFTd1EsT0FBT0MsT0FDaEN4WCxFQUFXVixLQUFLeUgsU0FBUzJRLFFBQVFHLGNBQ2hCLElBQWxCdlksS0FBS3NZLFNBSlAsQ0FTQSxJQUFNNkUsRUFBYW5kLEtBQUt5SCxTQUFTMlEsUUFBUUcsWUFDbkM2RSxFQUFBQSxHQUFBQSxPQUFhcGQsS0FBS29CLE9BQU9nSyxXQUFXb04sUUFBcEM0RSxhQUNBNVAsRUFBVTZQLFNBQUFBLEdBQUFBLE9BQVNqVCxHQUFZK1MsRUFBWUMsRUFBU0MsRUFBMUNBLEVBR1osR0FBQXJkLEtBQUs2TSxNQUNQVyxHQUFBQSxPQURFLENBTUF1UCxJQUFBQSxFQUFVLEVBQ1JPLEVBQWF0ZCxLQUFLeUgsU0FBU3VRLFNBQVN4Vix3QkFFMUMsR0FBSTlCLEVBQVNtRixHQUNYa1gsRUFBVyxJQUFNTyxFQUFXNWEsT0FBVW1ELEVBQU0wWCxNQUFRRCxFQUFXMWEsVUFDMUQsS0FBSTZILEdBQVMwUyxFQUFZQyxHQUc5QixPQUZBTCxFQUFVNWEsV0FBV2diLEVBQVcxYixNQUFNbUIsS0FBTSxHQU0xQ21hLENBQUFBLEVBQVUsRUFDWkEsRUFBVSxFQUNEQSxFQUFVLE1BQ25CQSxFQUFVLEtBR052RyxJQUFBQSxFQUFReFcsS0FBS3NZLFNBQVcsSUFBT3lFLEVBR3JDSSxFQUFXeFUsVUFBWW1PLEdBQVNQLFdBQVdDLEdBRzNDLElBQU1nSCxFQUFRLFFBQUhDLEVBQUd6ZCxLQUFLb0IsT0FBT3NjLGVBQUFBLElBQVpELEdBQUgsUUFBR0UsRUFBQUEsRUFBcUJDLGNBQUFBLElBQXhCRCxPQUFBQSxFQUFHLEVBQTZCL1gsTUFBSyxxQkFBRzRRLE9BQW9CelQsS0FBS0ksTUFBTXFULEVBQWxDLElBRzVDZ0gsR0FDRkwsRUFBV1UsbUJBQW1CLGFBQTlCVixHQUFBQSxPQUErQ0ssRUFBTXpELE1BQXJEb0QsU0FJRkEsRUFBVzFiLE1BQU1tQixLQUFqQnVhLEdBQUFBLE9BQTJCSixFQUEzQkksS0FJSXpjLEVBQVNtRixJQUFVLENBQUMsYUFBYyxjQUFjOUYsU0FBUzhGLEVBQU1uQyxPQUNqRThKLEVBQXNCLGVBQWYzSCxFQUFNbkMsS0F6Q2IsQ0FWTSxDQW1ET0EsRUFLakJvYSxXQUFXalksR0FFSGtZLElBQUFBLEdBQVVyZCxFQUFXVixLQUFLeUgsU0FBUzJRLFFBQVFFLFdBQWF0WSxLQUFLb0IsT0FBTzRjLFdBRzFFbEgsR0FBU3FGLGtCQUFrQmxjLEtBQ3pCRCxLQUNBQSxLQUFLeUgsU0FBUzJRLFFBQVFoRyxZQUN0QjJMLEVBQVMvZCxLQUFLc1ksU0FBV3RZLEtBQUtvUyxZQUFjcFMsS0FBS29TLFlBQ2pEMkwsR0FJRWxZLEdBQXdCLGVBQWZBLEVBQU1uQyxNQUF5QjFELEtBQUt5TSxNQUFNd1IsU0FLdkRuSCxHQUFTMEYsZUFBZXZjLEtBQUtELEtBQU02RixFQUFBQSxFQUlyQ3FZLGlCQUVFLEdBQUtsZSxLQUFLa04sVUFBVXBCLEtBQVE5TCxLQUFLb0IsT0FBTzRjLGFBQWNoZSxLQUFLb1MsYUFBM0QsQ0FRQSxHQUFJcFMsS0FBS3NZLFVBQUx0WSxLQUFBQSxJQUFpQixFQUFLLElBR3hCLE9BRkFrSyxHQUFhbEssS0FBS3lILFNBQVMyUSxRQUFRaEcsYUFBQUEsUUFDbkNsSSxHQUFhbEssS0FBS3lILFNBQVN1USxVQUFBQSxHQUt6QnRYLEVBQVdWLEtBQUt5SCxTQUFTd1EsT0FBT0MsT0FDN0J6USxLQUFBQSxTQUFTd1EsT0FBT0MsS0FBS3pQLGFBQWEsZ0JBQWlCekksS0FBS3NZLFVBSS9ELElBQU02RixFQUFjemQsRUFBV1YsS0FBS3lILFNBQVMyUSxRQUFRRSxXQUdoRDZGLEdBQWVuZSxLQUFLb0IsT0FBT2dkLGlCQUFtQnBlLEtBQUtxUyxRQUN0RHlFLEdBQVNxRixrQkFBa0JsYyxLQUFLRCxLQUFNQSxLQUFLeUgsU0FBUzJRLFFBQVFoRyxZQUFhcFMsS0FBS3NZLFVBSTVFNkYsR0FDRnJILEdBQVNxRixrQkFBa0JsYyxLQUFLRCxLQUFNQSxLQUFLeUgsU0FBUzJRLFFBQVFFLFNBQVV0WSxLQUFLc1ksVUFHekV0WSxLQUFLb0IsT0FBT3NjLFFBQVFsYyxTQUN0QnNWLEdBQVN1SCxXQUFXcGUsS0FBS0QsTUFJM0I4VyxHQUFTbUcsa0JBQWtCaGQsS0FBS0QsS0FwQ3hCLENBb0N3QkEsRUFJbENzZSxpQkFBaUJDLEVBQVMvUSxHQUN4QnRELEdBQWFsSyxLQUFLeUgsU0FBU3FRLFNBQVNOLFFBQVErRyxJQUFXL1EsRUFBQUEsRUFJekRnUixjQUFjRCxFQUFTelQsRUFBVzNHLEdBQzFCc2EsSUFBQUEsRUFBT3plLEtBQUt5SCxTQUFTcVEsU0FBUzRHLE9BQU9ILEdBQ3ZDMWdCLEVBQVEsS0FDUitkLEVBQU85USxFQUVQeVQsR0FBWSxhQUFaQSxFQUNGMWdCLEVBQVFtQyxLQUFLa2MsaUJBQ1IsQ0FTRCxHQVJKcmUsRUFBUzZDLEVBQVN5RCxHQUFpQm5FLEtBQUt1ZSxHQUFicGEsRUFHdkJ6RCxFQUFTN0MsS0FDWEEsRUFBUW1DLEtBQUtvQixPQUFPbWQsR0FBU0ksVUFJMUJqZSxFQUFTVixLQUFLbU4sUUFBUW9SLE1BQWN2ZSxLQUFLbU4sUUFBUW9SLEdBQVN4ZSxTQUFTbEMsR0FFdEUsWUFES2lWLEtBQUFBLE1BQU0yRixLQUFOM0YseUJBQUFBLE9BQW9DalYsRUFBcENpVixVQUFBQSxPQUFrRHlMLElBS3pELElBQUt2ZSxLQUFLb0IsT0FBT21kLEdBQVNwUixRQUFRcE4sU0FBU2xDLEdBRXpDLFlBREtpVixLQUFBQSxNQUFNMkYsS0FBTjNGLHNCQUFBQSxPQUFpQ2pWLEVBQWpDaVYsVUFBQUEsT0FBK0N5TCxHQVd4RCxJQUxLN2QsRUFBV2tiLEtBQ2RBLEVBQU82QyxHQUFRQSxFQUFLdmQsY0FBYyxrQkFJL0JSLEVBQVdrYixHQUFoQixDQUtjNWIsS0FBS3lILFNBQVNxUSxTQUFTTixRQUFRK0csR0FBU3JkLGNBQXhDbEIsSUFBQUEsT0FBMERBLEtBQUtvQixPQUFPZ0ssV0FBV3FPLEtBQUs1YixRQUM5RjRWLFVBQVlxRCxHQUFTOEgsU0FBUzNlLEtBQUtELEtBQU11ZSxFQUFTMWdCLEdBR2xEa0UsSUFBQUEsRUFBUzZaLEdBQVFBLEVBQUsxYSxjQUFMMGEsV0FBQUEsT0FBOEIvZCxFQUE5QitkLE9BRW5CbGIsRUFBV3FCLEtBQ2JBLEVBQU84WixTQUFBQSxFQVhELENBV1csRUFLckIrQyxTQUFTTCxFQUFTMWdCLEdBQ2hCLE9BQVEwZ0IsR0FDTixJQUFLLFFBQ0gsT0FBaUIsSUFBVjFnQixFQUFjK1YsR0FBS3RRLElBQUksU0FBVXRELEtBQUtvQixRQUE1QixVQUF5Q3ZELEVBQXpDLFdBRW5CLElBQUssVUFDSCxHQUFJNkMsRUFBVTdDLEdBQVEsQ0FDcEIsSUFBTWtjLEVBQVFuRyxHQUFLdFEsSUFBTHNRLGdCQUFBQSxPQUF5Qi9WLEdBQVNtQyxLQUFLb0IsUUFFckQsT0FBSzJZLEVBQU14YixPQUlKd2IsRUFKRkEsR0FBQUEsT0FDT2xjLEVBRFBrYyxJQU9BM0csQ0FBQUEsT0FBQUEsR0FBWXZWLEdBRXJCLElBQUssV0FDSCxPQUFPa2EsR0FBUzZHLFNBQVMzZSxLQUFLRCxNQUVoQyxRQUNFLE9BQU8sT0FLYjZlLGVBQWUxUixHQUFBQSxJQUFBQSxFQUFBQSxLQUViLEdBQUt6TSxFQUFXVixLQUFLeUgsU0FBU3FRLFNBQVM0RyxPQUFPNU0sU0FBOUMsQ0FJTXBPLElBQUFBLEVBQU8sVUFDUGtZLEVBQU81YixLQUFLeUgsU0FBU3FRLFNBQVM0RyxPQUFPNU0sUUFBUTVRLGNBQWMsaUJBRzdEUixFQUFTeU0sS0FDTkEsS0FBQUEsUUFBUTJFLFFBQVVsRCxHQUFPekIsR0FBU3RPLFFBQVFpVCxTQUFBQSxHQUFBQSxPQUFZOVIsRUFBS29CLE9BQU8wUSxRQUFRM0UsUUFBUXBOLFNBQVMrUixFQUFqREEsS0FJM0N0RSxJQUFBQSxHQUFVOU0sRUFBU1YsS0FBS21OLFFBQVEyRSxVQUFZOVIsS0FBS21OLFFBQVEyRSxRQUFRdlQsT0FBUyxFQVU1RSxHQVRKdVksR0FBU3dILGlCQUFpQnJlLEtBQUtELEtBQU0wRCxFQUFNOEosR0FHM0N6RSxHQUFhNlMsR0FHYjlFLEdBQVNnSSxVQUFVN2UsS0FBS0QsTUFHbkJ3TixFQUFELENBS0V1UixJQUFBQSxFQUFZak4sU0FBQUEsR0FDaEIsSUFBTWlJLEVBQVFuRyxHQUFLdFEsSUFBTHNRLGdCQUFBQSxPQUF5QjlCLEdBQVc5UixFQUFLb0IsUUFFdkQsT0FBSzJZLEVBQU14YixPQUlKdVksR0FBU3lDLFlBQVl0WixLQUFLRCxFQUFNK1osR0FIOUIsTUFPTjVNLEtBQUFBLFFBQVEyRSxRQUNWa04sTUFBSyxTQUFDdmMsRUFBR3djLEdBQ1IsSUFBTUMsRUFBVWxmLEVBQUtvQixPQUFPMFEsUUFBUTNFLFFBQ3BDLE9BQU8rUixFQUFRcFEsUUFBUXJNLEdBQUt5YyxFQUFRcFEsUUFBUW1RLEdBQUssR0FBSyxLQUV2RDlmLFNBQVMyUyxTQUFBQSxHQUNSZ0YsR0FBUzZFLGVBQWUxYixLQUFLRCxFQUFNLENBQ2pDbkMsTUFBT2lVLEVBQ1A4SixLQUFBQSxFQUNBbFksS0FBQUEsRUFDQW9RLE1BQU9nRCxHQUFTOEgsU0FBUzNlLEtBQUtELEVBQU0sVUFBVzhSLEdBQy9DMEgsTUFBT3VGLEVBQVNqTixJQUFBQSxJQUl0QmdGLEdBQVMwSCxjQUFjdmUsS0FBS0QsS0FBTTBELEVBQU1rWSxFQTlCaEMsQ0F2QkEsQ0FxRGdDQSxFQW1EMUN1RCxrQkFBQUEsSUFBQUEsRUFBQUEsS0FFRSxHQUFLemUsRUFBV1YsS0FBS3lILFNBQVNxUSxTQUFTNEcsT0FBTzNHLFVBQTlDLENBS01yVSxJQUFBQSxFQUFPLFdBQ1BrWSxFQUFPNWIsS0FBS3lILFNBQVNxUSxTQUFTNEcsT0FBTzNHLFNBQVM3VyxjQUFjLGlCQUM1RGtlLEVBQVNySCxHQUFTc0gsVUFBVXBmLEtBQUtELE1BQ2pDd04sRUFBU3BKLFFBQVFnYixFQUFPN2dCLFFBWTFCLEdBVEp1WSxHQUFTd0gsaUJBQWlCcmUsS0FBS0QsS0FBTTBELEVBQU04SixHQUczQ3pFLEdBQWE2UyxHQUdiOUUsR0FBU2dJLFVBQVU3ZSxLQUFLRCxNQUduQndOLEVBQUQsQ0FLRUwsSUFBQUEsRUFBVWlTLEVBQU9uYixLQUFJLFNBQUNxYixFQUFPemhCLEdBQVIsT0FDekJBLE1BQUFBLEVBQ0FnZSxRQUFTN2IsRUFBSytYLFNBQVN3SCxTQUFXdmYsRUFBS2tjLGVBQWlCcmUsRUFDeERpVyxNQUFPaUUsR0FBUzZHLFNBQVMzZSxLQUFLRCxFQUFNc2YsR0FDcEM5RixNQUFPOEYsRUFBTUUsVUFBWTFJLEdBQVN5QyxZQUFZdFosS0FBS0QsRUFBTXNmLEVBQU1FLFNBQVNuTSxlQUN4RXVJLEtBQUFBLEVBQ0FsWSxLQUFNLFdBTm1CLElBVTNCeUosRUFBUXNTLFFBQVEsQ0FDZDVoQixPQUFRLEVBQ1JnZSxTQUFVN2IsS0FBSytYLFNBQVN3SCxRQUN4QnpMLE1BQU9GLEdBQUt0USxJQUFJLFdBQVl0RCxLQUFLb0IsUUFDakN3YSxLQUFBQSxFQUNBbFksS0FBTSxhQUlSeUosRUFBUWhPLFFBQVEyWCxHQUFTNkUsZUFBZU0sS0FBS2pjLE9BRTdDOFcsR0FBUzBILGNBQWN2ZSxLQUFLRCxLQUFNMEQsRUFBTWtZLEVBekJoQyxDQXBCQSxDQTZDZ0NBLEVBSTFDOEQsZUFBQUEsSUFBQUEsRUFBQUEsS0FFRSxHQUFLaGYsRUFBV1YsS0FBS3lILFNBQVNxUSxTQUFTNEcsT0FBT3hNLE9BQTlDLENBSU14TyxJQUFBQSxFQUFPLFFBQ1BrWSxFQUFPNWIsS0FBS3lILFNBQVNxUSxTQUFTNEcsT0FBT3hNLE1BQU1oUixjQUFjLGlCQUcxRGlNLEtBQUFBLFFBQVErRSxNQUFRbFMsS0FBS21OLFFBQVErRSxNQUFNclQsUUFBUXFELFNBQUFBLEdBQUFBLE9BQU1BLEdBQUtsQyxFQUFLMmYsY0FBZ0J6ZCxHQUFLbEMsRUFBSzRmLFlBQTFDMWQsSUFHMUNzTCxJQUFBQSxHQUFVOU0sRUFBU1YsS0FBS21OLFFBQVErRSxRQUFVbFMsS0FBS21OLFFBQVErRSxNQUFNM1QsT0FBUyxFQUM1RXVZLEdBQVN3SCxpQkFBaUJyZSxLQUFLRCxLQUFNMEQsRUFBTThKLEdBRzNDekUsR0FBYTZTLEdBR2I5RSxHQUFTZ0ksVUFBVTdlLEtBQUtELE1BR25Cd04sSUFLTHhOLEtBQUttTixRQUFRK0UsTUFBTS9TLFNBQVMrUyxTQUFBQSxHQUMxQjRFLEdBQVM2RSxlQUFlMWIsS0FBS0QsRUFBTSxDQUNqQ25DLE1BQU9xVSxFQUNQMEosS0FBQUEsRUFDQWxZLEtBQUFBLEVBQ0FvUSxNQUFPZ0QsR0FBUzhILFNBQVMzZSxLQUFLRCxFQUFNLFFBQVNrUyxJQUFBQSxJQUlqRDRFLEdBQVMwSCxjQUFjdmUsS0FBS0QsS0FBTTBELEVBQU1rWSxHQWxDaEMsQ0FrQ2dDQSxFQUkxQ2tELFlBQ1EsSUFBRXRILEVBQVl4WCxLQUFLeUgsU0FBU3FRLFNBQTVCLFFBQ0FzRixHQUFXMWMsRUFBUzhXLElBQVkxWixPQUFPK2hCLE9BQU9ySSxHQUFTMEMsTUFBTUUsU0FBQUEsR0FBQUEsT0FBWUEsRUFBT25VLE1BQW5CbVUsSUFFbkVsUSxHQUFhbEssS0FBS3lILFNBQVNxUSxTQUFTMkIsTUFBTzJELEVBQUFBLEVBSTdDMUIsbUJBQW1CK0MsR0FBaUIsSUFBWHhULEVBQVcsd0RBQzlCLElBQUFqTCxLQUFLeUgsU0FBU3FRLFNBQVNnSSxNQUFNN1osT0FBN0IsQ0FJQWxFLElBQUFBLEVBQVMwYyxFQUVSL2QsRUFBV3FCLEtBQ2RBLEVBQVNqRSxPQUFPK2hCLE9BQU83ZixLQUFLeUgsU0FBU3FRLFNBQVM0RyxRQUFROVksTUFBTW1hLFNBQUFBLEdBQUFBLE9BQU9BLEVBQUU5WixNQUFUOFosS0FHOUQsSUFBTUMsRUFBWWplLEVBQU9iLGNBQWMsc0JBRXZDOEosR0FBUy9LLEtBQUtELEtBQU1nZ0IsRUFBVy9VLEVBWHZCLENBV3VCQSxFQUlqQ2dWLFdBQVc5YixHQUNILElBQUUyYixFQUFVOWYsS0FBS3lILFNBQVNxUSxTQUExQixNQUNBc0MsRUFBU3BhLEtBQUt5SCxTQUFTK1AsUUFBUU0sU0FHckMsR0FBS3BYLEVBQVdvZixJQUFXcGYsRUFBVzBaLEdBQXRDLENBS00sSUFBRW5VLEVBQVc2WixFQUFiLE9BQ0Z6QyxFQUFPcFgsRUFFWCxHQUFJdkYsRUFBV3lELEdBQ2JrWixFQUFPbFosT0FDRixHQUFJekQsRUFBaUJ5RCxJQUF3QixXQUFkQSxFQUFNdkcsSUFDMUN5ZixHQUFBQSxPQUNLLEdBQUkzYyxFQUFTeUQsR0FBUSxDQUcxQixJQUFNcEMsRUFBU3JCLEVBQVl5RCxFQUFNK2IsY0FBZ0IvYixFQUFNK2IsZUFBZSxHQUFLL2IsRUFBTXBDLE9BQzNFb2UsRUFBYUwsRUFBTXRWLFNBQVN6SSxHQUtsQyxHQUFJb2UsSUFBZ0JBLEdBQWNoYyxFQUFNcEMsU0FBV3FZLEdBQVVpRCxFQUMzRCxNQUtKakQsQ0FBQUEsRUFBTzNSLGFBQWEsZ0JBQWlCNFUsR0FHckNuVCxHQUFhNFYsR0FBUXpDLEdBR3JCalQsR0FBWXBLLEtBQUt5SCxTQUFTcUQsVUFBVzlLLEtBQUtvQixPQUFPZ0ssV0FBV3FPLEtBQUtwRSxLQUFNZ0ksR0FHbkVBLEdBQVEzYyxFQUFpQnlELEdBQzNCMlMsR0FBUzRFLG1CQUFtQnpiLEtBQUtELEtBQU0sU0FDN0JxZCxHQUFTcFgsR0FFbkIrRSxHQUFTL0ssS0FBS0QsS0FBTW9hLEVBQVExWixFQUFpQnlELEdBdkN2QyxDQXVDdUNBLEVBS2pEaWMsWUFBWUMsR0FDVixJQUFNQyxFQUFRRCxFQUFJdFksV0FBQUEsR0FDbEJ1WSxFQUFNN2UsTUFBTThlLFNBQVcsV0FDdkJELEVBQU03ZSxNQUFNK2UsUUFBVSxFQUN0QkYsRUFBTUcsZ0JBQWdCLFVBR3RCSixFQUFJcFksV0FBV0csWUFBWWtZLEdBRzNCLElBQU01ZCxFQUFRNGQsRUFBTUksWUFDZDNRLEVBQVN1USxFQUFNSyxhQUtkLE9BRlA5WCxHQUFjeVgsR0FFUCxDQUNMNWQsTUFBQUEsRUFDQXFOLE9BQUFBLEVBQUFBLEVBS0pzTCxnQkFBb0MsV0FBdEIzWCxFQUFzQix1REFBZixHQUFJdUgsRUFBVyx3REFDNUJsSixFQUFTL0IsS0FBS3lILFNBQVNxRCxVQUFVNUosY0FBeEJsQixrQkFBQUEsT0FBd0RBLEtBQUtpSyxHQUE3RGpLLEtBQUFBLE9BQW1FMEQsSUFHbEYsR0FBS2hELEVBQVdxQixHQUFoQixDQUtBLElBQU0rSSxFQUFZL0ksRUFBT2tHLFdBQ25Cd1UsRUFBVTljLE1BQU1DLEtBQUtrTCxFQUFVaVIsVUFBVW5XLE1BQU1vVyxTQUFBQSxHQUFBQSxPQUFVQSxFQUFLL1YsTUFBZitWLElBR2pEMVEsR0FBQUEsR0FBUXdCLGNBQWdCeEIsR0FBUXlCLGNBQWUsQ0FFakRqQyxFQUFVckosTUFBTWlCLE1BQWhCb0ksR0FBQUEsT0FBMkIyUixFQUFRaUUsWUFBbkM1VixNQUNBQSxFQUFVckosTUFBTXNPLE9BQWhCakYsR0FBQUEsT0FBNEIyUixFQUFRa0UsYUFBcEM3VixNQUdBLElBQU04VixFQUFPOUosR0FBU3NKLFlBQVluZ0IsS0FBS0QsS0FBTStCLEdBa0I3QzZMLEdBQUczTixLQUFLRCxLQUFNOEssRUFBV3pGLEdBZlJRLFNBQVhnYixFQUFXaGIsR0FFWEEsRUFBTTlELFNBQVcrSSxHQUFjLENBQUMsUUFBUyxVQUFVL0ssU0FBUzhGLEVBQU1pYixnQkFLdEVoVyxFQUFVckosTUFBTWlCLE1BQVEsR0FDeEJvSSxFQUFVckosTUFBTXNPLE9BQVMsR0FHekJsQyxHQUFJNU4sS0FBS0QsRUFBTThLLEVBQVd6RixFQUFvQndiLEdBQUFBLElBT2hEL1YsRUFBVXJKLE1BQU1pQixNQUFoQm9JLEdBQUFBLE9BQTJCOFYsRUFBS2xlLE1BQWhDb0ksTUFDQUEsRUFBVXJKLE1BQU1zTyxPQUFoQmpGLEdBQUFBLE9BQTRCOFYsRUFBSzdRLE9BQWpDakYsS0FJRlosQ0FBQUEsR0FBYXVTLEdBQUFBLEdBR2J2UyxHQUFhbkksR0FBQUEsR0FHYitVLEdBQVM0RSxtQkFBbUJ6YixLQUFLRCxLQUFNK0IsRUFBUWtKLEVBOUN2QyxDQThDdUNBLEVBSWpEOFYsaUJBQ1EzRyxJQUFBQSxFQUFTcGEsS0FBS3lILFNBQVMrUCxRQUFRd0osU0FHaEN0Z0IsRUFBVzBaLElBS2hCQSxFQUFPM1IsYUFBYSxPQUFRekksS0FBS2doQixTQUFBQSxFQUluQ0MsT0FBT25MLEdBQUFBLElBQUFBLEVBQUFBLEtBRUhtRixFQVFFbkUsR0FURSxzQkFFSjRDLEVBT0U1QyxHQVRFLGFBR0o2RCxFQU1FN0QsR0FURSxlQUlKdUQsRUFLRXZELEdBVEUsWUFLSmlFLEVBSUVqRSxHQVRFLFdBTUorSCxFQUdFL0gsR0FURSxlQU9KNEksRUFFRTVJLEdBVEUsYUFRSnVFLEVBQ0V2RSxHQVRFLGNBVU45VyxLQUFLeUgsU0FBU3FQLFNBQVcsS0FHckJwVyxFQUFTVixLQUFLb0IsT0FBTzBWLFdBQWE5VyxLQUFLb0IsT0FBTzBWLFNBQVMvVyxTQUFTLGVBQ2xFQyxLQUFLeUgsU0FBU3FELFVBQVUxQyxZQUFZc1IsRUFBYXpaLEtBQUtELEtBQU0sZUFJOUQsSUFBTThLLEVBQVl4RixHQUFjLE1BQU9nRSxHQUEwQnRKLEtBQUtvQixPQUFPbVcsVUFBVVQsU0FBU3BQLFVBQ2hHMUgsS0FBS3lILFNBQVNxUCxTQUFXaE0sRUFHekIsSUFBTW9XLEVBQW9CLENBQUVsWCxNQUFPLHdCQXdVbkMsT0FyVUE0RSxHQUFPbE8sRUFBU1YsS0FBS29CLE9BQU8wVixVQUFZOVcsS0FBS29CLE9BQU8wVixTQUFXLElBQUkzWCxTQUFTZ2IsU0FBQUEsR0FzQnRFQSxHQXBCWSxZQUFaQSxHQUNGclAsRUFBVTFDLFlBQVlzUixFQUFhelosS0FBS0QsRUFBTSxVQUFXa2hCLElBSTNDLFdBQVovRyxHQUNGclAsRUFBVTFDLFlBQVlzUixFQUFhelosS0FBS0QsRUFBTSxTQUFVa2hCLElBSTFDLFNBQVovRyxHQUNGclAsRUFBVTFDLFlBQVlzUixFQUFhelosS0FBS0QsRUFBTSxPQUFRa2hCLElBSXhDLGlCQUFaL0csR0FDRnJQLEVBQVUxQyxZQUFZc1IsRUFBYXpaLEtBQUtELEVBQU0sZUFBZ0JraEIsSUFJaEQsYUFBWi9HLEVBQXdCLENBQzFCLElBQU1nSCxFQUFvQjdiLEdBQWMsTUFBTyxDQUM3QzBFLE1BQU8sR0FBUEEsT0FBVWtYLEVBQWtCbFgsTUFBNUJBLGdDQUdJZ08sRUFBVzFTLEdBQWMsTUFBT2dFLEdBQTBCdEosRUFBS29CLE9BQU9tVyxVQUFVUyxXQWV0RixHQVpBQSxFQUFTNVAsWUFDUGlTLEVBQVlwYSxLQUFLRCxFQUFNLE9BQVEsQ0FDN0JpSyxHQUFJLGFBQUpBLE9BQWlCNkwsRUFBSzdMLE9BSzFCK04sRUFBUzVQLFlBQVl1UyxFQUFlMWEsS0FBS0QsRUFBTSxXQUszQ0EsRUFBS29CLE9BQU84YixTQUFTaEYsS0FBTSxDQUM3QixJQUFNTSxFQUFVbFQsR0FDZCxPQUNBLENBQ0UwRSxNQUFPaEssRUFBS29CLE9BQU9nSyxXQUFXb04sU0FFaEMsU0FHRlIsRUFBUzVQLFlBQVlvUSxHQUNyQnhZLEVBQUt5SCxTQUFTMlEsUUFBUUcsWUFBY0MsQ0FHdEN4WSxDQUFBQSxFQUFLeUgsU0FBU3VRLFNBQVdBLEVBQ3pCbUosRUFBa0IvWSxZQUFZcEksRUFBS3lILFNBQVN1USxVQUM1Q2xOLEVBQVUxQyxZQUFZK1ksRUFjeEIsSUFWZ0IsaUJBQVpoSCxHQUNGclAsRUFBVTFDLFlBQVkyUyxFQUFXOWEsS0FBS0QsRUFBTSxjQUFla2hCLElBSTdDLGFBQVovRyxHQUNGclAsRUFBVTFDLFlBQVkyUyxFQUFXOWEsS0FBS0QsRUFBTSxXQUFZa2hCLElBSTFDLFNBQVovRyxHQUFrQyxXQUFaQSxFQUFzQixDQUMxQyxJQUFFaEMsRUFBV25ZLEVBQUt5SCxTQUFsQixPQXdCQTBTLEdBckJDelosRUFBV3lYLElBQVlyTixFQUFVTixTQUFTMk4sS0FDN0NBLEVBQVM3UyxHQUNQLE1BQ0E2QixFQUFPLENBQUMsRUFBRytaLEVBQW1CLENBQzVCbFgsTUFBUSxVQUFFa1gsRUFBa0JsWCxNQUFwQixpQkFBeUNMLFVBSXJEM0osRUFBS3lILFNBQVMwUSxPQUFTQSxFQUV2QnJOLEVBQVUxQyxZQUFZK1AsSUFJUixTQUFaZ0MsR0FDRmhDLEVBQU8vUCxZQUFZc1IsRUFBYXpaLEtBQUtELEVBQU0sU0FNN0IsV0FBWm1hLElBQXlCaFUsRUFBUVMsTUFBTyxDQUUxQyxJQUFNMkIsRUFBYSxDQUNqQnZGLElBQUssRUFDTHVYLEtBQU0sSUFDTjFjLE1BQU9tQyxFQUFLb0IsT0FBTytXLFFBSXJCQSxFQUFPL1AsWUFDTGlTLEVBQVlwYSxLQUNWRCxFQUNBLFNBQ0FtSCxFQUFPb0IsRUFBWSxDQUNqQjBCLEdBQUksZUFBSkEsT0FBbUI2TCxFQUFLN0wsT0FBQUEsQ0FhbEMsSUFMZ0IsYUFBWmtRLEdBQ0ZyUCxFQUFVMUMsWUFBWXNSLEVBQWF6WixLQUFLRCxFQUFNLFdBQVlraEIsSUFJNUMsYUFBWi9HLElBQTJCelosRUFBU1YsRUFBS29CLE9BQU8wVyxVQUFXLENBQ3ZEcFEsSUFBQUEsRUFBVXBDLEdBQ2QsTUFDQTZCLEVBQU8sQ0FBQyxFQUFHK1osRUFBbUIsQ0FDNUJsWCxNQUFRLFVBQUVrWCxFQUFrQmxYLE1BQXBCLGVBQXVDTCxPQUMvQzFELE9BQVEsTUFJWnlCLEVBQVFVLFlBQ05zUixFQUFhelosS0FBS0QsRUFBTSxXQUFZLENBQ2xDLG1CQUNBLHdDQUFrQzhWLEVBQUs3TCxJQUN0QixzQkFJckIsSUFBTTZWLEVBQVF4YSxHQUFjLE1BQU8sQ0FDakMwRSxNQUFPLHdCQUNQQyxHQUFJLGlCQUFKQSxPQUFxQjZMLEVBQUs3TCxJQUMxQmhFLE9BQVEsS0FHSm1iLEVBQVE5YixHQUFjLE9BRXRCK2IsRUFBTy9iLEdBQWMsTUFBTyxDQUNoQzJFLEdBQUksaUJBQUpBLE9BQXFCNkwsRUFBSzdMLEdBQTFCQSxXQUlJd1AsRUFBT25VLEdBQWMsTUFBTyxDQUNoQ21WLEtBQU0sU0FHUjRHLEVBQUtqWixZQUFZcVIsR0FDakIySCxFQUFNaFosWUFBWWlaLEdBQ2I1WixFQUFBQSxTQUFTcVEsU0FBUzRHLE9BQU8yQyxLQUFPQSxFQUdyQ3JoQixFQUFLb0IsT0FBTzBXLFNBQVMzWSxTQUFTdUUsU0FBQUEsR0FFNUIsSUFBTXdYLEVBQVc1VixHQUNmLFNBQ0E2QixFQUFPbUMsR0FBMEJ0SixFQUFLb0IsT0FBT21XLFVBQVVDLFFBQVFNLFVBQVcsQ0FDeEVwVSxLQUFNLFNBQ05zRyxNQUFPLEdBQVBBLE9BQVVoSyxFQUFLb0IsT0FBT2dLLFdBQVcrTyxRQUFqQ25RLEtBQUFBLE9BQTRDaEssRUFBS29CLE9BQU9nSyxXQUFXK08sUUFBbkVuUSxhQUNBeVEsS0FBTSxXQUNOLG1CQUNBeFUsT0FBUSxNQUtaZ1YsRUFBc0JoYixLQUFLRCxFQUFNa2IsRUFBVXhYLEdBRzNDa0ssR0FBRzNOLEtBQUtELEVBQU1rYixFQUFVLFNBQVMsV0FDL0JHLEVBQWNwYixLQUFLRCxFQUFNMEQsR0FBQUEsRUFBTSxJQUdqQyxJQUFNb1ksRUFBT3hXLEdBQWMsT0FBUSxLQUFNc08sR0FBS3RRLElBQUlJLEVBQU0xRCxFQUFLb0IsU0FFdkR2RCxFQUFReUgsR0FBYyxPQUFRLENBQ2xDMEUsTUFBT2hLLEVBQUtvQixPQUFPZ0ssV0FBV3FPLEtBQUs1YixRQUlyQ0EsRUFBTTRWLFVBQVlxQyxFQUFLcFMsR0FFdkJvWSxFQUFLMVQsWUFBWXZLLEdBQ2pCcWQsRUFBUzlTLFlBQVkwVCxHQUNyQnJDLEVBQUtyUixZQUFZOFMsR0FHakIsSUFBTXVELEVBQU9uWixHQUFjLE1BQU8sQ0FDaEMyRSxHQUFJLGlCQUFKQSxPQUFxQjZMLEVBQUs3TCxHQUExQkEsS0FBQUEsT0FBZ0N2RyxHQUNoQ3VDLE9BQVEsS0FJSnFiLEVBQWFoYyxHQUFjLFNBQVUsQ0FDekM1QixLQUFNLFNBQ05zRyxNQUFPLEdBQVBBLE9BQVVoSyxFQUFLb0IsT0FBT2dLLFdBQVcrTyxRQUFqQ25RLEtBQUFBLE9BQTRDaEssRUFBS29CLE9BQU9nSyxXQUFXK08sUUFBbkVuUSxZQUlGc1gsRUFBV2xaLFlBQ1Q5QyxHQUNFLE9BQ0EsQ0FDaUIsa0JBRWpCc08sR0FBS3RRLElBQUlJLEVBQU0xRCxFQUFLb0IsVUFLeEJrZ0IsRUFBV2xaLFlBQ1Q5QyxHQUNFLE9BQ0EsQ0FDRTBFLE1BQU9oSyxFQUFLb0IsT0FBT2dLLFdBQVduRixRQUVoQzJOLEdBQUt0USxJQUFJLFdBQVl0RCxFQUFLb0IsVUFLOUJ3TSxHQUFHM04sS0FDREQsRUFDQXllLEVBQ0EsV0FDQzVZLFNBQUFBLEdBQ21CLGNBQWRBLEVBQU1qSSxNQUdWaUksRUFBTXhDLGlCQUNOd0MsRUFBTXNWLGtCQUdORSxFQUFjcGIsS0FBS0QsRUFBTSxXQUFRLE9BTXJDNE4sR0FBRzNOLEtBQUtELEVBQU1zaEIsRUFBWSxTQUFTLFdBQ2pDakcsRUFBY3BiLEtBQUtELEVBQU0sVUFBUSxJQUluQ3llLEVBQUtyVyxZQUFZa1osR0FHakI3QyxFQUFLclcsWUFDSDlDLEdBQWMsTUFBTyxDQUNuQm1WLEtBQU0sVUFJVjJHLEVBQU1oWixZQUFZcVcsR0FFYmhYLEVBQUFBLFNBQVNxUSxTQUFTTixRQUFROVQsR0FBUXdYLEVBQ2xDelQsRUFBQUEsU0FBU3FRLFNBQVM0RyxPQUFPaGIsR0FBUSthLENBQUFBLElBR3hDcUIsRUFBTTFYLFlBQVlnWixHQUNsQjFaLEVBQVFVLFlBQVkwWCxHQUNwQmhWLEVBQVUxQyxZQUFZVixHQUV0QjFILEVBQUt5SCxTQUFTcVEsU0FBU2dJLE1BQVFBLEVBQy9COWYsRUFBS3lILFNBQVNxUSxTQUFTMkIsS0FBTy9SLENBYzVCeVMsQ0FBQUEsR0FWWSxRQUFaQSxHQUFxQjdPLEdBQVFVLEtBQy9CbEIsRUFBVTFDLFlBQVlzUixFQUFhelosS0FBS0QsRUFBTSxNQUFPa2hCLElBSXZDLFlBQVovRyxHQUF5QjdPLEdBQVFjLFNBQ25DdEIsRUFBVTFDLFlBQVlzUixFQUFhelosS0FBS0QsRUFBTSxVQUFXa2hCLElBSTNDLGFBQVovRyxFQUF3QixDQUMxQixJQUFNNVIsRUFBYXBCLEVBQU8sQ0FBQyxFQUFHK1osRUFBbUIsQ0FDL0NqZ0IsUUFBUyxJQUNUc2dCLEtBQU12aEIsRUFBS2doQixTQUNYamYsT0FBUSxXQUlOL0IsRUFBS3dNLFVBQ1BqRSxFQUFXeVksU0FBVyxJQUdsQixJQUFFQSxFQUFhaGhCLEVBQUtvQixPQUFPb2dCLEtBQTNCLFVBRUQ5Z0IsRUFBT3NnQixJQUFhaGhCLEVBQUt5aEIsU0FDNUJ0YSxFQUFPb0IsRUFBWSxDQUNqQndRLEtBQU0sUUFBTkEsT0FBYy9ZLEVBQUswTCxVQUNuQnFPLE1BQU8vWixFQUFLMEwsV0FJaEJaLEVBQVUxQyxZQUFZc1IsRUFBYXpaLEtBQUtELEVBQU0sV0FBWXVJLEdBSTVDLGdCQUFaNFIsR0FDRnJQLEVBQVUxQyxZQUFZc1IsRUFBYXpaLEtBQUtELEVBQU0sYUFBY2toQixHQUFBQSxJQUs1RGxoQixLQUFLd00sU0FDUHFTLEVBQWU1ZSxLQUFLRCxLQUFNMlIsR0FBTUUsa0JBQWtCNVIsS0FBS0QsT0FHekQwZixFQUFhemYsS0FBS0QsTUFFWDhLLENBQUFBLEVBSVQ0VyxTQUFBQSxJQUFBQSxFQUFBQSxLQUVFLEdBQUkxaEIsS0FBS29CLE9BQU9vVSxXQUFZLENBQ3BCdUQsSUFBQUEsRUFBT2pDLEdBQVNDLFdBQVc5VyxLQUFLRCxNQUdsQytZLEVBQUszQixNQUNQNUIsR0FBV3VELEVBQUtuRSxJQUFLLGNBS3pCNVUsQ0FBQUEsS0FBS2lLLEdBQUtsSCxLQUFLNGUsTUFBc0IsSUFBaEI1ZSxLQUFLNmUsVUFHdEI5VyxJQUFBQSxFQUFZLEtBQ2hCOUssS0FBS3lILFNBQVNxUCxTQUFXLEtBR3pCLElBcURJL1UsRUFyREUrWCxFQUFRLENBQ1o3UCxHQUFJakssS0FBS2lLLEdBQ1Q0WCxTQUFVN2hCLEtBQUtvQixPQUFPeVMsU0FDdEJDLE1BQU85VCxLQUFLb0IsT0FBTzBTLE9BRWpCK0IsR0FBQUEsRUFzRUEsR0FuRUFuVixFQUFZVixLQUFLb0IsT0FBTzBWLFlBQzFCOVcsS0FBS29CLE9BQU8wVixTQUFXOVcsS0FBS29CLE9BQU8wVixTQUFTN1csS0FBS0QsS0FBTThaLElBSXBEOVosS0FBS29CLE9BQU8wVixXQUNmOVcsS0FBS29CLE9BQU8wVixTQUFXLElBR3JCcFcsRUFBV1YsS0FBS29CLE9BQU8wVixXQUFhcFcsRUFBVVYsS0FBS29CLE9BQU8wVixVQUU1RGhNLEVBQVk5SyxLQUFLb0IsT0FBTzBWLFVBR3hCaE0sRUFBWWdNLEdBQVNtSyxPQUFPaGhCLEtBQUtELEtBQU0sQ0FDckNpSyxHQUFJakssS0FBS2lLLEdBQ1Q0WCxTQUFVN2hCLEtBQUtvQixPQUFPeVMsU0FDdEIzQixNQUFPbFMsS0FBS2tTLE1BQ1pKLFFBQVM5UixLQUFLOFIsUUFDZGlHLFNBQVVBLEdBQVM2RyxTQUFTM2UsS0FBS0QsUUFJbkM2VixHQUFBQSxHQWVFQSxHQUNFblYsRUFBVVYsS0FBS29CLE9BQU8wVixZQUN4QmhNLEVBYmEzRyxTQUFBQSxHQUNYZ1MsSUFBQUEsRUFBU2hTLEVBTWIsT0FKQXJHLE9BQU8wSyxRQUFRc1IsR0FBTzNhLFNBQVEsWUFBT3RCLElBQUFBLEVBQUFBLEVBQUFBLEVBQUFBLEdBQUxELEVBQUtDLEVBQUFBLEdBQUFBLEVBQUFBLEVBQUFBLEdBQ25Dc1ksRUFBU2pELEdBQVdpRCxFQUFYakQsSUFBQUEsT0FBdUJ0VixFQUF2QnNWLEtBQStCclYsRUFBQUEsSUFHbkNzWSxDQUFBQSxDQVBRaFMsQ0FhTzJHLElBUXBCcEssRUFBVVYsS0FBS29CLE9BQU9tVyxVQUFVVCxTQUFTaE0sYUFDM0MvSSxFQUFTbEMsU0FBU3FCLGNBQWNsQixLQUFLb0IsT0FBT21XLFVBQVVULFNBQVNoTSxZQUk1RHBLLEVBQVdxQixLQUNkQSxFQUFTL0IsS0FBS3lILFNBQVNxRCxXQUt6Qi9JLEVBRHFCckIsRUFBV29LLEdBQWEsd0JBQTBCLHNCQUNsRCxhQUFjQSxHQUc5QnBLLEVBQVdWLEtBQUt5SCxTQUFTcVAsV0FDNUJBLEdBQVNRLGFBQWFyWCxLQUFLRCxPQUl4QlUsRUFBU1YsS0FBS3lILFNBQVMrUCxTQUFVLENBQzlCc0ssSUFBQUEsRUFBZTFILFNBQUFBLEdBQ25CLElBQU14USxFQUFZNUosRUFBS29CLE9BQU9nSyxXQUFXMlcsZUFDekNqa0IsT0FBT0MsZUFBZXFjLEVBQVEsVUFBVyxDQUN2Q3BjLFlBQVksRUFDWnNGLElBQUcsa0JBQ01tSCxHQUFTMlAsRUFBUXhRLEVBRHZCLEVBR0g5SCxNQUNFc0ksR0FBWWdRLEVBQVF4USxFQURSLHdEQUNtQjJTLEdBQUFBLEVBTXJDemUsT0FBTytoQixPQUFPN2YsS0FBS3lILFNBQVMrUCxTQUN6QjNZLE9BQU91RixTQUNQakYsU0FBU2liLFNBQUFBLEdBQ0oxWixFQUFTMFosSUFBVzFaLEVBQVkwWixHQUNsQ3phLE1BQU1DLEtBQUt3YSxHQUFRdmIsT0FBT3VGLFNBQVNqRixRQUFRMmlCLEdBRTNDQSxFQUFZMUgsRUFBQUEsR0FXcEIsSUFMSWpVLEVBQVFHLFFBQ1ZSLEVBQVEvRCxHQUlOL0IsS0FBS29CLE9BQU84YixTQUFTcEcsU0FBVSxDQUMzQixNQUE0QjlXLEtBQUtvQixPQUEvQmdLLEVBQUYsYUFBY21NLEVBQWQsWUFDQTdOLEVBREEsVUFDYzZOLEVBQVVULFNBQVNwUCxRQURqQyxZQUM0QzZQLEVBQVV5SyxPQUR0RCxhQUNpRTVXLEVBQVduRixRQUM1RStiLEVBQVNuWCxHQUFZNUssS0FBS0QsS0FBTTBKLEdBRXRDL0osTUFBTUMsS0FBS29pQixHQUFRN2lCLFNBQVM0YSxTQUFBQSxHQUMxQjNQLEdBQVkyUCxFQUFPL1osRUFBS29CLE9BQU9nSyxXQUFXbkYsUUFBQUEsR0FDMUNtRSxHQUFZMlAsRUFBTy9aLEVBQUtvQixPQUFPZ0ssV0FBV29OLFNBQUFBLEVBQVMsTUFNekR5SixtQkFDTSxJQUNFLGlCQUFrQjFrQixZQUNwQkEsVUFBVTJrQixhQUFhQyxTQUFXLElBQUlwZCxPQUFPcWQsY0FBYyxDQUN6RHRPLE1BQU85VCxLQUFLb0IsT0FBT2loQixjQUFjdk8sTUFDakN3TyxPQUFRdGlCLEtBQUtvQixPQUFPaWhCLGNBQWNDLE9BQ2xDQyxNQUFPdmlCLEtBQUtvQixPQUFPaWhCLGNBQWNFLE1BQ2pDQyxRQUFTeGlCLEtBQUtvQixPQUFPaWhCLGNBQWNHLFVBR2hDcGQsQ0FBUCxNQUFPQSxHQUFBQSxDQUFBQSxFQU1YaVosYUFBQUEsSUFBYSxJQUFiQSxFQUFBQSxLQUNNLEdBQUNyZSxLQUFLc1ksV0FBWXRZLEtBQUt5SCxTQUFTaVcsUUFBaEMsQ0FHSixJQUFNRSxFQUFTLFFBQUg2RSxFQUFHemlCLEtBQUtvQixPQUFPc2MsZUFBQUEsSUFBWitFLEdBQUgsUUFBR0MsRUFBQUEsRUFBcUI5RSxjQUFBQSxJQUF4QjhFLE9BQUFBLEVBQUdya0IsRUFBNkJRLFFBQU8sZ0JBQUcyWCxFQUFILEVBQUdBLEtBQUgsT0FBY0EsRUFBTyxHQUFLQSxFQUFPeFcsRUFBS3NZLFFBQXRDLElBQy9DLEdBQUNzRixNQUFBQSxHQUFBQSxFQUFRcmYsT0FBVCxDQUVKLElBQU1va0IsRUFBb0I5aUIsU0FBUytpQix5QkFDN0JDLEVBQWlCaGpCLFNBQVMraUIseUJBQzVCekYsRUFBYSxLQUNYMkYsRUFBQUEsR0FBQUEsT0FBZ0I5aUIsS0FBS29CLE9BQU9nSyxXQUFXb04sUUFBdkNzSyxhQUNBQyxFQUFhMUYsU0FBQUEsR0FBQUEsT0FBU2pULEdBQVkrUyxFQUFZMkYsRUFBWXpGLEVBQTdDQSxFQUduQk8sRUFBT3plLFNBQVNxZSxTQUFBQSxHQUNkLElBQU13RixFQUFnQjFkLEdBQ3BCLE9BQ0EsQ0FDRTBFLE1BQU9oSyxFQUFLb0IsT0FBT2dLLFdBQVc2WCxRQUVoQyxJQUdJcmdCLEVBQVc0YSxFQUFNaEgsS0FBT3hXLEVBQUtzWSxTQUFZLElBQWpDLElBRVY2RSxJQUVGNkYsRUFBYzVWLGlCQUFpQixjQUFjLFdBQ3ZDb1EsRUFBTXpELFFBQ1ZvRCxFQUFXMWIsTUFBTW1CLEtBQU9BLEVBQ3hCdWEsRUFBVzFKLFVBQVkrSixFQUFNekQsTUFDN0JnSixHQUFBQSxHQUFVLElBSVpDLEVBQWM1VixpQkFBaUIsY0FBYyxXQUMzQzJWLEdBQUFBLEVBQVUsS0FJZEMsRUFBYzVWLGlCQUFpQixTQUFTLFdBQ3RDcE4sRUFBS29TLFlBQWNvTCxFQUFNaEgsSUFBQUEsSUFHM0J3TSxFQUFjdmhCLE1BQU1tQixLQUFPQSxFQUMzQmlnQixFQUFlemEsWUFBWTRhLEVBQUFBLElBRzdCTCxFQUFrQnZhLFlBQVl5YSxHQUd6QjdpQixLQUFLb0IsT0FBTzhiLFNBQVNoRixPQUN4QmlGLEVBQWE3WCxHQUNYLE9BQ0EsQ0FDRTBFLE1BQU9oSyxLQUFLb0IsT0FBT2dLLFdBQVdvTixTQUVoQyxJQUdGbUssRUFBa0J2YSxZQUFZK1UsSUFHM0IxVixLQUFBQSxTQUFTaVcsUUFBVSxDQUN0QkUsT0FBUWlGLEVBQ1JLLElBQUsvRixHQUdQbmQsS0FBS3lILFNBQVN1USxTQUFTNVAsWUFBWXVhLEVBL0RSLENBSndCLENBbUVoQkEsR0N4eURoQyxTQUFTUSxHQUFTaGYsR0FBYyxJQUNqQ3lRLEVBQU16USxFQUVWLEtBSHFDLHlEQUczQixDQUNSLElBQU1pZixFQUFTdmpCLFNBQVN5RixjQUFjLEtBQ3RDOGQsRUFBTzdCLEtBQU8zTSxFQUNkQSxFQUFNd08sRUFBTzdCLElBR1gsS0FDRixPQUFPLElBQUl2YyxJQUFJNFAsRUFFUixDQURQLE1BQU94UCxHQUNQLE9BQU8sS0FLSixVQUFTaWUsR0FBZWxmLEdBQzdCLElBQU1tZixFQUFTLElBQUlDLGdCQVFuQixPQU5JN2lCLEVBQVV5RCxJQUNackcsT0FBTzBLLFFBQVFyRSxHQUFPaEYsU0FBUSxZQUFPdEIsSUFBQUEsRUFBQUEsRUFBQUEsRUFBQUEsR0FBTEQsRUFBS0MsRUFBQUEsR0FBQUEsRUFBQUEsRUFBQUEsR0FDbkN5bEIsRUFBT3hoQixJQUFJbEUsRUFBS0MsRUFBQUEsSUFJYnlsQixDQ2JULEtBQU12TCxHQUFXLENBRWYvRixRQUVFLEdBQUtoUyxLQUFLa04sVUFBVXBCLEdBS3BCLElBQUs5TCxLQUFLd1EsU0FBV3hRLEtBQUt3akIsV0FBY3hqQixLQUFLd00sVUFBWWxCLEdBQVFxQixXQUc3RGpNLEVBQVNWLEtBQUtvQixPQUFPMFYsV0FDckI5VyxLQUFLb0IsT0FBTzBWLFNBQVMvVyxTQUFTLGFBQzlCQyxLQUFLb0IsT0FBTzBXLFNBQVMvWCxTQUFTLGFBRTlCK1csR0FBU3FJLGdCQUFnQmxmLEtBQUtELFVBUGxDLENmcUNHLElBQXFCaUIsRUFBU2MsRWVmakMsR0FSS3JCLEVBQVdWLEtBQUt5SCxTQUFTc1EsWUFDNUIvWCxLQUFLeUgsU0FBU3NRLFNBQVd6UyxHQUFjLE1BQU9nRSxHQUEwQnRKLEtBQUtvQixPQUFPbVcsVUFBVVEsV2ZzQnhFOVcsRWVwQlZqQixLQUFLeUgsU0FBU3NRLFNmb0JLaFcsRWVwQksvQixLQUFLeUgsU0FBU0MsUWZxQmpEaEgsRUFBV08sSUFBYVAsRUFBV3FCLElBSXhDQSxFQUFPa0csV0FBV0ksYUFBYXBILEVBQVNjLEVBQU9vRyxjZXBCekNoQyxFQUFRQyxNQUFRckIsT0FBT0MsSUFBSyxDQUN4QnlDLElBQUFBLEVBQVd6SCxLQUFLeU0sTUFBTTNNLGlCQUFpQixTQUU3Q0gsTUFBTUMsS0FBSzZILEdBQVV0SSxTQUFTbWdCLFNBQUFBLEdBQzVCLElBQU03TSxFQUFNNk0sRUFBTWxkLGFBQWEsT0FDekJ3UyxFQUFNdU8sR0FBUzFRLEdBR1gsT0FBUm1DLEdBQ0FBLEVBQUl6UCxXQUFhSixPQUFPa1MsU0FBU3NLLEtBQUtwYyxVQUN0QyxDQUFDLFFBQVMsVUFBVXBGLFNBQVM2VSxFQUFJNk8sV0FFakM5TyxHQUFNbEMsRUFBSyxRQUNSL0QsTUFBTWdWLFNBQUFBLEdBQ0xwRSxFQUFNN1csYUFBYSxNQUFPMUQsT0FBT0MsSUFBSTJlLGdCQUFnQkQsR0FBQUEsSUFFdER0TixPQUFNLFdBQ0x2TixHQUFjeVcsRUFBQUEsR0FBQUEsR0FheEIsS0FDTXNFLEVBQVloVixJQURPclIsVUFBVXFtQixXQUFhLENBQUNybUIsVUFBVWlpQixVQUFZamlCLFVBQVVzbUIsY0FBZ0IsT0FDdkQ1ZixLQUFLdWIsU0FBQUEsR0FBQUEsT0FBYUEsRUFBU3ZZLE1BQU0sS0FBSyxFQUFqQ3VZLEtBQzNDQSxHQUFZeGYsS0FBS3VVLFFBQVFqUixJQUFJLGFBQWV0RCxLQUFLb0IsT0FBTzJXLFNBQVN5SCxVQUFZLFFBQVFqTSxjQUd4RSxTQUFiaU0sSUFDREEsRUFEYyxFQUNGb0UsRUFERSxPQUlieFMsSUFBQUEsRUFBU3BSLEtBQUt1VSxRQUFRalIsSUFBSSxZQWExQixHQVpDNUMsRUFBVzBRLEtBQ1hBLEVBQVdwUixLQUFLb0IsT0FBTzJXLFNBQXZCM0csUUFHTHRULE9BQU95SixPQUFPdkgsS0FBSytYLFNBQVUsQ0FDM0J3SCxTQUFTLEVBQ1RuTyxPQUFBQSxFQUNBb08sU0FBQUEsRUFDQW9FLFVBQUFBLElBSUU1akIsS0FBS3dNLFFBQVMsQ0FDVnNYLElBQUFBLEVBQWM5akIsS0FBS29CLE9BQU8yVyxTQUFTbEMsT0FBUyx1QkFBeUIsY0FDM0VqSSxHQUFHM04sS0FBS0QsS0FBTUEsS0FBS3lNLE1BQU1FLFdBQVltWCxFQUFhL0wsR0FBU2xDLE9BQU9vRyxLQUFLamMsTUFJekVnRyxDQUFBQSxXQUFXK1IsR0FBU2xDLE9BQU9vRyxLQUFLamMsTUFBTyxFQXRFckMsQ0FzRXFDLEVBSXpDNlYsU0FBQUEsSUFBQUEsRUFBQUEsS0FDUXVKLEVBQVNySCxHQUFTc0gsVUFBVXBmLEtBQUtELE1BQUFBLEdBQWpDb2YsRUFFK0NwZixLQUFLK1gsU0FBbEQzRyxFQUZGZ08sRUFFQWhPLE9BQVVvTyxFQUZWSixFQUVBSSxTQUFvQnVFLEVBRnBCM0UsRUFFQTJFLEtBQTBCQyxFQUYxQjVFLEVBRUE0RSxpQkFDQUMsRUFBaUI3ZixRQUFRZ2IsRUFBT3haLE1BQU0wWixTQUFBQSxHQUFBQSxPQUFVQSxFQUFNRSxXQUFhQSxDQUE3QkYsS0FHeEN0ZixLQUFLd00sU0FBV3hNLEtBQUt3USxTQUN2QjRPLEVBQ0d2Z0IsUUFBUXlnQixTQUFBQSxHQUFBQSxPQUFXeUUsRUFBS3pnQixJQUFJZ2MsRUFBcEJBLElBQ1JuZ0IsU0FBU21nQixTQUFBQSxHQUNIeE0sRUFBQUEsTUFBTUMsSUFBSSxjQUFldU0sR0FHOUJ5RSxFQUFLamlCLElBQUl3ZCxFQUFPLENBQ2RYLFFBQXdCLFlBQWZXLEVBQU00RSxPQU9FLFlBQWY1RSxFQUFNNEUsT0FFUjVFLEVBQU00RSxLQUFPLFVBSWZ0VyxHQUFHM04sS0FBS0QsRUFBTXNmLEVBQU8sYUFBYSxrQkFBTXZILEdBQVNvTSxXQUFXbGtCLEtBQUtELEVBQS9CLEdBQStCQSxLQUtsRWlrQixHQUFrQmprQixLQUFLd2YsV0FBYUEsSUFBY0osRUFBT3JmLFNBQVNpa0IsTUFDckVqTSxHQUFTcU0sWUFBWW5rQixLQUFLRCxLQUFNd2YsR0FDaEN6SCxHQUFTdkssT0FBT3ZOLEtBQUtELEtBQU1vUixHQUFVNlMsSUFJbkNqa0IsS0FBS3lILFVBQ1AyQyxHQUFZcEssS0FBS3lILFNBQVNxRCxVQUFXOUssS0FBS29CLE9BQU9nSyxXQUFXMk0sU0FBU3ZXLFNBQVVkLEVBQVMwZSxJQUt4RjFlLEVBQVNWLEtBQUtvQixPQUFPMFYsV0FDckI5VyxLQUFLb0IsT0FBTzBWLFNBQVMvVyxTQUFTLGFBQzlCQyxLQUFLb0IsT0FBTzBXLFNBQVMvWCxTQUFTLGFBRTlCK1csR0FBU3FJLGdCQUFnQmxmLEtBQUtELEtBQUFBLEVBTWxDd04sT0FBT3JKLEdBQWlCLFdBQVZzSixJQUFVLHlEQUV0QixHQUFLek4sS0FBS2tOLFVBQVVwQixHQUFwQixDQUlNLElBQUV5VCxFQUFZdmYsS0FBSytYLFNBQW5CLFFBQ0FzTSxFQUFjcmtCLEtBQUtvQixPQUFPZ0ssV0FBVzJNLFNBQVMzRyxPQUc5Q0EsRUFBUzFRLEVBQW1CeUQsSUFBVW9iLEVBQVVwYixFQUdsRGlOLEdBQUFBLElBQVdtTyxFQUFTLENBUWxCLEdBTkM5UixJQUNIek4sS0FBSytYLFNBQVMzRyxPQUFTQSxFQUNsQm1ELEtBQUFBLFFBQVF6UyxJQUFJLENBQUVpVyxTQUFVM0csTUFJMUJwUixLQUFLd2YsVUFBWXBPLElBQVczRCxFQUFTLENBQ2xDMlIsSUFBQUEsRUFBU3JILEdBQVNzSCxVQUFVcGYsS0FBS0QsTUFDakNzZixFQUFRdkgsR0FBU3VNLFVBQVVya0IsS0FBS0QsS0FBeEIrWCxDQUErQi9YLEtBQUsrWCxTQUFTeUgsVUFBN0N6SCxPQUFBQSxFQUEwRC9YLEtBQUsrWCxTQUFTNkwsYUFBQUEsR0FPdEYsT0FKSzdMLEtBQUFBLFNBQVN5SCxTQUFXRixFQUFNRSxjQUcvQnpILEdBQVNqVyxJQUFJN0IsS0FBS0QsS0FBTW9mLEVBQU90USxRQUFRd1EsR0FLckN0ZixDQUFBQSxLQUFLeUgsU0FBUytQLFFBQVFPLFdBQ25CdFEsS0FBQUEsU0FBUytQLFFBQVFPLFNBQVN3RSxRQUFVbkwsR0FJM0NoSCxHQUFZcEssS0FBS3lILFNBQVNxRCxVQUFXdVosRUFBYWpULEdBRWxEcFIsS0FBSytYLFNBQVN3SCxRQUFVbk8sRUFHeEIwRixHQUFTMEgsY0FBY3ZlLEtBQUtELEtBQU0sWUFHbENpTyxHQUFhaE8sS0FBS0QsS0FBTUEsS0FBS3lNLE1BQU8yRSxFQUFTLGtCQUFvQixtQkFLbkVwTCxDQUFBQSxZQUFXLFdBQ0xvTCxHQUFVcFIsRUFBSytYLFNBQVN3SCxVQUMxQnZmLEVBQUsrWCxTQUFTaU0saUJBQWlCRSxLQUFPLFlBbkRsQyxDQW1Ea0MsRUFPNUNwaUIsSUFBSStGLEdBQWlCLElBQVY0RixJQUFVLHlEQUNiMlIsRUFBU3JILEdBQVNzSCxVQUFVcGYsS0FBS0QsTUFHdkMsSUFBZSxJQUFYNkgsRUFLSixHQUFLbkgsRUFBVW1ILEdBS2YsR0FBTUEsS0FBU3VYLEVBQWYsQ0FLQSxHQUFJcGYsS0FBSytYLFNBQVNtRSxlQUFpQnJVLEVBQU8sQ0FDeEM3SCxLQUFLK1gsU0FBU21FLGFBQWVyVSxFQUN2QnlYLElBQUFBLEVBQVFGLEVBQU92WCxHQUNiMlgsR0FBYUYsR0FBUyxDQUFDLEdBQXpCRSxTQUdOeGYsS0FBSytYLFNBQVNpTSxpQkFBbUIxRSxFQUdqQ3hJLEdBQVMwSCxjQUFjdmUsS0FBS0QsS0FBTSxZQUc3QnlOLElBQ0h6TixLQUFLK1gsU0FBU3lILFNBQVdBLEVBQ3BCakwsS0FBQUEsUUFBUXpTLElBQUksQ0FBRTBkLFNBQUFBLEtBSWpCeGYsS0FBSzRRLFNBQ1A1USxLQUFLc1EsTUFBTWlVLGdCQUFnQi9FLEdBSTdCdlIsR0FBYWhPLEtBQUtELEtBQU1BLEtBQUt5TSxNQUFPLGlCQUl0Q3NMLENBQUFBLEdBQVN2SyxPQUFPdk4sS0FBS0QsTUFBQUEsRUFBWXlOLEdBRTdCek4sS0FBS3dNLFNBQVd4TSxLQUFLd1EsU0FFdkJ1SCxHQUFTb00sV0FBV2xrQixLQUFLRCxLQUFBQSxNQW5DekJBLEtBQUs4UyxNQUFNMkYsS0FBSyxrQkFBbUI1USxRQUxuQzdILEtBQUs4UyxNQUFNMkYsS0FBSywyQkFBNEI1USxRQUw1Q2tRLEdBQVN2SyxPQUFPdk4sS0FBS0QsTUFBQUEsRUFBYXlOLEVBQUFBLEVBbUR0QzJXLFlBQVlqZ0IsR0FBaUIsSUFBVnNKLElBQVUseURBQzNCLEdBQUsvTSxFQUFVeUQsR0FBZixDQUtBLElBQU1xYixFQUFXcmIsRUFBTW9QLGNBQ3ZCdlQsS0FBSytYLFNBQVN5SCxTQUFXQSxFQUduQkosSUFBQUEsRUFBU3JILEdBQVNzSCxVQUFVcGYsS0FBS0QsTUFDakNzZixFQUFRdkgsR0FBU3VNLFVBQVVya0IsS0FBS0QsS0FBTSxDQUFDd2YsSUFDN0N6SCxHQUFTalcsSUFBSTdCLEtBQUtELEtBQU1vZixFQUFPdFEsUUFBUXdRLEdBQVE3UixFQVQ3QyxNQURBek4sS0FBSzhTLE1BQU0yRixLQUFLLDRCQUE2QnRVLEVBVUFzSixFQU1qRDRSLFlBQW1CLFdBQVR4SixFQUFTLHdEQUtqQixPQUhlbFcsTUFBTUMsTUFBTUksS0FBS3lNLE9BQVMsQ0FBQyxHQUFHRSxZQUFjLElBSXhEOU4sUUFBUXlnQixTQUFBQSxHQUFBQSxPQUFXdGYsRUFBS3dNLFNBQVdxSixHQUFVN1YsRUFBSytYLFNBQVNnTSxLQUFLUyxJQUFJbEYsRUFBNURBLElBQ1J6Z0IsUUFBUXlnQixTQUFBQSxHQUFBQSxNQUFVLENBQUMsV0FBWSxhQUFhdmYsU0FBU3VmLEVBQU14YSxLQUFuRHdhLEdBQW1EeGEsRUFJaEV3ZixVQUFVVixHQUFtQixJQUl2QnRFLEVBSnVCLE9BQVJqVixFQUFRLHdEQUNyQitVLEVBQVNySCxHQUFTc0gsVUFBVXBmLEtBQUtELE1BQ2pDeWtCLEVBQWlCbkYsU0FBQUEsR0FBQUEsT0FBVTlhLFFBQVF4RSxFQUFLK1gsU0FBU2dNLEtBQUt6Z0IsSUFBSWdjLElBQVUsQ0FBQyxHQUFHWCxRQUF2RFcsRUFDakJvRixFQUFTL2tCLE1BQU1DLEtBQUt3ZixHQUFRSixNQUFLLFNBQUN2YyxFQUFHd2MsR0FBSixPQUFVd0YsRUFBY3hGLEdBQUt3RixFQUFjaGlCLEVBQTNDLElBU2hDNmMsT0FOUHNFLEVBQVVoVSxPQUFPNFAsU0FBQUEsR0FBQUEsT0FDZkYsRUFBUW9GLEVBQU85ZSxNQUFNdkgsU0FBQUEsR0FBQUEsT0FBTUEsRUFBRW1oQixXQUFhQSxDQUFyQm5oQixLQUNiaWhCLENBRk9FLElBTVZGLElBQVVqVixFQUFRcWEsRUFBTyxVQUFLQyxFQUl2Q0Msa0JBQ1M3TSxPQUFBQSxHQUFTc0gsVUFBVXBmLEtBQUtELE1BQU1BLEtBQUtrYyxhQUFBQSxFQUk1QzBDLFNBQVNVLEdBQ0hwRCxJQUFBQSxFQUFlb0QsRUFNbkIsT0FKSzVlLEVBQVN3YixJQUFpQjVRLEdBQVFxQixZQUFjM00sS0FBSytYLFNBQVN3SCxVQUNqRXJELEVBQWVuRSxHQUFTNk0sZ0JBQWdCM2tCLEtBQUtELE9BRzNDVSxFQUFTd2IsR0FDTnhiLEVBQVN3YixFQUFhbkMsT0FJdEJyWixFQUFTd2IsRUFBYXNELFVBSXBCNUwsR0FBS3RRLElBQUksVUFBV3RELEtBQUtvQixRQUh2QmtlLEVBQU1FLFNBQVNuTSxjQUpmNkksRUFBYW5DLE1BVWpCbkcsR0FBS3RRLElBQUksV0FBWXRELEtBQUtvQixPQUFBQSxFQUtuQytpQixXQUFXaGdCLEdBRVQsR0FBS25FLEtBQUtrTixVQUFVcEIsR0FJaEIsR0FBQ3BMLEVBQVdWLEtBQUt5SCxTQUFTc1EsVUFNOUIsR0FBS3JYLEVBQW1CeUQsSUFBV3hFLE1BQU1ZLFFBQVE0RCxHQUFqRCxDQUtBLElBQUkwZ0IsRUFBTzFnQixFQUdQLElBQUMwZ0IsRUFBTSxDQUNIdkYsSUFBQUEsRUFBUXZILEdBQVM2TSxnQkFBZ0Iza0IsS0FBS0QsTUFFNUM2a0IsRUFBT2xsQixNQUFNQyxNQUFNMGYsR0FBUyxDQUFDLEdBQUd3RixZQUFjLElBQzNDN2dCLEtBQUs4Z0IsU0FBQUEsR0FBQUEsT0FBUUEsRUFBSUMsY0FBWkQsSUFDTDlnQixJQUFJdVAsR0FJVCxLQUFNMEMsRUFBVTJPLEVBQUs1Z0IsS0FBS2doQixTQUFBQSxHQUFBQSxPQUFZQSxFQUFRdGIsTUFBcEJzYixJQUE0QjNMLEtBQUssTUFHM0QsR0FGZ0JwRCxJQUFZbFcsS0FBS3lILFNBQVNzUSxTQUFTdEUsVUFFdEMsQ0FFWDFLLEdBQWEvSSxLQUFLeUgsU0FBU3NRLFVBQzNCLElBQU1tTixFQUFVNWYsR0FBYyxPQUFRZ0UsR0FBMEJ0SixLQUFLb0IsT0FBT21XLFVBQVUyTixVQUN0RkEsRUFBUXpSLFVBQVl5QyxFQUNmek8sS0FBQUEsU0FBU3NRLFNBQVMzUCxZQUFZOGMsR0FHbkNqWCxHQUFhaE8sS0FBS0QsS0FBTUEsS0FBS3lNLE1BQU8sYUExQnBDLE1BREF6TSxLQUFLOFMsTUFBTTJGLEtBQUssNEJBQTZCdFUsUUFON0NuRSxLQUFLOFMsTUFBTTJGLEtBQUssbUNBaUNvQixHQy9ZcENuWixHQUFXLENBRWZrQyxTQUFTLEVBR1RzUyxNQUFPLEdBR1BoQixPQUFPLEVBR1BxUyxVQUFVLEVBR1ZDLFdBQVcsRUFJWHpaLGFBQWEsRUFHYmtJLFNBQVUsR0FHVnNFLE9BQVEsRUFDUm1FLE9BQU8sRUFHUGhFLFNBQVUsS0FJVjhGLGlCQUFpQixFQUdqQkosWUFBWSxFQUdacUgsY0FBYyxFQUlkdlYsTUFBTyxLQUdQd1YsYUFBYSxFQUdiQyxjQUFjLEVBR2RDLFlBQVksRUFHWkMsb0JBQW9CLEVBR3BCalEsWUFBWSxFQUNac0QsV0FBWSxPQUNaOUIsUUFBUyxxQ0FHVG5FLFdBQVksdUNBR1pmLFFBQVMsQ0FDUDZNLFFBQVMsSUFFVHhSLFFBQVMsQ0FBQyxLQUFNLEtBQU0sS0FBTSxLQUFNLEtBQU0sSUFBSyxJQUFLLElBQUssSUFBSyxLQUM1RDRFLFFBQVEsRUFDUkksU0FBVSxNQUladVQsS0FBTSxDQUNKdFUsUUFBUSxHQU1WYyxNQUFPLENBQ0x5VCxTQUFVLEVBRVZ4WSxRQUFTLENBQUMsR0FBSyxJQUFNLEVBQUcsS0FBTSxJQUFLLEtBQU0sRUFBRyxJQUk5Q3lZLFNBQVUsQ0FDUkMsU0FBUyxFQUNUQyxRQUFRLEdBSVY1SSxTQUFVLENBQ1JwRyxVQUFVLEVBQ1ZvQixNQUFNLEdBSVJILFNBQVUsQ0FDUjNHLFFBQVEsRUFDUm9PLFNBQVUsT0FHVjNKLFFBQVEsR0FJVjFFLFdBQVksQ0FDVjNQLFNBQVMsRUFDVHVrQixVQUFVLEVBQ1ZDLFdBQVcsR0FPYnpSLFFBQVMsQ0FDUC9TLFNBQVMsRUFDVDVELElBQUssUUFJUGtaLFNBQVUsQ0FDUixhQUdBLE9BSlEsV0FPUixlQVBRLE9BVVIsU0FDQSxXQUNBLFdBQ0EsTUFDQSxVQUVBLGNBRUZnQixTQUFVLENBQUMsV0FBWSxVQUFXLFNBR2xDbEUsS0FBTSxDQUNKOEQsUUFBUyxVQUNUQyxPQUFRLHFCQUNSakYsS0FBTSxPQUNOK0UsTUFBTyxRQUNQRyxZQUFhLHNCQUNiTSxLQUFNLE9BQ04rTixVQUFXLDhCQUNYcEwsT0FBUSxTQUNSaUMsU0FBVSxXQUNWMUssWUFBYSxlQUNia0csU0FBVSxXQUNWSCxPQUFRLFNBQ1JOLEtBQU0sT0FDTnFPLE9BQVEsU0FDUkMsZUFBZ0Isa0JBQ2hCQyxnQkFBaUIsbUJBQ2pCcEYsU0FBVSxXQUNWcUYsZ0JBQWlCLG1CQUNqQkMsZUFBZ0Isa0JBQ2hCQyxXQUFZLHFCQUNaeE8sU0FBVSxXQUNWRCxTQUFVLFdBQ1Y5TCxJQUFLLE1BQ0x3YSxTQUFVLDJCQUNWdFUsTUFBTyxRQUNQdVUsT0FBUSxTQUNSM1UsUUFBUyxVQUNUNFQsS0FBTSxPQUNOZ0IsTUFBTyxRQUNQQyxJQUFLLE1BQ0xDLElBQUssTUFDTEMsTUFBTyxRQUNQempCLFNBQVUsV0FDVjVCLFFBQVMsVUFDVHNsQixjQUFlLEtBQ2ZDLGFBQWMsQ0FDWixLQUFNLEtBQ04sS0FBTSxLQUNOLEtBQU0sS0FDTixJQUFLLEtBQ0wsSUFBSyxLQUNBLFdBS1R2RixLQUFNLENBQ0pSLFNBQVUsS0FDVm5RLE1BQU8sQ0FDTG1XLElBQUsseUNBQ0xDLE9BQVEseUNBQ1JwYixJQUFLLDZDQUVQOEgsUUFBUyxDQUNQcVQsSUFBSyxxQ0FDTG5iLElBQUsscUVBRVBxYixVQUFXLENBQ1RGLElBQUssdURBS1RubEIsVUFBVyxDQUNUcVcsS0FBTSxLQUNOeEYsS0FBTSxLQUNOK0UsTUFBTyxLQUNQQyxRQUFTLEtBQ1RDLE9BQVEsS0FDUkMsWUFBYSxLQUNiQyxLQUFNLEtBQ05NLE9BQVEsS0FDUkosU0FBVSxLQUNWaUosU0FBVSxLQUNWN1AsV0FBWSxLQUNabkYsSUFBSyxLQUNMSSxRQUFTLEtBQ1Q4RixNQUFPLEtBQ1BKLFFBQVMsS0FDVDRULEtBQU0sS0FDTmxHLFNBQVUsTUFJWmphLE9BQVEsQ0FHTixRQUNBLFdBQ0EsVUFDQSxVQUNBLFVBQ0EsVUFDQSxpQkFDQSxZQUNBLGFBQ0EsaUJBQ0EsYUFDQSxlQUNBLE9BQ0EsUUFDQSxRQUNBLFVBQ0EsU0FDQSxVQUNBLGFBQ0EsWUFHQSxXQUNBLGtCQUNBLGlCQUNBLGtCQUNBLG1CQUNBLGlCQUNBLGlCQUNBLGdCQUNBLFFBR0EsY0FHQSxnQkFHQSxZQUNBLGtCQUNBLG1CQUNBLFlBQ0EsY0FDQSxjQUNBLGlCQUNBLGdCQUNBLFlBS0ZnUyxVQUFXLENBQ1Q0UCxTQUFVLDZDQUNWcmMsVUFBVyxRQUNYZ00sU0FBVSxDQUNSaE0sVUFBVyxLQUNYcEQsUUFBUyxtQkFFWHNhLE9BQVEsY0FDUnhLLFFBQVMsQ0FDUDlFLEtBQU0scUJBQ04rRSxNQUFPLHNCQUNQQyxRQUFTLHdCQUNUQyxPQUFRLHVCQUNSQyxZQUFhLDZCQUNiQyxLQUFNLHFCQUNORSxTQUFVLHlCQUNWaUosU0FBVSx5QkFDVjdQLFdBQVksMkJBQ1puRixJQUFLLG9CQUNMSSxRQUFTLHdCQUNUMEwsU0FBVSx5QkFDVjROLEtBQU0sc0JBRVJ6TixPQUFRLENBQ05DLEtBQU0scUJBQ05DLE9BQVEsdUJBQ1JqRyxNQUFPLHNCQUNQc04sU0FBVSx5QkFDVjFOLFFBQVMseUJBRVhzRyxRQUFTLENBQ1BoRyxZQUFhLHVCQUNia0csU0FBVSx3QkFDVkQsT0FBUSwwQkFDUnFOLEtBQU0sd0JBQ052TixPQUFRLDBCQUVWSCxTQUFVLGtCQUNWRCxTQUFVLGtCQUNWbU4sUUFBUyxrQkFJWDlaLFdBQVksQ0FDVjFILEtBQU0sWUFDTmdJLFNBQVUsWUFDVkYsTUFBTyxzQkFDUDhFLE1BQU8sb0JBQ1BpQixnQkFBaUIsbUNBQ2pCNlYsZUFBZ0IsK0JBQ2hCQyxPQUFRLGVBQ1JDLGNBQWUsdUJBQ2ZDLElBQUssWUFDTHBOLFFBQVMsZ0JBQ1Q0SCxlQUFnQix5QkFDaEJ5RixRQUFTLGdCQUNUblYsT0FBUSxlQUNSb1YsUUFBUyxnQkFDVEMsUUFBUyxnQkFDVEMsTUFBTyxjQUNQblAsUUFBUyxnQkFDVHFNLEtBQU0sYUFDTjVCLE9BQVEseUJBQ1JoZCxPQUFRLGdCQUNSc2YsYUFBYyxzQkFDZDNlLE1BQU8sZUFDUGdoQixRQUFTLGlCQUNUQyxZQUFhLGdCQUNiQyxhQUFjLHNCQUNkMVAsUUFBUyxDQUNQNUIsS0FBTSxjQUVSaUQsS0FBTSxDQUNKNWIsTUFBTyxvQkFDUDJiLE1BQU8sY0FDUG5FLEtBQU0sbUJBRVIwQyxTQUFVLENBQ1J2VyxRQUFTLHlCQUNUNFAsT0FBUSx5QkFFVkQsV0FBWSxDQUNWM1AsUUFBUywyQkFDVHVrQixTQUFVLDZCQUVaL1osSUFBSyxDQUNIa0IsVUFBVyxzQkFDWGtFLE9BQVEsb0JBRVZoRixRQUFTLENBQ1BjLFVBQVcsMEJBQ1hrRSxPQUFRLHdCQUVWbkcsU0FBVSxrQkFDVjhjLGtCQUFtQixDQUVqQkMsZUFBZ0Isc0JBQ2hCQyxvQkFBcUIsZ0NBQ3JCQyxlQUFnQix1Q0FDaEJDLGNBQWUsc0NBRWZDLG1CQUFvQiwwQkFDcEJDLHdCQUF5QixzQ0FLN0I5ZixXQUFZLENBQ1YrSCxNQUFPLENBQ0w1RSxTQUFVLHFCQUNWekIsR0FBSSxxQkFDSnFlLEtBQU0seUJBTVZmLElBQUssQ0FDSC9sQixTQUFTLEVBQ1QrbUIsWUFBYSxHQUNiQyxPQUFRLElBSVZULGtCQUFtQixDQUNqQnZtQixTQUFTLEVBQ1RpUixJQUFLLElBSVA1QixNQUFPLENBQ0w0WCxRQUFRLEVBQ1JDLFVBQVUsRUFDVjVVLE9BQU8sRUFDUDVCLE9BQU8sRUFDUHlXLGFBQWEsRUFFYkMsZ0JBQWdCLEVBQ2hCQyxlQUFnQixLQUdoQi9YLFNBQVMsR0FJWDZDLFFBQVMsQ0FDUG1WLElBQUssRUFDTEMsU0FBVSxFQUNWQyxlQUFnQixFQUNoQkMsZUFBZ0IsRUFFaEJMLGdCQUFnQixFQUNoQk0sVUFBVSxHQUlaN0csY0FBZSxDQUNidk8sTUFBTyxHQUNQd08sT0FBUSxHQUNSQyxNQUFPLEdBQ1BDLFFBQVMsSUFJWDlFLFFBQVMsQ0FDUGxjLFNBQVMsRUFDVG9jLE9BQVEsS0NwY0M1UixHQUNILHFCQ0RHbWQsR0FBWSxDQUN2QnhYLE1BQU8sUUFDUGdDLFFBQVMsVUFDVDlDLE1BQU8sU0FHSXVZLEdBRUosUUNSSEMsR0FBTyxhQUVRQyxHekJGWixXeUJHUG5wQixTQUFBQSxJQUFzQixJQUFWcUIsRUFBVSxrRUFDcEJ4QixLQUFLd0IsUUFBVXVELE9BQU93a0IsU0FBVy9uQixFQUU3QnhCLEtBQUt3QixTQUNGdVIsS0FBQUEsSUFBSSxvQkFJVEEsQ3pCWEcsMkJ5QldIQSxXQUVGLE9BQU8vUyxLQUFLd0IsUUFBVThDLFNBQVNoRCxVQUFVMmEsS0FBS2hjLEtBQUtzcEIsUUFBUXhXLElBQUt3VyxTQUFXRixFQUd6RTVRLEd6QmhCRyxnQnlCZ0JIQSxXQUVGLE9BQU96WSxLQUFLd0IsUUFBVThDLFNBQVNoRCxVQUFVMmEsS0FBS2hjLEtBQUtzcEIsUUFBUTlRLEtBQU04USxTQUFXRixFQUcxRTlULEd6QnJCRyxpQnlCcUJIQSxXQUVGLE9BQU92VixLQUFLd0IsUUFBVThDLFNBQVNoRCxVQUFVMmEsS0FBS2hjLEtBQUtzcEIsUUFBUWhVLE1BQU9nVSxTQUFXRixFQUFBQSxLekJ2QnhFLEswQlFIRyxHMUJSRyxXMEJTUHJwQixTQUFBQSxFQUFZOFIsR0FBQUEsSUFBQUEsRUFBQUEsS0FBQUEsRUFBQUEsS0FBQUEsR0FBUXhULEVBQUFBLEtBQUFBLFlBK0hULFdBQ0wsR0FBQ3VCLEVBQUt3QixRQUFOLENBS0U0WSxJQUFBQSxFQUFTcGEsRUFBS2lTLE9BQU94SyxTQUFTK1AsUUFBUXJHLFdBQ3hDelEsRUFBVzBaLEtBQ2JBLEVBQU9tQyxRQUFVdmMsRUFBS29SLFFBSWxCclAsSUFBQUEsRUFBUy9CLEVBQUsrQixTQUFXL0IsRUFBS2lTLE9BQU94RixNQUFRek0sRUFBSytCLE9BQVMvQixFQUFLaVMsT0FBT3hLLFNBQVNxRCxVQUV0Rm1ELEdBQWFoTyxLQUFLRCxFQUFLaVMsT0FBUWxRLEVBQVEvQixFQUFLb1IsT0FBUyxrQkFBb0Isb0JBWmpFLENBWW1GLElBN0l6RTNTLEVBQUFBLEtBQUFBLGtCQWdKSCxXQUFVLElBQVQrTyxFQUFTLHdEQWtCckJySCxHQWhCQXFILEVBQ0Z4TixFQUFLeXBCLGVBQWlCLENBQ3BCaGEsRUFBRzFLLE9BQU8ya0IsU0FBVyxFQUNyQmhhLEVBQUczSyxPQUFPNGtCLFNBQVcsR0FHdkI1a0IsT0FBTzZrQixTQUFTNXBCLEVBQUt5cEIsZUFBZWhhLEVBQUd6UCxFQUFLeXBCLGVBQWUvWixHQUk3RDdQLFNBQVNpRSxLQUFLckMsTUFBTW9vQixTQUFXcmMsRUFBUyxTQUFXLEdBR25EcEQsR0FBWXBLLEVBQUsrQixPQUFRL0IsRUFBS2lTLE9BQU83USxPQUFPZ0ssV0FBVytGLFdBQVc0VSxTQUFVdlksR0FHeEVySCxFQUFRUyxNQUFPLENBQ2JrakIsSUFBQUEsRUFBV2pxQixTQUFTa3FCLEtBQUs3b0IsY0FBYyx5QkFDckM4b0IsRUFBVyxxQkFHWkYsSUFDSEEsRUFBV2pxQixTQUFTeUYsY0FBYyxTQUN6Qm1ELGFBQWEsT0FBUSxZQUloQyxJQUFNd2hCLEVBQWN2cEIsRUFBVW9wQixFQUFTNVQsVUFBWTRULEVBQVM1VCxRQUFRblcsU0FBU2lxQixHQUV6RXhjLEdBQ0cwYyxFQUFBQSxpQkFBbUJELEVBRW5CQSxJQUNISCxFQUFTNVQsU0FBVDRULElBQUFBLE9BQXdCRSxLQUVqQmhxQixFQUFLa3FCLGtCQUNkSixFQUFTNVQsUUFBVTRULEVBQVM1VCxRQUN6QmpQLE1BQU0sS0FDTnBJLFFBQVFzckIsU0FBQUEsR0FBQUEsT0FBU0EsRUFBS3hnQixTQUFXcWdCLENBQXpCRyxJQUNSN1EsS0FBSyxLQUtadFosQ0FBQUEsRUFBS21TLFVBQUFBLElBOUxhMVQsRUFBQUEsS0FBQUEsYUFrTVBvSCxTQUFBQSxHQUVYLElBQUlNLEVBQVFTLE9BQVU1RyxFQUFLb1IsUUFBd0IsUUFBZHZMLEVBQU1qSSxJQUEzQyxDQUtNaW9CLElBQUFBLEVBQVVobUIsU0FBU3VxQixjQUNuQm5SLEVBQVlwTyxHQUFZNUssS0FBS0QsRUFBS2lTLE9BQVEsb0VBQ3pDb1ksRUFGRHhFLEVBRVU1TSxFQUZWNE0sR0FBQUEsR0FHQXlFLEVBQU9yUixFQUFVQSxFQUFVMWEsT0FBUyxHQUV0Q3NuQixJQUFZeUUsR0FBU3prQixFQUFNMGtCLFNBSXBCMUUsSUFBWXdFLEdBQVN4a0IsRUFBTTBrQixXQUVwQ0QsRUFBS3BmLFFBQ0xyRixFQUFNeEMsbUJBTE5nbkIsRUFBTW5mLFFBQ05yRixFQUFNeEMsaUJBWkEsQ0FZQUEsSUFqTlU1RSxFQUFBQSxLQUFBQSxVQTBOWCxXQUVMLElBQUl5bEIsRUFERixFQUFLMWlCLFNBSUwwaUIsRUFERWxrQixFQUFLd3FCLGNBQ0Esb0JBQ0VoQixFQUFXaUIsT0FDYixTQUVBLFdBR0p4WSxFQUFBQSxPQUFPYSxNQUFNQyxJQUFiZCxHQUFBQSxPQUFvQmlTLEVBQXBCalMseUJBRUxqUyxFQUFLaVMsT0FBT2EsTUFBTUMsSUFBSSxrREFJeEIzSSxHQUFZcEssRUFBS2lTLE9BQU94SyxTQUFTcUQsVUFBVzlLLEVBQUtpUyxPQUFPN1EsT0FBT2dLLFdBQVcrRixXQUFXM1AsUUFBU3hCLEVBQUt3QixRQUFBQSxJQTVPakYvQyxFQUFBQSxLQUFBQSxTQWdQWixXQUNEdUIsRUFBS3dCLFVBS04yRSxFQUFRUyxPQUFTNUcsRUFBS2lTLE9BQU83USxPQUFPK1AsV0FBVzZVLFVBQzdDaG1CLEVBQUtpUyxPQUFPckIsUUFDZDVRLEVBQUtpUyxPQUFPM0IsTUFBTW9hLG9CQUViM29CLEVBQUFBLE9BQU80b0IseUJBRUpuQixFQUFXaUIsUUFBVXpxQixFQUFLd3FCLGNBQy9CSSxFQUFBQSxnQkFBQUEsR0FDSzVxQixFQUFLeVYsT0FFTC9VLEVBQVNWLEVBQUt5VixTQUNuQjFULEVBQUFBLE9BQUFBLEdBQUFBLE9BQVUvQixFQUFLeVYsT0FBZjFULFdBQUFBLE9BQStCL0IsRUFBS2dxQixhQUZwQ2pvQixFQUFBQSxPQUFPMm9CLGtCQUFrQixDQUFFRyxhQUFjLGFBL1A5QnBzQixFQUFBQSxLQUFBQSxRQXNRYixXQUNELEdBQUN1QixFQUFLd0IsUUFLVixHQUFJMkUsRUFBUVMsT0FBUzVHLEVBQUtpUyxPQUFPN1EsT0FBTytQLFdBQVc2VSxVQUM1Q2prQixFQUFBQSxPQUFPK29CLHVCQUNabmMsR0FBZTNPLEVBQUtpUyxPQUFPUyxhQUN0QixJQUFLOFcsRUFBV2lCLFFBQVV6cUIsRUFBS3dxQixjQUMvQkksRUFBQUEsZ0JBQUFBLFFBQ0EsR0FBSzVxQixFQUFLeVYsUUFFVixJQUFLL1UsRUFBU1YsRUFBS3lWLFFBQVMsQ0FDM0JzVixJQUFBQSxFQUF5QixRQUFoQi9xQixFQUFLeVYsT0FBbUIsU0FBVyxPQUNsRDVWLFNBQVMsR0FBVEEsT0FBWUcsRUFBS3lWLFFBQWpCNVYsT0FBMEJrckIsR0FBMUJsckIsT0FBbUNHLEVBQUtncUIsWUFBQUEsT0FIdkNucUIsU0FBU21yQixrQkFBb0JuckIsU0FBU3ltQixnQkFBZ0JybUIsS0FBS0osU0FBQUEsSUFsUjVDcEIsRUFBQUEsS0FBQUEsVUEwUlgsV0FDRnVCLEVBQUtvUixPQUdScFIsRUFBS2lyQixPQUZManJCLEVBQUtrckIsT0FBQUEsSUExUlBsckIsS0FBS2lTLE9BQVNBLEVBR2RqUyxLQUFLeVYsT0FBUytULEVBQVcvVCxPQUN6QnpWLEtBQUtncUIsU0FBV1IsRUFBV1EsU0FHM0JocUIsS0FBS3lwQixlQUFpQixDQUFFaGEsRUFBRyxFQUFHQyxFQUFHLEdBR2pDMVAsS0FBS3dxQixjQUFzRCxVQUF0Q3ZZLEVBQU83USxPQUFPK1AsV0FBVzRVLFNBSTlDL2xCLEtBQUtpUyxPQUFPeEssU0FBUzBKLFdBQ25CYyxFQUFPN1EsT0FBTytQLFdBQVdyRyxXcEJrTnhCLFNBQWlCN0osRUFBU3lJLEdBZ0IvQixPQWZzQi9JLFFBQWhCLFVBYW1Cb08sU0FWekIsV0FDTW9jLElBQUFBLEVBQUtuckIsS0FFTixHQUNHTixHQUFBQSxHQUFRQSxRQUFReXJCLEVBQUl6aEIsR0FBVyxPQUFPeWhCLEVBQzFDQSxFQUFLQSxFQUFHQyxlQUFpQkQsRUFBR2xqQixVQUFBQSxPQUNkLE9BQVBrakIsR0FBK0IsSUFBaEJBLEVBQUd6bUIsVUFDM0IsT0FBTyxPQUtLekUsS0FBS2dCLEVBQVN5SSxFb0JsT2NxRixDcEJrTnJDLENvQmxONkMvTyxLQUFLaVMsT0FBT3hLLFNBQVNxRCxVQUFXbUgsRUFBTzdRLE9BQU8rUCxXQUFXckcsV0FJekc4QyxHQUFHM04sS0FDREQsS0FBS2lTLE9BQ0xwUyxTQUNnQixPQUFoQkcsS0FBS3lWLE9BQWtCLHFCQUFQLFVBQWlDelYsS0FBS3lWLE9BQXRDLHFCQUNoQixXQUVFelYsRUFBS21TLFVBQUFBLElBS1R2RSxHQUFHM04sS0FBS0QsS0FBS2lTLE9BQVFqUyxLQUFLaVMsT0FBT3hLLFNBQVNxRCxVQUFXLFlBQWFqRixTQUFBQSxHQUU1RG5GLEVBQVdWLEVBQUtpUyxPQUFPeEssU0FBU3FQLFdBQWE5VyxFQUFLaVMsT0FBT3hLLFNBQVNxUCxTQUFTdE0sU0FBUzNFLEVBQU05RCxTQUl6RmtRLEVBQUFBLE9BQU9wUSxVQUFVd3BCLE1BQU14bEIsRUFBTzdGLEVBQUt3TixPQUFRLGlCQUlsREksR0FBRzNOLEtBQUtELEtBQU1BLEtBQUtpUyxPQUFPeEssU0FBU3FELFVBQVcsV0FBWWpGLFNBQUFBLEdBQUFBLE9BQVU3RixFQUFLc3JCLFVBQVV6bEIsRUFBekJBLElBR3JEZ1EsS0FBQUEsUUFNSTRVLEMxQjVESixtQzBCc0VIYyxXQUNGLE9BQU8vQixFQUFXaUIsU0FBV3pxQixLQUFLd3FCLGFBSXpCL1UsRzFCM0VKLG1CMEJzR0hqVSxXQUNGLE9BQ0dnb0IsRUFBV2lCLFFBQVV6cUIsS0FBS2lTLE9BQU83USxPQUFPK1AsV0FBVzRVLFdBQ3BEL2xCLEtBQUtpUyxPQUFPN1EsT0FBTytQLFdBQVczUCxTQUM5QnhCLEtBQUtpUyxPQUFPL0UsVUFBVXBCLElBQ3RCOUwsS0FBS2lTLE9BQU96QixPQUtaWSxHMUJoSEcsa0IwQmdISEEsV0FDRSxJQUFDcFIsS0FBS3dCLFFBQ1IsT0FBTyxFQUlULElBQUtnb0IsRUFBV2lCLFFBQVV6cUIsS0FBS3dxQixjQUM3QixPQUFPL2YsR0FBU3pLLEtBQUsrQixPQUFRL0IsS0FBS2lTLE9BQU83USxPQUFPZ0ssV0FBVytGLFdBQVc0VSxVQUdsRTlrQixJQUFBQSxFQUFXakIsS0FBS3lWLE9BRWxCelYsS0FBSytCLE9BQU95cEIsY0FBWnhyQixHQUFBQSxPQUE2QkEsS0FBS3lWLFFBQWxDelYsT0FBMkNBLEtBQUtncUIsU0FBaERocUIsWUFEQUEsS0FBSytCLE9BQU95cEIsY0FBY0Msa0JBRzlCLE9BQU94cUIsR0FBV0EsRUFBUXlxQixXQUFhenFCLElBQVlqQixLQUFLK0IsT0FBT3lwQixjQUFjdFUsS0FBT2pXLElBQVlqQixLQUFLK0IsTUFJbkdBLEcxQmxJRyxrQjBCa0lIQSxXQUNGLE9BQU9vRSxFQUFRUyxPQUFTNUcsS0FBS2lTLE9BQU83USxPQUFPK1AsV0FBVzZVLFVBQ2xEaG1CLEtBQUtpUyxPQUFPeEYsTUFDWnpNLEtBQUtpUyxPQUFPeEssU0FBUzBKLFlBQWNuUixLQUFLaVMsT0FBT3hLLFNBQVNxRCxTQUFBQSxJMUJySXZELG1CMEI0REkyZixXQUNULFNBQ0U1cUIsU0FBUzhyQixtQkFDVDlyQixTQUFTK3JCLHlCQUNUL3JCLFNBQVNnc0Isc0JBQ1Roc0IsU0FBU2lzQixvQkFLVFAsRzFCdEVHLGtCMEIyRUk5VixXQUVML1UsR0FBQUEsRUFBWWIsU0FBU3ltQixnQkFDdkIsTUFBTyxHQUlMem9CLElBQUFBLEVBQVEsR0FZWixNQVhpQixDQUFDLFNBQVUsTUFBTyxNQUUxQnFjLE1BQU02UixTQUFBQSxHQUFBQSxTQUNUcnJCLEVBQVliLFNBQVMsR0FBVEEsT0FBWWtzQixFQUFabHNCLHNCQUFxQ2EsRUFBWWIsU0FBUyxHQUFUQSxPQUFZa3NCLEVBQVpsc0Isd0JBQy9EaEMsRUFBUWt1QixFQUFBQSxHQUZHQSxJQVNSbHVCLENBR0Vtc0IsRzFCakdKLG9CMEJpR0lBLFdBQ1QsTUFBdUIsUUFBaEJocUIsS0FBS3lWLE9BQW1CLGFBQWUsWUFJNUNqVSxLMUJ0R0csSzJCRU0sU0FBU3dxQixHQUFVdlosR0FBZ0IsSUFBWHdaLEVBQVcseURBQ2hELE9BQU8sSUFBSXpkLFNBQVEsU0FBQ0MsRUFBU3FHLEdBQzNCLElBQU1vWCxFQUFRLElBQUlDLE1BRVpDLEVBQVUsa0JBQ1BGLEVBQU1HLGNBQ05ILEVBQU1JLFNBQ1pKLEVBQU1LLGNBQWdCTixFQUFXeGQsRUFBVXFHLEdBQVFvWCxFQUFBQSxFQUd0RHB1QixPQUFPeUosT0FBTzJrQixFQUFPLENBQUVHLE9BQVFELEVBQVNFLFFBQVNGLEVBQVMzWixJQUFBQSxHQUFBQSxHQ0Y5RCxLQUFNM0csR0FBSyxDQUNUMGdCLGVBQ0VwaUIsR0FBWXBLLEtBQUt5SCxTQUFTcUQsVUFBVzlLLEtBQUtvQixPQUFPbVcsVUFBVXpNLFVBQVVqQixRQUFRLElBQUssUUFDbEZPLEdBQVlwSyxLQUFLeUgsU0FBU3FELFVBQVc5SyxLQUFLb0IsT0FBT2dLLFdBQVd5YyxZQUFhN25CLEtBQUtrTixVQUFVcEIsR0FBQUEsRUFJMUY0TSx1QkFBOEIseURBQ2QxWSxLQUFLd00sUUFDakJ4TSxLQUFLeU0sTUFBTWhFLGFBQWEsV0FBWSxJQUVwQ3pJLEtBQUt5TSxNQUFNZ1UsZ0JBQWdCLGFBSy9CZ00sUUFBQUEsSUFBQUEsRUFBQUEsS0FNRSxHQUhBenNCLEtBQUs2QixVQUFVNEssU0FHVnpNLEtBQUtrTixVQUFVcEIsR0FPbEIsT0FOQTlMLEtBQUs4UyxNQUFNMkYsS0FBWHpZLDBCQUFBQSxPQUEwQ0EsS0FBSzBMLFNBQS9DMUwsS0FBQUEsT0FBMkRBLEtBQUswRCxZQUdoRW9JLEdBQUc0TSxxQkFBcUJ6WSxLQUFLRCxNQUFBQSxHQU8xQlUsRUFBV1YsS0FBS3lILFNBQVNxUCxZQUU1QkEsR0FBUzRLLE9BQU96aEIsS0FBS0QsTUFHaEI2QixLQUFBQSxVQUFVaVYsWUFJakJoTCxHQUFHNE0scUJBQXFCelksS0FBS0QsTUFHekJBLEtBQUt3TSxTQUNQdUwsR0FBUy9GLE1BQU0vUixLQUFLRCxNQUl0QkEsS0FBS21ZLE9BQVMsS0FHZG5ZLEtBQUtzYyxNQUFRLEtBR2J0YyxLQUFLMGxCLEtBQU8sS0FHWjFsQixLQUFLOFIsUUFBVSxLQUdmOVIsS0FBS2tTLE1BQVEsS0FHYjRFLEdBQVNzRixhQUFhbmMsS0FBS0QsTUFHM0I4VyxHQUFTZ0gsV0FBVzdkLEtBQUtELE1BR3pCOFcsR0FBU29ILGVBQWVqZSxLQUFLRCxNQUc3QjhMLEdBQUc0Z0IsYUFBYXpzQixLQUFLRCxNQUdyQm9LLEdBQ0VwSyxLQUFLeUgsU0FBU3FELFVBQ2Q5SyxLQUFLb0IsT0FBT2dLLFdBQVdZLElBQUlrQixVQUMzQjVCLEdBQVFVLEtBQU9oTSxLQUFLd00sU0FBV3hNLEtBQUt3USxTQUl0Q3BHLEdBQVlwSyxLQUFLeUgsU0FBU3FELFVBQVc5SyxLQUFLb0IsT0FBT2dLLFdBQVdnQixRQUFRYyxVQUFXNUIsR0FBUWMsU0FBV3BNLEtBQUt3TSxTQUd2R3BDLEdBQVlwSyxLQUFLeUgsU0FBU3FELFVBQVc5SyxLQUFLb0IsT0FBT2dLLFdBQVd4RSxNQUFPVCxFQUFRUyxPQUczRXdELEdBQVlwSyxLQUFLeUgsU0FBU3FELFVBQVc5SyxLQUFLb0IsT0FBT2dLLFdBQVd3YyxRQUFTNW5CLEtBQUs2TSxPQUcxRTdNLEtBQUt1TyxPQUFBQSxFQUdMdkksWUFBVyxXQUNUaUksR0FBYWhPLEtBQUtELEVBQU1BLEVBQUt5TSxNQUFPLFdBQ25DLEdBR0hYLEdBQUc2Z0IsU0FBUzFzQixLQUFLRCxNQUdiQSxLQUFLcW5CLFFBQ1B2YixHQUFHOGdCLFVBQVUzc0IsS0FBS0QsS0FBTUEsS0FBS3FuQixRQUFBQSxHQUFlalIsT0FBTSxlQUtoRHBXLEtBQUtvQixPQUFPa1gsVUFDZHhCLEdBQVNvSCxlQUFlamUsS0FBS0QsTUFJM0JBLEtBQUtvQixPQUFPaWhCLGVBQ2R2TCxHQUFTbUwsaUJBQWlCaGlCLEtBQUtELEtBQUFBLEVBS25DMnNCLFdBRUUsSUFBSTVTLEVBQVFuRyxHQUFLdFEsSUFBSSxPQUFRdEQsS0FBS29CLFFBYzlCLEdBWEFWLEVBQVVWLEtBQUtvQixPQUFPMFMsU0FBV3BULEVBQVNWLEtBQUtvQixPQUFPMFMsU0FDeERpRyxHQUFBQSxLQUFBQSxPQUFjL1osS0FBS29CLE9BQU8wUyxRQUk1Qm5VLE1BQU1DLEtBQUtJLEtBQUt5SCxTQUFTK1AsUUFBUTlFLE1BQVEsSUFBSXZULFNBQVNpYixTQUFBQSxHQUNwREEsRUFBTzNSLGFBQWEsYUFBY3NSLEVBQUFBLElBS2hDL1osS0FBS3loQixRQUFTLENBQ1Z3RixJQUFBQSxFQUFTbGMsR0FBVzlLLEtBQUtELEtBQU0sVUFFckMsSUFBS1UsRUFBV3VtQixHQUNkLE9BSUYsSUFBTW5ULEVBQVNwVCxFQUFTVixLQUFLb0IsT0FBTzBTLE9BQTZCLFFBQXBCOVQsS0FBS29CLE9BQU8wUyxNQUNuRGQsRUFBU1ksR0FBS3RRLElBQUksYUFBY3RELEtBQUtvQixRQUUzQzZsQixFQUFPeGUsYUFBYSxRQUFTdUssRUFBT25KLFFBQVEsVUFBV2lLLEdBQUFBLENBQUFBLEVBSzNEK1ksYUFBYUMsR0FDWDFpQixHQUFZcEssS0FBS3lILFNBQVNxRCxVQUFXOUssS0FBS29CLE9BQU9nSyxXQUFXa2MsY0FBZXdGLEVBQUFBLEVBSzdFRixVQUFVdkYsR0FBa0IsV0FFMUIsT0FGMEIsMkRBRVhybkIsS0FBS3FuQixRQUtmNWEsS0FBQUEsTUFBTWhFLGFBQWEsY0FBZTRlLEdBR2xDNWYsS0FBQUEsU0FBUzRmLE9BQU81RyxnQkFBZ0IsVUFJbkNsUyxHQUNHdE8sS0FBS0QsTUFFTDBPLE1BQUssa0JBQU1zZCxHQUFVM0UsRUFBaEIsSUFDTGpSLE9BQU9iLFNBQUFBLEdBTU4sTUFKSThSLElBQVdybkIsRUFBS3FuQixRQUNsQnZiLEdBQUcrZ0IsYUFBYTVzQixLQUFLRCxHQUFBQSxHQUdqQnVWLENBQUFBLElBRVA3RyxNQUFLLFdBRUosR0FBSTJZLElBQVdybkIsRUFBS3FuQixPQUNsQixNQUFNLElBQUlsUyxNQUFNLHFEQUduQnpHLE1BQUssa0JBQ0o1USxPQUFPeUosT0FBT3ZILEVBQUt5SCxTQUFTNGYsT0FBTzVsQixNQUFPLENBQ3hDc3JCLGdCQUFpQixRQUFqQkEsT0FBeUIxRixFQUF6QjBGLE1BRUFDLGVBQWdCLEtBR2xCbGhCLEdBQUcrZ0IsYUFBYTVzQixLQUFLRCxHQUFBQSxHQUVkcW5CLENBVEgsS0E3QkQ3WSxRQUFRc0csT0FBTyxJQUFJSyxNQUFNLHNCQXNDckJrUyxFQU1mcUYsYUFBYTdtQixHQUFBQSxJQUFBQSxFQUFBQSxLQUVYdUUsR0FBWXBLLEtBQUt5SCxTQUFTcUQsVUFBVzlLLEtBQUtvQixPQUFPZ0ssV0FBV29jLFFBQVN4bkIsS0FBS3duQixTQUMxRXBkLEdBQVlwSyxLQUFLeUgsU0FBU3FELFVBQVc5SyxLQUFLb0IsT0FBT2dLLFdBQVdpSCxPQUFRclMsS0FBS3FTLFFBQ3pFakksR0FBWXBLLEtBQUt5SCxTQUFTcUQsVUFBVzlLLEtBQUtvQixPQUFPZ0ssV0FBV3FjLFFBQVN6bkIsS0FBS3luQixTQUcxRTluQixNQUFNQyxLQUFLSSxLQUFLeUgsU0FBUytQLFFBQVE5RSxNQUFRLElBQUl2VCxTQUFTNEMsU0FBQUEsR0FDcERqRSxPQUFPeUosT0FBT3hGLEVBQVEsQ0FBRXdhLFFBQVN2YyxFQUFLd25CLFVBQ3RDemxCLEVBQU8wRyxhQUFhLGFBQWNtTCxHQUFLdFEsSUFBSXRELEVBQUt3bkIsUUFBVSxRQUFVLE9BQVF4bkIsRUFBS29CLFFBQUFBLElBSS9FVixFQUFTbUYsSUFBeUIsZUFBZkEsRUFBTW5DLE1BSzdCb0ksR0FBR21oQixlQUFlaHRCLEtBQUtELEtBQUFBLEVBSXpCa3RCLGFBQWFybkIsR0FBQUEsSUFBQUEsRUFBQUEsS0FDWDdGLEtBQUswbkIsUUFBVSxDQUFDLFVBQVcsV0FBVzNuQixTQUFTOEYsRUFBTW5DLE1BR3JEeXBCLGFBQWFudEIsS0FBS290QixPQUFPMUYsU0FHekIxbkIsS0FBS290QixPQUFPMUYsUUFBVTFoQixZQUNwQixXQUVFb0UsR0FBWXBLLEVBQUt5SCxTQUFTcUQsVUFBVzlLLEVBQUtvQixPQUFPZ0ssV0FBV3NjLFFBQVMxbkIsRUFBSzBuQixTQUcxRTViLEdBQUdtaEIsZUFBZWh0QixLQUFLRCxFQUFBQSxHQUV6QkEsS0FBSzBuQixRQUFVLElBQU0sSUFLekJ1RixlQUFlNWlCLEdBQ1AsSUFBWWdqQixFQUFvQnJ0QixLQUFLeUgsU0FBbkNxUCxTQUVSLEdBQUl1VyxHQUFtQnJ0QixLQUFLb0IsT0FBT21rQixhQUFjLENBRS9DLElBQU0rSCxFQUFrQnR0QixLQUFLNk0sT0FBUzdNLEtBQUt1dEIsYUFBZSxJQUFPQyxLQUFLQyxNQUdqRVIsS0FBQUEsZUFDSDdvQixRQUNFaUcsR0FBU3JLLEtBQUswbkIsU0FBVzFuQixLQUFLcVMsUUFBVWdiLEVBQWdCOVEsU0FBVzhRLEVBQWdCMUYsT0FBUzJGLEdBQUFBLENBQUFBLEVBT3BHSSxnQkFBQUEsSUFBQUEsRUFBQUEsS0FFRTV2QixPQUFPK2hCLE9BQVAvaEIsRUFBQUEsQ0FBQUEsRUFBbUJrQyxLQUFLeU0sTUFBTWhMLFFBRTNCNUMsUUFBUWpCLFNBQUFBLEdBQUFBLE9BQVM4QyxFQUFTOUMsSUFBUThDLEVBQVU5QyxJQUFRQSxFQUFJc0gsV0FBVyxTQUEzRHRILElBQ1J1QixTQUFTdkIsU0FBQUEsR0FFSDZKLEVBQUFBLFNBQVNxRCxVQUFVckosTUFBTXViLFlBQVlwZixFQUFLb0MsRUFBS3lNLE1BQU1oTCxNQUFNa3NCLGlCQUFpQi92QixJQUdqRm9DLEVBQUt5TSxNQUFNaEwsTUFBTW1zQixlQUFlaHdCLEVBQUFBLElBSWhDOEMsRUFBU1YsS0FBS3lNLE1BQU1oTCxRQUN0QnpCLEtBQUt5TSxNQUFNZ1UsZ0JBQWdCLFdDeFIzQm9OLEc3QlZHLFc2QldQMXRCLFNBQUFBLEVBQVk4UixHQUFBQSxJQUFBQSxFQUFBQSxLQUFBQSxFQUFBQSxLQUFBQSxHQUFReFQsRUFBQUEsS0FBQUEsY0EyS1AsV0FDTCxJQUFFd1QsRUFBV2pTLEVBQWIsT0FDRXlILEVBQWF3SyxFQUFmeEssU0FFTndLLEVBQU9wRixPQUFBQSxFQUdQekMsR0FBWTNDLEVBQVNxRCxVQUFXbUgsRUFBTzdRLE9BQU9nSyxXQUFXd2MsU0FBQUEsRUFBUyxJQWxMaERucEIsRUFBQUEsS0FBQUEsZUFxTExvSCxTQUFBQSxHQUNQLElBQUVvTSxFQUFXalMsRUFBYixPQUNFeUgsRUFBYXdLLEVBQWZ4SyxTQUNFN0osRUFBeUJpSSxFQUEzQmpJLElBQU84RixFQUFvQm1DLEVBQTNCbkMsS0FBYW9xQixFQUFjam9CLEVBQTNCaW9CLFVBS04sR0FIQVgsYUFBYW50QixFQUFLK3RCLFlBR0wsWUFBVHJxQixHQUE4QixRQUFSOUYsRUFBMUIsQ0FLYSxZQUFUOEYsSUFDR3NxQixFQUFBQSxZQUFjRixHQUlmRyxJQU9BQyxFQUFhSixFQUFZOXRCLEVBQUtndUIsYUFBZSxJQUd0QyxVQUFUdHFCLEdBQXFCd3FCLEtBVkgsV0FDZHRrQixJQUFBQSxFQUFZcUksRUFBTzdRLE9BQU9nSyxXQUFXSCxTQUUzQ2IsR0FEZ0JTLEdBQVk1SyxLQUFLZ1MsRUFBakJwSCxJQUFBQSxPQUE2QmpCLElBQ3hCQSxHQUFBQSxFQUFXLENBSFosR0FtQlQsYUFBVGxHLElBQ0YxRCxFQUFLK3RCLFdBQWEvbkIsWUFBVyxXQUMzQixJQUFNNmYsRUFBVWhtQixTQUFTdXFCLGNBR3BCM2lCLEVBQVNxRCxVQUFVTixTQUFTcWIsSUFJakN6YixHQUFZdkssU0FBU3VxQixjQUFlblksRUFBTzdRLE9BQU9nSyxXQUFXSCxVQUFBQSxFQUFVLEdBQ3RFLEtBdENHLENBc0NILElBcE9heE0sRUFBQUEsS0FBQUEsVUF5T1gsV0FBVSxJQUFUK08sSUFBUyx5REFDVHlFLEVBQVdqUyxFQUFiLE9BR0ZpUyxFQUFPN1EsT0FBT3drQixTQUFTRSxRQUN6QnhZLEdBQWVyTixLQUFLZ1MsRUFBUWxOLE9BQVEsZ0JBQWlCL0UsRUFBS211QixVQUFXM2dCLEdBQUFBLEdBSXZFRixHQUFlck4sS0FBS2dTLEVBQVFwUyxTQUFTaUUsS0FBTSxRQUFTOUQsRUFBS2lnQixXQUFZelMsR0FHckVNLEdBQUs3TixLQUFLZ1MsRUFBUXBTLFNBQVNpRSxLQUFNLGFBQWM5RCxFQUFLb3VCLFlBR3BEOWdCLEdBQWVyTixLQUFLZ1MsRUFBUXBTLFNBQVNpRSxLQUFNLDhCQUErQjlELEVBQUtxdUIsWUFBYTdnQixHQUFBQSxHQUFRLEVBQU8sSUF4UHpGL08sRUFBQUEsS0FBQUEsYUE0UFIsV0FDSixJQUFFd1QsRUFBV2pTLEVBQWIsT0FDRW9CLEVBQTZCNlEsRUFBL0I3USxPQUFVcUcsRUFBcUJ3SyxFQUEvQnhLLFNBQW9CMmxCLEVBQVduYixFQUEvQm1iLFFBR0Roc0IsRUFBT3drQixTQUFTRSxRQUFVMWtCLEVBQU93a0IsU0FBU0MsU0FDN0NqWSxHQUFHM04sS0FBS2dTLEVBQVF4SyxFQUFTcUQsVUFBVyxnQkFBaUI5SyxFQUFLbXVCLFdBQUFBLEdBSTVEdmdCLEdBQUczTixLQUNEZ1MsRUFDQXhLLEVBQVNxRCxVQUNULDRFQUNDakYsU0FBQUEsR0FDTyxJQUFZd25CLEVBQW9CNWxCLEVBQTlCcVAsU0FHSnVXLEdBQWtDLG9CQUFmeG5CLEVBQU1uQyxPQUMzQjJwQixFQUFnQjlRLFNBQUFBLEVBQ2hCOFEsRUFBZ0IxRixPQUFBQSxHQUtkNWhCLElBQUFBLEVBQVEsRUFEQyxDQUFDLGFBQWMsWUFBYSxhQUFhaEcsU0FBUzhGLEVBQU1uQyxRQUluRW9JLEdBQUdtaEIsZUFBZWh0QixLQUFLZ1MsR0FBQUEsR0FFdkJsTSxFQUFRa00sRUFBT3BGLE1BQVEsSUFBTyxLQUloQ3NnQixhQUFhQyxFQUFPdFcsVUFHcEJzVyxFQUFPdFcsU0FBVzlRLFlBQVcsa0JBQU04RixHQUFHbWhCLGVBQWVodEIsS0FBS2dTLEdBQUFBLEVBQTdCLEdBQTZDbE0sRUFBQUEsSUFLeEV1b0IsSUFBQUEsRUFBWSxXQUNoQixHQUFLcmMsRUFBT3JCLFVBQVdxQixFQUFPN1EsT0FBT3lQLE1BQU1DLFFBQTNDLENBSU0vTyxJQUFBQSxFQUFTMEYsRUFBU0MsUUFDaEIwSixFQUFXYSxFQUFPZCxXQUFwQkMsT0FEQXJQLEVBQUFBLEVBRTRCcU8sR0FBZW5RLEtBQUtnUyxHQUZoRGxRLEdBRUN3c0IsRUFGRHhzQixFQUFBQSxHQUVheXNCLEVBRmJ6c0IsRUFBQUEsR0FHQTBzQixFQUF1QnRmLEdBQUFBLGlCQUFBQSxPQUE2Qm9mLEVBQTdCcGYsT0FBQUEsT0FBNkNxZixJQUd0RSxHQUFDcGQsRUFBRCxDQVlKLE1sQjdMRyxDQUZPck8sS0FBS0MsSUFBSW5ELFNBQVNxRSxnQkFBZ0J3cUIsYUFBZSxFQUFHM3BCLE9BQU80cEIsWUFBYyxHQUN4RTVyQixLQUFLQyxJQUFJbkQsU0FBU3FFLGdCQUFnQjBxQixjQUFnQixFQUFHN3BCLE9BQU84cEIsYUFBZSxJa0I4TGhFQyxFQUF0QixLQUNNakYsRUFETixLQUNpQ2lGLEVBQWlCUCxFQUFhQyxFQUUzREMsR0FDRjFzQixFQUFPTixNQUFNaUIsTUFBUW1uQixFQUFXLE9BQVMsT0FDekM5bkIsRUFBT04sTUFBTXNPLE9BQVM4WixFQUFXLE9BQVMsU0FFMUM5bkIsRUFBT04sTUFBTXN0QixTQUFXbEYsRUFBZWlGLEVBQWlCTixFQUFlRCxFQUFuQyxLQUFvRCxLQUN4RnhzQixFQUFPTixNQUFNdXRCLE9BQVNuRixFQUFXLFNBQVcsS0FaNUMsTUFQSTRFLEdBQ0Yxc0IsRUFBT04sTUFBTWlCLE1BQVEsS0FDckJYLEVBQU9OLE1BQU1zTyxPQUFTLE9BRXRCaE8sRUFBT04sTUFBTXN0QixTQUFXLEtBQ3hCaHRCLEVBQU9OLE1BQU11dEIsT0FBUyxLQWZsQixDQTZCc0MsRUFLMUNDLEVBQVUsV0FDZDlCLGFBQWFDLEVBQU82QixTQUNwQjdCLEVBQU82QixRQUFVanBCLFdBQVdzb0IsRUFBVyxLQUd6QzFnQixHQUFHM04sS0FBS2dTLEVBQVF4SyxFQUFTcUQsVUFBVyxrQ0FBbUNqRixTQUFBQSxHQUNsRG9NLEVBQU9kLFdBQXBCLFNBR1MxSixFQUFTcUQsYUFLbkJtSCxFQUFPd1AsU0FBVy9nQixFQUFTdVIsRUFBTzdRLE9BQU8wTyxTQUs5Q3dlLEtBRzhCLG9CQUFmem9CLEVBQU1uQyxLQUE2QmtLLEdBQUtDLElBQ2hENU4sS0FBS2dTLEVBQVFsTixPQUFRLFNBQVVrcUIsSUFBQUEsR0FBQUEsSUFqV3RCeHdCLEVBQUFBLEtBQUFBLFNBc1daLFdBQ0EsSUFBRXdULEVBQVdqUyxFQUFiLE9BQ0V5SCxFQUFhd0ssRUFBZnhLLFNBdUNOLEdBcENBbUcsR0FBRzNOLEtBQUtnUyxFQUFRQSxFQUFPeEYsTUFBTyw2QkFBOEI1RyxTQUFBQSxHQUFBQSxPQUFVaVIsR0FBU2dILFdBQVc3ZCxLQUFLZ1MsRUFBUXBNLEVBQTNDQSxJQUc1RCtILEdBQUczTixLQUFLZ1MsRUFBUUEsRUFBT3hGLE1BQU8sNENBQTZDNUcsU0FBQUEsR0FBQUEsT0FDekVpUixHQUFTb0gsZUFBZWplLEtBQUtnUyxFQUFRcE0sRUFEb0NBLElBSzNFK0gsR0FBRzNOLEtBQUtnUyxFQUFRQSxFQUFPeEYsTUFBTyxTQUFTLFdBRWpDd0YsRUFBT3pGLFNBQVd5RixFQUFPekIsU0FBV3lCLEVBQU83USxPQUFPb2tCLGFBRXBEdlQsRUFBT3lGLFVBR1B6RixFQUFPd0YsUUFBQUEsSUFLWDdKLEdBQUczTixLQUFLZ1MsRUFBUUEsRUFBT3hGLE1BQU8sbUNBQW9DNUcsU0FBQUEsR0FBQUEsT0FDaEVpUixHQUFTMEYsZUFBZXZjLEtBQUtnUyxFQUFRcE0sRUFEMkJBLElBS2xFK0gsR0FBRzNOLEtBQUtnUyxFQUFRQSxFQUFPeEYsTUFBTyxnQkFBaUI1RyxTQUFBQSxHQUFBQSxPQUFVaVIsR0FBU3NGLGFBQWFuYyxLQUFLZ1MsRUFBUXBNLEVBQTdDQSxJQUcvQytILEdBQUczTixLQUFLZ1MsRUFBUUEsRUFBT3hGLE1BQU8sK0NBQWdENUcsU0FBQUEsR0FBQUEsT0FDNUVpRyxHQUFHNGdCLGFBQWF6c0IsS0FBS2dTLEVBQVFwTSxFQUQrQ0EsSUFLOUUrSCxHQUFHM04sS0FBS2dTLEVBQVFBLEVBQU94RixNQUFPLGtDQUFtQzVHLFNBQUFBLEdBQUFBLE9BQVVpRyxHQUFHb2hCLGFBQWFqdEIsS0FBS2dTLEVBQVFwTSxFQUF2Q0EsSUFHN0RvTSxFQUFPL0UsVUFBVXBCLElBQU1tRyxFQUFPN1EsT0FBT2trQixjQUFnQnJULEVBQU9pZCxRQUFTLENBRXZFLElBQU14bkIsRUFBVXFELEdBQVc5SyxLQUFLZ1MsRUFBaEJsSCxJQUFBQSxPQUE0QmtILEVBQU83USxPQUFPZ0ssV0FBV0ksUUFHckUsSUFBSzlLLEVBQVdnSCxHQUNkLE9BSUZrRyxHQUFHM04sS0FBS2dTLEVBQVF4SyxFQUFTcUQsVUFBVyxTQUFVakYsU0FBQUEsSUFDNUIsQ0FBQzRCLEVBQVNxRCxVQUFXcEQsR0FHeEIzSCxTQUFTOEYsRUFBTTlELFNBQVkyRixFQUFROEMsU0FBUzNFLEVBQU05RCxXQUszRGtRLEVBQU9wRixPQUFTb0YsRUFBTzdRLE9BQU9ta0IsZUFJOUJ0VCxFQUFPa2QsT0FDSjlELEVBQUFBLE1BQU14bEIsRUFBT29NLEVBQU95RixRQUFTLFdBQ2xDMVgsRUFBS3FyQixNQUNIeGxCLEdBQ0EsV0FDRThJLEdBQWVzRCxFQUFPUyxPQUFBQSxHQUV4QixTQUdGMVMsRUFBS3FyQixNQUNIeGxCLEdBQ0EsV0FDRThJLEdBQWVzRCxFQUFPbWQsYUFBQUEsR0FFeEIsWUFPSm5kLENBQUFBLEVBQU8vRSxVQUFVcEIsSUFBTW1HLEVBQU83USxPQUFPcWtCLG9CQUN2QzdYLEdBQUczTixLQUNEZ1MsRUFDQXhLLEVBQVNDLFFBQ1QsZUFDQzdCLFNBQUFBLEdBQ0NBLEVBQU14QyxnQkFBQUEsSUFBQUEsR0FPWnVLLEdBQUczTixLQUFLZ1MsRUFBUUEsRUFBT3hGLE1BQU8sZ0JBQWdCLFdBRTVDd0YsRUFBT3NDLFFBQVF6UyxJQUFJLENBQ2pCcVcsT0FBUWxHLEVBQU9rRyxPQUNmbUUsTUFBT3JLLEVBQU9xSyxPQUFBQSxJQUtsQjFPLEdBQUczTixLQUFLZ1MsRUFBUUEsRUFBT3hGLE1BQU8sY0FBYyxXQUUxQ3FLLEdBQVMwSCxjQUFjdmUsS0FBS2dTLEVBQVEsU0FHcENBLEVBQU9zQyxRQUFRelMsSUFBSSxDQUFFb1EsTUFBT0QsRUFBT0MsT0FBQUEsSUFJckN0RSxHQUFHM04sS0FBS2dTLEVBQVFBLEVBQU94RixNQUFPLGlCQUFrQjVHLFNBQUFBLEdBRTlDaVIsR0FBUzBILGNBQWN2ZSxLQUFLZ1MsRUFBUSxVQUFXLEtBQU1wTSxFQUFNcUksT0FBTzRELFFBQUFBLElBSXBFbEUsR0FBRzNOLEtBQUtnUyxFQUFRQSxFQUFPeEYsTUFBTyx1QkFBdUIsV0FDbkRxSyxHQUFTaUssZUFBZTlnQixLQUFLZ1MsRUFBQUEsSUFLL0IsSUFBTW9kLEVBQWNwZCxFQUFPN1EsT0FBT21FLE9BQU8xQyxPQUFPLENBQUMsUUFBUyxZQUFZeVcsS0FBSyxLQUUzRTFMLEdBQUczTixLQUFLZ1MsRUFBUUEsRUFBT3hGLE1BQU80aUIsR0FBY3hwQixTQUFBQSxHQUN0QyxNQUFrQkEsRUFBbEIsT0FBRXFJLE9BQUYsTUFBVyxDQUFDLEVBQVosRUFHZSxVQUFmckksRUFBTW5DLE9BQ1J3SyxFQUFTK0QsRUFBT3hGLE1BQU04SSxPQUd4QnRILEdBQWFoTyxLQUFLZ1MsRUFBUXhLLEVBQVNxRCxVQUFXakYsRUFBTW5DLE1BQUFBLEVBQVl3SyxFQUFBQSxHQUFBQSxJQWpmaER6UCxFQUFBQSxLQUFBQSxTQXNmWixTQUFDb0gsRUFBT3lwQixFQUFnQkMsR0FDeEIsSUFBRXRkLEVBQVdqUyxFQUFiLE9BQ0F3dkIsRUFBZ0J2ZCxFQUFPN1EsT0FBT1MsVUFBVTB0QixHQUUxQ0UsR0FBQUEsRUFEcUIvdUIsRUFBWTh1QixLQUtuQ0MsRUFBV0QsRUFBY3Z2QixLQUFLZ1MsRUFBUXBNLEtBQUFBLElBSXBDNHBCLEdBQXNCL3VCLEVBQVk0dUIsSUFDcENBLEVBQWVydkIsS0FBS2dTLEVBQVFwTSxFQUFBQSxJQW5nQlpwSCxFQUFBQSxLQUFBQSxRQXdnQmIsU0FBQ3dDLEVBQVN5QyxFQUFNNHJCLEVBQWdCQyxHQUE0QixJQUFWOWhCLElBQVUseURBQ3pEd0UsRUFBV2pTLEVBQWIsT0FDQXd2QixFQUFnQnZkLEVBQU83USxPQUFPUyxVQUFVMHRCLEdBQ3hDRyxFQUFtQmh2QixFQUFZOHVCLEdBRXJDNWhCLEdBQUczTixLQUNEZ1MsRUFDQWhSLEVBQ0F5QyxHQUNDbUMsU0FBQUEsR0FBQUEsT0FBVTdGLEVBQUtxckIsTUFBTXhsQixFQUFPeXBCLEVBQWdCQyxFQUE1QzFwQixHQUNENEgsSUFBWWlpQixFQUFBQSxJQWxoQklqeEIsRUFBQUEsS0FBQUEsWUF1aEJULFdBQ0gsSUFBRXdULEVBQVdqUyxFQUFiLE9BQ0V5SCxFQUFhd0ssRUFBZnhLLFNBRUFrb0IsRUFBYXhwQixFQUFRQyxLQUFPLFNBQVcsUUFrTHpDRCxHQS9LQXNCLEVBQVMrUCxRQUFROUUsTUFDbkIvUyxNQUFNQyxLQUFLNkgsRUFBUytQLFFBQVE5RSxNQUFNdlQsU0FBU2liLFNBQUFBLEdBQ3pDcGEsRUFBS2ljLEtBQ0g3QixFQUNBLFNBQ0EsV0FDRXpMLEdBQWVzRCxFQUFPbWQsYUFBQUEsR0FFeEIsV0FNTnB2QixFQUFLaWMsS0FBS3hVLEVBQVMrUCxRQUFRRSxRQUFTLFFBQVN6RixFQUFPeUYsUUFBUyxXQUd4RHVFLEVBQUFBLEtBQ0h4VSxFQUFTK1AsUUFBUUcsT0FDakIsU0FDQSxXQUVFMUYsRUFBT3NiLGFBQWVDLEtBQUtDLE1BQzNCeGIsRUFBTzBGLFFBQUFBLEdBRVQsVUFJR3NFLEVBQUFBLEtBQ0h4VSxFQUFTK1AsUUFBUUksWUFDakIsU0FDQSxXQUVFM0YsRUFBT3NiLGFBQWVDLEtBQUtDLE1BQzNCeGIsRUFBTzJkLFNBQUFBLEdBRVQsZUFJRzNULEVBQUFBLEtBQ0h4VSxFQUFTK1AsUUFBUUssS0FDakIsU0FDQSxXQUNFNUYsRUFBT3FLLE9BQVNySyxFQUFPcUssS0FBQUEsR0FFekIsUUFJRnRjLEVBQUtpYyxLQUFLeFUsRUFBUytQLFFBQVFPLFNBQVUsU0FBUyxrQkFBTTlGLEVBQU80ZCxnQkFBYixJQUd6QzVULEVBQUFBLEtBQ0h4VSxFQUFTK1AsUUFBUXdKLFNBQ2pCLFNBQ0EsV0FDRS9TLEdBQWFoTyxLQUFLZ1MsRUFBUUEsRUFBT3hGLE1BQU8sY0FFMUMsWUFJR3dQLEVBQUFBLEtBQ0h4VSxFQUFTK1AsUUFBUXJHLFdBQ2pCLFNBQ0EsV0FDRWMsRUFBT2QsV0FBVzNELFFBQUFBLEdBRXBCLGNBSUd5TyxFQUFBQSxLQUNIeFUsRUFBUytQLFFBQVF4TCxJQUNqQixTQUNBLFdBQ0VpRyxFQUFPakcsSUFBTSxXQUVmLE9BSUZoTSxFQUFLaWMsS0FBS3hVLEVBQVMrUCxRQUFRcEwsUUFBUyxRQUFTNkYsRUFBTzdGLFFBQVMsV0FHeEQ2UCxFQUFBQSxLQUNIeFUsRUFBUytQLFFBQVFNLFNBQ2pCLFNBQ0NqUyxTQUFBQSxHQUVDQSxFQUFNc1Ysa0JBQ050VixFQUFNeEMsaUJBRU55VCxHQUFTbUosV0FBV2hnQixLQUFLZ1MsRUFBUXBNLEVBQUFBLEdBRW5DLFNBT0dvVyxFQUFBQSxLQUNIeFUsRUFBUytQLFFBQVFNLFNBQ2pCLFNBQ0NqUyxTQUFBQSxHQUNNLENBQUMsUUFBUyxTQUFTOUYsU0FBUzhGLEVBQU1qSSxPQUtyQixVQUFkaUksRUFBTWpJLEtBTVZpSSxFQUFNeEMsaUJBR053QyxFQUFNc1Ysa0JBR05yRSxHQUFTbUosV0FBV2hnQixLQUFLZ1MsRUFBUXBNLElBWC9CaVIsR0FBUzRFLG1CQUFtQnpiLEtBQUtnUyxFQUFRLFNBQU0sR0FhbkQsU0FLR2dLLEVBQUFBLEtBQUt4VSxFQUFTcVEsU0FBUzJCLEtBQU0sV0FBWTVULFNBQUFBLEdBQzFCLFdBQWRBLEVBQU1qSSxLQUNSa1osR0FBU21KLFdBQVdoZ0IsS0FBS2dTLEVBQVFwTSxFQUFBQSxJQUtoQ29XLEVBQUFBLEtBQUt4VSxFQUFTd1EsT0FBT0MsS0FBTSx1QkFBd0JyUyxTQUFBQSxHQUN0RCxJQUFNaXFCLEVBQU9yb0IsRUFBU3VRLFNBQVN4Vix3QkFDekJ1YSxFQUFXLElBQU0rUyxFQUFLcHRCLE9BQVVtRCxFQUFNMFgsTUFBUXVTLEVBQUtsdEIsTUFDekRpRCxFQUFNa3FCLGNBQWN0bkIsYUFBYSxhQUFjc1UsRUFBQUEsSUFJNUNkLEVBQUFBLEtBQUt4VSxFQUFTd1EsT0FBT0MsS0FBTSx1REFBd0RyUyxTQUFBQSxHQUN0RixJQUFNcVMsRUFBT3JTLEVBQU1rcUIsY0FDYkMsRUFBWSxpQkFFbEIsSUFBSXR2QixFQUFpQm1GLElBQVcsQ0FBQyxZQUFhLGNBQWM5RixTQUFTOEYsRUFBTWpJLEtBQTNFLENBS0FxVSxFQUFPc2IsYUFBZUMsS0FBS0MsTUFHckIvYSxJQUFBQSxFQUFPd0YsRUFBSytYLGFBQWFELEdBRXpCRSxFQUFPLENBQUMsVUFBVyxXQUFZLFNBQVNud0IsU0FBUzhGLEVBQU1uQyxNQUd6RGdQLEdBQVF3ZCxHQUNWaFksRUFBS3VJLGdCQUFnQnVQLEdBQ3JCcmhCLEdBQWVzRCxFQUFPUyxVQUNad2QsR0FBUWplLEVBQU91VixVQUN6QnRQLEVBQUt6UCxhQUFhdW5CLEVBQVcsSUFDN0IvZCxFQUFPd0YsUUFqQkQsQ0FpQkNBLElBT1B0UixFQUFRUyxNQUFPLENBQ1hxUixJQUFBQSxFQUFTcE4sR0FBWTVLLEtBQUtnUyxFQUFRLHVCQUN4Q3RTLE1BQU1DLEtBQUtxWSxHQUFROVksU0FBU2dGLFNBQUFBLEdBQUFBLE9BQVVuRSxFQUFLaWMsS0FBSzlYLEVBQU93ckIsR0FBYTlwQixTQUFBQSxHQUFBQSxPQUFVQyxFQUFRRCxFQUFNOUQsT0FBeEI4RCxHQUF4QzFCLEdBSXpCOFgsQ0FBQUEsRUFBQUEsS0FDSHhVLEVBQVN3USxPQUFPQyxLQUNoQnlYLEdBQ0M5cEIsU0FBQUEsR0FDQyxJQUFNcVMsRUFBT3JTLEVBQU1rcUIsY0FFZkksRUFBU2pZLEVBQUs5VixhQUFhLGNBRTNCMUIsRUFBU3l2QixLQUNYQSxFQUFTalksRUFBS3JhLE9BR2hCcWEsRUFBS3VJLGdCQUFnQixjQUVyQnhPLEVBQU9HLFlBQWUrZCxFQUFTalksRUFBS2xWLElBQU9pUCxFQUFPcUcsUUFBQUEsR0FFcEQsUUFJRzJELEVBQUFBLEtBQUt4VSxFQUFTdVEsU0FBVSxtQ0FBb0NuUyxTQUFBQSxHQUFBQSxPQUMvRGlSLEdBQVNtRyxrQkFBa0JoZCxLQUFLZ1MsRUFBUXBNLEVBRHVCQSxJQU01RG9XLEVBQUFBLEtBQUt4VSxFQUFTdVEsU0FBVSx1QkFBd0JuUyxTQUFBQSxHQUM3QyxJQUFFa2lCLEVBQXNCOVYsRUFBeEIsa0JBRUY4VixHQUFxQkEsRUFBa0JxSSxRQUN6Q3JJLEVBQWtCc0ksVUFBVXhxQixFQUFBQSxJQUszQm9XLEVBQUFBLEtBQUt4VSxFQUFTdVEsU0FBVSw2QkFBNkIsV0FDbEQsSUFBRStQLEVBQXNCOVYsRUFBeEIsa0JBRUY4VixHQUFxQkEsRUFBa0JxSSxRQUN6Q3JJLEVBQWtCdUksU0FBQUEsR0FBUSxFQUFPLElBS2hDclUsRUFBQUEsS0FBS3hVLEVBQVN1USxTQUFVLHdCQUF5Qm5TLFNBQUFBLEdBQzlDLElBQUVraUIsRUFBc0I5VixFQUF4QixrQkFFRjhWLEdBQXFCQSxFQUFrQnFJLFFBQ3pDckksRUFBa0J3SSxlQUFlMXFCLEVBQUFBLElBSWhDb1csRUFBQUEsS0FBS3hVLEVBQVN1USxTQUFVLG9CQUFxQm5TLFNBQUFBLEdBQzFDLElBQUVraUIsRUFBc0I5VixFQUF4QixrQkFFRjhWLEdBQXFCQSxFQUFrQnFJLFFBQ3pDckksRUFBa0J5SSxhQUFhM3FCLEVBQUFBLElBSy9CTSxFQUFRSyxVQUNWN0csTUFBTUMsS0FBS2lMLEdBQVk1SyxLQUFLZ1MsRUFBUSx3QkFBd0I5UyxTQUFTOEIsU0FBQUEsR0FDbkVqQixFQUFLaWMsS0FBS2hiLEVBQVMsU0FBVTRFLFNBQUFBLEdBQUFBLE9BQVVpUixHQUFTNEQsZ0JBQWdCemEsS0FBS2dTLEVBQVFwTSxFQUFNOUQsT0FBdEQ4RCxHQUFzRDlELElBTW5Ga1EsRUFBTzdRLE9BQU9pa0IsZUFBaUIza0IsRUFBVytHLEVBQVMyUSxRQUFRRSxXQUN4RDJELEVBQUFBLEtBQUt4VSxFQUFTMlEsUUFBUWhHLFlBQWEsU0FBUyxXQUVwQixJQUF2QkgsRUFBT0csY0FJWEgsRUFBTzdRLE9BQU80YyxZQUFjL0wsRUFBTzdRLE9BQU80YyxXQUUxQ2xILEdBQVNnSCxXQUFXN2QsS0FBS2dTLEdBQUFBLElBS3hCZ0ssRUFBQUEsS0FDSHhVLEVBQVN3USxPQUFPRSxPQUNoQndYLEdBQ0M5cEIsU0FBQUEsR0FDQ29NLEVBQU9rRyxPQUFTdFMsRUFBTTlELE9BQU9sRSxLQUFBQSxHQUUvQixVQUlHb2UsRUFBQUEsS0FBS3hVLEVBQVNxUCxTQUFVLHlCQUEwQmpSLFNBQUFBLEdBQ3JENEIsRUFBU3FQLFNBQVM2USxPQUFTMVYsRUFBT3BGLE9BQXdCLGVBQWZoSCxFQUFNbkMsSUFBQUEsSUFJL0MrRCxFQUFTMEosWUFDWHhSLE1BQU1DLEtBQUs2SCxFQUFTMEosV0FBVzRLLFVBQzVCbGQsUUFBUTBELFNBQUFBLEdBQUFBLE9BQU9BLEVBQUVpSSxTQUFTL0MsRUFBU3FELFVBQTNCdkksSUFDUnBELFNBQVMySSxTQUFBQSxHQUNSOUgsRUFBS2ljLEtBQUtuVSxFQUFPLHlCQUEwQmpDLFNBQUFBLEdBQ3JDNEIsRUFBU3FQLFdBQ1hyUCxFQUFTcVAsU0FBUzZRLE9BQVMxVixFQUFPcEYsT0FBd0IsZUFBZmhILEVBQU1uQyxLQUFBQSxHQUFBQSxJQU90RHVZLEVBQUFBLEtBQUt4VSxFQUFTcVAsU0FBVSxxREFBc0RqUixTQUFBQSxHQUNqRjRCLEVBQVNxUCxTQUFTeUYsUUFBVSxDQUFDLFlBQWEsY0FBY3hjLFNBQVM4RixFQUFNbkMsS0FBQUEsSUFJcEV1WSxFQUFBQSxLQUFLeFUsRUFBU3FQLFNBQVUsV0FBVyxXQUNoQyxJQUFFMVYsRUFBbUI2USxFQUFyQixPQUFVbWIsRUFBV25iLEVBQXJCLE9BR043SCxHQUFZM0MsRUFBU3FQLFNBQVUxVixFQUFPZ0ssV0FBVzBjLGNBQUFBLEdBR2pEaGMsR0FBR21oQixlQUFlaHRCLEtBQUtnUyxHQUFBQSxHQUd2QmpNLFlBQVcsV0FDVG9FLEdBQVkzQyxFQUFTcVAsU0FBVTFWLEVBQU9nSyxXQUFXMGMsY0FBQUEsRUFBYyxHQUM5RCxHQUdHL2hCLElBQUFBLEVBQVEvRixFQUFLNk0sTUFBUSxJQUFPLElBR2xDc2dCLGFBQWFDLEVBQU90VyxVQUdwQnNXLEVBQU90VyxTQUFXOVEsWUFBVyxrQkFBTThGLEdBQUdtaEIsZUFBZWh0QixLQUFLZ1MsR0FBQUEsRUFBN0IsR0FBNkNsTSxFQUFBQSxJQUl2RWtXLEVBQUFBLEtBQ0h4VSxFQUFTd1EsT0FBT0UsT0FDaEIsU0FDQ3RTLFNBQUFBLEdBR082USxJQUFBQSxFQUFXN1EsRUFBTTRxQixrQ0FBakIvWixFQUVTLENBQUM3USxFQUFNNnFCLFFBQVM3cUIsRUFBTThxQixRQUFRMXNCLEtBQUtwRyxTQUFBQSxHQUFBQSxPQUFXNlksR0FBWTdZLEVBQVFBLENBQS9CQSxJQUY1QzZZLEVBQUFBLEVBQUFBLEVBQUFBLEdBRUNqSCxFQUZEaUgsRUFBQUEsR0FFSWhILEVBRkpnSCxFQUFBQSxHQUlBa2EsRUFBWTd0QixLQUFLOHRCLEtBQUs5dEIsS0FBS21NLElBQUlPLEdBQUsxTSxLQUFLbU0sSUFBSVEsR0FBS0QsRUFBSUMsR0FHNUR1QyxFQUFPNmUsZUFBZUYsRUFBWSxJQUc1QixJQUFFelksRUFBV2xHLEVBQU94RixNQUFwQixRQUNhLElBQWRta0IsR0FBbUJ6WSxFQUFTLElBQXNCLElBQWZ5WSxHQUFvQnpZLEVBQVMsSUFDbkV0UyxFQUFNeEMsZ0JBQUFBLEdBR1YsWUFDQSxJQXIzQkc0TyxLQUFBQSxPQUFTQSxFQUNUOGUsS0FBQUEsUUFBVSxLQUNWaEQsS0FBQUEsV0FBYSxLQUNiQyxLQUFBQSxZQUFjLEtBRWRHLEtBQUFBLFVBQVludUIsS0FBS211QixVQUFVbFMsS0FBS2pjLE1BQ2hDaWdCLEtBQUFBLFdBQWFqZ0IsS0FBS2lnQixXQUFXaEUsS0FBS2pjLE1BQ2xDcXVCLEtBQUFBLFlBQWNydUIsS0FBS3F1QixZQUFZcFMsS0FBS2pjLE1BQ3BDb3VCLEtBQUFBLFdBQWFwdUIsS0FBS291QixXQUFXblMsS0FBS2pjLEtBSXpDbXVCLEM3QnhCTyxtQzZCd0JQQSxTQUFVdG9CLEdBQ0YsSUFrQm1CbXJCLEVBbEJqQi9lLEVBQVdqUyxLQUFiLE9BQ0V5SCxFQUFhd0ssRUFBZnhLLFNBQ0U3SixFQUFrRGlJLEVBQXBEakksSUFBTzhGLEVBQTZDbUMsRUFBcERuQyxLQUFhdXRCLEVBQXVDcHJCLEVBQXBEb3JCLE9BQXFCQyxFQUErQnJyQixFQUFwRHFyQixRQUE4QkMsRUFBc0J0ckIsRUFBcERzckIsUUFBdUM1RyxFQUFhMWtCLEVBQXBEMGtCLFNBQ0FoTyxFQUFtQixZQUFUN1ksRUFDVjB0QixFQUFTN1UsR0FBVzNlLElBQVFvQyxLQUFLK3dCLFFBR3ZDLEtBQUlFLEdBQVVDLEdBQVdDLEdBQVc1RyxJQU0vQjNzQixFQVlMLEdBQUkyZSxFQUFTLENBSVgsSUFBTXNKLEVBQVVobUIsU0FBU3VxQixjQUN6QixHQUFJMXBCLEVBQVdtbEIsR0FBVSxDQUNqQixJQUFFc0IsRUFBYWxWLEVBQU83USxPQUFPbVcsVUFBN0IsU0FHRnNPLEdBQUFBLElBRmFwZSxFQUFTd1EsT0FBcEJDLE1BRWtCeFksR0FBUW1tQixFQUFTc0IsR0FDdkMsT0FHRixHQUFrQixVQUFkdGhCLEVBQU1qSSxLQUFtQjhCLEdBQVFtbUIsRUFBUyw4QkFDNUMsTUFvQ0osUUEvQnVCLENBQ3JCLFFBQ0EsWUFDQSxVQUNBLGFBQ0EsWUFFQSxJQUNBLElBQ0EsSUFDQSxJQUNBLElBQ0EsSUFDQSxJQUNBLElBQ0EsSUFDQSxJQUVBLElBQ0EsSUFDQSxJQUNBLElBQ0EsS0FJaUI5bEIsU0FBU25DLEtBQzFCaUksRUFBTXhDLGlCQUNOd0MsRUFBTXNWLG1CQUdBdmQsR0FDTixJQUFLLElBQ0wsSUFBSyxJQUNMLElBQUssSUFDTCxJQUFLLElBQ0wsSUFBSyxJQUNMLElBQUssSUFDTCxJQUFLLElBQ0wsSUFBSyxJQUNMLElBQUssSUFDTCxJQUFLLElBQ0V3ekIsSUFwRWNKLEVBcUVEaGdCLFNBQVNwVCxFQUFLLElBbkVwQ3FVLEVBQU9HLFlBQWVILEVBQU9xRyxTQUFXLEdBQU0wWSxHQXFFMUMsTUFFRixJQUFLLFFBQ0wsSUFBSyxJQUNFSSxHQUNIemlCLEdBQWVzRCxFQUFPbWQsY0FFeEIsTUFFRixJQUFLLFVBQ0huZCxFQUFPNmUsZUFBZSxJQUN0QixNQUVGLElBQUssWUFDSDdlLEVBQU9vZixlQUFlLElBQ3RCLE1BRUYsSUFBSyxJQUNFRCxJQUNIbmYsRUFBT3FLLE9BQVNySyxFQUFPcUssT0FFekIsTUFFRixJQUFLLGFBQ0hySyxFQUFPMmQsVUFDUCxNQUVGLElBQUssWUFDSDNkLEVBQU8wRixTQUNQLE1BRUYsSUFBSyxJQUNIMUYsRUFBT2QsV0FBVzNELFNBQ2xCLE1BRUYsSUFBSyxJQUNFNGpCLEdBQ0huZixFQUFPNGQsaUJBRVQsTUFFRixJQUFLLElBQ0g1ZCxFQUFPeVQsTUFBUXpULEVBQU95VCxLQVNkLFdBQVI5bkIsSUFBcUJxVSxFQUFPZCxXQUFXb2EsYUFBZXRaLEVBQU9kLFdBQVdDLFFBQzFFYSxFQUFPZCxXQUFXM0QsU0FJZnVqQixLQUFBQSxRQUFVbnpCLENBQUFBLE1BRVZtekIsS0FBQUEsUUFBVSxJQUtuQjlRLEc3QmpMTyx3QjZCaUxQQSxTQUFXcGEsR0FDVGlSLEdBQVNtSixXQUFXaGdCLEtBQUtELEtBQUtpUyxPQUFRcE0sRUFBQUEsSzdCbExqQyxLQXNnS29DLG9CQUFmeXJCLFdBQTZCQSxXQUErQixvQkFBWHZzQixPQUF5QkEsWUFBMkIsSUFBWCtnQixFQUFBQSxFQUF5QkEsRUFBQUEsRUFBeUIsb0JBQVR5TCxNQUF1QkEsS0FNdEwsSUFBSUMsR0FKSixTQUE4QkMsRUFBSWowQixHQUNqQyxPQUdxQyxTQUFVQSxFQUFRQyxHOEI1Z0t0REQsRUFBY0MsUUFJVixXQU1SLElBQUlpMEIsRUFBVSxhQUNWQyxFQUFnQixDQUFDLEVBQ2pCQyxFQUFvQixDQUFDLEVBQ3JCQyxFQUFzQixDQUFDLEVBUTNCLFNBQVNDLEVBQVVDLEVBQVdDLEdBRTVCRCxFQUFZQSxFQUFVaHpCLEtBQU9nekIsRUFBWSxDQUFDQSxHQUV0Q0UsSUFHQVIsRUFDQVMsRUFDQTF6QixFQUxBeXpCLEVBQWUsR0FDZmp3QixFQUFJK3ZCLEVBQVV4ekIsT0FDZDR6QixFQUFhbndCLEVBZVZBLElBUlB5dkIsRUFBSyxTQUFVUyxFQUFVRSxHQUNuQkEsRUFBYzd6QixRQUFRMHpCLEVBQWFsekIsS0FBS216QixLQUU1Q0MsR0FDaUJILEVBQVdDLEVBQUFBLEVBSXZCandCLEtBQ0xrd0IsRUFBV0gsRUFBVS92QixJQUdyQnhELEVBQUlvekIsRUFBa0JNLElBRXBCVCxFQUFHUyxFQUFVMXpCLElBS1hxekIsRUFBb0JLLEdBQVlMLEVBQW9CSyxJQUFhLElBQ25FbnpCLEtBQUsweUIsRUFVWCxVQUFTWSxFQUFRSCxFQUFVRSxHQUVyQixHQUFDRixFQUFELENBRUosSUFBSUksRUFBSVQsRUFBb0JLLEdBTTVCLEdBSEFOLEVBQWtCTSxHQUFZRSxFQUd6QkUsRUFHRUEsS0FBQUEsRUFBRS96QixRQUNQK3pCLEVBQUUsR0FBR0osRUFBVUUsR0FDZkUsRUFBRUMsT0FBTyxFQUFHLEdBVWhCLFVBQVNDLEVBQWlCeGtCLEVBQU1pa0IsR0FFMUJqa0IsRUFBSy9OLE9BQU0rTixFQUFPLENBQUN5a0IsUUFBU3prQixJQUc1QmlrQixFQUFhMXpCLFFBQVN5UCxFQUFLdUgsT0FBU21jLEdBQVNPLElBQzNDamtCLEVBQUt5a0IsU0FBV2YsR0FBUzFqQixFQVN4QjBrQixDQUFBQSxTQUFBQSxFQUFTMXJCLEVBQU1nckIsRUFBWWhrQixFQUFNMmtCLEdBQ3BDQyxJQU1BQyxFQUNBejBCLEVBUEF3MEIsRUFBTS95QixTQUNOaXpCLEVBQVE5a0IsRUFBSzhrQixNQUNiQyxHQUFZL2tCLEVBQUtnbEIsWUFBYyxHQUFLLEVBQ3BDQyxFQUFtQmpsQixFQUFLa2xCLFFBQVV4QixFQUNsQ3lCLEVBQVduc0IsRUFBSzZDLFFBQVEsWUFBYSxJQUNyQ3VwQixFQUFlcHNCLEVBQUs2QyxRQUFRLGNBQWUsSUFJL0M4b0IsRUFBV0EsR0FBWSxFQUVuQixpQkFBaUJsc0IsS0FBSzBzQixLQUV4Qi8wQixFQUFJdzBCLEVBQUl0dEIsY0FBYyxTQUNwQndqQixJQUFNLGFBQ1IxcUIsRUFBRW1qQixLQUFPNlIsR0FHVFAsRUFBZ0IsY0FBZXowQixJQUdWQSxFQUFFaTFCLFVBQ3JCUixFQUFnQixFQUNoQnowQixFQUFFMHFCLElBQU0sVUFDUjFxQixFQUFFazFCLEdBQUssVUFFQSxvQ0FBb0M3c0IsS0FBSzBzQixJQUVsRC8wQixFQUFJdzBCLEVBQUl0dEIsY0FBYyxRQUNwQm1OLElBQU0yZ0IsSUFHUmgxQixFQUFJdzBCLEVBQUl0dEIsY0FBYyxXQUNwQm1OLElBQU16TCxFQUNSNUksRUFBRTAwQixXQUFBQSxJQUFRQSxHQUE2QkEsR0FHekMxMEIsRUFBRWl1QixPQUFTanVCLEVBQUVrdUIsUUFBVWx1QixFQUFFbTFCLGFBQWUsU0FBVUMsR0FDNUNyZCxJQUFBQSxFQUFTcWQsRUFBRzl2QixLQUFLLEdBSXJCLEdBQUltdkIsRUFDRSxJQUNHejBCLEVBQUVxMUIsTUFBTUMsUUFBUW4xQixTQUFRNFgsRUFBUyxJQVN0Q0EsQ0FSQSxNQUFPMUcsR0FHTyxJQUFWQSxFQUFFa2tCLE9BQVl4ZCxFQUFTLElBSzNCQSxDQUFBQSxHQUFVLEtBQVZBLEdBS0V3YyxJQUhKQSxHQUFZLEdBR0dJLEVBQ05MLE9BQUFBLEVBQVMxckIsRUFBTWdyQixFQUFZaGtCLEVBQU0ya0IsUUFFckMsR0FBYSxXQUFUdjBCLEVBQUUwcUIsS0FBNEIsU0FBUjFxQixFQUFFazFCLEdBRWpDLE9BQU9sMUIsRUFBRTBxQixJQUFNLGFBSWpCa0osRUFBV2hyQixFQUFNbVAsRUFBUXFkLEVBQUdJLGlCQUFBQSxHQUFBQSxJQUkxQlgsRUFBaUJqc0IsRUFBTTVJLElBQWN3MEIsRUFBSTdJLEtBQUszaEIsWUFBWWhLLEVBU2hFLFVBQVN5MUIsRUFBVUMsRUFBTzlCLEVBQVloa0IsR0FJcEMsSUFHSXlqQixFQUNBenZCLEVBSkFtd0IsR0FGSjJCLEVBQVFBLEVBQU0vMEIsS0FBTyswQixFQUFRLENBQUNBLElBRVB2MUIsT0FDbkJrUixFQUFJMGlCLEVBQ0pDLEVBQWdCLEdBcUJmcHdCLElBaEJMeXZCLEVBQUssU0FBU3pxQixFQUFNbVAsRUFBUXlkLEdBTXRCemQsR0FKVSxLQUFWQSxHQUFlaWMsRUFBY3J6QixLQUFLaUksR0FJeEIsS0FBVm1QLEVBQWUsQ0FDYnlkLElBQUFBLEVBQ0MsT0FEaUJ4QixFQUFjcnpCLEtBQUtpSSxFQUFBQSxHQUkzQ21yQixHQUNpQkgsRUFBV0ksRUFBQUEsRUFJekJwd0IsRUFBRSxFQUFHQSxFQUFJeU4sRUFBR3pOLElBQUswd0IsRUFBU29CLEVBQU05eEIsR0FBSXl2QixFQUFJempCLEVBYS9DLFVBQVMrbEIsRUFBT0QsRUFBT0UsRUFBTUMsR0FDM0IsSUFBSS9CLEVBQ0Fsa0IsRUFTSixHQU5JZ21CLEdBQVFBLEVBQUtycUIsT0FBTXVvQixFQUFXOEIsR0FHbENobUIsR0FBUWtrQixFQUFXK0IsRUFBT0QsSUFBUyxDQUFDLEVBR2hDOUIsRUFBVSxDQUNSQSxHQUFBQSxLQUFZUCxFQUNkLEtBQU0sU0FFTkEsRUFBY08sSUFBQUEsQ0FJbEIsVUFBU2dDLEVBQU96bEIsRUFBU3FHLEdBQ3ZCK2UsRUFBVUMsR0FBTyxTQUFVMUIsR0FFekJJLEVBQWlCeGtCLEVBQU1va0IsR0FHbkIzakIsR0FDRitqQixFQUFpQixDQUFDQyxRQUFTaGtCLEVBQVM4RyxNQUFPVCxHQUFTc2QsR0FJdERDLEVBQVFILEVBQVVFLEVBQUFBLEdBQ2pCcGtCLEVBR0wsSUFBSUEsRUFBS21tQixjQUFlLE9BQU8sSUFBSTNsQixRQUFRMGxCLEdBQ3RDQSxHQWlEUCxRQXhDQUgsRUFBT3hsQixNQUFRLFNBQWU2bEIsRUFBTXBtQixHQU9sQyxPQUxBOGpCLEVBQVVzQyxHQUFNLFNBQVVuQyxHQUV4Qk8sRUFBaUJ4a0IsRUFBTWlrQixFQUFBQSxJQUdsQjhCLENBQUFBLEVBUVRBLEVBQU83RCxLQUFPLFNBQWNnQyxHQUMxQkcsRUFBUUgsRUFBVSxLQU9wQjZCLEVBQU9sTixNQUFRLFdBQ2I4SyxFQUFnQixDQUFDLEVBQ2pCQyxFQUFvQixDQUFDLEVBQ3JCQyxFQUFzQixDQUFDLENBQUQsRUFReEJrQyxFQUFPTSxVQUFZLFNBQW1CbkMsR0FDN0JBLE9BQUFBLEtBQVlQLENBQUFBLEVBS2RvQyxDQXJUY08sQ0FJYixFQUphQSxDOUJ5Z0tlN0MsQ0FBMUJqMEIsRUFBUyxDQUFFQyxRQUFTLENBQUMsSUFBaUNELEVBQU9DLE9BR3BEODJCLENBSmpCLEcrQnRnS2EsU0FBU0MsR0FBVzVmLEdBQ2pDLE9BQU8sSUFBSXBHLFNBQVEsU0FBQ0MsRUFBU3FHLEdBQzNCaWYsR0FBT25mLEVBQUssQ0FDVjZkLFFBQVNoa0IsRUFDVDhHLE1BQU9ULEdBQUFBLEdDb0NiLFVBQVMyZixHQUFvQi9oQixHQUN2QkEsSUFBUzFTLEtBQUtzUSxNQUFNb2tCLFlBQ3RCMTBCLEtBQUtzUSxNQUFNb2tCLFdBQUFBLEdBRVQxMEIsS0FBS3lNLE1BQU00RixTQUFXSyxJQUN4QjFTLEtBQUt5TSxNQUFNNEYsUUFBVUssRUFDckJ6RSxHQUFhaE8sS0FBS0QsS0FBTUEsS0FBS3lNLE1BQU9pRyxFQUFPLE9BQVMsU0FJeEQsS0FBTTdCLEdBQVEsQ0FDWm1CLFFBQ0UsSUFBTUMsRUFBU2pTLEtBR2ZvSyxHQUFZNkgsRUFBT3hLLFNBQVNDLFFBQVN1SyxFQUFPN1EsT0FBT2dLLFdBQVdrRixPQUFBQSxHQUc5RDJCLEVBQU85RSxRQUFRK0UsTUFBUUQsRUFBTzdRLE9BQU84USxNQUFNL0UsUUFHM0NvRCxHQUFldFEsS0FBS2dTLEdBR2Z2UixFQUFVcUUsT0FBTzR2QixPQVNwQjlqQixHQUFNdEMsTUFBTXRPLEtBQUtnUyxHQVJqQnVpQixHQUFXdmlCLEVBQU83USxPQUFPb2dCLEtBQUszUSxNQUFNbVcsS0FDakN0WSxNQUFLLFdBQ0ptQyxHQUFNdEMsTUFBTXRPLEtBQUtnUyxFQUFBQSxJQUVsQm1FLE9BQU9iLFNBQUFBLEdBQ050RCxFQUFPYSxNQUFNMkYsS0FBSyx1Q0FBd0NsRCxFQUFBQSxHQUFBQSxFQVFsRWhILFFBQUFBLElBQUFBLEVBQUFBLEtBQ1EwRCxFQUFTalMsS0FDVG9CLEVBQVM2USxFQUFPN1EsT0FBT3lQLE1BQ3JCQyxFQUE0QzFQLEVBQTlDMFAsUUFBVytYLEVBQW1Dem5CLEVBQTlDeW5CLGVBQThCK0wsb1hBRjlCM2lCLENBRThDN1EsRUFGOUM2USxHQUlGNUssRUFBUzRLLEVBQU94RixNQUFNckssYUFBYSxPQUNuQ2ttQixFQUFPLEdBRVA1bkIsRUFBUzJHLElBQ1hBLEVBQVM0SyxFQUFPeEYsTUFBTXJLLGFBQWE2UCxFQUFPN1EsT0FBT21ILFdBQVcrSCxNQUFNckcsSUFFbEVxZSxFQUFPclcsRUFBT3hGLE1BQU1ySyxhQUFhNlAsRUFBTzdRLE9BQU9tSCxXQUFXK0gsTUFBTWdZLE9BRWhFQSxFQWxFTixTQUFtQjFULEdBUVhpZ0IsSUFDQUMsRUFBUWxnQixFQUFJOVIsTUFESiwwREFHZCxPQUFPZ3lCLEdBQTBCLElBQWpCQSxFQUFNdjJCLE9BQWV1MkIsRUFBTSxHQUFLLElBdURyQ0MsQ0FsRWIsQ0FrRXVCMXRCLEdBRWIydEIsSUFBQUEsRUFBWTFNLEVBQU8sQ0FBRW5ZLEVBQUdtWSxHQUFTLENBQUMsRUFHcEN4WCxHQUNGaFQsT0FBT3lKLE9BQU9xdEIsRUFBYSxDQUN6QjlkLFVBQVUsRUFDVm1lLFVBQVUsSUFLUjNSLElBN0ZPMU8sRUE2RlAwTyxFQUFTRCxHQUFBQSxFQUFBQSxFQUFBQSxDQUNicUMsS0FBTXpULEVBQU83USxPQUFPc2tCLEtBQUt0VSxPQUN6QitULFNBQVVsVCxFQUFPa1QsU0FDakI3SSxNQUFPckssRUFBT3FLLE1BQ2Q0WSxRQUFTLFFBQ1R2cEIsYUFBYzNMLEtBQUtvQixPQUFPK1AsV0FBVzZVLFdBRWxDZ1AsR0FDQUosSUFHQzNxQixFQXZHSnZKLEVBRFdrVSxFQXdHTXZOLEdBdEdaLEtBR0wzRyxFQUFVOEQsT0FBT29RLElBQ1pBLEVBSUZBLEVBQUk5UixNQURHLG1DQUNZcVEsT0FBT2dpQixHQUFLdmdCLEVBZ0c5QnFTLEVBQVMzaEIsR0FBYyxVQUN2Qm1OLEVBQU1PLEdBQU9mLEVBQU83USxPQUFPb2dCLEtBQUszUSxNQUFNb1csT0FBUWhkLEVBQUlxWixHQWN4RCxHQWJBMkQsRUFBT3hlLGFBQWEsTUFBT2dLLEdBQzNCd1UsRUFBT3hlLGFBQWEsa0JBQW1CLElBQ3ZDd2UsRUFBT3hlLGFBQ0wsUUFDQSxDQUFDLFdBQVksYUFBYyxxQkFBc0Isa0JBQW1CLGdCQUFpQixhQUFhNlEsS0FBSyxPQUlwRzVZLEVBQVNtb0IsSUFDWjVCLEVBQU94ZSxhQUFhLGlCQUFrQm9nQixHQUlwQy9YLElBQVkxUCxFQUFPd25CLGVBQ3JCM0IsRUFBT3hlLGFBQWEsY0FBZXdKLEVBQU9vVixRQUMxQ3BWLEVBQU94RixNQUFRdkQsR0FBZStkLEVBQVFoVixFQUFPeEYsV0FDeEMsQ0FDTCxJQUFNL0UsRUFBVXBDLEdBQWMsTUFBTyxDQUNuQzBFLE1BQU9pSSxFQUFPN1EsT0FBT2dLLFdBQVdnYyxlQUNoQyxjQUFlblYsRUFBT29WLFNBRXhCM2YsRUFBUVUsWUFBWTZlLEdBQ3BCaFYsRUFBT3hGLE1BQVF2RCxHQUFleEIsRUFBU3VLLEVBQU94RixNQUkzQ3JMLENBQUFBLEVBQU93bkIsZ0JBQ1ZqVSxHQUFNM0IsR0FBT2YsRUFBTzdRLE9BQU9vZ0IsS0FBSzNRLE1BQU1oRixJQUFLNEcsSUFBTS9ELE1BQU13RyxTQUFBQSxJQUNqRHhVLEVBQVN3VSxJQUFjQSxFQUFTa2dCLGVBS3BDdHBCLEdBQUc4Z0IsVUFBVTNzQixLQUFLZ1MsRUFBUWlELEVBQVNrZ0IsZUFBZWhmLE9BQU0sa0JBTTVEbkUsRUFBTzNCLE1BQVEsSUFBSXZMLE9BQU80dkIsTUFBTVUsT0FBT3BPLEVBQVEsQ0FDN0M3QixVQUFXblQsRUFBTzdRLE9BQU9na0IsVUFDekI5SSxNQUFPckssRUFBT3FLLFFBR2hCckssRUFBT3hGLE1BQU00RixRQUFBQSxFQUNiSixFQUFPeEYsTUFBTTJGLFlBQWMsRUFHdkJILEVBQU8vRSxVQUFVcEIsSUFDbkJtRyxFQUFPM0IsTUFBTWdsQixtQkFJZnJqQixFQUFPeEYsTUFBTWlHLEtBQU8sa0JBQ2xCK2hCLEdBQW9CeDBCLEtBQUtnUyxHQUFBQSxHQUNsQkEsRUFBTzNCLE1BQU1vQyxNQUZGLEVBS3BCVCxFQUFPeEYsTUFBTWdMLE1BQVEsa0JBQ25CZ2QsR0FBb0J4MEIsS0FBS2dTLEdBQUFBLEdBQ2xCQSxFQUFPM0IsTUFBTW1ILE9BRkQsRUFLckJ4RixFQUFPeEYsTUFBTThvQixLQUFPLFdBQ2xCdGpCLEVBQU93RixRQUNQeEYsRUFBT0csWUFBYyxHQUluQixJQUFFQSxFQUFnQkgsRUFBT3hGLE1BQXpCLFlBQ0ozTyxPQUFPQyxlQUFla1UsRUFBT3hGLE1BQU8sY0FBZSxDQUNqRG5KLElBQUcsa0JBQ004TyxDQUROLEVBR0h0USxJQUFJMFUsR0FJSSxJQUFFbEcsRUFBaUMyQixFQUFuQyxNQUFTeEYsRUFBMEJ3RixFQUFuQyxNQUFnQkksRUFBbUJKLEVBQW5DLE9BQXdCa0csRUFBV2xHLEVBQW5DLE9BQ0F1akIsRUFBZW5qQixJQUFXL0IsRUFBTW9rQixVQUd0Q2pvQixFQUFNd1IsU0FBQUEsRUFDTmhRLEdBQWFoTyxLQUFLZ1MsRUFBUXhGLEVBQU8sV0FHakMrQixRQUFRQyxRQUFRK21CLEdBQWdCbGxCLEVBQU1tbEIsVUFBVSxJQUU3Qy9tQixNQUFLLGtCQUFNNEIsRUFBTW9sQixlQUFlbGYsRUFBM0IsSUFFTDlILE1BQUssa0JBQU04bUIsR0FBZ0JsbEIsRUFBTW1ILE9BQTVCLElBRUwvSSxNQUFLLGtCQUFNOG1CLEdBQWdCbGxCLEVBQU1tbEIsVUFBVXRkLEVBQXRDLElBQ0wvQixPQUFNLGtCQU9UbEUsSUFBQUEsRUFBUUQsRUFBTzdRLE9BQU84USxNQUFNeVQsU0FDaEM3bkIsT0FBT0MsZUFBZWtVLEVBQU94RixNQUFPLGVBQWdCLENBQ2xEbkosSUFBRyxrQkFDTTRPLENBRE4sRUFHSHBRLElBQUlxQyxHQUNGOE4sRUFBTzNCLE1BQ0pxbEIsZ0JBQWdCeHhCLEdBQ2hCdUssTUFBSyxXQUNKd0QsRUFBUS9OLEVBQ1I4SixHQUFhaE8sS0FBS2dTLEVBQVFBLEVBQU94RixNQUFPLGlCQUV6QzJKLE9BQU0sV0FFTG5FLEVBQU85RSxRQUFRK0UsTUFBUSxDQUFDLFNBTTVCLElBQUVpRyxFQUFXbEcsRUFBTzdRLE9BQXBCLE9BQ0p0RCxPQUFPQyxlQUFla1UsRUFBT3hGLE1BQU8sU0FBVSxDQUM1Q25KLElBQUcsa0JBQ002VSxDQUROLEVBR0hyVyxJQUFJcUMsR0FDRjhOLEVBQU8zQixNQUFNbWxCLFVBQVV0eEIsR0FBT3VLLE1BQUssV0FDakN5SixFQUFTaFUsRUFDVDhKLEdBQWFoTyxLQUFLZ1MsRUFBUUEsRUFBT3hGLE1BQU8sc0JBTTFDLElBQUU2UCxFQUFVckssRUFBTzdRLE9BQW5CLE1BQ0p0RCxPQUFPQyxlQUFla1UsRUFBT3hGLE1BQU8sUUFBUyxDQUMzQ25KLElBQUcsa0JBQ01nWixDQUROLEVBR0h4YSxJQUFJcUMsR0FDSXFKLElBQUFBLElBQVM5TSxFQUFXeUQsSUFBU0EsRUFFbkM4TixFQUFPM0IsTUFBTW1sQixVQUFVam9CLEVBQVMsRUFBSXlFLEVBQU83USxPQUFPK1csUUFBUXpKLE1BQUssV0FDN0Q0TixFQUFROU8sRUFDUlMsR0FBYWhPLEtBQUtnUyxFQUFRQSxFQUFPeEYsTUFBTyxzQkFxQjFDbXBCLElBQUFBLEVBZkVsUSxFQUFTelQsRUFBTzdRLE9BQWxCc2tCLEtBQ0o1bkIsT0FBT0MsZUFBZWtVLEVBQU94RixNQUFPLE9BQVEsQ0FDMUNuSixJQUFHLGtCQUNNb2lCLENBRE4sRUFHSDVqQixJQUFJcUMsR0FDRixJQUFNcUosRUFBUzlNLEVBQVd5RCxHQUFTQSxFQUFROE4sRUFBTzdRLE9BQU9za0IsS0FBS3RVLE9BRTlEYSxFQUFPM0IsTUFBTXVsQixRQUFRcm9CLEdBQVFrQixNQUFLLFdBQ2hDZ1gsRUFBT2xZLENBQUFBLEdBQUFBLElBT2J5RSxFQUFPM0IsTUFDSndsQixjQUNBcG5CLE1BQU03USxTQUFBQSxHQUNMKzNCLEVBQWEvM0IsRUFDYmlaLEdBQVNpSyxlQUFlOWdCLEtBQUtnUyxFQUFBQSxJQUU5Qm1FLE9BQU9iLFNBQUFBLEdBQ052VixFQUFLOFMsTUFBTTJGLEtBQUtsRCxFQUFBQSxJQUdwQnpYLE9BQU9DLGVBQWVrVSxFQUFPeEYsTUFBTyxhQUFjLENBQ2hEbkosSUFBRyxrQkFDTXN5QixDQUROLElBTUw5M0IsT0FBT0MsZUFBZWtVLEVBQU94RixNQUFPLFFBQVMsQ0FDM0NuSixJQUFHLGtCQUNNMk8sRUFBT0csY0FBZ0JILEVBQU9xRyxRQURwQyxJQU1MOUosUUFBUW9ZLElBQUksQ0FBQzNVLEVBQU8zQixNQUFNeWxCLGdCQUFpQjlqQixFQUFPM0IsTUFBTTBsQixtQkFBbUJ0bkIsTUFBTXVuQixTQUFBQSxHQUMvRSxRQUF3QkEsRUFBeEIsR0FBT3Z6QixFQUFQLEtBQWNxTixFQUFkLEtBQ0FrQyxFQUFPM0IsTUFBTVIsTUFBUTBCLEdBQWlCOU8sRUFBT3FOLEdBQzdDUSxHQUFldFEsS0FBS0QsRUFBQUEsSUFJdEJpUyxFQUFPM0IsTUFBTTRsQixhQUFhamtCLEVBQU83USxPQUFPZ2tCLFdBQVcxVyxNQUFNeW5CLFNBQUFBLEdBQ3ZEbGtCLEVBQU83USxPQUFPZ2tCLFVBQVkrUSxDQUFBQSxJQUk1QmxrQixFQUFPM0IsTUFBTThsQixnQkFBZ0IxbkIsTUFBTW9GLFNBQUFBLEdBQ2pDN0IsRUFBTzdRLE9BQU8wUyxNQUFRQSxFQUN0QmhJLEdBQUc2Z0IsU0FBUzFzQixLQUFLRCxFQUFBQSxJQUluQmlTLEVBQU8zQixNQUFNK2xCLGlCQUFpQjNuQixNQUFNN1EsU0FBQUEsR0FDbEN1VSxFQUFjdlUsRUFDZG9RLEdBQWFoTyxLQUFLZ1MsRUFBUUEsRUFBT3hGLE1BQU8saUJBSTFDd0YsRUFBTzNCLE1BQU1nbUIsY0FBYzVuQixNQUFNN1EsU0FBQUEsR0FDL0JvVSxFQUFPeEYsTUFBTTZMLFNBQVd6YSxFQUN4Qm9RLEdBQWFoTyxLQUFLZ1MsRUFBUUEsRUFBT3hGLE1BQU8scUJBSTFDd0YsRUFBTzNCLE1BQU1pbUIsZ0JBQWdCN25CLE1BQU0wUSxTQUFBQSxHQUNqQ25OLEVBQU94RixNQUFNRSxXQUFheVMsRUFDMUJySCxHQUFTL0YsTUFBTS9SLEtBQUtnUyxFQUFBQSxJQUd0QkEsRUFBTzNCLE1BQU0xQyxHQUFHLGFBQWEsWUFBVSxRQUFQaVgsS0FDeEIyUixRQUQrQixZQUNYdnlCLEtBQUs4Z0IsU0FBQUEsR0FBQUEsT25CL1I5QixTQUFtQjFkLEdBQ3hCLElBQU1vdkIsRUFBVzUyQixTQUFTK2lCLHlCQUNwQjNoQixFQUFVcEIsU0FBU3lGLGNBQWMsT0FHdkMsT0FGQW14QixFQUFTcnVCLFlBQVluSCxHQUNyQkEsRUFBUXdTLFVBQVlwTSxFQUNib3ZCLEVBQVNDLFdBQVcvdEIsU21CMFJnQmd1QixDbkIvUnRDLENtQitSZ0Q1UixFQUFJcmMsS0FBdEJxYyxJQUMvQmhOLEdBQVNvTSxXQUFXbGtCLEtBQUtnUyxFQUFRdWtCLEVBQUFBLElBR25DdmtCLEVBQU8zQixNQUFNMUMsR0FBRyxVQUFVLFdBRXhCcUUsRUFBTzNCLE1BQU1zbUIsWUFBWWxvQixNQUFNMkQsU0FBQUEsR0FDN0JvaUIsR0FBb0J4MEIsS0FBS2dTLEdBQVNJLEdBQzdCQSxHQUNIcEUsR0FBYWhPLEtBQUtnUyxFQUFRQSxFQUFPeEYsTUFBTyxjQUl4Qy9MLEVBQVd1UixFQUFPM0IsTUFBTXJQLFVBQVlnUixFQUFPL0UsVUFBVXBCLElBQ3pDbUcsRUFBTzNCLE1BQU1yUCxRQUlyQndILGFBQWEsWUFBYSxNQUlwQ3dKLEVBQU8zQixNQUFNMUMsR0FBRyxlQUFlLFdBQzdCSyxHQUFhaE8sS0FBS2dTLEVBQVFBLEVBQU94RixNQUFPLGNBRzFDd0YsRUFBTzNCLE1BQU0xQyxHQUFHLGFBQWEsV0FDM0JLLEdBQWFoTyxLQUFLZ1MsRUFBUUEsRUFBT3hGLE1BQU8sY0FHMUN3RixFQUFPM0IsTUFBTTFDLEdBQUcsUUFBUSxXQUN0QjZtQixHQUFvQngwQixLQUFLZ1MsR0FBQUEsR0FDekJoRSxHQUFhaE8sS0FBS2dTLEVBQVFBLEVBQU94RixNQUFPLGNBRzFDd0YsRUFBTzNCLE1BQU0xQyxHQUFHLFNBQVMsV0FDdkI2bUIsR0FBb0J4MEIsS0FBS2dTLEdBQUFBLEVBQVEsSUFHbkNBLEVBQU8zQixNQUFNMUMsR0FBRyxjQUFla0ksU0FBQUEsR0FDN0I3RCxFQUFPeEYsTUFBTXdSLFNBQUFBLEVBQ2I3TCxFQUFjMEQsRUFBSytnQixRQUNuQjVvQixHQUFhaE8sS0FBS2dTLEVBQVFBLEVBQU94RixNQUFPLGlCQUcxQ3dGLEVBQU8zQixNQUFNMUMsR0FBRyxZQUFha0ksU0FBQUEsR0FDM0I3RCxFQUFPeEYsTUFBTXFRLFNBQVdoSCxFQUFLaUgsUUFDN0I5TyxHQUFhaE8sS0FBS2dTLEVBQVFBLEVBQU94RixNQUFPLFlBR0wsSUFBL0J1RSxTQUFTOEUsRUFBS2lILFFBQVMsS0FDekI5TyxHQUFhaE8sS0FBS2dTLEVBQVFBLEVBQU94RixNQUFPLGtCQUsxQ3dGLEVBQU8zQixNQUFNZ21CLGNBQWM1bkIsTUFBTTdRLFNBQUFBLEdBQzNCQSxJQUFVb1UsRUFBT3hGLE1BQU02TCxXQUN6QnJHLEVBQU94RixNQUFNNkwsU0FBV3phLEVBQ3hCb1EsR0FBYWhPLEtBQUtnUyxFQUFRQSxFQUFPeEYsTUFBTyx5QkFLOUN3RixFQUFPM0IsTUFBTTFDLEdBQUcsVUFBVSxXQUN4QnFFLEVBQU94RixNQUFNd1IsU0FBQUEsRUFDYmhRLEdBQWFoTyxLQUFLZ1MsRUFBUUEsRUFBT3hGLE1BQU8sYUFHMUN3RixFQUFPM0IsTUFBTTFDLEdBQUcsU0FBUyxXQUN2QnFFLEVBQU94RixNQUFNNEYsUUFBQUEsRUFDYnBFLEdBQWFoTyxLQUFLZ1MsRUFBUUEsRUFBT3hGLE1BQU8sWUFHMUN3RixFQUFPM0IsTUFBTTFDLEdBQUcsU0FBVU0sU0FBQUEsR0FDeEIrRCxFQUFPeEYsTUFBTThJLE1BQVFySCxFQUNyQkQsR0FBYWhPLEtBQUtnUyxFQUFRQSxFQUFPeEYsTUFBTyxZQUl0Q3JMLEVBQU93bkIsZ0JBQ1Q1aUIsWUFBVyxrQkFBTThGLEdBQUcyZ0IsTUFBTXhzQixLQUFLZ1MsRUFBcEIsR0FBNkIsS0N0WjlDLFNBQVN3aUIsR0FBb0IvaEIsR0FDdkJBLElBQVMxUyxLQUFLc1EsTUFBTW9rQixZQUN0QjEwQixLQUFLc1EsTUFBTW9rQixXQUFBQSxHQUVUMTBCLEtBQUt5TSxNQUFNNEYsU0FBV0ssSUFDeEIxUyxLQUFLeU0sTUFBTTRGLFFBQVVLLEVBQ3JCekUsR0FBYWhPLEtBQUtELEtBQU1BLEtBQUt5TSxNQUFPaUcsRUFBTyxPQUFTLFNBSXhELFVBQVNva0IsR0FBUTExQixHQUNYQSxPQUFBQSxFQUFPOG5CLFNBQ0YsbUNBR3dCLFVBQTdCbmtCLE9BQU9rUyxTQUFTd00sU0FDWCwrQkFPWCxLQUFNOVAsR0FBVSxDQUNkM0IsUUFBQUEsSUFBQUEsRUFBQUEsS0FLRSxHQUhBNUgsR0FBWXBLLEtBQUt5SCxTQUFTQyxRQUFTMUgsS0FBS29CLE9BQU9nSyxXQUFXa0YsT0FBQUEsR0FHdEQ1UCxFQUFVcUUsT0FBT2d5QixLQUFPcjJCLEVBQVlxRSxPQUFPZ3lCLEdBQUcxQixRQUNoRDFoQixHQUFRcEYsTUFBTXRPLEtBQUtELFVBQ2QsQ0FFTCxJQUFNdU4sRUFBV3hJLE9BQU9peUIsd0JBR3hCanlCLE9BQU9peUIsd0JBQTBCLFdBRTNCdDJCLEVBQVk2TSxJQUNkQSxJQUdGb0csR0FBUXBGLE1BQU10TyxLQUFLRCxFQUFBQSxFQUlyQncwQixHQUFXeDBCLEtBQUtvQixPQUFPb2dCLEtBQUs3TixRQUFRcVQsS0FBSzVRLE9BQU9iLFNBQUFBLEdBQzlDdlYsRUFBSzhTLE1BQU0yRixLQUFLLDZCQUE4QmxELEVBQUFBLEdBQUFBLENBQUFBLEVBTXBEMGhCLFNBQVNDLEdBQUFBLElBQUFBLEVBQUFBLEtBR1B2aUIsR0FGWTNCLEdBQU9oVCxLQUFLb0IsT0FBT29nQixLQUFLN04sUUFBUTlILElBQUtxckIsSUFHOUN4b0IsTUFBTW9ILFNBQUFBLEdBQ0wsR0FBSXBWLEVBQVVvVixHQUFPLENBQ2IsSUFBRWhDLEVBQXlCZ0MsRUFBM0IsTUFBUy9GLEVBQWtCK0YsRUFBM0IsT0FBaUJwVCxFQUFVb1QsRUFBM0IsTUFHTjlWLEVBQUtvQixPQUFPMFMsTUFBUUEsRUFDcEJoSSxHQUFHNmdCLFNBQVMxc0IsS0FBS0QsR0FHWnNRLEVBQUFBLE1BQU1SLE1BQVEwQixHQUFpQjlPLEVBQU9xTixFQUc3Q1EsQ0FBQUEsR0FBZXRRLEtBQUtELEVBQUFBLElBRXJCb1csT0FBTSxXQUVMN0YsR0FBZXRRLEtBQUtELEVBQUFBLEdBQUFBLEVBSzFCdU8sUUFDUTBELElBQUFBLEVBQVNqUyxLQUNUb0IsRUFBUzZRLEVBQU83USxPQUFPdVMsUUFFdkJ3akIsRUFBWWxsQixFQUFPeEYsT0FBU3dGLEVBQU94RixNQUFNckssYUFBYSxNQUM1RCxHQUFLMUIsRUFBU3kyQixLQUFjQSxFQUFVanlCLFdBQVcsWUFBakQsQ0FLSW1DLElBQUFBLEVBQVM0SyxFQUFPeEYsTUFBTXJLLGFBQWEsT0FHbkMxQixFQUFTMkcsS0FDWEEsRUFBUzRLLEVBQU94RixNQUFNckssYUFBYXBDLEtBQUtvQixPQUFPbUgsV0FBVytILE1BQU1yRyxLQUlsRSxJQTFHYTJLLEVBMEdQc2lCLEVBekdKeDJCLEVBRFdrVSxFQTBHV3ZOLEdBeEdqQixLQUlGdU4sRUFBSTlSLE1BREcsZ0VBQ1lxUSxPQUFPZ2lCLEdBQUt2Z0IsRUF1RzlCOUosRUFBWXhGLEdBQWMsTUFBTyxDQUFFMkUsR0FBQUEsR0FBQUEsT0FGbkJnSSxFQUFPdkcsU0FFWXpCLEtBQUFBLE9wQnJIdkJsSCxLQUFLNGUsTUFBc0IsSUFBaEI1ZSxLQUFLNmUsV29CcUhXLGNBQWV4Z0IsRUFBT3duQixlQUFpQjNXLEVBQU9vVixZQUFBQSxJQUl2RmptQixHQUhKNlEsRUFBT3hGLE1BQVF2RCxHQUFlNEIsRUFBV21ILEVBQU94RixPQUc1Q3JMLEVBQU93bkIsZUFBZ0IsQ0FDbkJ3TyxJQUFBQSxFQUFhLzBCLFNBQUFBLEdBQUFBLE1BQUFBLDBCQUFBQSxPQUFnQzYwQixFQUFoQzcwQixLQUFBQSxPQUEyQ0EsRUFBM0NBLGNBQUFBLEVBR25CMnBCLEdBQVVvTCxFQUFVLFVBQVcsS0FDNUJoaEIsT0FBTSxrQkFBTTRWLEdBQVVvTCxFQUFVLE1BQU8sSUFBakMsSUFDTmhoQixPQUFNLGtCQUFNNFYsR0FBVW9MLEVBQVUsTUFBMUIsSUFDTjFvQixNQUFNd2QsU0FBQUEsR0FBQUEsT0FBVXBnQixHQUFHOGdCLFVBQVUzc0IsS0FBS2dTLEVBQVFpYSxFQUFNelosSUFBMUN5WixJQUNOeGQsTUFBTStELFNBQUFBLEdBRUFBLEVBQUkxUyxTQUFTLFlBQ2hCa1MsRUFBT3hLLFNBQVM0ZixPQUFPNWxCLE1BQU11ckIsZUFBaUIsWUFHakQ1VyxPQUFNLGNBS1huRSxDQUFBQSxFQUFPM0IsTUFBUSxJQUFJdkwsT0FBT2d5QixHQUFHMUIsT0FBT3BqQixFQUFPeEYsTUFBTyxDQUNoRHlxQixRQUFBQSxFQUNBaGdCLEtBQU00ZixHQUFRMTFCLEdBQ2RpMkIsV0FBWWx3QixFQUNWLENBQUMsRUFDRCxDQUVFZ2UsU0FBVWxULEVBQU83USxPQUFPK2pCLFNBQVcsRUFBSSxFQUV2Q21TLEdBQUlybEIsRUFBTzdRLE9BQU9rMkIsR0FFbEJ4Z0IsU0FBVTdFLEVBQU8vRSxVQUFVcEIsSUFBTTFLLEVBQU93bkIsZUFBaUIsRUFBSSxFQUU3RDJPLFVBQVcsRUFFWDVyQixZQUFjc0csRUFBTzdRLE9BQU8rUCxXQUFXNlUsVUFBZ0IsRUFBSixFQUVuRHdSLGVBQWdCdmxCLEVBQU84RixTQUFTM0csT0FBUyxFQUFJLEVBQzdDcW1CLGFBQWN4bEIsRUFBTzdRLE9BQU8yVyxTQUFTeUgsU0FFckNrWSxnQkFBaUIzeUIsT0FBU0EsT0FBT2tTLFNBQVNzSyxLQUFPLE1BRW5EbmdCLEdBRUZtRSxPQUFRLENBQ05veUIsUUFBUTl4QixHQUVOLElBQUtvTSxFQUFPeEYsTUFBTThJLE1BQU8sQ0FDdkIsSUFBTW9lLEVBQU85dEIsRUFBTWlRLEtBRWI4aEIsRUFDSixDQUNFLEVBQUcsdU9BQ0gsRUFBRyx1SEFDSCxJQUFLLHFJQUNMLElBQUssdUZBQ0EsNEZBQ0xqRSxJQUFTLDJCQUViMWhCLEVBQU94RixNQUFNOEksTUFBUSxDQUFFb2UsS0FBQUEsRUFBTWlFLFFBQUFBLEdBRTdCM3BCLEdBQWFoTyxLQUFLZ1MsRUFBUUEsRUFBT3hGLE1BQU8sV0FHNUNvckIscUJBQXFCaHlCLEdBRW5CLElBQU1peUIsRUFBV2p5QixFQUFNOUQsT0FHdkJrUSxFQUFPeEYsTUFBTStGLGFBQWVzbEIsRUFBU0Msa0JBRXJDOXBCLEdBQWFoTyxLQUFLZ1MsRUFBUUEsRUFBT3hGLE1BQU8sZUFFMUN1ckIsUUFBUW55QixHQUVGbkYsSUFBQUEsRUFBWXVSLEVBQU94RixNQUFNaUcsTUFBekJoUyxDQUlKLElBQU1vM0IsRUFBV2p5QixFQUFNOUQsT0FHdkI0UixHQUFRc2pCLFNBQVNoM0IsS0FBS2dTLEVBQVFpbEIsR0FHOUJqbEIsRUFBT3hGLE1BQU1pRyxLQUFPLFdBQ2xCK2hCLEdBQW9CeDBCLEtBQUtnUyxHQUFBQSxHQUN6QjZsQixFQUFTRyxXQUFBQSxFQUdYaG1CLEVBQU94RixNQUFNZ0wsTUFBUSxXQUNuQmdkLEdBQW9CeDBCLEtBQUtnUyxHQUFBQSxHQUN6QjZsQixFQUFTSSxZQUFBQSxFQUdYam1CLEVBQU94RixNQUFNOG9CLEtBQU8sV0FDbEJ1QyxFQUFTSyxXQUFBQSxFQUdYbG1CLEVBQU94RixNQUFNNkwsU0FBV3dmLEVBQVN4QixjQUNqQ3JrQixFQUFPeEYsTUFBTTRGLFFBQUFBLEVBR2JKLEVBQU94RixNQUFNMkYsWUFBYyxFQUMzQnRVLE9BQU9DLGVBQWVrVSxFQUFPeEYsTUFBTyxjQUFlLENBQ2pEbkosSUFBRyxrQkFDTWtCLE9BQU9zekIsRUFBU3pCLGlCQUR0QixFQUdIdjBCLElBQUkwVSxHQUVFdkUsRUFBT0ksU0FBV0osRUFBTzNCLE1BQU1va0IsV0FDakN6aUIsRUFBTzNCLE1BQU11SCxPQUlmNUYsRUFBT3hGLE1BQU13UixTQUFBQSxFQUNiaFEsR0FBYWhPLEtBQUtnUyxFQUFRQSxFQUFPeEYsTUFBTyxXQUd4Q3FyQixFQUFTM0gsT0FBTzNaLEVBQUFBLElBS3BCMVksT0FBT0MsZUFBZWtVLEVBQU94RixNQUFPLGVBQWdCLENBQ2xEbkosSUFBRyxrQkFDTXcwQixFQUFTQyxpQkFEZixFQUdIajJCLElBQUlxQyxHQUNGMnpCLEVBQVNuQyxnQkFBZ0J4eEIsRUFBQUEsSUFLekIsSUFBRWdVLEVBQVdsRyxFQUFPN1EsT0FBcEIsT0FDSnRELE9BQU9DLGVBQWVrVSxFQUFPeEYsTUFBTyxTQUFVLENBQzVDbkosSUFBRyxrQkFDTTZVLENBRE4sRUFHSHJXLElBQUlxQyxHQUNGZ1UsRUFBU2hVLEVBQ1QyekIsRUFBU3JDLFVBQW1CLElBQVR0ZCxHQUNuQmxLLEdBQWFoTyxLQUFLZ1MsRUFBUUEsRUFBT3hGLE1BQU8sbUJBS3hDLElBQUU2UCxFQUFVckssRUFBTzdRLE9BQW5CLE1BQ0p0RCxPQUFPQyxlQUFla1UsRUFBT3hGLE1BQU8sUUFBUyxDQUMzQ25KLElBQUcsa0JBQ01nWixDQUROLEVBR0h4YSxJQUFJcUMsR0FDSXFKLElBQUFBLEVBQVM5TSxFQUFXeUQsR0FBU0EsRUFBUW1ZLEVBQzNDQSxFQUFROU8sRUFDUnNxQixFQUFTdHFCLEVBQVMsT0FBUyxZQUMzQnNxQixFQUFTckMsVUFBbUIsSUFBVHRkLEdBQ25CbEssR0FBYWhPLEtBQUtnUyxFQUFRQSxFQUFPeEYsTUFBTyxtQkFLNUMzTyxPQUFPQyxlQUFla1UsRUFBT3hGLE1BQU8sYUFBYyxDQUNoRG5KLElBQUcsa0JBQ013MEIsRUFBU2hDLGFBRGYsSUFNTGg0QixPQUFPQyxlQUFla1UsRUFBT3hGLE1BQU8sUUFBUyxDQUMzQ25KLElBQUcsa0JBQ00yTyxFQUFPRyxjQUFnQkgsRUFBT3FHLFFBRHBDLElBTUwsSUFBTThmLEVBQVNOLEVBQVNPLDRCQUV4QnBtQixFQUFPOUUsUUFBUStFLE1BQVFrbUIsRUFBT3Y1QixRQUFRd0QsU0FBQUEsR0FBQUEsT0FBTTRQLEVBQU83USxPQUFPOFEsTUFBTS9FLFFBQVFwTixTQUFTc0MsRUFBM0NBLElBR2xDNFAsRUFBTy9FLFVBQVVwQixJQUFNMUssRUFBT3duQixnQkFDaEMzVyxFQUFPeEYsTUFBTWhFLGFBQWEsWUFBYSxHQUd6Q3dGLEdBQWFoTyxLQUFLZ1MsRUFBUUEsRUFBT3hGLE1BQU8sY0FDeEN3QixHQUFhaE8sS0FBS2dTLEVBQVFBLEVBQU94RixNQUFPLGtCQUd4QzZyQixjQUFjcm1CLEVBQU9tYixPQUFPbUwsV0FHNUJ0bUIsRUFBT21iLE9BQU9tTCxVQUFZQyxhQUFZLFdBRXBDdm1CLEVBQU94RixNQUFNcVEsU0FBV2diLEVBQVNXLDBCQUdDLE9BQTlCeG1CLEVBQU94RixNQUFNaXNCLGNBQXlCem1CLEVBQU94RixNQUFNaXNCLGFBQWV6bUIsRUFBT3hGLE1BQU1xUSxXQUNqRjdPLEdBQWFoTyxLQUFLZ1MsRUFBUUEsRUFBT3hGLE1BQU8sWUFJMUN3RixFQUFPeEYsTUFBTWlzQixhQUFlem1CLEVBQU94RixNQUFNcVEsU0FHWCxJQUExQjdLLEVBQU94RixNQUFNcVEsV0FDZndiLGNBQWNybUIsRUFBT21iLE9BQU9tTCxXQUc1QnRxQixHQUFhaE8sS0FBS2dTLEVBQVFBLEVBQU94RixNQUFPLHFCQUV6QyxLQUdDckwsRUFBT3duQixnQkFDVDVpQixZQUFXLGtCQUFNOEYsR0FBRzJnQixNQUFNeHNCLEtBQUtnUyxFQUFwQixHQUE2QixHQTNJbEMsQ0EySWtDLEVBRzVDMG1CLGNBQWM5eUIsR0FFWixJQUFNaXlCLEVBQVdqeUIsRUFBTTlELE9Bb0JmOEQsT0FqQlJ5eUIsY0FBY3JtQixFQUFPbWIsT0FBTzVGLFNBRWJ2VixFQUFPeEYsTUFBTXdSLFNBQVcsQ0FBQyxFQUFHLEdBQUdsZSxTQUFTOEYsRUFBTWlRLFFBSTNEN0QsRUFBT3hGLE1BQU13UixTQUFBQSxFQUNiaFEsR0FBYWhPLEtBQUtnUyxFQUFRQSxFQUFPeEYsTUFBTyxXQVVsQzVHLEVBQU1pUSxNQUNaLEtBQU0sRUFFSjdILEdBQWFoTyxLQUFLZ1MsRUFBUUEsRUFBT3hGLE1BQU8sY0FHeEN3RixFQUFPeEYsTUFBTXFRLFNBQVdnYixFQUFTVyx5QkFDakN4cUIsR0FBYWhPLEtBQUtnUyxFQUFRQSxFQUFPeEYsTUFBTyxZQUV4QyxNQUVGLEtBQUssRUFDSGdvQixHQUFvQngwQixLQUFLZ1MsR0FBQUEsR0FHckJBLEVBQU94RixNQUFNaVosTUFFZm9TLEVBQVNLLFlBQ1RMLEVBQVNHLGFBRVRocUIsR0FBYWhPLEtBQUtnUyxFQUFRQSxFQUFPeEYsTUFBTyxTQUcxQyxNQUVGLEtBQUssRUFFQ3JMLEVBQU93bkIsaUJBQW1CM1csRUFBTzdRLE9BQU8rakIsVUFBWWxULEVBQU94RixNQUFNNEYsU0FBV0osRUFBTzNCLE1BQU1va0IsVUFDM0Z6aUIsRUFBT3hGLE1BQU1nTCxTQUViZ2QsR0FBb0J4MEIsS0FBS2dTLEdBQUFBLEdBRXpCaEUsR0FBYWhPLEtBQUtnUyxFQUFRQSxFQUFPeEYsTUFBTyxXQUd4Q3dGLEVBQU9tYixPQUFPNUYsUUFBVWdSLGFBQVksV0FDbEN2cUIsR0FBYWhPLEtBQUtnUyxFQUFRQSxFQUFPeEYsTUFBTyxnQkFDdkMsSUFLQ3dGLEVBQU94RixNQUFNNkwsV0FBYXdmLEVBQVN4QixnQkFDckNya0IsRUFBT3hGLE1BQU02TCxTQUFXd2YsRUFBU3hCLGNBQ2pDcm9CLEdBQWFoTyxLQUFLZ1MsRUFBUUEsRUFBT3hGLE1BQU8sb0JBSTVDLE1BRUYsS0FBSyxFQUVFd0YsRUFBT3FLLE9BQ1ZySyxFQUFPM0IsTUFBTXNvQixTQUVmbkUsR0FBb0J4MEIsS0FBS2dTLEdBQUFBLEdBRXpCLE1BRUYsS0FBSyxFQUVIaEUsR0FBYWhPLEtBQUtnUyxFQUFRQSxFQUFPeEYsTUFBTyxXQVE1Q3dCLEdBQWFoTyxLQUFLZ1MsRUFBUUEsRUFBT3hLLFNBQVNxRCxVQUFXLGlCQUFzQixDQUN6RTZvQixLQUFNOXRCLEVBQU1pUSxNQUFBQSxJQXhVWixDQXdVWUEsR0M3YWxCckosR0FBUSxDQUVadUYsUUFFT2hTLEtBQUt5TSxPQU1WckMsR0FBWXBLLEtBQUt5SCxTQUFTcUQsVUFBVzlLLEtBQUtvQixPQUFPZ0ssV0FBVzFILEtBQUttRyxRQUFRLE1BQU83SixLQUFLMEQsT0FBQUEsR0FHckYwRyxHQUFZcEssS0FBS3lILFNBQVNxRCxVQUFXOUssS0FBS29CLE9BQU9nSyxXQUFXTSxTQUFTN0IsUUFBUSxNQUFPN0osS0FBSzBMLFdBQUFBLEdBSXJGMUwsS0FBS3loQixTQUNQclgsR0FBWXBLLEtBQUt5SCxTQUFTcUQsVUFBVzlLLEtBQUtvQixPQUFPZ0ssV0FBVzFILEtBQUttRyxRQUFRLE1BQU8sYUFJOUU3SixLQUFLd1EsVUFFUHhRLEtBQUt5SCxTQUFTQyxRQUFVcEMsR0FBYyxNQUFPLENBQzNDMEUsTUFBT2hLLEtBQUtvQixPQUFPZ0ssV0FBV0ksUUFJaENoRSxHQUFLeEgsS0FBS3lNLE1BQU96TSxLQUFLeUgsU0FBU0MsU0FHL0IxSCxLQUFLeUgsU0FBUzRmLE9BQVMvaEIsR0FBYyxNQUFPLENBQzFDMEUsTUFBT2hLLEtBQUtvQixPQUFPZ0ssV0FBV2ljLFNBRzNCNWYsS0FBQUEsU0FBU0MsUUFBUVUsWUFBWXBJLEtBQUt5SCxTQUFTNGYsU0FHOUNybkIsS0FBS3dNLFFBQ1BtRixHQUFNSyxNQUFNL1IsS0FBS0QsTUFDUkEsS0FBS3dqQixVQUNkN1AsR0FBUTNCLE1BQU0vUixLQUFLRCxNQUNWQSxLQUFLNFEsU0FDZEMsR0FBTW1CLE1BQU0vUixLQUFLRCxPQXZDakJBLEtBQUs4UyxNQUFNMkYsS0FBSyw2QkNpQmhCb2dCLEduQzNCRyxXbUNpQ1AxNEIsU0FBQUEsRUFBWThSLEdBQUFBLElBQUFBLEVBQUFBLEtBQUFBLEVBQUFBLEtBQUFBLEdBQVF4VCxFQUFBQSxLQUFBQSxRQTBDYixXQUNBdUIsRUFBS3dCLFVBS0xkLEVBQVVxRSxPQUFPK3pCLFNBQVlwNEIsRUFBVXFFLE9BQU8rekIsT0FBT0MsS0FVeEQvNEIsRUFBS3VPLFFBVExpbUIsR0FBV3gwQixFQUFLaVMsT0FBTzdRLE9BQU9vZ0IsS0FBSzBGLFVBQVVGLEtBQzFDdFksTUFBSyxXQUNKMU8sRUFBS3VPLE9BQUFBLElBRU42SCxPQUFNLFdBRUEzUyxFQUFBQSxRQUFRLFFBQVMsSUFBSTBSLE1BQU0seUNBdkRwQjFXLEVBQUFBLEtBQUFBLFNBaUVaLFdBckZPcTVCLElBQUFBLEVBdUZSOTNCLEVBQUt3QixXQXZGR3MyQixFQXdGSDkzQixHQXRGQ2c1QixTQUNYbEIsRUFBU2tCLFFBQVFDLFVBSWZuQixFQUFTcndCLFNBQVN5eEIsa0JBQ3BCcEIsRUFBU3J3QixTQUFTeXhCLGlCQUFpQkQsVUFHckNuQixFQUFTcndCLFNBQVNxRCxVQUFVcXVCLFVBa0YxQm41QixFQUFLbzVCLGlCQUFpQixLQUFPLFdBRzdCcDVCLEVBQUtxNUIsZUFBZTNxQixNQUFLLFdBQ2xCNHFCLEVBQUFBLGlCQUFpQiwyQkFJbkJ6M0IsRUFBQUEsWUFHTDdCLEVBQUt1NUIsVUFBQUEsSUFwRmE5NkIsRUFBQUEsS0FBQUEsWUFzSFQsV0FFVHVCLEVBQUt5SCxTQUFTcUQsVUFBWXhGLEdBQWMsTUFBTyxDQUM3QzBFLE1BQU9oSyxFQUFLaVMsT0FBTzdRLE9BQU9nSyxXQUFXbWMsTUFHdkN2bkIsRUFBS2lTLE9BQU94SyxTQUFTcUQsVUFBVTFDLFlBQVlwSSxFQUFLeUgsU0FBU3FELFdBR3pEZ3VCLE9BQU9DLElBQUlqaEIsU0FBUzBoQixhQUFhVixPQUFPQyxJQUFJVSxlQUFlQyxVQUFVQyxTQUdyRWIsT0FBT0MsSUFBSWpoQixTQUFTOGhCLFVBQVU1NUIsRUFBS2lTLE9BQU83USxPQUFPbW1CLElBQUkvSCxVQUdyRHNaLE9BQU9DLElBQUlqaEIsU0FBUytoQixxQ0FBcUM3NUIsRUFBS2lTLE9BQU83USxPQUFPdUssYUFHdkVsRSxFQUFBQSxTQUFTeXhCLGlCQUFtQixJQUFJSixPQUFPQyxJQUFJZSxtQkFBbUI5NUIsRUFBS3lILFNBQVNxRCxVQUFXOUssRUFBS2lTLE9BQU94RixPQUd4R3pNLEVBQUsrNUIsT0FBUyxJQUFJakIsT0FBT0MsSUFBSWlCLFVBQVVoNkIsRUFBS3lILFNBQVN5eEIsa0JBR2hEYSxFQUFBQSxPQUFPM3NCLGlCQUNWMHJCLE9BQU9DLElBQUlrQixzQkFBc0JDLEtBQUtDLG9CQUNyQ3QwQixTQUFBQSxHQUFBQSxPQUFVN0YsRUFBS282QixtQkFBbUJ2MEIsRUFBbENBLElBQWtDQSxHQUdoQ2swQixFQUFBQSxPQUFPM3NCLGlCQUFpQjByQixPQUFPQyxJQUFJc0IsYUFBYUgsS0FBS0ksVUFBVy9rQixTQUFBQSxHQUFBQSxPQUFVdlYsRUFBS3U2QixVQUFVaGxCLEVBQXpCQSxJQUF5QkEsR0FHOUZ2VixFQUFLdzZCLFlBQUFBLElBdEphLzdCLEVBQUFBLEtBQUFBLGNBNEpQLFdBQ0wsSUFBRXFNLEVBQWM5SyxFQUFLaVMsT0FBT3hLLFNBQTVCLFVBRUYsSUFFSXNOLElBQUFBLEVBQVUsSUFBSStqQixPQUFPQyxJQUFJMEIsV0FDL0IxbEIsRUFBUTJsQixTQUFXMTZCLEVBQUt3b0IsT0FJeEJ6VCxFQUFRNGxCLGtCQUFvQjd2QixFQUFVaUcsWUFDdENnRSxFQUFRNmxCLG1CQUFxQjl2QixFQUFVNUUsYUFDdkM2TyxFQUFROGxCLHFCQUF1Qi92QixFQUFVaUcsWUFDekNnRSxFQUFRK2xCLHNCQUF3Qmh3QixFQUFVNUUsYUFHMUM2TyxFQUFRZ21CLHdCQUFBQSxFQUdSaG1CLEVBQVFpbUIsb0JBQW9CaDdCLEVBQUtpUyxPQUFPcUssT0FFeEN0YyxFQUFLKzVCLE9BQU9TLFdBQVd6bEIsRUFFUlEsQ0FEZixNQUFPQSxHQUNGZ2xCLEVBQUFBLFVBQVVobEIsRUFBQUEsQ0FBQUEsSUFuTEM5VyxFQUFBQSxLQUFBQSxpQkEyTEosV0FDVixLQURtQix5REFJckIsT0FGQTY1QixjQUFjdDRCLEVBQUtpN0IscUJBQ25CajdCLEVBQUt5SCxTQUFTcUQsVUFBVTJWLGdCQUFnQixtQkFVMUN6Z0IsRUFBS2k3QixlQUFpQnpDLGFBTlAsV0FDYixJQUFNaGlCLEVBQU9ELEdBQVd4VCxLQUFLQyxJQUFJaEQsRUFBS2c1QixRQUFRa0MsbUJBQW9CLElBQzVEbmhCLEVBQUFBLEdBQUFBLE9BQVduRyxHQUFLdFEsSUFBSSxnQkFBaUJ0RCxFQUFLaVMsT0FBTzdRLFFBQWpEMlksT0FBQUEsT0FBOER2RCxHQUMvRC9PLEVBQUFBLFNBQVNxRCxVQUFVckMsYUFBYSxrQkFBbUJzUixFQUFBQSxHQUdoQixRQXhNeEJ0YixFQUFBQSxLQUFBQSxzQkErTUVvSCxTQUFBQSxHQUVoQixHQUFDN0YsRUFBS3dCLFFBQU4sQ0FLRXNXLElBQUFBLEVBQVcsSUFBSWdoQixPQUFPQyxJQUFJb0MscUJBR2hDcmpCLEVBQVNzakIsNkNBQUFBLEVBQ1R0akIsRUFBU3VqQixrQkFBQUEsRUFJVHI3QixFQUFLZzVCLFFBQVVuekIsRUFBTXkxQixjQUFjdDdCLEVBQUtpUyxPQUFRNkYsR0FHM0N5akIsRUFBQUEsVUFBWXY3QixFQUFLZzVCLFFBQVF3QyxlQUl6QnhDLEVBQUFBLFFBQVE1ckIsaUJBQWlCMHJCLE9BQU9DLElBQUlzQixhQUFhSCxLQUFLSSxVQUFXL2tCLFNBQUFBLEdBQUFBLE9BQVV2VixFQUFLdTZCLFVBQVVobEIsRUFBekJBLElBR3RFelgsT0FBT2EsS0FBS202QixPQUFPQyxJQUFJMEMsUUFBUXZCLE1BQU0vNkIsU0FBU3VFLFNBQUFBLEdBQ3ZDczFCLEVBQUFBLFFBQVE1ckIsaUJBQWlCMHJCLE9BQU9DLElBQUkwQyxRQUFRdkIsS0FBS3gyQixJQUFRdEYsU0FBQUEsR0FBQUEsT0FBTTRCLEVBQUswN0IsVUFBVXQ5QixFQUFyQkEsR0FBcUJBLElBSWhGcUYsRUFBQUEsUUFBUSxTQTNCTCxDQTJCSyxJQTdPS2hGLEVBQUFBLEtBQUFBLGdCQWdQTCxXQUVSaUMsRUFBU1YsRUFBS3U3QixZQUNqQnY3QixFQUFLdTdCLFVBQVVwOEIsU0FBU3c4QixTQUFBQSxHQUN0QixHQUFpQixJQUFiQSxJQUFnQyxJQUFkQSxHQUFtQkEsRUFBVzM3QixFQUFLaVMsT0FBT3FHLFNBQVUsQ0FDeEUsSUFBTXNqQixFQUFjNTdCLEVBQUtpUyxPQUFPeEssU0FBU3VRLFNBRXpDLEdBQUl0WCxFQUFXazdCLEdBQWMsQ0FDckJDLElBQUFBLEVBQWlCLElBQU03N0IsRUFBS2lTLE9BQU9xRyxTQUFZcWpCLEVBQy9DNVcsRUFBTXpmLEdBQWMsT0FBUSxDQUNoQzBFLE1BQU9oSyxFQUFLaVMsT0FBTzdRLE9BQU9nSyxXQUFXeVosT0FHdkNFLEVBQUl0akIsTUFBTW1CLEtBQVZtaUIsR0FBQUEsT0FBb0I4VyxFQUFjNW9CLFdBQWxDOFIsS0FDQTZXLEVBQVl4ekIsWUFBWTJjLEVBQUFBLENBQUFBLENBQUFBLEdBQUFBLElBOVBkdG1CLEVBQUFBLEtBQUFBLGFBMlFQb0gsU0FBQUEsR0FDTCxJQUFFaUYsRUFBYzlLLEVBQUtpUyxPQUFPeEssU0FBNUIsVUFHQXEwQixFQUFLajJCLEVBQU1rMkIsUUFDWEMsRUFBU24yQixFQUFNbzJCLFlBVWJwMkIsT0FQZW5DLFNBQUFBLEdBQ3JCdUssR0FBYWhPLEtBQUtELEVBQUtpUyxPQUFRalMsRUFBS2lTLE9BQU94RixNQUEzQ3dCLE1BQUFBLE9BQXdEdkssRUFBS21HLFFBQVEsS0FBTSxJQUFJMEosZUFBQUEsQ0FEMUQ3UCxDQUtUbUMsRUFBTW5DLE1BRVptQyxFQUFNbkMsTUFDUG8xQixLQUFBQSxPQUFPQyxJQUFJMEMsUUFBUXZCLEtBQUtnQyxPQUczQmw4QixFQUFLeUQsUUFBUSxVQUdSMDRCLEVBQUFBLGVBQUFBLEdBRUFMLEVBQUdNLGFBRU5OLEVBQUdwNUIsTUFBUW9JLEVBQVVpRyxZQUNyQitxQixFQUFHL3JCLE9BQVNqRixFQUFVNUUsY0FNeEIsTUFFRzR5QixLQUFBQSxPQUFPQyxJQUFJMEMsUUFBUXZCLEtBQUttQyxRQUUzQnI4QixFQUFLZzVCLFFBQVF2RCxVQUFVejFCLEVBQUtpUyxPQUFPa0csUUFFbkMsTUFFRzJnQixLQUFBQSxPQUFPQyxJQUFJMEMsUUFBUXZCLEtBQUtvQyxrQkEyQnZCdDhCLEVBQUtpUyxPQUFPa2QsTUFDZG52QixFQUFLdThCLFVBR0F4QyxFQUFBQSxPQUFPeUMsa0JBR2QsTUFFRzFELEtBQUFBLE9BQU9DLElBQUkwQyxRQUFRdkIsS0FBS3VDLHdCQUszQno4QixFQUFLMDhCLGVBRUwsTUFFRzVELEtBQUFBLE9BQU9DLElBQUkwQyxRQUFRdkIsS0FBS3lDLHlCQU0zQjM4QixFQUFLbThCLGdCQUVMbjhCLEVBQUs0OEIsZ0JBRUwsTUFFRzlELEtBQUFBLE9BQU9DLElBQUkwQyxRQUFRdkIsS0FBSzJDLElBQ3ZCYixFQUFPYyxTQUNUOThCLEVBQUtpUyxPQUFPYSxNQUFNMkYsS0FBbEJ6WSx1QkFBQUEsT0FBOENnOEIsRUFBT2MsUUFBUUMsZUFBQUEsSUEvV2pEdCtCLEVBQUFBLEtBQUFBLGFBNlhQb0gsU0FBQUEsR0FDWDdGLEVBQUtnOUIsU0FDQS9xQixFQUFBQSxPQUFPYSxNQUFNMkYsS0FBSyxZQUFhNVMsRUFBQUEsSUEvWGxCcEgsRUFBQUEsS0FBQUEsYUF1WVIsV0FDSixJQUNGK1gsRUFESTFMLEVBQWM5SyxFQUFLaVMsT0FBT3hLLFNBQTVCLFVBR056SCxFQUFLaVMsT0FBT3JFLEdBQUcsV0FBVyxXQUN4QjVOLEVBQUtpOUIsY0FBQUEsSUFHUGo5QixFQUFLaVMsT0FBT3JFLEdBQUcsU0FBUyxXQUNqQm1zQixFQUFBQSxPQUFPeUMsaUJBQUFBLElBR2R4OEIsRUFBS2lTLE9BQU9yRSxHQUFHLGNBQWMsV0FDM0I0SSxFQUFPeFcsRUFBS2lTLE9BQU9HLFdBQUFBLElBR3JCcFMsRUFBS2lTLE9BQU9yRSxHQUFHLFVBQVUsV0FDdkIsSUFBTXN2QixFQUFhbDlCLEVBQUtpUyxPQUFPRyxZQUUzQjFSLEVBQVNWLEVBQUt1N0IsWUFJYkEsRUFBQUEsVUFBVXA4QixTQUFRLFNBQUN3OEIsRUFBVTl6QixHQUM1QjJPLEVBQU9tbEIsR0FBWUEsRUFBV3VCLElBQzNCbEUsRUFBQUEsUUFBUW1FLGlCQUNibjlCLEVBQUt1N0IsVUFBVWhKLE9BQU8xcUIsRUFBTyxVQU9uQzlDLE9BQU9xSSxpQkFBaUIsVUFBVSxXQUM1QnBOLEVBQUtnNUIsU0FDUGg1QixFQUFLZzVCLFFBQVFvRSxPQUFPdHlCLEVBQVVpRyxZQUFhakcsRUFBVTVFLGFBQWM0eUIsT0FBT0MsSUFBSXNFLFNBQVNDLE9BQUFBLEdBQUFBLElBMWF6RTcrQixFQUFBQSxLQUFBQSxRQWtiYixXQUNDLElBQUVxTSxFQUFjOUssRUFBS2lTLE9BQU94SyxTQUE1QixVQUVEekgsRUFBS3E1QixnQkFDUnI1QixFQUFLNDhCLGdCQUlQNThCLEVBQUtxNUIsZUFDRjNxQixNQUFLLFdBRUNzcUIsRUFBQUEsUUFBUXZELFVBQVV6MUIsRUFBS2lTLE9BQU9rRyxRQUduQ25ZLEVBQUt5SCxTQUFTeXhCLGlCQUFpQnFFLGFBRTNCLElBQ0d2OUIsRUFBS3c5QixjQUVIeEUsRUFBQUEsUUFBUTMzQixLQUFLeUosRUFBVWlHLFlBQWFqRyxFQUFVNUUsYUFBYzR5QixPQUFPQyxJQUFJc0UsU0FBU0MsUUFJaEZ0RSxFQUFBQSxRQUFRdFMsU0FHVjhXLEVBQUFBLGFBQUFBLENBSVVWLENBSGYsTUFBT0EsR0FHRnZDLEVBQUFBLFVBQVV1QyxFQUFBQSxDQUFBQSxJQUdsQjFtQixPQUFNLGtCQW5kUzNYLEVBQUFBLEtBQUFBLGlCQXlkSixXQUVUZ0osRUFBQUEsU0FBU3FELFVBQVVySixNQUFNZzhCLE9BQVMsR0FHdkN6OUIsRUFBS3duQixTQUFBQSxFQUdMN1ksR0FBZTNPLEVBQUtpUyxPQUFPeEYsTUFBTWlHLE9BQUFBLElBamVmalUsRUFBQUEsS0FBQUEsZ0JBdWVMLFdBRVJnSixFQUFBQSxTQUFTcUQsVUFBVXJKLE1BQU1nOEIsT0FBUyxFQUd2Q3o5QixFQUFLd25CLFNBQUFBLEVBR0x4bkIsRUFBS2lTLE9BQU94RixNQUFNZ0wsT0FBQUEsSUEvZUFoWixFQUFBQSxLQUFBQSxVQXdmWCxXQUVIdUIsRUFBS3c5QixhQUNQeDlCLEVBQUs0OEIsZ0JBSVA1OEIsRUFBS3lELFFBQVEsU0FHYnpELEVBQUt1OEIsU0FBQUEsSUFsZ0JhOTlCLEVBQUFBLEtBQUFBLFdBd2dCVixXQUVSdUIsRUFBS3E1QixlQUNGM3FCLE1BQUssV0FFQTFPLEVBQUtnNUIsU0FDRkEsRUFBQUEsUUFBUUMsVUFJZmo1QixFQUFLcTVCLGVBQWlCLElBQUk3cUIsU0FBU0MsU0FBQUEsR0FDakN6TyxFQUFLNE4sR0FBRyxTQUFVYSxHQUNsQnpPLEVBQUtpUyxPQUFPYSxNQUFNQyxJQUFJL1MsRUFBS2c1QixRQUFBQSxJQUc3Qmg1QixFQUFLdzlCLGFBQUFBLEVBR0x4OUIsRUFBS3c2QixZQUFBQSxJQUVOcGtCLE9BQU0sa0JBNWhCUzNYLEVBQUFBLEtBQUFBLFdBb2lCVixTQUFDb0gsR0FBVW1JLElBQUFBLElBQUFBLEVBQUFBLFVBQUFBLE9BQUFBLEVBQUFBLElBQUFBLE1BQUFBLEVBQUFBLEVBQUFBLEVBQUFBLEVBQUFBLEdBQUFBLEVBQUFBLEVBQUFBLEVBQUFBLEVBQUFBLElBQUFBLEVBQUFBLEVBQUFBLEdBQUFBLFVBQUFBLEdBQ25CLElBQU0wdkIsRUFBVzE5QixFQUFLdUYsT0FBT00sR0FFekJuRixFQUFTZzlCLElBQ1hBLEVBQVN2K0IsU0FBU2l0QixTQUFBQSxHQUNaMXJCLEVBQVkwckIsSUFDZEEsRUFBUXB0QixNQUFNZ0IsRUFBTWdPLEVBQUFBLEdBQUFBLElBMWlCUnZQLEVBQUFBLEtBQUFBLE1Bc2pCZixTQUFDb0gsRUFBTzBILEdBQVIsT0FDRTdNLEVBQVNWLEVBQUt1RixPQUFPTSxNQUN4QjdGLEVBQUt1RixPQUFPTSxHQUFTLElBR3ZCN0YsRUFBS3VGLE9BQU9NLEdBQU85RyxLQUFLd08sR0FFakJ2TixDQVBKLElBdGpCZXZCLEVBQUFBLEtBQUFBLG9CQXdrQkQsU0FBQytYLEVBQU01VyxHQUNuQnFTLEVBQUFBLE9BQU9hLE1BQU1DLElBQWJkLDhCQUFBQSxPQUErQ3JTLElBRXBESSxFQUFLMjlCLFlBQWMzM0IsWUFBVyxXQUM1QmhHLEVBQUtnOUIsU0FDQTFELEVBQUFBLGlCQUFpQix3QkFDckI5aUIsRUFBQUEsSUE5a0JlL1gsRUFBQUEsS0FBQUEsb0JBcWxCQW1CLFNBQUFBLEdBQ2JjLEVBQW1CVixFQUFLMjlCLGVBQ3RCMXJCLEVBQUFBLE9BQU9hLE1BQU1DLElBQWJkLDhCQUFBQSxPQUErQ3JTLElBRXBEdXRCLGFBQWFudEIsRUFBSzI5QixhQUNiQSxFQUFBQSxZQUFjLFNBemxCaEIxckIsS0FBQUEsT0FBU0EsRUFDZGpTLEtBQUtvQixPQUFTNlEsRUFBTzdRLE9BQU9tbUIsSUFDdkJDLEtBQUFBLFNBQUFBLEVBQ0FnVyxLQUFBQSxhQUFBQSxFQUNMeDlCLEtBQUt5SCxTQUFXLENBQ2RxRCxVQUFXLEtBQ1hvdUIsaUJBQWtCLE1BRWZGLEtBQUFBLFFBQVUsS0FDVmUsS0FBQUEsT0FBUyxLQUNUd0IsS0FBQUEsVUFBWSxLQUNaaDJCLEtBQUFBLE9BQVMsQ0FBQyxFQUNWbzRCLEtBQUFBLFlBQWMsS0FDbkIzOUIsS0FBS2k3QixlQUFpQixLQUdqQjVCLEtBQUFBLGVBQWlCLElBQUk3cUIsU0FBUSxTQUFDQyxFQUFTcUcsR0FFMUM5VSxFQUFLNE4sR0FBRyxTQUFVYSxHQUdsQnpPLEVBQUs0TixHQUFHLFFBQVNrSCxFQUFBQSxJQUduQjlVLEtBQUsyUyxNQUdIblIsQ25DN0RHLCtCbUM2REhBLFdBQ0ksSUFBRUosRUFBV3BCLEtBQWIsT0FFTixPQUNFQSxLQUFLaVMsT0FBT3pGLFNBQ1p4TSxLQUFLaVMsT0FBT3pCLFNBQ1pwUCxFQUFPSSxXQUNMZCxFQUFTVSxFQUFPbW5CLGNBQWdCN25CLEVBQU9VLEVBQU9vbkIsUUFxRGhEQSxHbkN6SEcsa0JtQ3lISEEsV0FDSSxJQUFFcG5CLEVBQVdwQixLQUFiLE9BRUZVLE9BQUFBLEVBQU9VLEVBQU9vbkIsUUFDVHBuQixFQUFPb25CLE9BZVQsOENBQVAsT0FBa0JuRixHQVpILENBQ2J1YSxlQUFnQiwyQkFDaEJDLGFBQWMsMkJBQ2RDLE9BQVEvNEIsT0FBT2tTLFNBQVM5UixTQUN4QjQ0QixHQUFJdlEsS0FBS0MsTUFDVHVRLFNBQVUsSUFDVkMsVUFBVyxJQUNYQyxTQUFVOThCLEVBQU9tbkIsY0FBQUEsS25DdklkLEtvQ1FGLFNBQVM0VixLQUFnQyxJQUExQmg2QixFQUEwQix1REFBbEIsRUFBR21XLEVBQWUsdURBQVQsRUFBR3RYLEVBQU0sMkRBQzlDLE9BQU9ELEtBQUt1WCxJQUFJdlgsS0FBS0MsSUFBSW1CLEVBQU9tVyxHQUFNdFgsRUNMeEMsS2hDRDBCK0QsR2dDQ3BCcTNCLEdBQVlDLFNBQUFBLEdBQ1ZDLElBQUFBLEVBQWdCLEdBMkN0QixPQTFDZUQsRUFBY3AzQixNQUFNLHNCQUU1QjlILFNBQVNvL0IsU0FBQUEsR0FDUnBvQixJQUFBQSxFQUFTLENBQUMsRUFDRm9vQixFQUFNdDNCLE1BQU0sY0FFcEI5SCxTQUFTcS9CLFNBQUFBLEdBQ1QsR0FBQzk5QixFQUFVeVYsRUFBT3NvQixZQWtCZixJQUFLLzlCLEVBQVM4OUIsRUFBSzcwQixTQUFXakosRUFBU3lWLEVBQU96TixNQUFPLFNBRXBEZzJCLEVBQVlGLEVBQUs3MEIsT0FBTzFDLE1BQU0sY0FDcEJ5M0IsRUFEb0IsR0FDbkN2b0IsRUFBT3pOLEtBRDRCLEtBSWhDZzJCLEVBQVUsS0FBVkEsRUFBQUEsRUFDeUNBLEVBQVUsR0FBR3ozQixNQUFNLEtBRDVEeTNCLEdBQ0R2b0IsRUFBTzFHLEVBRE5pdkIsRUFBQUEsR0FDU3ZvQixFQUFPekcsRUFEaEJndkIsRUFBQUEsR0FDbUJ2b0IsRUFBT2pHLEVBRDFCd3VCLEVBQUFBLEdBQzZCdm9CLEVBQU9oRyxFQURwQ3V1QixFQUFBQSxHQUM0RCxNQXpCaEMsQ0FFMUJDLElBQUFBLEVBQWFILEVBQUsxN0IsTUFDdEIsMkdBR0U2N0IsSUFDRnhvQixFQUFPc29CLFVBQ3dCLEdBQTdCajZCLE9BQU9tNkIsRUFBVyxJQUFNLEdBQVUsR0FDVixHQUF4Qm42QixPQUFPbTZCLEVBQVcsSUFDbEJuNkIsT0FBT202QixFQUFXLElBQ2xCbjZCLE9BQU8sS0FBUEEsT0FBWW02QixFQUFXLEtBQ3pCeG9CLEVBQU95b0IsUUFDd0IsR0FBN0JwNkIsT0FBT202QixFQUFXLElBQU0sR0FBVSxHQUNWLEdBQXhCbjZCLE9BQU9tNkIsRUFBVyxJQUNsQm42QixPQUFPbTZCLEVBQVcsSUFDbEJuNkIsT0FBTyxLQUFQQSxPQUFZbTZCLEVBQVcsVUFjM0J4b0IsRUFBT3pOLE1BQ1Q0MUIsRUFBY3YvQixLQUFLb1gsRUFBQUEsSUFJaEJtb0IsQ0FBQUEsRUFjSE8sR0FBVyxTQUFDL3VCLEVBQU9ndkIsR0FDakJDLElBQ0E1b0IsRUFBUyxDQUFDLEVBU2hCLE9BUklyRyxFQUZnQmd2QixFQUFNcDhCLE1BQVFvOEIsRUFBTS91QixRQUd0Q29HLEVBQU96VCxNQUFRbzhCLEVBQU1wOEIsTUFDckJ5VCxFQUFPcEcsT0FBVSxFQUFJRCxFQUFTZ3ZCLEVBQU1wOEIsUUFFcEN5VCxFQUFPcEcsT0FBUyt1QixFQUFNL3VCLE9BQ3RCb0csRUFBT3pULE1BQVFvTixFQUFRZ3ZCLEVBQU0vdUIsUUFHeEJvRyxDQUFBQSxFQUdINm9CLEdyQzVFRyxXcUNrRlA3K0IsU0FBQUEsRUFBWThSLEdBQUFBLElBQUFBLEVBQUFBLEtBQUFBLEVBQUFBLEtBQUFBLEdBQVF4VCxFQUFBQSxLQUFBQSxRQW9CYixXQUVEdUIsRUFBS2lTLE9BQU94SyxTQUFTMlEsUUFBUUcsY0FDMUJ0RyxFQUFBQSxPQUFPeEssU0FBUzJRLFFBQVFHLFlBQVl0UyxPQUFTakcsRUFBS3dCLFNBR3BEeEIsRUFBS3dCLFNBRVZ4QixFQUFLaS9CLGdCQUFnQnZ3QixNQUFLLFdBQ25CMU8sRUFBS3dCLFVBS0wwOUIsRUFBQUEsU0FHTGwvQixFQUFLbS9CLCtCQUVBL08sRUFBQUEsUUFBQUEsRUFBUyxPQXZDRTN4QixFQUFBQSxLQUFBQSxpQkE0Q0osa0JBQ1AsSUFBSStQLFNBQVNDLFNBQUFBLEdBQ1osSUFBRWdFLEVBQVF6UyxFQUFLaVMsT0FBTzdRLE9BQU8ybUIsa0JBQTdCLElBRU4sR0FBSXJuQixFQUFTK1IsR0FDWCxNQUFNLElBQUkwQyxNQUFNLGtEQUlaaXFCLElBQUFBLEVBQWlCLFdBRXJCcC9CLEVBQUtxL0IsV0FBV3JnQixNQUFLLFNBQUN2UCxFQUFHQyxHQUFKLE9BQVVELEVBQUVNLE9BQVNMLEVBQUVLLE1BQXZCLElBRWhCa0MsRUFBQUEsT0FBT2EsTUFBTUMsSUFBSSxxQkFBc0IvUyxFQUFLcS9CLFlBRWpENXdCLEdBQUFBLEVBSUYsR0FBSS9OLEVBQVkrUixHQUNkQSxHQUFLNHNCLFNBQUFBLEdBQ0VBLEVBQUFBLFdBQWFBLEVBQ2xCRCxHQUFBQSxRQUlDLENBRUgsSUFFTUUsR0FGTzUrQixFQUFVK1IsR0FBTyxDQUFDQSxHQUFPQSxHQUVoQnhPLEtBQUszQixTQUFBQSxHQUFBQSxPQUFNdEMsRUFBS3UvQixhQUFhajlCLEVBQXhCQSxJQUUzQmtNLFFBQVFvWSxJQUFJMFksR0FBVTV3QixLQUFLMHdCLEVBQUFBLENBQUFBLEdBaENqQixJQTVDSTNnQyxFQUFBQSxLQUFBQSxnQkFrRkptVyxTQUFBQSxHQUFBQSxPQUNQLElBQUlwRyxTQUFTQyxTQUFBQSxHQUNsQmtHLEdBQU1DLEdBQUtsRyxNQUFNd0csU0FBQUEsR0FDZixJQUFNc3FCLEVBQVksQ0FDaEJDLE9BQVFyQixHQUFTbHBCLEdBQ2pCbkYsT0FBUSxLQUNSMnZCLFVBQVcsSUFPVkYsRUFBVUMsT0FBTyxHQUFHLzJCLEtBQUt4RCxXQUFXLE1BQ3BDczZCLEVBQVVDLE9BQU8sR0FBRy8yQixLQUFLeEQsV0FBVyxZQUNwQ3M2QixFQUFVQyxPQUFPLEdBQUcvMkIsS0FBS3hELFdBQVcsY0FFckNzNkIsRUFBVUUsVUFBWTlxQixFQUFJK3FCLFVBQVUsRUFBRy9xQixFQUFJZ3JCLFlBQVksS0FBTyxJQUloRSxJQUFNQyxFQUFZLElBQUkxVCxNQUV0QjBULEVBQVV4VCxPQUFTLFdBQ2pCbVQsRUFBVXp2QixPQUFTOHZCLEVBQVVDLGNBQzdCTixFQUFVOThCLE1BQVFtOUIsRUFBVXRULGFBRTVCdnNCLEVBQUtxL0IsV0FBV3RnQyxLQUFLeWdDLEdBRXJCL3dCLEdBQUFBLEVBR0ZveEIsRUFBVXB0QixJQUFNK3NCLEVBQVVFLFVBQVlGLEVBQVVDLE9BQU8sR0FBRy8yQixJQUFBQSxHQUFBQSxHQWhDaERrTSxJQWxGSW5XLEVBQUFBLEtBQUFBLGFBdUhQb0gsU0FBQUEsR0FDUCxHQUFDN0YsRUFBS293QixRQUVMMXZCLEVBQVNtRixJQUFXLENBQUMsWUFBYSxhQUFhOUYsU0FBUzhGLEVBQU1uQyxPQUc5RDFELEVBQUtpUyxPQUFPeEYsTUFBTTZMLFNBQXZCLENBRUEsR0FBbUIsY0FBZnpTLEVBQU1uQyxLQUVIbVEsRUFBQUEsU0FBVzdULEVBQUtpUyxPQUFPeEYsTUFBTTZMLFVBQVl0WSxFQUFLaVMsT0FBT3hLLFNBQVN3USxPQUFPQyxLQUFLcmEsTUFBUSxTQUNsRixTQUVDeWYsRUFBYXRkLEVBQUtpUyxPQUFPeEssU0FBU3VRLFNBQVN4Vix3QkFDM0N1OUIsRUFBYyxJQUFNemlCLEVBQVc1YSxPQUFVbUQsRUFBTTBYLE1BQVFELEVBQVcxYSxNQUN4RTVDLEVBQUs2VCxTQUFXN1QsRUFBS2lTLE9BQU94RixNQUFNNkwsVUFBWXluQixFQUFhLEtBRXZELy9CLEVBQUs2VCxTQUFXLElBRWJBLEVBQUFBLFNBQVcsR0FHZDdULEVBQUs2VCxTQUFXN1QsRUFBS2lTLE9BQU94RixNQUFNNkwsU0FBVyxJQUUxQ3pFLEVBQUFBLFNBQVc3VCxFQUFLaVMsT0FBT3hGLE1BQU02TCxTQUFXLEdBRy9DdFksRUFBS2dnQyxVQUFZbjZCLEVBQU0wWCxNQUd2QnZkLEVBQUt5SCxTQUFTdzRCLE1BQU16cEIsS0FBSzdOLFVBQVk0TixHQUFXdlcsRUFBSzZULFVBR3JELElBQU0ySixFQUFLLFVBQUd4ZCxFQUFLaVMsT0FBTzdRLE9BQU9zYyxlQUFBQSxJQUF0QndpQixHQUFBQSxRQUFBQSxFQUFHQSxFQUE0QnRpQixjQUFBQSxJQUEvQnVpQixPQUFBQSxFQUFHQSxFQUFvQ3Y2QixNQUFLLHFCQUFHNFEsT0FBb0J6VCxLQUFLSSxNQUFNbkQsRUFBSzZULFNBQXZDLElBR25EMkosR0FFRnhkLEVBQUt5SCxTQUFTdzRCLE1BQU16cEIsS0FBS3FILG1CQUFtQixhQUE1QzdkLEdBQUFBLE9BQTZEd2QsRUFBTXpELE1BQW5FL1osUUFLSkEsQ0FBQUEsRUFBS29nQyx3QkFBQUEsQ0FBQUEsSUFsS2EzaEMsRUFBQUEsS0FBQUEsV0FxS1YsV0FDUnVCLEVBQUtxZ0Msc0JBQUFBLEdBQXFCLEVBQU8sSUF0S2Y1aEMsRUFBQUEsS0FBQUEsa0JBeUtGb0gsU0FBQUEsSUFFWm5GLEVBQW1CbUYsRUFBTXVVLFVBQUFBLElBQVd2VSxFQUFNdVUsUUFBcUMsSUFBakJ2VSxFQUFNdVUsVUFDdEVwYSxFQUFLc2dDLFdBQUFBLEVBR0R0Z0MsRUFBS2lTLE9BQU94RixNQUFNNkwsV0FDZmlvQixFQUFBQSwwQkFBQUEsR0FDTHZnQyxFQUFLcWdDLHNCQUFBQSxHQUFxQixHQUcxQnJnQyxFQUFLb2dDLDBCQUFBQSxJQXBMUzNoQyxFQUFBQSxLQUFBQSxnQkF5TEwsV0FDYnVCLEVBQUtzZ0MsV0FBQUEsRUFHRHY5QixLQUFLeTlCLEtBQUt4Z0MsRUFBS3lnQyxZQUFjMTlCLEtBQUt5OUIsS0FBS3hnQyxFQUFLaVMsT0FBT3hGLE1BQU0yRixhQUV0RG11QixFQUFBQSwwQkFBQUEsR0FHTHp5QixHQUFLN04sS0FBS0QsRUFBS2lTLE9BQVFqUyxFQUFLaVMsT0FBT3hGLE1BQU8sY0FBYyxXQUVqRHpNLEVBQUtzZ0MsV0FDSEMsRUFBQUEsMEJBQUFBLEVBQXlCLE9Bck1sQjloQyxFQUFBQSxLQUFBQSxhQThNUixXQUVWdUIsRUFBS2lTLE9BQU9yRSxHQUFHLFFBQVEsV0FDckI1TixFQUFLcWdDLHNCQUFBQSxHQUFxQixFQUFPLElBR25DcmdDLEVBQUtpUyxPQUFPckUsR0FBRyxVQUFVLFdBQ2xCeXlCLEVBQUFBLHNCQUFBQSxFQUFxQixJQUc1QnJnQyxFQUFLaVMsT0FBT3JFLEdBQUcsY0FBYyxXQUMzQjVOLEVBQUt5Z0MsU0FBV3pnQyxFQUFLaVMsT0FBT3hGLE1BQU0yRixXQUFBQSxHQUFBQSxJQXpObEIzVCxFQUFBQSxLQUFBQSxVQWdPWCxXQUVGZ0osRUFBQUEsU0FBU3c0QixNQUFNbjFCLFVBQVl4RixHQUFjLE1BQU8sQ0FDbkQwRSxNQUFPaEssRUFBS2lTLE9BQU83USxPQUFPZ0ssV0FBVzJjLGtCQUFrQkMsaUJBSXBEdmdCLEVBQUFBLFNBQVN3NEIsTUFBTS9YLGVBQWlCNWlCLEdBQWMsTUFBTyxDQUN4RDBFLE1BQU9oSyxFQUFLaVMsT0FBTzdRLE9BQU9nSyxXQUFXMmMsa0JBQWtCRyxpQkFFekRsb0IsRUFBS3lILFNBQVN3NEIsTUFBTW4xQixVQUFVMUMsWUFBWXBJLEVBQUt5SCxTQUFTdzRCLE1BQU0vWCxnQkFHOUQsSUFBTUMsRUFBZ0I3aUIsR0FBYyxNQUFPLENBQ3pDMEUsTUFBT2hLLEVBQUtpUyxPQUFPN1EsT0FBT2dLLFdBQVcyYyxrQkFBa0JJLGdCQUd6RG5vQixFQUFLeUgsU0FBU3c0QixNQUFNenBCLEtBQU9sUixHQUFjLE9BQVEsQ0FBQyxFQUFHLFNBQ3JENmlCLEVBQWMvZixZQUFZcEksRUFBS3lILFNBQVN3NEIsTUFBTXpwQixNQUV6Qy9PLEVBQUFBLFNBQVN3NEIsTUFBTS9YLGVBQWU5ZixZQUFZK2YsR0FHM0N6bkIsRUFBV1YsRUFBS2lTLE9BQU94SyxTQUFTdVEsV0FDbENoWSxFQUFLaVMsT0FBT3hLLFNBQVN1USxTQUFTNVAsWUFBWXBJLEVBQUt5SCxTQUFTdzRCLE1BQU1uMUIsV0FJM0RyRCxFQUFBQSxTQUFTaTVCLFVBQVU1MUIsVUFBWXhGLEdBQWMsTUFBTyxDQUN2RDBFLE1BQU9oSyxFQUFLaVMsT0FBTzdRLE9BQU9nSyxXQUFXMmMsa0JBQWtCSyxxQkFHekRwb0IsRUFBS2lTLE9BQU94SyxTQUFTQyxRQUFRVSxZQUFZcEksRUFBS3lILFNBQVNpNUIsVUFBVTUxQixVQUFBQSxJQWhRL0NyTSxFQUFBQSxLQUFBQSxXQW1RVixXQUNKdUIsRUFBS3lILFNBQVN3NEIsTUFBTW4xQixXQUN0QjlLLEVBQUt5SCxTQUFTdzRCLE1BQU1uMUIsVUFBVXF1QixTQUU1Qm41QixFQUFLeUgsU0FBU2k1QixVQUFVNTFCLFdBQzFCOUssRUFBS3lILFNBQVNpNUIsVUFBVTUxQixVQUFVcXVCLFFBQUFBLElBeFFsQjE2QixFQUFBQSxLQUFBQSwwQkE0UUssV0FDbkJ1QixFQUFLc2dDLFVBQ1B0Z0MsRUFBSzJnQyw0QkFFTDNnQyxFQUFLNGdDLDhCQUtEQyxJQUFBQSxFQUFXN2dDLEVBQUtxL0IsV0FBVyxHQUFHSSxPQUFPcUIsV0FDeEN2QyxTQUFBQSxHQUFBQSxPQUFVditCLEVBQUs2VCxVQUFZMHFCLEVBQU1FLFdBQWF6K0IsRUFBSzZULFVBQVkwcUIsRUFBTUssT0FBckVMLElBRUd3QyxFQUFXRixHQUFZLEVBQ3pCRyxFQUFlLEVBR2RoaEMsRUFBS3NnQyxXQUNIRCxFQUFBQSxxQkFBcUJVLEdBSXZCQSxJQUtBMUIsRUFBQUEsV0FBV2xnQyxTQUFRLFNBQUNxZ0MsRUFBVzMzQixHQUM5QjdILEVBQUtpaEMsYUFBYWxoQyxTQUFTeS9CLEVBQVVDLE9BQU9vQixHQUFVbjRCLFFBQ3hEczRCLEVBQWVuNUIsRUFBQUEsSUFLZmc1QixJQUFhN2dDLEVBQUtraEMsZUFDZkEsRUFBQUEsYUFBZUwsRUFDZjdVLEVBQUFBLFVBQVVnVixJQUFBQSxJQS9TQ3ZpQyxFQUFBQSxLQUFBQSxhQW9UUixXQUFnQixJQUFmdWlDLEVBQWUseURBQ3BCSCxFQUFXN2dDLEVBQUtraEMsYUFDaEIxQixFQUFZeC9CLEVBQUtxL0IsV0FBVzJCLEdBQzFCdEIsRUFBY0YsRUFBaEJFLFVBQ0FuQixFQUFRaUIsRUFBVUMsT0FBT29CLEdBQ3pCTSxFQUFnQjNCLEVBQVVDLE9BQU9vQixHQUFVbjRCLEtBQzNDMDRCLEVBQVcxQixFQUFZeUIsRUFFN0IsR0FBS25oQyxFQUFLcWhDLHFCQUF1QnJoQyxFQUFLcWhDLG9CQUFvQkMsUUFBUUMsV0FBYUosRUF3QjdFbmhDLEVBQUt3aEMsVUFBVXhoQyxFQUFLcWhDLG9CQUFxQjlDLEVBQU95QyxFQUFjSCxFQUFVTSxHQUFBQSxHQUN4RW5oQyxFQUFLcWhDLG9CQUFvQkMsUUFBUXo1QixNQUFRZzVCLEVBQ3BDWSxFQUFBQSxnQkFBZ0J6aEMsRUFBS3FoQyx5QkExQmtFLENBR3hGcmhDLEVBQUswaEMsY0FBZ0IxaEMsRUFBSzJoQyxlQUM1QjNoQyxFQUFLMGhDLGFBQWFyVixPQUFTLE1BTTdCLElBQU11VixFQUFlLElBQUl6VixNQUN6QnlWLEVBQWFudkIsSUFBTTJ1QixFQUNuQlEsRUFBYU4sUUFBUXo1QixNQUFRZzVCLEVBQzdCZSxFQUFhTixRQUFRQyxTQUFXSixFQUMzQlUsRUFBQUEscUJBQXVCVixFQUV2Qmx2QixFQUFBQSxPQUFPYSxNQUFNQyxJQUFiZCxrQkFBQUEsT0FBbUNtdkIsSUFHeENRLEVBQWF2VixPQUFTLGtCQUFNcnNCLEVBQUt3aEMsVUFBVUksRUFBY3JELEVBQU95QyxFQUFjSCxFQUFVTSxHQUFBQSxFQUFsRSxFQUNqQk8sRUFBQUEsYUFBZUUsRUFDZkgsRUFBQUEsZ0JBQWdCRyxFQUFBQSxDQUFBQSxJQWpWTG5qQyxFQUFBQSxLQUFBQSxhQTBWUixTQUFDbWpDLEVBQWNyRCxFQUFPeUMsRUFBY0gsRUFBVU0sR0FBMEIsSUFBWFcsSUFBVyx5REFDbEY5aEMsRUFBS2lTLE9BQU9hLE1BQU1DLElBQWxCL1Msa0JBQUFBLE9BQ29CbWhDLEVBRHBCbmhDLFdBQUFBLE9BQzJDNmdDLEVBRDNDN2dDLFlBQUFBLE9BQzhEZ2hDLEVBRDlEaGhDLGNBQUFBLE9BQ3VGOGhDLElBRXZGOWhDLEVBQUsraEMsc0JBQXNCSCxFQUFjckQsR0FFckN1RCxJQUNGOWhDLEVBQUtnaUMsc0JBQXNCNTVCLFlBQVl3NUIsR0FDbENQLEVBQUFBLG9CQUFzQk8sRUFFdEI1aEMsRUFBS2loQyxhQUFhbGhDLFNBQVNvaEMsSUFDOUJuaEMsRUFBS2loQyxhQUFhbGlDLEtBQUtvaUMsSUFPM0JuaEMsRUFBS2lpQyxjQUFjcEIsR0FBQUEsR0FDaEJueUIsS0FBSzFPLEVBQUtpaUMsY0FBY3BCLEdBQUFBLElBQ3hCbnlCLEtBQUsxTyxFQUFLa2lDLGlCQUFpQmxCLEVBQWNZLEVBQWNyRCxFQUFPNEMsR0FBQUEsSUE5Vy9DMWlDLEVBQUFBLEtBQUFBLG1CQWtYRDBqQyxTQUFBQSxHQUVqQnhpQyxNQUFNQyxLQUFLSSxFQUFLZ2lDLHNCQUFzQmptQixVQUFVNWMsU0FBUytzQixTQUFBQSxHQUN2RCxHQUFvQyxRQUFoQ0EsRUFBTWtXLFFBQVE3dUIsY0FBbEIsQ0FJQSxJQUFNOHVCLEVBQWNyaUMsRUFBSzJoQyxhQUFlLElBQU0sSUFFOUMsR0FBSXpWLEVBQU1vVixRQUFRejVCLFFBQVVzNkIsRUFBYWIsUUFBUXo1QixRQUFVcWtCLEVBQU1vVixRQUFRZ0IsU0FBVSxDQUlqRnBXLEVBQU1vVixRQUFRZ0IsVUFBQUEsRUFHUixJQUFFTixFQUEwQmhpQyxFQUE1QixzQkFFTmdHLFlBQVcsV0FDVGc4QixFQUFzQmw1QixZQUFZb2pCLEdBQ2xDbHNCLEVBQUtpUyxPQUFPYSxNQUFNQyxJQUFsQi9TLG1CQUFBQSxPQUF5Q2tzQixFQUFNb1YsUUFBUUMsVUFBQUEsR0FDdERjLEVBQUFBLENBakJHLENBaUJIQSxHQUFBQSxJQXZZVzVqQyxFQUFBQSxLQUFBQSxpQkE4WUosU0FBQ29pQyxHQUFELElBQVdqUixJQUFYLGdFQUNQLElBQUlwaEIsU0FBU0MsU0FBQUEsR0FDbEJ6SSxZQUFXLFdBQ0h1OEIsSUFBQUEsRUFBbUJ2aUMsRUFBS3EvQixXQUFXLEdBQUdJLE9BQU9vQixHQUFVbjRCLEtBRTdELEdBQUkxSSxFQUFLNmhDLHVCQUF5QlUsRUFBa0IsQ0FFbEQsSUFBSUMsRUFFRkEsRUFERTVTLEVBQ2dCNXZCLEVBQUtxL0IsV0FBVyxHQUFHSSxPQUFPbnNCLE1BQU11dEIsR0FFaEM3Z0MsRUFBS3EvQixXQUFXLEdBQUdJLE9BQU9uc0IsTUFBTSxFQUFHdXRCLEdBQVVqNUIsVUFHN0Q2NkIsSUFBQUEsR0FBQUEsRUFFSkQsRUFBZ0JyakMsU0FBU28vQixTQUFBQSxHQUN2QixJQUFNbUUsRUFBbUJuRSxFQUFNNzFCLEtBRTNCZzZCLEdBQUFBLElBQXFCSCxJQUVsQnZpQyxFQUFLaWhDLGFBQWFsaEMsU0FBUzJpQyxHQUFtQixDQUNqREQsR0FBQUEsRUFDS3h3QixFQUFBQSxPQUFPYSxNQUFNQyxJQUFiZCw4QkFBQUEsT0FBK0N5d0IsSUFFOUMsSUFDQUMsRUFEZ0IzaUMsRUFBS3EvQixXQUFXLEdBQWhDLFVBQ3VCcUQsRUFDdkJkLEVBQWUsSUFBSXpWLE1BQ3pCeVYsRUFBYW52QixJQUFNa3dCLEVBQ25CZixFQUFhdlYsT0FBUyxXQUNmcGEsRUFBQUEsT0FBT2EsTUFBTUMsSUFBYmQsNkJBQUFBLE9BQThDeXdCLElBQzlDMWlDLEVBQUtpaEMsYUFBYWxoQyxTQUFTMmlDLElBQW1CMWlDLEVBQUtpaEMsYUFBYWxpQyxLQUFLMmpDLEdBRzFFajBCLEdBQUFBLENBQUFBLENBQUFBLElBT0hnMEIsR0FDSGgwQixHQUFBQSxDQUFBQSxHQUdILE9BN0NTLElBa0RHaFEsRUFBQUEsS0FBQUEsb0JBQUFBLFNBQUNta0MsRUFBcUJoQixFQUFjckQsRUFBTzRDLEdBQ3hEeUIsR0FBQUEsRUFBc0I1aUMsRUFBS3EvQixXQUFXOWdDLE9BQVMsRUFBRyxDQUVwRCxJQUFJc2tDLEVBQXFCakIsRUFBYTlCLGNBRWxDOS9CLEVBQUsyaEMsZUFDUGtCLEVBQXFCdEUsRUFBTXB1QixHQUd6QjB5QixFQUFxQjdpQyxFQUFLOGlDLHNCQUU1Qjk4QixZQUFXLFdBRUxoRyxFQUFLNmhDLHVCQUF5QlYsSUFDM0JsdkIsRUFBQUEsT0FBT2EsTUFBTUMsSUFBYmQscUNBQUFBLE9BQXNEa3ZCLElBQzNEbmhDLEVBQUtnc0IsVUFBVTRXLEVBQXNCLE1BRXRDLFNBa0RjbmtDLEVBQUFBLEtBQUFBLHdCQUFBQSxXQUFnQyxJQUEvQitPLEVBQStCLHdEQUFmdTFCLEVBQWUsd0RBQy9DbjVCLEVBQVk1SixFQUFLaVMsT0FBTzdRLE9BQU9nSyxXQUFXMmMsa0JBQWtCRSxvQkFDbEVqb0IsRUFBS3lILFNBQVN3NEIsTUFBTW4xQixVQUFVUCxVQUFVaUQsT0FBTzVELEVBQVc0RCxJQUVyREEsR0FBVXUxQixJQUNSN0IsRUFBQUEsYUFBZSxLQUNmVyxFQUFBQSxxQkFBdUIsU0F6Z0JacGpDLEVBQUFBLEtBQUFBLDRCQTZnQk8sV0FBVSxJQUFUK08sRUFBUyx3REFDN0I1RCxFQUFZNUosRUFBS2lTLE9BQU83USxPQUFPZ0ssV0FBVzJjLGtCQUFrQk0sd0JBQ2xFcm9CLEVBQUt5SCxTQUFTaTVCLFVBQVU1MUIsVUFBVVAsVUFBVWlELE9BQU81RCxFQUFXNEQsR0FFekRBLElBQ0UwekIsRUFBQUEsYUFBZSxLQUNmVyxFQUFBQSxxQkFBdUIsU0FuaEJacGpDLEVBQUFBLEtBQUFBLGdDQXVoQlcsWUFDekJ1QixFQUFLeUgsU0FBU3c0QixNQUFNL1gsZUFBZTBHLGFBQWUsSUFBTTV1QixFQUFLeUgsU0FBU3c0QixNQUFNL1gsZUFBZXdHLFlBQWMsTUFFdEdzVSxFQUFBQSxvQkFBQUEsRUFBcUIsSUExaEJWdmtDLEVBQUFBLEtBQUFBLCtCQStoQlUsV0FDdEIsSUFBRXlwQixFQUFtQmxvQixFQUFLeUgsU0FBU3c0QixNQUFuQyxlQUVGLEdBQUNqZ0MsRUFBS2dqQyxvQkFJSCxHQUFJOWEsRUFBZTBHLGFBQWUsSUFBTTFHLEVBQWV3RyxZQUFjLEdBQUksQ0FDOUUsSUFBTWx2QixFQUFhdUQsS0FBSzRlLE1BQU11RyxFQUFlMEcsYUFBZTV1QixFQUFLaWpDLGtCQUNqRS9hLEVBQWV6bUIsTUFBTWlCLE1BQXJCd2xCLEdBQUFBLE9BQWdDMW9CLEVBQWhDMG9CLEtBQWdDMW9CLE1BQzNCLEdBQUkwb0IsRUFBZTBHLGFBQWUsSUFBTTFHLEVBQWV3RyxZQUFjLEdBQUksQ0FDOUUsSUFBTXdVLEVBQWNuZ0MsS0FBSzRlLE1BQU11RyxFQUFld0csWUFBYzF1QixFQUFLaWpDLGtCQUNqRS9hLEVBQWV6bUIsTUFBTXNPLE9BQXJCbVksR0FBQUEsT0FBaUNnYixFQUFqQ2hiLEtBQWlDZ2IsTUFUTCxDQUN0QjFqQyxJQUFBQSxFQUFhdUQsS0FBSzRlLE1BQU0zaEIsRUFBSzhpQyxxQkFBdUI5aUMsRUFBS2lqQyxrQkFDL0QvYSxFQUFlem1CLE1BQU1zTyxPQUFyQm1ZLEdBQUFBLE9BQWlDbG9CLEVBQUs4aUMscUJBQXRDNWEsTUFDQUEsRUFBZXptQixNQUFNaUIsTUFBckJ3bEIsR0FBQUEsT0FBZ0Mxb0IsRUFBaEMwb0IsS0FTRmxvQixDQUFBQSxFQUFLbWpDLHNCQUFBQSxJQTlpQmExa0MsRUFBQUEsS0FBQUEsd0JBaWpCRyxXQUNmMmtDLElBQUFBLEVBQWVwakMsRUFBS2lTLE9BQU94SyxTQUFTdVEsU0FBU3hWLHdCQUM3QzZnQyxFQUFnQnJqQyxFQUFLaVMsT0FBT3hLLFNBQVNxRCxVQUFVdEksd0JBQzdDc0ksRUFBYzlLLEVBQUt5SCxTQUFTdzRCLE1BQTlCbjFCLFVBRUF3UCxFQUFNK29CLEVBQWN6Z0MsS0FBT3dnQyxFQUFheGdDLEtBQU8sR0FDL0NJLEVBQU1xZ0MsRUFBY0MsTUFBUUYsRUFBYXhnQyxLQUFPa0ksRUFBVTRqQixZQUFjLEdBRXhFbk8sRUFBV3ZnQixFQUFLZ2dDLFVBQVlvRCxFQUFheGdDLEtBQU9rSSxFQUFVNGpCLFlBQWMsRUFDeEU2VSxFQUFVcEYsR0FBTTVkLEVBQVVqRyxFQUFLdFgsR0FHckM4SCxFQUFVckosTUFBTW1CLEtBQWhCa0ksR0FBQUEsT0FBMEJ5NEIsRUFBMUJ6NEIsTUFHQUEsRUFBVXJKLE1BQU11YixZQUFZLHlCQUE2QnVELEVBQVdnakIsRUFBYixTQWhrQnJDOWtDLEVBQUFBLEtBQUFBLDZCQW9rQlEsV0FDcEIsTUFBb0JvZ0MsR0FBUzcrQixFQUFLaWpDLGlCQUFrQixDQUN4RHZnQyxNQUFPMUMsRUFBS2lTLE9BQU94RixNQUFNaWlCLFlBQ3pCM2UsT0FBUS9QLEVBQUtpUyxPQUFPeEYsTUFBTW1pQixlQUZwQmxzQixFQUFGLFFBQVNxTixFQUFULFNBSU4vUCxFQUFLeUgsU0FBU2k1QixVQUFVNTFCLFVBQVVySixNQUFNaUIsTUFBeEMxQyxHQUFBQSxPQUFtRDBDLEVBQW5EMUMsTUFDQUEsRUFBS3lILFNBQVNpNUIsVUFBVTUxQixVQUFVckosTUFBTXNPLE9BQXhDL1AsR0FBQUEsT0FBb0QrUCxFQUFwRC9QLEtBQW9EK1AsSUExa0JsQ3RSLEVBQUFBLEtBQUFBLHlCQThrQkksU0FBQ21qQyxFQUFjckQsR0FDckMsR0FBS3YrQixFQUFLMmhDLGFBQVYsQ0FHTTZCLElBQUFBLEVBQWF4akMsRUFBSzhpQyxxQkFBdUJ2RSxFQUFNcHVCLEVBR3JEeXhCLEVBQWFuZ0MsTUFBTXNPLE9BQVk2eEIsRUFBYTlCLGNBQWdCMEQsRUFBL0IsS0FFN0I1QixFQUFhbmdDLE1BQU1pQixNQUFXay9CLEVBQWFyVixhQUFlaVgsRUFBOUIsS0FFNUI1QixFQUFhbmdDLE1BQU1tQixLQUFuQmcvQixJQUFBQSxPQUE4QnJELEVBQU05dUIsRUFBSSt6QixFQUF4QzVCLE1BRUFBLEVBQWFuZ0MsTUFBTTBWLElBQW5CeXFCLElBQUFBLE9BQTZCckQsRUFBTTd1QixFQUFJOHpCLEVBQXZDNUIsS0FaOEIsQ0FZUzRCLElBMWxCbEN2eEIsS0FBQUEsT0FBU0EsRUFDVG90QixLQUFBQSxXQUFhLEdBQ2JqUCxLQUFBQSxRQUFBQSxFQUNMcHdCLEtBQUt5akMsa0JBQW9CalcsS0FBS0MsTUFDekI2UyxLQUFBQSxXQUFBQSxFQUNBVyxLQUFBQSxhQUFlLEdBRXBCamhDLEtBQUt5SCxTQUFXLENBQ2R3NEIsTUFBTyxDQUFDLEVBQ1JTLFVBQVcsQ0FBQyxHQUdkMWdDLEtBQUsyUyxNQUdIblIsQ3JDbEdHLCtCcUNrR0hBLFdBQ0YsT0FBT3hCLEtBQUtpUyxPQUFPekYsU0FBV3hNLEtBQUtpUyxPQUFPekIsU0FBV3hRLEtBQUtpUyxPQUFPN1EsT0FBTzJtQixrQkFBa0J2bUIsT0FxY3hGd2dDLEdyQ3hpQkcsaUNxQ3dpQkhBLFdBQ0YsT0FBT2hpQyxLQUFLc2dDLFVBQVl0Z0MsS0FBS3lILFNBQVNpNUIsVUFBVTUxQixVQUFZOUssS0FBS3lILFNBQVN3NEIsTUFBTS9YLGNBRzlFeVosR3JDNWlCRyx3QnFDNGlCSEEsV0FDRixPQUFPN2pDLE9BQU9hLEtBQUtxQixLQUFLcS9CLFdBQVcsR0FBR0ksT0FBTyxJQUFJMS9CLFNBQVMsSUFHeERrakMsR3JDaGpCRyw0QnFDZ2pCSEEsV0FDRSxPQUFBampDLEtBQUsyaEMsYUFDQTNoQyxLQUFLcS9CLFdBQVcsR0FBR0ksT0FBTyxHQUFHdnZCLEVBQUlsUSxLQUFLcS9CLFdBQVcsR0FBR0ksT0FBTyxHQUFHdHZCLEVBR2hFblEsS0FBS3EvQixXQUFXLEdBQUczOEIsTUFBUTFDLEtBQUtxL0IsV0FBVyxHQUFHdHZCLE1BR25EK3lCLEdyQ3hqQkcsZ0NxQ3dqQkhBLFdBQ0UsT0FBQTlpQyxLQUFLc2dDLFVBQ1l6QixHQUFTNytCLEtBQUtpakMsaUJBQWtCLENBQ2pEdmdDLE1BQU8xQyxLQUFLaVMsT0FBT3hGLE1BQU1paUIsWUFDekIzZSxPQUFRL1AsS0FBS2lTLE9BQU94RixNQUFNbWlCLGVBRnRCLE9BUUo1dUIsS0FBS2dqQyxtQkFDQWhqQyxLQUFLeUgsU0FBU3c0QixNQUFNL1gsZUFBZTBHLGFBR3JDN3JCLEtBQUs0ZSxNQUFNM2hCLEtBQUtpUyxPQUFPeEYsTUFBTWlpQixZQUFjMXVCLEtBQUtpakMsaUJBQW1CLEVBR3hFNUIsR3JDemtCRywrQnFDeWtCSEEsV0FDRixPQUFPcmhDLEtBQUtzZ0MsVUFBWXRnQyxLQUFLMGpDLDZCQUErQjFqQyxLQUFLMmpDLDRCQUcvRHRDLEVyQzdrQkcsSXFDNmtCSEEsU0FBb0JwZ0MsR0FDbEJqQixLQUFLc2dDLFVBQ0ZvRCxLQUFBQSw2QkFBK0J6aUMsRUFFL0IwaUMsS0FBQUEsNkJBQStCMWlDLENBQUFBLEtyQ2psQmpDLEtzQ1VIb0csR0FBUyxDQUVidThCLGVBQWVsZ0MsRUFBTTZFLEdBQUFBLElBQUFBLEVBQUFBLEtBQ2Y3SCxFQUFVNkgsR0FDWkssR0FBY2xGLEVBQU0xRCxLQUFLeU0sTUFBTyxDQUM5QmdHLElBQUtsSyxJQUVFN0gsRUFBUzZILElBQ2xCQSxFQUFXcEosU0FBUzZ3QixTQUFBQSxHQUNsQnBuQixHQUFjbEYsRUFBTTFELEVBQUt5TSxNQUFPdWpCLEVBQUFBLEdBQUFBLEVBT3RDNlQsT0FBTzEvQixHQUFBQSxJQUFBQSxFQUFBQSxLQUNBMkMsRUFBUTNDLEVBQU8sbUJBTXBCd04sR0FBTWlCLGVBQWUzUyxLQUFLRCxNQUcxQkEsS0FBS2k1QixRQUFRaDVCLEtBQ1hELE1BQ0EsV0FFRUEsRUFBS21OLFFBQVEyRSxRQUFVLEdBR3ZCakosR0FBYzdJLEVBQUt5TSxPQUNuQnpNLEVBQUt5TSxNQUFRLEtBR1QvTCxFQUFXVixFQUFLeUgsU0FBU3FELFlBQzNCOUssRUFBS3lILFNBQVNxRCxVQUFVMlYsZ0JBQWdCLFNBSXBDLElBQUVyWixFQUFrQmpELEVBQXBCLFFBQVdULEVBQVNTLEVBQXBCLFNBQ3dDaUQsRUFEeEMsVUFDQ3NFLFNBQUVBLE9BREgsTUFDY3lkLEdBQVV4WCxNQUR4QixFQUMrQmMsRUFEL0IsRUFDQ0EsSUFDRDJ2QixFQUF1QixVQUFiMTJCLEVBQXVCaEksRUFBTyxNQUN4QzZFLEVBQTBCLFVBQWJtRCxFQUF1QixDQUFDLEVBQUksQ0FBRStHLElBQUFBLEdBRWpEM1UsT0FBT3lKLE9BQU92SCxFQUFNLENBQ2xCMEwsU0FBQUEsRUFDQWhJLEtBQUFBLEVBRUF3SixVQUFXNUIsR0FBUUcsTUFBTS9ILEVBQU1nSSxFQUFVMUwsRUFBS29CLE9BQU91SyxhQUVyRGMsTUFBT25ILEdBQWM4OEIsRUFBUzc1QixLQUkzQmQsRUFBQUEsU0FBU3FELFVBQVUxQyxZQUFZcEksRUFBS3lNLE9BR3JDL0wsRUFBV3lELEVBQU1naEIsWUFDbkJubEIsRUFBS29CLE9BQU8rakIsU0FBV2hoQixFQUFNZ2hCLFVBSTNCbmxCLEVBQUt3TSxVQUNIeE0sRUFBS29CLE9BQU8waUMsYUFDZDlqQyxFQUFLeU0sTUFBTWhFLGFBQWEsY0FBZSxJQUVyQ3pJLEVBQUtvQixPQUFPK2pCLFVBQ2RubEIsRUFBS3lNLE1BQU1oRSxhQUFhLFdBQVksSUFFakMvSCxFQUFTeUQsRUFBTWtqQixVQUNsQnJuQixFQUFLcW5CLE9BQVNsakIsRUFBTWtqQixRQUVsQnJuQixFQUFLb0IsT0FBT3NrQixLQUFLdFUsUUFDbkJwUixFQUFLeU0sTUFBTWhFLGFBQWEsT0FBUSxJQUU5QnpJLEVBQUtvQixPQUFPa2IsT0FDZHRjLEVBQUt5TSxNQUFNaEUsYUFBYSxRQUFTLElBRS9CekksRUFBS29CLE9BQU91SyxhQUNkM0wsRUFBS3lNLE1BQU1oRSxhQUFhLGNBQWUsS0FLM0NxRCxHQUFHMGdCLGFBQWF2c0IsS0FBS0QsR0FHakJBLEVBQUt3TSxTQUNQbkYsR0FBT3U4QixlQUFlM2pDLEtBQUtELEVBQU0sU0FBVW9ILEdBSXhDaEcsRUFBQUEsT0FBTzBTLE1BQVEzUCxFQUFNMlAsTUFHMUJySCxHQUFNdUYsTUFBTS9SLEtBQUtELEdBR2JBLEVBQUt3TSxTQUVIMU8sT0FBT2EsS0FBS3dGLEdBQU9wRSxTQUFTLFdBQzlCc0gsR0FBT3U4QixlQUFlM2pDLEtBQUtELEVBQU0sUUFBU21FLEVBQU1pYixTQUtoRHBmLEVBQUt3TSxTQUFZeE0sRUFBS3loQixVQUFZemhCLEVBQUtrTixVQUFVcEIsS0FFbkRBLEdBQUcyZ0IsTUFBTXhzQixLQUFLRCxHQUlaQSxFQUFLd00sU0FDRkMsRUFBQUEsTUFBTWtHLE9BSVJqUyxFQUFTeUQsRUFBTTRqQixxQkFDbEJqcUIsT0FBT3lKLE9BQU92SCxFQUFLb0IsT0FBTzJtQixrQkFBbUI1akIsRUFBTTRqQixtQkFHL0MvbkIsRUFBSytuQixtQkFBcUIvbkIsRUFBSytuQixrQkFBa0JxSSxTQUM5Q3JJLEVBQUFBLGtCQUFrQmtSLFVBQ2xCbFIsRUFBQUEsa0JBQW9CLE1BSXZCL25CLEVBQUtvQixPQUFPMm1CLGtCQUFrQnZtQixVQUNoQ3hCLEVBQUsrbkIsa0JBQW9CLElBQUlpWCxHQUFrQmgvQixLQUs5Q21SLEVBQUFBLFdBQVcwRSxRQUFBQSxJQUFBQSxJQXRIbEI3VixLQUFLOFMsTUFBTTJGLEtBQUssMkJDT2hCc3JCLEd2Q25DRyxXdUNvQ1A1akMsU0FBQUEsRUFBWTRCLEVBQVFvTCxHQUFBQSxJQUFBQSxFQUFBQSxLQW9GbEIsR0FwRmtCQSxFQUFBQSxLQUFBQSxHQUFTMU8sRUFBQUEsS0FBQUEsUUE2VHRCLGtCQUNBaUMsRUFBWVYsRUFBS3lNLE1BQU1pRyxPQUt4QjFTLEVBQUt1bkIsS0FBT3ZuQixFQUFLdW5CLElBQUkvbEIsU0FDbEIrbEIsRUFBQUEsSUFBSThSLGVBQWUzcUIsTUFBSyxrQkFBTTFPLEVBQUt1bkIsSUFBSTdVLE1BQWYsSUFBdUIwRCxPQUFNLGtCQUFNekgsR0FBZTNPLEVBQUt5TSxNQUFNaUcsT0FBaEMsSUFJckQxUyxFQUFLeU0sTUFBTWlHLFFBVFQsSUFGSixJQTdUc0JqVSxFQUFBQSxLQUFBQSxTQThVckIsa0JBQ0R1QixFQUFLd25CLFNBQVk5bUIsRUFBWVYsRUFBS3lNLE1BQU1nTCxPQUl0Q3pYLEVBQUt5TSxNQUFNZ0wsUUFIVCxJQUZILElBOVVxQmhaLEVBQUFBLEtBQUFBLGNBc1hmMEYsU0FBQUEsR0FBQUEsT0FFR3pELEVBQVd5RCxHQUFTQSxHQUFTbkUsRUFBS3duQixTQUd4Q3huQixFQUFLMFMsT0FHUDFTLEVBQUt5WCxPQVJBdFQsSUF0WGUxRixFQUFBQSxLQUFBQSxRQW9ZdEIsV0FDRHVCLEVBQUt3TSxTQUNQeE0sRUFBS3lYLFFBQ0x6WCxFQUFLMFgsV0FDSWhYLEVBQVlWLEVBQUt5TSxNQUFNOG9CLE9BQzNCOW9CLEVBQUFBLE1BQU04b0IsTUFBQUEsSUF6WWM5MkIsRUFBQUEsS0FBQUEsV0FnWm5CLFdBQ0gyVCxFQUFBQSxZQUFjLEtBalpRM1QsRUFBQUEsS0FBQUEsVUF3Wm5Cb1YsU0FBQUEsR0FDUjdULEVBQUtvUyxhQUFlMVIsRUFBVW1ULEdBQVlBLEVBQVc3VCxFQUFLb0IsT0FBT3lTLFFBQUFBLElBelp0Q3BWLEVBQUFBLEtBQUFBLFdBZ2FsQm9WLFNBQUFBLEdBQ1Q3VCxFQUFLb1MsYUFBZTFSLEVBQVVtVCxHQUFZQSxFQUFXN1QsRUFBS29CLE9BQU95UyxRQUFBQSxJQWphdENwVixFQUFBQSxLQUFBQSxrQkFnaUJYOGIsU0FBQUEsR0FDVnBDLElBQUFBLEVBQVNuWSxFQUFLeU0sTUFBTTZQLE1BQVEsRUFBSXRjLEVBQUttWSxPQUMzQ25ZLEVBQUttWSxPQUFTQSxHQUFVelgsRUFBVTZaLEdBQVFBLEVBQU8sTUFsaUJ0QjliLEVBQUFBLEtBQUFBLGtCQXlpQlg4YixTQUFBQSxHQUNYdVcsRUFBQUEsZ0JBQWdCdlcsRUFBQUEsSUExaUJNOWIsRUFBQUEsS0FBQUEsV0FzL0JuQixXQUVKNk0sR0FBUWMsU0FDTEssRUFBQUEsTUFBTXUzQixnQ0FBQUEsSUF6L0JjdmxDLEVBQUFBLEtBQUFBLGtCQWlnQ1grTyxTQUFBQSxHQUVaLEtBQUtOLFVBQVVwQixLQUFPOUwsRUFBS2t2QixRQUFTLENBRXRDLElBQU0rVSxFQUFXeDVCLEdBQVN6SyxFQUFLeUgsU0FBU3FELFVBQVc5SyxFQUFLb0IsT0FBT2dLLFdBQVdtYSxjQUVwRWxiLE9BQUFBLElBQWVtRCxPQUFBQSxHQUFzQ0EsRUFFckQwMkIsRUFBUzk1QixHQUFZcEssRUFBS3lILFNBQVNxRCxVQUFXOUssRUFBS29CLE9BQU9nSyxXQUFXbWEsYUFBY2xiLEdBYXJGNjVCLEdBVEZBLEdBQ0F4akMsRUFBU1YsRUFBS29CLE9BQU8wVixXQUNyQjlXLEVBQUtvQixPQUFPMFYsU0FBUy9XLFNBQVMsY0FDN0JXLEVBQVNWLEVBQUtvQixPQUFPMFcsV0FFdEJoQixHQUFTbUosV0FBV2hnQixLQUFLRCxHQUFBQSxHQUl2QmtrQyxJQUFXRCxFQUFVLENBQ3ZCLElBQU1FLEVBQVlELEVBQVMsaUJBQW1CLGdCQUM5Q2oyQixHQUFhaE8sS0FBS0QsRUFBTUEsRUFBS3lNLE1BQU8wM0IsRUFHdEMsUUFBUUQsQ0FHVixRQUFPLEtBOWhDb0J6bEMsRUFBQUEsS0FBQUEsTUFzaUN4QixTQUFDb0gsRUFBTzBILEdBQ1hLLEdBQUczTixLQUFLRCxFQUFNQSxFQUFLeUgsU0FBU3FELFVBQVdqRixFQUFPMEgsRUFBQUEsSUF2aUNuQjlPLEVBQUFBLEtBQUFBLFFBK2lDdEIsU0FBQ29ILEVBQU8wSCxHQUNiTyxHQUFLN04sS0FBS0QsRUFBTUEsRUFBS3lILFNBQVNxRCxVQUFXakYsRUFBTzBILEVBQUFBLElBaGpDckI5TyxFQUFBQSxLQUFBQSxPQXdqQ3ZCLFNBQUNvSCxFQUFPMEgsR0FDWk0sR0FBSTdOLEVBQUt5SCxTQUFTcUQsVUFBV2pGLEVBQU8wSCxFQUFBQSxJQXpqQ1Q5TyxFQUFBQSxLQUFBQSxXQW1rQ25CLFNBQUM4TyxHQUFpQixJQUFQNjJCLEVBQU8sd0RBQ3RCLEdBQUNwa0MsRUFBS3VPLE1BQU4sQ0FJRTJoQixJQUFBQSxFQUFPLFdBRVhyd0IsU0FBU2lFLEtBQUtyQyxNQUFNb29CLFNBQVcsR0FHL0I3cEIsRUFBS3NRLE1BQVEsS0FHVDh6QixHQUNFdG1DLE9BQU9hLEtBQUtxQixFQUFLeUgsVUFBVWxKLFNBRTdCc0ssR0FBYzdJLEVBQUt5SCxTQUFTK1AsUUFBUTlFLE1BQ3BDN0osR0FBYzdJLEVBQUt5SCxTQUFTc1EsVUFDNUJsUCxHQUFjN0ksRUFBS3lILFNBQVNxUCxVQUM1QmpPLEdBQWM3SSxFQUFLeUgsU0FBU0MsU0FHNUIxSCxFQUFLeUgsU0FBUytQLFFBQVE5RSxLQUFPLEtBQzdCMVMsRUFBS3lILFNBQVNzUSxTQUFXLEtBQ3pCL1gsRUFBS3lILFNBQVNxUCxTQUFXLEtBQ3pCOVcsRUFBS3lILFNBQVNDLFFBQVUsTUFJdEJoSCxFQUFZNk0sSUFDZEEsTUFJRmMsR0FBZ0JwTyxLQUFLRCxHQUdyQjJSLEdBQU1pQixlQUFlM1MsS0FBS0QsR0FHMUJrSixHQUFlbEosRUFBS3lILFNBQVM0OEIsU0FBVXJrQyxFQUFLeUgsU0FBU3FELFdBR3JEbUQsR0FBYWhPLEtBQUtELEVBQU1BLEVBQUt5SCxTQUFTNDhCLFNBQVUsZ0JBRzVDM2pDLEVBQVk2TSxJQUNkQSxFQUFTdE4sS0FBS0QsRUFBS3lILFNBQVM0OEIsVUFJOUJya0MsRUFBS3VPLE9BQUFBLEVBR0x2SSxZQUFXLFdBQ0p5QixFQUFBQSxTQUFXLEtBQ1hnRixFQUFBQSxNQUFRLE9BQ1osT0FLRjhvQixFQUFBQSxPQUdMcEksYUFBYW50QixFQUFLb3RCLE9BQU8xRixTQUN6QnlGLGFBQWFudEIsRUFBS290QixPQUFPdFcsVUFDekJxVyxhQUFhbnRCLEVBQUtvdEIsT0FBTzZCLFNBR3JCanZCLEVBQUt3TSxTQUVQVixHQUFHNE0scUJBQXFCelksS0FBS0QsR0FBQUEsR0FHN0Jrd0IsS0FDU2x3QixFQUFLd2pCLFdBRWQ4VSxjQUFjdDRCLEVBQUtvdEIsT0FBT21MLFdBQzFCRCxjQUFjdDRCLEVBQUtvdEIsT0FBTzVGLFNBR1AsT0FBZnhuQixFQUFLc1EsT0FBa0I1UCxFQUFZVixFQUFLc1EsTUFBTTJvQixVQUMzQzNvQixFQUFBQSxNQUFNMm9CLFVBSWIvSSxLQUNTbHdCLEVBQUs0USxVQUdLLE9BQWY1USxFQUFLc1EsT0FDUHRRLEVBQUtzUSxNQUFNZzBCLFNBQVM1MUIsS0FBS3doQixHQUkzQmxxQixXQUFXa3FCLEVBQU0sS0E5RlgsQ0E4RlcsSUFRVHhzQixFQUFBQSxLQUFBQSxZQUFBQSxTQUFBQSxHQUFBQSxPQUFTNEgsR0FBUWdCLEtBQUtyTSxLQUFLRCxFQUFNMEQsRUFBakNBLElBMXFDVjFELEtBQUtvdEIsT0FBUyxDQUFDLEVBR1Y3ZSxLQUFBQSxPQUFBQSxFQUNBbVosS0FBQUEsU0FBQUEsRUFDTDFuQixLQUFLdWtDLFFBQUFBLEVBR0x2a0MsS0FBSzZNLE1BQVF2QixHQUFRdUIsTUFHckI3TSxLQUFLeU0sTUFBUTFLLEVBR1RyQixFQUFVVixLQUFLeU0sU0FDWkEsS0FBQUEsTUFBUTVNLFNBQVNDLGlCQUFpQkUsS0FBS3lNLFNBSXpDMUgsT0FBT3kvQixRQUFVeGtDLEtBQUt5TSxpQkFBaUIrM0IsUUFBVzlqQyxFQUFZVixLQUFLeU0sUUFBVS9MLEVBQVNWLEtBQUt5TSxVQUU5RnpNLEtBQUt5TSxNQUFRek0sS0FBS3lNLE1BQU0sSUFJMUJ6TSxLQUFLb0IsT0FBUytGLEVBQ1osQ0FBQyxFQUNEN0gsR0FDQXlrQyxFQUFLemtDLFNBQ0w2TixHQUFXLENBQUMsRUFDWixXQUNNLElBQ0ttSCxPQUFBQSxLQUFLakUsTUFBTXJRLEVBQUt5TSxNQUFNckssYUFBYSxvQkFFbkMsQ0FEUCxNQUFPZ0QsR0FDUCxNQUFPLENBQUMsQ0FBRCxFQUpYLElBVUZwRixLQUFLeUgsU0FBVyxDQUNkcUQsVUFBVyxLQUNYcUcsV0FBWSxLQUNaNEcsU0FBVSxLQUNWUCxRQUFTLENBQUMsRUFDVlksUUFBUyxDQUFDLEVBQ1ZKLFNBQVUsQ0FBQyxFQUNYQyxPQUFRLENBQUMsRUFDVEgsU0FBVSxDQUNSZ0ksTUFBTyxLQUNQckcsS0FBTSxLQUNOaUYsT0FBUSxDQUFDLEVBQ1RsSCxRQUFTLENBQUMsSUFLZHhYLEtBQUsrWCxTQUFXLENBQ2QzRyxPQUFRLEtBQ1I4SyxjQUFlLEVBQ2Y2SCxLQUFNLElBQUkwZ0IsU0FJWnprQyxLQUFLbVIsV0FBYSxDQUNoQkMsUUFBUSxHQUlWcFIsS0FBS21OLFFBQVUsQ0FDYitFLE1BQU8sR0FDUEosUUFBUyxJQUtOZ0IsS0FBQUEsTUFBUSxJQUFJd1csR0FBUXRwQixLQUFLb0IsT0FBTzBSLE9BR3JDOVMsS0FBSzhTLE1BQU1DLElBQUksU0FBVS9TLEtBQUtvQixRQUN6QjBSLEtBQUFBLE1BQU1DLElBQUksVUFBV3pILEtBR3RCNUssRUFBbUJWLEtBQUt5TSxRQUFXL0wsRUFBV1YsS0FBS3lNLE9BTXZELEdBQUl6TSxLQUFLeU0sTUFBTTJCLEtBQ2JwTyxLQUFLOFMsTUFBTTJGLEtBQUssNkJBS2xCLEdBQUt6WSxLQUFLb0IsT0FBT0ksUUFPakIsR0FBSzhKLEdBQVFHLFFBQVFJLElBQXJCLENBTU15VSxJQUFBQSxFQUFRdGdCLEtBQUt5TSxNQUFNMUUsV0FBQUEsR0FDekJ1WSxFQUFNNkUsVUFBQUEsRUFDTm5sQixLQUFLeUgsU0FBUzQ4QixTQUFXL2pCLEVBSW5CNWMsSUFBQUEsRUFBTzFELEtBQUt5TSxNQUFNMjFCLFFBQVE3dUIsY0FFNUIwVCxFQUFTLEtBQ1RyUyxFQUFNLEtBR1YsT0FBUWxSLEdBQ04sSUFBSyxNQUtILEdBSEF1akIsRUFBU2puQixLQUFLeU0sTUFBTXZMLGNBQWMsVUFHOUJSLEVBQVd1bUIsSUFhYixHQVhBclMsRUFBTXVPLEdBQVM4RCxFQUFPN2tCLGFBQWEsUUFDOUJzSixLQUFBQSxTZnZKUixTQUEwQmtKLEdBRS9CLE1BQUksOEVBQThFbk8sS0FBS21PLEdBQzlFdVUsR0FBVXhWLFFBSWYsd0RBQXdEbE4sS0FBS21PLEdBQ3hEdVUsR0FBVXRZLE1BR1osSWU0SWlCNnpCLENmdkpuQixDZXVKb0M5dkIsRUFBSTNCLFlBR3JDalQsS0FBS3lILFNBQVNxRCxVQUFZOUssS0FBS3lNLE1BQy9Cek0sS0FBS3lNLE1BQVF3YSxFQUdSeGYsS0FBQUEsU0FBU3FELFVBQVVsQixVQUFZLEdBR2hDZ0wsRUFBSSt2QixPQUFPcG1DLE9BQVEsQ0FDckIsSUFBTXFtQyxFQUFTLENBQUMsSUFBSyxRQUVqQkEsRUFBTzdrQyxTQUFTNlUsRUFBSWl3QixhQUFhdmhDLElBQUksZUFDdkN0RCxLQUFLb0IsT0FBTytqQixVQUFBQSxHQUVWeWYsRUFBTzdrQyxTQUFTNlUsRUFBSWl3QixhQUFhdmhDLElBQUksV0FDdkN0RCxLQUFLb0IsT0FBT3NrQixLQUFLdFUsUUFBQUEsR0FLZnBSLEtBQUt3akIsV0FDUHhqQixLQUFLb0IsT0FBT3VLLFlBQWNpNUIsRUFBTzdrQyxTQUFTNlUsRUFBSWl3QixhQUFhdmhDLElBQUksZ0JBQy9EdEQsS0FBS29CLE9BQU91UyxRQUFRMmpCLEdBQUsxaUIsRUFBSWl3QixhQUFhdmhDLElBQUksT0FFOUN0RCxLQUFLb0IsT0FBT3VLLGFBQUFBLENBQWMsT0FLOUIzTCxLQUFLMEwsU0FBVzFMLEtBQUt5TSxNQUFNckssYUFBYXBDLEtBQUtvQixPQUFPbUgsV0FBVytILE1BQU01RSxVQUdoRWUsS0FBQUEsTUFBTWdVLGdCQUFnQnpnQixLQUFLb0IsT0FBT21ILFdBQVcrSCxNQUFNNUUsVUFJMUQsR0FBSWhMLEVBQVNWLEtBQUswTCxZQUFjNU4sT0FBTytoQixPQUFPc0osSUFBV3BwQixTQUFTQyxLQUFLMEwsVUFFckUsWUFEQTFMLEtBQUs4UyxNQUFNeUMsTUFBTSxrQ0FLbkJ2VixLQUFLMEQsS0FBTzBsQixHQUVaLE1BRUYsSUFBSyxRQUNMLElBQUssUUFDRTFsQixLQUFBQSxLQUFPQSxFQUNaMUQsS0FBSzBMLFNBQVd5ZCxHQUFVeFgsTUFHdEIzUixLQUFLeU0sTUFBTXdqQixhQUFhLGlCQUMxQmp3QixLQUFLb0IsT0FBTzBpQyxhQUFBQSxHQUVWOWpDLEtBQUt5TSxNQUFNd2pCLGFBQWEsY0FDMUJqd0IsS0FBS29CLE9BQU8rakIsVUFBQUEsSUFFVm5sQixLQUFLeU0sTUFBTXdqQixhQUFhLGdCQUFrQmp3QixLQUFLeU0sTUFBTXdqQixhQUFhLHlCQUNwRWp3QixLQUFLb0IsT0FBT3VLLGFBQUFBLEdBRVYzTCxLQUFLeU0sTUFBTXdqQixhQUFhLFdBQzFCandCLEtBQUtvQixPQUFPa2IsT0FBQUEsR0FFVnRjLEtBQUt5TSxNQUFNd2pCLGFBQWEsVUFDMUJqd0IsS0FBS29CLE9BQU9za0IsS0FBS3RVLFFBQUFBLEdBR25CLE1BRUYsUUFFRSxZQURBcFIsS0FBSzhTLE1BQU15QyxNQUFNLGtDQUtyQnZWLEtBQUtrTixVQUFZNUIsR0FBUUcsTUFBTXpMLEtBQUswRCxLQUFNMUQsS0FBSzBMLFNBQVUxTCxLQUFLb0IsT0FBT3VLLGFBR2hFM0wsS0FBS2tOLFVBQVVyQixLQUtwQjdMLEtBQUsyTixlQUFpQixHQUdqQjlMLEtBQUFBLFVBQVksSUFBSWdzQixHQUFVN3RCLE1BRzFCdVUsS0FBQUEsUUFBVSxJQUFJTixHQUFRalUsTUFHM0JBLEtBQUt5TSxNQUFNMkIsS0FBT3BPLEtBR2JVLEVBQVdWLEtBQUt5SCxTQUFTcUQsYUFDNUI5SyxLQUFLeUgsU0FBU3FELFVBQVl4RixHQUFjLE1BQU8sQ0FBRXcvQixTQUFVLElBQzNEdDlCLEdBQUt4SCxLQUFLeU0sTUFBT3pNLEtBQUt5SCxTQUFTcUQsWUFJakNnQixHQUFHNGhCLGNBQWN6dEIsS0FBS0QsTUFHdEI4TCxHQUFHMGdCLGFBQWF2c0IsS0FBS0QsTUFHckJ5TSxHQUFNdUYsTUFBTS9SLEtBQUtELE1BR2JBLEtBQUtvQixPQUFPMFIsT0FDZGxGLEdBQUczTixLQUFLRCxLQUFNQSxLQUFLeUgsU0FBU3FELFVBQVc5SyxLQUFLb0IsT0FBT21FLE9BQU8rVCxLQUFLLE1BQU96VCxTQUFBQSxHQUMvRGlOLEVBQUFBLE1BQU1DLElBQU5ELFVBQUFBLE9BQW9Cak4sRUFBTW5DLE1BQUFBLElBSzlCeU4sS0FBQUEsV0FBYSxJQUFJcVksR0FBV3hwQixPQUk3QkEsS0FBS3dNLFNBQVl4TSxLQUFLeWhCLFVBQVl6aEIsS0FBS2tOLFVBQVVwQixLQUNuREEsR0FBRzJnQixNQUFNeHNCLEtBQUtELE1BSWhCQSxLQUFLNkIsVUFBVWlKLFlBR2Y5SyxLQUFLNkIsVUFBVWlrQixTQUdYOWxCLEtBQUtvQixPQUFPbW1CLElBQUkvbEIsVUFDbEJ4QixLQUFLdW5CLElBQU0sSUFBSXNSLEdBQUk3NEIsT0FJakJBLEtBQUt3TSxTQUFXeE0sS0FBS29CLE9BQU8rakIsVUFDekJyWCxLQUFBQSxLQUFLLFdBQVcsa0JBQU1hLEdBQWUzTyxFQUFLMFMsT0FBMUIsSUFJdkIxUyxLQUFLdXRCLGFBQWUsRUFHaEJ2dEIsS0FBS29CLE9BQU8ybUIsa0JBQWtCdm1CLFVBQ2hDeEIsS0FBSytuQixrQkFBb0IsSUFBSWlYLEdBQWtCaC9CLFFBbkUvQ0EsS0FBSzhTLE1BQU15QyxNQUFNLDJCQTNHakIsTUFEQXZWLEtBQUs4UyxNQUFNeUMsTUFBTSxpQ0FQakJ2VixLQUFLOFMsTUFBTXlDLE1BQU0seUNBWmpCdlYsS0FBSzhTLE1BQU15QyxNQUFNLDJDQTZNakIvSSxDdkN0VUcsK0J1Q3NVSEEsV0FDRixPQUFPeE0sS0FBSzBMLFdBQWF5ZCxHQUFVeFgsS0FHakM4UCxHdkMxVUcsbUJ1QzBVSEEsV0FDRixPQUFPemhCLEtBQUt3akIsV0FBYXhqQixLQUFLNFEsT0FHNUI0UyxHdkM5VUcscUJ1QzhVSEEsV0FDRixPQUFPeGpCLEtBQUswTCxXQUFheWQsR0FBVXhWLE9BR2pDL0MsR3ZDbFZHLG1CdUNrVkhBLFdBQ0YsT0FBTzVRLEtBQUswTCxXQUFheWQsR0FBVXRZLEtBR2pDTCxHdkN0VkcsbUJ1Q3NWSEEsV0FDRixPQUFPeFEsS0FBSzBELE9BQVMwbEIsRUFHbkI4RixHdkMxVkcsbUJ1QzBWSEEsV0FDRixNZnBWSyxVZW9WRWx2QixLQUFLMEQsSUFrQ1Y4akIsR3ZDN1hHLG1CdUM2WEhBLFdBQ0YsT0FBT3BqQixRQUFRcEUsS0FBS3VPLFFBQVV2TyxLQUFLcVMsU0FBV3JTLEtBQUttdkIsTUFNakQ5YyxHdkNwWUcsa0J1Q29ZSEEsV0FDRixPQUFPak8sUUFBUXBFLEtBQUt5TSxNQUFNNEYsT0FNeEJvVixHdkMzWUcsbUJ1QzJZSEEsV0FDS3JqQixPQUFBQSxRQUFRcEUsS0FBS3FTLFFBQStCLElBQXJCclMsS0FBS29TLFlBTWpDK2MsR3ZDbFpHLGlCdUNrWkhBLFdBQ0YsT0FBTy9xQixRQUFRcEUsS0FBS3lNLE1BQU0waUIsTUF5RHhCL2MsR3ZDNWNHLHVCdUMrZEhBLFdBQ0YsT0FBTzVOLE9BQU94RSxLQUFLeU0sTUFBTTJGLFlBTXZCMEssRXZDdGVHLEl1QzRjSDFLLFNBQVlqTyxHQUVWLEdBQUNuRSxLQUFLc1ksU0FBTixDQUtKLElBQU15c0IsRUFBZXJrQyxFQUFVeUQsSUFBVUEsRUFBUSxFQUdqRG5FLEtBQUt5TSxNQUFNMkYsWUFBYzJ5QixFQUFlaGlDLEtBQUt1WCxJQUFJblcsRUFBT25FLEtBQUtzWSxVQUFZLEVBR3pFdFksS0FBSzhTLE1BQU1DLElBQVgvUyxjQUFBQSxPQUE2QkEsS0FBS29TLFlBQWxDcFMsWUFWUSxDQWdCTm9TLEd2Qy9kRyxvQnVDc2VIMEssV0FDSSxJQUFFQSxFQUFhOWMsS0FBS3lNLE1BQXBCLFNBR04sT0FBSS9MLEVBQVVvYyxHQUNMQSxFQU1MQSxHQUFZQSxFQUFTdmUsUUFBVXlCLEtBQUtzWSxTQUFXLEVBQzFDd0UsRUFBUzZKLElBQUksR0FBSzNtQixLQUFLc1ksU0FHekIsQ0FNTDJGLEd2QzNmRyxtQnVDMmZIQSxXQUNGLE9BQU83WixRQUFRcEUsS0FBS3lNLE1BQU13UixRQU14QjNGLEd2Q2xnQkcsb0J1Q2tnQkhBLFdBRUkwc0IsSUFBQUEsRUFBZTdpQyxXQUFXbkMsS0FBS29CLE9BQU9rWCxVQUV0QzJzQixHQUFnQmpsQyxLQUFLeU0sT0FBUyxDQUFDLEdBQUc2TCxTQUNsQ0EsRUFBWTVYLEVBQVV1a0MsSUFBaUJBLElBQWlCQyxJQUFlRCxFQUFKLEVBR2xFRCxPQUFBQSxHQUFnQjFzQixDQU9yQkgsR3ZDamhCRyxrQnVDNGpCSEEsV0FDRixPQUFPM1QsT0FBT3hFLEtBQUt5TSxNQUFNMEwsT0F3QnZCbUUsRXZDcmxCRyxJdUNpaEJIbkUsU0FBT3RhLEdBQUFBLElBQ0xzYSxFQUFTdGEsRUFJVDZDLEVBQVV5WCxLQUNaQSxFQUFTM1QsT0FBTzJULElBSWJ6WCxFQUFVeVgsS0FDYkEsRUFBU25ZLEtBQUt1VSxRQUFRalIsSUFBSSxXQUl2QjVDLEVBQVV5WCxLQUNWQSxFQUFXblksS0FBS29CLE9BQWhCK1csUUFJREEsRUFsQlEsSUFtQlZBLEVBbkJVLEdBc0JSQSxFQXJCUSxJQXNCVkEsRUF0QlUsR0EwQlpuWSxLQUFLb0IsT0FBTytXLE9BQVNBLEVBR3JCblksS0FBS3lNLE1BQU0wTCxPQUFTQSxHQUdmelgsRUFBUzdDLElBQVVtQyxLQUFLc2MsT0FBU25FLEVBQVMsSUFDeENtRSxLQUFBQSxPQUFBQSxFQU9MbkUsR3ZDNWpCRyxpQnVDNG1CSG1FLFdBQ0YsT0FBT2xZLFFBQVFwRSxLQUFLeU0sTUFBTTZQLE1BTXhCNm9CLEV2Q25uQkcsSXVDcWxCSDdvQixTQUFNekUsR0FDUixJQUFJckssRUFBU3FLLEVBR1JuWCxFQUFXOE0sS0FDZEEsRUFBU3hOLEtBQUt1VSxRQUFRalIsSUFBSSxVQUl2QjVDLEVBQVc4TSxLQUNkQSxFQUFTeE4sS0FBS29CLE9BQU9rYixPQUl2QnRjLEtBQUtvQixPQUFPa2IsTUFBUTlPLEVBR3BCeE4sS0FBS3lNLE1BQU02UCxNQUFROU8sQ0FNakI4TyxHdkM1bUJHLG9CdUNtbkJINm9CLFdBRUUsT0FBQ25sQyxLQUFLd00sV0FJTnhNLEtBQUtrdkIsU0FNUDlxQixRQUFRcEUsS0FBS3lNLE1BQU0yNEIsY0FDbkJoaEMsUUFBUXBFLEtBQUt5TSxNQUFNNDRCLDhCQUNuQmpoQyxRQUFRcEUsS0FBS3lNLE1BQU02NEIsYUFBZXRsQyxLQUFLeU0sTUFBTTY0QixZQUFZL21DLE9BUXpEMlQsR3ZDem9CRyxpQnVDMHFCSEEsV0FDRixPQUFPMU4sT0FBT3hFLEtBQUt5TSxNQUFNK0YsYUFNdkJtTixFdkNqckJHLEl1Q3lvQkh6TixTQUFNL04sR0FBQUEsSUFBQUEsRUFBQUEsS0FDSitOLEVBQVEsS0FFUnhSLEVBQVV5RCxLQUNaK04sRUFBUS9OLEdBR0x6RCxFQUFVd1IsS0FDYkEsRUFBUWxTLEtBQUt1VSxRQUFRalIsSUFBSSxVQUd0QjVDLEVBQVV3UixLQUNiQSxFQUFRbFMsS0FBS29CLE9BQU84USxNQUFNeVQsVUFJdEIsSUFBZ0JyTCxFQUEyQnRhLEtBQXpDMmYsYUFBaUMzYyxFQUFRaEQsS0FBdEI0ZixhQUMzQjFOLEVBQVFpc0IsR0FBTWpzQixFQUFPb0ksRUFBS3RYLEdBR3JCNUIsS0FBQUEsT0FBTzhRLE1BQU15VCxTQUFXelQsRUFHN0JsTSxZQUFXLFdBQ0xoRyxFQUFLeU0sUUFDUHpNLEVBQUt5TSxNQUFNK0YsYUFBZU4sRUFBQUEsR0FFM0IsRUFNREEsR3ZDMXFCRyx3QnVDaXJCSHlOLFdBQ0UsT0FBQTNmLEtBQUt3akIsVUFFQXpnQixLQUFLdVgsSUFBTHZYLE1BQUFBLEtBQUFBLEVBQVkvQyxLQUFLbU4sUUFBUStFLFFBRzlCbFMsS0FBSzRRLFFBRUEsR0FJRixLQU1MZ1AsR3ZDbnNCRyx3QnVDbXNCSEEsV0FDRSxPQUFBNWYsS0FBS3dqQixVQUVBemdCLEtBQUtDLElBQUxELE1BQUFBLEtBQUFBLEVBQVkvQyxLQUFLbU4sUUFBUStFLFFBRzlCbFMsS0FBSzRRLFFBRUEsRUFJRixFQVFMa0IsR3ZDdnRCRyxtQnVDZ3dCSEEsV0FDSyxPQUFBOVIsS0FBS3lNLE1BQU1xRixPQVFoQjRULEV2Q3p3QkcsSXVDdXRCSDVULFNBQVEzTixHQUNWLElBQU0vQyxFQUFTcEIsS0FBS29CLE9BQU8wUSxRQUNyQjNFLEVBQVVuTixLQUFLbU4sUUFBUTJFLFFBRTdCLEdBQUszRSxFQUFRNU8sT0FBYixDQUlBLElBQUl1VCxFQUFVLEVBQ1hwUixFQUFTeUQsSUFBVUssT0FBT0wsR0FDM0JuRSxLQUFLdVUsUUFBUWpSLElBQUksV0FDakJsQyxFQUFPdWtCLFNBQ1B2a0IsRUFBT3VkLFNBQ1AvWSxLQUFLbEYsR0FFSDZrQyxHQUFBQSxFQUVKLElBQUtwNEIsRUFBUXBOLFNBQVMrUixHQUFVLENBQzlCLElBQU1qVSxFQUFRa1IsR0FBUTVCLEVBQVMyRSxHQUMxQmdCLEtBQUFBLE1BQU0yRixLQUFOM0YsK0JBQUFBLE9BQTBDaEIsRUFBMUNnQixZQUFBQSxPQUE0RGpWLEVBQTVEaVYsYUFDTGhCLEVBQVVqVSxFQUdWMG5DLEdBQUFBLENBSUZua0MsQ0FBQUEsRUFBT3VrQixTQUFXN1QsRUFHbEI5UixLQUFLeU0sTUFBTXFGLFFBQVVBLEVBR2pCeXpCLEdBQ0doeEIsS0FBQUEsUUFBUXpTLElBQUksQ0FBRWdRLFFBQUFBLEdBN0JiLENBb0NOQSxHdkNod0JHLGdCdUM2ekJINFQsV0FDRixPQUFPdGhCLFFBQVFwRSxLQUFLeU0sTUFBTWlaLEtBT3hCcmUsRXZDcjBCRyxJdUN5d0JIcWUsU0FBS3ZoQixHQUNQLElBQU1xSixFQUFTOU0sRUFBV3lELEdBQVNBLEVBQVFuRSxLQUFLb0IsT0FBT3NrQixLQUFLdFUsT0FDNURwUixLQUFLb0IsT0FBT3NrQixLQUFLdFUsT0FBUzVELEVBQzFCeE4sS0FBS3lNLE1BQU1pWixLQUFPbFksQ0FpRGhCa1ksR3ZDN3pCRyxrQnVDNDBCSHJlLFdBQ0ssT0FBQXJILEtBQUt5TSxNQUFNbXBCLFVBTWhCNVUsRXZDbjFCRyxJdUNxMEJIM1osU0FBT2xELEdBQ1RrRCxHQUFPdzhCLE9BQU81akMsS0FBS0QsS0FBTW1FLEVBTXZCa0QsR3ZDNTBCRyxvQnVDbTFCSDJaLFdBQ0ksSUFBRUEsRUFBYWhoQixLQUFLb0IsT0FBT29nQixLQUEzQixTQUVDOWdCLE9BQUFBLEVBQU9zZ0IsR0FBWUEsRUFBV2hoQixLQUFLcUgsTUFNeEMyWixFdkM1MUJHLEl1QzQxQkhBLFNBQVM3YyxHQUNOekQsRUFBT3lELEtBSVpuRSxLQUFLb0IsT0FBT29nQixLQUFLUixTQUFXN2MsRUFFNUIyUyxHQUFTaUssZUFBZTlnQixLQUFLRCxNQU8zQnFuQixHdkMxMkJHLGtCdUNzM0JIQSxXQUNFLE9BQUNybkIsS0FBS3dRLFFBSUh4USxLQUFLeU0sTUFBTXJLLGFBQWEsV0FBYXBDLEtBQUt5TSxNQUFNckssYUFBYSxlQUgzRCxJQVNQME4sRXZDajRCRyxJdUMwMkJIdVgsU0FBT2xqQixHQUNKbkUsS0FBS3dRLFFBS1YxRSxHQUFHOGdCLFVBQVUzc0IsS0FBS0QsS0FBTW1FLEdBQUFBLEdBQWNpUyxPQUFNLGVBSjFDcFcsS0FBSzhTLE1BQU0yRixLQUFLLG1DQVVoQjRPLEd2Q3QzQkcsaUJ1Q2k0Qkh2WCxXQUNFLElBQUM5UCxLQUFLd1EsUUFDUixPQUFPLEtBR0hWLElBQUFBLEVBQVFELEdBQWtCTyxHQUFlblEsS0FBS0QsT0FFcEQsT0FBT1UsRUFBU29QLEdBQVNBLEVBQU13SixLQUFLLEtBQU94SixDQU16Q0EsRXZDOTRCRyxJdUM4NEJIQSxTQUFNM0wsR0FDSG5FLEtBQUt3USxRQUtMOVAsRUFBVXlELElBQVd3TCxHQUFvQnhMLElBSzlDbkUsS0FBS29CLE9BQU8wTyxNQUFRRCxHQUFrQjFMLEdBRXRDb00sR0FBZXRRLEtBQUtELE9BTmxCQSxLQUFLOFMsTUFBTXlDLE1BQVh2VixtQ0FBQUEsT0FBb0RtRSxFQUFwRG5FLE1BTEFBLEtBQUs4UyxNQUFNMkYsS0FBSyx5Q0FrQmhCME0sR3ZDbDZCRyxvQnVDeTZCSEEsV0FDRixPQUFPL2dCLFFBQVFwRSxLQUFLb0IsT0FBTytqQixTQU83QjBLLEV2Q2o3Qk8sSXVDazZCSDFLLFNBQVNoaEIsR0FDWG5FLEtBQUtvQixPQUFPK2pCLFNBQVd6a0IsRUFBV3lELEdBQVNBLEVBQVFuRSxLQUFLb0IsT0FBTytqQixRQU03REEsR3ZDejZCRyw0QnVDaTdCUDBLLFNBQWUxckIsR0FDYjRULEdBQVN2SyxPQUFPdk4sS0FBS0QsS0FBTW1FLEdBQUFBLEVBT3pCK1gsR3ZDejdCRyx3QnVDaThCSEEsV0FDSSxNQUE0QmxjLEtBQUsrWCxTQUEvQndILEVBQUYsVUFBV3JELEVBQVgsZUFDTixPQUFPcUQsRUFBVXJELEdBQWdCLENBUS9Cc0QsRXZDMzhCRyxJdUN5N0JIdEQsU0FBYS9YLEdBQ2Y0VCxHQUFTalcsSUFBSTdCLEtBQUtELEtBQU1tRSxHQUFBQSxHQUN4QjRULEdBQVMvRixNQUFNL1IsS0FBS0QsS0FNbEJrYyxHdkNqOEJHLG9CdUNrOUJIc0QsV0FDSyxPQUFDekgsR0FBUzZNLGdCQUFnQjNrQixLQUFLRCxPQUFTLENBQUMsR0FBR3dmLFFBUWpEeFQsRXZDMzlCRyxJdUMyOEJId1QsU0FBU3JiLEdBQ1g0VCxHQUFTcU0sWUFBWW5rQixLQUFLRCxLQUFNbUUsR0FBQUEsRUFNOUJxYixHdkNsOUJHLGV1Q3UvQkh4VCxXQUNGLE9BQUtWLEdBQVFVLElBS1J0TCxFQUFTVixLQUFLeU0sTUFBTSs0Qix3QkFLbEJ4bEMsS0FBS3lNLFFBQVU1TSxTQUFTNGxDLHdCQUp0QnpsQyxLQUFLeU0sTUFBTSs0Qix5QkFBMkJ4NUIsR0FMdEMsSUFlWDA1QixFdkN4Z0NPLEl1QzI5QkgxNUIsU0FBSTdILEdBRU4sR0FBS21ILEdBQVFVLElBQWIsQ0FLQSxJQUFNd0IsRUFBUzlNLEVBQVd5RCxHQUFTQSxHQUFTbkUsS0FBS2dNLElBSTdDdEwsRUFBWVYsS0FBS3lNLE1BQU1SLDRCQUN6QmpNLEtBQUt5TSxNQUFNUiwwQkFBMEJ1QixFQUFTeEIsR2hCcitCeEMsVWdCeStCSnRMLEVBQVlWLEtBQUt5TSxNQUFNazVCLDRCQUNwQjNsQyxLQUFLZ00sS0FBT3dCLEVBQ1ZmLEtBQUFBLE1BQU1rNUIsMEJBQ0YzbEMsS0FBS2dNLE1BQVF3QixHQUN0QjNOLFNBQVMrbEMsdUJBakJMLENBeUJONTVCLEd2Q3YvQkcsa0N1Q3dnQ1AwNUIsU0FBcUJHLEdBQ2Y3bEMsS0FBSytuQixtQkFBcUIvbkIsS0FBSytuQixrQkFBa0JxSSxTQUM5Q3JJLEtBQUFBLGtCQUFrQmtSLFVBQ2xCbFIsS0FBQUEsa0JBQW9CLE1BRzNCanFCLE9BQU95SixPQUFPdkgsS0FBS29CLE9BQU8ybUIsa0JBQW1COGQsR0FHekM3bEMsS0FBS29CLE9BQU8ybUIsa0JBQWtCdm1CLFVBQ2hDeEIsS0FBSytuQixrQkFBb0IsSUFBSWlYLEdBQWtCaC9CLE1BcU1uQzhsQyxJdkN2dENULHdCdUN1dENTQSxTQUFDcGlDLEVBQU1nSSxFQUFVcTZCLEdBQ3hCejZCLE9BQUFBLEdBQVFHLE1BQU0vSCxFQUFNZ0ksRUFBVXE2QixFQVF0QkQsR3ZDaHVDVix3QnVDZ3VDVUEsU0FBQ2x4QixFQUFLM0ssR0FDckIsT0FBT3VMLEdBQVdaLEVBQUszSyxFQVFiNjdCLEd2Q3p1Q0wsbUJ1Q3l1Q0tBLFNBQUNwOEIsR0FBb0IsSUFBVnlELEVBQVUsMERBQzNCeEYsRUFBVSxLQVVkLE9BUklqSCxFQUFVZ0osR0FDWi9CLEVBQVVoSSxNQUFNQyxLQUFLQyxTQUFTQyxpQkFBaUI0SixJQUN0Q2hKLEVBQVlnSixHQUNyQi9CLEVBQVVoSSxNQUFNQyxLQUFLOEosR0FDWmhKLEVBQVNnSixLQUNsQi9CLEVBQVUrQixFQUFTN0ssT0FBTzZCLElBR3hCQSxFQUFTaUgsR0FDSixLQUdGQSxFQUFRMUQsS0FBSzVGLFNBQUFBLEdBQUFBLE9BQU0sSUFBSTBsQyxFQUFLMWxDLEVBQUc4TyxFQUFsQjlPLEdBQWtCOE8sS3ZDeHZDakMsS0FxalJQLE91Q3p6T0Y0MkIsR0FBS3prQyxVbEN6dkNxQnlILEdrQ3l2Q0F6SCxHbEN4dkNqQmdWLEtBQUtqRSxNQUFNaUUsS0FBS0csVUFBVTFOLE1MaWpSMUJnOUIsRUFBQUEsQ0F4alJ5RXpQLDZHd0NDM0UsSUFBTTBSLEVBQVUsV0FDckJubUMsU0FBU3VOLGlCQUFpQixvQkFBb0IsV0FJNUMsSUFBSTY0QixFQUFTLElBQUlDLE9BQU8sZUFBZ0IsQ0FDdENDLGNBQWUsRUFDZnZWLFVBQVcsV0FDWHdWLFVBQVUsRUFDVkMscUJBQXFCLElBTVQsSUFBSUgsT0FBTyxlQUFnQixDQUN2Q0ksYUFBYyxHQUNkQyxXQUFZLENBQ1ZDLE9BQVEsc0JBQ1JDLE9BQVEsdUJBRVZDLE9BQVEsQ0FDTlQsT0FBUUEsR0FFVlUsT0FBUSxPQUNSQyxXQUFZLENBQ1ZDLFdBQVcsS0FNSSxJQUFJWCxPQUFPLGtCQUFtQixDQUMvQ0MsY0FBZSxFQUNmemdCLEtBQU0sT0FDTnhULE1BQU8sSUFDUG8wQixhQUFjLEdBRWRRLFlBQVksRUFXWkMsV0FBWSxDQUNWNWIsR0FBSSx5QkFDSjZiLFdBQVcsR0FFYlQsV0FBWSxDQUNWRSxPQUFRLGVBQ1JELE9BQVEsZ0JBR1ZTLFlBQWEsQ0FDWCxJQUFLLENBQ0hYLGFBQWMsTUFNckIsR0FDRix5R0NsRU0sSUFBTVksRUFBTyxXQXNCbEJybkMsU0FBU3VOLGlCQUFpQixvQkFBb0IsV0FDNUMsSUFBSSs1QixFQUFVdG5DLFNBQVNDLGlCQUFpQixjQUNwQ3NuQyxFQUFXdm5DLFNBQVNDLGlCQUFpQixlQUNyQ3VuQyxFQUFZeG5DLFNBQVNDLGlCQUFpQixnQkFDdEN3bkMsRUFBYTNuQyxNQUFNMkIsVUFBVWdTLE1BQU1yVCxLQUFLa25DLEdBQ3hDSSxFQUFjNW5DLE1BQU0yQixVQUFVZ1MsTUFBTXJULEtBQUttbkMsR0FDekNJLEVBQWU3bkMsTUFBTTJCLFVBQVVnUyxNQUFNclQsS0FBS29uQyxHQUkxQ0MsRUFBVy9vQyxPQUFTLEdBQ3RCK29DLEVBQVdub0MsU0FBUSxTQUFDc29DLEdBRWpCLElBQUlDLEVBQU1ELEVBQUtqbEMsd0JBQ2hCdUMsT0FBT3FJLGlCQUFpQixVQUFVLFdBQzNCczZCLEVBQUl2d0IsSUFBTXRYLFNBQVNpRSxLQUFLb0MsYUFBZSxLQUN6Q3VoQyxFQUFLbDlCLFVBQVUrRyxJQUFJLGFBRXZCLEdBQ0YsSUFHQ2kyQixFQUFZaHBDLE9BQVMsR0FDdkJncEMsRUFBWXBvQyxTQUFRLFNBQUN3b0MsR0FDbEIsSUFBSUQsRUFBTUMsRUFBTW5sQyx3QkFDaEJ1QyxPQUFPcUksaUJBQWlCLFVBQVUsV0FDNUJzNkIsRUFBSXZ3QixJQUFNdFgsU0FBU2lFLEtBQUtvQyxhQUFlLEtBQ3pDeWhDLEVBQU1wOUIsVUFBVStHLElBQUksYUFFdkIsR0FDSCxJQUdDazJCLEVBQWFqcEMsT0FBUyxHQUN4QmlwQyxFQUFhcm9DLFNBQVEsU0FBQ3lvQyxHQUNuQixJQUFJRixFQUFNRSxFQUFNcGxDLHdCQUNqQnVDLE9BQU9xSSxpQkFBaUIsVUFBVSxXQUMzQnM2QixFQUFJdndCLElBQU10WCxTQUFTaUUsS0FBS29DLGFBQWUsS0FDekMwaEMsRUFBTXI5QixVQUFVK0csSUFBSSxhQUV4QixHQUNGLEdBSUosR0FHRix3R0N2RU0sSUFBTXUyQixFQUFTLFNBQUN6cEMsR0FDckIsSUFBSTJELEVBQVUzRCxFQUFFMkQsT0FBT2dOLFFBQVEsYUFDN0IzUSxFQUFFaUYsaUJBQ0YsSUFBSXlrQyxFQUFTL2tDLEtBQUtDLElBQUlqQixFQUFPMnNCLFlBQWEzc0IsRUFBTzZzQixjQUMvQ21aLEVBQVNsb0MsU0FBU3lGLGNBQWMsT0FDaEN3cUIsRUFBTy90QixFQUFPUyx3QkFDaEJ1bEMsRUFBT3g5QixVQUFVK0csSUFBSSxVQUNyQnkyQixFQUFPdG1DLE1BQU1pQixNQUFRcWxDLEVBQU90bUMsTUFBTXNPLE9BQVMrM0IsRUFBUyxLQUNwREMsRUFBT3RtQyxNQUFNbUIsS0FBT3hFLEVBQUV1RSxRQUFVbXRCLEVBQUtsdEIsS0FBT2tsQyxFQUFTLEVBQUksS0FDekRDLEVBQU90bUMsTUFBTTBWLElBQU0vWSxFQUFFNHBDLFFBQVVsWSxFQUFLM1ksSUFBTTJ3QixFQUFTLEVBQUksS0FDdkQvbEMsRUFBT2dOLFFBQVEsYUFBYWs1QixPQUFPRixHQUNuQy9oQyxZQUFXLFdBQ1QraEMsRUFBTzVPLFFBQ1IsR0FBRSxJQUNOLDRRQ2JZcjFCLEVBQU9qRSxTQUFTcUIsY0FBYyxRQUM5QmduQyxFQUFRcm9DLFNBQVNDLGlCQUFpQixhQUNsQ3FvQyxFQUFhdG9DLFNBQVNDLGlCQUFpQixtQkFDdkNzb0MsRUFBU3ZvQyxTQUFTcUIsY0FBYyxVQUNoQ21uQyxFQUFXeG9DLFNBQVNxQixjQUFjLHEyQkNMeEMsSUFBTW9uQyxFQUFNLFNBQUNoNkIsR0FDbEIsSUEwQklpNkIsRUExQkFDLEVBQUssSUFBSXRDLE9BQU8sWUFBYSxDQUMvQmgwQixNQUFPLElBQ1B1MkIsZ0JBQWdCLEVBQ2hCbkMsYUFBYyxHQUNkSyxPQUFRLFlBQ1IrQixnQkFBaUIsQ0FDZkMsT0FBUSxFQUNSQyxRQUFTLEVBQ1RDLE1BQU8sR0FJVHRDLFdBQVksQ0FDVkUsT0FBUSxXQUNSRCxPQUFRLFlBSVY5Z0IsTUFBTSxFQUVOeWdCLGNBQWUsT0FDZjJDLG9CQUFxQixPQUNyQmhDLFlBQVksSUFNVjBCLEdBQ0ZBLEVBQUc1NkIsR0FBRyx5QkFBeUIsV0FLN0IsSUFGQSxJQUFNbWMsRUFBTyxFQUFJbHFCLFNBQVNDLGlCQUFpQix1QkFDekNpcEMsRUFBVSxFQUFJbHBDLFNBQVNDLGlCQUFpQixnQkFDakNrQyxFQUFJLEVBQUdBLEVBQUkrbUMsRUFBUXhxQyxTQUFVeUQsRUFDaEMrbUMsRUFBUS9tQyxHQUFHdUksVUFBVUMsU0FBUyxjQUNoQ3UrQixFQUFRL21DLEdBQUd1SSxVQUFVNHVCLE9BQU8sYUFHMUI0UCxFQUFRL21DLEdBQUd1SSxVQUFVQyxTQUFTLGdCQUNoQ3UrQixFQUFRL21DLEdBQUd1SSxVQUFVNHVCLE9BQU8sY0FDNUI0UCxFQUFRL21DLEdBQUd1SSxVQUFVK0csSUFBSSxnQkFHN0J0TCxZQUFXLFdBQ1QsSUFBSyxJQUFJaEUsRUFBSSxFQUFHQSxFQUFJK25CLEVBQUt4ckIsU0FBVXlELEVBQzdCK25CLEVBQUsvbkIsR0FBR3VJLFVBQVVDLFNBQVMseUJBQzdCKzlCLEVBQU94ZSxFQUFLL25CLEdBQUdJLGFBQWEsV0FDNUIybUMsRUFBUVIsR0FBTWgrQixVQUFVNHVCLE9BQU8sZUFDL0I0UCxFQUFRUixHQUFNaCtCLFVBQVUrRyxJQUFJLGNBR2pDLEdBQUUsR0FDSixHQUVKLHlHQ3hETSxJQUFNMDNCLEVBQVUsV0ErQnJCamtDLE9BQU9xSSxpQkFBaUIsVUFBVSxTQUFVdkgsR0FDdENkLE9BQU9ra0MsWUFBYyxJQUN2QnBwQyxTQUFTcUIsY0FBYyxlQUFlcUosVUFBVStHLElBQUksb0JBRXBEelIsU0FBU3FCLGNBQWMsZUFBZXFKLFVBQVU0dUIsT0FBTyxtQkFFMUQsSUFHRHAwQixPQUFPbWtDLFNBQVcsV0FDWm5rQyxPQUFPNHBCLFlBQWMsTUFDbkJsVixLQUFLdlksY0FBYyxrQkFDckJ1WSxLQUFLdlksY0FBYyxpQkFBaUJpNEIsU0FHdEMxZixLQUFLbFAsVUFBVTR1QixPQUFPLGVBQ3RCdDVCLFNBQVNxQixjQUFjLFNBQVNxSixVQUFVNHVCLE9BQU8sZUFDakR0NUIsU0FBU3FCLGNBQWMsUUFBUXFKLFVBQVU0dUIsT0FBTyxRQUVuRCxDQUlGLDhTQ3BETSxJQUFNZ1EsRUFBUyxXQUNwQixNQUFNcnBCLEVBQVFqZ0IsU0FBU3FCLGNBQWMsYUFDbkNrb0MsRUFBV3RwQixFQUFNaGdCLGlCQUFpQixtQkFDbEN1cEMsRUFBUyxHQUVQQyxpREFBYXpwQyxTQUFTQyxpQkFBaUIsbWxCQUUzQ3dwQyxFQUFPbnFDLFNBQVEsU0FBQ3NvQyxHQUNkLElBQUl4OUIsRUFBS3c5QixFQUFLcmxDLGFBQWEsTUFDM0IsR0FBSTZILEVBQUksQ0FDTixJQUFJekwsRUFBSSxJQUFILE9BQU95TCxHQUNON0wsRUFBSSxJQUFJMmxDLElBQUosQ0FBU3ZsQyxHQUNuQjZxQyxFQUFPdHFDLEtBQUssQ0FBRWtMLEdBQUlBLEVBQUk3TCxFQUFHQSxHQUMxQixDQUNGLElBRUR5QixTQUFTdU4saUJBQWlCLFNBQVMsU0FBQ2hQLEdBQ2xDLElBQU0yRCxFQUFTM0QsRUFBRTJELE9BbURmQSxFQUFPZ04sUUFBUSxtQkFqREQsV0FDZCxJQUFNdzZCLEVBQWF6cEIsRUFBTTVlLGNBQ3ZCYSxFQUFPZ04sUUFBUSxtQkFBbUIzTSxhQUFhLFFBR2pENEQsWUFBVyxXQUNUOFosRUFBTXJlLE1BQU0yVyxRQUFVLFFBQ3RCMEgsRUFBTXZWLFVBQVU0dUIsT0FBTyxlQUN2QnJaLEVBQU12VixVQUFVK0csSUFBSSxjQUVwQjgzQixFQUFTanFDLFNBQVEsU0FBQ3NvQyxHQUNaQSxHQUFROEIsRUFDVkEsRUFBVzluQyxNQUFNMlcsUUFBVSxPQUUzQnF2QixFQUFLaG1DLE1BQU0yVyxRQUFVLE1BRXhCLEdBQ0YsR0FBRSxLQUlILElBRkEsSUFBSW94QixFQUFXRCxFQUFXcm9DLGNBQWMsU0FBU2tCLGFBQWEsTUFFckRKLEVBQUksRUFBR0EsRUFBSXNuQyxFQUFPL3FDLFNBQVV5RCxFQUMvQnFuQyxFQUFPcm5DLEdBQUdpSSxLQUFPdS9CLEdBQ25CSCxFQUFPcm5DLEdBQUc1RCxFQUFFc1UsT0FJaEI1TyxFQUFBQSxLQUFBQSxNQUFBQSxRQUFxQixrQkFDdEIsQ0F5QkMybEMsSUFFQTFuQyxFQUFPckMsUUFBUSxzQkFDZnFDLEVBQU9nTixRQUFRLHFCQTFCQSxXQUNmK1EsRUFBTXZWLFVBQVU0dUIsT0FBTyxjQUN2QnJaLEVBQU12VixVQUFVK0csSUFBSSxlQUVwQnRMLFlBQVcsV0FDVDhaLEVBQU1yZSxNQUFNMlcsUUFBVSxPQUN0Qmd4QixFQUFTanFDLFNBQVEsU0FBQ3NvQyxHQUNoQkEsRUFBS2htQyxNQUFNMlcsUUFBVSxNQUN0QixHQUNGLEdBQUUsS0FFSHRVLEVBQUFBLEtBQUFBLE1BQUFBLFFBQXFCLG9CQUNyQixJQUFLLElBQUk5QixFQUFJLEVBQUdBLEVBQUlxbkMsRUFBTzlxQyxTQUFVeUQsRUFDbkNxbkMsRUFBT3JuQyxHQUFHNUQsRUFBRW0zQixNQUVmLENBYUNtVSxFQUVILEdBQ0YseUdDaEZNLElBQU1DLEVBQVMsV0FHcEI5cEMsU0FBU3VOLGlCQUFpQixvQkFBb0IsV0FHN0MsSUFBTXc4QixFQUFhLElBQUkxRCxPQUFPLFlBQWEsQ0FDekN4Z0IsTUFBTSxFQUNONGdCLGFBQWMsR0FDZEgsY0FBZSxFQUVmRSxxQkFBcUIsRUFDckJFLFdBQVksQ0FDVkMsT0FBUSxzQkFDUkMsT0FBUSx5QkFHTyxJQUFJUCxPQUFPLGFBQWMsQ0FDMUN4Z0IsTUFBTSxFQUNONGdCLGFBQWMsR0FDZHdDLG9CQUFxQixPQUNyQi9CLFdBQVksQ0FDVjViLEdBQUksOEJBQ0o2YixXQUFXLEdBR2JOLE9BQVEsQ0FDTlQsT0FBUTJELElBaURaLEdBQ0Ysc0VDaEZHQyxFQUEyQixDQUFDLEVBR2hDLFNBQVNDLEVBQW9CQyxHQUU1QixJQUFJQyxFQUFlSCxFQUF5QkUsR0FDNUMsUUFBcUJwbEIsSUFBakJxbEIsRUFDSCxPQUFPQSxFQUFhdnNDLFFBR3JCLElBQUlELEVBQVNxc0MsRUFBeUJFLEdBQVksQ0FHakR0c0MsUUFBUyxDQUFDLEdBT1gsT0FIQXdzQyxFQUFvQkYsR0FBVTlwQyxLQUFLekMsRUFBT0MsUUFBU0QsRUFBUUEsRUFBT0MsUUFBU3FzQyxHQUdwRXRzQyxFQUFPQyxPQUNmLENDckJBcXNDLEVBQW9CeHJDLEVBQUksU0FBU2QsR0FDaEMsSUFBSTBzQyxFQUFTMXNDLEdBQVVBLEVBQU8yc0MsV0FDN0IsV0FBYSxPQUFPM3NDLEVBQWdCLE9BQUcsRUFDdkMsV0FBYSxPQUFPQSxDQUFRLEVBRTdCLE9BREFzc0MsRUFBb0JNLEVBQUVGLEVBQVEsQ0FBRXpuQyxFQUFHeW5DLElBQzVCQSxDQUNSLEVDTkFKLEVBQW9CTSxFQUFJLFNBQVMzc0MsRUFBUzRzQyxHQUN6QyxJQUFJLElBQUl6c0MsS0FBT3lzQyxFQUNYUCxFQUFvQjVuQyxFQUFFbW9DLEVBQVl6c0MsS0FBU2tzQyxFQUFvQjVuQyxFQUFFekUsRUFBU0csSUFDNUVFLE9BQU9DLGVBQWVOLEVBQVNHLEVBQUssQ0FBRUksWUFBWSxFQUFNc0YsSUFBSyttQyxFQUFXenNDLElBRzNFLEVDUEFrc0MsRUFBb0JRLEVBQUksV0FDdkIsR0FBMEIsaUJBQWZoWixXQUF5QixPQUFPQSxXQUMzQyxJQUNDLE9BQU90eEIsTUFBUSxJQUFJc0UsU0FBUyxjQUFiLEVBR2hCLENBRkUsTUFBT2xHLEdBQ1IsR0FBc0IsaUJBQVgyRyxPQUFxQixPQUFPQSxNQUN4QyxDQUNBLENBUHVCLEdDQXhCK2tDLEVBQW9CNW5DLEVBQUksU0FBU3ZFLEVBQUs0c0MsR0FBUSxPQUFPenNDLE9BQU93RCxVQUFVa3BDLGVBQWV2cUMsS0FBS3RDLEVBQUs0c0MsRUFBTyxFQ0N0R1QsRUFBb0J0ckMsRUFBSSxTQUFTZixHQUNYLG9CQUFYZ3RDLFFBQTBCQSxPQUFPQyxhQUMxQzVzQyxPQUFPQyxlQUFlTixFQUFTZ3RDLE9BQU9DLFlBQWEsQ0FBRTdzQyxNQUFPLFdBRTdEQyxPQUFPQyxlQUFlTixFQUFTLGFBQWMsQ0FBRUksT0FBTyxHQUN2RCxtV0NlQXFwQyxFQUFBQSxFQUFBQSxTQUNBbEIsRUFBQUEsRUFBQUEsWUFDQXNDLEVBQUFBLEVBQUFBLFFBQ0FxQixFQUFBQSxFQUFBQSxVQUNBOXBDLFNBQVN1TixpQkFBaUIsb0JBQW9CLFdBQ3hDKzZCLEVBQUFBLFdBQUFBLE9BQW9CLElBQ3RCZ0IsRUFBQUEsRUFBQUEsVUFHRWYsRUFBQUEsU0FDRlksRUFBQUEsRUFBQUEsV0FHRmQsRUFBQUEsTUFBQUEsU0FBYyxTQUFDVCxHQUNiQSxFQUFLcjZCLGlCQUFpQixRQUFTeTZCLEVBQUFBLE9BQ2hDLElBRWdCLFdBRWYsR0FBSThDLGVBQWdCLENBQ2xCLElBQUlDLEVBQU8vcUMsU0FBU3FCLGNBQWMsbUJBQ2hDMnBDLEVBQVFockMsU0FBU3FCLGNBQWMsNkJBRWpDMnBDLEVBQU1wM0IsVUFBWSxPQUNsQm0zQixFQUFLeDlCLGlCQUFpQixTQUFTLFNBQUNoUCxHQUU5QixJQUFJMHNDLEVBQUtILGVBQWV2NEIsWUFBWWxQLFFBQVEsR0FDNUM0bkMsRUFBS0EsRUFBR2poQyxRQUFRLElBQUssS0FDckJnaEMsRUFBTXAzQixVQUFZcTNCLENBQ25CLEdBQ0YsQ0FDRixDQUVEQyxFQUVEIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vcmVzL3BseXIuanMiLCJ3ZWJwYWNrOi8vcmVzL25vZGVfbW9kdWxlcy9yYW5nZXRvdWNoL2Rpc3QvcmFuZ2V0b3VjaC5tanMiLCJ3ZWJwYWNrOi8vcmVzL3NyYy9qcy91dGlscy9pcy5qcyIsIndlYnBhY2s6Ly9yZXMvc3JjL2pzL3V0aWxzL2FuaW1hdGlvbi5qcyIsIndlYnBhY2s6Ly9yZXMvc3JjL2pzL3V0aWxzL2Jyb3dzZXIuanMiLCJ3ZWJwYWNrOi8vcmVzL3NyYy9qcy91dGlscy9vYmplY3RzLmpzIiwid2VicGFjazovL3Jlcy9zcmMvanMvdXRpbHMvZWxlbWVudHMuanMiLCJ3ZWJwYWNrOi8vcmVzL3NyYy9qcy9zdXBwb3J0LmpzIiwid2VicGFjazovL3Jlcy9zcmMvanMvdXRpbHMvZXZlbnRzLmpzIiwid2VicGFjazovL3Jlcy9zcmMvanMvdXRpbHMvcHJvbWlzZS5qcyIsIndlYnBhY2s6Ly9yZXMvc3JjL2pzL3V0aWxzL2FycmF5cy5qcyIsIndlYnBhY2s6Ly9yZXMvc3JjL2pzL3V0aWxzL3N0eWxlLmpzIiwid2VicGFjazovL3Jlcy9zcmMvanMvaHRtbDUuanMiLCJ3ZWJwYWNrOi8vcmVzL3NyYy9qcy91dGlscy9zdHJpbmdzLmpzIiwid2VicGFjazovL3Jlcy9zcmMvanMvdXRpbHMvaTE4bi5qcyIsIndlYnBhY2s6Ly9yZXMvc3JjL2pzL3N0b3JhZ2UuanMiLCJ3ZWJwYWNrOi8vcmVzL3NyYy9qcy91dGlscy9mZXRjaC5qcyIsIndlYnBhY2s6Ly9yZXMvc3JjL2pzL3V0aWxzL2xvYWQtc3ByaXRlLmpzIiwid2VicGFjazovL3Jlcy9zcmMvanMvdXRpbHMvdGltZS5qcyIsIndlYnBhY2s6Ly9yZXMvc3JjL2pzL2NvbnRyb2xzLmpzIiwid2VicGFjazovL3Jlcy9zcmMvanMvdXRpbHMvdXJscy5qcyIsIndlYnBhY2s6Ly9yZXMvc3JjL2pzL2NhcHRpb25zLmpzIiwid2VicGFjazovL3Jlcy9zcmMvanMvY29uZmlnL2RlZmF1bHRzLmpzIiwid2VicGFjazovL3Jlcy9zcmMvanMvY29uZmlnL3N0YXRlcy5qcyIsIndlYnBhY2s6Ly9yZXMvc3JjL2pzL2NvbmZpZy90eXBlcy5qcyIsIndlYnBhY2s6Ly9yZXMvc3JjL2pzL2NvbnNvbGUuanMiLCJ3ZWJwYWNrOi8vcmVzL3NyYy9qcy9mdWxsc2NyZWVuLmpzIiwid2VicGFjazovL3Jlcy9zcmMvanMvdXRpbHMvbG9hZC1pbWFnZS5qcyIsIndlYnBhY2s6Ly9yZXMvc3JjL2pzL3VpLmpzIiwid2VicGFjazovL3Jlcy9zcmMvanMvbGlzdGVuZXJzLmpzIiwid2VicGFjazovL3Jlcy9ub2RlX21vZHVsZXMvbG9hZGpzL2Rpc3QvbG9hZGpzLnVtZC5qcyIsIndlYnBhY2s6Ly9yZXMvc3JjL2pzL3V0aWxzL2xvYWQtc2NyaXB0LmpzIiwid2VicGFjazovL3Jlcy9zcmMvanMvcGx1Z2lucy92aW1lby5qcyIsIndlYnBhY2s6Ly9yZXMvc3JjL2pzL3BsdWdpbnMveW91dHViZS5qcyIsIndlYnBhY2s6Ly9yZXMvc3JjL2pzL21lZGlhLmpzIiwid2VicGFjazovL3Jlcy9zcmMvanMvcGx1Z2lucy9hZHMuanMiLCJ3ZWJwYWNrOi8vcmVzL3NyYy9qcy91dGlscy9udW1iZXJzLmpzIiwid2VicGFjazovL3Jlcy9zcmMvanMvcGx1Z2lucy9wcmV2aWV3LXRodW1ibmFpbHMuanMiLCJ3ZWJwYWNrOi8vcmVzL3NyYy9qcy9zb3VyY2UuanMiLCJ3ZWJwYWNrOi8vcmVzL3NyYy9qcy9wbHlyLmpzIiwid2VicGFjazovL3Jlcy8uL3NyYy9hc3NldHMvanMvTXlTd2lwZXIuanMiLCJ3ZWJwYWNrOi8vcmVzLy4vc3JjL2Fzc2V0cy9qcy9hbmltYXRpb24uanMiLCJ3ZWJwYWNrOi8vcmVzLy4vc3JjL2Fzc2V0cy9qcy9idXR0b24uanMiLCJ3ZWJwYWNrOi8vcmVzLy4vc3JjL2Fzc2V0cy9qcy9jb25zdGFudHMuanMiLCJ3ZWJwYWNrOi8vcmVzLy4vc3JjL2Fzc2V0cy9qcy9nYWxTd2lwZXIuanMiLCJ3ZWJwYWNrOi8vcmVzLy4vc3JjL2Fzc2V0cy9qcy9oZWFkZXIuanMiLCJ3ZWJwYWNrOi8vcmVzLy4vc3JjL2Fzc2V0cy9qcy9wb3B1cC5qcyIsIndlYnBhY2s6Ly9yZXMvLi9zcmMvYXNzZXRzL2pzL3Nkb3VibGUuanMiLCJ3ZWJwYWNrOi8vcmVzL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL3Jlcy93ZWJwYWNrL3J1bnRpbWUvY29tcGF0IGdldCBkZWZhdWx0IGV4cG9ydCIsIndlYnBhY2s6Ly9yZXMvd2VicGFjay9ydW50aW1lL2RlZmluZSBwcm9wZXJ0eSBnZXR0ZXJzIiwid2VicGFjazovL3Jlcy93ZWJwYWNrL3J1bnRpbWUvZ2xvYmFsIiwid2VicGFjazovL3Jlcy93ZWJwYWNrL3J1bnRpbWUvaGFzT3duUHJvcGVydHkgc2hvcnRoYW5kIiwid2VicGFjazovL3Jlcy93ZWJwYWNrL3J1bnRpbWUvbWFrZSBuYW1lc3BhY2Ugb2JqZWN0Iiwid2VicGFjazovL3Jlcy8uL3NyYy9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJ0eXBlb2YgbmF2aWdhdG9yID09PSBcIm9iamVjdFwiICYmIChmdW5jdGlvbiAoZ2xvYmFsLCBmYWN0b3J5KSB7XG4gIHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyA/IG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeSgpIDpcbiAgdHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kID8gZGVmaW5lKCdQbHlyJywgZmFjdG9yeSkgOlxuICAoZ2xvYmFsID0gdHlwZW9mIGdsb2JhbFRoaXMgIT09ICd1bmRlZmluZWQnID8gZ2xvYmFsVGhpcyA6IGdsb2JhbCB8fCBzZWxmLCBnbG9iYWwuUGx5ciA9IGZhY3RvcnkoKSk7XG59KSh0aGlzLCAoZnVuY3Rpb24gKCkgeyAndXNlIHN0cmljdCc7XG5cbiAgZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5JDEob2JqLCBrZXksIHZhbHVlKSB7XG4gICAgaWYgKGtleSBpbiBvYmopIHtcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwge1xuICAgICAgICB2YWx1ZTogdmFsdWUsXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgd3JpdGFibGU6IHRydWVcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBvYmpba2V5XSA9IHZhbHVlO1xuICAgIH1cblxuICAgIHJldHVybiBvYmo7XG4gIH1cblxuICBmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soZSwgdCkge1xuICAgIGlmICghKGUgaW5zdGFuY2VvZiB0KSkgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvblwiKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKGUsIHQpIHtcbiAgICBmb3IgKHZhciBuID0gMDsgbiA8IHQubGVuZ3RoOyBuKyspIHtcbiAgICAgIHZhciByID0gdFtuXTtcbiAgICAgIHIuZW51bWVyYWJsZSA9IHIuZW51bWVyYWJsZSB8fCAhMSwgci5jb25maWd1cmFibGUgPSAhMCwgXCJ2YWx1ZVwiIGluIHIgJiYgKHIud3JpdGFibGUgPSAhMCksIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCByLmtleSwgcik7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gX2NyZWF0ZUNsYXNzKGUsIHQsIG4pIHtcbiAgICByZXR1cm4gdCAmJiBfZGVmaW5lUHJvcGVydGllcyhlLnByb3RvdHlwZSwgdCksIG4gJiYgX2RlZmluZVByb3BlcnRpZXMoZSwgbiksIGU7XG4gIH1cblxuICBmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkoZSwgdCwgbikge1xuICAgIHJldHVybiB0IGluIGUgPyBPYmplY3QuZGVmaW5lUHJvcGVydHkoZSwgdCwge1xuICAgICAgdmFsdWU6IG4sXG4gICAgICBlbnVtZXJhYmxlOiAhMCxcbiAgICAgIGNvbmZpZ3VyYWJsZTogITAsXG4gICAgICB3cml0YWJsZTogITBcbiAgICB9KSA6IGVbdF0gPSBuLCBlO1xuICB9XG5cbiAgZnVuY3Rpb24gb3duS2V5cyhlLCB0KSB7XG4gICAgdmFyIG4gPSBPYmplY3Qua2V5cyhlKTtcblxuICAgIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7XG4gICAgICB2YXIgciA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMoZSk7XG4gICAgICB0ICYmIChyID0gci5maWx0ZXIoZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoZSwgdCkuZW51bWVyYWJsZTtcbiAgICAgIH0pKSwgbi5wdXNoLmFwcGx5KG4sIHIpO1xuICAgIH1cblxuICAgIHJldHVybiBuO1xuICB9XG5cbiAgZnVuY3Rpb24gX29iamVjdFNwcmVhZDIoZSkge1xuICAgIGZvciAodmFyIHQgPSAxOyB0IDwgYXJndW1lbnRzLmxlbmd0aDsgdCsrKSB7XG4gICAgICB2YXIgbiA9IG51bGwgIT0gYXJndW1lbnRzW3RdID8gYXJndW1lbnRzW3RdIDoge307XG4gICAgICB0ICUgMiA/IG93bktleXMoT2JqZWN0KG4pLCAhMCkuZm9yRWFjaChmdW5jdGlvbiAodCkge1xuICAgICAgICBfZGVmaW5lUHJvcGVydHkoZSwgdCwgblt0XSk7XG4gICAgICB9KSA6IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzID8gT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoZSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMobikpIDogb3duS2V5cyhPYmplY3QobikpLmZvckVhY2goZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGUsIHQsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IobiwgdCkpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGU7XG4gIH1cblxuICB2YXIgZGVmYXVsdHMkMSA9IHtcbiAgICBhZGRDU1M6ICEwLFxuICAgIHRodW1iV2lkdGg6IDE1LFxuICAgIHdhdGNoOiAhMFxuICB9O1xuXG4gIGZ1bmN0aW9uIG1hdGNoZXMkMShlLCB0KSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiBBcnJheS5mcm9tKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwodCkpLmluY2x1ZGVzKHRoaXMpO1xuICAgIH0uY2FsbChlLCB0KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHRyaWdnZXIoZSwgdCkge1xuICAgIGlmIChlICYmIHQpIHtcbiAgICAgIHZhciBuID0gbmV3IEV2ZW50KHQsIHtcbiAgICAgICAgYnViYmxlczogITBcbiAgICAgIH0pO1xuICAgICAgZS5kaXNwYXRjaEV2ZW50KG4pO1xuICAgIH1cbiAgfVxuXG4gIHZhciBnZXRDb25zdHJ1Y3RvciQxID0gZnVuY3Rpb24gKGUpIHtcbiAgICByZXR1cm4gbnVsbCAhPSBlID8gZS5jb25zdHJ1Y3RvciA6IG51bGw7XG4gIH0sXG4gICAgICBpbnN0YW5jZU9mJDEgPSBmdW5jdGlvbiAoZSwgdCkge1xuICAgIHJldHVybiAhIShlICYmIHQgJiYgZSBpbnN0YW5jZW9mIHQpO1xuICB9LFxuICAgICAgaXNOdWxsT3JVbmRlZmluZWQkMSA9IGZ1bmN0aW9uIChlKSB7XG4gICAgcmV0dXJuIG51bGwgPT0gZTtcbiAgfSxcbiAgICAgIGlzT2JqZWN0JDEgPSBmdW5jdGlvbiAoZSkge1xuICAgIHJldHVybiBnZXRDb25zdHJ1Y3RvciQxKGUpID09PSBPYmplY3Q7XG4gIH0sXG4gICAgICBpc051bWJlciQxID0gZnVuY3Rpb24gKGUpIHtcbiAgICByZXR1cm4gZ2V0Q29uc3RydWN0b3IkMShlKSA9PT0gTnVtYmVyICYmICFOdW1iZXIuaXNOYU4oZSk7XG4gIH0sXG4gICAgICBpc1N0cmluZyQxID0gZnVuY3Rpb24gKGUpIHtcbiAgICByZXR1cm4gZ2V0Q29uc3RydWN0b3IkMShlKSA9PT0gU3RyaW5nO1xuICB9LFxuICAgICAgaXNCb29sZWFuJDEgPSBmdW5jdGlvbiAoZSkge1xuICAgIHJldHVybiBnZXRDb25zdHJ1Y3RvciQxKGUpID09PSBCb29sZWFuO1xuICB9LFxuICAgICAgaXNGdW5jdGlvbiQxID0gZnVuY3Rpb24gKGUpIHtcbiAgICByZXR1cm4gZ2V0Q29uc3RydWN0b3IkMShlKSA9PT0gRnVuY3Rpb247XG4gIH0sXG4gICAgICBpc0FycmF5JDEgPSBmdW5jdGlvbiAoZSkge1xuICAgIHJldHVybiBBcnJheS5pc0FycmF5KGUpO1xuICB9LFxuICAgICAgaXNOb2RlTGlzdCQxID0gZnVuY3Rpb24gKGUpIHtcbiAgICByZXR1cm4gaW5zdGFuY2VPZiQxKGUsIE5vZGVMaXN0KTtcbiAgfSxcbiAgICAgIGlzRWxlbWVudCQxID0gZnVuY3Rpb24gKGUpIHtcbiAgICByZXR1cm4gaW5zdGFuY2VPZiQxKGUsIEVsZW1lbnQpO1xuICB9LFxuICAgICAgaXNFdmVudCQxID0gZnVuY3Rpb24gKGUpIHtcbiAgICByZXR1cm4gaW5zdGFuY2VPZiQxKGUsIEV2ZW50KTtcbiAgfSxcbiAgICAgIGlzRW1wdHkkMSA9IGZ1bmN0aW9uIChlKSB7XG4gICAgcmV0dXJuIGlzTnVsbE9yVW5kZWZpbmVkJDEoZSkgfHwgKGlzU3RyaW5nJDEoZSkgfHwgaXNBcnJheSQxKGUpIHx8IGlzTm9kZUxpc3QkMShlKSkgJiYgIWUubGVuZ3RoIHx8IGlzT2JqZWN0JDEoZSkgJiYgIU9iamVjdC5rZXlzKGUpLmxlbmd0aDtcbiAgfSxcbiAgICAgIGlzJDEgPSB7XG4gICAgbnVsbE9yVW5kZWZpbmVkOiBpc051bGxPclVuZGVmaW5lZCQxLFxuICAgIG9iamVjdDogaXNPYmplY3QkMSxcbiAgICBudW1iZXI6IGlzTnVtYmVyJDEsXG4gICAgc3RyaW5nOiBpc1N0cmluZyQxLFxuICAgIGJvb2xlYW46IGlzQm9vbGVhbiQxLFxuICAgIGZ1bmN0aW9uOiBpc0Z1bmN0aW9uJDEsXG4gICAgYXJyYXk6IGlzQXJyYXkkMSxcbiAgICBub2RlTGlzdDogaXNOb2RlTGlzdCQxLFxuICAgIGVsZW1lbnQ6IGlzRWxlbWVudCQxLFxuICAgIGV2ZW50OiBpc0V2ZW50JDEsXG4gICAgZW1wdHk6IGlzRW1wdHkkMVxuICB9O1xuXG4gIGZ1bmN0aW9uIGdldERlY2ltYWxQbGFjZXMoZSkge1xuICAgIHZhciB0ID0gXCJcIi5jb25jYXQoZSkubWF0Y2goLyg/OlxcLihcXGQrKSk/KD86W2VFXShbKy1dP1xcZCspKT8kLyk7XG4gICAgcmV0dXJuIHQgPyBNYXRoLm1heCgwLCAodFsxXSA/IHRbMV0ubGVuZ3RoIDogMCkgLSAodFsyXSA/ICt0WzJdIDogMCkpIDogMDtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJvdW5kKGUsIHQpIHtcbiAgICBpZiAoMSA+IHQpIHtcbiAgICAgIHZhciBuID0gZ2V0RGVjaW1hbFBsYWNlcyh0KTtcbiAgICAgIHJldHVybiBwYXJzZUZsb2F0KGUudG9GaXhlZChuKSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIE1hdGgucm91bmQoZSAvIHQpICogdDtcbiAgfVxuXG4gIHZhciBSYW5nZVRvdWNoID0gZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIGUodCwgbikge1xuICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIGUpLCBpcyQxLmVsZW1lbnQodCkgPyB0aGlzLmVsZW1lbnQgPSB0IDogaXMkMS5zdHJpbmcodCkgJiYgKHRoaXMuZWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodCkpLCBpcyQxLmVsZW1lbnQodGhpcy5lbGVtZW50KSAmJiBpcyQxLmVtcHR5KHRoaXMuZWxlbWVudC5yYW5nZVRvdWNoKSAmJiAodGhpcy5jb25maWcgPSBfb2JqZWN0U3ByZWFkMih7fSwgZGVmYXVsdHMkMSwge30sIG4pLCB0aGlzLmluaXQoKSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIF9jcmVhdGVDbGFzcyhlLCBbe1xuICAgICAga2V5OiBcImluaXRcIixcbiAgICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGUuZW5hYmxlZCAmJiAodGhpcy5jb25maWcuYWRkQ1NTICYmICh0aGlzLmVsZW1lbnQuc3R5bGUudXNlclNlbGVjdCA9IFwibm9uZVwiLCB0aGlzLmVsZW1lbnQuc3R5bGUud2ViS2l0VXNlclNlbGVjdCA9IFwibm9uZVwiLCB0aGlzLmVsZW1lbnQuc3R5bGUudG91Y2hBY3Rpb24gPSBcIm1hbmlwdWxhdGlvblwiKSwgdGhpcy5saXN0ZW5lcnMoITApLCB0aGlzLmVsZW1lbnQucmFuZ2VUb3VjaCA9IHRoaXMpO1xuICAgICAgfVxuICAgIH0sIHtcbiAgICAgIGtleTogXCJkZXN0cm95XCIsXG4gICAgICB2YWx1ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICBlLmVuYWJsZWQgJiYgKHRoaXMuY29uZmlnLmFkZENTUyAmJiAodGhpcy5lbGVtZW50LnN0eWxlLnVzZXJTZWxlY3QgPSBcIlwiLCB0aGlzLmVsZW1lbnQuc3R5bGUud2ViS2l0VXNlclNlbGVjdCA9IFwiXCIsIHRoaXMuZWxlbWVudC5zdHlsZS50b3VjaEFjdGlvbiA9IFwiXCIpLCB0aGlzLmxpc3RlbmVycyghMSksIHRoaXMuZWxlbWVudC5yYW5nZVRvdWNoID0gbnVsbCk7XG4gICAgICB9XG4gICAgfSwge1xuICAgICAga2V5OiBcImxpc3RlbmVyc1wiLFxuICAgICAgdmFsdWU6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHZhciB0ID0gdGhpcyxcbiAgICAgICAgICAgIG4gPSBlID8gXCJhZGRFdmVudExpc3RlbmVyXCIgOiBcInJlbW92ZUV2ZW50TGlzdGVuZXJcIjtcbiAgICAgICAgW1widG91Y2hzdGFydFwiLCBcInRvdWNobW92ZVwiLCBcInRvdWNoZW5kXCJdLmZvckVhY2goZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICB0LmVsZW1lbnRbbl0oZSwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIHJldHVybiB0LnNldChlKTtcbiAgICAgICAgICB9LCAhMSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0sIHtcbiAgICAgIGtleTogXCJnZXRcIixcbiAgICAgIHZhbHVlOiBmdW5jdGlvbiAodCkge1xuICAgICAgICBpZiAoIWUuZW5hYmxlZCB8fCAhaXMkMS5ldmVudCh0KSkgcmV0dXJuIG51bGw7XG4gICAgICAgIHZhciBuLFxuICAgICAgICAgICAgciA9IHQudGFyZ2V0LFxuICAgICAgICAgICAgaSA9IHQuY2hhbmdlZFRvdWNoZXNbMF0sXG4gICAgICAgICAgICBvID0gcGFyc2VGbG9hdChyLmdldEF0dHJpYnV0ZShcIm1pblwiKSkgfHwgMCxcbiAgICAgICAgICAgIHMgPSBwYXJzZUZsb2F0KHIuZ2V0QXR0cmlidXRlKFwibWF4XCIpKSB8fCAxMDAsXG4gICAgICAgICAgICB1ID0gcGFyc2VGbG9hdChyLmdldEF0dHJpYnV0ZShcInN0ZXBcIikpIHx8IDEsXG4gICAgICAgICAgICBjID0gci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSxcbiAgICAgICAgICAgIGEgPSAxMDAgLyBjLndpZHRoICogKHRoaXMuY29uZmlnLnRodW1iV2lkdGggLyAyKSAvIDEwMDtcbiAgICAgICAgcmV0dXJuIDAgPiAobiA9IDEwMCAvIGMud2lkdGggKiAoaS5jbGllbnRYIC0gYy5sZWZ0KSkgPyBuID0gMCA6IDEwMCA8IG4gJiYgKG4gPSAxMDApLCA1MCA+IG4gPyBuIC09ICgxMDAgLSAyICogbikgKiBhIDogNTAgPCBuICYmIChuICs9IDIgKiAobiAtIDUwKSAqIGEpLCBvICsgcm91bmQobiAvIDEwMCAqIChzIC0gbyksIHUpO1xuICAgICAgfVxuICAgIH0sIHtcbiAgICAgIGtleTogXCJzZXRcIixcbiAgICAgIHZhbHVlOiBmdW5jdGlvbiAodCkge1xuICAgICAgICBlLmVuYWJsZWQgJiYgaXMkMS5ldmVudCh0KSAmJiAhdC50YXJnZXQuZGlzYWJsZWQgJiYgKHQucHJldmVudERlZmF1bHQoKSwgdC50YXJnZXQudmFsdWUgPSB0aGlzLmdldCh0KSwgdHJpZ2dlcih0LnRhcmdldCwgXCJ0b3VjaGVuZFwiID09PSB0LnR5cGUgPyBcImNoYW5nZVwiIDogXCJpbnB1dFwiKSk7XG4gICAgICB9XG4gICAgfV0sIFt7XG4gICAgICBrZXk6IFwic2V0dXBcIixcbiAgICAgIHZhbHVlOiBmdW5jdGlvbiAodCkge1xuICAgICAgICB2YXIgbiA9IDEgPCBhcmd1bWVudHMubGVuZ3RoICYmIHZvaWQgMCAhPT0gYXJndW1lbnRzWzFdID8gYXJndW1lbnRzWzFdIDoge30sXG4gICAgICAgICAgICByID0gbnVsbDtcbiAgICAgICAgaWYgKGlzJDEuZW1wdHkodCkgfHwgaXMkMS5zdHJpbmcodCkgPyByID0gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGlzJDEuc3RyaW5nKHQpID8gdCA6ICdpbnB1dFt0eXBlPVwicmFuZ2VcIl0nKSkgOiBpcyQxLmVsZW1lbnQodCkgPyByID0gW3RdIDogaXMkMS5ub2RlTGlzdCh0KSA/IHIgPSBBcnJheS5mcm9tKHQpIDogaXMkMS5hcnJheSh0KSAmJiAociA9IHQuZmlsdGVyKGlzJDEuZWxlbWVudCkpLCBpcyQxLmVtcHR5KHIpKSByZXR1cm4gbnVsbDtcblxuICAgICAgICB2YXIgaSA9IF9vYmplY3RTcHJlYWQyKHt9LCBkZWZhdWx0cyQxLCB7fSwgbik7XG5cbiAgICAgICAgaWYgKGlzJDEuc3RyaW5nKHQpICYmIGkud2F0Y2gpIHtcbiAgICAgICAgICB2YXIgbyA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKGZ1bmN0aW9uIChuKSB7XG4gICAgICAgICAgICBBcnJheS5mcm9tKG4pLmZvckVhY2goZnVuY3Rpb24gKG4pIHtcbiAgICAgICAgICAgICAgQXJyYXkuZnJvbShuLmFkZGVkTm9kZXMpLmZvckVhY2goZnVuY3Rpb24gKG4pIHtcbiAgICAgICAgICAgICAgICBpcyQxLmVsZW1lbnQobikgJiYgbWF0Y2hlcyQxKG4sIHQpICYmIG5ldyBlKG4sIGkpO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIG8ub2JzZXJ2ZShkb2N1bWVudC5ib2R5LCB7XG4gICAgICAgICAgICBjaGlsZExpc3Q6ICEwLFxuICAgICAgICAgICAgc3VidHJlZTogITBcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiByLm1hcChmdW5jdGlvbiAodCkge1xuICAgICAgICAgIHJldHVybiBuZXcgZSh0LCBuKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSwge1xuICAgICAga2V5OiBcImVuYWJsZWRcIixcbiAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gXCJvbnRvdWNoc3RhcnRcIiBpbiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7XG4gICAgICB9XG4gICAgfV0pLCBlO1xuICB9KCk7XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8gVHlwZSBjaGVja2luZyB1dGlsc1xuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICBjb25zdCBnZXRDb25zdHJ1Y3RvciA9IGlucHV0ID0+IGlucHV0ICE9PSBudWxsICYmIHR5cGVvZiBpbnB1dCAhPT0gJ3VuZGVmaW5lZCcgPyBpbnB1dC5jb25zdHJ1Y3RvciA6IG51bGw7XG5cbiAgY29uc3QgaW5zdGFuY2VPZiA9IChpbnB1dCwgY29uc3RydWN0b3IpID0+IEJvb2xlYW4oaW5wdXQgJiYgY29uc3RydWN0b3IgJiYgaW5wdXQgaW5zdGFuY2VvZiBjb25zdHJ1Y3Rvcik7XG5cbiAgY29uc3QgaXNOdWxsT3JVbmRlZmluZWQgPSBpbnB1dCA9PiBpbnB1dCA9PT0gbnVsbCB8fCB0eXBlb2YgaW5wdXQgPT09ICd1bmRlZmluZWQnO1xuXG4gIGNvbnN0IGlzT2JqZWN0ID0gaW5wdXQgPT4gZ2V0Q29uc3RydWN0b3IoaW5wdXQpID09PSBPYmplY3Q7XG5cbiAgY29uc3QgaXNOdW1iZXIgPSBpbnB1dCA9PiBnZXRDb25zdHJ1Y3RvcihpbnB1dCkgPT09IE51bWJlciAmJiAhTnVtYmVyLmlzTmFOKGlucHV0KTtcblxuICBjb25zdCBpc1N0cmluZyA9IGlucHV0ID0+IGdldENvbnN0cnVjdG9yKGlucHV0KSA9PT0gU3RyaW5nO1xuXG4gIGNvbnN0IGlzQm9vbGVhbiA9IGlucHV0ID0+IGdldENvbnN0cnVjdG9yKGlucHV0KSA9PT0gQm9vbGVhbjtcblxuICBjb25zdCBpc0Z1bmN0aW9uID0gaW5wdXQgPT4gZ2V0Q29uc3RydWN0b3IoaW5wdXQpID09PSBGdW5jdGlvbjtcblxuICBjb25zdCBpc0FycmF5ID0gaW5wdXQgPT4gQXJyYXkuaXNBcnJheShpbnB1dCk7XG5cbiAgY29uc3QgaXNXZWFrTWFwID0gaW5wdXQgPT4gaW5zdGFuY2VPZihpbnB1dCwgV2Vha01hcCk7XG5cbiAgY29uc3QgaXNOb2RlTGlzdCA9IGlucHV0ID0+IGluc3RhbmNlT2YoaW5wdXQsIE5vZGVMaXN0KTtcblxuICBjb25zdCBpc1RleHROb2RlID0gaW5wdXQgPT4gZ2V0Q29uc3RydWN0b3IoaW5wdXQpID09PSBUZXh0O1xuXG4gIGNvbnN0IGlzRXZlbnQgPSBpbnB1dCA9PiBpbnN0YW5jZU9mKGlucHV0LCBFdmVudCk7XG5cbiAgY29uc3QgaXNLZXlib2FyZEV2ZW50ID0gaW5wdXQgPT4gaW5zdGFuY2VPZihpbnB1dCwgS2V5Ym9hcmRFdmVudCk7XG5cbiAgY29uc3QgaXNDdWUgPSBpbnB1dCA9PiBpbnN0YW5jZU9mKGlucHV0LCB3aW5kb3cuVGV4dFRyYWNrQ3VlKSB8fCBpbnN0YW5jZU9mKGlucHV0LCB3aW5kb3cuVlRUQ3VlKTtcblxuICBjb25zdCBpc1RyYWNrID0gaW5wdXQgPT4gaW5zdGFuY2VPZihpbnB1dCwgVGV4dFRyYWNrKSB8fCAhaXNOdWxsT3JVbmRlZmluZWQoaW5wdXQpICYmIGlzU3RyaW5nKGlucHV0LmtpbmQpO1xuXG4gIGNvbnN0IGlzUHJvbWlzZSA9IGlucHV0ID0+IGluc3RhbmNlT2YoaW5wdXQsIFByb21pc2UpICYmIGlzRnVuY3Rpb24oaW5wdXQudGhlbik7XG5cbiAgY29uc3QgaXNFbGVtZW50ID0gaW5wdXQgPT4gaW5wdXQgIT09IG51bGwgJiYgdHlwZW9mIGlucHV0ID09PSAnb2JqZWN0JyAmJiBpbnB1dC5ub2RlVHlwZSA9PT0gMSAmJiB0eXBlb2YgaW5wdXQuc3R5bGUgPT09ICdvYmplY3QnICYmIHR5cGVvZiBpbnB1dC5vd25lckRvY3VtZW50ID09PSAnb2JqZWN0JztcblxuICBjb25zdCBpc0VtcHR5ID0gaW5wdXQgPT4gaXNOdWxsT3JVbmRlZmluZWQoaW5wdXQpIHx8IChpc1N0cmluZyhpbnB1dCkgfHwgaXNBcnJheShpbnB1dCkgfHwgaXNOb2RlTGlzdChpbnB1dCkpICYmICFpbnB1dC5sZW5ndGggfHwgaXNPYmplY3QoaW5wdXQpICYmICFPYmplY3Qua2V5cyhpbnB1dCkubGVuZ3RoO1xuXG4gIGNvbnN0IGlzVXJsID0gaW5wdXQgPT4ge1xuICAgIC8vIEFjY2VwdCBhIFVSTCBvYmplY3RcbiAgICBpZiAoaW5zdGFuY2VPZihpbnB1dCwgd2luZG93LlVSTCkpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gLy8gTXVzdCBiZSBzdHJpbmcgZnJvbSBoZXJlXG5cblxuICAgIGlmICghaXNTdHJpbmcoaW5wdXQpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSAvLyBBZGQgdGhlIHByb3RvY29sIGlmIHJlcXVpcmVkXG5cblxuICAgIGxldCBzdHJpbmcgPSBpbnB1dDtcblxuICAgIGlmICghaW5wdXQuc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8ICFpbnB1dC5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG4gICAgICBzdHJpbmcgPSBgaHR0cDovLyR7aW5wdXR9YDtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgcmV0dXJuICFpc0VtcHR5KG5ldyBVUkwoc3RyaW5nKS5ob3N0bmFtZSk7XG4gICAgfSBjYXRjaCAoXykge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfTtcblxuICB2YXIgaXMgPSB7XG4gICAgbnVsbE9yVW5kZWZpbmVkOiBpc051bGxPclVuZGVmaW5lZCxcbiAgICBvYmplY3Q6IGlzT2JqZWN0LFxuICAgIG51bWJlcjogaXNOdW1iZXIsXG4gICAgc3RyaW5nOiBpc1N0cmluZyxcbiAgICBib29sZWFuOiBpc0Jvb2xlYW4sXG4gICAgZnVuY3Rpb246IGlzRnVuY3Rpb24sXG4gICAgYXJyYXk6IGlzQXJyYXksXG4gICAgd2Vha01hcDogaXNXZWFrTWFwLFxuICAgIG5vZGVMaXN0OiBpc05vZGVMaXN0LFxuICAgIGVsZW1lbnQ6IGlzRWxlbWVudCxcbiAgICB0ZXh0Tm9kZTogaXNUZXh0Tm9kZSxcbiAgICBldmVudDogaXNFdmVudCxcbiAgICBrZXlib2FyZEV2ZW50OiBpc0tleWJvYXJkRXZlbnQsXG4gICAgY3VlOiBpc0N1ZSxcbiAgICB0cmFjazogaXNUcmFjayxcbiAgICBwcm9taXNlOiBpc1Byb21pc2UsXG4gICAgdXJsOiBpc1VybCxcbiAgICBlbXB0eTogaXNFbXB0eVxuICB9O1xuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIGNvbnN0IHRyYW5zaXRpb25FbmRFdmVudCA9ICgoKSA9PiB7XG4gICAgY29uc3QgZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgICBjb25zdCBldmVudHMgPSB7XG4gICAgICBXZWJraXRUcmFuc2l0aW9uOiAnd2Via2l0VHJhbnNpdGlvbkVuZCcsXG4gICAgICBNb3pUcmFuc2l0aW9uOiAndHJhbnNpdGlvbmVuZCcsXG4gICAgICBPVHJhbnNpdGlvbjogJ29UcmFuc2l0aW9uRW5kIG90cmFuc2l0aW9uZW5kJyxcbiAgICAgIHRyYW5zaXRpb246ICd0cmFuc2l0aW9uZW5kJ1xuICAgIH07XG4gICAgY29uc3QgdHlwZSA9IE9iamVjdC5rZXlzKGV2ZW50cykuZmluZChldmVudCA9PiBlbGVtZW50LnN0eWxlW2V2ZW50XSAhPT0gdW5kZWZpbmVkKTtcbiAgICByZXR1cm4gaXMuc3RyaW5nKHR5cGUpID8gZXZlbnRzW3R5cGVdIDogZmFsc2U7XG4gIH0pKCk7IC8vIEZvcmNlIHJlcGFpbnQgb2YgZWxlbWVudFxuXG4gIGZ1bmN0aW9uIHJlcGFpbnQoZWxlbWVudCwgZGVsYXkpIHtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1wYXJhbS1yZWFzc2lnblxuICAgICAgICBlbGVtZW50LmhpZGRlbiA9IHRydWU7IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby11bnVzZWQtZXhwcmVzc2lvbnNcblxuICAgICAgICBlbGVtZW50Lm9mZnNldEhlaWdodDsgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXBhcmFtLXJlYXNzaWduXG5cbiAgICAgICAgZWxlbWVudC5oaWRkZW4gPSBmYWxzZTtcbiAgICAgIH0gY2F0Y2ggKF8pIHsvLyBEbyBub3RoaW5nXG4gICAgICB9XG4gICAgfSwgZGVsYXkpO1xuICB9XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8gQnJvd3NlciBzbmlmZmluZ1xuICAvLyBVbmZvcnR1bmF0ZWx5LCBkdWUgdG8gbWl4ZWQgc3VwcG9ydCwgVUEgc25pZmZpbmcgaXMgcmVxdWlyZWRcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgY29uc3QgYnJvd3NlciA9IHtcbiAgICBpc0lFOiBCb29sZWFuKHdpbmRvdy5kb2N1bWVudC5kb2N1bWVudE1vZGUpLFxuICAgIGlzRWRnZTogd2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQuaW5jbHVkZXMoJ0VkZ2UnKSxcbiAgICBpc1dlYmtpdDogJ1dlYmtpdEFwcGVhcmFuY2UnIGluIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZSAmJiAhL0VkZ2UvLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCksXG4gICAgaXNJUGhvbmU6IC8oaVBob25lfGlQb2QpL2dpLnRlc3QobmF2aWdhdG9yLnBsYXRmb3JtKSxcbiAgICBpc0lvczogbmF2aWdhdG9yLnBsYXRmb3JtID09PSAnTWFjSW50ZWwnICYmIG5hdmlnYXRvci5tYXhUb3VjaFBvaW50cyA+IDEgfHwgLyhpUGFkfGlQaG9uZXxpUG9kKS9naS50ZXN0KG5hdmlnYXRvci5wbGF0Zm9ybSlcbiAgfTtcblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4gIGZ1bmN0aW9uIGNsb25lRGVlcChvYmplY3QpIHtcbiAgICByZXR1cm4gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShvYmplY3QpKTtcbiAgfSAvLyBHZXQgYSBuZXN0ZWQgdmFsdWUgaW4gYW4gb2JqZWN0XG5cbiAgZnVuY3Rpb24gZ2V0RGVlcChvYmplY3QsIHBhdGgpIHtcbiAgICByZXR1cm4gcGF0aC5zcGxpdCgnLicpLnJlZHVjZSgob2JqLCBrZXkpID0+IG9iaiAmJiBvYmpba2V5XSwgb2JqZWN0KTtcbiAgfSAvLyBEZWVwIGV4dGVuZCBkZXN0aW5hdGlvbiBvYmplY3Qgd2l0aCBOIG1vcmUgb2JqZWN0c1xuXG4gIGZ1bmN0aW9uIGV4dGVuZCh0YXJnZXQgPSB7fSwgLi4uc291cmNlcykge1xuICAgIGlmICghc291cmNlcy5sZW5ndGgpIHtcbiAgICAgIHJldHVybiB0YXJnZXQ7XG4gICAgfVxuXG4gICAgY29uc3Qgc291cmNlID0gc291cmNlcy5zaGlmdCgpO1xuXG4gICAgaWYgKCFpcy5vYmplY3Qoc291cmNlKSkge1xuICAgICAgcmV0dXJuIHRhcmdldDtcbiAgICB9XG5cbiAgICBPYmplY3Qua2V5cyhzb3VyY2UpLmZvckVhY2goa2V5ID0+IHtcbiAgICAgIGlmIChpcy5vYmplY3Qoc291cmNlW2tleV0pKSB7XG4gICAgICAgIGlmICghT2JqZWN0LmtleXModGFyZ2V0KS5pbmNsdWRlcyhrZXkpKSB7XG4gICAgICAgICAgT2JqZWN0LmFzc2lnbih0YXJnZXQsIHtcbiAgICAgICAgICAgIFtrZXldOiB7fVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZXh0ZW5kKHRhcmdldFtrZXldLCBzb3VyY2Vba2V5XSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBPYmplY3QuYXNzaWduKHRhcmdldCwge1xuICAgICAgICAgIFtrZXldOiBzb3VyY2Vba2V5XVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gZXh0ZW5kKHRhcmdldCwgLi4uc291cmNlcyk7XG4gIH1cblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4gIGZ1bmN0aW9uIHdyYXAoZWxlbWVudHMsIHdyYXBwZXIpIHtcbiAgICAvLyBDb252ZXJ0IGBlbGVtZW50c2AgdG8gYW4gYXJyYXksIGlmIG5lY2Vzc2FyeS5cbiAgICBjb25zdCB0YXJnZXRzID0gZWxlbWVudHMubGVuZ3RoID8gZWxlbWVudHMgOiBbZWxlbWVudHNdOyAvLyBMb29wcyBiYWNrd2FyZHMgdG8gcHJldmVudCBoYXZpbmcgdG8gY2xvbmUgdGhlIHdyYXBwZXIgb24gdGhlXG4gICAgLy8gZmlyc3QgZWxlbWVudCAoc2VlIGBjaGlsZGAgYmVsb3cpLlxuXG4gICAgQXJyYXkuZnJvbSh0YXJnZXRzKS5yZXZlcnNlKCkuZm9yRWFjaCgoZWxlbWVudCwgaW5kZXgpID0+IHtcbiAgICAgIGNvbnN0IGNoaWxkID0gaW5kZXggPiAwID8gd3JhcHBlci5jbG9uZU5vZGUodHJ1ZSkgOiB3cmFwcGVyOyAvLyBDYWNoZSB0aGUgY3VycmVudCBwYXJlbnQgYW5kIHNpYmxpbmcuXG5cbiAgICAgIGNvbnN0IHBhcmVudCA9IGVsZW1lbnQucGFyZW50Tm9kZTtcbiAgICAgIGNvbnN0IHNpYmxpbmcgPSBlbGVtZW50Lm5leHRTaWJsaW5nOyAvLyBXcmFwIHRoZSBlbGVtZW50IChpcyBhdXRvbWF0aWNhbGx5IHJlbW92ZWQgZnJvbSBpdHMgY3VycmVudFxuICAgICAgLy8gcGFyZW50KS5cblxuICAgICAgY2hpbGQuYXBwZW5kQ2hpbGQoZWxlbWVudCk7IC8vIElmIHRoZSBlbGVtZW50IGhhZCBhIHNpYmxpbmcsIGluc2VydCB0aGUgd3JhcHBlciBiZWZvcmVcbiAgICAgIC8vIHRoZSBzaWJsaW5nIHRvIG1haW50YWluIHRoZSBIVE1MIHN0cnVjdHVyZTsgb3RoZXJ3aXNlLCBqdXN0XG4gICAgICAvLyBhcHBlbmQgaXQgdG8gdGhlIHBhcmVudC5cblxuICAgICAgaWYgKHNpYmxpbmcpIHtcbiAgICAgICAgcGFyZW50Lmluc2VydEJlZm9yZShjaGlsZCwgc2libGluZyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBwYXJlbnQuYXBwZW5kQ2hpbGQoY2hpbGQpO1xuICAgICAgfVxuICAgIH0pO1xuICB9IC8vIFNldCBhdHRyaWJ1dGVzXG5cbiAgZnVuY3Rpb24gc2V0QXR0cmlidXRlcyhlbGVtZW50LCBhdHRyaWJ1dGVzKSB7XG4gICAgaWYgKCFpcy5lbGVtZW50KGVsZW1lbnQpIHx8IGlzLmVtcHR5KGF0dHJpYnV0ZXMpKSB7XG4gICAgICByZXR1cm47XG4gICAgfSAvLyBBc3N1bWUgbnVsbCBhbmQgdW5kZWZpbmVkIGF0dHJpYnV0ZXMgc2hvdWxkIGJlIGxlZnQgb3V0LFxuICAgIC8vIFNldHRpbmcgdGhlbSB3b3VsZCBvdGhlcndpc2UgY29udmVydCB0aGVtIHRvIFwibnVsbFwiIGFuZCBcInVuZGVmaW5lZFwiXG5cblxuICAgIE9iamVjdC5lbnRyaWVzKGF0dHJpYnV0ZXMpLmZpbHRlcigoWywgdmFsdWVdKSA9PiAhaXMubnVsbE9yVW5kZWZpbmVkKHZhbHVlKSkuZm9yRWFjaCgoW2tleSwgdmFsdWVdKSA9PiBlbGVtZW50LnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKSk7XG4gIH0gLy8gQ3JlYXRlIGEgRG9jdW1lbnRGcmFnbWVudFxuXG4gIGZ1bmN0aW9uIGNyZWF0ZUVsZW1lbnQodHlwZSwgYXR0cmlidXRlcywgdGV4dCkge1xuICAgIC8vIENyZWF0ZSBhIG5ldyA8ZWxlbWVudD5cbiAgICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0eXBlKTsgLy8gU2V0IGFsbCBwYXNzZWQgYXR0cmlidXRlc1xuXG4gICAgaWYgKGlzLm9iamVjdChhdHRyaWJ1dGVzKSkge1xuICAgICAgc2V0QXR0cmlidXRlcyhlbGVtZW50LCBhdHRyaWJ1dGVzKTtcbiAgICB9IC8vIEFkZCB0ZXh0IG5vZGVcblxuXG4gICAgaWYgKGlzLnN0cmluZyh0ZXh0KSkge1xuICAgICAgZWxlbWVudC5pbm5lclRleHQgPSB0ZXh0O1xuICAgIH0gLy8gUmV0dXJuIGJ1aWx0IGVsZW1lbnRcblxuXG4gICAgcmV0dXJuIGVsZW1lbnQ7XG4gIH0gLy8gSW5hZXJ0IGFuIGVsZW1lbnQgYWZ0ZXIgYW5vdGhlclxuXG4gIGZ1bmN0aW9uIGluc2VydEFmdGVyKGVsZW1lbnQsIHRhcmdldCkge1xuICAgIGlmICghaXMuZWxlbWVudChlbGVtZW50KSB8fCAhaXMuZWxlbWVudCh0YXJnZXQpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGFyZ2V0LnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGVsZW1lbnQsIHRhcmdldC5uZXh0U2libGluZyk7XG4gIH0gLy8gSW5zZXJ0IGEgRG9jdW1lbnRGcmFnbWVudFxuXG4gIGZ1bmN0aW9uIGluc2VydEVsZW1lbnQodHlwZSwgcGFyZW50LCBhdHRyaWJ1dGVzLCB0ZXh0KSB7XG4gICAgaWYgKCFpcy5lbGVtZW50KHBhcmVudCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBwYXJlbnQuYXBwZW5kQ2hpbGQoY3JlYXRlRWxlbWVudCh0eXBlLCBhdHRyaWJ1dGVzLCB0ZXh0KSk7XG4gIH0gLy8gUmVtb3ZlIGVsZW1lbnQocylcblxuICBmdW5jdGlvbiByZW1vdmVFbGVtZW50KGVsZW1lbnQpIHtcbiAgICBpZiAoaXMubm9kZUxpc3QoZWxlbWVudCkgfHwgaXMuYXJyYXkoZWxlbWVudCkpIHtcbiAgICAgIEFycmF5LmZyb20oZWxlbWVudCkuZm9yRWFjaChyZW1vdmVFbGVtZW50KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoIWlzLmVsZW1lbnQoZWxlbWVudCkgfHwgIWlzLmVsZW1lbnQoZWxlbWVudC5wYXJlbnROb2RlKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGVsZW1lbnQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChlbGVtZW50KTtcbiAgfSAvLyBSZW1vdmUgYWxsIGNoaWxkIGVsZW1lbnRzXG5cbiAgZnVuY3Rpb24gZW1wdHlFbGVtZW50KGVsZW1lbnQpIHtcbiAgICBpZiAoIWlzLmVsZW1lbnQoZWxlbWVudCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBsZXQge1xuICAgICAgbGVuZ3RoXG4gICAgfSA9IGVsZW1lbnQuY2hpbGROb2RlcztcblxuICAgIHdoaWxlIChsZW5ndGggPiAwKSB7XG4gICAgICBlbGVtZW50LnJlbW92ZUNoaWxkKGVsZW1lbnQubGFzdENoaWxkKTtcbiAgICAgIGxlbmd0aCAtPSAxO1xuICAgIH1cbiAgfSAvLyBSZXBsYWNlIGVsZW1lbnRcblxuICBmdW5jdGlvbiByZXBsYWNlRWxlbWVudChuZXdDaGlsZCwgb2xkQ2hpbGQpIHtcbiAgICBpZiAoIWlzLmVsZW1lbnQob2xkQ2hpbGQpIHx8ICFpcy5lbGVtZW50KG9sZENoaWxkLnBhcmVudE5vZGUpIHx8ICFpcy5lbGVtZW50KG5ld0NoaWxkKSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgb2xkQ2hpbGQucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQobmV3Q2hpbGQsIG9sZENoaWxkKTtcbiAgICByZXR1cm4gbmV3Q2hpbGQ7XG4gIH0gLy8gR2V0IGFuIGF0dHJpYnV0ZSBvYmplY3QgZnJvbSBhIHN0cmluZyBzZWxlY3RvclxuXG4gIGZ1bmN0aW9uIGdldEF0dHJpYnV0ZXNGcm9tU2VsZWN0b3Ioc2VsLCBleGlzdGluZ0F0dHJpYnV0ZXMpIHtcbiAgICAvLyBGb3IgZXhhbXBsZTpcbiAgICAvLyAnLnRlc3QnIHRvIHsgY2xhc3M6ICd0ZXN0JyB9XG4gICAgLy8gJyN0ZXN0JyB0byB7IGlkOiAndGVzdCcgfVxuICAgIC8vICdbZGF0YS10ZXN0PVwidGVzdFwiXScgdG8geyAnZGF0YS10ZXN0JzogJ3Rlc3QnIH1cbiAgICBpZiAoIWlzLnN0cmluZyhzZWwpIHx8IGlzLmVtcHR5KHNlbCkpIHtcbiAgICAgIHJldHVybiB7fTtcbiAgICB9XG5cbiAgICBjb25zdCBhdHRyaWJ1dGVzID0ge307XG4gICAgY29uc3QgZXhpc3RpbmcgPSBleHRlbmQoe30sIGV4aXN0aW5nQXR0cmlidXRlcyk7XG4gICAgc2VsLnNwbGl0KCcsJykuZm9yRWFjaChzID0+IHtcbiAgICAgIC8vIFJlbW92ZSB3aGl0ZXNwYWNlXG4gICAgICBjb25zdCBzZWxlY3RvciA9IHMudHJpbSgpO1xuICAgICAgY29uc3QgY2xhc3NOYW1lID0gc2VsZWN0b3IucmVwbGFjZSgnLicsICcnKTtcbiAgICAgIGNvbnN0IHN0cmlwcGVkID0gc2VsZWN0b3IucmVwbGFjZSgvW1tcXF1dL2csICcnKTsgLy8gR2V0IHRoZSBwYXJ0cyBhbmQgdmFsdWVcblxuICAgICAgY29uc3QgcGFydHMgPSBzdHJpcHBlZC5zcGxpdCgnPScpO1xuICAgICAgY29uc3QgW2tleV0gPSBwYXJ0cztcbiAgICAgIGNvbnN0IHZhbHVlID0gcGFydHMubGVuZ3RoID4gMSA/IHBhcnRzWzFdLnJlcGxhY2UoL1tcIiddL2csICcnKSA6ICcnOyAvLyBHZXQgdGhlIGZpcnN0IGNoYXJhY3RlclxuXG4gICAgICBjb25zdCBzdGFydCA9IHNlbGVjdG9yLmNoYXJBdCgwKTtcblxuICAgICAgc3dpdGNoIChzdGFydCkge1xuICAgICAgICBjYXNlICcuJzpcbiAgICAgICAgICAvLyBBZGQgdG8gZXhpc3RpbmcgY2xhc3NuYW1lXG4gICAgICAgICAgaWYgKGlzLnN0cmluZyhleGlzdGluZy5jbGFzcykpIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZXMuY2xhc3MgPSBgJHtleGlzdGluZy5jbGFzc30gJHtjbGFzc05hbWV9YDtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYXR0cmlidXRlcy5jbGFzcyA9IGNsYXNzTmFtZTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBicmVhaztcblxuICAgICAgICBjYXNlICcjJzpcbiAgICAgICAgICAvLyBJRCBzZWxlY3RvclxuICAgICAgICAgIGF0dHJpYnV0ZXMuaWQgPSBzZWxlY3Rvci5yZXBsYWNlKCcjJywgJycpO1xuICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgIGNhc2UgJ1snOlxuICAgICAgICAgIC8vIEF0dHJpYnV0ZSBzZWxlY3RvclxuICAgICAgICAgIGF0dHJpYnV0ZXNba2V5XSA9IHZhbHVlO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiBleHRlbmQoZXhpc3RpbmcsIGF0dHJpYnV0ZXMpO1xuICB9IC8vIFRvZ2dsZSBoaWRkZW5cblxuICBmdW5jdGlvbiB0b2dnbGVIaWRkZW4oZWxlbWVudCwgaGlkZGVuKSB7XG4gICAgaWYgKCFpcy5lbGVtZW50KGVsZW1lbnQpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgbGV0IGhpZGUgPSBoaWRkZW47XG5cbiAgICBpZiAoIWlzLmJvb2xlYW4oaGlkZSkpIHtcbiAgICAgIGhpZGUgPSAhZWxlbWVudC5oaWRkZW47XG4gICAgfSAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcGFyYW0tcmVhc3NpZ25cblxuXG4gICAgZWxlbWVudC5oaWRkZW4gPSBoaWRlO1xuICB9IC8vIE1pcnJvciBFbGVtZW50LmNsYXNzTGlzdC50b2dnbGUsIHdpdGggSUUgY29tcGF0aWJpbGl0eSBmb3IgXCJmb3JjZVwiIGFyZ3VtZW50XG5cbiAgZnVuY3Rpb24gdG9nZ2xlQ2xhc3MoZWxlbWVudCwgY2xhc3NOYW1lLCBmb3JjZSkge1xuICAgIGlmIChpcy5ub2RlTGlzdChlbGVtZW50KSkge1xuICAgICAgcmV0dXJuIEFycmF5LmZyb20oZWxlbWVudCkubWFwKGUgPT4gdG9nZ2xlQ2xhc3MoZSwgY2xhc3NOYW1lLCBmb3JjZSkpO1xuICAgIH1cblxuICAgIGlmIChpcy5lbGVtZW50KGVsZW1lbnQpKSB7XG4gICAgICBsZXQgbWV0aG9kID0gJ3RvZ2dsZSc7XG5cbiAgICAgIGlmICh0eXBlb2YgZm9yY2UgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgIG1ldGhvZCA9IGZvcmNlID8gJ2FkZCcgOiAncmVtb3ZlJztcbiAgICAgIH1cblxuICAgICAgZWxlbWVudC5jbGFzc0xpc3RbbWV0aG9kXShjbGFzc05hbWUpO1xuICAgICAgcmV0dXJuIGVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKGNsYXNzTmFtZSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9IC8vIEhhcyBjbGFzcyBuYW1lXG5cbiAgZnVuY3Rpb24gaGFzQ2xhc3MoZWxlbWVudCwgY2xhc3NOYW1lKSB7XG4gICAgcmV0dXJuIGlzLmVsZW1lbnQoZWxlbWVudCkgJiYgZWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoY2xhc3NOYW1lKTtcbiAgfSAvLyBFbGVtZW50IG1hdGNoZXMgc2VsZWN0b3JcblxuICBmdW5jdGlvbiBtYXRjaGVzKGVsZW1lbnQsIHNlbGVjdG9yKSB7XG4gICAgY29uc3Qge1xuICAgICAgcHJvdG90eXBlXG4gICAgfSA9IEVsZW1lbnQ7XG5cbiAgICBmdW5jdGlvbiBtYXRjaCgpIHtcbiAgICAgIHJldHVybiBBcnJheS5mcm9tKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpKS5pbmNsdWRlcyh0aGlzKTtcbiAgICB9XG5cbiAgICBjb25zdCBtZXRob2QgPSBwcm90b3R5cGUubWF0Y2hlcyB8fCBwcm90b3R5cGUud2Via2l0TWF0Y2hlc1NlbGVjdG9yIHx8IHByb3RvdHlwZS5tb3pNYXRjaGVzU2VsZWN0b3IgfHwgcHJvdG90eXBlLm1zTWF0Y2hlc1NlbGVjdG9yIHx8IG1hdGNoO1xuICAgIHJldHVybiBtZXRob2QuY2FsbChlbGVtZW50LCBzZWxlY3Rvcik7XG4gIH0gLy8gQ2xvc2VzdCBhbmNlc3RvciBlbGVtZW50IG1hdGNoaW5nIHNlbGVjdG9yIChhbHNvIHRlc3RzIGVsZW1lbnQgaXRzZWxmKVxuXG4gIGZ1bmN0aW9uIGNsb3Nlc3QkMShlbGVtZW50LCBzZWxlY3Rvcikge1xuICAgIGNvbnN0IHtcbiAgICAgIHByb3RvdHlwZVxuICAgIH0gPSBFbGVtZW50OyAvLyBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvRWxlbWVudC9jbG9zZXN0I1BvbHlmaWxsXG5cbiAgICBmdW5jdGlvbiBjbG9zZXN0RWxlbWVudCgpIHtcbiAgICAgIGxldCBlbCA9IHRoaXM7XG5cbiAgICAgIGRvIHtcbiAgICAgICAgaWYgKG1hdGNoZXMubWF0Y2hlcyhlbCwgc2VsZWN0b3IpKSByZXR1cm4gZWw7XG4gICAgICAgIGVsID0gZWwucGFyZW50RWxlbWVudCB8fCBlbC5wYXJlbnROb2RlO1xuICAgICAgfSB3aGlsZSAoZWwgIT09IG51bGwgJiYgZWwubm9kZVR5cGUgPT09IDEpO1xuXG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBjb25zdCBtZXRob2QgPSBwcm90b3R5cGUuY2xvc2VzdCB8fCBjbG9zZXN0RWxlbWVudDtcbiAgICByZXR1cm4gbWV0aG9kLmNhbGwoZWxlbWVudCwgc2VsZWN0b3IpO1xuICB9IC8vIEZpbmQgYWxsIGVsZW1lbnRzXG5cbiAgZnVuY3Rpb24gZ2V0RWxlbWVudHMoc2VsZWN0b3IpIHtcbiAgICByZXR1cm4gdGhpcy5lbGVtZW50cy5jb250YWluZXIucXVlcnlTZWxlY3RvckFsbChzZWxlY3Rvcik7XG4gIH0gLy8gRmluZCBhIHNpbmdsZSBlbGVtZW50XG5cbiAgZnVuY3Rpb24gZ2V0RWxlbWVudChzZWxlY3Rvcikge1xuICAgIHJldHVybiB0aGlzLmVsZW1lbnRzLmNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKTtcbiAgfSAvLyBTZXQgZm9jdXMgYW5kIHRhYiBmb2N1cyBjbGFzc1xuXG4gIGZ1bmN0aW9uIHNldEZvY3VzKGVsZW1lbnQgPSBudWxsLCB0YWJGb2N1cyA9IGZhbHNlKSB7XG4gICAgaWYgKCFpcy5lbGVtZW50KGVsZW1lbnQpKSB7XG4gICAgICByZXR1cm47XG4gICAgfSAvLyBTZXQgcmVndWxhciBmb2N1c1xuXG5cbiAgICBlbGVtZW50LmZvY3VzKHtcbiAgICAgIHByZXZlbnRTY3JvbGw6IHRydWVcbiAgICB9KTsgLy8gSWYgd2Ugd2FudCB0byBtaW1pYyBrZXlib2FyZCBmb2N1cyB2aWEgdGFiXG5cbiAgICBpZiAodGFiRm9jdXMpIHtcbiAgICAgIHRvZ2dsZUNsYXNzKGVsZW1lbnQsIHRoaXMuY29uZmlnLmNsYXNzTmFtZXMudGFiRm9jdXMpO1xuICAgIH1cbiAgfVxuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiAgY29uc3QgZGVmYXVsdENvZGVjcyA9IHtcbiAgICAnYXVkaW8vb2dnJzogJ3ZvcmJpcycsXG4gICAgJ2F1ZGlvL3dhdic6ICcxJyxcbiAgICAndmlkZW8vd2VibSc6ICd2cDgsIHZvcmJpcycsXG4gICAgJ3ZpZGVvL21wNCc6ICdhdmMxLjQyRTAxRSwgbXA0YS40MC4yJyxcbiAgICAndmlkZW8vb2dnJzogJ3RoZW9yYSdcbiAgfTsgLy8gQ2hlY2sgZm9yIGZlYXR1cmUgc3VwcG9ydFxuXG4gIGNvbnN0IHN1cHBvcnQgPSB7XG4gICAgLy8gQmFzaWMgc3VwcG9ydFxuICAgIGF1ZGlvOiAnY2FuUGxheVR5cGUnIGluIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2F1ZGlvJyksXG4gICAgdmlkZW86ICdjYW5QbGF5VHlwZScgaW4gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndmlkZW8nKSxcblxuICAgIC8vIENoZWNrIGZvciBzdXBwb3J0XG4gICAgLy8gQmFzaWMgZnVuY3Rpb25hbGl0eSB2cyBmdWxsIFVJXG4gICAgY2hlY2sodHlwZSwgcHJvdmlkZXIsIHBsYXlzaW5saW5lKSB7XG4gICAgICBjb25zdCBjYW5QbGF5SW5saW5lID0gYnJvd3Nlci5pc0lQaG9uZSAmJiBwbGF5c2lubGluZSAmJiBzdXBwb3J0LnBsYXlzaW5saW5lO1xuICAgICAgY29uc3QgYXBpID0gc3VwcG9ydFt0eXBlXSB8fCBwcm92aWRlciAhPT0gJ2h0bWw1JztcbiAgICAgIGNvbnN0IHVpID0gYXBpICYmIHN1cHBvcnQucmFuZ2VJbnB1dCAmJiAodHlwZSAhPT0gJ3ZpZGVvJyB8fCAhYnJvd3Nlci5pc0lQaG9uZSB8fCBjYW5QbGF5SW5saW5lKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGFwaSxcbiAgICAgICAgdWlcbiAgICAgIH07XG4gICAgfSxcblxuICAgIC8vIFBpY3R1cmUtaW4tcGljdHVyZSBzdXBwb3J0XG4gICAgLy8gU2FmYXJpICYgQ2hyb21lIG9ubHkgY3VycmVudGx5XG4gICAgcGlwOiAoKCkgPT4ge1xuICAgICAgaWYgKGJyb3dzZXIuaXNJUGhvbmUpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfSAvLyBTYWZhcmlcbiAgICAgIC8vIGh0dHBzOi8vZGV2ZWxvcGVyLmFwcGxlLmNvbS9kb2N1bWVudGF0aW9uL3dlYmtpdGpzL2FkZGluZ19waWN0dXJlX2luX3BpY3R1cmVfdG9feW91cl9zYWZhcmlfbWVkaWFfY29udHJvbHNcblxuXG4gICAgICBpZiAoaXMuZnVuY3Rpb24oY3JlYXRlRWxlbWVudCgndmlkZW8nKS53ZWJraXRTZXRQcmVzZW50YXRpb25Nb2RlKSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH0gLy8gQ2hyb21lXG4gICAgICAvLyBodHRwczovL2RldmVsb3BlcnMuZ29vZ2xlLmNvbS93ZWIvdXBkYXRlcy8yMDE4LzEwL3dhdGNoLXZpZGVvLXVzaW5nLXBpY3R1cmUtaW4tcGljdHVyZVxuXG5cbiAgICAgIGlmIChkb2N1bWVudC5waWN0dXJlSW5QaWN0dXJlRW5hYmxlZCAmJiAhY3JlYXRlRWxlbWVudCgndmlkZW8nKS5kaXNhYmxlUGljdHVyZUluUGljdHVyZSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0pKCksXG4gICAgLy8gQWlycGxheSBzdXBwb3J0XG4gICAgLy8gU2FmYXJpIG9ubHkgY3VycmVudGx5XG4gICAgYWlycGxheTogaXMuZnVuY3Rpb24od2luZG93LldlYktpdFBsYXliYWNrVGFyZ2V0QXZhaWxhYmlsaXR5RXZlbnQpLFxuICAgIC8vIElubGluZSBwbGF5YmFjayBzdXBwb3J0XG4gICAgLy8gaHR0cHM6Ly93ZWJraXQub3JnL2Jsb2cvNjc4NC9uZXctdmlkZW8tcG9saWNpZXMtZm9yLWlvcy9cbiAgICBwbGF5c2lubGluZTogJ3BsYXlzSW5saW5lJyBpbiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd2aWRlbycpLFxuXG4gICAgLy8gQ2hlY2sgZm9yIG1pbWUgdHlwZSBzdXBwb3J0IGFnYWluc3QgYSBwbGF5ZXIgaW5zdGFuY2VcbiAgICAvLyBDcmVkaXRzOiBodHRwOi8vZGl2ZWludG9odG1sNS5pbmZvL2V2ZXJ5dGhpbmcuaHRtbFxuICAgIC8vIFJlbGF0ZWQ6IGh0dHA6Ly93d3cubGVhbmJhY2twbGF5ZXIuY29tL3Rlc3QvaDVtdC5odG1sXG4gICAgbWltZShpbnB1dCkge1xuICAgICAgaWYgKGlzLmVtcHR5KGlucHV0KSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IFttZWRpYVR5cGVdID0gaW5wdXQuc3BsaXQoJy8nKTtcbiAgICAgIGxldCB0eXBlID0gaW5wdXQ7IC8vIFZlcmlmeSB3ZSdyZSB1c2luZyBIVE1MNSBhbmQgdGhlcmUncyBubyBtZWRpYSB0eXBlIG1pc21hdGNoXG5cbiAgICAgIGlmICghdGhpcy5pc0hUTUw1IHx8IG1lZGlhVHlwZSAhPT0gdGhpcy50eXBlKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH0gLy8gQWRkIGNvZGVjIGlmIHJlcXVpcmVkXG5cblxuICAgICAgaWYgKE9iamVjdC5rZXlzKGRlZmF1bHRDb2RlY3MpLmluY2x1ZGVzKHR5cGUpKSB7XG4gICAgICAgIHR5cGUgKz0gYDsgY29kZWNzPVwiJHtkZWZhdWx0Q29kZWNzW2lucHV0XX1cImA7XG4gICAgICB9XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIHJldHVybiBCb29sZWFuKHR5cGUgJiYgdGhpcy5tZWRpYS5jYW5QbGF5VHlwZSh0eXBlKS5yZXBsYWNlKC9uby8sICcnKSk7XG4gICAgICB9IGNhdGNoIChfKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgLy8gQ2hlY2sgZm9yIHRleHRUcmFja3Mgc3VwcG9ydFxuICAgIHRleHRUcmFja3M6ICd0ZXh0VHJhY2tzJyBpbiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd2aWRlbycpLFxuICAgIC8vIDxpbnB1dCB0eXBlPVwicmFuZ2VcIj4gU2xpZGVyc1xuICAgIHJhbmdlSW5wdXQ6ICgoKSA9PiB7XG4gICAgICBjb25zdCByYW5nZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7XG4gICAgICByYW5nZS50eXBlID0gJ3JhbmdlJztcbiAgICAgIHJldHVybiByYW5nZS50eXBlID09PSAncmFuZ2UnO1xuICAgIH0pKCksXG4gICAgLy8gVG91Y2hcbiAgICAvLyBOT1RFOiBSZW1lbWJlciBhIGRldmljZSBjYW4gYmUgbW91c2UgKyB0b3VjaCBlbmFibGVkIHNvIHdlIGNoZWNrIG9uIGZpcnN0IHRvdWNoIGV2ZW50XG4gICAgdG91Y2g6ICdvbnRvdWNoc3RhcnQnIGluIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCxcbiAgICAvLyBEZXRlY3QgdHJhbnNpdGlvbnMgc3VwcG9ydFxuICAgIHRyYW5zaXRpb25zOiB0cmFuc2l0aW9uRW5kRXZlbnQgIT09IGZhbHNlLFxuICAgIC8vIFJlZHVjZWQgbW90aW9uIGlPUyAmIE1hY09TIHNldHRpbmdcbiAgICAvLyBodHRwczovL3dlYmtpdC5vcmcvYmxvZy83NTUxL3Jlc3BvbnNpdmUtZGVzaWduLWZvci1tb3Rpb24vXG4gICAgcmVkdWNlZE1vdGlvbjogJ21hdGNoTWVkaWEnIGluIHdpbmRvdyAmJiB3aW5kb3cubWF0Y2hNZWRpYSgnKHByZWZlcnMtcmVkdWNlZC1tb3Rpb24pJykubWF0Y2hlc1xuICB9O1xuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9XSUNHL0V2ZW50TGlzdGVuZXJPcHRpb25zL2Jsb2IvZ2gtcGFnZXMvZXhwbGFpbmVyLm1kXG4gIC8vIGh0dHBzOi8vd3d3LnlvdXR1YmUuY29tL3dhdGNoP3Y9TlBNNjE3MkoyMmdcblxuICBjb25zdCBzdXBwb3J0c1Bhc3NpdmVMaXN0ZW5lcnMgPSAoKCkgPT4ge1xuICAgIC8vIFRlc3QgdmlhIGEgZ2V0dGVyIGluIHRoZSBvcHRpb25zIG9iamVjdCB0byBzZWUgaWYgdGhlIHBhc3NpdmUgcHJvcGVydHkgaXMgYWNjZXNzZWRcbiAgICBsZXQgc3VwcG9ydGVkID0gZmFsc2U7XG5cbiAgICB0cnkge1xuICAgICAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh7fSwgJ3Bhc3NpdmUnLCB7XG4gICAgICAgIGdldCgpIHtcbiAgICAgICAgICBzdXBwb3J0ZWQgPSB0cnVlO1xuICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG5cbiAgICAgIH0pO1xuICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Rlc3QnLCBudWxsLCBvcHRpb25zKTtcbiAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCd0ZXN0JywgbnVsbCwgb3B0aW9ucyk7XG4gICAgfSBjYXRjaCAoXykgey8vIERvIG5vdGhpbmdcbiAgICB9XG5cbiAgICByZXR1cm4gc3VwcG9ydGVkO1xuICB9KSgpOyAvLyBUb2dnbGUgZXZlbnQgbGlzdGVuZXJcblxuXG4gIGZ1bmN0aW9uIHRvZ2dsZUxpc3RlbmVyKGVsZW1lbnQsIGV2ZW50LCBjYWxsYmFjaywgdG9nZ2xlID0gZmFsc2UsIHBhc3NpdmUgPSB0cnVlLCBjYXB0dXJlID0gZmFsc2UpIHtcbiAgICAvLyBCYWlsIGlmIG5vIGVsZW1lbnQsIGV2ZW50LCBvciBjYWxsYmFja1xuICAgIGlmICghZWxlbWVudCB8fCAhKCdhZGRFdmVudExpc3RlbmVyJyBpbiBlbGVtZW50KSB8fCBpcy5lbXB0eShldmVudCkgfHwgIWlzLmZ1bmN0aW9uKGNhbGxiYWNrKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH0gLy8gQWxsb3cgbXVsdGlwbGUgZXZlbnRzXG5cblxuICAgIGNvbnN0IGV2ZW50cyA9IGV2ZW50LnNwbGl0KCcgJyk7IC8vIEJ1aWxkIG9wdGlvbnNcbiAgICAvLyBEZWZhdWx0IHRvIGp1c3QgdGhlIGNhcHR1cmUgYm9vbGVhbiBmb3IgYnJvd3NlcnMgd2l0aCBubyBwYXNzaXZlIGxpc3RlbmVyIHN1cHBvcnRcblxuICAgIGxldCBvcHRpb25zID0gY2FwdHVyZTsgLy8gSWYgcGFzc2l2ZSBldmVudHMgbGlzdGVuZXJzIGFyZSBzdXBwb3J0ZWRcblxuICAgIGlmIChzdXBwb3J0c1Bhc3NpdmVMaXN0ZW5lcnMpIHtcbiAgICAgIG9wdGlvbnMgPSB7XG4gICAgICAgIC8vIFdoZXRoZXIgdGhlIGxpc3RlbmVyIGNhbiBiZSBwYXNzaXZlIChpLmUuIGRlZmF1bHQgbmV2ZXIgcHJldmVudGVkKVxuICAgICAgICBwYXNzaXZlLFxuICAgICAgICAvLyBXaGV0aGVyIHRoZSBsaXN0ZW5lciBpcyBhIGNhcHR1cmluZyBsaXN0ZW5lciBvciBub3RcbiAgICAgICAgY2FwdHVyZVxuICAgICAgfTtcbiAgICB9IC8vIElmIGEgc2luZ2xlIG5vZGUgaXMgcGFzc2VkLCBiaW5kIHRoZSBldmVudCBsaXN0ZW5lclxuXG5cbiAgICBldmVudHMuZm9yRWFjaCh0eXBlID0+IHtcbiAgICAgIGlmICh0aGlzICYmIHRoaXMuZXZlbnRMaXN0ZW5lcnMgJiYgdG9nZ2xlKSB7XG4gICAgICAgIC8vIENhY2hlIGV2ZW50IGxpc3RlbmVyXG4gICAgICAgIHRoaXMuZXZlbnRMaXN0ZW5lcnMucHVzaCh7XG4gICAgICAgICAgZWxlbWVudCxcbiAgICAgICAgICB0eXBlLFxuICAgICAgICAgIGNhbGxiYWNrLFxuICAgICAgICAgIG9wdGlvbnNcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGVsZW1lbnRbdG9nZ2xlID8gJ2FkZEV2ZW50TGlzdGVuZXInIDogJ3JlbW92ZUV2ZW50TGlzdGVuZXInXSh0eXBlLCBjYWxsYmFjaywgb3B0aW9ucyk7XG4gICAgfSk7XG4gIH0gLy8gQmluZCBldmVudCBoYW5kbGVyXG5cbiAgZnVuY3Rpb24gb24oZWxlbWVudCwgZXZlbnRzID0gJycsIGNhbGxiYWNrLCBwYXNzaXZlID0gdHJ1ZSwgY2FwdHVyZSA9IGZhbHNlKSB7XG4gICAgdG9nZ2xlTGlzdGVuZXIuY2FsbCh0aGlzLCBlbGVtZW50LCBldmVudHMsIGNhbGxiYWNrLCB0cnVlLCBwYXNzaXZlLCBjYXB0dXJlKTtcbiAgfSAvLyBVbmJpbmQgZXZlbnQgaGFuZGxlclxuXG4gIGZ1bmN0aW9uIG9mZihlbGVtZW50LCBldmVudHMgPSAnJywgY2FsbGJhY2ssIHBhc3NpdmUgPSB0cnVlLCBjYXB0dXJlID0gZmFsc2UpIHtcbiAgICB0b2dnbGVMaXN0ZW5lci5jYWxsKHRoaXMsIGVsZW1lbnQsIGV2ZW50cywgY2FsbGJhY2ssIGZhbHNlLCBwYXNzaXZlLCBjYXB0dXJlKTtcbiAgfSAvLyBCaW5kIG9uY2Utb25seSBldmVudCBoYW5kbGVyXG5cbiAgZnVuY3Rpb24gb25jZShlbGVtZW50LCBldmVudHMgPSAnJywgY2FsbGJhY2ssIHBhc3NpdmUgPSB0cnVlLCBjYXB0dXJlID0gZmFsc2UpIHtcbiAgICBjb25zdCBvbmNlQ2FsbGJhY2sgPSAoLi4uYXJncykgPT4ge1xuICAgICAgb2ZmKGVsZW1lbnQsIGV2ZW50cywgb25jZUNhbGxiYWNrLCBwYXNzaXZlLCBjYXB0dXJlKTtcbiAgICAgIGNhbGxiYWNrLmFwcGx5KHRoaXMsIGFyZ3MpO1xuICAgIH07XG5cbiAgICB0b2dnbGVMaXN0ZW5lci5jYWxsKHRoaXMsIGVsZW1lbnQsIGV2ZW50cywgb25jZUNhbGxiYWNrLCB0cnVlLCBwYXNzaXZlLCBjYXB0dXJlKTtcbiAgfSAvLyBUcmlnZ2VyIGV2ZW50XG5cbiAgZnVuY3Rpb24gdHJpZ2dlckV2ZW50KGVsZW1lbnQsIHR5cGUgPSAnJywgYnViYmxlcyA9IGZhbHNlLCBkZXRhaWwgPSB7fSkge1xuICAgIC8vIEJhaWwgaWYgbm8gZWxlbWVudFxuICAgIGlmICghaXMuZWxlbWVudChlbGVtZW50KSB8fCBpcy5lbXB0eSh0eXBlKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH0gLy8gQ3JlYXRlIGFuZCBkaXNwYXRjaCB0aGUgZXZlbnRcblxuXG4gICAgY29uc3QgZXZlbnQgPSBuZXcgQ3VzdG9tRXZlbnQodHlwZSwge1xuICAgICAgYnViYmxlcyxcbiAgICAgIGRldGFpbDogeyAuLi5kZXRhaWwsXG4gICAgICAgIHBseXI6IHRoaXNcbiAgICAgIH1cbiAgICB9KTsgLy8gRGlzcGF0Y2ggdGhlIGV2ZW50XG5cbiAgICBlbGVtZW50LmRpc3BhdGNoRXZlbnQoZXZlbnQpO1xuICB9IC8vIFVuYmluZCBhbGwgY2FjaGVkIGV2ZW50IGxpc3RlbmVyc1xuXG4gIGZ1bmN0aW9uIHVuYmluZExpc3RlbmVycygpIHtcbiAgICBpZiAodGhpcyAmJiB0aGlzLmV2ZW50TGlzdGVuZXJzKSB7XG4gICAgICB0aGlzLmV2ZW50TGlzdGVuZXJzLmZvckVhY2goaXRlbSA9PiB7XG4gICAgICAgIGNvbnN0IHtcbiAgICAgICAgICBlbGVtZW50LFxuICAgICAgICAgIHR5cGUsXG4gICAgICAgICAgY2FsbGJhY2ssXG4gICAgICAgICAgb3B0aW9uc1xuICAgICAgICB9ID0gaXRlbTtcbiAgICAgICAgZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKHR5cGUsIGNhbGxiYWNrLCBvcHRpb25zKTtcbiAgICAgIH0pO1xuICAgICAgdGhpcy5ldmVudExpc3RlbmVycyA9IFtdO1xuICAgIH1cbiAgfSAvLyBSdW4gbWV0aG9kIHdoZW4gLyBpZiBwbGF5ZXIgaXMgcmVhZHlcblxuICBmdW5jdGlvbiByZWFkeSgpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB0aGlzLnJlYWR5ID8gc2V0VGltZW91dChyZXNvbHZlLCAwKSA6IG9uLmNhbGwodGhpcywgdGhpcy5lbGVtZW50cy5jb250YWluZXIsICdyZWFkeScsIHJlc29sdmUpKS50aGVuKCgpID0+IHt9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTaWxlbmNlIGEgUHJvbWlzZS1saWtlIG9iamVjdC5cbiAgICogVGhpcyBpcyB1c2VmdWwgZm9yIGF2b2lkaW5nIG5vbi1oYXJtZnVsLCBidXQgcG90ZW50aWFsbHkgY29uZnVzaW5nIFwidW5jYXVnaHRcbiAgICogcGxheSBwcm9taXNlXCIgcmVqZWN0aW9uIGVycm9yIG1lc3NhZ2VzLlxuICAgKiBAcGFyYW0gIHtPYmplY3R9IHZhbHVlIEFuIG9iamVjdCB0aGF0IG1heSBvciBtYXkgbm90IGJlIGBQcm9taXNlYC1saWtlLlxuICAgKi9cblxuICBmdW5jdGlvbiBzaWxlbmNlUHJvbWlzZSh2YWx1ZSkge1xuICAgIGlmIChpcy5wcm9taXNlKHZhbHVlKSkge1xuICAgICAgdmFsdWUudGhlbihudWxsLCAoKSA9PiB7fSk7XG4gICAgfVxuICB9XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICBmdW5jdGlvbiBkZWR1cGUoYXJyYXkpIHtcbiAgICBpZiAoIWlzLmFycmF5KGFycmF5KSkge1xuICAgICAgcmV0dXJuIGFycmF5O1xuICAgIH1cblxuICAgIHJldHVybiBhcnJheS5maWx0ZXIoKGl0ZW0sIGluZGV4KSA9PiBhcnJheS5pbmRleE9mKGl0ZW0pID09PSBpbmRleCk7XG4gIH0gLy8gR2V0IHRoZSBjbG9zZXN0IHZhbHVlIGluIGFuIGFycmF5XG5cbiAgZnVuY3Rpb24gY2xvc2VzdChhcnJheSwgdmFsdWUpIHtcbiAgICBpZiAoIWlzLmFycmF5KGFycmF5KSB8fCAhYXJyYXkubGVuZ3RoKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICByZXR1cm4gYXJyYXkucmVkdWNlKChwcmV2LCBjdXJyKSA9PiBNYXRoLmFicyhjdXJyIC0gdmFsdWUpIDwgTWF0aC5hYnMocHJldiAtIHZhbHVlKSA/IGN1cnIgOiBwcmV2KTtcbiAgfVxuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiAgZnVuY3Rpb24gc3VwcG9ydHNDU1MoZGVjbGFyYXRpb24pIHtcbiAgICBpZiAoIXdpbmRvdyB8fCAhd2luZG93LkNTUykge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHJldHVybiB3aW5kb3cuQ1NTLnN1cHBvcnRzKGRlY2xhcmF0aW9uKTtcbiAgfSAvLyBTdGFuZGFyZC9jb21tb24gYXNwZWN0IHJhdGlvc1xuXG4gIGNvbnN0IHN0YW5kYXJkUmF0aW9zID0gW1sxLCAxXSwgWzQsIDNdLCBbMywgNF0sIFs1LCA0XSwgWzQsIDVdLCBbMywgMl0sIFsyLCAzXSwgWzE2LCAxMF0sIFsxMCwgMTZdLCBbMTYsIDldLCBbOSwgMTZdLCBbMjEsIDldLCBbOSwgMjFdLCBbMzIsIDldLCBbOSwgMzJdXS5yZWR1Y2UoKG91dCwgW3gsIHldKSA9PiAoeyAuLi5vdXQsXG4gICAgW3ggLyB5XTogW3gsIHldXG4gIH0pLCB7fSk7IC8vIFZhbGlkYXRlIGFuIGFzcGVjdCByYXRpb1xuXG4gIGZ1bmN0aW9uIHZhbGlkYXRlQXNwZWN0UmF0aW8oaW5wdXQpIHtcbiAgICBpZiAoIWlzLmFycmF5KGlucHV0KSAmJiAoIWlzLnN0cmluZyhpbnB1dCkgfHwgIWlucHV0LmluY2x1ZGVzKCc6JykpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgY29uc3QgcmF0aW8gPSBpcy5hcnJheShpbnB1dCkgPyBpbnB1dCA6IGlucHV0LnNwbGl0KCc6Jyk7XG4gICAgcmV0dXJuIHJhdGlvLm1hcChOdW1iZXIpLmV2ZXJ5KGlzLm51bWJlcik7XG4gIH0gLy8gUmVkdWNlIGFuIGFzcGVjdCByYXRpbyB0byBpdCdzIGxvd2VzdCBmb3JtXG5cbiAgZnVuY3Rpb24gcmVkdWNlQXNwZWN0UmF0aW8ocmF0aW8pIHtcbiAgICBpZiAoIWlzLmFycmF5KHJhdGlvKSB8fCAhcmF0aW8uZXZlcnkoaXMubnVtYmVyKSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgY29uc3QgW3dpZHRoLCBoZWlnaHRdID0gcmF0aW87XG5cbiAgICBjb25zdCBnZXREaXZpZGVyID0gKHcsIGgpID0+IGggPT09IDAgPyB3IDogZ2V0RGl2aWRlcihoLCB3ICUgaCk7XG5cbiAgICBjb25zdCBkaXZpZGVyID0gZ2V0RGl2aWRlcih3aWR0aCwgaGVpZ2h0KTtcbiAgICByZXR1cm4gW3dpZHRoIC8gZGl2aWRlciwgaGVpZ2h0IC8gZGl2aWRlcl07XG4gIH0gLy8gQ2FsY3VsYXRlIGFuIGFzcGVjdCByYXRpb1xuXG4gIGZ1bmN0aW9uIGdldEFzcGVjdFJhdGlvKGlucHV0KSB7XG4gICAgY29uc3QgcGFyc2UgPSByYXRpbyA9PiB2YWxpZGF0ZUFzcGVjdFJhdGlvKHJhdGlvKSA/IHJhdGlvLnNwbGl0KCc6JykubWFwKE51bWJlcikgOiBudWxsOyAvLyBUcnkgcHJvdmlkZWQgcmF0aW9cblxuXG4gICAgbGV0IHJhdGlvID0gcGFyc2UoaW5wdXQpOyAvLyBHZXQgZnJvbSBjb25maWdcblxuICAgIGlmIChyYXRpbyA9PT0gbnVsbCkge1xuICAgICAgcmF0aW8gPSBwYXJzZSh0aGlzLmNvbmZpZy5yYXRpbyk7XG4gICAgfSAvLyBHZXQgZnJvbSBlbWJlZFxuXG5cbiAgICBpZiAocmF0aW8gPT09IG51bGwgJiYgIWlzLmVtcHR5KHRoaXMuZW1iZWQpICYmIGlzLmFycmF5KHRoaXMuZW1iZWQucmF0aW8pKSB7XG4gICAgICAoe1xuICAgICAgICByYXRpb1xuICAgICAgfSA9IHRoaXMuZW1iZWQpO1xuICAgIH0gLy8gR2V0IGZyb20gSFRNTDUgdmlkZW9cblxuXG4gICAgaWYgKHJhdGlvID09PSBudWxsICYmIHRoaXMuaXNIVE1MNSkge1xuICAgICAgY29uc3Qge1xuICAgICAgICB2aWRlb1dpZHRoLFxuICAgICAgICB2aWRlb0hlaWdodFxuICAgICAgfSA9IHRoaXMubWVkaWE7XG4gICAgICByYXRpbyA9IFt2aWRlb1dpZHRoLCB2aWRlb0hlaWdodF07XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlZHVjZUFzcGVjdFJhdGlvKHJhdGlvKTtcbiAgfSAvLyBTZXQgYXNwZWN0IHJhdGlvIGZvciByZXNwb25zaXZlIGNvbnRhaW5lclxuXG4gIGZ1bmN0aW9uIHNldEFzcGVjdFJhdGlvKGlucHV0KSB7XG4gICAgaWYgKCF0aGlzLmlzVmlkZW8pIHtcbiAgICAgIHJldHVybiB7fTtcbiAgICB9XG5cbiAgICBjb25zdCB7XG4gICAgICB3cmFwcGVyXG4gICAgfSA9IHRoaXMuZWxlbWVudHM7XG4gICAgY29uc3QgcmF0aW8gPSBnZXRBc3BlY3RSYXRpby5jYWxsKHRoaXMsIGlucHV0KTtcblxuICAgIGlmICghaXMuYXJyYXkocmF0aW8pKSB7XG4gICAgICByZXR1cm4ge307XG4gICAgfVxuXG4gICAgY29uc3QgW3gsIHldID0gcmVkdWNlQXNwZWN0UmF0aW8ocmF0aW8pO1xuICAgIGNvbnN0IHVzZU5hdGl2ZSA9IHN1cHBvcnRzQ1NTKGBhc3BlY3QtcmF0aW86ICR7eH0vJHt5fWApO1xuICAgIGNvbnN0IHBhZGRpbmcgPSAxMDAgLyB4ICogeTtcblxuICAgIGlmICh1c2VOYXRpdmUpIHtcbiAgICAgIHdyYXBwZXIuc3R5bGUuYXNwZWN0UmF0aW8gPSBgJHt4fS8ke3l9YDtcbiAgICB9IGVsc2Uge1xuICAgICAgd3JhcHBlci5zdHlsZS5wYWRkaW5nQm90dG9tID0gYCR7cGFkZGluZ30lYDtcbiAgICB9IC8vIEZvciBWaW1lbyB3ZSBoYXZlIGFuIGV4dHJhIDxkaXY+IHRvIGhpZGUgdGhlIHN0YW5kYXJkIGNvbnRyb2xzIGFuZCBVSVxuXG5cbiAgICBpZiAodGhpcy5pc1ZpbWVvICYmICF0aGlzLmNvbmZpZy52aW1lby5wcmVtaXVtICYmIHRoaXMuc3VwcG9ydGVkLnVpKSB7XG4gICAgICBjb25zdCBoZWlnaHQgPSAxMDAgLyB0aGlzLm1lZGlhLm9mZnNldFdpZHRoICogcGFyc2VJbnQod2luZG93LmdldENvbXB1dGVkU3R5bGUodGhpcy5tZWRpYSkucGFkZGluZ0JvdHRvbSwgMTApO1xuICAgICAgY29uc3Qgb2Zmc2V0ID0gKGhlaWdodCAtIHBhZGRpbmcpIC8gKGhlaWdodCAvIDUwKTtcblxuICAgICAgaWYgKHRoaXMuZnVsbHNjcmVlbi5hY3RpdmUpIHtcbiAgICAgICAgd3JhcHBlci5zdHlsZS5wYWRkaW5nQm90dG9tID0gbnVsbDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMubWVkaWEuc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZVkoLSR7b2Zmc2V0fSUpYDtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHRoaXMuaXNIVE1MNSkge1xuICAgICAgd3JhcHBlci5jbGFzc0xpc3QuYWRkKHRoaXMuY29uZmlnLmNsYXNzTmFtZXMudmlkZW9GaXhlZFJhdGlvKTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgcGFkZGluZyxcbiAgICAgIHJhdGlvXG4gICAgfTtcbiAgfSAvLyBSb3VuZCBhbiBhc3BlY3QgcmF0aW8gdG8gY2xvc2VzdCBzdGFuZGFyZCByYXRpb1xuXG4gIGZ1bmN0aW9uIHJvdW5kQXNwZWN0UmF0aW8oeCwgeSwgdG9sZXJhbmNlID0gMC4wNSkge1xuICAgIGNvbnN0IHJhdGlvID0geCAvIHk7XG4gICAgY29uc3QgY2xvc2VzdFJhdGlvID0gY2xvc2VzdChPYmplY3Qua2V5cyhzdGFuZGFyZFJhdGlvcyksIHJhdGlvKTsgLy8gQ2hlY2sgbWF0Y2ggaXMgd2l0aGluIHRvbGVyYW5jZVxuXG4gICAgaWYgKE1hdGguYWJzKGNsb3Nlc3RSYXRpbyAtIHJhdGlvKSA8PSB0b2xlcmFuY2UpIHtcbiAgICAgIHJldHVybiBzdGFuZGFyZFJhdGlvc1tjbG9zZXN0UmF0aW9dO1xuICAgIH0gLy8gTm8gbWF0Y2hcblxuXG4gICAgcmV0dXJuIFt4LCB5XTtcbiAgfSAvLyBHZXQgdGhlIHNpemUgb2YgdGhlIHZpZXdwb3J0XG4gIC8vIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzEyNDgwODEvaG93LXRvLWdldC10aGUtYnJvd3Nlci12aWV3cG9ydC1kaW1lbnNpb25zXG5cbiAgZnVuY3Rpb24gZ2V0Vmlld3BvcnRTaXplKCkge1xuICAgIGNvbnN0IHdpZHRoID0gTWF0aC5tYXgoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoIHx8IDAsIHdpbmRvdy5pbm5lcldpZHRoIHx8IDApO1xuICAgIGNvbnN0IGhlaWdodCA9IE1hdGgubWF4KGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQgfHwgMCwgd2luZG93LmlubmVySGVpZ2h0IHx8IDApO1xuICAgIHJldHVybiBbd2lkdGgsIGhlaWdodF07XG4gIH1cblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICBjb25zdCBodG1sNSA9IHtcbiAgICBnZXRTb3VyY2VzKCkge1xuICAgICAgaWYgKCF0aGlzLmlzSFRNTDUpIHtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBzb3VyY2VzID0gQXJyYXkuZnJvbSh0aGlzLm1lZGlhLnF1ZXJ5U2VsZWN0b3JBbGwoJ3NvdXJjZScpKTsgLy8gRmlsdGVyIG91dCB1bnN1cHBvcnRlZCBzb3VyY2VzIChpZiB0eXBlIGlzIHNwZWNpZmllZClcblxuICAgICAgcmV0dXJuIHNvdXJjZXMuZmlsdGVyKHNvdXJjZSA9PiB7XG4gICAgICAgIGNvbnN0IHR5cGUgPSBzb3VyY2UuZ2V0QXR0cmlidXRlKCd0eXBlJyk7XG5cbiAgICAgICAgaWYgKGlzLmVtcHR5KHR5cGUpKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gc3VwcG9ydC5taW1lLmNhbGwodGhpcywgdHlwZSk7XG4gICAgICB9KTtcbiAgICB9LFxuXG4gICAgLy8gR2V0IHF1YWxpdHkgbGV2ZWxzXG4gICAgZ2V0UXVhbGl0eU9wdGlvbnMoKSB7XG4gICAgICAvLyBXaGV0aGVyIHdlJ3JlIGZvcmNpbmcgYWxsIG9wdGlvbnMgKGUuZy4gZm9yIHN0cmVhbWluZylcbiAgICAgIGlmICh0aGlzLmNvbmZpZy5xdWFsaXR5LmZvcmNlZCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jb25maWcucXVhbGl0eS5vcHRpb25zO1xuICAgICAgfSAvLyBHZXQgc2l6ZXMgZnJvbSA8c291cmNlPiBlbGVtZW50c1xuXG5cbiAgICAgIHJldHVybiBodG1sNS5nZXRTb3VyY2VzLmNhbGwodGhpcykubWFwKHNvdXJjZSA9PiBOdW1iZXIoc291cmNlLmdldEF0dHJpYnV0ZSgnc2l6ZScpKSkuZmlsdGVyKEJvb2xlYW4pO1xuICAgIH0sXG5cbiAgICBzZXR1cCgpIHtcbiAgICAgIGlmICghdGhpcy5pc0hUTUw1KSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgY29uc3QgcGxheWVyID0gdGhpczsgLy8gU2V0IHNwZWVkIG9wdGlvbnMgZnJvbSBjb25maWdcblxuICAgICAgcGxheWVyLm9wdGlvbnMuc3BlZWQgPSBwbGF5ZXIuY29uZmlnLnNwZWVkLm9wdGlvbnM7IC8vIFNldCBhc3BlY3QgcmF0aW8gaWYgZml4ZWRcblxuICAgICAgaWYgKCFpcy5lbXB0eSh0aGlzLmNvbmZpZy5yYXRpbykpIHtcbiAgICAgICAgc2V0QXNwZWN0UmF0aW8uY2FsbChwbGF5ZXIpO1xuICAgICAgfSAvLyBRdWFsaXR5XG5cblxuICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHBsYXllci5tZWRpYSwgJ3F1YWxpdHknLCB7XG4gICAgICAgIGdldCgpIHtcbiAgICAgICAgICAvLyBHZXQgc291cmNlc1xuICAgICAgICAgIGNvbnN0IHNvdXJjZXMgPSBodG1sNS5nZXRTb3VyY2VzLmNhbGwocGxheWVyKTtcbiAgICAgICAgICBjb25zdCBzb3VyY2UgPSBzb3VyY2VzLmZpbmQocyA9PiBzLmdldEF0dHJpYnV0ZSgnc3JjJykgPT09IHBsYXllci5zb3VyY2UpOyAvLyBSZXR1cm4gc2l6ZSwgaWYgbWF0Y2ggaXMgZm91bmRcblxuICAgICAgICAgIHJldHVybiBzb3VyY2UgJiYgTnVtYmVyKHNvdXJjZS5nZXRBdHRyaWJ1dGUoJ3NpemUnKSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0KGlucHV0KSB7XG4gICAgICAgICAgaWYgKHBsYXllci5xdWFsaXR5ID09PSBpbnB1dCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH0gLy8gSWYgd2UncmUgdXNpbmcgYW4gZXh0ZXJuYWwgaGFuZGxlci4uLlxuXG5cbiAgICAgICAgICBpZiAocGxheWVyLmNvbmZpZy5xdWFsaXR5LmZvcmNlZCAmJiBpcy5mdW5jdGlvbihwbGF5ZXIuY29uZmlnLnF1YWxpdHkub25DaGFuZ2UpKSB7XG4gICAgICAgICAgICBwbGF5ZXIuY29uZmlnLnF1YWxpdHkub25DaGFuZ2UoaW5wdXQpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBHZXQgc291cmNlc1xuICAgICAgICAgICAgY29uc3Qgc291cmNlcyA9IGh0bWw1LmdldFNvdXJjZXMuY2FsbChwbGF5ZXIpOyAvLyBHZXQgZmlyc3QgbWF0Y2ggZm9yIHJlcXVlc3RlZCBzaXplXG5cbiAgICAgICAgICAgIGNvbnN0IHNvdXJjZSA9IHNvdXJjZXMuZmluZChzID0+IE51bWJlcihzLmdldEF0dHJpYnV0ZSgnc2l6ZScpKSA9PT0gaW5wdXQpOyAvLyBObyBtYXRjaGluZyBzb3VyY2UgZm91bmRcblxuICAgICAgICAgICAgaWYgKCFzb3VyY2UpIHtcbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfSAvLyBHZXQgY3VycmVudCBzdGF0ZVxuXG5cbiAgICAgICAgICAgIGNvbnN0IHtcbiAgICAgICAgICAgICAgY3VycmVudFRpbWUsXG4gICAgICAgICAgICAgIHBhdXNlZCxcbiAgICAgICAgICAgICAgcHJlbG9hZCxcbiAgICAgICAgICAgICAgcmVhZHlTdGF0ZSxcbiAgICAgICAgICAgICAgcGxheWJhY2tSYXRlXG4gICAgICAgICAgICB9ID0gcGxheWVyLm1lZGlhOyAvLyBTZXQgbmV3IHNvdXJjZVxuXG4gICAgICAgICAgICBwbGF5ZXIubWVkaWEuc3JjID0gc291cmNlLmdldEF0dHJpYnV0ZSgnc3JjJyk7IC8vIFByZXZlbnQgbG9hZGluZyBpZiBwcmVsb2FkPVwibm9uZVwiIGFuZCB0aGUgY3VycmVudCBzb3VyY2UgaXNuJ3QgbG9hZGVkICgjMTA0NClcblxuICAgICAgICAgICAgaWYgKHByZWxvYWQgIT09ICdub25lJyB8fCByZWFkeVN0YXRlKSB7XG4gICAgICAgICAgICAgIC8vIFJlc3RvcmUgdGltZVxuICAgICAgICAgICAgICBwbGF5ZXIub25jZSgnbG9hZGVkbWV0YWRhdGEnLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgcGxheWVyLnNwZWVkID0gcGxheWJhY2tSYXRlO1xuICAgICAgICAgICAgICAgIHBsYXllci5jdXJyZW50VGltZSA9IGN1cnJlbnRUaW1lOyAvLyBSZXN1bWUgcGxheWluZ1xuXG4gICAgICAgICAgICAgICAgaWYgKCFwYXVzZWQpIHtcbiAgICAgICAgICAgICAgICAgIHNpbGVuY2VQcm9taXNlKHBsYXllci5wbGF5KCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSk7IC8vIExvYWQgbmV3IHNvdXJjZVxuXG4gICAgICAgICAgICAgIHBsYXllci5tZWRpYS5sb2FkKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSAvLyBUcmlnZ2VyIGNoYW5nZSBldmVudFxuXG5cbiAgICAgICAgICB0cmlnZ2VyRXZlbnQuY2FsbChwbGF5ZXIsIHBsYXllci5tZWRpYSwgJ3F1YWxpdHljaGFuZ2UnLCBmYWxzZSwge1xuICAgICAgICAgICAgcXVhbGl0eTogaW5wdXRcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICB9KTtcbiAgICB9LFxuXG4gICAgLy8gQ2FuY2VsIGN1cnJlbnQgbmV0d29yayByZXF1ZXN0c1xuICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vc2FtcG90dHMvcGx5ci9pc3N1ZXMvMTc0XG4gICAgY2FuY2VsUmVxdWVzdHMoKSB7XG4gICAgICBpZiAoIXRoaXMuaXNIVE1MNSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9IC8vIFJlbW92ZSBjaGlsZCBzb3VyY2VzXG5cblxuICAgICAgcmVtb3ZlRWxlbWVudChodG1sNS5nZXRTb3VyY2VzLmNhbGwodGhpcykpOyAvLyBTZXQgYmxhbmsgdmlkZW8gc3JjIGF0dHJpYnV0ZVxuICAgICAgLy8gVGhpcyBpcyB0byBwcmV2ZW50IGEgTUVESUFfRVJSX1NSQ19OT1RfU1VQUE9SVEVEIGVycm9yXG4gICAgICAvLyBJbmZvOiBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzMyMjMxNTc5L2hvdy10by1wcm9wZXJseS1kaXNwb3NlLW9mLWFuLWh0bWw1LXZpZGVvLWFuZC1jbG9zZS1zb2NrZXQtb3ItY29ubmVjdGlvblxuXG4gICAgICB0aGlzLm1lZGlhLnNldEF0dHJpYnV0ZSgnc3JjJywgdGhpcy5jb25maWcuYmxhbmtWaWRlbyk7IC8vIExvYWQgdGhlIG5ldyBlbXB0eSBzb3VyY2VcbiAgICAgIC8vIFRoaXMgd2lsbCBjYW5jZWwgZXhpc3RpbmcgcmVxdWVzdHNcbiAgICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vc2FtcG90dHMvcGx5ci9pc3N1ZXMvMTc0XG5cbiAgICAgIHRoaXMubWVkaWEubG9hZCgpOyAvLyBEZWJ1Z2dpbmdcblxuICAgICAgdGhpcy5kZWJ1Zy5sb2coJ0NhbmNlbGxlZCBuZXR3b3JrIHJlcXVlc3RzJyk7XG4gICAgfVxuXG4gIH07XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICBmdW5jdGlvbiBnZW5lcmF0ZUlkKHByZWZpeCkge1xuICAgIHJldHVybiBgJHtwcmVmaXh9LSR7TWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwMDApfWA7XG4gIH0gLy8gRm9ybWF0IHN0cmluZ1xuXG4gIGZ1bmN0aW9uIGZvcm1hdChpbnB1dCwgLi4uYXJncykge1xuICAgIGlmIChpcy5lbXB0eShpbnB1dCkpIHJldHVybiBpbnB1dDtcbiAgICByZXR1cm4gaW5wdXQudG9TdHJpbmcoKS5yZXBsYWNlKC97KFxcZCspfS9nLCAobWF0Y2gsIGkpID0+IGFyZ3NbaV0udG9TdHJpbmcoKSk7XG4gIH0gLy8gR2V0IHBlcmNlbnRhZ2VcblxuICBmdW5jdGlvbiBnZXRQZXJjZW50YWdlKGN1cnJlbnQsIG1heCkge1xuICAgIGlmIChjdXJyZW50ID09PSAwIHx8IG1heCA9PT0gMCB8fCBOdW1iZXIuaXNOYU4oY3VycmVudCkgfHwgTnVtYmVyLmlzTmFOKG1heCkpIHtcbiAgICAgIHJldHVybiAwO1xuICAgIH1cblxuICAgIHJldHVybiAoY3VycmVudCAvIG1heCAqIDEwMCkudG9GaXhlZCgyKTtcbiAgfSAvLyBSZXBsYWNlIGFsbCBvY2N1cnJlbmNlcyBvZiBhIHN0cmluZyBpbiBhIHN0cmluZ1xuXG4gIGNvbnN0IHJlcGxhY2VBbGwgPSAoaW5wdXQgPSAnJywgZmluZCA9ICcnLCByZXBsYWNlID0gJycpID0+IGlucHV0LnJlcGxhY2UobmV3IFJlZ0V4cChmaW5kLnRvU3RyaW5nKCkucmVwbGFjZSgvKFsuKis/Xj0hOiR7fSgpfFtcXF0vXFxcXF0pL2csICdcXFxcJDEnKSwgJ2cnKSwgcmVwbGFjZS50b1N0cmluZygpKTsgLy8gQ29udmVydCB0byB0aXRsZSBjYXNlXG5cbiAgY29uc3QgdG9UaXRsZUNhc2UgPSAoaW5wdXQgPSAnJykgPT4gaW5wdXQudG9TdHJpbmcoKS5yZXBsYWNlKC9cXHdcXFMqL2csIHRleHQgPT4gdGV4dC5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHRleHQuc2xpY2UoMSkudG9Mb3dlckNhc2UoKSk7IC8vIENvbnZlcnQgc3RyaW5nIHRvIHBhc2NhbENhc2VcblxuICBmdW5jdGlvbiB0b1Bhc2NhbENhc2UoaW5wdXQgPSAnJykge1xuICAgIGxldCBzdHJpbmcgPSBpbnB1dC50b1N0cmluZygpOyAvLyBDb252ZXJ0IGtlYmFiIGNhc2VcblxuICAgIHN0cmluZyA9IHJlcGxhY2VBbGwoc3RyaW5nLCAnLScsICcgJyk7IC8vIENvbnZlcnQgc25ha2UgY2FzZVxuXG4gICAgc3RyaW5nID0gcmVwbGFjZUFsbChzdHJpbmcsICdfJywgJyAnKTsgLy8gQ29udmVydCB0byB0aXRsZSBjYXNlXG5cbiAgICBzdHJpbmcgPSB0b1RpdGxlQ2FzZShzdHJpbmcpOyAvLyBDb252ZXJ0IHRvIHBhc2NhbCBjYXNlXG5cbiAgICByZXR1cm4gcmVwbGFjZUFsbChzdHJpbmcsICcgJywgJycpO1xuICB9IC8vIENvbnZlcnQgc3RyaW5nIHRvIHBhc2NhbENhc2VcblxuICBmdW5jdGlvbiB0b0NhbWVsQ2FzZShpbnB1dCA9ICcnKSB7XG4gICAgbGV0IHN0cmluZyA9IGlucHV0LnRvU3RyaW5nKCk7IC8vIENvbnZlcnQgdG8gcGFzY2FsIGNhc2VcblxuICAgIHN0cmluZyA9IHRvUGFzY2FsQ2FzZShzdHJpbmcpOyAvLyBDb252ZXJ0IGZpcnN0IGNoYXJhY3RlciB0byBsb3dlcmNhc2VcblxuICAgIHJldHVybiBzdHJpbmcuY2hhckF0KDApLnRvTG93ZXJDYXNlKCkgKyBzdHJpbmcuc2xpY2UoMSk7XG4gIH0gLy8gUmVtb3ZlIEhUTUwgZnJvbSBhIHN0cmluZ1xuXG4gIGZ1bmN0aW9uIHN0cmlwSFRNTChzb3VyY2UpIHtcbiAgICBjb25zdCBmcmFnbWVudCA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcbiAgICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQoZWxlbWVudCk7XG4gICAgZWxlbWVudC5pbm5lckhUTUwgPSBzb3VyY2U7XG4gICAgcmV0dXJuIGZyYWdtZW50LmZpcnN0Q2hpbGQuaW5uZXJUZXh0O1xuICB9IC8vIExpa2Ugb3V0ZXJIVE1MLCBidXQgYWxzbyB3b3JrcyBmb3IgRG9jdW1lbnRGcmFnbWVudFxuXG4gIGZ1bmN0aW9uIGdldEhUTUwoZWxlbWVudCkge1xuICAgIGNvbnN0IHdyYXBwZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICB3cmFwcGVyLmFwcGVuZENoaWxkKGVsZW1lbnQpO1xuICAgIHJldHVybiB3cmFwcGVyLmlubmVySFRNTDtcbiAgfVxuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiAgY29uc3QgcmVzb3VyY2VzID0ge1xuICAgIHBpcDogJ1BJUCcsXG4gICAgYWlycGxheTogJ0FpclBsYXknLFxuICAgIGh0bWw1OiAnSFRNTDUnLFxuICAgIHZpbWVvOiAnVmltZW8nLFxuICAgIHlvdXR1YmU6ICdZb3VUdWJlJ1xuICB9O1xuICBjb25zdCBpMThuID0ge1xuICAgIGdldChrZXkgPSAnJywgY29uZmlnID0ge30pIHtcbiAgICAgIGlmIChpcy5lbXB0eShrZXkpIHx8IGlzLmVtcHR5KGNvbmZpZykpIHtcbiAgICAgICAgcmV0dXJuICcnO1xuICAgICAgfVxuXG4gICAgICBsZXQgc3RyaW5nID0gZ2V0RGVlcChjb25maWcuaTE4biwga2V5KTtcblxuICAgICAgaWYgKGlzLmVtcHR5KHN0cmluZykpIHtcbiAgICAgICAgaWYgKE9iamVjdC5rZXlzKHJlc291cmNlcykuaW5jbHVkZXMoa2V5KSkge1xuICAgICAgICAgIHJldHVybiByZXNvdXJjZXNba2V5XTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiAnJztcbiAgICAgIH1cblxuICAgICAgY29uc3QgcmVwbGFjZSA9IHtcbiAgICAgICAgJ3tzZWVrdGltZX0nOiBjb25maWcuc2Vla1RpbWUsXG4gICAgICAgICd7dGl0bGV9JzogY29uZmlnLnRpdGxlXG4gICAgICB9O1xuICAgICAgT2JqZWN0LmVudHJpZXMocmVwbGFjZSkuZm9yRWFjaCgoW2ssIHZdKSA9PiB7XG4gICAgICAgIHN0cmluZyA9IHJlcGxhY2VBbGwoc3RyaW5nLCBrLCB2KTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHN0cmluZztcbiAgICB9XG5cbiAgfTtcblxuICBjbGFzcyBTdG9yYWdlIHtcbiAgICBjb25zdHJ1Y3RvcihwbGF5ZXIpIHtcbiAgICAgIF9kZWZpbmVQcm9wZXJ0eSQxKHRoaXMsIFwiZ2V0XCIsIGtleSA9PiB7XG4gICAgICAgIGlmICghU3RvcmFnZS5zdXBwb3J0ZWQgfHwgIXRoaXMuZW5hYmxlZCkge1xuICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgc3RvcmUgPSB3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0odGhpcy5rZXkpO1xuXG4gICAgICAgIGlmIChpcy5lbXB0eShzdG9yZSkpIHtcbiAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGpzb24gPSBKU09OLnBhcnNlKHN0b3JlKTtcbiAgICAgICAgcmV0dXJuIGlzLnN0cmluZyhrZXkpICYmIGtleS5sZW5ndGggPyBqc29uW2tleV0gOiBqc29uO1xuICAgICAgfSk7XG5cbiAgICAgIF9kZWZpbmVQcm9wZXJ0eSQxKHRoaXMsIFwic2V0XCIsIG9iamVjdCA9PiB7XG4gICAgICAgIC8vIEJhaWwgaWYgd2UgZG9uJ3QgaGF2ZSBsb2NhbFN0b3JhZ2Ugc3VwcG9ydCBvciBpdCdzIGRpc2FibGVkXG4gICAgICAgIGlmICghU3RvcmFnZS5zdXBwb3J0ZWQgfHwgIXRoaXMuZW5hYmxlZCkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfSAvLyBDYW4gb25seSBzdG9yZSBvYmplY3RzdFxuXG5cbiAgICAgICAgaWYgKCFpcy5vYmplY3Qob2JqZWN0KSkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfSAvLyBHZXQgY3VycmVudCBzdG9yYWdlXG5cblxuICAgICAgICBsZXQgc3RvcmFnZSA9IHRoaXMuZ2V0KCk7IC8vIERlZmF1bHQgdG8gZW1wdHkgb2JqZWN0XG5cbiAgICAgICAgaWYgKGlzLmVtcHR5KHN0b3JhZ2UpKSB7XG4gICAgICAgICAgc3RvcmFnZSA9IHt9O1xuICAgICAgICB9IC8vIFVwZGF0ZSB0aGUgd29ya2luZyBjb3B5IG9mIHRoZSB2YWx1ZXNcblxuXG4gICAgICAgIGV4dGVuZChzdG9yYWdlLCBvYmplY3QpOyAvLyBVcGRhdGUgc3RvcmFnZVxuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKHRoaXMua2V5LCBKU09OLnN0cmluZ2lmeShzdG9yYWdlKSk7XG4gICAgICAgIH0gY2F0Y2ggKF8pIHsvLyBEbyBub3RoaW5nXG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLmVuYWJsZWQgPSBwbGF5ZXIuY29uZmlnLnN0b3JhZ2UuZW5hYmxlZDtcbiAgICAgIHRoaXMua2V5ID0gcGxheWVyLmNvbmZpZy5zdG9yYWdlLmtleTtcbiAgICB9IC8vIENoZWNrIGZvciBhY3R1YWwgc3VwcG9ydCAoc2VlIGlmIHdlIGNhbiB1c2UgaXQpXG5cblxuICAgIHN0YXRpYyBnZXQgc3VwcG9ydGVkKCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgaWYgKCEoJ2xvY2FsU3RvcmFnZScgaW4gd2luZG93KSkge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHRlc3QgPSAnX19fdGVzdCc7IC8vIFRyeSB0byB1c2UgaXQgKGl0IG1pZ2h0IGJlIGRpc2FibGVkLCBlLmcuIHVzZXIgaXMgaW4gcHJpdmF0ZSBtb2RlKVxuICAgICAgICAvLyBzZWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9zYW1wb3R0cy9wbHlyL2lzc3Vlcy8xMzFcblxuICAgICAgICB3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0odGVzdCwgdGVzdCk7XG4gICAgICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSh0ZXN0KTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9IGNhdGNoIChfKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgfVxuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vIEZldGNoIHdyYXBwZXJcbiAgLy8gVXNpbmcgWEhSIHRvIGF2b2lkIGlzc3VlcyB3aXRoIG9sZGVyIGJyb3dzZXJzXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIGZ1bmN0aW9uIGZldGNoKHVybCwgcmVzcG9uc2VUeXBlID0gJ3RleHQnKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHJlcXVlc3QgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsgLy8gQ2hlY2sgZm9yIENPUlMgc3VwcG9ydFxuXG4gICAgICAgIGlmICghKCd3aXRoQ3JlZGVudGlhbHMnIGluIHJlcXVlc3QpKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgKCkgPT4ge1xuICAgICAgICAgIGlmIChyZXNwb25zZVR5cGUgPT09ICd0ZXh0Jykge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgcmVzb2x2ZShKU09OLnBhcnNlKHJlcXVlc3QucmVzcG9uc2VUZXh0KSk7XG4gICAgICAgICAgICB9IGNhdGNoIChfKSB7XG4gICAgICAgICAgICAgIHJlc29sdmUocmVxdWVzdC5yZXNwb25zZVRleHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXNvbHZlKHJlcXVlc3QucmVzcG9uc2UpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcignZXJyb3InLCAoKSA9PiB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKHJlcXVlc3Quc3RhdHVzKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJlcXVlc3Qub3BlbignR0VUJywgdXJsLCB0cnVlKTsgLy8gU2V0IHRoZSByZXF1aXJlZCByZXNwb25zZSB0eXBlXG5cbiAgICAgICAgcmVxdWVzdC5yZXNwb25zZVR5cGUgPSByZXNwb25zZVR5cGU7XG4gICAgICAgIHJlcXVlc3Quc2VuZCgpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgcmVqZWN0KGVycm9yKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiAgZnVuY3Rpb24gbG9hZFNwcml0ZSh1cmwsIGlkKSB7XG4gICAgaWYgKCFpcy5zdHJpbmcodXJsKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IHByZWZpeCA9ICdjYWNoZSc7XG4gICAgY29uc3QgaGFzSWQgPSBpcy5zdHJpbmcoaWQpO1xuICAgIGxldCBpc0NhY2hlZCA9IGZhbHNlO1xuXG4gICAgY29uc3QgZXhpc3RzID0gKCkgPT4gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpICE9PSBudWxsO1xuXG4gICAgY29uc3QgdXBkYXRlID0gKGNvbnRhaW5lciwgZGF0YSkgPT4ge1xuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXBhcmFtLXJlYXNzaWduXG4gICAgICBjb250YWluZXIuaW5uZXJIVE1MID0gZGF0YTsgLy8gQ2hlY2sgYWdhaW4gaW5jYXNlIG9mIHJhY2UgY29uZGl0aW9uXG5cbiAgICAgIGlmIChoYXNJZCAmJiBleGlzdHMoKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9IC8vIEluamVjdCB0aGUgU1ZHIHRvIHRoZSBib2R5XG5cblxuICAgICAgZG9jdW1lbnQuYm9keS5pbnNlcnRBZGphY2VudEVsZW1lbnQoJ2FmdGVyYmVnaW4nLCBjb250YWluZXIpO1xuICAgIH07IC8vIE9ubHkgbG9hZCBvbmNlIGlmIElEIHNldFxuXG5cbiAgICBpZiAoIWhhc0lkIHx8ICFleGlzdHMoKSkge1xuICAgICAgY29uc3QgdXNlU3RvcmFnZSA9IFN0b3JhZ2Uuc3VwcG9ydGVkOyAvLyBDcmVhdGUgY29udGFpbmVyXG5cbiAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgY29udGFpbmVyLnNldEF0dHJpYnV0ZSgnaGlkZGVuJywgJycpO1xuXG4gICAgICBpZiAoaGFzSWQpIHtcbiAgICAgICAgY29udGFpbmVyLnNldEF0dHJpYnV0ZSgnaWQnLCBpZCk7XG4gICAgICB9IC8vIENoZWNrIGluIGNhY2hlXG5cblxuICAgICAgaWYgKHVzZVN0b3JhZ2UpIHtcbiAgICAgICAgY29uc3QgY2FjaGVkID0gd2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKGAke3ByZWZpeH0tJHtpZH1gKTtcbiAgICAgICAgaXNDYWNoZWQgPSBjYWNoZWQgIT09IG51bGw7XG5cbiAgICAgICAgaWYgKGlzQ2FjaGVkKSB7XG4gICAgICAgICAgY29uc3QgZGF0YSA9IEpTT04ucGFyc2UoY2FjaGVkKTtcbiAgICAgICAgICB1cGRhdGUoY29udGFpbmVyLCBkYXRhLmNvbnRlbnQpO1xuICAgICAgICB9XG4gICAgICB9IC8vIEdldCB0aGUgc3ByaXRlXG5cblxuICAgICAgZmV0Y2godXJsKS50aGVuKHJlc3VsdCA9PiB7XG4gICAgICAgIGlmIChpcy5lbXB0eShyZXN1bHQpKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHVzZVN0b3JhZ2UpIHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKGAke3ByZWZpeH0tJHtpZH1gLCBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgIGNvbnRlbnQ6IHJlc3VsdFxuICAgICAgICAgICAgfSkpO1xuICAgICAgICAgIH0gY2F0Y2ggKF8pIHsvLyBEbyBub3RoaW5nXG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdXBkYXRlKGNvbnRhaW5lciwgcmVzdWx0KTtcbiAgICAgIH0pLmNhdGNoKCgpID0+IHt9KTtcbiAgICB9XG4gIH1cblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4gIGNvbnN0IGdldEhvdXJzID0gdmFsdWUgPT4gTWF0aC50cnVuYyh2YWx1ZSAvIDYwIC8gNjAgJSA2MCwgMTApO1xuICBjb25zdCBnZXRNaW51dGVzID0gdmFsdWUgPT4gTWF0aC50cnVuYyh2YWx1ZSAvIDYwICUgNjAsIDEwKTtcbiAgY29uc3QgZ2V0U2Vjb25kcyA9IHZhbHVlID0+IE1hdGgudHJ1bmModmFsdWUgJSA2MCwgMTApOyAvLyBGb3JtYXQgdGltZSB0byBVSSBmcmllbmRseSBzdHJpbmdcblxuICBmdW5jdGlvbiBmb3JtYXRUaW1lKHRpbWUgPSAwLCBkaXNwbGF5SG91cnMgPSBmYWxzZSwgaW52ZXJ0ZWQgPSBmYWxzZSkge1xuICAgIC8vIEJhaWwgaWYgdGhlIHZhbHVlIGlzbid0IGEgbnVtYmVyXG4gICAgaWYgKCFpcy5udW1iZXIodGltZSkpIHtcbiAgICAgIHJldHVybiBmb3JtYXRUaW1lKHVuZGVmaW5lZCwgZGlzcGxheUhvdXJzLCBpbnZlcnRlZCk7XG4gICAgfSAvLyBGb3JtYXQgdGltZSBjb21wb25lbnQgdG8gYWRkIGxlYWRpbmcgemVyb1xuXG5cbiAgICBjb25zdCBmb3JtYXQgPSB2YWx1ZSA9PiBgMCR7dmFsdWV9YC5zbGljZSgtMik7IC8vIEJyZWFrZG93biB0byBob3VycywgbWlucywgc2Vjc1xuXG5cbiAgICBsZXQgaG91cnMgPSBnZXRIb3Vycyh0aW1lKTtcbiAgICBjb25zdCBtaW5zID0gZ2V0TWludXRlcyh0aW1lKTtcbiAgICBjb25zdCBzZWNzID0gZ2V0U2Vjb25kcyh0aW1lKTsgLy8gRG8gd2UgbmVlZCB0byBkaXNwbGF5IGhvdXJzP1xuXG4gICAgaWYgKGRpc3BsYXlIb3VycyB8fCBob3VycyA+IDApIHtcbiAgICAgIGhvdXJzID0gYCR7aG91cnN9OmA7XG4gICAgfSBlbHNlIHtcbiAgICAgIGhvdXJzID0gJyc7XG4gICAgfSAvLyBSZW5kZXJcblxuXG4gICAgcmV0dXJuIGAke2ludmVydGVkICYmIHRpbWUgPiAwID8gJy0nIDogJyd9JHtob3Vyc30ke2Zvcm1hdChtaW5zKX06JHtmb3JtYXQoc2Vjcyl9YDtcbiAgfVxuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiAgY29uc3QgY29udHJvbHMgPSB7XG4gICAgLy8gR2V0IGljb24gVVJMXG4gICAgZ2V0SWNvblVybCgpIHtcbiAgICAgIGNvbnN0IHVybCA9IG5ldyBVUkwodGhpcy5jb25maWcuaWNvblVybCwgd2luZG93LmxvY2F0aW9uKTtcbiAgICAgIGNvbnN0IGhvc3QgPSB3aW5kb3cubG9jYXRpb24uaG9zdCA/IHdpbmRvdy5sb2NhdGlvbi5ob3N0IDogd2luZG93LnRvcC5sb2NhdGlvbi5ob3N0O1xuICAgICAgY29uc3QgY29ycyA9IHVybC5ob3N0ICE9PSBob3N0IHx8IGJyb3dzZXIuaXNJRSAmJiAhd2luZG93LnN2ZzRldmVyeWJvZHk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB1cmw6IHRoaXMuY29uZmlnLmljb25VcmwsXG4gICAgICAgIGNvcnNcbiAgICAgIH07XG4gICAgfSxcblxuICAgIC8vIEZpbmQgdGhlIFVJIGNvbnRyb2xzXG4gICAgZmluZEVsZW1lbnRzKCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgdGhpcy5lbGVtZW50cy5jb250cm9scyA9IGdldEVsZW1lbnQuY2FsbCh0aGlzLCB0aGlzLmNvbmZpZy5zZWxlY3RvcnMuY29udHJvbHMud3JhcHBlcik7IC8vIEJ1dHRvbnNcblxuICAgICAgICB0aGlzLmVsZW1lbnRzLmJ1dHRvbnMgPSB7XG4gICAgICAgICAgcGxheTogZ2V0RWxlbWVudHMuY2FsbCh0aGlzLCB0aGlzLmNvbmZpZy5zZWxlY3RvcnMuYnV0dG9ucy5wbGF5KSxcbiAgICAgICAgICBwYXVzZTogZ2V0RWxlbWVudC5jYWxsKHRoaXMsIHRoaXMuY29uZmlnLnNlbGVjdG9ycy5idXR0b25zLnBhdXNlKSxcbiAgICAgICAgICByZXN0YXJ0OiBnZXRFbGVtZW50LmNhbGwodGhpcywgdGhpcy5jb25maWcuc2VsZWN0b3JzLmJ1dHRvbnMucmVzdGFydCksXG4gICAgICAgICAgcmV3aW5kOiBnZXRFbGVtZW50LmNhbGwodGhpcywgdGhpcy5jb25maWcuc2VsZWN0b3JzLmJ1dHRvbnMucmV3aW5kKSxcbiAgICAgICAgICBmYXN0Rm9yd2FyZDogZ2V0RWxlbWVudC5jYWxsKHRoaXMsIHRoaXMuY29uZmlnLnNlbGVjdG9ycy5idXR0b25zLmZhc3RGb3J3YXJkKSxcbiAgICAgICAgICBtdXRlOiBnZXRFbGVtZW50LmNhbGwodGhpcywgdGhpcy5jb25maWcuc2VsZWN0b3JzLmJ1dHRvbnMubXV0ZSksXG4gICAgICAgICAgcGlwOiBnZXRFbGVtZW50LmNhbGwodGhpcywgdGhpcy5jb25maWcuc2VsZWN0b3JzLmJ1dHRvbnMucGlwKSxcbiAgICAgICAgICBhaXJwbGF5OiBnZXRFbGVtZW50LmNhbGwodGhpcywgdGhpcy5jb25maWcuc2VsZWN0b3JzLmJ1dHRvbnMuYWlycGxheSksXG4gICAgICAgICAgc2V0dGluZ3M6IGdldEVsZW1lbnQuY2FsbCh0aGlzLCB0aGlzLmNvbmZpZy5zZWxlY3RvcnMuYnV0dG9ucy5zZXR0aW5ncyksXG4gICAgICAgICAgY2FwdGlvbnM6IGdldEVsZW1lbnQuY2FsbCh0aGlzLCB0aGlzLmNvbmZpZy5zZWxlY3RvcnMuYnV0dG9ucy5jYXB0aW9ucyksXG4gICAgICAgICAgZnVsbHNjcmVlbjogZ2V0RWxlbWVudC5jYWxsKHRoaXMsIHRoaXMuY29uZmlnLnNlbGVjdG9ycy5idXR0b25zLmZ1bGxzY3JlZW4pXG4gICAgICAgIH07IC8vIFByb2dyZXNzXG5cbiAgICAgICAgdGhpcy5lbGVtZW50cy5wcm9ncmVzcyA9IGdldEVsZW1lbnQuY2FsbCh0aGlzLCB0aGlzLmNvbmZpZy5zZWxlY3RvcnMucHJvZ3Jlc3MpOyAvLyBJbnB1dHNcblxuICAgICAgICB0aGlzLmVsZW1lbnRzLmlucHV0cyA9IHtcbiAgICAgICAgICBzZWVrOiBnZXRFbGVtZW50LmNhbGwodGhpcywgdGhpcy5jb25maWcuc2VsZWN0b3JzLmlucHV0cy5zZWVrKSxcbiAgICAgICAgICB2b2x1bWU6IGdldEVsZW1lbnQuY2FsbCh0aGlzLCB0aGlzLmNvbmZpZy5zZWxlY3RvcnMuaW5wdXRzLnZvbHVtZSlcbiAgICAgICAgfTsgLy8gRGlzcGxheVxuXG4gICAgICAgIHRoaXMuZWxlbWVudHMuZGlzcGxheSA9IHtcbiAgICAgICAgICBidWZmZXI6IGdldEVsZW1lbnQuY2FsbCh0aGlzLCB0aGlzLmNvbmZpZy5zZWxlY3RvcnMuZGlzcGxheS5idWZmZXIpLFxuICAgICAgICAgIGN1cnJlbnRUaW1lOiBnZXRFbGVtZW50LmNhbGwodGhpcywgdGhpcy5jb25maWcuc2VsZWN0b3JzLmRpc3BsYXkuY3VycmVudFRpbWUpLFxuICAgICAgICAgIGR1cmF0aW9uOiBnZXRFbGVtZW50LmNhbGwodGhpcywgdGhpcy5jb25maWcuc2VsZWN0b3JzLmRpc3BsYXkuZHVyYXRpb24pXG4gICAgICAgIH07IC8vIFNlZWsgdG9vbHRpcFxuXG4gICAgICAgIGlmIChpcy5lbGVtZW50KHRoaXMuZWxlbWVudHMucHJvZ3Jlc3MpKSB7XG4gICAgICAgICAgdGhpcy5lbGVtZW50cy5kaXNwbGF5LnNlZWtUb29sdGlwID0gdGhpcy5lbGVtZW50cy5wcm9ncmVzcy5xdWVyeVNlbGVjdG9yKGAuJHt0aGlzLmNvbmZpZy5jbGFzc05hbWVzLnRvb2x0aXB9YCk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIC8vIExvZyBpdFxuICAgICAgICB0aGlzLmRlYnVnLndhcm4oJ0l0IGxvb2tzIGxpa2UgdGhlcmUgaXMgYSBwcm9ibGVtIHdpdGggeW91ciBjdXN0b20gY29udHJvbHMgSFRNTCcsIGVycm9yKTsgLy8gUmVzdG9yZSBuYXRpdmUgdmlkZW8gY29udHJvbHNcblxuICAgICAgICB0aGlzLnRvZ2dsZU5hdGl2ZUNvbnRyb2xzKHRydWUpO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfSxcblxuICAgIC8vIENyZWF0ZSA8c3ZnPiBpY29uXG4gICAgY3JlYXRlSWNvbih0eXBlLCBhdHRyaWJ1dGVzKSB7XG4gICAgICBjb25zdCBuYW1lc3BhY2UgPSAnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnO1xuICAgICAgY29uc3QgaWNvblVybCA9IGNvbnRyb2xzLmdldEljb25VcmwuY2FsbCh0aGlzKTtcbiAgICAgIGNvbnN0IGljb25QYXRoID0gYCR7IWljb25VcmwuY29ycyA/IGljb25VcmwudXJsIDogJyd9IyR7dGhpcy5jb25maWcuaWNvblByZWZpeH1gOyAvLyBDcmVhdGUgPHN2Zz5cblxuICAgICAgY29uc3QgaWNvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhuYW1lc3BhY2UsICdzdmcnKTtcbiAgICAgIHNldEF0dHJpYnV0ZXMoaWNvbiwgZXh0ZW5kKGF0dHJpYnV0ZXMsIHtcbiAgICAgICAgJ2FyaWEtaGlkZGVuJzogJ3RydWUnLFxuICAgICAgICBmb2N1c2FibGU6ICdmYWxzZSdcbiAgICAgIH0pKTsgLy8gQ3JlYXRlIHRoZSA8dXNlPiB0byByZWZlcmVuY2Ugc3ByaXRlXG5cbiAgICAgIGNvbnN0IHVzZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhuYW1lc3BhY2UsICd1c2UnKTtcbiAgICAgIGNvbnN0IHBhdGggPSBgJHtpY29uUGF0aH0tJHt0eXBlfWA7IC8vIFNldCBgaHJlZmAgYXR0cmlidXRlc1xuICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3NhbXBvdHRzL3BseXIvaXNzdWVzLzQ2MFxuICAgICAgLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvU1ZHL0F0dHJpYnV0ZS94bGluazpocmVmXG5cbiAgICAgIGlmICgnaHJlZicgaW4gdXNlKSB7XG4gICAgICAgIHVzZS5zZXRBdHRyaWJ1dGVOUygnaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluaycsICdocmVmJywgcGF0aCk7XG4gICAgICB9IC8vIEFsd2F5cyBzZXQgdGhlIG9sZGVyIGF0dHJpYnV0ZSBldmVuIHRob3VnaCBpdCdzIFwiZGVwcmVjYXRlZFwiIChpdCdsbCBiZSBhcm91bmQgZm9yIGFnZXMpXG5cblxuICAgICAgdXNlLnNldEF0dHJpYnV0ZU5TKCdodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rJywgJ3hsaW5rOmhyZWYnLCBwYXRoKTsgLy8gQWRkIDx1c2U+IHRvIDxzdmc+XG5cbiAgICAgIGljb24uYXBwZW5kQ2hpbGQodXNlKTtcbiAgICAgIHJldHVybiBpY29uO1xuICAgIH0sXG5cbiAgICAvLyBDcmVhdGUgaGlkZGVuIHRleHQgbGFiZWxcbiAgICBjcmVhdGVMYWJlbChrZXksIGF0dHIgPSB7fSkge1xuICAgICAgY29uc3QgdGV4dCA9IGkxOG4uZ2V0KGtleSwgdGhpcy5jb25maWcpO1xuICAgICAgY29uc3QgYXR0cmlidXRlcyA9IHsgLi4uYXR0cixcbiAgICAgICAgY2xhc3M6IFthdHRyLmNsYXNzLCB0aGlzLmNvbmZpZy5jbGFzc05hbWVzLmhpZGRlbl0uZmlsdGVyKEJvb2xlYW4pLmpvaW4oJyAnKVxuICAgICAgfTtcbiAgICAgIHJldHVybiBjcmVhdGVFbGVtZW50KCdzcGFuJywgYXR0cmlidXRlcywgdGV4dCk7XG4gICAgfSxcblxuICAgIC8vIENyZWF0ZSBhIGJhZGdlXG4gICAgY3JlYXRlQmFkZ2UodGV4dCkge1xuICAgICAgaWYgKGlzLmVtcHR5KHRleHQpKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBiYWRnZSA9IGNyZWF0ZUVsZW1lbnQoJ3NwYW4nLCB7XG4gICAgICAgIGNsYXNzOiB0aGlzLmNvbmZpZy5jbGFzc05hbWVzLm1lbnUudmFsdWVcbiAgICAgIH0pO1xuICAgICAgYmFkZ2UuYXBwZW5kQ2hpbGQoY3JlYXRlRWxlbWVudCgnc3BhbicsIHtcbiAgICAgICAgY2xhc3M6IHRoaXMuY29uZmlnLmNsYXNzTmFtZXMubWVudS5iYWRnZVxuICAgICAgfSwgdGV4dCkpO1xuICAgICAgcmV0dXJuIGJhZGdlO1xuICAgIH0sXG5cbiAgICAvLyBDcmVhdGUgYSA8YnV0dG9uPlxuICAgIGNyZWF0ZUJ1dHRvbihidXR0b25UeXBlLCBhdHRyKSB7XG4gICAgICBjb25zdCBhdHRyaWJ1dGVzID0gZXh0ZW5kKHt9LCBhdHRyKTtcbiAgICAgIGxldCB0eXBlID0gdG9DYW1lbENhc2UoYnV0dG9uVHlwZSk7XG4gICAgICBjb25zdCBwcm9wcyA9IHtcbiAgICAgICAgZWxlbWVudDogJ2J1dHRvbicsXG4gICAgICAgIHRvZ2dsZTogZmFsc2UsXG4gICAgICAgIGxhYmVsOiBudWxsLFxuICAgICAgICBpY29uOiBudWxsLFxuICAgICAgICBsYWJlbFByZXNzZWQ6IG51bGwsXG4gICAgICAgIGljb25QcmVzc2VkOiBudWxsXG4gICAgICB9O1xuICAgICAgWydlbGVtZW50JywgJ2ljb24nLCAnbGFiZWwnXS5mb3JFYWNoKGtleSA9PiB7XG4gICAgICAgIGlmIChPYmplY3Qua2V5cyhhdHRyaWJ1dGVzKS5pbmNsdWRlcyhrZXkpKSB7XG4gICAgICAgICAgcHJvcHNba2V5XSA9IGF0dHJpYnV0ZXNba2V5XTtcbiAgICAgICAgICBkZWxldGUgYXR0cmlidXRlc1trZXldO1xuICAgICAgICB9XG4gICAgICB9KTsgLy8gRGVmYXVsdCB0byAnYnV0dG9uJyB0eXBlIHRvIHByZXZlbnQgZm9ybSBzdWJtaXNzaW9uXG5cbiAgICAgIGlmIChwcm9wcy5lbGVtZW50ID09PSAnYnV0dG9uJyAmJiAhT2JqZWN0LmtleXMoYXR0cmlidXRlcykuaW5jbHVkZXMoJ3R5cGUnKSkge1xuICAgICAgICBhdHRyaWJ1dGVzLnR5cGUgPSAnYnV0dG9uJztcbiAgICAgIH0gLy8gU2V0IGNsYXNzIG5hbWVcblxuXG4gICAgICBpZiAoT2JqZWN0LmtleXMoYXR0cmlidXRlcykuaW5jbHVkZXMoJ2NsYXNzJykpIHtcbiAgICAgICAgaWYgKCFhdHRyaWJ1dGVzLmNsYXNzLnNwbGl0KCcgJykuc29tZShjID0+IGMgPT09IHRoaXMuY29uZmlnLmNsYXNzTmFtZXMuY29udHJvbCkpIHtcbiAgICAgICAgICBleHRlbmQoYXR0cmlidXRlcywge1xuICAgICAgICAgICAgY2xhc3M6IGAke2F0dHJpYnV0ZXMuY2xhc3N9ICR7dGhpcy5jb25maWcuY2xhc3NOYW1lcy5jb250cm9sfWBcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYXR0cmlidXRlcy5jbGFzcyA9IHRoaXMuY29uZmlnLmNsYXNzTmFtZXMuY29udHJvbDtcbiAgICAgIH0gLy8gTGFyZ2UgcGxheSBidXR0b25cblxuXG4gICAgICBzd2l0Y2ggKGJ1dHRvblR5cGUpIHtcbiAgICAgICAgY2FzZSAncGxheSc6XG4gICAgICAgICAgcHJvcHMudG9nZ2xlID0gdHJ1ZTtcbiAgICAgICAgICBwcm9wcy5sYWJlbCA9ICdwbGF5JztcbiAgICAgICAgICBwcm9wcy5sYWJlbFByZXNzZWQgPSAncGF1c2UnO1xuICAgICAgICAgIHByb3BzLmljb24gPSAncGxheSc7XG4gICAgICAgICAgcHJvcHMuaWNvblByZXNzZWQgPSAncGF1c2UnO1xuICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgIGNhc2UgJ211dGUnOlxuICAgICAgICAgIHByb3BzLnRvZ2dsZSA9IHRydWU7XG4gICAgICAgICAgcHJvcHMubGFiZWwgPSAnbXV0ZSc7XG4gICAgICAgICAgcHJvcHMubGFiZWxQcmVzc2VkID0gJ3VubXV0ZSc7XG4gICAgICAgICAgcHJvcHMuaWNvbiA9ICd2b2x1bWUnO1xuICAgICAgICAgIHByb3BzLmljb25QcmVzc2VkID0gJ211dGVkJztcbiAgICAgICAgICBicmVhaztcblxuICAgICAgICBjYXNlICdjYXB0aW9ucyc6XG4gICAgICAgICAgcHJvcHMudG9nZ2xlID0gdHJ1ZTtcbiAgICAgICAgICBwcm9wcy5sYWJlbCA9ICdlbmFibGVDYXB0aW9ucyc7XG4gICAgICAgICAgcHJvcHMubGFiZWxQcmVzc2VkID0gJ2Rpc2FibGVDYXB0aW9ucyc7XG4gICAgICAgICAgcHJvcHMuaWNvbiA9ICdjYXB0aW9ucy1vZmYnO1xuICAgICAgICAgIHByb3BzLmljb25QcmVzc2VkID0gJ2NhcHRpb25zLW9uJztcbiAgICAgICAgICBicmVhaztcblxuICAgICAgICBjYXNlICdmdWxsc2NyZWVuJzpcbiAgICAgICAgICBwcm9wcy50b2dnbGUgPSB0cnVlO1xuICAgICAgICAgIHByb3BzLmxhYmVsID0gJ2VudGVyRnVsbHNjcmVlbic7XG4gICAgICAgICAgcHJvcHMubGFiZWxQcmVzc2VkID0gJ2V4aXRGdWxsc2NyZWVuJztcbiAgICAgICAgICBwcm9wcy5pY29uID0gJ2VudGVyLWZ1bGxzY3JlZW4nO1xuICAgICAgICAgIHByb3BzLmljb25QcmVzc2VkID0gJ2V4aXQtZnVsbHNjcmVlbic7XG4gICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgY2FzZSAncGxheS1sYXJnZSc6XG4gICAgICAgICAgYXR0cmlidXRlcy5jbGFzcyArPSBgICR7dGhpcy5jb25maWcuY2xhc3NOYW1lcy5jb250cm9sfS0tb3ZlcmxhaWRgO1xuICAgICAgICAgIHR5cGUgPSAncGxheSc7XG4gICAgICAgICAgcHJvcHMubGFiZWwgPSAncGxheSc7XG4gICAgICAgICAgcHJvcHMuaWNvbiA9ICdwbGF5JztcbiAgICAgICAgICBicmVhaztcblxuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIGlmIChpcy5lbXB0eShwcm9wcy5sYWJlbCkpIHtcbiAgICAgICAgICAgIHByb3BzLmxhYmVsID0gdHlwZTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAoaXMuZW1wdHkocHJvcHMuaWNvbikpIHtcbiAgICAgICAgICAgIHByb3BzLmljb24gPSBidXR0b25UeXBlO1xuICAgICAgICAgIH1cblxuICAgICAgfVxuXG4gICAgICBjb25zdCBidXR0b24gPSBjcmVhdGVFbGVtZW50KHByb3BzLmVsZW1lbnQpOyAvLyBTZXR1cCB0b2dnbGUgaWNvbiBhbmQgbGFiZWxzXG5cbiAgICAgIGlmIChwcm9wcy50b2dnbGUpIHtcbiAgICAgICAgLy8gSWNvblxuICAgICAgICBidXR0b24uYXBwZW5kQ2hpbGQoY29udHJvbHMuY3JlYXRlSWNvbi5jYWxsKHRoaXMsIHByb3BzLmljb25QcmVzc2VkLCB7XG4gICAgICAgICAgY2xhc3M6ICdpY29uLS1wcmVzc2VkJ1xuICAgICAgICB9KSk7XG4gICAgICAgIGJ1dHRvbi5hcHBlbmRDaGlsZChjb250cm9scy5jcmVhdGVJY29uLmNhbGwodGhpcywgcHJvcHMuaWNvbiwge1xuICAgICAgICAgIGNsYXNzOiAnaWNvbi0tbm90LXByZXNzZWQnXG4gICAgICAgIH0pKTsgLy8gTGFiZWwvVG9vbHRpcFxuXG4gICAgICAgIGJ1dHRvbi5hcHBlbmRDaGlsZChjb250cm9scy5jcmVhdGVMYWJlbC5jYWxsKHRoaXMsIHByb3BzLmxhYmVsUHJlc3NlZCwge1xuICAgICAgICAgIGNsYXNzOiAnbGFiZWwtLXByZXNzZWQnXG4gICAgICAgIH0pKTtcbiAgICAgICAgYnV0dG9uLmFwcGVuZENoaWxkKGNvbnRyb2xzLmNyZWF0ZUxhYmVsLmNhbGwodGhpcywgcHJvcHMubGFiZWwsIHtcbiAgICAgICAgICBjbGFzczogJ2xhYmVsLS1ub3QtcHJlc3NlZCdcbiAgICAgICAgfSkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYnV0dG9uLmFwcGVuZENoaWxkKGNvbnRyb2xzLmNyZWF0ZUljb24uY2FsbCh0aGlzLCBwcm9wcy5pY29uKSk7XG4gICAgICAgIGJ1dHRvbi5hcHBlbmRDaGlsZChjb250cm9scy5jcmVhdGVMYWJlbC5jYWxsKHRoaXMsIHByb3BzLmxhYmVsKSk7XG4gICAgICB9IC8vIE1lcmdlIGFuZCBzZXQgYXR0cmlidXRlc1xuXG5cbiAgICAgIGV4dGVuZChhdHRyaWJ1dGVzLCBnZXRBdHRyaWJ1dGVzRnJvbVNlbGVjdG9yKHRoaXMuY29uZmlnLnNlbGVjdG9ycy5idXR0b25zW3R5cGVdLCBhdHRyaWJ1dGVzKSk7XG4gICAgICBzZXRBdHRyaWJ1dGVzKGJ1dHRvbiwgYXR0cmlidXRlcyk7IC8vIFdlIGhhdmUgbXVsdGlwbGUgcGxheSBidXR0b25zXG5cbiAgICAgIGlmICh0eXBlID09PSAncGxheScpIHtcbiAgICAgICAgaWYgKCFpcy5hcnJheSh0aGlzLmVsZW1lbnRzLmJ1dHRvbnNbdHlwZV0pKSB7XG4gICAgICAgICAgdGhpcy5lbGVtZW50cy5idXR0b25zW3R5cGVdID0gW107XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmVsZW1lbnRzLmJ1dHRvbnNbdHlwZV0ucHVzaChidXR0b24pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5lbGVtZW50cy5idXR0b25zW3R5cGVdID0gYnV0dG9uO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gYnV0dG9uO1xuICAgIH0sXG5cbiAgICAvLyBDcmVhdGUgYW4gPGlucHV0IHR5cGU9J3JhbmdlJz5cbiAgICBjcmVhdGVSYW5nZSh0eXBlLCBhdHRyaWJ1dGVzKSB7XG4gICAgICAvLyBTZWVrIGlucHV0XG4gICAgICBjb25zdCBpbnB1dCA9IGNyZWF0ZUVsZW1lbnQoJ2lucHV0JywgZXh0ZW5kKGdldEF0dHJpYnV0ZXNGcm9tU2VsZWN0b3IodGhpcy5jb25maWcuc2VsZWN0b3JzLmlucHV0c1t0eXBlXSksIHtcbiAgICAgICAgdHlwZTogJ3JhbmdlJyxcbiAgICAgICAgbWluOiAwLFxuICAgICAgICBtYXg6IDEwMCxcbiAgICAgICAgc3RlcDogMC4wMSxcbiAgICAgICAgdmFsdWU6IDAsXG4gICAgICAgIGF1dG9jb21wbGV0ZTogJ29mZicsXG4gICAgICAgIC8vIEExMXkgZml4ZXMgZm9yIGh0dHBzOi8vZ2l0aHViLmNvbS9zYW1wb3R0cy9wbHlyL2lzc3Vlcy85MDVcbiAgICAgICAgcm9sZTogJ3NsaWRlcicsXG4gICAgICAgICdhcmlhLWxhYmVsJzogaTE4bi5nZXQodHlwZSwgdGhpcy5jb25maWcpLFxuICAgICAgICAnYXJpYS12YWx1ZW1pbic6IDAsXG4gICAgICAgICdhcmlhLXZhbHVlbWF4JzogMTAwLFxuICAgICAgICAnYXJpYS12YWx1ZW5vdyc6IDBcbiAgICAgIH0sIGF0dHJpYnV0ZXMpKTtcbiAgICAgIHRoaXMuZWxlbWVudHMuaW5wdXRzW3R5cGVdID0gaW5wdXQ7IC8vIFNldCB0aGUgZmlsbCBmb3Igd2Via2l0IG5vd1xuXG4gICAgICBjb250cm9scy51cGRhdGVSYW5nZUZpbGwuY2FsbCh0aGlzLCBpbnB1dCk7IC8vIEltcHJvdmUgc3VwcG9ydCBvbiB0b3VjaCBkZXZpY2VzXG5cbiAgICAgIFJhbmdlVG91Y2guc2V0dXAoaW5wdXQpO1xuICAgICAgcmV0dXJuIGlucHV0O1xuICAgIH0sXG5cbiAgICAvLyBDcmVhdGUgYSA8cHJvZ3Jlc3M+XG4gICAgY3JlYXRlUHJvZ3Jlc3ModHlwZSwgYXR0cmlidXRlcykge1xuICAgICAgY29uc3QgcHJvZ3Jlc3MgPSBjcmVhdGVFbGVtZW50KCdwcm9ncmVzcycsIGV4dGVuZChnZXRBdHRyaWJ1dGVzRnJvbVNlbGVjdG9yKHRoaXMuY29uZmlnLnNlbGVjdG9ycy5kaXNwbGF5W3R5cGVdKSwge1xuICAgICAgICBtaW46IDAsXG4gICAgICAgIG1heDogMTAwLFxuICAgICAgICB2YWx1ZTogMCxcbiAgICAgICAgcm9sZTogJ3Byb2dyZXNzYmFyJyxcbiAgICAgICAgJ2FyaWEtaGlkZGVuJzogdHJ1ZVxuICAgICAgfSwgYXR0cmlidXRlcykpOyAvLyBDcmVhdGUgdGhlIGxhYmVsIGluc2lkZVxuXG4gICAgICBpZiAodHlwZSAhPT0gJ3ZvbHVtZScpIHtcbiAgICAgICAgcHJvZ3Jlc3MuYXBwZW5kQ2hpbGQoY3JlYXRlRWxlbWVudCgnc3BhbicsIG51bGwsICcwJykpO1xuICAgICAgICBjb25zdCBzdWZmaXhLZXkgPSB7XG4gICAgICAgICAgcGxheWVkOiAncGxheWVkJyxcbiAgICAgICAgICBidWZmZXI6ICdidWZmZXJlZCdcbiAgICAgICAgfVt0eXBlXTtcbiAgICAgICAgY29uc3Qgc3VmZml4ID0gc3VmZml4S2V5ID8gaTE4bi5nZXQoc3VmZml4S2V5LCB0aGlzLmNvbmZpZykgOiAnJztcbiAgICAgICAgcHJvZ3Jlc3MuaW5uZXJUZXh0ID0gYCUgJHtzdWZmaXgudG9Mb3dlckNhc2UoKX1gO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmVsZW1lbnRzLmRpc3BsYXlbdHlwZV0gPSBwcm9ncmVzcztcbiAgICAgIHJldHVybiBwcm9ncmVzcztcbiAgICB9LFxuXG4gICAgLy8gQ3JlYXRlIHRpbWUgZGlzcGxheVxuICAgIGNyZWF0ZVRpbWUodHlwZSwgYXR0cnMpIHtcbiAgICAgIGNvbnN0IGF0dHJpYnV0ZXMgPSBnZXRBdHRyaWJ1dGVzRnJvbVNlbGVjdG9yKHRoaXMuY29uZmlnLnNlbGVjdG9ycy5kaXNwbGF5W3R5cGVdLCBhdHRycyk7XG4gICAgICBjb25zdCBjb250YWluZXIgPSBjcmVhdGVFbGVtZW50KCdkaXYnLCBleHRlbmQoYXR0cmlidXRlcywge1xuICAgICAgICBjbGFzczogYCR7YXR0cmlidXRlcy5jbGFzcyA/IGF0dHJpYnV0ZXMuY2xhc3MgOiAnJ30gJHt0aGlzLmNvbmZpZy5jbGFzc05hbWVzLmRpc3BsYXkudGltZX0gYC50cmltKCksXG4gICAgICAgICdhcmlhLWxhYmVsJzogaTE4bi5nZXQodHlwZSwgdGhpcy5jb25maWcpXG4gICAgICB9KSwgJzAwOjAwJyk7IC8vIFJlZmVyZW5jZSBmb3IgdXBkYXRlc1xuXG4gICAgICB0aGlzLmVsZW1lbnRzLmRpc3BsYXlbdHlwZV0gPSBjb250YWluZXI7XG4gICAgICByZXR1cm4gY29udGFpbmVyO1xuICAgIH0sXG5cbiAgICAvLyBCaW5kIGtleWJvYXJkIHNob3J0Y3V0cyBmb3IgYSBtZW51IGl0ZW1cbiAgICAvLyBXZSBoYXZlIHRvIGJpbmQgdG8ga2V5dXAgb3RoZXJ3aXNlIEZpcmVmb3ggdHJpZ2dlcnMgYSBjbGljayB3aGVuIGEga2V5ZG93biBldmVudCBoYW5kbGVyIHNoaWZ0cyBmb2N1c1xuICAgIC8vIGh0dHBzOi8vYnVnemlsbGEubW96aWxsYS5vcmcvc2hvd19idWcuY2dpP2lkPTEyMjAxNDNcbiAgICBiaW5kTWVudUl0ZW1TaG9ydGN1dHMobWVudUl0ZW0sIHR5cGUpIHtcbiAgICAgIC8vIE5hdmlnYXRlIHRocm91Z2ggbWVudXMgdmlhIGFycm93IGtleXMgYW5kIHNwYWNlXG4gICAgICBvbi5jYWxsKHRoaXMsIG1lbnVJdGVtLCAna2V5ZG93biBrZXl1cCcsIGV2ZW50ID0+IHtcbiAgICAgICAgLy8gV2Ugb25seSBjYXJlIGFib3V0IHNwYWNlIGFuZCDirIbvuI8g4qyH77iP77iPIOKeoe+4j1xuICAgICAgICBpZiAoIVsnU3BhY2UnLCAnQXJyb3dVcCcsICdBcnJvd0Rvd24nLCAnQXJyb3dSaWdodCddLmluY2x1ZGVzKGV2ZW50LmtleSkpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH0gLy8gUHJldmVudCBwbGF5IC8gc2Vla1xuXG5cbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7IC8vIFdlJ3JlIGp1c3QgaGVyZSB0byBwcmV2ZW50IHRoZSBrZXlkb3duIGJ1YmJsaW5nXG5cbiAgICAgICAgaWYgKGV2ZW50LnR5cGUgPT09ICdrZXlkb3duJykge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGlzUmFkaW9CdXR0b24gPSBtYXRjaGVzKG1lbnVJdGVtLCAnW3JvbGU9XCJtZW51aXRlbXJhZGlvXCJdJyk7IC8vIFNob3cgdGhlIHJlc3BlY3RpdmUgbWVudVxuXG4gICAgICAgIGlmICghaXNSYWRpb0J1dHRvbiAmJiBbJ1NwYWNlJywgJ0Fycm93UmlnaHQnXS5pbmNsdWRlcyhldmVudC5rZXkpKSB7XG4gICAgICAgICAgY29udHJvbHMuc2hvd01lbnVQYW5lbC5jYWxsKHRoaXMsIHR5cGUsIHRydWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGxldCB0YXJnZXQ7XG5cbiAgICAgICAgICBpZiAoZXZlbnQua2V5ICE9PSAnU3BhY2UnKSB7XG4gICAgICAgICAgICBpZiAoZXZlbnQua2V5ID09PSAnQXJyb3dEb3duJyB8fCBpc1JhZGlvQnV0dG9uICYmIGV2ZW50LmtleSA9PT0gJ0Fycm93UmlnaHQnKSB7XG4gICAgICAgICAgICAgIHRhcmdldCA9IG1lbnVJdGVtLm5leHRFbGVtZW50U2libGluZztcblxuICAgICAgICAgICAgICBpZiAoIWlzLmVsZW1lbnQodGFyZ2V0KSkge1xuICAgICAgICAgICAgICAgIHRhcmdldCA9IG1lbnVJdGVtLnBhcmVudE5vZGUuZmlyc3RFbGVtZW50Q2hpbGQ7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHRhcmdldCA9IG1lbnVJdGVtLnByZXZpb3VzRWxlbWVudFNpYmxpbmc7XG5cbiAgICAgICAgICAgICAgaWYgKCFpcy5lbGVtZW50KHRhcmdldCkpIHtcbiAgICAgICAgICAgICAgICB0YXJnZXQgPSBtZW51SXRlbS5wYXJlbnROb2RlLmxhc3RFbGVtZW50Q2hpbGQ7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc2V0Rm9jdXMuY2FsbCh0aGlzLCB0YXJnZXQsIHRydWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSwgZmFsc2UpOyAvLyBFbnRlciB3aWxsIGZpcmUgYSBgY2xpY2tgIGV2ZW50IGJ1dCB3ZSBzdGlsbCBuZWVkIHRvIG1hbmFnZSBmb2N1c1xuICAgICAgLy8gU28gd2UgYmluZCB0byBrZXl1cCB3aGljaCBmaXJlcyBhZnRlciBhbmQgc2V0IGZvY3VzIGhlcmVcblxuICAgICAgb24uY2FsbCh0aGlzLCBtZW51SXRlbSwgJ2tleXVwJywgZXZlbnQgPT4ge1xuICAgICAgICBpZiAoZXZlbnQua2V5ICE9PSAnUmV0dXJuJykgcmV0dXJuO1xuICAgICAgICBjb250cm9scy5mb2N1c0ZpcnN0TWVudUl0ZW0uY2FsbCh0aGlzLCBudWxsLCB0cnVlKTtcbiAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvLyBDcmVhdGUgYSBzZXR0aW5ncyBtZW51IGl0ZW1cbiAgICBjcmVhdGVNZW51SXRlbSh7XG4gICAgICB2YWx1ZSxcbiAgICAgIGxpc3QsXG4gICAgICB0eXBlLFxuICAgICAgdGl0bGUsXG4gICAgICBiYWRnZSA9IG51bGwsXG4gICAgICBjaGVja2VkID0gZmFsc2VcbiAgICB9KSB7XG4gICAgICBjb25zdCBhdHRyaWJ1dGVzID0gZ2V0QXR0cmlidXRlc0Zyb21TZWxlY3Rvcih0aGlzLmNvbmZpZy5zZWxlY3RvcnMuaW5wdXRzW3R5cGVdKTtcbiAgICAgIGNvbnN0IG1lbnVJdGVtID0gY3JlYXRlRWxlbWVudCgnYnV0dG9uJywgZXh0ZW5kKGF0dHJpYnV0ZXMsIHtcbiAgICAgICAgdHlwZTogJ2J1dHRvbicsXG4gICAgICAgIHJvbGU6ICdtZW51aXRlbXJhZGlvJyxcbiAgICAgICAgY2xhc3M6IGAke3RoaXMuY29uZmlnLmNsYXNzTmFtZXMuY29udHJvbH0gJHthdHRyaWJ1dGVzLmNsYXNzID8gYXR0cmlidXRlcy5jbGFzcyA6ICcnfWAudHJpbSgpLFxuICAgICAgICAnYXJpYS1jaGVja2VkJzogY2hlY2tlZCxcbiAgICAgICAgdmFsdWVcbiAgICAgIH0pKTtcbiAgICAgIGNvbnN0IGZsZXggPSBjcmVhdGVFbGVtZW50KCdzcGFuJyk7IC8vIFdlIGhhdmUgdG8gc2V0IGFzIEhUTUwgaW5jYXNlIG9mIHNwZWNpYWwgY2hhcmFjdGVyc1xuXG4gICAgICBmbGV4LmlubmVySFRNTCA9IHRpdGxlO1xuXG4gICAgICBpZiAoaXMuZWxlbWVudChiYWRnZSkpIHtcbiAgICAgICAgZmxleC5hcHBlbmRDaGlsZChiYWRnZSk7XG4gICAgICB9XG5cbiAgICAgIG1lbnVJdGVtLmFwcGVuZENoaWxkKGZsZXgpOyAvLyBSZXBsaWNhdGUgcmFkaW8gYnV0dG9uIGJlaGF2aW9yXG5cbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShtZW51SXRlbSwgJ2NoZWNrZWQnLCB7XG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG5cbiAgICAgICAgZ2V0KCkge1xuICAgICAgICAgIHJldHVybiBtZW51SXRlbS5nZXRBdHRyaWJ1dGUoJ2FyaWEtY2hlY2tlZCcpID09PSAndHJ1ZSc7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0KGNoZWNrKSB7XG4gICAgICAgICAgLy8gRW5zdXJlIGV4Y2x1c2l2aXR5XG4gICAgICAgICAgaWYgKGNoZWNrKSB7XG4gICAgICAgICAgICBBcnJheS5mcm9tKG1lbnVJdGVtLnBhcmVudE5vZGUuY2hpbGRyZW4pLmZpbHRlcihub2RlID0+IG1hdGNoZXMobm9kZSwgJ1tyb2xlPVwibWVudWl0ZW1yYWRpb1wiXScpKS5mb3JFYWNoKG5vZGUgPT4gbm9kZS5zZXRBdHRyaWJ1dGUoJ2FyaWEtY2hlY2tlZCcsICdmYWxzZScpKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBtZW51SXRlbS5zZXRBdHRyaWJ1dGUoJ2FyaWEtY2hlY2tlZCcsIGNoZWNrID8gJ3RydWUnIDogJ2ZhbHNlJyk7XG4gICAgICAgIH1cblxuICAgICAgfSk7XG4gICAgICB0aGlzLmxpc3RlbmVycy5iaW5kKG1lbnVJdGVtLCAnY2xpY2sga2V5dXAnLCBldmVudCA9PiB7XG4gICAgICAgIGlmIChpcy5rZXlib2FyZEV2ZW50KGV2ZW50KSAmJiBldmVudC5rZXkgIT09ICdTcGFjZScpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgbWVudUl0ZW0uY2hlY2tlZCA9IHRydWU7XG5cbiAgICAgICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICAgICAgY2FzZSAnbGFuZ3VhZ2UnOlxuICAgICAgICAgICAgdGhpcy5jdXJyZW50VHJhY2sgPSBOdW1iZXIodmFsdWUpO1xuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBjYXNlICdxdWFsaXR5JzpcbiAgICAgICAgICAgIHRoaXMucXVhbGl0eSA9IHZhbHVlO1xuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBjYXNlICdzcGVlZCc6XG4gICAgICAgICAgICB0aGlzLnNwZWVkID0gcGFyc2VGbG9hdCh2YWx1ZSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnRyb2xzLnNob3dNZW51UGFuZWwuY2FsbCh0aGlzLCAnaG9tZScsIGlzLmtleWJvYXJkRXZlbnQoZXZlbnQpKTtcbiAgICAgIH0sIHR5cGUsIGZhbHNlKTtcbiAgICAgIGNvbnRyb2xzLmJpbmRNZW51SXRlbVNob3J0Y3V0cy5jYWxsKHRoaXMsIG1lbnVJdGVtLCB0eXBlKTtcbiAgICAgIGxpc3QuYXBwZW5kQ2hpbGQobWVudUl0ZW0pO1xuICAgIH0sXG5cbiAgICAvLyBGb3JtYXQgYSB0aW1lIGZvciBkaXNwbGF5XG4gICAgZm9ybWF0VGltZSh0aW1lID0gMCwgaW52ZXJ0ZWQgPSBmYWxzZSkge1xuICAgICAgLy8gQmFpbCBpZiB0aGUgdmFsdWUgaXNuJ3QgYSBudW1iZXJcbiAgICAgIGlmICghaXMubnVtYmVyKHRpbWUpKSB7XG4gICAgICAgIHJldHVybiB0aW1lO1xuICAgICAgfSAvLyBBbHdheXMgZGlzcGxheSBob3VycyBpZiBkdXJhdGlvbiBpcyBvdmVyIGFuIGhvdXJcblxuXG4gICAgICBjb25zdCBmb3JjZUhvdXJzID0gZ2V0SG91cnModGhpcy5kdXJhdGlvbikgPiAwO1xuICAgICAgcmV0dXJuIGZvcm1hdFRpbWUodGltZSwgZm9yY2VIb3VycywgaW52ZXJ0ZWQpO1xuICAgIH0sXG5cbiAgICAvLyBVcGRhdGUgdGhlIGRpc3BsYXllZCB0aW1lXG4gICAgdXBkYXRlVGltZURpc3BsYXkodGFyZ2V0ID0gbnVsbCwgdGltZSA9IDAsIGludmVydGVkID0gZmFsc2UpIHtcbiAgICAgIC8vIEJhaWwgaWYgdGhlcmUncyBubyBlbGVtZW50IHRvIGRpc3BsYXkgb3IgdGhlIHZhbHVlIGlzbid0IGEgbnVtYmVyXG4gICAgICBpZiAoIWlzLmVsZW1lbnQodGFyZ2V0KSB8fCAhaXMubnVtYmVyKHRpbWUpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH0gLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXBhcmFtLXJlYXNzaWduXG5cblxuICAgICAgdGFyZ2V0LmlubmVyVGV4dCA9IGNvbnRyb2xzLmZvcm1hdFRpbWUodGltZSwgaW52ZXJ0ZWQpO1xuICAgIH0sXG5cbiAgICAvLyBVcGRhdGUgdm9sdW1lIFVJIGFuZCBzdG9yYWdlXG4gICAgdXBkYXRlVm9sdW1lKCkge1xuICAgICAgaWYgKCF0aGlzLnN1cHBvcnRlZC51aSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9IC8vIFVwZGF0ZSByYW5nZVxuXG5cbiAgICAgIGlmIChpcy5lbGVtZW50KHRoaXMuZWxlbWVudHMuaW5wdXRzLnZvbHVtZSkpIHtcbiAgICAgICAgY29udHJvbHMuc2V0UmFuZ2UuY2FsbCh0aGlzLCB0aGlzLmVsZW1lbnRzLmlucHV0cy52b2x1bWUsIHRoaXMubXV0ZWQgPyAwIDogdGhpcy52b2x1bWUpO1xuICAgICAgfSAvLyBVcGRhdGUgbXV0ZSBzdGF0ZVxuXG5cbiAgICAgIGlmIChpcy5lbGVtZW50KHRoaXMuZWxlbWVudHMuYnV0dG9ucy5tdXRlKSkge1xuICAgICAgICB0aGlzLmVsZW1lbnRzLmJ1dHRvbnMubXV0ZS5wcmVzc2VkID0gdGhpcy5tdXRlZCB8fCB0aGlzLnZvbHVtZSA9PT0gMDtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgLy8gVXBkYXRlIHNlZWsgdmFsdWUgYW5kIGxvd2VyIGZpbGxcbiAgICBzZXRSYW5nZSh0YXJnZXQsIHZhbHVlID0gMCkge1xuICAgICAgaWYgKCFpcy5lbGVtZW50KHRhcmdldCkpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfSAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmVcblxuXG4gICAgICB0YXJnZXQudmFsdWUgPSB2YWx1ZTsgLy8gV2Via2l0IHJhbmdlIGZpbGxcblxuICAgICAgY29udHJvbHMudXBkYXRlUmFuZ2VGaWxsLmNhbGwodGhpcywgdGFyZ2V0KTtcbiAgICB9LFxuXG4gICAgLy8gVXBkYXRlIDxwcm9ncmVzcz4gZWxlbWVudHNcbiAgICB1cGRhdGVQcm9ncmVzcyhldmVudCkge1xuICAgICAgaWYgKCF0aGlzLnN1cHBvcnRlZC51aSB8fCAhaXMuZXZlbnQoZXZlbnQpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgbGV0IHZhbHVlID0gMDtcblxuICAgICAgY29uc3Qgc2V0UHJvZ3Jlc3MgPSAodGFyZ2V0LCBpbnB1dCkgPT4ge1xuICAgICAgICBjb25zdCB2YWwgPSBpcy5udW1iZXIoaW5wdXQpID8gaW5wdXQgOiAwO1xuICAgICAgICBjb25zdCBwcm9ncmVzcyA9IGlzLmVsZW1lbnQodGFyZ2V0KSA/IHRhcmdldCA6IHRoaXMuZWxlbWVudHMuZGlzcGxheS5idWZmZXI7IC8vIFVwZGF0ZSB2YWx1ZSBhbmQgbGFiZWxcblxuICAgICAgICBpZiAoaXMuZWxlbWVudChwcm9ncmVzcykpIHtcbiAgICAgICAgICBwcm9ncmVzcy52YWx1ZSA9IHZhbDsgLy8gVXBkYXRlIHRleHQgbGFiZWwgaW5zaWRlXG5cbiAgICAgICAgICBjb25zdCBsYWJlbCA9IHByb2dyZXNzLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdzcGFuJylbMF07XG5cbiAgICAgICAgICBpZiAoaXMuZWxlbWVudChsYWJlbCkpIHtcbiAgICAgICAgICAgIGxhYmVsLmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID0gdmFsO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgaWYgKGV2ZW50KSB7XG4gICAgICAgIHN3aXRjaCAoZXZlbnQudHlwZSkge1xuICAgICAgICAgIC8vIFZpZGVvIHBsYXlpbmdcbiAgICAgICAgICBjYXNlICd0aW1ldXBkYXRlJzpcbiAgICAgICAgICBjYXNlICdzZWVraW5nJzpcbiAgICAgICAgICBjYXNlICdzZWVrZWQnOlxuICAgICAgICAgICAgdmFsdWUgPSBnZXRQZXJjZW50YWdlKHRoaXMuY3VycmVudFRpbWUsIHRoaXMuZHVyYXRpb24pOyAvLyBTZXQgc2VlayByYW5nZSB2YWx1ZSBvbmx5IGlmIGl0J3MgYSAnbmF0dXJhbCcgdGltZSBldmVudFxuXG4gICAgICAgICAgICBpZiAoZXZlbnQudHlwZSA9PT0gJ3RpbWV1cGRhdGUnKSB7XG4gICAgICAgICAgICAgIGNvbnRyb2xzLnNldFJhbmdlLmNhbGwodGhpcywgdGhpcy5lbGVtZW50cy5pbnB1dHMuc2VlaywgdmFsdWUpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAvLyBDaGVjayBidWZmZXIgc3RhdHVzXG5cbiAgICAgICAgICBjYXNlICdwbGF5aW5nJzpcbiAgICAgICAgICBjYXNlICdwcm9ncmVzcyc6XG4gICAgICAgICAgICBzZXRQcm9ncmVzcyh0aGlzLmVsZW1lbnRzLmRpc3BsYXkuYnVmZmVyLCB0aGlzLmJ1ZmZlcmVkICogMTAwKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcblxuICAgIC8vIFdlYmtpdCBwb2x5ZmlsbCBmb3IgbG93ZXIgZmlsbCByYW5nZVxuICAgIHVwZGF0ZVJhbmdlRmlsbCh0YXJnZXQpIHtcbiAgICAgIC8vIEdldCByYW5nZSBmcm9tIGV2ZW50IGlmIGV2ZW50IHBhc3NlZFxuICAgICAgY29uc3QgcmFuZ2UgPSBpcy5ldmVudCh0YXJnZXQpID8gdGFyZ2V0LnRhcmdldCA6IHRhcmdldDsgLy8gTmVlZHMgdG8gYmUgYSB2YWxpZCA8aW5wdXQgdHlwZT0ncmFuZ2UnPlxuXG4gICAgICBpZiAoIWlzLmVsZW1lbnQocmFuZ2UpIHx8IHJhbmdlLmdldEF0dHJpYnV0ZSgndHlwZScpICE9PSAncmFuZ2UnKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH0gLy8gU2V0IGFyaWEgdmFsdWVzIGZvciBodHRwczovL2dpdGh1Yi5jb20vc2FtcG90dHMvcGx5ci9pc3N1ZXMvOTA1XG5cblxuICAgICAgaWYgKG1hdGNoZXMocmFuZ2UsIHRoaXMuY29uZmlnLnNlbGVjdG9ycy5pbnB1dHMuc2VlaykpIHtcbiAgICAgICAgcmFuZ2Uuc2V0QXR0cmlidXRlKCdhcmlhLXZhbHVlbm93JywgdGhpcy5jdXJyZW50VGltZSk7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRUaW1lID0gY29udHJvbHMuZm9ybWF0VGltZSh0aGlzLmN1cnJlbnRUaW1lKTtcbiAgICAgICAgY29uc3QgZHVyYXRpb24gPSBjb250cm9scy5mb3JtYXRUaW1lKHRoaXMuZHVyYXRpb24pO1xuICAgICAgICBjb25zdCBmb3JtYXQgPSBpMThuLmdldCgnc2Vla0xhYmVsJywgdGhpcy5jb25maWcpO1xuICAgICAgICByYW5nZS5zZXRBdHRyaWJ1dGUoJ2FyaWEtdmFsdWV0ZXh0JywgZm9ybWF0LnJlcGxhY2UoJ3tjdXJyZW50VGltZX0nLCBjdXJyZW50VGltZSkucmVwbGFjZSgne2R1cmF0aW9ufScsIGR1cmF0aW9uKSk7XG4gICAgICB9IGVsc2UgaWYgKG1hdGNoZXMocmFuZ2UsIHRoaXMuY29uZmlnLnNlbGVjdG9ycy5pbnB1dHMudm9sdW1lKSkge1xuICAgICAgICBjb25zdCBwZXJjZW50ID0gcmFuZ2UudmFsdWUgKiAxMDA7XG4gICAgICAgIHJhbmdlLnNldEF0dHJpYnV0ZSgnYXJpYS12YWx1ZW5vdycsIHBlcmNlbnQpO1xuICAgICAgICByYW5nZS5zZXRBdHRyaWJ1dGUoJ2FyaWEtdmFsdWV0ZXh0JywgYCR7cGVyY2VudC50b0ZpeGVkKDEpfSVgKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJhbmdlLnNldEF0dHJpYnV0ZSgnYXJpYS12YWx1ZW5vdycsIHJhbmdlLnZhbHVlKTtcbiAgICAgIH0gLy8gV2ViS2l0IG9ubHlcblxuXG4gICAgICBpZiAoIWJyb3dzZXIuaXNXZWJraXQpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfSAvLyBTZXQgQ1NTIGN1c3RvbSBwcm9wZXJ0eVxuXG5cbiAgICAgIHJhbmdlLnN0eWxlLnNldFByb3BlcnR5KCctLXZhbHVlJywgYCR7cmFuZ2UudmFsdWUgLyByYW5nZS5tYXggKiAxMDB9JWApO1xuICAgIH0sXG5cbiAgICAvLyBVcGRhdGUgaG92ZXIgdG9vbHRpcCBmb3Igc2Vla2luZ1xuICAgIHVwZGF0ZVNlZWtUb29sdGlwKGV2ZW50KSB7XG4gICAgICB2YXIgX3RoaXMkY29uZmlnJG1hcmtlcnMsIF90aGlzJGNvbmZpZyRtYXJrZXJzJDtcblxuICAgICAgLy8gQmFpbCBpZiBzZXR0aW5nIG5vdCB0cnVlXG4gICAgICBpZiAoIXRoaXMuY29uZmlnLnRvb2x0aXBzLnNlZWsgfHwgIWlzLmVsZW1lbnQodGhpcy5lbGVtZW50cy5pbnB1dHMuc2VlaykgfHwgIWlzLmVsZW1lbnQodGhpcy5lbGVtZW50cy5kaXNwbGF5LnNlZWtUb29sdGlwKSB8fCB0aGlzLmR1cmF0aW9uID09PSAwKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgY29uc3QgdGlwRWxlbWVudCA9IHRoaXMuZWxlbWVudHMuZGlzcGxheS5zZWVrVG9vbHRpcDtcbiAgICAgIGNvbnN0IHZpc2libGUgPSBgJHt0aGlzLmNvbmZpZy5jbGFzc05hbWVzLnRvb2x0aXB9LS12aXNpYmxlYDtcblxuICAgICAgY29uc3QgdG9nZ2xlID0gc2hvdyA9PiB0b2dnbGVDbGFzcyh0aXBFbGVtZW50LCB2aXNpYmxlLCBzaG93KTsgLy8gSGlkZSBvbiB0b3VjaFxuXG5cbiAgICAgIGlmICh0aGlzLnRvdWNoKSB7XG4gICAgICAgIHRvZ2dsZShmYWxzZSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH0gLy8gRGV0ZXJtaW5lIHBlcmNlbnRhZ2UsIGlmIGFscmVhZHkgdmlzaWJsZVxuXG5cbiAgICAgIGxldCBwZXJjZW50ID0gMDtcbiAgICAgIGNvbnN0IGNsaWVudFJlY3QgPSB0aGlzLmVsZW1lbnRzLnByb2dyZXNzLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuXG4gICAgICBpZiAoaXMuZXZlbnQoZXZlbnQpKSB7XG4gICAgICAgIHBlcmNlbnQgPSAxMDAgLyBjbGllbnRSZWN0LndpZHRoICogKGV2ZW50LnBhZ2VYIC0gY2xpZW50UmVjdC5sZWZ0KTtcbiAgICAgIH0gZWxzZSBpZiAoaGFzQ2xhc3ModGlwRWxlbWVudCwgdmlzaWJsZSkpIHtcbiAgICAgICAgcGVyY2VudCA9IHBhcnNlRmxvYXQodGlwRWxlbWVudC5zdHlsZS5sZWZ0LCAxMCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm47XG4gICAgICB9IC8vIFNldCBib3VuZHNcblxuXG4gICAgICBpZiAocGVyY2VudCA8IDApIHtcbiAgICAgICAgcGVyY2VudCA9IDA7XG4gICAgICB9IGVsc2UgaWYgKHBlcmNlbnQgPiAxMDApIHtcbiAgICAgICAgcGVyY2VudCA9IDEwMDtcbiAgICAgIH1cblxuICAgICAgY29uc3QgdGltZSA9IHRoaXMuZHVyYXRpb24gLyAxMDAgKiBwZXJjZW50OyAvLyBEaXNwbGF5IHRoZSB0aW1lIGEgY2xpY2sgd291bGQgc2VlayB0b1xuXG4gICAgICB0aXBFbGVtZW50LmlubmVyVGV4dCA9IGNvbnRyb2xzLmZvcm1hdFRpbWUodGltZSk7IC8vIEdldCBtYXJrZXIgcG9pbnQgZm9yIHRpbWVcblxuICAgICAgY29uc3QgcG9pbnQgPSAoX3RoaXMkY29uZmlnJG1hcmtlcnMgPSB0aGlzLmNvbmZpZy5tYXJrZXJzKSA9PT0gbnVsbCB8fCBfdGhpcyRjb25maWckbWFya2VycyA9PT0gdm9pZCAwID8gdm9pZCAwIDogKF90aGlzJGNvbmZpZyRtYXJrZXJzJCA9IF90aGlzJGNvbmZpZyRtYXJrZXJzLnBvaW50cykgPT09IG51bGwgfHwgX3RoaXMkY29uZmlnJG1hcmtlcnMkID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfdGhpcyRjb25maWckbWFya2VycyQuZmluZCgoe1xuICAgICAgICB0aW1lOiB0XG4gICAgICB9KSA9PiB0ID09PSBNYXRoLnJvdW5kKHRpbWUpKTsgLy8gQXBwZW5kIHRoZSBwb2ludCBsYWJlbCB0byB0aGUgdG9vbHRpcFxuXG4gICAgICBpZiAocG9pbnQpIHtcbiAgICAgICAgdGlwRWxlbWVudC5pbnNlcnRBZGphY2VudEhUTUwoJ2FmdGVyYmVnaW4nLCBgJHtwb2ludC5sYWJlbH08YnI+YCk7XG4gICAgICB9IC8vIFNldCBwb3NpdGlvblxuXG5cbiAgICAgIHRpcEVsZW1lbnQuc3R5bGUubGVmdCA9IGAke3BlcmNlbnR9JWA7IC8vIFNob3cvaGlkZSB0aGUgdG9vbHRpcFxuICAgICAgLy8gSWYgdGhlIGV2ZW50IGlzIGEgbW91ZXMgaW4vb3V0IGFuZCBwZXJjZW50YWdlIGlzIGluc2lkZSBib3VuZHNcblxuICAgICAgaWYgKGlzLmV2ZW50KGV2ZW50KSAmJiBbJ21vdXNlZW50ZXInLCAnbW91c2VsZWF2ZSddLmluY2x1ZGVzKGV2ZW50LnR5cGUpKSB7XG4gICAgICAgIHRvZ2dsZShldmVudC50eXBlID09PSAnbW91c2VlbnRlcicpO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICAvLyBIYW5kbGUgdGltZSBjaGFuZ2UgZXZlbnRcbiAgICB0aW1lVXBkYXRlKGV2ZW50KSB7XG4gICAgICAvLyBPbmx5IGludmVydCBpZiBvbmx5IG9uZSB0aW1lIGVsZW1lbnQgaXMgZGlzcGxheWVkIGFuZCB1c2VkIGZvciBib3RoIGR1cmF0aW9uIGFuZCBjdXJyZW50VGltZVxuICAgICAgY29uc3QgaW52ZXJ0ID0gIWlzLmVsZW1lbnQodGhpcy5lbGVtZW50cy5kaXNwbGF5LmR1cmF0aW9uKSAmJiB0aGlzLmNvbmZpZy5pbnZlcnRUaW1lOyAvLyBEdXJhdGlvblxuXG4gICAgICBjb250cm9scy51cGRhdGVUaW1lRGlzcGxheS5jYWxsKHRoaXMsIHRoaXMuZWxlbWVudHMuZGlzcGxheS5jdXJyZW50VGltZSwgaW52ZXJ0ID8gdGhpcy5kdXJhdGlvbiAtIHRoaXMuY3VycmVudFRpbWUgOiB0aGlzLmN1cnJlbnRUaW1lLCBpbnZlcnQpOyAvLyBJZ25vcmUgdXBkYXRlcyB3aGlsZSBzZWVraW5nXG5cbiAgICAgIGlmIChldmVudCAmJiBldmVudC50eXBlID09PSAndGltZXVwZGF0ZScgJiYgdGhpcy5tZWRpYS5zZWVraW5nKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH0gLy8gUGxheWluZyBwcm9ncmVzc1xuXG5cbiAgICAgIGNvbnRyb2xzLnVwZGF0ZVByb2dyZXNzLmNhbGwodGhpcywgZXZlbnQpO1xuICAgIH0sXG5cbiAgICAvLyBTaG93IHRoZSBkdXJhdGlvbiBvbiBtZXRhZGF0YWxvYWRlZCBvciBkdXJhdGlvbmNoYW5nZSBldmVudHNcbiAgICBkdXJhdGlvblVwZGF0ZSgpIHtcbiAgICAgIC8vIEJhaWwgaWYgbm8gVUkgb3IgZHVyYXRpb25jaGFuZ2UgZXZlbnQgdHJpZ2dlcmVkIGFmdGVyIHBsYXlpbmcvc2VlayB3aGVuIGludmVydFRpbWUgaXMgZmFsc2VcbiAgICAgIGlmICghdGhpcy5zdXBwb3J0ZWQudWkgfHwgIXRoaXMuY29uZmlnLmludmVydFRpbWUgJiYgdGhpcy5jdXJyZW50VGltZSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9IC8vIElmIGR1cmF0aW9uIGlzIHRoZSAyKiozMiAoc2hha2EpLCBJbmZpbml0eSAoSExTKSwgREFTSC1JRiAoTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVIgfHwgTnVtYmVyLk1BWF9WQUxVRSkgaW5kaWNhdGluZyBsaXZlIHdlIGhpZGUgdGhlIGN1cnJlbnRUaW1lIGFuZCBwcm9ncmVzc2Jhci5cbiAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS92aWRlby1kZXYvaGxzLmpzL2Jsb2IvNTgyMGQyOWQzYzRjOGE0NmU4Yjc1ZjFlM2FmYTNlNjhjMWE5YTJkYi9zcmMvY29udHJvbGxlci9idWZmZXItY29udHJvbGxlci5qcyNMNDE1XG4gICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vZ29vZ2xlL3NoYWthLXBsYXllci9ibG9iLzRkODg5MDU0NjMxZjRlMWNmMGZiZDgwZGRkMmI3MTg4N2MwMmUyMzIvbGliL21lZGlhL3N0cmVhbWluZ19lbmdpbmUuanMjTDEwNjJcbiAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9EYXNoLUluZHVzdHJ5LUZvcnVtL2Rhc2guanMvYmxvYi82OTg1OWY1MWI5Njk2NDViMjM0NjY2ODAwZDRjYjU5NmQ4OWM2MDJkL3NyYy9kYXNoL21vZGVscy9EYXNoTWFuaWZlc3RNb2RlbC5qcyNMMzM4XG5cblxuICAgICAgaWYgKHRoaXMuZHVyYXRpb24gPj0gMiAqKiAzMikge1xuICAgICAgICB0b2dnbGVIaWRkZW4odGhpcy5lbGVtZW50cy5kaXNwbGF5LmN1cnJlbnRUaW1lLCB0cnVlKTtcbiAgICAgICAgdG9nZ2xlSGlkZGVuKHRoaXMuZWxlbWVudHMucHJvZ3Jlc3MsIHRydWUpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9IC8vIFVwZGF0ZSBBUklBIHZhbHVlc1xuXG5cbiAgICAgIGlmIChpcy5lbGVtZW50KHRoaXMuZWxlbWVudHMuaW5wdXRzLnNlZWspKSB7XG4gICAgICAgIHRoaXMuZWxlbWVudHMuaW5wdXRzLnNlZWsuc2V0QXR0cmlidXRlKCdhcmlhLXZhbHVlbWF4JywgdGhpcy5kdXJhdGlvbik7XG4gICAgICB9IC8vIElmIHRoZXJlJ3MgYSBzcG90IHRvIGRpc3BsYXkgZHVyYXRpb25cblxuXG4gICAgICBjb25zdCBoYXNEdXJhdGlvbiA9IGlzLmVsZW1lbnQodGhpcy5lbGVtZW50cy5kaXNwbGF5LmR1cmF0aW9uKTsgLy8gSWYgdGhlcmUncyBvbmx5IG9uZSB0aW1lIGRpc3BsYXksIGRpc3BsYXkgZHVyYXRpb24gdGhlcmVcblxuICAgICAgaWYgKCFoYXNEdXJhdGlvbiAmJiB0aGlzLmNvbmZpZy5kaXNwbGF5RHVyYXRpb24gJiYgdGhpcy5wYXVzZWQpIHtcbiAgICAgICAgY29udHJvbHMudXBkYXRlVGltZURpc3BsYXkuY2FsbCh0aGlzLCB0aGlzLmVsZW1lbnRzLmRpc3BsYXkuY3VycmVudFRpbWUsIHRoaXMuZHVyYXRpb24pO1xuICAgICAgfSAvLyBJZiB0aGVyZSdzIGEgZHVyYXRpb24gZWxlbWVudCwgdXBkYXRlIGNvbnRlbnRcblxuXG4gICAgICBpZiAoaGFzRHVyYXRpb24pIHtcbiAgICAgICAgY29udHJvbHMudXBkYXRlVGltZURpc3BsYXkuY2FsbCh0aGlzLCB0aGlzLmVsZW1lbnRzLmRpc3BsYXkuZHVyYXRpb24sIHRoaXMuZHVyYXRpb24pO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5jb25maWcubWFya2Vycy5lbmFibGVkKSB7XG4gICAgICAgIGNvbnRyb2xzLnNldE1hcmtlcnMuY2FsbCh0aGlzKTtcbiAgICAgIH0gLy8gVXBkYXRlIHRoZSB0b29sdGlwIChpZiB2aXNpYmxlKVxuXG5cbiAgICAgIGNvbnRyb2xzLnVwZGF0ZVNlZWtUb29sdGlwLmNhbGwodGhpcyk7XG4gICAgfSxcblxuICAgIC8vIEhpZGUvc2hvdyBhIHRhYlxuICAgIHRvZ2dsZU1lbnVCdXR0b24oc2V0dGluZywgdG9nZ2xlKSB7XG4gICAgICB0b2dnbGVIaWRkZW4odGhpcy5lbGVtZW50cy5zZXR0aW5ncy5idXR0b25zW3NldHRpbmddLCAhdG9nZ2xlKTtcbiAgICB9LFxuXG4gICAgLy8gVXBkYXRlIHRoZSBzZWxlY3RlZCBzZXR0aW5nXG4gICAgdXBkYXRlU2V0dGluZyhzZXR0aW5nLCBjb250YWluZXIsIGlucHV0KSB7XG4gICAgICBjb25zdCBwYW5lID0gdGhpcy5lbGVtZW50cy5zZXR0aW5ncy5wYW5lbHNbc2V0dGluZ107XG4gICAgICBsZXQgdmFsdWUgPSBudWxsO1xuICAgICAgbGV0IGxpc3QgPSBjb250YWluZXI7XG5cbiAgICAgIGlmIChzZXR0aW5nID09PSAnY2FwdGlvbnMnKSB7XG4gICAgICAgIHZhbHVlID0gdGhpcy5jdXJyZW50VHJhY2s7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YWx1ZSA9ICFpcy5lbXB0eShpbnB1dCkgPyBpbnB1dCA6IHRoaXNbc2V0dGluZ107IC8vIEdldCBkZWZhdWx0XG5cbiAgICAgICAgaWYgKGlzLmVtcHR5KHZhbHVlKSkge1xuICAgICAgICAgIHZhbHVlID0gdGhpcy5jb25maWdbc2V0dGluZ10uZGVmYXVsdDtcbiAgICAgICAgfSAvLyBVbnN1cHBvcnRlZCB2YWx1ZVxuXG5cbiAgICAgICAgaWYgKCFpcy5lbXB0eSh0aGlzLm9wdGlvbnNbc2V0dGluZ10pICYmICF0aGlzLm9wdGlvbnNbc2V0dGluZ10uaW5jbHVkZXModmFsdWUpKSB7XG4gICAgICAgICAgdGhpcy5kZWJ1Zy53YXJuKGBVbnN1cHBvcnRlZCB2YWx1ZSBvZiAnJHt2YWx1ZX0nIGZvciAke3NldHRpbmd9YCk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9IC8vIERpc2FibGVkIHZhbHVlXG5cblxuICAgICAgICBpZiAoIXRoaXMuY29uZmlnW3NldHRpbmddLm9wdGlvbnMuaW5jbHVkZXModmFsdWUpKSB7XG4gICAgICAgICAgdGhpcy5kZWJ1Zy53YXJuKGBEaXNhYmxlZCB2YWx1ZSBvZiAnJHt2YWx1ZX0nIGZvciAke3NldHRpbmd9YCk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICB9IC8vIEdldCB0aGUgbGlzdCBpZiB3ZSBuZWVkIHRvXG5cblxuICAgICAgaWYgKCFpcy5lbGVtZW50KGxpc3QpKSB7XG4gICAgICAgIGxpc3QgPSBwYW5lICYmIHBhbmUucXVlcnlTZWxlY3RvcignW3JvbGU9XCJtZW51XCJdJyk7XG4gICAgICB9IC8vIElmIHRoZXJlJ3Mgbm8gbGlzdCBpdCBtZWFucyBpdCdzIG5vdCBiZWVuIHJlbmRlcmVkLi4uXG5cblxuICAgICAgaWYgKCFpcy5lbGVtZW50KGxpc3QpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH0gLy8gVXBkYXRlIHRoZSBsYWJlbFxuXG5cbiAgICAgIGNvbnN0IGxhYmVsID0gdGhpcy5lbGVtZW50cy5zZXR0aW5ncy5idXR0b25zW3NldHRpbmddLnF1ZXJ5U2VsZWN0b3IoYC4ke3RoaXMuY29uZmlnLmNsYXNzTmFtZXMubWVudS52YWx1ZX1gKTtcbiAgICAgIGxhYmVsLmlubmVySFRNTCA9IGNvbnRyb2xzLmdldExhYmVsLmNhbGwodGhpcywgc2V0dGluZywgdmFsdWUpOyAvLyBGaW5kIHRoZSByYWRpbyBvcHRpb24gYW5kIGNoZWNrIGl0XG5cbiAgICAgIGNvbnN0IHRhcmdldCA9IGxpc3QgJiYgbGlzdC5xdWVyeVNlbGVjdG9yKGBbdmFsdWU9XCIke3ZhbHVlfVwiXWApO1xuXG4gICAgICBpZiAoaXMuZWxlbWVudCh0YXJnZXQpKSB7XG4gICAgICAgIHRhcmdldC5jaGVja2VkID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgLy8gVHJhbnNsYXRlIGEgdmFsdWUgaW50byBhIG5pY2UgbGFiZWxcbiAgICBnZXRMYWJlbChzZXR0aW5nLCB2YWx1ZSkge1xuICAgICAgc3dpdGNoIChzZXR0aW5nKSB7XG4gICAgICAgIGNhc2UgJ3NwZWVkJzpcbiAgICAgICAgICByZXR1cm4gdmFsdWUgPT09IDEgPyBpMThuLmdldCgnbm9ybWFsJywgdGhpcy5jb25maWcpIDogYCR7dmFsdWV9JnRpbWVzO2A7XG5cbiAgICAgICAgY2FzZSAncXVhbGl0eSc6XG4gICAgICAgICAgaWYgKGlzLm51bWJlcih2YWx1ZSkpIHtcbiAgICAgICAgICAgIGNvbnN0IGxhYmVsID0gaTE4bi5nZXQoYHF1YWxpdHlMYWJlbC4ke3ZhbHVlfWAsIHRoaXMuY29uZmlnKTtcblxuICAgICAgICAgICAgaWYgKCFsYWJlbC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGAke3ZhbHVlfXBgO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gbGFiZWw7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmV0dXJuIHRvVGl0bGVDYXNlKHZhbHVlKTtcblxuICAgICAgICBjYXNlICdjYXB0aW9ucyc6XG4gICAgICAgICAgcmV0dXJuIGNhcHRpb25zLmdldExhYmVsLmNhbGwodGhpcyk7XG5cbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgLy8gU2V0IHRoZSBxdWFsaXR5IG1lbnVcbiAgICBzZXRRdWFsaXR5TWVudShvcHRpb25zKSB7XG4gICAgICAvLyBNZW51IHJlcXVpcmVkXG4gICAgICBpZiAoIWlzLmVsZW1lbnQodGhpcy5lbGVtZW50cy5zZXR0aW5ncy5wYW5lbHMucXVhbGl0eSkpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjb25zdCB0eXBlID0gJ3F1YWxpdHknO1xuICAgICAgY29uc3QgbGlzdCA9IHRoaXMuZWxlbWVudHMuc2V0dGluZ3MucGFuZWxzLnF1YWxpdHkucXVlcnlTZWxlY3RvcignW3JvbGU9XCJtZW51XCJdJyk7IC8vIFNldCBvcHRpb25zIGlmIHBhc3NlZCBhbmQgZmlsdGVyIGJhc2VkIG9uIHVuaXF1ZW5lc3MgYW5kIGNvbmZpZ1xuXG4gICAgICBpZiAoaXMuYXJyYXkob3B0aW9ucykpIHtcbiAgICAgICAgdGhpcy5vcHRpb25zLnF1YWxpdHkgPSBkZWR1cGUob3B0aW9ucykuZmlsdGVyKHF1YWxpdHkgPT4gdGhpcy5jb25maWcucXVhbGl0eS5vcHRpb25zLmluY2x1ZGVzKHF1YWxpdHkpKTtcbiAgICAgIH0gLy8gVG9nZ2xlIHRoZSBwYW5lIGFuZCB0YWJcblxuXG4gICAgICBjb25zdCB0b2dnbGUgPSAhaXMuZW1wdHkodGhpcy5vcHRpb25zLnF1YWxpdHkpICYmIHRoaXMub3B0aW9ucy5xdWFsaXR5Lmxlbmd0aCA+IDE7XG4gICAgICBjb250cm9scy50b2dnbGVNZW51QnV0dG9uLmNhbGwodGhpcywgdHlwZSwgdG9nZ2xlKTsgLy8gRW1wdHkgdGhlIG1lbnVcblxuICAgICAgZW1wdHlFbGVtZW50KGxpc3QpOyAvLyBDaGVjayBpZiB3ZSBuZWVkIHRvIHRvZ2dsZSB0aGUgcGFyZW50XG5cbiAgICAgIGNvbnRyb2xzLmNoZWNrTWVudS5jYWxsKHRoaXMpOyAvLyBJZiB3ZSdyZSBoaWRpbmcsIG5vdGhpbmcgbW9yZSB0byBkb1xuXG4gICAgICBpZiAoIXRvZ2dsZSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9IC8vIEdldCB0aGUgYmFkZ2UgSFRNTCBmb3IgSEQsIDRLIGV0Y1xuXG5cbiAgICAgIGNvbnN0IGdldEJhZGdlID0gcXVhbGl0eSA9PiB7XG4gICAgICAgIGNvbnN0IGxhYmVsID0gaTE4bi5nZXQoYHF1YWxpdHlCYWRnZS4ke3F1YWxpdHl9YCwgdGhpcy5jb25maWcpO1xuXG4gICAgICAgIGlmICghbGFiZWwubGVuZ3RoKSB7XG4gICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gY29udHJvbHMuY3JlYXRlQmFkZ2UuY2FsbCh0aGlzLCBsYWJlbCk7XG4gICAgICB9OyAvLyBTb3J0IG9wdGlvbnMgYnkgdGhlIGNvbmZpZyBhbmQgdGhlbiByZW5kZXIgb3B0aW9uc1xuXG5cbiAgICAgIHRoaXMub3B0aW9ucy5xdWFsaXR5LnNvcnQoKGEsIGIpID0+IHtcbiAgICAgICAgY29uc3Qgc29ydGluZyA9IHRoaXMuY29uZmlnLnF1YWxpdHkub3B0aW9ucztcbiAgICAgICAgcmV0dXJuIHNvcnRpbmcuaW5kZXhPZihhKSA+IHNvcnRpbmcuaW5kZXhPZihiKSA/IDEgOiAtMTtcbiAgICAgIH0pLmZvckVhY2gocXVhbGl0eSA9PiB7XG4gICAgICAgIGNvbnRyb2xzLmNyZWF0ZU1lbnVJdGVtLmNhbGwodGhpcywge1xuICAgICAgICAgIHZhbHVlOiBxdWFsaXR5LFxuICAgICAgICAgIGxpc3QsXG4gICAgICAgICAgdHlwZSxcbiAgICAgICAgICB0aXRsZTogY29udHJvbHMuZ2V0TGFiZWwuY2FsbCh0aGlzLCAncXVhbGl0eScsIHF1YWxpdHkpLFxuICAgICAgICAgIGJhZGdlOiBnZXRCYWRnZShxdWFsaXR5KVxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgICAgY29udHJvbHMudXBkYXRlU2V0dGluZy5jYWxsKHRoaXMsIHR5cGUsIGxpc3QpO1xuICAgIH0sXG5cbiAgICAvLyBTZXQgdGhlIGxvb3Bpbmcgb3B0aW9uc1xuXG4gICAgLyogc2V0TG9vcE1lbnUoKSB7XG4gICAgICAgICAgLy8gTWVudSByZXF1aXJlZFxuICAgICAgICAgIGlmICghaXMuZWxlbWVudCh0aGlzLmVsZW1lbnRzLnNldHRpbmdzLnBhbmVscy5sb29wKSkge1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgICBjb25zdCBvcHRpb25zID0gWydzdGFydCcsICdlbmQnLCAnYWxsJywgJ3Jlc2V0J107XG4gICAgICAgICAgY29uc3QgbGlzdCA9IHRoaXMuZWxlbWVudHMuc2V0dGluZ3MucGFuZWxzLmxvb3AucXVlcnlTZWxlY3RvcignW3JvbGU9XCJtZW51XCJdJyk7XG4gICAgICAgICAgIC8vIFNob3cgdGhlIHBhbmUgYW5kIHRhYlxuICAgICAgICAgIHRvZ2dsZUhpZGRlbih0aGlzLmVsZW1lbnRzLnNldHRpbmdzLmJ1dHRvbnMubG9vcCwgZmFsc2UpO1xuICAgICAgICAgIHRvZ2dsZUhpZGRlbih0aGlzLmVsZW1lbnRzLnNldHRpbmdzLnBhbmVscy5sb29wLCBmYWxzZSk7XG4gICAgICAgICAgIC8vIFRvZ2dsZSB0aGUgcGFuZSBhbmQgdGFiXG4gICAgICAgICAgY29uc3QgdG9nZ2xlID0gIWlzLmVtcHR5KHRoaXMubG9vcC5vcHRpb25zKTtcbiAgICAgICAgICBjb250cm9scy50b2dnbGVNZW51QnV0dG9uLmNhbGwodGhpcywgJ2xvb3AnLCB0b2dnbGUpO1xuICAgICAgICAgICAvLyBFbXB0eSB0aGUgbWVudVxuICAgICAgICAgIGVtcHR5RWxlbWVudChsaXN0KTtcbiAgICAgICAgICAgb3B0aW9ucy5mb3JFYWNoKG9wdGlvbiA9PiB7XG4gICAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSBjcmVhdGVFbGVtZW50KCdsaScpO1xuICAgICAgICAgICAgICAgY29uc3QgYnV0dG9uID0gY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICAgICdidXR0b24nLFxuICAgICAgICAgICAgICAgICAgZXh0ZW5kKGdldEF0dHJpYnV0ZXNGcm9tU2VsZWN0b3IodGhpcy5jb25maWcuc2VsZWN0b3JzLmJ1dHRvbnMubG9vcCksIHtcbiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnYnV0dG9uJyxcbiAgICAgICAgICAgICAgICAgICAgICBjbGFzczogdGhpcy5jb25maWcuY2xhc3NOYW1lcy5jb250cm9sLFxuICAgICAgICAgICAgICAgICAgICAgICdkYXRhLXBseXItbG9vcC1hY3Rpb24nOiBvcHRpb24sXG4gICAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICAgIGkxOG4uZ2V0KG9wdGlvbiwgdGhpcy5jb25maWcpXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICBpZiAoWydzdGFydCcsICdlbmQnXS5pbmNsdWRlcyhvcHRpb24pKSB7XG4gICAgICAgICAgICAgICAgICBjb25zdCBiYWRnZSA9IGNvbnRyb2xzLmNyZWF0ZUJhZGdlLmNhbGwodGhpcywgJzAwOjAwJyk7XG4gICAgICAgICAgICAgICAgICBidXR0b24uYXBwZW5kQ2hpbGQoYmFkZ2UpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICBpdGVtLmFwcGVuZENoaWxkKGJ1dHRvbik7XG4gICAgICAgICAgICAgIGxpc3QuYXBwZW5kQ2hpbGQoaXRlbSk7XG4gICAgICAgICAgfSk7XG4gICAgICB9LCAqL1xuICAgIC8vIEdldCBjdXJyZW50IHNlbGVjdGVkIGNhcHRpb24gbGFuZ3VhZ2VcbiAgICAvLyBUT0RPOiByZXdvcmsgdGhpcyB0byB1c2VyIHRoZSBnZXR0ZXIgaW4gdGhlIEFQST9cbiAgICAvLyBTZXQgYSBsaXN0IG9mIGF2YWlsYWJsZSBjYXB0aW9ucyBsYW5ndWFnZXNcbiAgICBzZXRDYXB0aW9uc01lbnUoKSB7XG4gICAgICAvLyBNZW51IHJlcXVpcmVkXG4gICAgICBpZiAoIWlzLmVsZW1lbnQodGhpcy5lbGVtZW50cy5zZXR0aW5ncy5wYW5lbHMuY2FwdGlvbnMpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH0gLy8gVE9ETzogQ2FwdGlvbnMgb3IgbGFuZ3VhZ2U/IEN1cnJlbnRseSBpdCdzIG1peGVkXG5cblxuICAgICAgY29uc3QgdHlwZSA9ICdjYXB0aW9ucyc7XG4gICAgICBjb25zdCBsaXN0ID0gdGhpcy5lbGVtZW50cy5zZXR0aW5ncy5wYW5lbHMuY2FwdGlvbnMucXVlcnlTZWxlY3RvcignW3JvbGU9XCJtZW51XCJdJyk7XG4gICAgICBjb25zdCB0cmFja3MgPSBjYXB0aW9ucy5nZXRUcmFja3MuY2FsbCh0aGlzKTtcbiAgICAgIGNvbnN0IHRvZ2dsZSA9IEJvb2xlYW4odHJhY2tzLmxlbmd0aCk7IC8vIFRvZ2dsZSB0aGUgcGFuZSBhbmQgdGFiXG5cbiAgICAgIGNvbnRyb2xzLnRvZ2dsZU1lbnVCdXR0b24uY2FsbCh0aGlzLCB0eXBlLCB0b2dnbGUpOyAvLyBFbXB0eSB0aGUgbWVudVxuXG4gICAgICBlbXB0eUVsZW1lbnQobGlzdCk7IC8vIENoZWNrIGlmIHdlIG5lZWQgdG8gdG9nZ2xlIHRoZSBwYXJlbnRcblxuICAgICAgY29udHJvbHMuY2hlY2tNZW51LmNhbGwodGhpcyk7IC8vIElmIHRoZXJlJ3Mgbm8gY2FwdGlvbnMsIGJhaWxcblxuICAgICAgaWYgKCF0b2dnbGUpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfSAvLyBHZW5lcmF0ZSBvcHRpb25zIGRhdGFcblxuXG4gICAgICBjb25zdCBvcHRpb25zID0gdHJhY2tzLm1hcCgodHJhY2ssIHZhbHVlKSA9PiAoe1xuICAgICAgICB2YWx1ZSxcbiAgICAgICAgY2hlY2tlZDogdGhpcy5jYXB0aW9ucy50b2dnbGVkICYmIHRoaXMuY3VycmVudFRyYWNrID09PSB2YWx1ZSxcbiAgICAgICAgdGl0bGU6IGNhcHRpb25zLmdldExhYmVsLmNhbGwodGhpcywgdHJhY2spLFxuICAgICAgICBiYWRnZTogdHJhY2subGFuZ3VhZ2UgJiYgY29udHJvbHMuY3JlYXRlQmFkZ2UuY2FsbCh0aGlzLCB0cmFjay5sYW5ndWFnZS50b1VwcGVyQ2FzZSgpKSxcbiAgICAgICAgbGlzdCxcbiAgICAgICAgdHlwZTogJ2xhbmd1YWdlJ1xuICAgICAgfSkpOyAvLyBBZGQgdGhlIFwiRGlzYWJsZWRcIiBvcHRpb24gdG8gdHVybiBvZmYgY2FwdGlvbnNcblxuICAgICAgb3B0aW9ucy51bnNoaWZ0KHtcbiAgICAgICAgdmFsdWU6IC0xLFxuICAgICAgICBjaGVja2VkOiAhdGhpcy5jYXB0aW9ucy50b2dnbGVkLFxuICAgICAgICB0aXRsZTogaTE4bi5nZXQoJ2Rpc2FibGVkJywgdGhpcy5jb25maWcpLFxuICAgICAgICBsaXN0LFxuICAgICAgICB0eXBlOiAnbGFuZ3VhZ2UnXG4gICAgICB9KTsgLy8gR2VuZXJhdGUgb3B0aW9uc1xuXG4gICAgICBvcHRpb25zLmZvckVhY2goY29udHJvbHMuY3JlYXRlTWVudUl0ZW0uYmluZCh0aGlzKSk7XG4gICAgICBjb250cm9scy51cGRhdGVTZXR0aW5nLmNhbGwodGhpcywgdHlwZSwgbGlzdCk7XG4gICAgfSxcblxuICAgIC8vIFNldCBhIGxpc3Qgb2YgYXZhaWxhYmxlIGNhcHRpb25zIGxhbmd1YWdlc1xuICAgIHNldFNwZWVkTWVudSgpIHtcbiAgICAgIC8vIE1lbnUgcmVxdWlyZWRcbiAgICAgIGlmICghaXMuZWxlbWVudCh0aGlzLmVsZW1lbnRzLnNldHRpbmdzLnBhbmVscy5zcGVlZCkpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjb25zdCB0eXBlID0gJ3NwZWVkJztcbiAgICAgIGNvbnN0IGxpc3QgPSB0aGlzLmVsZW1lbnRzLnNldHRpbmdzLnBhbmVscy5zcGVlZC5xdWVyeVNlbGVjdG9yKCdbcm9sZT1cIm1lbnVcIl0nKTsgLy8gRmlsdGVyIG91dCBpbnZhbGlkIHNwZWVkc1xuXG4gICAgICB0aGlzLm9wdGlvbnMuc3BlZWQgPSB0aGlzLm9wdGlvbnMuc3BlZWQuZmlsdGVyKG8gPT4gbyA+PSB0aGlzLm1pbmltdW1TcGVlZCAmJiBvIDw9IHRoaXMubWF4aW11bVNwZWVkKTsgLy8gVG9nZ2xlIHRoZSBwYW5lIGFuZCB0YWJcblxuICAgICAgY29uc3QgdG9nZ2xlID0gIWlzLmVtcHR5KHRoaXMub3B0aW9ucy5zcGVlZCkgJiYgdGhpcy5vcHRpb25zLnNwZWVkLmxlbmd0aCA+IDE7XG4gICAgICBjb250cm9scy50b2dnbGVNZW51QnV0dG9uLmNhbGwodGhpcywgdHlwZSwgdG9nZ2xlKTsgLy8gRW1wdHkgdGhlIG1lbnVcblxuICAgICAgZW1wdHlFbGVtZW50KGxpc3QpOyAvLyBDaGVjayBpZiB3ZSBuZWVkIHRvIHRvZ2dsZSB0aGUgcGFyZW50XG5cbiAgICAgIGNvbnRyb2xzLmNoZWNrTWVudS5jYWxsKHRoaXMpOyAvLyBJZiB3ZSdyZSBoaWRpbmcsIG5vdGhpbmcgbW9yZSB0byBkb1xuXG4gICAgICBpZiAoIXRvZ2dsZSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9IC8vIENyZWF0ZSBpdGVtc1xuXG5cbiAgICAgIHRoaXMub3B0aW9ucy5zcGVlZC5mb3JFYWNoKHNwZWVkID0+IHtcbiAgICAgICAgY29udHJvbHMuY3JlYXRlTWVudUl0ZW0uY2FsbCh0aGlzLCB7XG4gICAgICAgICAgdmFsdWU6IHNwZWVkLFxuICAgICAgICAgIGxpc3QsXG4gICAgICAgICAgdHlwZSxcbiAgICAgICAgICB0aXRsZTogY29udHJvbHMuZ2V0TGFiZWwuY2FsbCh0aGlzLCAnc3BlZWQnLCBzcGVlZClcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICAgIGNvbnRyb2xzLnVwZGF0ZVNldHRpbmcuY2FsbCh0aGlzLCB0eXBlLCBsaXN0KTtcbiAgICB9LFxuXG4gICAgLy8gQ2hlY2sgaWYgd2UgbmVlZCB0byBoaWRlL3Nob3cgdGhlIHNldHRpbmdzIG1lbnVcbiAgICBjaGVja01lbnUoKSB7XG4gICAgICBjb25zdCB7XG4gICAgICAgIGJ1dHRvbnNcbiAgICAgIH0gPSB0aGlzLmVsZW1lbnRzLnNldHRpbmdzO1xuICAgICAgY29uc3QgdmlzaWJsZSA9ICFpcy5lbXB0eShidXR0b25zKSAmJiBPYmplY3QudmFsdWVzKGJ1dHRvbnMpLnNvbWUoYnV0dG9uID0+ICFidXR0b24uaGlkZGVuKTtcbiAgICAgIHRvZ2dsZUhpZGRlbih0aGlzLmVsZW1lbnRzLnNldHRpbmdzLm1lbnUsICF2aXNpYmxlKTtcbiAgICB9LFxuXG4gICAgLy8gRm9jdXMgdGhlIGZpcnN0IG1lbnUgaXRlbSBpbiBhIGdpdmVuIChvciB2aXNpYmxlKSBtZW51XG4gICAgZm9jdXNGaXJzdE1lbnVJdGVtKHBhbmUsIHRhYkZvY3VzID0gZmFsc2UpIHtcbiAgICAgIGlmICh0aGlzLmVsZW1lbnRzLnNldHRpbmdzLnBvcHVwLmhpZGRlbikge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGxldCB0YXJnZXQgPSBwYW5lO1xuXG4gICAgICBpZiAoIWlzLmVsZW1lbnQodGFyZ2V0KSkge1xuICAgICAgICB0YXJnZXQgPSBPYmplY3QudmFsdWVzKHRoaXMuZWxlbWVudHMuc2V0dGluZ3MucGFuZWxzKS5maW5kKHAgPT4gIXAuaGlkZGVuKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgZmlyc3RJdGVtID0gdGFyZ2V0LnF1ZXJ5U2VsZWN0b3IoJ1tyb2xlXj1cIm1lbnVpdGVtXCJdJyk7XG4gICAgICBzZXRGb2N1cy5jYWxsKHRoaXMsIGZpcnN0SXRlbSwgdGFiRm9jdXMpO1xuICAgIH0sXG5cbiAgICAvLyBTaG93L2hpZGUgbWVudVxuICAgIHRvZ2dsZU1lbnUoaW5wdXQpIHtcbiAgICAgIGNvbnN0IHtcbiAgICAgICAgcG9wdXBcbiAgICAgIH0gPSB0aGlzLmVsZW1lbnRzLnNldHRpbmdzO1xuICAgICAgY29uc3QgYnV0dG9uID0gdGhpcy5lbGVtZW50cy5idXR0b25zLnNldHRpbmdzOyAvLyBNZW51IGFuZCBidXR0b24gYXJlIHJlcXVpcmVkXG5cbiAgICAgIGlmICghaXMuZWxlbWVudChwb3B1cCkgfHwgIWlzLmVsZW1lbnQoYnV0dG9uKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9IC8vIFRydWUgdG9nZ2xlIGJ5IGRlZmF1bHRcblxuXG4gICAgICBjb25zdCB7XG4gICAgICAgIGhpZGRlblxuICAgICAgfSA9IHBvcHVwO1xuICAgICAgbGV0IHNob3cgPSBoaWRkZW47XG5cbiAgICAgIGlmIChpcy5ib29sZWFuKGlucHV0KSkge1xuICAgICAgICBzaG93ID0gaW5wdXQ7XG4gICAgICB9IGVsc2UgaWYgKGlzLmtleWJvYXJkRXZlbnQoaW5wdXQpICYmIGlucHV0LmtleSA9PT0gJ0VzY2FwZScpIHtcbiAgICAgICAgc2hvdyA9IGZhbHNlO1xuICAgICAgfSBlbHNlIGlmIChpcy5ldmVudChpbnB1dCkpIHtcbiAgICAgICAgLy8gSWYgUGx5ciBpcyBpbiBhIHNoYWRvd0RPTSwgdGhlIGV2ZW50IHRhcmdldCBpcyBzZXQgdG8gdGhlIGNvbXBvbmVudCwgaW5zdGVhZCBvZiB0aGVcbiAgICAgICAgLy8gRWxlbWVudCBpbiB0aGUgc2hhZG93RE9NLiBUaGUgcGF0aCwgaWYgYXZhaWxhYmxlLCBpcyBjb21wbGV0ZS5cbiAgICAgICAgY29uc3QgdGFyZ2V0ID0gaXMuZnVuY3Rpb24oaW5wdXQuY29tcG9zZWRQYXRoKSA/IGlucHV0LmNvbXBvc2VkUGF0aCgpWzBdIDogaW5wdXQudGFyZ2V0O1xuICAgICAgICBjb25zdCBpc01lbnVJdGVtID0gcG9wdXAuY29udGFpbnModGFyZ2V0KTsgLy8gSWYgdGhlIGNsaWNrIHdhcyBpbnNpZGUgdGhlIG1lbnUgb3IgaWYgdGhlIGNsaWNrXG4gICAgICAgIC8vIHdhc24ndCB0aGUgYnV0dG9uIG9yIG1lbnUgaXRlbSBhbmQgd2UncmUgdHJ5aW5nIHRvXG4gICAgICAgIC8vIHNob3cgdGhlIG1lbnUgKGEgZG9jIGNsaWNrIHNob3VsZG4ndCBzaG93IHRoZSBtZW51KVxuXG4gICAgICAgIGlmIChpc01lbnVJdGVtIHx8ICFpc01lbnVJdGVtICYmIGlucHV0LnRhcmdldCAhPT0gYnV0dG9uICYmIHNob3cpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgIH0gLy8gU2V0IGJ1dHRvbiBhdHRyaWJ1dGVzXG5cblxuICAgICAgYnV0dG9uLnNldEF0dHJpYnV0ZSgnYXJpYS1leHBhbmRlZCcsIHNob3cpOyAvLyBTaG93IHRoZSBhY3R1YWwgcG9wdXBcblxuICAgICAgdG9nZ2xlSGlkZGVuKHBvcHVwLCAhc2hvdyk7IC8vIEFkZCBjbGFzcyBob29rXG5cbiAgICAgIHRvZ2dsZUNsYXNzKHRoaXMuZWxlbWVudHMuY29udGFpbmVyLCB0aGlzLmNvbmZpZy5jbGFzc05hbWVzLm1lbnUub3Blbiwgc2hvdyk7IC8vIEZvY3VzIHRoZSBmaXJzdCBpdGVtIGlmIGtleSBpbnRlcmFjdGlvblxuXG4gICAgICBpZiAoc2hvdyAmJiBpcy5rZXlib2FyZEV2ZW50KGlucHV0KSkge1xuICAgICAgICBjb250cm9scy5mb2N1c0ZpcnN0TWVudUl0ZW0uY2FsbCh0aGlzLCBudWxsLCB0cnVlKTtcbiAgICAgIH0gZWxzZSBpZiAoIXNob3cgJiYgIWhpZGRlbikge1xuICAgICAgICAvLyBJZiBjbG9zaW5nLCByZS1mb2N1cyB0aGUgYnV0dG9uXG4gICAgICAgIHNldEZvY3VzLmNhbGwodGhpcywgYnV0dG9uLCBpcy5rZXlib2FyZEV2ZW50KGlucHV0KSk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIC8vIEdldCB0aGUgbmF0dXJhbCBzaXplIG9mIGEgbWVudSBwYW5lbFxuICAgIGdldE1lbnVTaXplKHRhYikge1xuICAgICAgY29uc3QgY2xvbmUgPSB0YWIuY2xvbmVOb2RlKHRydWUpO1xuICAgICAgY2xvbmUuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnO1xuICAgICAgY2xvbmUuc3R5bGUub3BhY2l0eSA9IDA7XG4gICAgICBjbG9uZS5yZW1vdmVBdHRyaWJ1dGUoJ2hpZGRlbicpOyAvLyBBcHBlbmQgdG8gcGFyZW50IHNvIHdlIGdldCB0aGUgXCJyZWFsXCIgc2l6ZVxuXG4gICAgICB0YWIucGFyZW50Tm9kZS5hcHBlbmRDaGlsZChjbG9uZSk7IC8vIEdldCB0aGUgc2l6ZXMgYmVmb3JlIHdlIHJlbW92ZVxuXG4gICAgICBjb25zdCB3aWR0aCA9IGNsb25lLnNjcm9sbFdpZHRoO1xuICAgICAgY29uc3QgaGVpZ2h0ID0gY2xvbmUuc2Nyb2xsSGVpZ2h0OyAvLyBSZW1vdmUgZnJvbSB0aGUgRE9NXG5cbiAgICAgIHJlbW92ZUVsZW1lbnQoY2xvbmUpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgd2lkdGgsXG4gICAgICAgIGhlaWdodFxuICAgICAgfTtcbiAgICB9LFxuXG4gICAgLy8gU2hvdyBhIHBhbmVsIGluIHRoZSBtZW51XG4gICAgc2hvd01lbnVQYW5lbCh0eXBlID0gJycsIHRhYkZvY3VzID0gZmFsc2UpIHtcbiAgICAgIGNvbnN0IHRhcmdldCA9IHRoaXMuZWxlbWVudHMuY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoYCNwbHlyLXNldHRpbmdzLSR7dGhpcy5pZH0tJHt0eXBlfWApOyAvLyBOb3RoaW5nIHRvIHNob3csIGJhaWxcblxuICAgICAgaWYgKCFpcy5lbGVtZW50KHRhcmdldCkpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfSAvLyBIaWRlIGFsbCBvdGhlciBwYW5lbHNcblxuXG4gICAgICBjb25zdCBjb250YWluZXIgPSB0YXJnZXQucGFyZW50Tm9kZTtcbiAgICAgIGNvbnN0IGN1cnJlbnQgPSBBcnJheS5mcm9tKGNvbnRhaW5lci5jaGlsZHJlbikuZmluZChub2RlID0+ICFub2RlLmhpZGRlbik7IC8vIElmIHdlIGNhbiBkbyBmYW5jeSBhbmltYXRpb25zLCB3ZSdsbCBhbmltYXRlIHRoZSBoZWlnaHQvd2lkdGhcblxuICAgICAgaWYgKHN1cHBvcnQudHJhbnNpdGlvbnMgJiYgIXN1cHBvcnQucmVkdWNlZE1vdGlvbikge1xuICAgICAgICAvLyBTZXQgdGhlIGN1cnJlbnQgd2lkdGggYXMgYSBiYXNlXG4gICAgICAgIGNvbnRhaW5lci5zdHlsZS53aWR0aCA9IGAke2N1cnJlbnQuc2Nyb2xsV2lkdGh9cHhgO1xuICAgICAgICBjb250YWluZXIuc3R5bGUuaGVpZ2h0ID0gYCR7Y3VycmVudC5zY3JvbGxIZWlnaHR9cHhgOyAvLyBHZXQgcG90ZW50aWFsIHNpemVzXG5cbiAgICAgICAgY29uc3Qgc2l6ZSA9IGNvbnRyb2xzLmdldE1lbnVTaXplLmNhbGwodGhpcywgdGFyZ2V0KTsgLy8gUmVzdG9yZSBhdXRvIGhlaWdodC93aWR0aFxuXG4gICAgICAgIGNvbnN0IHJlc3RvcmUgPSBldmVudCA9PiB7XG4gICAgICAgICAgLy8gV2UncmUgb25seSBib3RoZXJlZCBhYm91dCBoZWlnaHQgYW5kIHdpZHRoIG9uIHRoZSBjb250YWluZXJcbiAgICAgICAgICBpZiAoZXZlbnQudGFyZ2V0ICE9PSBjb250YWluZXIgfHwgIVsnd2lkdGgnLCAnaGVpZ2h0J10uaW5jbHVkZXMoZXZlbnQucHJvcGVydHlOYW1lKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH0gLy8gUmV2ZXJ0IGJhY2sgdG8gYXV0b1xuXG5cbiAgICAgICAgICBjb250YWluZXIuc3R5bGUud2lkdGggPSAnJztcbiAgICAgICAgICBjb250YWluZXIuc3R5bGUuaGVpZ2h0ID0gJyc7IC8vIE9ubHkgbGlzdGVuIG9uY2VcblxuICAgICAgICAgIG9mZi5jYWxsKHRoaXMsIGNvbnRhaW5lciwgdHJhbnNpdGlvbkVuZEV2ZW50LCByZXN0b3JlKTtcbiAgICAgICAgfTsgLy8gTGlzdGVuIGZvciB0aGUgdHJhbnNpdGlvbiBmaW5pc2hpbmcgYW5kIHJlc3RvcmUgYXV0byBoZWlnaHQvd2lkdGhcblxuXG4gICAgICAgIG9uLmNhbGwodGhpcywgY29udGFpbmVyLCB0cmFuc2l0aW9uRW5kRXZlbnQsIHJlc3RvcmUpOyAvLyBTZXQgZGltZW5zaW9ucyB0byB0YXJnZXRcblxuICAgICAgICBjb250YWluZXIuc3R5bGUud2lkdGggPSBgJHtzaXplLndpZHRofXB4YDtcbiAgICAgICAgY29udGFpbmVyLnN0eWxlLmhlaWdodCA9IGAke3NpemUuaGVpZ2h0fXB4YDtcbiAgICAgIH0gLy8gU2V0IGF0dHJpYnV0ZXMgb24gY3VycmVudCB0YWJcblxuXG4gICAgICB0b2dnbGVIaWRkZW4oY3VycmVudCwgdHJ1ZSk7IC8vIFNldCBhdHRyaWJ1dGVzIG9uIHRhcmdldFxuXG4gICAgICB0b2dnbGVIaWRkZW4odGFyZ2V0LCBmYWxzZSk7IC8vIEZvY3VzIHRoZSBmaXJzdCBpdGVtXG5cbiAgICAgIGNvbnRyb2xzLmZvY3VzRmlyc3RNZW51SXRlbS5jYWxsKHRoaXMsIHRhcmdldCwgdGFiRm9jdXMpO1xuICAgIH0sXG5cbiAgICAvLyBTZXQgdGhlIGRvd25sb2FkIFVSTFxuICAgIHNldERvd25sb2FkVXJsKCkge1xuICAgICAgY29uc3QgYnV0dG9uID0gdGhpcy5lbGVtZW50cy5idXR0b25zLmRvd25sb2FkOyAvLyBCYWlsIGlmIG5vIGJ1dHRvblxuXG4gICAgICBpZiAoIWlzLmVsZW1lbnQoYnV0dG9uKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9IC8vIFNldCBhdHRyaWJ1dGVcblxuXG4gICAgICBidXR0b24uc2V0QXR0cmlidXRlKCdocmVmJywgdGhpcy5kb3dubG9hZCk7XG4gICAgfSxcblxuICAgIC8vIEJ1aWxkIHRoZSBkZWZhdWx0IEhUTUxcbiAgICBjcmVhdGUoZGF0YSkge1xuICAgICAgY29uc3Qge1xuICAgICAgICBiaW5kTWVudUl0ZW1TaG9ydGN1dHMsXG4gICAgICAgIGNyZWF0ZUJ1dHRvbixcbiAgICAgICAgY3JlYXRlUHJvZ3Jlc3MsXG4gICAgICAgIGNyZWF0ZVJhbmdlLFxuICAgICAgICBjcmVhdGVUaW1lLFxuICAgICAgICBzZXRRdWFsaXR5TWVudSxcbiAgICAgICAgc2V0U3BlZWRNZW51LFxuICAgICAgICBzaG93TWVudVBhbmVsXG4gICAgICB9ID0gY29udHJvbHM7XG4gICAgICB0aGlzLmVsZW1lbnRzLmNvbnRyb2xzID0gbnVsbDsgLy8gTGFyZ2VyIG92ZXJsYWlkIHBsYXkgYnV0dG9uXG5cbiAgICAgIGlmIChpcy5hcnJheSh0aGlzLmNvbmZpZy5jb250cm9scykgJiYgdGhpcy5jb25maWcuY29udHJvbHMuaW5jbHVkZXMoJ3BsYXktbGFyZ2UnKSkge1xuICAgICAgICB0aGlzLmVsZW1lbnRzLmNvbnRhaW5lci5hcHBlbmRDaGlsZChjcmVhdGVCdXR0b24uY2FsbCh0aGlzLCAncGxheS1sYXJnZScpKTtcbiAgICAgIH0gLy8gQ3JlYXRlIHRoZSBjb250YWluZXJcblxuXG4gICAgICBjb25zdCBjb250YWluZXIgPSBjcmVhdGVFbGVtZW50KCdkaXYnLCBnZXRBdHRyaWJ1dGVzRnJvbVNlbGVjdG9yKHRoaXMuY29uZmlnLnNlbGVjdG9ycy5jb250cm9scy53cmFwcGVyKSk7XG4gICAgICB0aGlzLmVsZW1lbnRzLmNvbnRyb2xzID0gY29udGFpbmVyOyAvLyBEZWZhdWx0IGl0ZW0gYXR0cmlidXRlc1xuXG4gICAgICBjb25zdCBkZWZhdWx0QXR0cmlidXRlcyA9IHtcbiAgICAgICAgY2xhc3M6ICdwbHlyX19jb250cm9sc19faXRlbSdcbiAgICAgIH07IC8vIExvb3AgdGhyb3VnaCBjb250cm9scyBpbiBvcmRlclxuXG4gICAgICBkZWR1cGUoaXMuYXJyYXkodGhpcy5jb25maWcuY29udHJvbHMpID8gdGhpcy5jb25maWcuY29udHJvbHMgOiBbXSkuZm9yRWFjaChjb250cm9sID0+IHtcbiAgICAgICAgLy8gUmVzdGFydCBidXR0b25cbiAgICAgICAgaWYgKGNvbnRyb2wgPT09ICdyZXN0YXJ0Jykge1xuICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChjcmVhdGVCdXR0b24uY2FsbCh0aGlzLCAncmVzdGFydCcsIGRlZmF1bHRBdHRyaWJ1dGVzKSk7XG4gICAgICAgIH0gLy8gUmV3aW5kIGJ1dHRvblxuXG5cbiAgICAgICAgaWYgKGNvbnRyb2wgPT09ICdyZXdpbmQnKSB7XG4gICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGNyZWF0ZUJ1dHRvbi5jYWxsKHRoaXMsICdyZXdpbmQnLCBkZWZhdWx0QXR0cmlidXRlcykpO1xuICAgICAgICB9IC8vIFBsYXkvUGF1c2UgYnV0dG9uXG5cblxuICAgICAgICBpZiAoY29udHJvbCA9PT0gJ3BsYXknKSB7XG4gICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGNyZWF0ZUJ1dHRvbi5jYWxsKHRoaXMsICdwbGF5JywgZGVmYXVsdEF0dHJpYnV0ZXMpKTtcbiAgICAgICAgfSAvLyBGYXN0IGZvcndhcmQgYnV0dG9uXG5cblxuICAgICAgICBpZiAoY29udHJvbCA9PT0gJ2Zhc3QtZm9yd2FyZCcpIHtcbiAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoY3JlYXRlQnV0dG9uLmNhbGwodGhpcywgJ2Zhc3QtZm9yd2FyZCcsIGRlZmF1bHRBdHRyaWJ1dGVzKSk7XG4gICAgICAgIH0gLy8gUHJvZ3Jlc3NcblxuXG4gICAgICAgIGlmIChjb250cm9sID09PSAncHJvZ3Jlc3MnKSB7XG4gICAgICAgICAgY29uc3QgcHJvZ3Jlc3NDb250YWluZXIgPSBjcmVhdGVFbGVtZW50KCdkaXYnLCB7XG4gICAgICAgICAgICBjbGFzczogYCR7ZGVmYXVsdEF0dHJpYnV0ZXMuY2xhc3N9IHBseXJfX3Byb2dyZXNzX19jb250YWluZXJgXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgY29uc3QgcHJvZ3Jlc3MgPSBjcmVhdGVFbGVtZW50KCdkaXYnLCBnZXRBdHRyaWJ1dGVzRnJvbVNlbGVjdG9yKHRoaXMuY29uZmlnLnNlbGVjdG9ycy5wcm9ncmVzcykpOyAvLyBTZWVrIHJhbmdlIHNsaWRlclxuXG4gICAgICAgICAgcHJvZ3Jlc3MuYXBwZW5kQ2hpbGQoY3JlYXRlUmFuZ2UuY2FsbCh0aGlzLCAnc2VlaycsIHtcbiAgICAgICAgICAgIGlkOiBgcGx5ci1zZWVrLSR7ZGF0YS5pZH1gXG4gICAgICAgICAgfSkpOyAvLyBCdWZmZXIgcHJvZ3Jlc3NcblxuICAgICAgICAgIHByb2dyZXNzLmFwcGVuZENoaWxkKGNyZWF0ZVByb2dyZXNzLmNhbGwodGhpcywgJ2J1ZmZlcicpKTsgLy8gVE9ETzogQWRkIGxvb3AgZGlzcGxheSBpbmRpY2F0b3JcbiAgICAgICAgICAvLyBTZWVrIHRvb2x0aXBcblxuICAgICAgICAgIGlmICh0aGlzLmNvbmZpZy50b29sdGlwcy5zZWVrKSB7XG4gICAgICAgICAgICBjb25zdCB0b29sdGlwID0gY3JlYXRlRWxlbWVudCgnc3BhbicsIHtcbiAgICAgICAgICAgICAgY2xhc3M6IHRoaXMuY29uZmlnLmNsYXNzTmFtZXMudG9vbHRpcFxuICAgICAgICAgICAgfSwgJzAwOjAwJyk7XG4gICAgICAgICAgICBwcm9ncmVzcy5hcHBlbmRDaGlsZCh0b29sdGlwKTtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudHMuZGlzcGxheS5zZWVrVG9vbHRpcCA9IHRvb2x0aXA7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdGhpcy5lbGVtZW50cy5wcm9ncmVzcyA9IHByb2dyZXNzO1xuICAgICAgICAgIHByb2dyZXNzQ29udGFpbmVyLmFwcGVuZENoaWxkKHRoaXMuZWxlbWVudHMucHJvZ3Jlc3MpO1xuICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChwcm9ncmVzc0NvbnRhaW5lcik7XG4gICAgICAgIH0gLy8gTWVkaWEgY3VycmVudCB0aW1lIGRpc3BsYXlcblxuXG4gICAgICAgIGlmIChjb250cm9sID09PSAnY3VycmVudC10aW1lJykge1xuICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChjcmVhdGVUaW1lLmNhbGwodGhpcywgJ2N1cnJlbnRUaW1lJywgZGVmYXVsdEF0dHJpYnV0ZXMpKTtcbiAgICAgICAgfSAvLyBNZWRpYSBkdXJhdGlvbiBkaXNwbGF5XG5cblxuICAgICAgICBpZiAoY29udHJvbCA9PT0gJ2R1cmF0aW9uJykge1xuICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChjcmVhdGVUaW1lLmNhbGwodGhpcywgJ2R1cmF0aW9uJywgZGVmYXVsdEF0dHJpYnV0ZXMpKTtcbiAgICAgICAgfSAvLyBWb2x1bWUgY29udHJvbHNcblxuXG4gICAgICAgIGlmIChjb250cm9sID09PSAnbXV0ZScgfHwgY29udHJvbCA9PT0gJ3ZvbHVtZScpIHtcbiAgICAgICAgICBsZXQge1xuICAgICAgICAgICAgdm9sdW1lXG4gICAgICAgICAgfSA9IHRoaXMuZWxlbWVudHM7IC8vIENyZWF0ZSB0aGUgdm9sdW1lIGNvbnRhaW5lciBpZiBuZWVkZWRcblxuICAgICAgICAgIGlmICghaXMuZWxlbWVudCh2b2x1bWUpIHx8ICFjb250YWluZXIuY29udGFpbnModm9sdW1lKSkge1xuICAgICAgICAgICAgdm9sdW1lID0gY3JlYXRlRWxlbWVudCgnZGl2JywgZXh0ZW5kKHt9LCBkZWZhdWx0QXR0cmlidXRlcywge1xuICAgICAgICAgICAgICBjbGFzczogYCR7ZGVmYXVsdEF0dHJpYnV0ZXMuY2xhc3N9IHBseXJfX3ZvbHVtZWAudHJpbSgpXG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnRzLnZvbHVtZSA9IHZvbHVtZTtcbiAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZCh2b2x1bWUpO1xuICAgICAgICAgIH0gLy8gVG9nZ2xlIG11dGUgYnV0dG9uXG5cblxuICAgICAgICAgIGlmIChjb250cm9sID09PSAnbXV0ZScpIHtcbiAgICAgICAgICAgIHZvbHVtZS5hcHBlbmRDaGlsZChjcmVhdGVCdXR0b24uY2FsbCh0aGlzLCAnbXV0ZScpKTtcbiAgICAgICAgICB9IC8vIFZvbHVtZSByYW5nZSBjb250cm9sXG4gICAgICAgICAgLy8gSWdub3JlZCBvbiBpT1MgYXMgaXQncyBoYW5kbGVkIGdsb2JhbGx5XG4gICAgICAgICAgLy8gaHR0cHM6Ly9kZXZlbG9wZXIuYXBwbGUuY29tL2xpYnJhcnkvc2FmYXJpL2RvY3VtZW50YXRpb24vQXVkaW9WaWRlby9Db25jZXB0dWFsL1VzaW5nX0hUTUw1X0F1ZGlvX1ZpZGVvL0RldmljZS1TcGVjaWZpY0NvbnNpZGVyYXRpb25zL0RldmljZS1TcGVjaWZpY0NvbnNpZGVyYXRpb25zLmh0bWxcblxuXG4gICAgICAgICAgaWYgKGNvbnRyb2wgPT09ICd2b2x1bWUnICYmICFicm93c2VyLmlzSW9zKSB7XG4gICAgICAgICAgICAvLyBTZXQgdGhlIGF0dHJpYnV0ZXNcbiAgICAgICAgICAgIGNvbnN0IGF0dHJpYnV0ZXMgPSB7XG4gICAgICAgICAgICAgIG1heDogMSxcbiAgICAgICAgICAgICAgc3RlcDogMC4wNSxcbiAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuY29uZmlnLnZvbHVtZVxuICAgICAgICAgICAgfTsgLy8gQ3JlYXRlIHRoZSB2b2x1bWUgcmFuZ2Ugc2xpZGVyXG5cbiAgICAgICAgICAgIHZvbHVtZS5hcHBlbmRDaGlsZChjcmVhdGVSYW5nZS5jYWxsKHRoaXMsICd2b2x1bWUnLCBleHRlbmQoYXR0cmlidXRlcywge1xuICAgICAgICAgICAgICBpZDogYHBseXItdm9sdW1lLSR7ZGF0YS5pZH1gXG4gICAgICAgICAgICB9KSkpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSAvLyBUb2dnbGUgY2FwdGlvbnMgYnV0dG9uXG5cblxuICAgICAgICBpZiAoY29udHJvbCA9PT0gJ2NhcHRpb25zJykge1xuICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChjcmVhdGVCdXR0b24uY2FsbCh0aGlzLCAnY2FwdGlvbnMnLCBkZWZhdWx0QXR0cmlidXRlcykpO1xuICAgICAgICB9IC8vIFNldHRpbmdzIGJ1dHRvbiAvIG1lbnVcblxuXG4gICAgICAgIGlmIChjb250cm9sID09PSAnc2V0dGluZ3MnICYmICFpcy5lbXB0eSh0aGlzLmNvbmZpZy5zZXR0aW5ncykpIHtcbiAgICAgICAgICBjb25zdCB3cmFwcGVyID0gY3JlYXRlRWxlbWVudCgnZGl2JywgZXh0ZW5kKHt9LCBkZWZhdWx0QXR0cmlidXRlcywge1xuICAgICAgICAgICAgY2xhc3M6IGAke2RlZmF1bHRBdHRyaWJ1dGVzLmNsYXNzfSBwbHlyX19tZW51YC50cmltKCksXG4gICAgICAgICAgICBoaWRkZW46ICcnXG4gICAgICAgICAgfSkpO1xuICAgICAgICAgIHdyYXBwZXIuYXBwZW5kQ2hpbGQoY3JlYXRlQnV0dG9uLmNhbGwodGhpcywgJ3NldHRpbmdzJywge1xuICAgICAgICAgICAgJ2FyaWEtaGFzcG9wdXAnOiB0cnVlLFxuICAgICAgICAgICAgJ2FyaWEtY29udHJvbHMnOiBgcGx5ci1zZXR0aW5ncy0ke2RhdGEuaWR9YCxcbiAgICAgICAgICAgICdhcmlhLWV4cGFuZGVkJzogZmFsc2VcbiAgICAgICAgICB9KSk7XG4gICAgICAgICAgY29uc3QgcG9wdXAgPSBjcmVhdGVFbGVtZW50KCdkaXYnLCB7XG4gICAgICAgICAgICBjbGFzczogJ3BseXJfX21lbnVfX2NvbnRhaW5lcicsXG4gICAgICAgICAgICBpZDogYHBseXItc2V0dGluZ3MtJHtkYXRhLmlkfWAsXG4gICAgICAgICAgICBoaWRkZW46ICcnXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgY29uc3QgaW5uZXIgPSBjcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICBjb25zdCBob21lID0gY3JlYXRlRWxlbWVudCgnZGl2Jywge1xuICAgICAgICAgICAgaWQ6IGBwbHlyLXNldHRpbmdzLSR7ZGF0YS5pZH0taG9tZWBcbiAgICAgICAgICB9KTsgLy8gQ3JlYXRlIHRoZSBtZW51XG5cbiAgICAgICAgICBjb25zdCBtZW51ID0gY3JlYXRlRWxlbWVudCgnZGl2Jywge1xuICAgICAgICAgICAgcm9sZTogJ21lbnUnXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgaG9tZS5hcHBlbmRDaGlsZChtZW51KTtcbiAgICAgICAgICBpbm5lci5hcHBlbmRDaGlsZChob21lKTtcbiAgICAgICAgICB0aGlzLmVsZW1lbnRzLnNldHRpbmdzLnBhbmVscy5ob21lID0gaG9tZTsgLy8gQnVpbGQgdGhlIG1lbnUgaXRlbXNcblxuICAgICAgICAgIHRoaXMuY29uZmlnLnNldHRpbmdzLmZvckVhY2godHlwZSA9PiB7XG4gICAgICAgICAgICAvLyBUT0RPOiBidW5kbGUgdGhpcyB3aXRoIHRoZSBjcmVhdGVNZW51SXRlbSBoZWxwZXIgYW5kIGJpbmRpbmdzXG4gICAgICAgICAgICBjb25zdCBtZW51SXRlbSA9IGNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicsIGV4dGVuZChnZXRBdHRyaWJ1dGVzRnJvbVNlbGVjdG9yKHRoaXMuY29uZmlnLnNlbGVjdG9ycy5idXR0b25zLnNldHRpbmdzKSwge1xuICAgICAgICAgICAgICB0eXBlOiAnYnV0dG9uJyxcbiAgICAgICAgICAgICAgY2xhc3M6IGAke3RoaXMuY29uZmlnLmNsYXNzTmFtZXMuY29udHJvbH0gJHt0aGlzLmNvbmZpZy5jbGFzc05hbWVzLmNvbnRyb2x9LS1mb3J3YXJkYCxcbiAgICAgICAgICAgICAgcm9sZTogJ21lbnVpdGVtJyxcbiAgICAgICAgICAgICAgJ2FyaWEtaGFzcG9wdXAnOiB0cnVlLFxuICAgICAgICAgICAgICBoaWRkZW46ICcnXG4gICAgICAgICAgICB9KSk7IC8vIEJpbmQgbWVudSBzaG9ydGN1dHMgZm9yIGtleWJvYXJkIHVzZXJzXG5cbiAgICAgICAgICAgIGJpbmRNZW51SXRlbVNob3J0Y3V0cy5jYWxsKHRoaXMsIG1lbnVJdGVtLCB0eXBlKTsgLy8gU2hvdyBtZW51IG9uIGNsaWNrXG5cbiAgICAgICAgICAgIG9uLmNhbGwodGhpcywgbWVudUl0ZW0sICdjbGljaycsICgpID0+IHtcbiAgICAgICAgICAgICAgc2hvd01lbnVQYW5lbC5jYWxsKHRoaXMsIHR5cGUsIGZhbHNlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY29uc3QgZmxleCA9IGNyZWF0ZUVsZW1lbnQoJ3NwYW4nLCBudWxsLCBpMThuLmdldCh0eXBlLCB0aGlzLmNvbmZpZykpO1xuICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBjcmVhdGVFbGVtZW50KCdzcGFuJywge1xuICAgICAgICAgICAgICBjbGFzczogdGhpcy5jb25maWcuY2xhc3NOYW1lcy5tZW51LnZhbHVlXG4gICAgICAgICAgICB9KTsgLy8gU3BlZWQgY29udGFpbnMgSFRNTCBlbnRpdGllc1xuXG4gICAgICAgICAgICB2YWx1ZS5pbm5lckhUTUwgPSBkYXRhW3R5cGVdO1xuICAgICAgICAgICAgZmxleC5hcHBlbmRDaGlsZCh2YWx1ZSk7XG4gICAgICAgICAgICBtZW51SXRlbS5hcHBlbmRDaGlsZChmbGV4KTtcbiAgICAgICAgICAgIG1lbnUuYXBwZW5kQ2hpbGQobWVudUl0ZW0pOyAvLyBCdWlsZCB0aGUgcGFuZXNcblxuICAgICAgICAgICAgY29uc3QgcGFuZSA9IGNyZWF0ZUVsZW1lbnQoJ2RpdicsIHtcbiAgICAgICAgICAgICAgaWQ6IGBwbHlyLXNldHRpbmdzLSR7ZGF0YS5pZH0tJHt0eXBlfWAsXG4gICAgICAgICAgICAgIGhpZGRlbjogJydcbiAgICAgICAgICAgIH0pOyAvLyBCYWNrIGJ1dHRvblxuXG4gICAgICAgICAgICBjb25zdCBiYWNrQnV0dG9uID0gY3JlYXRlRWxlbWVudCgnYnV0dG9uJywge1xuICAgICAgICAgICAgICB0eXBlOiAnYnV0dG9uJyxcbiAgICAgICAgICAgICAgY2xhc3M6IGAke3RoaXMuY29uZmlnLmNsYXNzTmFtZXMuY29udHJvbH0gJHt0aGlzLmNvbmZpZy5jbGFzc05hbWVzLmNvbnRyb2x9LS1iYWNrYFxuICAgICAgICAgICAgfSk7IC8vIFZpc2libGUgbGFiZWxcblxuICAgICAgICAgICAgYmFja0J1dHRvbi5hcHBlbmRDaGlsZChjcmVhdGVFbGVtZW50KCdzcGFuJywge1xuICAgICAgICAgICAgICAnYXJpYS1oaWRkZW4nOiB0cnVlXG4gICAgICAgICAgICB9LCBpMThuLmdldCh0eXBlLCB0aGlzLmNvbmZpZykpKTsgLy8gU2NyZWVuIHJlYWRlciBsYWJlbFxuXG4gICAgICAgICAgICBiYWNrQnV0dG9uLmFwcGVuZENoaWxkKGNyZWF0ZUVsZW1lbnQoJ3NwYW4nLCB7XG4gICAgICAgICAgICAgIGNsYXNzOiB0aGlzLmNvbmZpZy5jbGFzc05hbWVzLmhpZGRlblxuICAgICAgICAgICAgfSwgaTE4bi5nZXQoJ21lbnVCYWNrJywgdGhpcy5jb25maWcpKSk7IC8vIEdvIGJhY2sgdmlhIGtleWJvYXJkXG5cbiAgICAgICAgICAgIG9uLmNhbGwodGhpcywgcGFuZSwgJ2tleWRvd24nLCBldmVudCA9PiB7XG4gICAgICAgICAgICAgIGlmIChldmVudC5rZXkgIT09ICdBcnJvd0xlZnQnKSByZXR1cm47IC8vIFByZXZlbnQgc2Vla1xuXG4gICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOyAvLyBTaG93IHRoZSByZXNwZWN0aXZlIG1lbnVcblxuICAgICAgICAgICAgICBzaG93TWVudVBhbmVsLmNhbGwodGhpcywgJ2hvbWUnLCB0cnVlKTtcbiAgICAgICAgICAgIH0sIGZhbHNlKTsgLy8gR28gYmFjayB2aWEgYnV0dG9uIGNsaWNrXG5cbiAgICAgICAgICAgIG9uLmNhbGwodGhpcywgYmFja0J1dHRvbiwgJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgICAgICAgICBzaG93TWVudVBhbmVsLmNhbGwodGhpcywgJ2hvbWUnLCBmYWxzZSk7XG4gICAgICAgICAgICB9KTsgLy8gQWRkIHRvIHBhbmVcblxuICAgICAgICAgICAgcGFuZS5hcHBlbmRDaGlsZChiYWNrQnV0dG9uKTsgLy8gTWVudVxuXG4gICAgICAgICAgICBwYW5lLmFwcGVuZENoaWxkKGNyZWF0ZUVsZW1lbnQoJ2RpdicsIHtcbiAgICAgICAgICAgICAgcm9sZTogJ21lbnUnXG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICBpbm5lci5hcHBlbmRDaGlsZChwYW5lKTtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudHMuc2V0dGluZ3MuYnV0dG9uc1t0eXBlXSA9IG1lbnVJdGVtO1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50cy5zZXR0aW5ncy5wYW5lbHNbdHlwZV0gPSBwYW5lO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHBvcHVwLmFwcGVuZENoaWxkKGlubmVyKTtcbiAgICAgICAgICB3cmFwcGVyLmFwcGVuZENoaWxkKHBvcHVwKTtcbiAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQod3JhcHBlcik7XG4gICAgICAgICAgdGhpcy5lbGVtZW50cy5zZXR0aW5ncy5wb3B1cCA9IHBvcHVwO1xuICAgICAgICAgIHRoaXMuZWxlbWVudHMuc2V0dGluZ3MubWVudSA9IHdyYXBwZXI7XG4gICAgICAgIH0gLy8gUGljdHVyZSBpbiBwaWN0dXJlIGJ1dHRvblxuXG5cbiAgICAgICAgaWYgKGNvbnRyb2wgPT09ICdwaXAnICYmIHN1cHBvcnQucGlwKSB7XG4gICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGNyZWF0ZUJ1dHRvbi5jYWxsKHRoaXMsICdwaXAnLCBkZWZhdWx0QXR0cmlidXRlcykpO1xuICAgICAgICB9IC8vIEFpcnBsYXkgYnV0dG9uXG5cblxuICAgICAgICBpZiAoY29udHJvbCA9PT0gJ2FpcnBsYXknICYmIHN1cHBvcnQuYWlycGxheSkge1xuICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChjcmVhdGVCdXR0b24uY2FsbCh0aGlzLCAnYWlycGxheScsIGRlZmF1bHRBdHRyaWJ1dGVzKSk7XG4gICAgICAgIH0gLy8gRG93bmxvYWQgYnV0dG9uXG5cblxuICAgICAgICBpZiAoY29udHJvbCA9PT0gJ2Rvd25sb2FkJykge1xuICAgICAgICAgIGNvbnN0IGF0dHJpYnV0ZXMgPSBleHRlbmQoe30sIGRlZmF1bHRBdHRyaWJ1dGVzLCB7XG4gICAgICAgICAgICBlbGVtZW50OiAnYScsXG4gICAgICAgICAgICBocmVmOiB0aGlzLmRvd25sb2FkLFxuICAgICAgICAgICAgdGFyZ2V0OiAnX2JsYW5rJ1xuICAgICAgICAgIH0pOyAvLyBTZXQgZG93bmxvYWQgYXR0cmlidXRlIGZvciBIVE1MNSBvbmx5XG5cbiAgICAgICAgICBpZiAodGhpcy5pc0hUTUw1KSB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVzLmRvd25sb2FkID0gJyc7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgY29uc3Qge1xuICAgICAgICAgICAgZG93bmxvYWRcbiAgICAgICAgICB9ID0gdGhpcy5jb25maWcudXJscztcblxuICAgICAgICAgIGlmICghaXMudXJsKGRvd25sb2FkKSAmJiB0aGlzLmlzRW1iZWQpIHtcbiAgICAgICAgICAgIGV4dGVuZChhdHRyaWJ1dGVzLCB7XG4gICAgICAgICAgICAgIGljb246IGBsb2dvLSR7dGhpcy5wcm92aWRlcn1gLFxuICAgICAgICAgICAgICBsYWJlbDogdGhpcy5wcm92aWRlclxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGNyZWF0ZUJ1dHRvbi5jYWxsKHRoaXMsICdkb3dubG9hZCcsIGF0dHJpYnV0ZXMpKTtcbiAgICAgICAgfSAvLyBUb2dnbGUgZnVsbHNjcmVlbiBidXR0b25cblxuXG4gICAgICAgIGlmIChjb250cm9sID09PSAnZnVsbHNjcmVlbicpIHtcbiAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoY3JlYXRlQnV0dG9uLmNhbGwodGhpcywgJ2Z1bGxzY3JlZW4nLCBkZWZhdWx0QXR0cmlidXRlcykpO1xuICAgICAgICB9XG4gICAgICB9KTsgLy8gU2V0IGF2YWlsYWJsZSBxdWFsaXR5IGxldmVsc1xuXG4gICAgICBpZiAodGhpcy5pc0hUTUw1KSB7XG4gICAgICAgIHNldFF1YWxpdHlNZW51LmNhbGwodGhpcywgaHRtbDUuZ2V0UXVhbGl0eU9wdGlvbnMuY2FsbCh0aGlzKSk7XG4gICAgICB9XG5cbiAgICAgIHNldFNwZWVkTWVudS5jYWxsKHRoaXMpO1xuICAgICAgcmV0dXJuIGNvbnRhaW5lcjtcbiAgICB9LFxuXG4gICAgLy8gSW5zZXJ0IGNvbnRyb2xzXG4gICAgaW5qZWN0KCkge1xuICAgICAgLy8gU3ByaXRlXG4gICAgICBpZiAodGhpcy5jb25maWcubG9hZFNwcml0ZSkge1xuICAgICAgICBjb25zdCBpY29uID0gY29udHJvbHMuZ2V0SWNvblVybC5jYWxsKHRoaXMpOyAvLyBPbmx5IGxvYWQgZXh0ZXJuYWwgc3ByaXRlIHVzaW5nIEFKQVhcblxuICAgICAgICBpZiAoaWNvbi5jb3JzKSB7XG4gICAgICAgICAgbG9hZFNwcml0ZShpY29uLnVybCwgJ3Nwcml0ZS1wbHlyJyk7XG4gICAgICAgIH1cbiAgICAgIH0gLy8gQ3JlYXRlIGEgdW5pcXVlIElEXG5cblxuICAgICAgdGhpcy5pZCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMDAwKTsgLy8gTnVsbCBieSBkZWZhdWx0XG5cbiAgICAgIGxldCBjb250YWluZXIgPSBudWxsO1xuICAgICAgdGhpcy5lbGVtZW50cy5jb250cm9scyA9IG51bGw7IC8vIFNldCB0ZW1wbGF0ZSBwcm9wZXJ0aWVzXG5cbiAgICAgIGNvbnN0IHByb3BzID0ge1xuICAgICAgICBpZDogdGhpcy5pZCxcbiAgICAgICAgc2Vla3RpbWU6IHRoaXMuY29uZmlnLnNlZWtUaW1lLFxuICAgICAgICB0aXRsZTogdGhpcy5jb25maWcudGl0bGVcbiAgICAgIH07XG4gICAgICBsZXQgdXBkYXRlID0gdHJ1ZTsgLy8gSWYgZnVuY3Rpb24sIHJ1biBpdCBhbmQgdXNlIG91dHB1dFxuXG4gICAgICBpZiAoaXMuZnVuY3Rpb24odGhpcy5jb25maWcuY29udHJvbHMpKSB7XG4gICAgICAgIHRoaXMuY29uZmlnLmNvbnRyb2xzID0gdGhpcy5jb25maWcuY29udHJvbHMuY2FsbCh0aGlzLCBwcm9wcyk7XG4gICAgICB9IC8vIENvbnZlcnQgZmFsc3kgY29udHJvbHMgdG8gZW1wdHkgYXJyYXkgKHByaW1hcmlseSBmb3IgZW1wdHkgc3RyaW5ncylcblxuXG4gICAgICBpZiAoIXRoaXMuY29uZmlnLmNvbnRyb2xzKSB7XG4gICAgICAgIHRoaXMuY29uZmlnLmNvbnRyb2xzID0gW107XG4gICAgICB9XG5cbiAgICAgIGlmIChpcy5lbGVtZW50KHRoaXMuY29uZmlnLmNvbnRyb2xzKSB8fCBpcy5zdHJpbmcodGhpcy5jb25maWcuY29udHJvbHMpKSB7XG4gICAgICAgIC8vIEhUTUxFbGVtZW50IG9yIE5vbi1lbXB0eSBzdHJpbmcgcGFzc2VkIGFzIHRoZSBvcHRpb25cbiAgICAgICAgY29udGFpbmVyID0gdGhpcy5jb25maWcuY29udHJvbHM7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBDcmVhdGUgY29udHJvbHNcbiAgICAgICAgY29udGFpbmVyID0gY29udHJvbHMuY3JlYXRlLmNhbGwodGhpcywge1xuICAgICAgICAgIGlkOiB0aGlzLmlkLFxuICAgICAgICAgIHNlZWt0aW1lOiB0aGlzLmNvbmZpZy5zZWVrVGltZSxcbiAgICAgICAgICBzcGVlZDogdGhpcy5zcGVlZCxcbiAgICAgICAgICBxdWFsaXR5OiB0aGlzLnF1YWxpdHksXG4gICAgICAgICAgY2FwdGlvbnM6IGNhcHRpb25zLmdldExhYmVsLmNhbGwodGhpcykgLy8gVE9ETzogTG9vcGluZ1xuICAgICAgICAgIC8vIGxvb3A6ICdOb25lJyxcblxuICAgICAgICB9KTtcbiAgICAgICAgdXBkYXRlID0gZmFsc2U7XG4gICAgICB9IC8vIFJlcGxhY2UgcHJvcHMgd2l0aCB0aGVpciB2YWx1ZVxuXG5cbiAgICAgIGNvbnN0IHJlcGxhY2UgPSBpbnB1dCA9PiB7XG4gICAgICAgIGxldCByZXN1bHQgPSBpbnB1dDtcbiAgICAgICAgT2JqZWN0LmVudHJpZXMocHJvcHMpLmZvckVhY2goKFtrZXksIHZhbHVlXSkgPT4ge1xuICAgICAgICAgIHJlc3VsdCA9IHJlcGxhY2VBbGwocmVzdWx0LCBgeyR7a2V5fX1gLCB2YWx1ZSk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgfTsgLy8gVXBkYXRlIG1hcmt1cFxuXG5cbiAgICAgIGlmICh1cGRhdGUpIHtcbiAgICAgICAgaWYgKGlzLnN0cmluZyh0aGlzLmNvbmZpZy5jb250cm9scykpIHtcbiAgICAgICAgICBjb250YWluZXIgPSByZXBsYWNlKGNvbnRhaW5lcik7XG4gICAgICAgIH1cbiAgICAgIH0gLy8gQ29udHJvbHMgY29udGFpbmVyXG5cblxuICAgICAgbGV0IHRhcmdldDsgLy8gSW5qZWN0IHRvIGN1c3RvbSBsb2NhdGlvblxuXG4gICAgICBpZiAoaXMuc3RyaW5nKHRoaXMuY29uZmlnLnNlbGVjdG9ycy5jb250cm9scy5jb250YWluZXIpKSB7XG4gICAgICAgIHRhcmdldCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5jb25maWcuc2VsZWN0b3JzLmNvbnRyb2xzLmNvbnRhaW5lcik7XG4gICAgICB9IC8vIEluamVjdCBpbnRvIHRoZSBjb250YWluZXIgYnkgZGVmYXVsdFxuXG5cbiAgICAgIGlmICghaXMuZWxlbWVudCh0YXJnZXQpKSB7XG4gICAgICAgIHRhcmdldCA9IHRoaXMuZWxlbWVudHMuY29udGFpbmVyO1xuICAgICAgfSAvLyBJbmplY3QgY29udHJvbHMgSFRNTCAobmVlZHMgdG8gYmUgYmVmb3JlIGNhcHRpb25zLCBoZW5jZSBcImFmdGVyYmVnaW5cIilcblxuXG4gICAgICBjb25zdCBpbnNlcnRNZXRob2QgPSBpcy5lbGVtZW50KGNvbnRhaW5lcikgPyAnaW5zZXJ0QWRqYWNlbnRFbGVtZW50JyA6ICdpbnNlcnRBZGphY2VudEhUTUwnO1xuICAgICAgdGFyZ2V0W2luc2VydE1ldGhvZF0oJ2FmdGVyYmVnaW4nLCBjb250YWluZXIpOyAvLyBGaW5kIHRoZSBlbGVtZW50cyBpZiBuZWVkIGJlXG5cbiAgICAgIGlmICghaXMuZWxlbWVudCh0aGlzLmVsZW1lbnRzLmNvbnRyb2xzKSkge1xuICAgICAgICBjb250cm9scy5maW5kRWxlbWVudHMuY2FsbCh0aGlzKTtcbiAgICAgIH0gLy8gQWRkIHByZXNzZWQgcHJvcGVydHkgdG8gYnV0dG9uc1xuXG5cbiAgICAgIGlmICghaXMuZW1wdHkodGhpcy5lbGVtZW50cy5idXR0b25zKSkge1xuICAgICAgICBjb25zdCBhZGRQcm9wZXJ0eSA9IGJ1dHRvbiA9PiB7XG4gICAgICAgICAgY29uc3QgY2xhc3NOYW1lID0gdGhpcy5jb25maWcuY2xhc3NOYW1lcy5jb250cm9sUHJlc3NlZDtcbiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoYnV0dG9uLCAncHJlc3NlZCcsIHtcbiAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsXG5cbiAgICAgICAgICAgIGdldCgpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGhhc0NsYXNzKGJ1dHRvbiwgY2xhc3NOYW1lKTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIHNldChwcmVzc2VkID0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgdG9nZ2xlQ2xhc3MoYnV0dG9uLCBjbGFzc05hbWUsIHByZXNzZWQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgfSk7XG4gICAgICAgIH07IC8vIFRvZ2dsZSBjbGFzc25hbWUgd2hlbiBwcmVzc2VkIHByb3BlcnR5IGlzIHNldFxuXG5cbiAgICAgICAgT2JqZWN0LnZhbHVlcyh0aGlzLmVsZW1lbnRzLmJ1dHRvbnMpLmZpbHRlcihCb29sZWFuKS5mb3JFYWNoKGJ1dHRvbiA9PiB7XG4gICAgICAgICAgaWYgKGlzLmFycmF5KGJ1dHRvbikgfHwgaXMubm9kZUxpc3QoYnV0dG9uKSkge1xuICAgICAgICAgICAgQXJyYXkuZnJvbShidXR0b24pLmZpbHRlcihCb29sZWFuKS5mb3JFYWNoKGFkZFByb3BlcnR5KTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYWRkUHJvcGVydHkoYnV0dG9uKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSAvLyBFZGdlIHNvbWV0aW1lcyBkb2Vzbid0IGZpbmlzaCB0aGUgcGFpbnQgc28gZm9yY2UgYSByZXBhaW50XG5cblxuICAgICAgaWYgKGJyb3dzZXIuaXNFZGdlKSB7XG4gICAgICAgIHJlcGFpbnQodGFyZ2V0KTtcbiAgICAgIH0gLy8gU2V0dXAgdG9vbHRpcHNcblxuXG4gICAgICBpZiAodGhpcy5jb25maWcudG9vbHRpcHMuY29udHJvbHMpIHtcbiAgICAgICAgY29uc3Qge1xuICAgICAgICAgIGNsYXNzTmFtZXMsXG4gICAgICAgICAgc2VsZWN0b3JzXG4gICAgICAgIH0gPSB0aGlzLmNvbmZpZztcbiAgICAgICAgY29uc3Qgc2VsZWN0b3IgPSBgJHtzZWxlY3RvcnMuY29udHJvbHMud3JhcHBlcn0gJHtzZWxlY3RvcnMubGFiZWxzfSAuJHtjbGFzc05hbWVzLmhpZGRlbn1gO1xuICAgICAgICBjb25zdCBsYWJlbHMgPSBnZXRFbGVtZW50cy5jYWxsKHRoaXMsIHNlbGVjdG9yKTtcbiAgICAgICAgQXJyYXkuZnJvbShsYWJlbHMpLmZvckVhY2gobGFiZWwgPT4ge1xuICAgICAgICAgIHRvZ2dsZUNsYXNzKGxhYmVsLCB0aGlzLmNvbmZpZy5jbGFzc05hbWVzLmhpZGRlbiwgZmFsc2UpO1xuICAgICAgICAgIHRvZ2dsZUNsYXNzKGxhYmVsLCB0aGlzLmNvbmZpZy5jbGFzc05hbWVzLnRvb2x0aXAsIHRydWUpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgLy8gU2V0IG1lZGlhIG1ldGFkYXRhXG4gICAgc2V0TWVkaWFNZXRhZGF0YSgpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGlmICgnbWVkaWFTZXNzaW9uJyBpbiBuYXZpZ2F0b3IpIHtcbiAgICAgICAgICBuYXZpZ2F0b3IubWVkaWFTZXNzaW9uLm1ldGFkYXRhID0gbmV3IHdpbmRvdy5NZWRpYU1ldGFkYXRhKHtcbiAgICAgICAgICAgIHRpdGxlOiB0aGlzLmNvbmZpZy5tZWRpYU1ldGFkYXRhLnRpdGxlLFxuICAgICAgICAgICAgYXJ0aXN0OiB0aGlzLmNvbmZpZy5tZWRpYU1ldGFkYXRhLmFydGlzdCxcbiAgICAgICAgICAgIGFsYnVtOiB0aGlzLmNvbmZpZy5tZWRpYU1ldGFkYXRhLmFsYnVtLFxuICAgICAgICAgICAgYXJ0d29yazogdGhpcy5jb25maWcubWVkaWFNZXRhZGF0YS5hcnR3b3JrXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKF8pIHsvLyBEbyBub3RoaW5nXG4gICAgICB9XG4gICAgfSxcblxuICAgIC8vIEFkZCBtYXJrZXJzXG4gICAgc2V0TWFya2VycygpIHtcbiAgICAgIHZhciBfdGhpcyRjb25maWckbWFya2VyczIsIF90aGlzJGNvbmZpZyRtYXJrZXJzMztcblxuICAgICAgaWYgKCF0aGlzLmR1cmF0aW9uIHx8IHRoaXMuZWxlbWVudHMubWFya2VycykgcmV0dXJuOyAvLyBHZXQgdmFsaWQgcG9pbnRzXG5cbiAgICAgIGNvbnN0IHBvaW50cyA9IChfdGhpcyRjb25maWckbWFya2VyczIgPSB0aGlzLmNvbmZpZy5tYXJrZXJzKSA9PT0gbnVsbCB8fCBfdGhpcyRjb25maWckbWFya2VyczIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IChfdGhpcyRjb25maWckbWFya2VyczMgPSBfdGhpcyRjb25maWckbWFya2VyczIucG9pbnRzKSA9PT0gbnVsbCB8fCBfdGhpcyRjb25maWckbWFya2VyczMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF90aGlzJGNvbmZpZyRtYXJrZXJzMy5maWx0ZXIoKHtcbiAgICAgICAgdGltZVxuICAgICAgfSkgPT4gdGltZSA+IDAgJiYgdGltZSA8IHRoaXMuZHVyYXRpb24pO1xuICAgICAgaWYgKCEocG9pbnRzICE9PSBudWxsICYmIHBvaW50cyAhPT0gdm9pZCAwICYmIHBvaW50cy5sZW5ndGgpKSByZXR1cm47XG4gICAgICBjb25zdCBjb250YWluZXJGcmFnbWVudCA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcbiAgICAgIGNvbnN0IHBvaW50c0ZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xuICAgICAgbGV0IHRpcEVsZW1lbnQgPSBudWxsO1xuICAgICAgY29uc3QgdGlwVmlzaWJsZSA9IGAke3RoaXMuY29uZmlnLmNsYXNzTmFtZXMudG9vbHRpcH0tLXZpc2libGVgO1xuXG4gICAgICBjb25zdCB0b2dnbGVUaXAgPSBzaG93ID0+IHRvZ2dsZUNsYXNzKHRpcEVsZW1lbnQsIHRpcFZpc2libGUsIHNob3cpOyAvLyBJbmplY3QgbWFya2VycyB0byBwcm9ncmVzcyBjb250YWluZXJcblxuXG4gICAgICBwb2ludHMuZm9yRWFjaChwb2ludCA9PiB7XG4gICAgICAgIGNvbnN0IG1hcmtlckVsZW1lbnQgPSBjcmVhdGVFbGVtZW50KCdzcGFuJywge1xuICAgICAgICAgIGNsYXNzOiB0aGlzLmNvbmZpZy5jbGFzc05hbWVzLm1hcmtlclxuICAgICAgICB9LCAnJyk7XG4gICAgICAgIGNvbnN0IGxlZnQgPSBgJHtwb2ludC50aW1lIC8gdGhpcy5kdXJhdGlvbiAqIDEwMH0lYDtcblxuICAgICAgICBpZiAodGlwRWxlbWVudCkge1xuICAgICAgICAgIC8vIFNob3cgb24gaG92ZXJcbiAgICAgICAgICBtYXJrZXJFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZW50ZXInLCAoKSA9PiB7XG4gICAgICAgICAgICBpZiAocG9pbnQubGFiZWwpIHJldHVybjtcbiAgICAgICAgICAgIHRpcEVsZW1lbnQuc3R5bGUubGVmdCA9IGxlZnQ7XG4gICAgICAgICAgICB0aXBFbGVtZW50LmlubmVySFRNTCA9IHBvaW50LmxhYmVsO1xuICAgICAgICAgICAgdG9nZ2xlVGlwKHRydWUpO1xuICAgICAgICAgIH0pOyAvLyBIaWRlIG9uIGxlYXZlXG5cbiAgICAgICAgICBtYXJrZXJFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbGVhdmUnLCAoKSA9PiB7XG4gICAgICAgICAgICB0b2dnbGVUaXAoZmFsc2UpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgbWFya2VyRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgICAgICB0aGlzLmN1cnJlbnRUaW1lID0gcG9pbnQudGltZTtcbiAgICAgICAgfSk7XG4gICAgICAgIG1hcmtlckVsZW1lbnQuc3R5bGUubGVmdCA9IGxlZnQ7XG4gICAgICAgIHBvaW50c0ZyYWdtZW50LmFwcGVuZENoaWxkKG1hcmtlckVsZW1lbnQpO1xuICAgICAgfSk7XG4gICAgICBjb250YWluZXJGcmFnbWVudC5hcHBlbmRDaGlsZChwb2ludHNGcmFnbWVudCk7IC8vIEluamVjdCBhIHRvb2x0aXAgaWYgbmVlZGVkXG5cbiAgICAgIGlmICghdGhpcy5jb25maWcudG9vbHRpcHMuc2Vlaykge1xuICAgICAgICB0aXBFbGVtZW50ID0gY3JlYXRlRWxlbWVudCgnc3BhbicsIHtcbiAgICAgICAgICBjbGFzczogdGhpcy5jb25maWcuY2xhc3NOYW1lcy50b29sdGlwXG4gICAgICAgIH0sICcnKTtcbiAgICAgICAgY29udGFpbmVyRnJhZ21lbnQuYXBwZW5kQ2hpbGQodGlwRWxlbWVudCk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuZWxlbWVudHMubWFya2VycyA9IHtcbiAgICAgICAgcG9pbnRzOiBwb2ludHNGcmFnbWVudCxcbiAgICAgICAgdGlwOiB0aXBFbGVtZW50XG4gICAgICB9O1xuICAgICAgdGhpcy5lbGVtZW50cy5wcm9ncmVzcy5hcHBlbmRDaGlsZChjb250YWluZXJGcmFnbWVudCk7XG4gICAgfVxuXG4gIH07XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLyoqXG4gICAqIFBhcnNlIGEgc3RyaW5nIHRvIGEgVVJMIG9iamVjdFxuICAgKiBAcGFyYW0ge1N0cmluZ30gaW5wdXQgLSB0aGUgVVJMIHRvIGJlIHBhcnNlZFxuICAgKiBAcGFyYW0ge0Jvb2xlYW59IHNhZmUgLSBmYWlsc2FmZSBwYXJzaW5nXG4gICAqL1xuXG4gIGZ1bmN0aW9uIHBhcnNlVXJsKGlucHV0LCBzYWZlID0gdHJ1ZSkge1xuICAgIGxldCB1cmwgPSBpbnB1dDtcblxuICAgIGlmIChzYWZlKSB7XG4gICAgICBjb25zdCBwYXJzZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XG4gICAgICBwYXJzZXIuaHJlZiA9IHVybDtcbiAgICAgIHVybCA9IHBhcnNlci5ocmVmO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICByZXR1cm4gbmV3IFVSTCh1cmwpO1xuICAgIH0gY2F0Y2ggKF8pIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfSAvLyBDb252ZXJ0IG9iamVjdCB0byBVUkxTZWFyY2hQYXJhbXNcblxuICBmdW5jdGlvbiBidWlsZFVybFBhcmFtcyhpbnB1dCkge1xuICAgIGNvbnN0IHBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMoKTtcblxuICAgIGlmIChpcy5vYmplY3QoaW5wdXQpKSB7XG4gICAgICBPYmplY3QuZW50cmllcyhpbnB1dCkuZm9yRWFjaCgoW2tleSwgdmFsdWVdKSA9PiB7XG4gICAgICAgIHBhcmFtcy5zZXQoa2V5LCB2YWx1ZSk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gcGFyYW1zO1xuICB9XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgY29uc3QgY2FwdGlvbnMgPSB7XG4gICAgLy8gU2V0dXAgY2FwdGlvbnNcbiAgICBzZXR1cCgpIHtcbiAgICAgIC8vIFJlcXVpcmVzIFVJIHN1cHBvcnRcbiAgICAgIGlmICghdGhpcy5zdXBwb3J0ZWQudWkpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfSAvLyBPbmx5IFZpbWVvIGFuZCBIVE1MNSB2aWRlbyBzdXBwb3J0ZWQgYXQgdGhpcyBwb2ludFxuXG5cbiAgICAgIGlmICghdGhpcy5pc1ZpZGVvIHx8IHRoaXMuaXNZb3VUdWJlIHx8IHRoaXMuaXNIVE1MNSAmJiAhc3VwcG9ydC50ZXh0VHJhY2tzKSB7XG4gICAgICAgIC8vIENsZWFyIG1lbnUgYW5kIGhpZGVcbiAgICAgICAgaWYgKGlzLmFycmF5KHRoaXMuY29uZmlnLmNvbnRyb2xzKSAmJiB0aGlzLmNvbmZpZy5jb250cm9scy5pbmNsdWRlcygnc2V0dGluZ3MnKSAmJiB0aGlzLmNvbmZpZy5zZXR0aW5ncy5pbmNsdWRlcygnY2FwdGlvbnMnKSkge1xuICAgICAgICAgIGNvbnRyb2xzLnNldENhcHRpb25zTWVudS5jYWxsKHRoaXMpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuO1xuICAgICAgfSAvLyBJbmplY3QgdGhlIGNvbnRhaW5lclxuXG5cbiAgICAgIGlmICghaXMuZWxlbWVudCh0aGlzLmVsZW1lbnRzLmNhcHRpb25zKSkge1xuICAgICAgICB0aGlzLmVsZW1lbnRzLmNhcHRpb25zID0gY3JlYXRlRWxlbWVudCgnZGl2JywgZ2V0QXR0cmlidXRlc0Zyb21TZWxlY3Rvcih0aGlzLmNvbmZpZy5zZWxlY3RvcnMuY2FwdGlvbnMpKTtcbiAgICAgICAgaW5zZXJ0QWZ0ZXIodGhpcy5lbGVtZW50cy5jYXB0aW9ucywgdGhpcy5lbGVtZW50cy53cmFwcGVyKTtcbiAgICAgIH0gLy8gRml4IElFIGNhcHRpb25zIGlmIENPUlMgaXMgdXNlZFxuICAgICAgLy8gRmV0Y2ggY2FwdGlvbnMgYW5kIGluamVjdCBhcyBibG9icyBpbnN0ZWFkIChkYXRhIFVSSXMgbm90IHN1cHBvcnRlZCEpXG5cblxuICAgICAgaWYgKGJyb3dzZXIuaXNJRSAmJiB3aW5kb3cuVVJMKSB7XG4gICAgICAgIGNvbnN0IGVsZW1lbnRzID0gdGhpcy5tZWRpYS5xdWVyeVNlbGVjdG9yQWxsKCd0cmFjaycpO1xuICAgICAgICBBcnJheS5mcm9tKGVsZW1lbnRzKS5mb3JFYWNoKHRyYWNrID0+IHtcbiAgICAgICAgICBjb25zdCBzcmMgPSB0cmFjay5nZXRBdHRyaWJ1dGUoJ3NyYycpO1xuICAgICAgICAgIGNvbnN0IHVybCA9IHBhcnNlVXJsKHNyYyk7XG5cbiAgICAgICAgICBpZiAodXJsICE9PSBudWxsICYmIHVybC5ob3N0bmFtZSAhPT0gd2luZG93LmxvY2F0aW9uLmhyZWYuaG9zdG5hbWUgJiYgWydodHRwOicsICdodHRwczonXS5pbmNsdWRlcyh1cmwucHJvdG9jb2wpKSB7XG4gICAgICAgICAgICBmZXRjaChzcmMsICdibG9iJykudGhlbihibG9iID0+IHtcbiAgICAgICAgICAgICAgdHJhY2suc2V0QXR0cmlidXRlKCdzcmMnLCB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKSk7XG4gICAgICAgICAgICB9KS5jYXRjaCgoKSA9PiB7XG4gICAgICAgICAgICAgIHJlbW92ZUVsZW1lbnQodHJhY2spO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0gLy8gR2V0IGFuZCBzZXQgaW5pdGlhbCBkYXRhXG4gICAgICAvLyBUaGUgXCJwcmVmZXJyZWRcIiBvcHRpb25zIGFyZSBub3QgcmVhbGl6ZWQgdW5sZXNzIC8gdW50aWwgdGhlIHdhbnRlZCBsYW5ndWFnZSBoYXMgYSBtYXRjaFxuICAgICAgLy8gKiBsYW5ndWFnZXM6IEFycmF5IG9mIHVzZXIncyBicm93c2VyIGxhbmd1YWdlcy5cbiAgICAgIC8vICogbGFuZ3VhZ2U6ICBUaGUgbGFuZ3VhZ2UgcHJlZmVycmVkIGJ5IHVzZXIgc2V0dGluZ3Mgb3IgY29uZmlnXG4gICAgICAvLyAqIGFjdGl2ZTogICAgVGhlIHN0YXRlIHByZWZlcnJlZCBieSB1c2VyIHNldHRpbmdzIG9yIGNvbmZpZ1xuICAgICAgLy8gKiB0b2dnbGVkOiAgIFRoZSByZWFsIGNhcHRpb25zIHN0YXRlXG5cblxuICAgICAgY29uc3QgYnJvd3Nlckxhbmd1YWdlcyA9IG5hdmlnYXRvci5sYW5ndWFnZXMgfHwgW25hdmlnYXRvci5sYW5ndWFnZSB8fCBuYXZpZ2F0b3IudXNlckxhbmd1YWdlIHx8ICdlbiddO1xuICAgICAgY29uc3QgbGFuZ3VhZ2VzID0gZGVkdXBlKGJyb3dzZXJMYW5ndWFnZXMubWFwKGxhbmd1YWdlID0+IGxhbmd1YWdlLnNwbGl0KCctJylbMF0pKTtcbiAgICAgIGxldCBsYW5ndWFnZSA9ICh0aGlzLnN0b3JhZ2UuZ2V0KCdsYW5ndWFnZScpIHx8IHRoaXMuY29uZmlnLmNhcHRpb25zLmxhbmd1YWdlIHx8ICdhdXRvJykudG9Mb3dlckNhc2UoKTsgLy8gVXNlIGZpcnN0IGJyb3dzZXIgbGFuZ3VhZ2Ugd2hlbiBsYW5ndWFnZSBpcyAnYXV0bydcblxuICAgICAgaWYgKGxhbmd1YWdlID09PSAnYXV0bycpIHtcbiAgICAgICAgW2xhbmd1YWdlXSA9IGxhbmd1YWdlcztcbiAgICAgIH1cblxuICAgICAgbGV0IGFjdGl2ZSA9IHRoaXMuc3RvcmFnZS5nZXQoJ2NhcHRpb25zJyk7XG5cbiAgICAgIGlmICghaXMuYm9vbGVhbihhY3RpdmUpKSB7XG4gICAgICAgICh7XG4gICAgICAgICAgYWN0aXZlXG4gICAgICAgIH0gPSB0aGlzLmNvbmZpZy5jYXB0aW9ucyk7XG4gICAgICB9XG5cbiAgICAgIE9iamVjdC5hc3NpZ24odGhpcy5jYXB0aW9ucywge1xuICAgICAgICB0b2dnbGVkOiBmYWxzZSxcbiAgICAgICAgYWN0aXZlLFxuICAgICAgICBsYW5ndWFnZSxcbiAgICAgICAgbGFuZ3VhZ2VzXG4gICAgICB9KTsgLy8gV2F0Y2ggY2hhbmdlcyB0byB0ZXh0VHJhY2tzIGFuZCB1cGRhdGUgY2FwdGlvbnMgbWVudVxuXG4gICAgICBpZiAodGhpcy5pc0hUTUw1KSB7XG4gICAgICAgIGNvbnN0IHRyYWNrRXZlbnRzID0gdGhpcy5jb25maWcuY2FwdGlvbnMudXBkYXRlID8gJ2FkZHRyYWNrIHJlbW92ZXRyYWNrJyA6ICdyZW1vdmV0cmFjayc7XG4gICAgICAgIG9uLmNhbGwodGhpcywgdGhpcy5tZWRpYS50ZXh0VHJhY2tzLCB0cmFja0V2ZW50cywgY2FwdGlvbnMudXBkYXRlLmJpbmQodGhpcykpO1xuICAgICAgfSAvLyBVcGRhdGUgYXZhaWxhYmxlIGxhbmd1YWdlcyBpbiBsaXN0IG5leHQgdGljayAodGhlIGV2ZW50IG11c3Qgbm90IGJlIHRyaWdnZXJlZCBiZWZvcmUgdGhlIGxpc3RlbmVycylcblxuXG4gICAgICBzZXRUaW1lb3V0KGNhcHRpb25zLnVwZGF0ZS5iaW5kKHRoaXMpLCAwKTtcbiAgICB9LFxuXG4gICAgLy8gVXBkYXRlIGF2YWlsYWJsZSBsYW5ndWFnZSBvcHRpb25zIGluIHNldHRpbmdzIGJhc2VkIG9uIHRyYWNrc1xuICAgIHVwZGF0ZSgpIHtcbiAgICAgIGNvbnN0IHRyYWNrcyA9IGNhcHRpb25zLmdldFRyYWNrcy5jYWxsKHRoaXMsIHRydWUpOyAvLyBHZXQgdGhlIHdhbnRlZCBsYW5ndWFnZVxuXG4gICAgICBjb25zdCB7XG4gICAgICAgIGFjdGl2ZSxcbiAgICAgICAgbGFuZ3VhZ2UsXG4gICAgICAgIG1ldGEsXG4gICAgICAgIGN1cnJlbnRUcmFja05vZGVcbiAgICAgIH0gPSB0aGlzLmNhcHRpb25zO1xuICAgICAgY29uc3QgbGFuZ3VhZ2VFeGlzdHMgPSBCb29sZWFuKHRyYWNrcy5maW5kKHRyYWNrID0+IHRyYWNrLmxhbmd1YWdlID09PSBsYW5ndWFnZSkpOyAvLyBIYW5kbGUgdHJhY2tzIChhZGQgZXZlbnQgbGlzdGVuZXIgYW5kIFwicHNldWRvXCItZGVmYXVsdClcblxuICAgICAgaWYgKHRoaXMuaXNIVE1MNSAmJiB0aGlzLmlzVmlkZW8pIHtcbiAgICAgICAgdHJhY2tzLmZpbHRlcih0cmFjayA9PiAhbWV0YS5nZXQodHJhY2spKS5mb3JFYWNoKHRyYWNrID0+IHtcbiAgICAgICAgICB0aGlzLmRlYnVnLmxvZygnVHJhY2sgYWRkZWQnLCB0cmFjayk7IC8vIEF0dGVtcHQgdG8gc3RvcmUgaWYgdGhlIG9yaWdpbmFsIGRvbSBlbGVtZW50IHdhcyBcImRlZmF1bHRcIlxuXG4gICAgICAgICAgbWV0YS5zZXQodHJhY2ssIHtcbiAgICAgICAgICAgIGRlZmF1bHQ6IHRyYWNrLm1vZGUgPT09ICdzaG93aW5nJ1xuICAgICAgICAgIH0pOyAvLyBUdXJuIG9mZiBuYXRpdmUgY2FwdGlvbiByZW5kZXJpbmcgdG8gYXZvaWQgZG91YmxlIGNhcHRpb25zXG4gICAgICAgICAgLy8gTm90ZTogbW9kZT0naGlkZGVuJyBmb3JjZXMgYSB0cmFjayB0byBkb3dubG9hZC4gVG8gZW5zdXJlIGV2ZXJ5IHRyYWNrXG4gICAgICAgICAgLy8gaXNuJ3QgZG93bmxvYWRlZCBhdCBvbmNlLCBvbmx5ICdzaG93aW5nJyB0cmFja3Mgc2hvdWxkIGJlIHJlYXNzaWduZWRcbiAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcGFyYW0tcmVhc3NpZ25cblxuICAgICAgICAgIGlmICh0cmFjay5tb2RlID09PSAnc2hvd2luZycpIHtcbiAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1wYXJhbS1yZWFzc2lnblxuICAgICAgICAgICAgdHJhY2subW9kZSA9ICdoaWRkZW4nO1xuICAgICAgICAgIH0gLy8gQWRkIGV2ZW50IGxpc3RlbmVyIGZvciBjdWUgY2hhbmdlc1xuXG5cbiAgICAgICAgICBvbi5jYWxsKHRoaXMsIHRyYWNrLCAnY3VlY2hhbmdlJywgKCkgPT4gY2FwdGlvbnMudXBkYXRlQ3Vlcy5jYWxsKHRoaXMpKTtcbiAgICAgICAgfSk7XG4gICAgICB9IC8vIFVwZGF0ZSBsYW5ndWFnZSBmaXJzdCB0aW1lIGl0IG1hdGNoZXMsIG9yIGlmIHRoZSBwcmV2aW91cyBtYXRjaGluZyB0cmFjayB3YXMgcmVtb3ZlZFxuXG5cbiAgICAgIGlmIChsYW5ndWFnZUV4aXN0cyAmJiB0aGlzLmxhbmd1YWdlICE9PSBsYW5ndWFnZSB8fCAhdHJhY2tzLmluY2x1ZGVzKGN1cnJlbnRUcmFja05vZGUpKSB7XG4gICAgICAgIGNhcHRpb25zLnNldExhbmd1YWdlLmNhbGwodGhpcywgbGFuZ3VhZ2UpO1xuICAgICAgICBjYXB0aW9ucy50b2dnbGUuY2FsbCh0aGlzLCBhY3RpdmUgJiYgbGFuZ3VhZ2VFeGlzdHMpO1xuICAgICAgfSAvLyBFbmFibGUgb3IgZGlzYWJsZSBjYXB0aW9ucyBiYXNlZCBvbiB0cmFjayBsZW5ndGhcblxuXG4gICAgICBpZiAodGhpcy5lbGVtZW50cykge1xuICAgICAgICB0b2dnbGVDbGFzcyh0aGlzLmVsZW1lbnRzLmNvbnRhaW5lciwgdGhpcy5jb25maWcuY2xhc3NOYW1lcy5jYXB0aW9ucy5lbmFibGVkLCAhaXMuZW1wdHkodHJhY2tzKSk7XG4gICAgICB9IC8vIFVwZGF0ZSBhdmFpbGFibGUgbGFuZ3VhZ2VzIGluIGxpc3RcblxuXG4gICAgICBpZiAoaXMuYXJyYXkodGhpcy5jb25maWcuY29udHJvbHMpICYmIHRoaXMuY29uZmlnLmNvbnRyb2xzLmluY2x1ZGVzKCdzZXR0aW5ncycpICYmIHRoaXMuY29uZmlnLnNldHRpbmdzLmluY2x1ZGVzKCdjYXB0aW9ucycpKSB7XG4gICAgICAgIGNvbnRyb2xzLnNldENhcHRpb25zTWVudS5jYWxsKHRoaXMpO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICAvLyBUb2dnbGUgY2FwdGlvbnMgZGlzcGxheVxuICAgIC8vIFVzZWQgaW50ZXJuYWxseSBmb3IgdGhlIHRvZ2dsZUNhcHRpb25zIG1ldGhvZCwgd2l0aCB0aGUgcGFzc2l2ZSBvcHRpb24gZm9yY2VkIHRvIGZhbHNlXG4gICAgdG9nZ2xlKGlucHV0LCBwYXNzaXZlID0gdHJ1ZSkge1xuICAgICAgLy8gSWYgdGhlcmUncyBubyBmdWxsIHN1cHBvcnRcbiAgICAgIGlmICghdGhpcy5zdXBwb3J0ZWQudWkpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjb25zdCB7XG4gICAgICAgIHRvZ2dsZWRcbiAgICAgIH0gPSB0aGlzLmNhcHRpb25zOyAvLyBDdXJyZW50IHN0YXRlXG5cbiAgICAgIGNvbnN0IGFjdGl2ZUNsYXNzID0gdGhpcy5jb25maWcuY2xhc3NOYW1lcy5jYXB0aW9ucy5hY3RpdmU7IC8vIEdldCB0aGUgbmV4dCBzdGF0ZVxuICAgICAgLy8gSWYgdGhlIG1ldGhvZCBpcyBjYWxsZWQgd2l0aG91dCBwYXJhbWV0ZXIsIHRvZ2dsZSBiYXNlZCBvbiBjdXJyZW50IHZhbHVlXG5cbiAgICAgIGNvbnN0IGFjdGl2ZSA9IGlzLm51bGxPclVuZGVmaW5lZChpbnB1dCkgPyAhdG9nZ2xlZCA6IGlucHV0OyAvLyBVcGRhdGUgc3RhdGUgYW5kIHRyaWdnZXIgZXZlbnRcblxuICAgICAgaWYgKGFjdGl2ZSAhPT0gdG9nZ2xlZCkge1xuICAgICAgICAvLyBXaGVuIHBhc3NpdmUsIGRvbid0IG92ZXJyaWRlIHVzZXIgcHJlZmVyZW5jZXNcbiAgICAgICAgaWYgKCFwYXNzaXZlKSB7XG4gICAgICAgICAgdGhpcy5jYXB0aW9ucy5hY3RpdmUgPSBhY3RpdmU7XG4gICAgICAgICAgdGhpcy5zdG9yYWdlLnNldCh7XG4gICAgICAgICAgICBjYXB0aW9uczogYWN0aXZlXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gLy8gRm9yY2UgbGFuZ3VhZ2UgaWYgdGhlIGNhbGwgaXNuJ3QgcGFzc2l2ZSBhbmQgdGhlcmUgaXMgbm8gbWF0Y2hpbmcgbGFuZ3VhZ2UgdG8gdG9nZ2xlIHRvXG5cblxuICAgICAgICBpZiAoIXRoaXMubGFuZ3VhZ2UgJiYgYWN0aXZlICYmICFwYXNzaXZlKSB7XG4gICAgICAgICAgY29uc3QgdHJhY2tzID0gY2FwdGlvbnMuZ2V0VHJhY2tzLmNhbGwodGhpcyk7XG4gICAgICAgICAgY29uc3QgdHJhY2sgPSBjYXB0aW9ucy5maW5kVHJhY2suY2FsbCh0aGlzLCBbdGhpcy5jYXB0aW9ucy5sYW5ndWFnZSwgLi4udGhpcy5jYXB0aW9ucy5sYW5ndWFnZXNdLCB0cnVlKTsgLy8gT3ZlcnJpZGUgdXNlciBwcmVmZXJlbmNlcyB0byBhdm9pZCBzd2l0Y2hpbmcgbGFuZ3VhZ2VzIGlmIGEgbWF0Y2hpbmcgdHJhY2sgaXMgYWRkZWRcblxuICAgICAgICAgIHRoaXMuY2FwdGlvbnMubGFuZ3VhZ2UgPSB0cmFjay5sYW5ndWFnZTsgLy8gU2V0IGNhcHRpb24sIGJ1dCBkb24ndCBzdG9yZSBpbiBsb2NhbFN0b3JhZ2UgYXMgdXNlciBwcmVmZXJlbmNlXG5cbiAgICAgICAgICBjYXB0aW9ucy5zZXQuY2FsbCh0aGlzLCB0cmFja3MuaW5kZXhPZih0cmFjaykpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfSAvLyBUb2dnbGUgYnV0dG9uIGlmIGl0J3MgZW5hYmxlZFxuXG5cbiAgICAgICAgaWYgKHRoaXMuZWxlbWVudHMuYnV0dG9ucy5jYXB0aW9ucykge1xuICAgICAgICAgIHRoaXMuZWxlbWVudHMuYnV0dG9ucy5jYXB0aW9ucy5wcmVzc2VkID0gYWN0aXZlO1xuICAgICAgICB9IC8vIEFkZCBjbGFzcyBob29rXG5cblxuICAgICAgICB0b2dnbGVDbGFzcyh0aGlzLmVsZW1lbnRzLmNvbnRhaW5lciwgYWN0aXZlQ2xhc3MsIGFjdGl2ZSk7XG4gICAgICAgIHRoaXMuY2FwdGlvbnMudG9nZ2xlZCA9IGFjdGl2ZTsgLy8gVXBkYXRlIHNldHRpbmdzIG1lbnVcblxuICAgICAgICBjb250cm9scy51cGRhdGVTZXR0aW5nLmNhbGwodGhpcywgJ2NhcHRpb25zJyk7IC8vIFRyaWdnZXIgZXZlbnQgKG5vdCB1c2VkIGludGVybmFsbHkpXG5cbiAgICAgICAgdHJpZ2dlckV2ZW50LmNhbGwodGhpcywgdGhpcy5tZWRpYSwgYWN0aXZlID8gJ2NhcHRpb25zZW5hYmxlZCcgOiAnY2FwdGlvbnNkaXNhYmxlZCcpO1xuICAgICAgfSAvLyBXYWl0IGZvciB0aGUgY2FsbCBzdGFjayB0byBjbGVhciBiZWZvcmUgc2V0dGluZyBtb2RlPSdoaWRkZW4nXG4gICAgICAvLyBvbiB0aGUgYWN0aXZlIHRyYWNrIC0gZm9yY2luZyB0aGUgYnJvd3NlciB0byBkb3dubG9hZCBpdFxuXG5cbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICBpZiAoYWN0aXZlICYmIHRoaXMuY2FwdGlvbnMudG9nZ2xlZCkge1xuICAgICAgICAgIHRoaXMuY2FwdGlvbnMuY3VycmVudFRyYWNrTm9kZS5tb2RlID0gJ2hpZGRlbic7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvLyBTZXQgY2FwdGlvbnMgYnkgdHJhY2sgaW5kZXhcbiAgICAvLyBVc2VkIGludGVybmFsbHkgZm9yIHRoZSBjdXJyZW50VHJhY2sgc2V0dGVyIHdpdGggdGhlIHBhc3NpdmUgb3B0aW9uIGZvcmNlZCB0byBmYWxzZVxuICAgIHNldChpbmRleCwgcGFzc2l2ZSA9IHRydWUpIHtcbiAgICAgIGNvbnN0IHRyYWNrcyA9IGNhcHRpb25zLmdldFRyYWNrcy5jYWxsKHRoaXMpOyAvLyBEaXNhYmxlIGNhcHRpb25zIGlmIHNldHRpbmcgdG8gLTFcblxuICAgICAgaWYgKGluZGV4ID09PSAtMSkge1xuICAgICAgICBjYXB0aW9ucy50b2dnbGUuY2FsbCh0aGlzLCBmYWxzZSwgcGFzc2l2ZSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgaWYgKCFpcy5udW1iZXIoaW5kZXgpKSB7XG4gICAgICAgIHRoaXMuZGVidWcud2FybignSW52YWxpZCBjYXB0aW9uIGFyZ3VtZW50JywgaW5kZXgpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmICghKGluZGV4IGluIHRyYWNrcykpIHtcbiAgICAgICAgdGhpcy5kZWJ1Zy53YXJuKCdUcmFjayBub3QgZm91bmQnLCBpbmRleCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMuY2FwdGlvbnMuY3VycmVudFRyYWNrICE9PSBpbmRleCkge1xuICAgICAgICB0aGlzLmNhcHRpb25zLmN1cnJlbnRUcmFjayA9IGluZGV4O1xuICAgICAgICBjb25zdCB0cmFjayA9IHRyYWNrc1tpbmRleF07XG4gICAgICAgIGNvbnN0IHtcbiAgICAgICAgICBsYW5ndWFnZVxuICAgICAgICB9ID0gdHJhY2sgfHwge307IC8vIFN0b3JlIHJlZmVyZW5jZSB0byBub2RlIGZvciBpbnZhbGlkYXRpb24gb24gcmVtb3ZlXG5cbiAgICAgICAgdGhpcy5jYXB0aW9ucy5jdXJyZW50VHJhY2tOb2RlID0gdHJhY2s7IC8vIFVwZGF0ZSBzZXR0aW5ncyBtZW51XG5cbiAgICAgICAgY29udHJvbHMudXBkYXRlU2V0dGluZy5jYWxsKHRoaXMsICdjYXB0aW9ucycpOyAvLyBXaGVuIHBhc3NpdmUsIGRvbid0IG92ZXJyaWRlIHVzZXIgcHJlZmVyZW5jZXNcblxuICAgICAgICBpZiAoIXBhc3NpdmUpIHtcbiAgICAgICAgICB0aGlzLmNhcHRpb25zLmxhbmd1YWdlID0gbGFuZ3VhZ2U7XG4gICAgICAgICAgdGhpcy5zdG9yYWdlLnNldCh7XG4gICAgICAgICAgICBsYW5ndWFnZVxuICAgICAgICAgIH0pO1xuICAgICAgICB9IC8vIEhhbmRsZSBWaW1lbyBjYXB0aW9uc1xuXG5cbiAgICAgICAgaWYgKHRoaXMuaXNWaW1lbykge1xuICAgICAgICAgIHRoaXMuZW1iZWQuZW5hYmxlVGV4dFRyYWNrKGxhbmd1YWdlKTtcbiAgICAgICAgfSAvLyBUcmlnZ2VyIGV2ZW50XG5cblxuICAgICAgICB0cmlnZ2VyRXZlbnQuY2FsbCh0aGlzLCB0aGlzLm1lZGlhLCAnbGFuZ3VhZ2VjaGFuZ2UnKTtcbiAgICAgIH0gLy8gU2hvdyBjYXB0aW9uc1xuXG5cbiAgICAgIGNhcHRpb25zLnRvZ2dsZS5jYWxsKHRoaXMsIHRydWUsIHBhc3NpdmUpO1xuXG4gICAgICBpZiAodGhpcy5pc0hUTUw1ICYmIHRoaXMuaXNWaWRlbykge1xuICAgICAgICAvLyBJZiB3ZSBjaGFuZ2UgdGhlIGFjdGl2ZSB0cmFjayB3aGlsZSBhIGN1ZSBpcyBhbHJlYWR5IGRpc3BsYXllZCB3ZSBuZWVkIHRvIHVwZGF0ZSBpdFxuICAgICAgICBjYXB0aW9ucy51cGRhdGVDdWVzLmNhbGwodGhpcyk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIC8vIFNldCBjYXB0aW9ucyBieSBsYW5ndWFnZVxuICAgIC8vIFVzZWQgaW50ZXJuYWxseSBmb3IgdGhlIGxhbmd1YWdlIHNldHRlciB3aXRoIHRoZSBwYXNzaXZlIG9wdGlvbiBmb3JjZWQgdG8gZmFsc2VcbiAgICBzZXRMYW5ndWFnZShpbnB1dCwgcGFzc2l2ZSA9IHRydWUpIHtcbiAgICAgIGlmICghaXMuc3RyaW5nKGlucHV0KSkge1xuICAgICAgICB0aGlzLmRlYnVnLndhcm4oJ0ludmFsaWQgbGFuZ3VhZ2UgYXJndW1lbnQnLCBpbnB1dCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH0gLy8gTm9ybWFsaXplXG5cblxuICAgICAgY29uc3QgbGFuZ3VhZ2UgPSBpbnB1dC50b0xvd2VyQ2FzZSgpO1xuICAgICAgdGhpcy5jYXB0aW9ucy5sYW5ndWFnZSA9IGxhbmd1YWdlOyAvLyBTZXQgY3VycmVudFRyYWNrXG5cbiAgICAgIGNvbnN0IHRyYWNrcyA9IGNhcHRpb25zLmdldFRyYWNrcy5jYWxsKHRoaXMpO1xuICAgICAgY29uc3QgdHJhY2sgPSBjYXB0aW9ucy5maW5kVHJhY2suY2FsbCh0aGlzLCBbbGFuZ3VhZ2VdKTtcbiAgICAgIGNhcHRpb25zLnNldC5jYWxsKHRoaXMsIHRyYWNrcy5pbmRleE9mKHRyYWNrKSwgcGFzc2l2ZSk7XG4gICAgfSxcblxuICAgIC8vIEdldCBjdXJyZW50IHZhbGlkIGNhcHRpb24gdHJhY2tzXG4gICAgLy8gSWYgdXBkYXRlIGlzIGZhbHNlIGl0IHdpbGwgYWxzbyBpZ25vcmUgdHJhY2tzIHdpdGhvdXQgbWV0YWRhdGFcbiAgICAvLyBUaGlzIGlzIHVzZWQgdG8gXCJmcmVlemVcIiB0aGUgbGFuZ3VhZ2Ugb3B0aW9ucyB3aGVuIGNhcHRpb25zLnVwZGF0ZSBpcyBmYWxzZVxuICAgIGdldFRyYWNrcyh1cGRhdGUgPSBmYWxzZSkge1xuICAgICAgLy8gSGFuZGxlIG1lZGlhIG9yIHRleHRUcmFja3MgbWlzc2luZyBvciBudWxsXG4gICAgICBjb25zdCB0cmFja3MgPSBBcnJheS5mcm9tKCh0aGlzLm1lZGlhIHx8IHt9KS50ZXh0VHJhY2tzIHx8IFtdKTsgLy8gRm9yIEhUTUw1LCB1c2UgY2FjaGUgaW5zdGVhZCBvZiBjdXJyZW50IHRyYWNrcyB3aGVuIGl0IGV4aXN0cyAoaWYgY2FwdGlvbnMudXBkYXRlIGlzIGZhbHNlKVxuICAgICAgLy8gRmlsdGVyIG91dCByZW1vdmVkIHRyYWNrcyBhbmQgdHJhY2tzIHRoYXQgYXJlbid0IGNhcHRpb25zL3N1YnRpdGxlcyAoZm9yIGV4YW1wbGUgbWV0YWRhdGEpXG5cbiAgICAgIHJldHVybiB0cmFja3MuZmlsdGVyKHRyYWNrID0+ICF0aGlzLmlzSFRNTDUgfHwgdXBkYXRlIHx8IHRoaXMuY2FwdGlvbnMubWV0YS5oYXModHJhY2spKS5maWx0ZXIodHJhY2sgPT4gWydjYXB0aW9ucycsICdzdWJ0aXRsZXMnXS5pbmNsdWRlcyh0cmFjay5raW5kKSk7XG4gICAgfSxcblxuICAgIC8vIE1hdGNoIHRyYWNrcyBiYXNlZCBvbiBsYW5ndWFnZXMgYW5kIGdldCB0aGUgZmlyc3RcbiAgICBmaW5kVHJhY2sobGFuZ3VhZ2VzLCBmb3JjZSA9IGZhbHNlKSB7XG4gICAgICBjb25zdCB0cmFja3MgPSBjYXB0aW9ucy5nZXRUcmFja3MuY2FsbCh0aGlzKTtcblxuICAgICAgY29uc3Qgc29ydElzRGVmYXVsdCA9IHRyYWNrID0+IE51bWJlcigodGhpcy5jYXB0aW9ucy5tZXRhLmdldCh0cmFjaykgfHwge30pLmRlZmF1bHQpO1xuXG4gICAgICBjb25zdCBzb3J0ZWQgPSBBcnJheS5mcm9tKHRyYWNrcykuc29ydCgoYSwgYikgPT4gc29ydElzRGVmYXVsdChiKSAtIHNvcnRJc0RlZmF1bHQoYSkpO1xuICAgICAgbGV0IHRyYWNrO1xuICAgICAgbGFuZ3VhZ2VzLmV2ZXJ5KGxhbmd1YWdlID0+IHtcbiAgICAgICAgdHJhY2sgPSBzb3J0ZWQuZmluZCh0ID0+IHQubGFuZ3VhZ2UgPT09IGxhbmd1YWdlKTtcbiAgICAgICAgcmV0dXJuICF0cmFjazsgLy8gQnJlYWsgaXRlcmF0aW9uIGlmIHRoZXJlIGlzIGEgbWF0Y2hcbiAgICAgIH0pOyAvLyBJZiBubyBtYXRjaCBpcyBmb3VuZCBidXQgaXMgcmVxdWlyZWQsIGdldCBmaXJzdFxuXG4gICAgICByZXR1cm4gdHJhY2sgfHwgKGZvcmNlID8gc29ydGVkWzBdIDogdW5kZWZpbmVkKTtcbiAgICB9LFxuXG4gICAgLy8gR2V0IHRoZSBjdXJyZW50IHRyYWNrXG4gICAgZ2V0Q3VycmVudFRyYWNrKCkge1xuICAgICAgcmV0dXJuIGNhcHRpb25zLmdldFRyYWNrcy5jYWxsKHRoaXMpW3RoaXMuY3VycmVudFRyYWNrXTtcbiAgICB9LFxuXG4gICAgLy8gR2V0IFVJIGxhYmVsIGZvciB0cmFja1xuICAgIGdldExhYmVsKHRyYWNrKSB7XG4gICAgICBsZXQgY3VycmVudFRyYWNrID0gdHJhY2s7XG5cbiAgICAgIGlmICghaXMudHJhY2soY3VycmVudFRyYWNrKSAmJiBzdXBwb3J0LnRleHRUcmFja3MgJiYgdGhpcy5jYXB0aW9ucy50b2dnbGVkKSB7XG4gICAgICAgIGN1cnJlbnRUcmFjayA9IGNhcHRpb25zLmdldEN1cnJlbnRUcmFjay5jYWxsKHRoaXMpO1xuICAgICAgfVxuXG4gICAgICBpZiAoaXMudHJhY2soY3VycmVudFRyYWNrKSkge1xuICAgICAgICBpZiAoIWlzLmVtcHR5KGN1cnJlbnRUcmFjay5sYWJlbCkpIHtcbiAgICAgICAgICByZXR1cm4gY3VycmVudFRyYWNrLmxhYmVsO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFpcy5lbXB0eShjdXJyZW50VHJhY2subGFuZ3VhZ2UpKSB7XG4gICAgICAgICAgcmV0dXJuIHRyYWNrLmxhbmd1YWdlLnRvVXBwZXJDYXNlKCk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gaTE4bi5nZXQoJ2VuYWJsZWQnLCB0aGlzLmNvbmZpZyk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBpMThuLmdldCgnZGlzYWJsZWQnLCB0aGlzLmNvbmZpZyk7XG4gICAgfSxcblxuICAgIC8vIFVwZGF0ZSBjYXB0aW9ucyB1c2luZyBjdXJyZW50IHRyYWNrJ3MgYWN0aXZlIGN1ZXNcbiAgICAvLyBBbHNvIG9wdGlvbmFsIGFycmF5IGFyZ3VtZW50IGluIGNhc2UgdGhlcmUgaXNuJ3QgYW55IHRyYWNrIChleDogdmltZW8pXG4gICAgdXBkYXRlQ3VlcyhpbnB1dCkge1xuICAgICAgLy8gUmVxdWlyZXMgVUlcbiAgICAgIGlmICghdGhpcy5zdXBwb3J0ZWQudWkpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBpZiAoIWlzLmVsZW1lbnQodGhpcy5lbGVtZW50cy5jYXB0aW9ucykpIHtcbiAgICAgICAgdGhpcy5kZWJ1Zy53YXJuKCdObyBjYXB0aW9ucyBlbGVtZW50IHRvIHJlbmRlciB0bycpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9IC8vIE9ubHkgYWNjZXB0IGFycmF5IG9yIGVtcHR5IGlucHV0XG5cblxuICAgICAgaWYgKCFpcy5udWxsT3JVbmRlZmluZWQoaW5wdXQpICYmICFBcnJheS5pc0FycmF5KGlucHV0KSkge1xuICAgICAgICB0aGlzLmRlYnVnLndhcm4oJ3VwZGF0ZUN1ZXM6IEludmFsaWQgaW5wdXQnLCBpbnB1dCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgbGV0IGN1ZXMgPSBpbnB1dDsgLy8gR2V0IGN1ZXMgZnJvbSB0cmFja1xuXG4gICAgICBpZiAoIWN1ZXMpIHtcbiAgICAgICAgY29uc3QgdHJhY2sgPSBjYXB0aW9ucy5nZXRDdXJyZW50VHJhY2suY2FsbCh0aGlzKTtcbiAgICAgICAgY3VlcyA9IEFycmF5LmZyb20oKHRyYWNrIHx8IHt9KS5hY3RpdmVDdWVzIHx8IFtdKS5tYXAoY3VlID0+IGN1ZS5nZXRDdWVBc0hUTUwoKSkubWFwKGdldEhUTUwpO1xuICAgICAgfSAvLyBTZXQgbmV3IGNhcHRpb24gdGV4dFxuXG5cbiAgICAgIGNvbnN0IGNvbnRlbnQgPSBjdWVzLm1hcChjdWVUZXh0ID0+IGN1ZVRleHQudHJpbSgpKS5qb2luKCdcXG4nKTtcbiAgICAgIGNvbnN0IGNoYW5nZWQgPSBjb250ZW50ICE9PSB0aGlzLmVsZW1lbnRzLmNhcHRpb25zLmlubmVySFRNTDtcblxuICAgICAgaWYgKGNoYW5nZWQpIHtcbiAgICAgICAgLy8gRW1wdHkgdGhlIGNvbnRhaW5lciBhbmQgY3JlYXRlIGEgbmV3IGNoaWxkIGVsZW1lbnRcbiAgICAgICAgZW1wdHlFbGVtZW50KHRoaXMuZWxlbWVudHMuY2FwdGlvbnMpO1xuICAgICAgICBjb25zdCBjYXB0aW9uID0gY3JlYXRlRWxlbWVudCgnc3BhbicsIGdldEF0dHJpYnV0ZXNGcm9tU2VsZWN0b3IodGhpcy5jb25maWcuc2VsZWN0b3JzLmNhcHRpb24pKTtcbiAgICAgICAgY2FwdGlvbi5pbm5lckhUTUwgPSBjb250ZW50O1xuICAgICAgICB0aGlzLmVsZW1lbnRzLmNhcHRpb25zLmFwcGVuZENoaWxkKGNhcHRpb24pOyAvLyBUcmlnZ2VyIGV2ZW50XG5cbiAgICAgICAgdHJpZ2dlckV2ZW50LmNhbGwodGhpcywgdGhpcy5tZWRpYSwgJ2N1ZWNoYW5nZScpO1xuICAgICAgfVxuICAgIH1cblxuICB9O1xuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vIFBseXIgZGVmYXVsdCBjb25maWdcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgY29uc3QgZGVmYXVsdHMgPSB7XG4gICAgLy8gRGlzYWJsZVxuICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgLy8gQ3VzdG9tIG1lZGlhIHRpdGxlXG4gICAgdGl0bGU6ICcnLFxuICAgIC8vIExvZ2dpbmcgdG8gY29uc29sZVxuICAgIGRlYnVnOiBmYWxzZSxcbiAgICAvLyBBdXRvIHBsYXkgKGlmIHN1cHBvcnRlZClcbiAgICBhdXRvcGxheTogZmFsc2UsXG4gICAgLy8gT25seSBhbGxvdyBvbmUgbWVkaWEgcGxheWluZyBhdCBvbmNlICh2aW1lbyBvbmx5KVxuICAgIGF1dG9wYXVzZTogdHJ1ZSxcbiAgICAvLyBBbGxvdyBpbmxpbmUgcGxheWJhY2sgb24gaU9TICh0aGlzIGVmZmVjdHMgWW91VHViZS9WaW1lbyAtIEhUTUw1IHJlcXVpcmVzIHRoZSBhdHRyaWJ1dGUgcHJlc2VudClcbiAgICAvLyBUT0RPOiBSZW1vdmUgaW9zTmF0aXZlIGZ1bGxzY3JlZW4gb3B0aW9uIGluIGZhdm91ciBvZiB0aGlzIChsb2dpYyBuZWVkcyB3b3JrKVxuICAgIHBsYXlzaW5saW5lOiB0cnVlLFxuICAgIC8vIERlZmF1bHQgdGltZSB0byBza2lwIHdoZW4gcmV3aW5kL2Zhc3QgZm9yd2FyZFxuICAgIHNlZWtUaW1lOiAxMCxcbiAgICAvLyBEZWZhdWx0IHZvbHVtZVxuICAgIHZvbHVtZTogMSxcbiAgICBtdXRlZDogZmFsc2UsXG4gICAgLy8gUGFzcyBhIGN1c3RvbSBkdXJhdGlvblxuICAgIGR1cmF0aW9uOiBudWxsLFxuICAgIC8vIERpc3BsYXkgdGhlIG1lZGlhIGR1cmF0aW9uIG9uIGxvYWQgaW4gdGhlIGN1cnJlbnQgdGltZSBwb3NpdGlvblxuICAgIC8vIElmIHlvdSBoYXZlIG9wdGVkIHRvIGRpc3BsYXkgYm90aCBkdXJhdGlvbiBhbmQgY3VycmVudFRpbWUsIHRoaXMgaXMgaWdub3JlZFxuICAgIGRpc3BsYXlEdXJhdGlvbjogdHJ1ZSxcbiAgICAvLyBJbnZlcnQgdGhlIGN1cnJlbnQgdGltZSB0byBiZSBhIGNvdW50ZG93blxuICAgIGludmVydFRpbWU6IHRydWUsXG4gICAgLy8gQ2xpY2tpbmcgdGhlIGN1cnJlbnRUaW1lIGludmVydHMgaXQncyB2YWx1ZSB0byBzaG93IHRpbWUgbGVmdCByYXRoZXIgdGhhbiBlbGFwc2VkXG4gICAgdG9nZ2xlSW52ZXJ0OiB0cnVlLFxuICAgIC8vIEZvcmNlIGFuIGFzcGVjdCByYXRpb1xuICAgIC8vIFRoZSBmb3JtYXQgbXVzdCBiZSBgJ3c6aCdgIChlLmcuIGAnMTY6OSdgKVxuICAgIHJhdGlvOiBudWxsLFxuICAgIC8vIENsaWNrIHZpZGVvIGNvbnRhaW5lciB0byBwbGF5L3BhdXNlXG4gICAgY2xpY2tUb1BsYXk6IHRydWUsXG4gICAgLy8gQXV0byBoaWRlIHRoZSBjb250cm9sc1xuICAgIGhpZGVDb250cm9sczogdHJ1ZSxcbiAgICAvLyBSZXNldCB0byBzdGFydCB3aGVuIHBsYXliYWNrIGVuZGVkXG4gICAgcmVzZXRPbkVuZDogZmFsc2UsXG4gICAgLy8gRGlzYWJsZSB0aGUgc3RhbmRhcmQgY29udGV4dCBtZW51XG4gICAgZGlzYWJsZUNvbnRleHRNZW51OiB0cnVlLFxuICAgIC8vIFNwcml0ZSAoZm9yIGljb25zKVxuICAgIGxvYWRTcHJpdGU6IHRydWUsXG4gICAgaWNvblByZWZpeDogJ3BseXInLFxuICAgIGljb25Vcmw6ICdodHRwczovL2Nkbi5wbHlyLmlvLzMuNy4yL3BseXIuc3ZnJyxcbiAgICAvLyBCbGFuayB2aWRlbyAodXNlZCB0byBwcmV2ZW50IGVycm9ycyBvbiBzb3VyY2UgY2hhbmdlKVxuICAgIGJsYW5rVmlkZW86ICdodHRwczovL2Nkbi5wbHlyLmlvL3N0YXRpYy9ibGFuay5tcDQnLFxuICAgIC8vIFF1YWxpdHkgZGVmYXVsdFxuICAgIHF1YWxpdHk6IHtcbiAgICAgIGRlZmF1bHQ6IDU3NixcbiAgICAgIC8vIFRoZSBvcHRpb25zIHRvIGRpc3BsYXkgaW4gdGhlIFVJLCBpZiBhdmFpbGFibGUgZm9yIHRoZSBzb3VyY2UgbWVkaWFcbiAgICAgIG9wdGlvbnM6IFs0MzIwLCAyODgwLCAyMTYwLCAxNDQwLCAxMDgwLCA3MjAsIDU3NiwgNDgwLCAzNjAsIDI0MF0sXG4gICAgICBmb3JjZWQ6IGZhbHNlLFxuICAgICAgb25DaGFuZ2U6IG51bGxcbiAgICB9LFxuICAgIC8vIFNldCBsb29wc1xuICAgIGxvb3A6IHtcbiAgICAgIGFjdGl2ZTogZmFsc2UgLy8gc3RhcnQ6IG51bGwsXG4gICAgICAvLyBlbmQ6IG51bGwsXG5cbiAgICB9LFxuICAgIC8vIFNwZWVkIGRlZmF1bHQgYW5kIG9wdGlvbnMgdG8gZGlzcGxheVxuICAgIHNwZWVkOiB7XG4gICAgICBzZWxlY3RlZDogMSxcbiAgICAgIC8vIFRoZSBvcHRpb25zIHRvIGRpc3BsYXkgaW4gdGhlIFVJLCBpZiBhdmFpbGFibGUgZm9yIHRoZSBzb3VyY2UgbWVkaWEgKGUuZy4gVmltZW8gYW5kIFlvdVR1YmUgb25seSBzdXBwb3J0IDAuNXgtNHgpXG4gICAgICBvcHRpb25zOiBbMC41LCAwLjc1LCAxLCAxLjI1LCAxLjUsIDEuNzUsIDIsIDRdXG4gICAgfSxcbiAgICAvLyBLZXlib2FyZCBzaG9ydGN1dCBzZXR0aW5nc1xuICAgIGtleWJvYXJkOiB7XG4gICAgICBmb2N1c2VkOiB0cnVlLFxuICAgICAgZ2xvYmFsOiBmYWxzZVxuICAgIH0sXG4gICAgLy8gRGlzcGxheSB0b29sdGlwc1xuICAgIHRvb2x0aXBzOiB7XG4gICAgICBjb250cm9sczogZmFsc2UsXG4gICAgICBzZWVrOiB0cnVlXG4gICAgfSxcbiAgICAvLyBDYXB0aW9ucyBzZXR0aW5nc1xuICAgIGNhcHRpb25zOiB7XG4gICAgICBhY3RpdmU6IGZhbHNlLFxuICAgICAgbGFuZ3VhZ2U6ICdhdXRvJyxcbiAgICAgIC8vIExpc3RlbiB0byBuZXcgdHJhY2tzIGFkZGVkIGFmdGVyIFBseXIgaXMgaW5pdGlhbGl6ZWQuXG4gICAgICAvLyBUaGlzIGlzIG5lZWRlZCBmb3Igc3RyZWFtaW5nIGNhcHRpb25zLCBidXQgbWF5IHJlc3VsdCBpbiB1bnNlbGVjdGFibGUgb3B0aW9uc1xuICAgICAgdXBkYXRlOiBmYWxzZVxuICAgIH0sXG4gICAgLy8gRnVsbHNjcmVlbiBzZXR0aW5nc1xuICAgIGZ1bGxzY3JlZW46IHtcbiAgICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgICAvLyBBbGxvdyBmdWxsc2NyZWVuP1xuICAgICAgZmFsbGJhY2s6IHRydWUsXG4gICAgICAvLyBGYWxsYmFjayB1c2luZyBmdWxsIHZpZXdwb3J0L3dpbmRvd1xuICAgICAgaW9zTmF0aXZlOiBmYWxzZSAvLyBVc2UgdGhlIG5hdGl2ZSBmdWxsc2NyZWVuIGluIGlPUyAoZGlzYWJsZXMgY3VzdG9tIGNvbnRyb2xzKVxuICAgICAgLy8gU2VsZWN0b3IgZm9yIHRoZSBmdWxsc2NyZWVuIGNvbnRhaW5lciBzbyBjb250ZXh0dWFsIC8gbm9uLXBsYXllciBjb250ZW50IGNhbiByZW1haW4gdmlzaWJsZSBpbiBmdWxsc2NyZWVuIG1vZGVcbiAgICAgIC8vIE5vbi1hbmNlc3RvcnMgb2YgdGhlIHBsYXllciBlbGVtZW50IHdpbGwgYmUgaWdub3JlZFxuICAgICAgLy8gY29udGFpbmVyOiBudWxsLCAvLyBkZWZhdWx0cyB0byB0aGUgcGxheWVyIGVsZW1lbnRcblxuICAgIH0sXG4gICAgLy8gTG9jYWwgc3RvcmFnZVxuICAgIHN0b3JhZ2U6IHtcbiAgICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgICBrZXk6ICdwbHlyJ1xuICAgIH0sXG4gICAgLy8gRGVmYXVsdCBjb250cm9sc1xuICAgIGNvbnRyb2xzOiBbJ3BsYXktbGFyZ2UnLCAvLyAncmVzdGFydCcsXG4gICAgLy8gJ3Jld2luZCcsXG4gICAgJ3BsYXknLCAvLyAnZmFzdC1mb3J3YXJkJyxcbiAgICAncHJvZ3Jlc3MnLCAnY3VycmVudC10aW1lJywgLy8gJ2R1cmF0aW9uJyxcbiAgICAnbXV0ZScsICd2b2x1bWUnLCAnY2FwdGlvbnMnLCAnc2V0dGluZ3MnLCAncGlwJywgJ2FpcnBsYXknLCAvLyAnZG93bmxvYWQnLFxuICAgICdmdWxsc2NyZWVuJ10sXG4gICAgc2V0dGluZ3M6IFsnY2FwdGlvbnMnLCAncXVhbGl0eScsICdzcGVlZCddLFxuICAgIC8vIExvY2FsaXNhdGlvblxuICAgIGkxOG46IHtcbiAgICAgIHJlc3RhcnQ6ICdSZXN0YXJ0JyxcbiAgICAgIHJld2luZDogJ1Jld2luZCB7c2Vla3RpbWV9cycsXG4gICAgICBwbGF5OiAnUGxheScsXG4gICAgICBwYXVzZTogJ1BhdXNlJyxcbiAgICAgIGZhc3RGb3J3YXJkOiAnRm9yd2FyZCB7c2Vla3RpbWV9cycsXG4gICAgICBzZWVrOiAnU2VlaycsXG4gICAgICBzZWVrTGFiZWw6ICd7Y3VycmVudFRpbWV9IG9mIHtkdXJhdGlvbn0nLFxuICAgICAgcGxheWVkOiAnUGxheWVkJyxcbiAgICAgIGJ1ZmZlcmVkOiAnQnVmZmVyZWQnLFxuICAgICAgY3VycmVudFRpbWU6ICdDdXJyZW50IHRpbWUnLFxuICAgICAgZHVyYXRpb246ICdEdXJhdGlvbicsXG4gICAgICB2b2x1bWU6ICdWb2x1bWUnLFxuICAgICAgbXV0ZTogJ011dGUnLFxuICAgICAgdW5tdXRlOiAnVW5tdXRlJyxcbiAgICAgIGVuYWJsZUNhcHRpb25zOiAnRW5hYmxlIGNhcHRpb25zJyxcbiAgICAgIGRpc2FibGVDYXB0aW9uczogJ0Rpc2FibGUgY2FwdGlvbnMnLFxuICAgICAgZG93bmxvYWQ6ICdEb3dubG9hZCcsXG4gICAgICBlbnRlckZ1bGxzY3JlZW46ICdFbnRlciBmdWxsc2NyZWVuJyxcbiAgICAgIGV4aXRGdWxsc2NyZWVuOiAnRXhpdCBmdWxsc2NyZWVuJyxcbiAgICAgIGZyYW1lVGl0bGU6ICdQbGF5ZXIgZm9yIHt0aXRsZX0nLFxuICAgICAgY2FwdGlvbnM6ICdDYXB0aW9ucycsXG4gICAgICBzZXR0aW5nczogJ1NldHRpbmdzJyxcbiAgICAgIHBpcDogJ1BJUCcsXG4gICAgICBtZW51QmFjazogJ0dvIGJhY2sgdG8gcHJldmlvdXMgbWVudScsXG4gICAgICBzcGVlZDogJ1NwZWVkJyxcbiAgICAgIG5vcm1hbDogJ05vcm1hbCcsXG4gICAgICBxdWFsaXR5OiAnUXVhbGl0eScsXG4gICAgICBsb29wOiAnTG9vcCcsXG4gICAgICBzdGFydDogJ1N0YXJ0JyxcbiAgICAgIGVuZDogJ0VuZCcsXG4gICAgICBhbGw6ICdBbGwnLFxuICAgICAgcmVzZXQ6ICdSZXNldCcsXG4gICAgICBkaXNhYmxlZDogJ0Rpc2FibGVkJyxcbiAgICAgIGVuYWJsZWQ6ICdFbmFibGVkJyxcbiAgICAgIGFkdmVydGlzZW1lbnQ6ICdBZCcsXG4gICAgICBxdWFsaXR5QmFkZ2U6IHtcbiAgICAgICAgMjE2MDogJzRLJyxcbiAgICAgICAgMTQ0MDogJ0hEJyxcbiAgICAgICAgMTA4MDogJ0hEJyxcbiAgICAgICAgNzIwOiAnSEQnLFxuICAgICAgICA1NzY6ICdTRCcsXG4gICAgICAgIDQ4MDogJ1NEJ1xuICAgICAgfVxuICAgIH0sXG4gICAgLy8gVVJMc1xuICAgIHVybHM6IHtcbiAgICAgIGRvd25sb2FkOiBudWxsLFxuICAgICAgdmltZW86IHtcbiAgICAgICAgc2RrOiAnaHR0cHM6Ly9wbGF5ZXIudmltZW8uY29tL2FwaS9wbGF5ZXIuanMnLFxuICAgICAgICBpZnJhbWU6ICdodHRwczovL3BsYXllci52aW1lby5jb20vdmlkZW8vezB9P3sxfScsXG4gICAgICAgIGFwaTogJ2h0dHBzOi8vdmltZW8uY29tL2FwaS9vZW1iZWQuanNvbj91cmw9ezB9J1xuICAgICAgfSxcbiAgICAgIHlvdXR1YmU6IHtcbiAgICAgICAgc2RrOiAnaHR0cHM6Ly93d3cueW91dHViZS5jb20vaWZyYW1lX2FwaScsXG4gICAgICAgIGFwaTogJ2h0dHBzOi8vbm9lbWJlZC5jb20vZW1iZWQ/dXJsPWh0dHBzOi8vd3d3LnlvdXR1YmUuY29tL3dhdGNoP3Y9ezB9J1xuICAgICAgfSxcbiAgICAgIGdvb2dsZUlNQToge1xuICAgICAgICBzZGs6ICdodHRwczovL2ltYXNkay5nb29nbGVhcGlzLmNvbS9qcy9zZGtsb2FkZXIvaW1hMy5qcydcbiAgICAgIH1cbiAgICB9LFxuICAgIC8vIEN1c3RvbSBjb250cm9sIGxpc3RlbmVyc1xuICAgIGxpc3RlbmVyczoge1xuICAgICAgc2VlazogbnVsbCxcbiAgICAgIHBsYXk6IG51bGwsXG4gICAgICBwYXVzZTogbnVsbCxcbiAgICAgIHJlc3RhcnQ6IG51bGwsXG4gICAgICByZXdpbmQ6IG51bGwsXG4gICAgICBmYXN0Rm9yd2FyZDogbnVsbCxcbiAgICAgIG11dGU6IG51bGwsXG4gICAgICB2b2x1bWU6IG51bGwsXG4gICAgICBjYXB0aW9uczogbnVsbCxcbiAgICAgIGRvd25sb2FkOiBudWxsLFxuICAgICAgZnVsbHNjcmVlbjogbnVsbCxcbiAgICAgIHBpcDogbnVsbCxcbiAgICAgIGFpcnBsYXk6IG51bGwsXG4gICAgICBzcGVlZDogbnVsbCxcbiAgICAgIHF1YWxpdHk6IG51bGwsXG4gICAgICBsb29wOiBudWxsLFxuICAgICAgbGFuZ3VhZ2U6IG51bGxcbiAgICB9LFxuICAgIC8vIEV2ZW50cyB0byB3YXRjaCBhbmQgYnViYmxlXG4gICAgZXZlbnRzOiBbLy8gRXZlbnRzIHRvIHdhdGNoIG9uIEhUTUw1IG1lZGlhIGVsZW1lbnRzIGFuZCBidWJibGVcbiAgICAvLyBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi9kb2NzL1dlYi9HdWlkZS9FdmVudHMvTWVkaWFfZXZlbnRzXG4gICAgJ2VuZGVkJywgJ3Byb2dyZXNzJywgJ3N0YWxsZWQnLCAncGxheWluZycsICd3YWl0aW5nJywgJ2NhbnBsYXknLCAnY2FucGxheXRocm91Z2gnLCAnbG9hZHN0YXJ0JywgJ2xvYWRlZGRhdGEnLCAnbG9hZGVkbWV0YWRhdGEnLCAndGltZXVwZGF0ZScsICd2b2x1bWVjaGFuZ2UnLCAncGxheScsICdwYXVzZScsICdlcnJvcicsICdzZWVraW5nJywgJ3NlZWtlZCcsICdlbXB0aWVkJywgJ3JhdGVjaGFuZ2UnLCAnY3VlY2hhbmdlJywgLy8gQ3VzdG9tIGV2ZW50c1xuICAgICdkb3dubG9hZCcsICdlbnRlcmZ1bGxzY3JlZW4nLCAnZXhpdGZ1bGxzY3JlZW4nLCAnY2FwdGlvbnNlbmFibGVkJywgJ2NhcHRpb25zZGlzYWJsZWQnLCAnbGFuZ3VhZ2VjaGFuZ2UnLCAnY29udHJvbHNoaWRkZW4nLCAnY29udHJvbHNzaG93bicsICdyZWFkeScsIC8vIFlvdVR1YmVcbiAgICAnc3RhdGVjaGFuZ2UnLCAvLyBRdWFsaXR5XG4gICAgJ3F1YWxpdHljaGFuZ2UnLCAvLyBBZHNcbiAgICAnYWRzbG9hZGVkJywgJ2Fkc2NvbnRlbnRwYXVzZScsICdhZHNjb250ZW50cmVzdW1lJywgJ2Fkc3RhcnRlZCcsICdhZHNtaWRwb2ludCcsICdhZHNjb21wbGV0ZScsICdhZHNhbGxjb21wbGV0ZScsICdhZHNpbXByZXNzaW9uJywgJ2Fkc2NsaWNrJ10sXG4gICAgLy8gU2VsZWN0b3JzXG4gICAgLy8gQ2hhbmdlIHRoZXNlIHRvIG1hdGNoIHlvdXIgdGVtcGxhdGUgaWYgdXNpbmcgY3VzdG9tIEhUTUxcbiAgICBzZWxlY3RvcnM6IHtcbiAgICAgIGVkaXRhYmxlOiAnaW5wdXQsIHRleHRhcmVhLCBzZWxlY3QsIFtjb250ZW50ZWRpdGFibGVdJyxcbiAgICAgIGNvbnRhaW5lcjogJy5wbHlyJyxcbiAgICAgIGNvbnRyb2xzOiB7XG4gICAgICAgIGNvbnRhaW5lcjogbnVsbCxcbiAgICAgICAgd3JhcHBlcjogJy5wbHlyX19jb250cm9scydcbiAgICAgIH0sXG4gICAgICBsYWJlbHM6ICdbZGF0YS1wbHlyXScsXG4gICAgICBidXR0b25zOiB7XG4gICAgICAgIHBsYXk6ICdbZGF0YS1wbHlyPVwicGxheVwiXScsXG4gICAgICAgIHBhdXNlOiAnW2RhdGEtcGx5cj1cInBhdXNlXCJdJyxcbiAgICAgICAgcmVzdGFydDogJ1tkYXRhLXBseXI9XCJyZXN0YXJ0XCJdJyxcbiAgICAgICAgcmV3aW5kOiAnW2RhdGEtcGx5cj1cInJld2luZFwiXScsXG4gICAgICAgIGZhc3RGb3J3YXJkOiAnW2RhdGEtcGx5cj1cImZhc3QtZm9yd2FyZFwiXScsXG4gICAgICAgIG11dGU6ICdbZGF0YS1wbHlyPVwibXV0ZVwiXScsXG4gICAgICAgIGNhcHRpb25zOiAnW2RhdGEtcGx5cj1cImNhcHRpb25zXCJdJyxcbiAgICAgICAgZG93bmxvYWQ6ICdbZGF0YS1wbHlyPVwiZG93bmxvYWRcIl0nLFxuICAgICAgICBmdWxsc2NyZWVuOiAnW2RhdGEtcGx5cj1cImZ1bGxzY3JlZW5cIl0nLFxuICAgICAgICBwaXA6ICdbZGF0YS1wbHlyPVwicGlwXCJdJyxcbiAgICAgICAgYWlycGxheTogJ1tkYXRhLXBseXI9XCJhaXJwbGF5XCJdJyxcbiAgICAgICAgc2V0dGluZ3M6ICdbZGF0YS1wbHlyPVwic2V0dGluZ3NcIl0nLFxuICAgICAgICBsb29wOiAnW2RhdGEtcGx5cj1cImxvb3BcIl0nXG4gICAgICB9LFxuICAgICAgaW5wdXRzOiB7XG4gICAgICAgIHNlZWs6ICdbZGF0YS1wbHlyPVwic2Vla1wiXScsXG4gICAgICAgIHZvbHVtZTogJ1tkYXRhLXBseXI9XCJ2b2x1bWVcIl0nLFxuICAgICAgICBzcGVlZDogJ1tkYXRhLXBseXI9XCJzcGVlZFwiXScsXG4gICAgICAgIGxhbmd1YWdlOiAnW2RhdGEtcGx5cj1cImxhbmd1YWdlXCJdJyxcbiAgICAgICAgcXVhbGl0eTogJ1tkYXRhLXBseXI9XCJxdWFsaXR5XCJdJ1xuICAgICAgfSxcbiAgICAgIGRpc3BsYXk6IHtcbiAgICAgICAgY3VycmVudFRpbWU6ICcucGx5cl9fdGltZS0tY3VycmVudCcsXG4gICAgICAgIGR1cmF0aW9uOiAnLnBseXJfX3RpbWUtLWR1cmF0aW9uJyxcbiAgICAgICAgYnVmZmVyOiAnLnBseXJfX3Byb2dyZXNzX19idWZmZXInLFxuICAgICAgICBsb29wOiAnLnBseXJfX3Byb2dyZXNzX19sb29wJyxcbiAgICAgICAgLy8gVXNlZCBsYXRlclxuICAgICAgICB2b2x1bWU6ICcucGx5cl9fdm9sdW1lLS1kaXNwbGF5J1xuICAgICAgfSxcbiAgICAgIHByb2dyZXNzOiAnLnBseXJfX3Byb2dyZXNzJyxcbiAgICAgIGNhcHRpb25zOiAnLnBseXJfX2NhcHRpb25zJyxcbiAgICAgIGNhcHRpb246ICcucGx5cl9fY2FwdGlvbidcbiAgICB9LFxuICAgIC8vIENsYXNzIGhvb2tzIGFkZGVkIHRvIHRoZSBwbGF5ZXIgaW4gZGlmZmVyZW50IHN0YXRlc1xuICAgIGNsYXNzTmFtZXM6IHtcbiAgICAgIHR5cGU6ICdwbHlyLS17MH0nLFxuICAgICAgcHJvdmlkZXI6ICdwbHlyLS17MH0nLFxuICAgICAgdmlkZW86ICdwbHlyX192aWRlby13cmFwcGVyJyxcbiAgICAgIGVtYmVkOiAncGx5cl9fdmlkZW8tZW1iZWQnLFxuICAgICAgdmlkZW9GaXhlZFJhdGlvOiAncGx5cl9fdmlkZW8td3JhcHBlci0tZml4ZWQtcmF0aW8nLFxuICAgICAgZW1iZWRDb250YWluZXI6ICdwbHlyX192aWRlby1lbWJlZF9fY29udGFpbmVyJyxcbiAgICAgIHBvc3RlcjogJ3BseXJfX3Bvc3RlcicsXG4gICAgICBwb3N0ZXJFbmFibGVkOiAncGx5cl9fcG9zdGVyLWVuYWJsZWQnLFxuICAgICAgYWRzOiAncGx5cl9fYWRzJyxcbiAgICAgIGNvbnRyb2w6ICdwbHlyX19jb250cm9sJyxcbiAgICAgIGNvbnRyb2xQcmVzc2VkOiAncGx5cl9fY29udHJvbC0tcHJlc3NlZCcsXG4gICAgICBwbGF5aW5nOiAncGx5ci0tcGxheWluZycsXG4gICAgICBwYXVzZWQ6ICdwbHlyLS1wYXVzZWQnLFxuICAgICAgc3RvcHBlZDogJ3BseXItLXN0b3BwZWQnLFxuICAgICAgbG9hZGluZzogJ3BseXItLWxvYWRpbmcnLFxuICAgICAgaG92ZXI6ICdwbHlyLS1ob3ZlcicsXG4gICAgICB0b29sdGlwOiAncGx5cl9fdG9vbHRpcCcsXG4gICAgICBjdWVzOiAncGx5cl9fY3VlcycsXG4gICAgICBtYXJrZXI6ICdwbHlyX19wcm9ncmVzc19fbWFya2VyJyxcbiAgICAgIGhpZGRlbjogJ3BseXJfX3NyLW9ubHknLFxuICAgICAgaGlkZUNvbnRyb2xzOiAncGx5ci0taGlkZS1jb250cm9scycsXG4gICAgICBpc0lvczogJ3BseXItLWlzLWlvcycsXG4gICAgICBpc1RvdWNoOiAncGx5ci0taXMtdG91Y2gnLFxuICAgICAgdWlTdXBwb3J0ZWQ6ICdwbHlyLS1mdWxsLXVpJyxcbiAgICAgIG5vVHJhbnNpdGlvbjogJ3BseXItLW5vLXRyYW5zaXRpb24nLFxuICAgICAgZGlzcGxheToge1xuICAgICAgICB0aW1lOiAncGx5cl9fdGltZSdcbiAgICAgIH0sXG4gICAgICBtZW51OiB7XG4gICAgICAgIHZhbHVlOiAncGx5cl9fbWVudV9fdmFsdWUnLFxuICAgICAgICBiYWRnZTogJ3BseXJfX2JhZGdlJyxcbiAgICAgICAgb3BlbjogJ3BseXItLW1lbnUtb3BlbidcbiAgICAgIH0sXG4gICAgICBjYXB0aW9uczoge1xuICAgICAgICBlbmFibGVkOiAncGx5ci0tY2FwdGlvbnMtZW5hYmxlZCcsXG4gICAgICAgIGFjdGl2ZTogJ3BseXItLWNhcHRpb25zLWFjdGl2ZSdcbiAgICAgIH0sXG4gICAgICBmdWxsc2NyZWVuOiB7XG4gICAgICAgIGVuYWJsZWQ6ICdwbHlyLS1mdWxsc2NyZWVuLWVuYWJsZWQnLFxuICAgICAgICBmYWxsYmFjazogJ3BseXItLWZ1bGxzY3JlZW4tZmFsbGJhY2snXG4gICAgICB9LFxuICAgICAgcGlwOiB7XG4gICAgICAgIHN1cHBvcnRlZDogJ3BseXItLXBpcC1zdXBwb3J0ZWQnLFxuICAgICAgICBhY3RpdmU6ICdwbHlyLS1waXAtYWN0aXZlJ1xuICAgICAgfSxcbiAgICAgIGFpcnBsYXk6IHtcbiAgICAgICAgc3VwcG9ydGVkOiAncGx5ci0tYWlycGxheS1zdXBwb3J0ZWQnLFxuICAgICAgICBhY3RpdmU6ICdwbHlyLS1haXJwbGF5LWFjdGl2ZSdcbiAgICAgIH0sXG4gICAgICB0YWJGb2N1czogJ3BseXJfX3RhYi1mb2N1cycsXG4gICAgICBwcmV2aWV3VGh1bWJuYWlsczoge1xuICAgICAgICAvLyBUb29sdGlwIHRodW1ic1xuICAgICAgICB0aHVtYkNvbnRhaW5lcjogJ3BseXJfX3ByZXZpZXctdGh1bWInLFxuICAgICAgICB0aHVtYkNvbnRhaW5lclNob3duOiAncGx5cl9fcHJldmlldy10aHVtYi0taXMtc2hvd24nLFxuICAgICAgICBpbWFnZUNvbnRhaW5lcjogJ3BseXJfX3ByZXZpZXctdGh1bWJfX2ltYWdlLWNvbnRhaW5lcicsXG4gICAgICAgIHRpbWVDb250YWluZXI6ICdwbHlyX19wcmV2aWV3LXRodW1iX190aW1lLWNvbnRhaW5lcicsXG4gICAgICAgIC8vIFNjcnViYmluZ1xuICAgICAgICBzY3J1YmJpbmdDb250YWluZXI6ICdwbHlyX19wcmV2aWV3LXNjcnViYmluZycsXG4gICAgICAgIHNjcnViYmluZ0NvbnRhaW5lclNob3duOiAncGx5cl9fcHJldmlldy1zY3J1YmJpbmctLWlzLXNob3duJ1xuICAgICAgfVxuICAgIH0sXG4gICAgLy8gRW1iZWQgYXR0cmlidXRlc1xuICAgIGF0dHJpYnV0ZXM6IHtcbiAgICAgIGVtYmVkOiB7XG4gICAgICAgIHByb3ZpZGVyOiAnZGF0YS1wbHlyLXByb3ZpZGVyJyxcbiAgICAgICAgaWQ6ICdkYXRhLXBseXItZW1iZWQtaWQnLFxuICAgICAgICBoYXNoOiAnZGF0YS1wbHlyLWVtYmVkLWhhc2gnXG4gICAgICB9XG4gICAgfSxcbiAgICAvLyBBZHZlcnRpc2VtZW50cyBwbHVnaW5cbiAgICAvLyBSZWdpc3RlciBmb3IgYW4gYWNjb3VudCBoZXJlOiBodHRwOi8vdmkuYWkvcHVibGlzaGVyLXZpZGVvLW1vbmV0aXphdGlvbi8/YWlkPXBseXJpb1xuICAgIGFkczoge1xuICAgICAgZW5hYmxlZDogZmFsc2UsXG4gICAgICBwdWJsaXNoZXJJZDogJycsXG4gICAgICB0YWdVcmw6ICcnXG4gICAgfSxcbiAgICAvLyBQcmV2aWV3IFRodW1ibmFpbHMgcGx1Z2luXG4gICAgcHJldmlld1RodW1ibmFpbHM6IHtcbiAgICAgIGVuYWJsZWQ6IGZhbHNlLFxuICAgICAgc3JjOiAnJ1xuICAgIH0sXG4gICAgLy8gVmltZW8gcGx1Z2luXG4gICAgdmltZW86IHtcbiAgICAgIGJ5bGluZTogZmFsc2UsXG4gICAgICBwb3J0cmFpdDogZmFsc2UsXG4gICAgICB0aXRsZTogZmFsc2UsXG4gICAgICBzcGVlZDogdHJ1ZSxcbiAgICAgIHRyYW5zcGFyZW50OiBmYWxzZSxcbiAgICAgIC8vIEN1c3RvbSBzZXR0aW5ncyBmcm9tIFBseXJcbiAgICAgIGN1c3RvbUNvbnRyb2xzOiB0cnVlLFxuICAgICAgcmVmZXJyZXJQb2xpY3k6IG51bGwsXG4gICAgICAvLyBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvSFRNTElGcmFtZUVsZW1lbnQvcmVmZXJyZXJQb2xpY3lcbiAgICAgIC8vIFdoZXRoZXIgdGhlIG93bmVyIG9mIHRoZSB2aWRlbyBoYXMgYSBQcm8gb3IgQnVzaW5lc3MgYWNjb3VudFxuICAgICAgLy8gKHdoaWNoIGFsbG93cyB1cyB0byBwcm9wZXJseSBoaWRlIGNvbnRyb2xzIHdpdGhvdXQgQ1NTIGhhY2tzLCBldGMpXG4gICAgICBwcmVtaXVtOiBmYWxzZVxuICAgIH0sXG4gICAgLy8gWW91VHViZSBwbHVnaW5cbiAgICB5b3V0dWJlOiB7XG4gICAgICByZWw6IDAsXG4gICAgICAvLyBObyByZWxhdGVkIHZpZHNcbiAgICAgIHNob3dpbmZvOiAwLFxuICAgICAgLy8gSGlkZSBpbmZvXG4gICAgICBpdl9sb2FkX3BvbGljeTogMyxcbiAgICAgIC8vIEhpZGUgYW5ub3RhdGlvbnNcbiAgICAgIG1vZGVzdGJyYW5kaW5nOiAxLFxuICAgICAgLy8gSGlkZSBsb2dvcyBhcyBtdWNoIGFzIHBvc3NpYmxlICh0aGV5IHN0aWxsIHNob3cgb25lIGluIHRoZSBjb3JuZXIgd2hlbiBwYXVzZWQpXG4gICAgICAvLyBDdXN0b20gc2V0dGluZ3MgZnJvbSBQbHlyXG4gICAgICBjdXN0b21Db250cm9sczogdHJ1ZSxcbiAgICAgIG5vQ29va2llOiBmYWxzZSAvLyBXaGV0aGVyIHRvIHVzZSBhbiBhbHRlcm5hdGl2ZSB2ZXJzaW9uIG9mIFlvdVR1YmUgd2l0aG91dCBjb29raWVzXG5cbiAgICB9LFxuICAgIC8vIE1lZGlhIE1ldGFkYXRhXG4gICAgbWVkaWFNZXRhZGF0YToge1xuICAgICAgdGl0bGU6ICcnLFxuICAgICAgYXJ0aXN0OiAnJyxcbiAgICAgIGFsYnVtOiAnJyxcbiAgICAgIGFydHdvcms6IFtdXG4gICAgfSxcbiAgICAvLyBNYXJrZXJzXG4gICAgbWFya2Vyczoge1xuICAgICAgZW5hYmxlZDogZmFsc2UsXG4gICAgICBwb2ludHM6IFtdXG4gICAgfVxuICB9O1xuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vIFBseXIgc3RhdGVzXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIGNvbnN0IHBpcCA9IHtcbiAgICBhY3RpdmU6ICdwaWN0dXJlLWluLXBpY3R1cmUnLFxuICAgIGluYWN0aXZlOiAnaW5saW5lJ1xuICB9O1xuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vIFBseXIgc3VwcG9ydGVkIHR5cGVzIGFuZCBwcm92aWRlcnNcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgY29uc3QgcHJvdmlkZXJzID0ge1xuICAgIGh0bWw1OiAnaHRtbDUnLFxuICAgIHlvdXR1YmU6ICd5b3V0dWJlJyxcbiAgICB2aW1lbzogJ3ZpbWVvJ1xuICB9O1xuICBjb25zdCB0eXBlcyA9IHtcbiAgICBhdWRpbzogJ2F1ZGlvJyxcbiAgICB2aWRlbzogJ3ZpZGVvJ1xuICB9O1xuICAvKipcbiAgICogR2V0IHByb3ZpZGVyIGJ5IFVSTFxuICAgKiBAcGFyYW0ge1N0cmluZ30gdXJsXG4gICAqL1xuXG4gIGZ1bmN0aW9uIGdldFByb3ZpZGVyQnlVcmwodXJsKSB7XG4gICAgLy8gWW91VHViZVxuICAgIGlmICgvXihodHRwcz86XFwvXFwvKT8od3d3XFwuKT8oeW91dHViZVxcLmNvbXx5b3V0dWJlLW5vY29va2llXFwuY29tfHlvdXR1XFwuP2JlKVxcLy4rJC8udGVzdCh1cmwpKSB7XG4gICAgICByZXR1cm4gcHJvdmlkZXJzLnlvdXR1YmU7XG4gICAgfSAvLyBWaW1lb1xuXG5cbiAgICBpZiAoL15odHRwcz86XFwvXFwvcGxheWVyLnZpbWVvLmNvbVxcL3ZpZGVvXFwvXFxkezAsOX0oPz1cXGJ8XFwvKS8udGVzdCh1cmwpKSB7XG4gICAgICByZXR1cm4gcHJvdmlkZXJzLnZpbWVvO1xuICAgIH1cblxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8gQ29uc29sZSB3cmFwcGVyXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIGNvbnN0IG5vb3AgPSAoKSA9PiB7fTtcblxuICBjbGFzcyBDb25zb2xlIHtcbiAgICBjb25zdHJ1Y3RvcihlbmFibGVkID0gZmFsc2UpIHtcbiAgICAgIHRoaXMuZW5hYmxlZCA9IHdpbmRvdy5jb25zb2xlICYmIGVuYWJsZWQ7XG5cbiAgICAgIGlmICh0aGlzLmVuYWJsZWQpIHtcbiAgICAgICAgdGhpcy5sb2coJ0RlYnVnZ2luZyBlbmFibGVkJyk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZ2V0IGxvZygpIHtcbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb25zb2xlXG4gICAgICByZXR1cm4gdGhpcy5lbmFibGVkID8gRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQuY2FsbChjb25zb2xlLmxvZywgY29uc29sZSkgOiBub29wO1xuICAgIH1cblxuICAgIGdldCB3YXJuKCkge1xuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNvbnNvbGVcbiAgICAgIHJldHVybiB0aGlzLmVuYWJsZWQgPyBGdW5jdGlvbi5wcm90b3R5cGUuYmluZC5jYWxsKGNvbnNvbGUud2FybiwgY29uc29sZSkgOiBub29wO1xuICAgIH1cblxuICAgIGdldCBlcnJvcigpIHtcbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb25zb2xlXG4gICAgICByZXR1cm4gdGhpcy5lbmFibGVkID8gRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQuY2FsbChjb25zb2xlLmVycm9yLCBjb25zb2xlKSA6IG5vb3A7XG4gICAgfVxuXG4gIH1cblxuICBjbGFzcyBGdWxsc2NyZWVuIHtcbiAgICBjb25zdHJ1Y3RvcihwbGF5ZXIpIHtcbiAgICAgIF9kZWZpbmVQcm9wZXJ0eSQxKHRoaXMsIFwib25DaGFuZ2VcIiwgKCkgPT4ge1xuICAgICAgICBpZiAoIXRoaXMuZW5hYmxlZCkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfSAvLyBVcGRhdGUgdG9nZ2xlIGJ1dHRvblxuXG5cbiAgICAgICAgY29uc3QgYnV0dG9uID0gdGhpcy5wbGF5ZXIuZWxlbWVudHMuYnV0dG9ucy5mdWxsc2NyZWVuO1xuXG4gICAgICAgIGlmIChpcy5lbGVtZW50KGJ1dHRvbikpIHtcbiAgICAgICAgICBidXR0b24ucHJlc3NlZCA9IHRoaXMuYWN0aXZlO1xuICAgICAgICB9IC8vIEFsd2F5cyB0cmlnZ2VyIGV2ZW50cyBvbiB0aGUgcGx5ciAvIG1lZGlhIGVsZW1lbnQgKG5vdCBhIGZ1bGxzY3JlZW4gY29udGFpbmVyKSBhbmQgbGV0IHRoZW0gYnViYmxlIHVwXG5cblxuICAgICAgICBjb25zdCB0YXJnZXQgPSB0aGlzLnRhcmdldCA9PT0gdGhpcy5wbGF5ZXIubWVkaWEgPyB0aGlzLnRhcmdldCA6IHRoaXMucGxheWVyLmVsZW1lbnRzLmNvbnRhaW5lcjsgLy8gVHJpZ2dlciBhbiBldmVudFxuXG4gICAgICAgIHRyaWdnZXJFdmVudC5jYWxsKHRoaXMucGxheWVyLCB0YXJnZXQsIHRoaXMuYWN0aXZlID8gJ2VudGVyZnVsbHNjcmVlbicgOiAnZXhpdGZ1bGxzY3JlZW4nLCB0cnVlKTtcbiAgICAgIH0pO1xuXG4gICAgICBfZGVmaW5lUHJvcGVydHkkMSh0aGlzLCBcInRvZ2dsZUZhbGxiYWNrXCIsICh0b2dnbGUgPSBmYWxzZSkgPT4ge1xuICAgICAgICAvLyBTdG9yZSBvciByZXN0b3JlIHNjcm9sbCBwb3NpdGlvblxuICAgICAgICBpZiAodG9nZ2xlKSB7XG4gICAgICAgICAgdGhpcy5zY3JvbGxQb3NpdGlvbiA9IHtcbiAgICAgICAgICAgIHg6IHdpbmRvdy5zY3JvbGxYIHx8IDAsXG4gICAgICAgICAgICB5OiB3aW5kb3cuc2Nyb2xsWSB8fCAwXG4gICAgICAgICAgfTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB3aW5kb3cuc2Nyb2xsVG8odGhpcy5zY3JvbGxQb3NpdGlvbi54LCB0aGlzLnNjcm9sbFBvc2l0aW9uLnkpO1xuICAgICAgICB9IC8vIFRvZ2dsZSBzY3JvbGxcblxuXG4gICAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUub3ZlcmZsb3cgPSB0b2dnbGUgPyAnaGlkZGVuJyA6ICcnOyAvLyBUb2dnbGUgY2xhc3MgaG9va1xuXG4gICAgICAgIHRvZ2dsZUNsYXNzKHRoaXMudGFyZ2V0LCB0aGlzLnBsYXllci5jb25maWcuY2xhc3NOYW1lcy5mdWxsc2NyZWVuLmZhbGxiYWNrLCB0b2dnbGUpOyAvLyBGb3JjZSBmdWxsIHZpZXdwb3J0IG9uIGlQaG9uZSBYK1xuXG4gICAgICAgIGlmIChicm93c2VyLmlzSW9zKSB7XG4gICAgICAgICAgbGV0IHZpZXdwb3J0ID0gZG9jdW1lbnQuaGVhZC5xdWVyeVNlbGVjdG9yKCdtZXRhW25hbWU9XCJ2aWV3cG9ydFwiXScpO1xuICAgICAgICAgIGNvbnN0IHByb3BlcnR5ID0gJ3ZpZXdwb3J0LWZpdD1jb3Zlcic7IC8vIEluamVjdCB0aGUgdmlld3BvcnQgbWV0YSBpZiByZXF1aXJlZFxuXG4gICAgICAgICAgaWYgKCF2aWV3cG9ydCkge1xuICAgICAgICAgICAgdmlld3BvcnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdtZXRhJyk7XG4gICAgICAgICAgICB2aWV3cG9ydC5zZXRBdHRyaWJ1dGUoJ25hbWUnLCAndmlld3BvcnQnKTtcbiAgICAgICAgICB9IC8vIENoZWNrIGlmIHRoZSBwcm9wZXJ0eSBhbHJlYWR5IGV4aXN0c1xuXG5cbiAgICAgICAgICBjb25zdCBoYXNQcm9wZXJ0eSA9IGlzLnN0cmluZyh2aWV3cG9ydC5jb250ZW50KSAmJiB2aWV3cG9ydC5jb250ZW50LmluY2x1ZGVzKHByb3BlcnR5KTtcblxuICAgICAgICAgIGlmICh0b2dnbGUpIHtcbiAgICAgICAgICAgIHRoaXMuY2xlYW51cFZpZXdwb3J0ID0gIWhhc1Byb3BlcnR5O1xuXG4gICAgICAgICAgICBpZiAoIWhhc1Byb3BlcnR5KSB7XG4gICAgICAgICAgICAgIHZpZXdwb3J0LmNvbnRlbnQgKz0gYCwke3Byb3BlcnR5fWA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmNsZWFudXBWaWV3cG9ydCkge1xuICAgICAgICAgICAgdmlld3BvcnQuY29udGVudCA9IHZpZXdwb3J0LmNvbnRlbnQuc3BsaXQoJywnKS5maWx0ZXIocGFydCA9PiBwYXJ0LnRyaW0oKSAhPT0gcHJvcGVydHkpLmpvaW4oJywnKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gLy8gVG9nZ2xlIGJ1dHRvbiBhbmQgZmlyZSBldmVudHNcblxuXG4gICAgICAgIHRoaXMub25DaGFuZ2UoKTtcbiAgICAgIH0pO1xuXG4gICAgICBfZGVmaW5lUHJvcGVydHkkMSh0aGlzLCBcInRyYXBGb2N1c1wiLCBldmVudCA9PiB7XG4gICAgICAgIC8vIEJhaWwgaWYgaU9TLCBub3QgYWN0aXZlLCBub3QgdGhlIHRhYiBrZXlcbiAgICAgICAgaWYgKGJyb3dzZXIuaXNJb3MgfHwgIXRoaXMuYWN0aXZlIHx8IGV2ZW50LmtleSAhPT0gJ1RhYicpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH0gLy8gR2V0IHRoZSBjdXJyZW50IGZvY3VzZWQgZWxlbWVudFxuXG5cbiAgICAgICAgY29uc3QgZm9jdXNlZCA9IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQ7XG4gICAgICAgIGNvbnN0IGZvY3VzYWJsZSA9IGdldEVsZW1lbnRzLmNhbGwodGhpcy5wbGF5ZXIsICdhW2hyZWZdLCBidXR0b246bm90KDpkaXNhYmxlZCksIGlucHV0Om5vdCg6ZGlzYWJsZWQpLCBbdGFiaW5kZXhdJyk7XG4gICAgICAgIGNvbnN0IFtmaXJzdF0gPSBmb2N1c2FibGU7XG4gICAgICAgIGNvbnN0IGxhc3QgPSBmb2N1c2FibGVbZm9jdXNhYmxlLmxlbmd0aCAtIDFdO1xuXG4gICAgICAgIGlmIChmb2N1c2VkID09PSBsYXN0ICYmICFldmVudC5zaGlmdEtleSkge1xuICAgICAgICAgIC8vIE1vdmUgZm9jdXMgdG8gZmlyc3QgZWxlbWVudCB0aGF0IGNhbiBiZSB0YWJiZWQgaWYgU2hpZnQgaXNuJ3QgdXNlZFxuICAgICAgICAgIGZpcnN0LmZvY3VzKCk7XG4gICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgfSBlbHNlIGlmIChmb2N1c2VkID09PSBmaXJzdCAmJiBldmVudC5zaGlmdEtleSkge1xuICAgICAgICAgIC8vIE1vdmUgZm9jdXMgdG8gbGFzdCBlbGVtZW50IHRoYXQgY2FuIGJlIHRhYmJlZCBpZiBTaGlmdCBpcyB1c2VkXG4gICAgICAgICAgbGFzdC5mb2N1cygpO1xuICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICBfZGVmaW5lUHJvcGVydHkkMSh0aGlzLCBcInVwZGF0ZVwiLCAoKSA9PiB7XG4gICAgICAgIGlmICh0aGlzLmVuYWJsZWQpIHtcbiAgICAgICAgICBsZXQgbW9kZTtcblxuICAgICAgICAgIGlmICh0aGlzLmZvcmNlRmFsbGJhY2spIHtcbiAgICAgICAgICAgIG1vZGUgPSAnRmFsbGJhY2sgKGZvcmNlZCknO1xuICAgICAgICAgIH0gZWxzZSBpZiAoRnVsbHNjcmVlbi5uYXRpdmUpIHtcbiAgICAgICAgICAgIG1vZGUgPSAnTmF0aXZlJztcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbW9kZSA9ICdGYWxsYmFjayc7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdGhpcy5wbGF5ZXIuZGVidWcubG9nKGAke21vZGV9IGZ1bGxzY3JlZW4gZW5hYmxlZGApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMucGxheWVyLmRlYnVnLmxvZygnRnVsbHNjcmVlbiBub3Qgc3VwcG9ydGVkIGFuZCBmYWxsYmFjayBkaXNhYmxlZCcpO1xuICAgICAgICB9IC8vIEFkZCBzdHlsaW5nIGhvb2sgdG8gc2hvdyBidXR0b25cblxuXG4gICAgICAgIHRvZ2dsZUNsYXNzKHRoaXMucGxheWVyLmVsZW1lbnRzLmNvbnRhaW5lciwgdGhpcy5wbGF5ZXIuY29uZmlnLmNsYXNzTmFtZXMuZnVsbHNjcmVlbi5lbmFibGVkLCB0aGlzLmVuYWJsZWQpO1xuICAgICAgfSk7XG5cbiAgICAgIF9kZWZpbmVQcm9wZXJ0eSQxKHRoaXMsIFwiZW50ZXJcIiwgKCkgPT4ge1xuICAgICAgICBpZiAoIXRoaXMuZW5hYmxlZCkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfSAvLyBpT1MgbmF0aXZlIGZ1bGxzY3JlZW4gZG9lc24ndCBuZWVkIHRoZSByZXF1ZXN0IHN0ZXBcblxuXG4gICAgICAgIGlmIChicm93c2VyLmlzSW9zICYmIHRoaXMucGxheWVyLmNvbmZpZy5mdWxsc2NyZWVuLmlvc05hdGl2ZSkge1xuICAgICAgICAgIGlmICh0aGlzLnBsYXllci5pc1ZpbWVvKSB7XG4gICAgICAgICAgICB0aGlzLnBsYXllci5lbWJlZC5yZXF1ZXN0RnVsbHNjcmVlbigpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnRhcmdldC53ZWJraXRFbnRlckZ1bGxzY3JlZW4oKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoIUZ1bGxzY3JlZW4ubmF0aXZlIHx8IHRoaXMuZm9yY2VGYWxsYmFjaykge1xuICAgICAgICAgIHRoaXMudG9nZ2xlRmFsbGJhY2sodHJ1ZSk7XG4gICAgICAgIH0gZWxzZSBpZiAoIXRoaXMucHJlZml4KSB7XG4gICAgICAgICAgdGhpcy50YXJnZXQucmVxdWVzdEZ1bGxzY3JlZW4oe1xuICAgICAgICAgICAgbmF2aWdhdGlvblVJOiAnaGlkZSdcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIGlmICghaXMuZW1wdHkodGhpcy5wcmVmaXgpKSB7XG4gICAgICAgICAgdGhpcy50YXJnZXRbYCR7dGhpcy5wcmVmaXh9UmVxdWVzdCR7dGhpcy5wcm9wZXJ0eX1gXSgpO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgX2RlZmluZVByb3BlcnR5JDEodGhpcywgXCJleGl0XCIsICgpID0+IHtcbiAgICAgICAgaWYgKCF0aGlzLmVuYWJsZWQpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH0gLy8gaU9TIG5hdGl2ZSBmdWxsc2NyZWVuXG5cblxuICAgICAgICBpZiAoYnJvd3Nlci5pc0lvcyAmJiB0aGlzLnBsYXllci5jb25maWcuZnVsbHNjcmVlbi5pb3NOYXRpdmUpIHtcbiAgICAgICAgICB0aGlzLnRhcmdldC53ZWJraXRFeGl0RnVsbHNjcmVlbigpO1xuICAgICAgICAgIHNpbGVuY2VQcm9taXNlKHRoaXMucGxheWVyLnBsYXkoKSk7XG4gICAgICAgIH0gZWxzZSBpZiAoIUZ1bGxzY3JlZW4ubmF0aXZlIHx8IHRoaXMuZm9yY2VGYWxsYmFjaykge1xuICAgICAgICAgIHRoaXMudG9nZ2xlRmFsbGJhY2soZmFsc2UpO1xuICAgICAgICB9IGVsc2UgaWYgKCF0aGlzLnByZWZpeCkge1xuICAgICAgICAgIChkb2N1bWVudC5jYW5jZWxGdWxsU2NyZWVuIHx8IGRvY3VtZW50LmV4aXRGdWxsc2NyZWVuKS5jYWxsKGRvY3VtZW50KTtcbiAgICAgICAgfSBlbHNlIGlmICghaXMuZW1wdHkodGhpcy5wcmVmaXgpKSB7XG4gICAgICAgICAgY29uc3QgYWN0aW9uID0gdGhpcy5wcmVmaXggPT09ICdtb3onID8gJ0NhbmNlbCcgOiAnRXhpdCc7XG4gICAgICAgICAgZG9jdW1lbnRbYCR7dGhpcy5wcmVmaXh9JHthY3Rpb259JHt0aGlzLnByb3BlcnR5fWBdKCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICBfZGVmaW5lUHJvcGVydHkkMSh0aGlzLCBcInRvZ2dsZVwiLCAoKSA9PiB7XG4gICAgICAgIGlmICghdGhpcy5hY3RpdmUpIHtcbiAgICAgICAgICB0aGlzLmVudGVyKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5leGl0KCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICAvLyBLZWVwIHJlZmVyZW5jZSB0byBwYXJlbnRcbiAgICAgIHRoaXMucGxheWVyID0gcGxheWVyOyAvLyBHZXQgcHJlZml4XG5cbiAgICAgIHRoaXMucHJlZml4ID0gRnVsbHNjcmVlbi5wcmVmaXg7XG4gICAgICB0aGlzLnByb3BlcnR5ID0gRnVsbHNjcmVlbi5wcm9wZXJ0eTsgLy8gU2Nyb2xsIHBvc2l0aW9uXG5cbiAgICAgIHRoaXMuc2Nyb2xsUG9zaXRpb24gPSB7XG4gICAgICAgIHg6IDAsXG4gICAgICAgIHk6IDBcbiAgICAgIH07IC8vIEZvcmNlIHRoZSB1c2Ugb2YgJ2Z1bGwgd2luZG93L2Jyb3dzZXInIHJhdGhlciB0aGFuIGZ1bGxzY3JlZW5cblxuICAgICAgdGhpcy5mb3JjZUZhbGxiYWNrID0gcGxheWVyLmNvbmZpZy5mdWxsc2NyZWVuLmZhbGxiYWNrID09PSAnZm9yY2UnOyAvLyBHZXQgdGhlIGZ1bGxzY3JlZW4gZWxlbWVudFxuICAgICAgLy8gQ2hlY2tzIGNvbnRhaW5lciBpcyBhbiBhbmNlc3RvciwgZGVmYXVsdHMgdG8gbnVsbFxuXG4gICAgICB0aGlzLnBsYXllci5lbGVtZW50cy5mdWxsc2NyZWVuID0gcGxheWVyLmNvbmZpZy5mdWxsc2NyZWVuLmNvbnRhaW5lciAmJiBjbG9zZXN0JDEodGhpcy5wbGF5ZXIuZWxlbWVudHMuY29udGFpbmVyLCBwbGF5ZXIuY29uZmlnLmZ1bGxzY3JlZW4uY29udGFpbmVyKTsgLy8gUmVnaXN0ZXIgZXZlbnQgbGlzdGVuZXJzXG4gICAgICAvLyBIYW5kbGUgZXZlbnQgKGluY2FzZSB1c2VyIHByZXNzZXMgZXNjYXBlIGV0YylcblxuICAgICAgb24uY2FsbCh0aGlzLnBsYXllciwgZG9jdW1lbnQsIHRoaXMucHJlZml4ID09PSAnbXMnID8gJ01TRnVsbHNjcmVlbkNoYW5nZScgOiBgJHt0aGlzLnByZWZpeH1mdWxsc2NyZWVuY2hhbmdlYCwgKCkgPT4ge1xuICAgICAgICAvLyBUT0RPOiBGaWx0ZXIgZm9yIHRhcmdldD8/XG4gICAgICAgIHRoaXMub25DaGFuZ2UoKTtcbiAgICAgIH0pOyAvLyBGdWxsc2NyZWVuIHRvZ2dsZSBvbiBkb3VibGUgY2xpY2tcblxuICAgICAgb24uY2FsbCh0aGlzLnBsYXllciwgdGhpcy5wbGF5ZXIuZWxlbWVudHMuY29udGFpbmVyLCAnZGJsY2xpY2snLCBldmVudCA9PiB7XG4gICAgICAgIC8vIElnbm9yZSBkb3VibGUgY2xpY2sgaW4gY29udHJvbHNcbiAgICAgICAgaWYgKGlzLmVsZW1lbnQodGhpcy5wbGF5ZXIuZWxlbWVudHMuY29udHJvbHMpICYmIHRoaXMucGxheWVyLmVsZW1lbnRzLmNvbnRyb2xzLmNvbnRhaW5zKGV2ZW50LnRhcmdldCkpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnBsYXllci5saXN0ZW5lcnMucHJveHkoZXZlbnQsIHRoaXMudG9nZ2xlLCAnZnVsbHNjcmVlbicpO1xuICAgICAgfSk7IC8vIFRhcCBmb2N1cyB3aGVuIGluIGZ1bGxzY3JlZW5cblxuICAgICAgb24uY2FsbCh0aGlzLCB0aGlzLnBsYXllci5lbGVtZW50cy5jb250YWluZXIsICdrZXlkb3duJywgZXZlbnQgPT4gdGhpcy50cmFwRm9jdXMoZXZlbnQpKTsgLy8gVXBkYXRlIHRoZSBVSVxuXG4gICAgICB0aGlzLnVwZGF0ZSgpOyAvLyB0aGlzLnRvZ2dsZSA9IHRoaXMudG9nZ2xlLmJpbmQodGhpcyk7XG4gICAgfSAvLyBEZXRlcm1pbmUgaWYgbmF0aXZlIHN1cHBvcnRlZFxuXG5cbiAgICBzdGF0aWMgZ2V0IG5hdGl2ZSgpIHtcbiAgICAgIHJldHVybiAhIShkb2N1bWVudC5mdWxsc2NyZWVuRW5hYmxlZCB8fCBkb2N1bWVudC53ZWJraXRGdWxsc2NyZWVuRW5hYmxlZCB8fCBkb2N1bWVudC5tb3pGdWxsU2NyZWVuRW5hYmxlZCB8fCBkb2N1bWVudC5tc0Z1bGxzY3JlZW5FbmFibGVkKTtcbiAgICB9IC8vIElmIHdlJ3JlIGFjdHVhbGx5IHVzaW5nIG5hdGl2ZVxuXG5cbiAgICBnZXQgdXNpbmdOYXRpdmUoKSB7XG4gICAgICByZXR1cm4gRnVsbHNjcmVlbi5uYXRpdmUgJiYgIXRoaXMuZm9yY2VGYWxsYmFjaztcbiAgICB9IC8vIEdldCB0aGUgcHJlZml4IGZvciBoYW5kbGVyc1xuXG5cbiAgICBzdGF0aWMgZ2V0IHByZWZpeCgpIHtcbiAgICAgIC8vIE5vIHByZWZpeFxuICAgICAgaWYgKGlzLmZ1bmN0aW9uKGRvY3VtZW50LmV4aXRGdWxsc2NyZWVuKSkge1xuICAgICAgICByZXR1cm4gJyc7XG4gICAgICB9IC8vIENoZWNrIGZvciBmdWxsc2NyZWVuIHN1cHBvcnQgYnkgdmVuZG9yIHByZWZpeFxuXG5cbiAgICAgIGxldCB2YWx1ZSA9ICcnO1xuICAgICAgY29uc3QgcHJlZml4ZXMgPSBbJ3dlYmtpdCcsICdtb3onLCAnbXMnXTtcbiAgICAgIHByZWZpeGVzLnNvbWUocHJlID0+IHtcbiAgICAgICAgaWYgKGlzLmZ1bmN0aW9uKGRvY3VtZW50W2Ake3ByZX1FeGl0RnVsbHNjcmVlbmBdKSB8fCBpcy5mdW5jdGlvbihkb2N1bWVudFtgJHtwcmV9Q2FuY2VsRnVsbFNjcmVlbmBdKSkge1xuICAgICAgICAgIHZhbHVlID0gcHJlO1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gdmFsdWU7XG4gICAgfVxuXG4gICAgc3RhdGljIGdldCBwcm9wZXJ0eSgpIHtcbiAgICAgIHJldHVybiB0aGlzLnByZWZpeCA9PT0gJ21veicgPyAnRnVsbFNjcmVlbicgOiAnRnVsbHNjcmVlbic7XG4gICAgfSAvLyBEZXRlcm1pbmUgaWYgZnVsbHNjcmVlbiBpcyBlbmFibGVkXG5cblxuICAgIGdldCBlbmFibGVkKCkge1xuICAgICAgcmV0dXJuIChGdWxsc2NyZWVuLm5hdGl2ZSB8fCB0aGlzLnBsYXllci5jb25maWcuZnVsbHNjcmVlbi5mYWxsYmFjaykgJiYgdGhpcy5wbGF5ZXIuY29uZmlnLmZ1bGxzY3JlZW4uZW5hYmxlZCAmJiB0aGlzLnBsYXllci5zdXBwb3J0ZWQudWkgJiYgdGhpcy5wbGF5ZXIuaXNWaWRlbztcbiAgICB9IC8vIEdldCBhY3RpdmUgc3RhdGVcblxuXG4gICAgZ2V0IGFjdGl2ZSgpIHtcbiAgICAgIGlmICghdGhpcy5lbmFibGVkKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH0gLy8gRmFsbGJhY2sgdXNpbmcgY2xhc3NuYW1lXG5cblxuICAgICAgaWYgKCFGdWxsc2NyZWVuLm5hdGl2ZSB8fCB0aGlzLmZvcmNlRmFsbGJhY2spIHtcbiAgICAgICAgcmV0dXJuIGhhc0NsYXNzKHRoaXMudGFyZ2V0LCB0aGlzLnBsYXllci5jb25maWcuY2xhc3NOYW1lcy5mdWxsc2NyZWVuLmZhbGxiYWNrKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgZWxlbWVudCA9ICF0aGlzLnByZWZpeCA/IHRoaXMudGFyZ2V0LmdldFJvb3ROb2RlKCkuZnVsbHNjcmVlbkVsZW1lbnQgOiB0aGlzLnRhcmdldC5nZXRSb290Tm9kZSgpW2Ake3RoaXMucHJlZml4fSR7dGhpcy5wcm9wZXJ0eX1FbGVtZW50YF07XG4gICAgICByZXR1cm4gZWxlbWVudCAmJiBlbGVtZW50LnNoYWRvd1Jvb3QgPyBlbGVtZW50ID09PSB0aGlzLnRhcmdldC5nZXRSb290Tm9kZSgpLmhvc3QgOiBlbGVtZW50ID09PSB0aGlzLnRhcmdldDtcbiAgICB9IC8vIEdldCB0YXJnZXQgZWxlbWVudFxuXG5cbiAgICBnZXQgdGFyZ2V0KCkge1xuICAgICAgcmV0dXJuIGJyb3dzZXIuaXNJb3MgJiYgdGhpcy5wbGF5ZXIuY29uZmlnLmZ1bGxzY3JlZW4uaW9zTmF0aXZlID8gdGhpcy5wbGF5ZXIubWVkaWEgOiB0aGlzLnBsYXllci5lbGVtZW50cy5mdWxsc2NyZWVuIHx8IHRoaXMucGxheWVyLmVsZW1lbnRzLmNvbnRhaW5lcjtcbiAgICB9XG5cbiAgfVxuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vIExvYWQgaW1hZ2UgYXZvaWRpbmcgeGhyL2ZldGNoIENPUlMgaXNzdWVzXG4gIC8vIFNlcnZlciBzdGF0dXMgY2FuJ3QgYmUgb2J0YWluZWQgdGhpcyB3YXkgdW5mb3J0dW5hdGVseSwgc28gdGhpcyB1c2VzIFwibmF0dXJhbFdpZHRoXCIgdG8gZGV0ZXJtaW5lIGlmIHRoZSBpbWFnZSBoYXMgbG9hZGVkXG4gIC8vIEJ5IGRlZmF1bHQgaXQgY2hlY2tzIGlmIGl0IGlzIGF0IGxlYXN0IDFweCwgYnV0IHlvdSBjYW4gYWRkIGEgc2Vjb25kIGFyZ3VtZW50IHRvIGNoYW5nZSB0aGlzXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIGZ1bmN0aW9uIGxvYWRJbWFnZShzcmMsIG1pbldpZHRoID0gMSkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICBjb25zdCBpbWFnZSA9IG5ldyBJbWFnZSgpO1xuXG4gICAgICBjb25zdCBoYW5kbGVyID0gKCkgPT4ge1xuICAgICAgICBkZWxldGUgaW1hZ2Uub25sb2FkO1xuICAgICAgICBkZWxldGUgaW1hZ2Uub25lcnJvcjtcbiAgICAgICAgKGltYWdlLm5hdHVyYWxXaWR0aCA+PSBtaW5XaWR0aCA/IHJlc29sdmUgOiByZWplY3QpKGltYWdlKTtcbiAgICAgIH07XG5cbiAgICAgIE9iamVjdC5hc3NpZ24oaW1hZ2UsIHtcbiAgICAgICAgb25sb2FkOiBoYW5kbGVyLFxuICAgICAgICBvbmVycm9yOiBoYW5kbGVyLFxuICAgICAgICBzcmNcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgY29uc3QgdWkgPSB7XG4gICAgYWRkU3R5bGVIb29rKCkge1xuICAgICAgdG9nZ2xlQ2xhc3ModGhpcy5lbGVtZW50cy5jb250YWluZXIsIHRoaXMuY29uZmlnLnNlbGVjdG9ycy5jb250YWluZXIucmVwbGFjZSgnLicsICcnKSwgdHJ1ZSk7XG4gICAgICB0b2dnbGVDbGFzcyh0aGlzLmVsZW1lbnRzLmNvbnRhaW5lciwgdGhpcy5jb25maWcuY2xhc3NOYW1lcy51aVN1cHBvcnRlZCwgdGhpcy5zdXBwb3J0ZWQudWkpO1xuICAgIH0sXG5cbiAgICAvLyBUb2dnbGUgbmF0aXZlIEhUTUw1IG1lZGlhIGNvbnRyb2xzXG4gICAgdG9nZ2xlTmF0aXZlQ29udHJvbHModG9nZ2xlID0gZmFsc2UpIHtcbiAgICAgIGlmICh0b2dnbGUgJiYgdGhpcy5pc0hUTUw1KSB7XG4gICAgICAgIHRoaXMubWVkaWEuc2V0QXR0cmlidXRlKCdjb250cm9scycsICcnKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMubWVkaWEucmVtb3ZlQXR0cmlidXRlKCdjb250cm9scycpO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICAvLyBTZXR1cCB0aGUgVUlcbiAgICBidWlsZCgpIHtcbiAgICAgIC8vIFJlLWF0dGFjaCBtZWRpYSBlbGVtZW50IGxpc3RlbmVyc1xuICAgICAgLy8gVE9ETzogVXNlIGV2ZW50IGJ1YmJsaW5nP1xuICAgICAgdGhpcy5saXN0ZW5lcnMubWVkaWEoKTsgLy8gRG9uJ3Qgc2V0dXAgaW50ZXJmYWNlIGlmIG5vIHN1cHBvcnRcblxuICAgICAgaWYgKCF0aGlzLnN1cHBvcnRlZC51aSkge1xuICAgICAgICB0aGlzLmRlYnVnLndhcm4oYEJhc2ljIHN1cHBvcnQgb25seSBmb3IgJHt0aGlzLnByb3ZpZGVyfSAke3RoaXMudHlwZX1gKTsgLy8gUmVzdG9yZSBuYXRpdmUgY29udHJvbHNcblxuICAgICAgICB1aS50b2dnbGVOYXRpdmVDb250cm9scy5jYWxsKHRoaXMsIHRydWUpOyAvLyBCYWlsXG5cbiAgICAgICAgcmV0dXJuO1xuICAgICAgfSAvLyBJbmplY3QgY3VzdG9tIGNvbnRyb2xzIGlmIG5vdCBwcmVzZW50XG5cblxuICAgICAgaWYgKCFpcy5lbGVtZW50KHRoaXMuZWxlbWVudHMuY29udHJvbHMpKSB7XG4gICAgICAgIC8vIEluamVjdCBjdXN0b20gY29udHJvbHNcbiAgICAgICAgY29udHJvbHMuaW5qZWN0LmNhbGwodGhpcyk7IC8vIFJlLWF0dGFjaCBjb250cm9sIGxpc3RlbmVyc1xuXG4gICAgICAgIHRoaXMubGlzdGVuZXJzLmNvbnRyb2xzKCk7XG4gICAgICB9IC8vIFJlbW92ZSBuYXRpdmUgY29udHJvbHNcblxuXG4gICAgICB1aS50b2dnbGVOYXRpdmVDb250cm9scy5jYWxsKHRoaXMpOyAvLyBTZXR1cCBjYXB0aW9ucyBmb3IgSFRNTDVcblxuICAgICAgaWYgKHRoaXMuaXNIVE1MNSkge1xuICAgICAgICBjYXB0aW9ucy5zZXR1cC5jYWxsKHRoaXMpO1xuICAgICAgfSAvLyBSZXNldCB2b2x1bWVcblxuXG4gICAgICB0aGlzLnZvbHVtZSA9IG51bGw7IC8vIFJlc2V0IG11dGUgc3RhdGVcblxuICAgICAgdGhpcy5tdXRlZCA9IG51bGw7IC8vIFJlc2V0IGxvb3Agc3RhdGVcblxuICAgICAgdGhpcy5sb29wID0gbnVsbDsgLy8gUmVzZXQgcXVhbGl0eSBzZXR0aW5nXG5cbiAgICAgIHRoaXMucXVhbGl0eSA9IG51bGw7IC8vIFJlc2V0IHNwZWVkXG5cbiAgICAgIHRoaXMuc3BlZWQgPSBudWxsOyAvLyBSZXNldCB2b2x1bWUgZGlzcGxheVxuXG4gICAgICBjb250cm9scy51cGRhdGVWb2x1bWUuY2FsbCh0aGlzKTsgLy8gUmVzZXQgdGltZSBkaXNwbGF5XG5cbiAgICAgIGNvbnRyb2xzLnRpbWVVcGRhdGUuY2FsbCh0aGlzKTsgLy8gUmVzZXQgZHVyYXRpb24gZGlzcGxheVxuXG4gICAgICBjb250cm9scy5kdXJhdGlvblVwZGF0ZS5jYWxsKHRoaXMpOyAvLyBVcGRhdGUgdGhlIFVJXG5cbiAgICAgIHVpLmNoZWNrUGxheWluZy5jYWxsKHRoaXMpOyAvLyBDaGVjayBmb3IgcGljdHVyZS1pbi1waWN0dXJlIHN1cHBvcnRcblxuICAgICAgdG9nZ2xlQ2xhc3ModGhpcy5lbGVtZW50cy5jb250YWluZXIsIHRoaXMuY29uZmlnLmNsYXNzTmFtZXMucGlwLnN1cHBvcnRlZCwgc3VwcG9ydC5waXAgJiYgdGhpcy5pc0hUTUw1ICYmIHRoaXMuaXNWaWRlbyk7IC8vIENoZWNrIGZvciBhaXJwbGF5IHN1cHBvcnRcblxuICAgICAgdG9nZ2xlQ2xhc3ModGhpcy5lbGVtZW50cy5jb250YWluZXIsIHRoaXMuY29uZmlnLmNsYXNzTmFtZXMuYWlycGxheS5zdXBwb3J0ZWQsIHN1cHBvcnQuYWlycGxheSAmJiB0aGlzLmlzSFRNTDUpOyAvLyBBZGQgaU9TIGNsYXNzXG5cbiAgICAgIHRvZ2dsZUNsYXNzKHRoaXMuZWxlbWVudHMuY29udGFpbmVyLCB0aGlzLmNvbmZpZy5jbGFzc05hbWVzLmlzSW9zLCBicm93c2VyLmlzSW9zKTsgLy8gQWRkIHRvdWNoIGNsYXNzXG5cbiAgICAgIHRvZ2dsZUNsYXNzKHRoaXMuZWxlbWVudHMuY29udGFpbmVyLCB0aGlzLmNvbmZpZy5jbGFzc05hbWVzLmlzVG91Y2gsIHRoaXMudG91Y2gpOyAvLyBSZWFkeSBmb3IgQVBJIGNhbGxzXG5cbiAgICAgIHRoaXMucmVhZHkgPSB0cnVlOyAvLyBSZWFkeSBldmVudCBhdCBlbmQgb2YgZXhlY3V0aW9uIHN0YWNrXG5cbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICB0cmlnZ2VyRXZlbnQuY2FsbCh0aGlzLCB0aGlzLm1lZGlhLCAncmVhZHknKTtcbiAgICAgIH0sIDApOyAvLyBTZXQgdGhlIHRpdGxlXG5cbiAgICAgIHVpLnNldFRpdGxlLmNhbGwodGhpcyk7IC8vIEFzc3VyZSB0aGUgcG9zdGVyIGltYWdlIGlzIHNldCwgaWYgdGhlIHByb3BlcnR5IHdhcyBhZGRlZCBiZWZvcmUgdGhlIGVsZW1lbnQgd2FzIGNyZWF0ZWRcblxuICAgICAgaWYgKHRoaXMucG9zdGVyKSB7XG4gICAgICAgIHVpLnNldFBvc3Rlci5jYWxsKHRoaXMsIHRoaXMucG9zdGVyLCBmYWxzZSkuY2F0Y2goKCkgPT4ge30pO1xuICAgICAgfSAvLyBNYW51YWxseSBzZXQgdGhlIGR1cmF0aW9uIGlmIHVzZXIgaGFzIG92ZXJyaWRkZW4gaXQuXG4gICAgICAvLyBUaGUgZXZlbnQgbGlzdGVuZXJzIGZvciBpdCBkb2Vzbid0IGdldCBjYWxsZWQgaWYgcHJlbG9hZCBpcyBkaXNhYmxlZCAoIzcwMSlcblxuXG4gICAgICBpZiAodGhpcy5jb25maWcuZHVyYXRpb24pIHtcbiAgICAgICAgY29udHJvbHMuZHVyYXRpb25VcGRhdGUuY2FsbCh0aGlzKTtcbiAgICAgIH0gLy8gTWVkaWEgbWV0YWRhdGFcblxuXG4gICAgICBpZiAodGhpcy5jb25maWcubWVkaWFNZXRhZGF0YSkge1xuICAgICAgICBjb250cm9scy5zZXRNZWRpYU1ldGFkYXRhLmNhbGwodGhpcyk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIC8vIFNldHVwIGFyaWEgYXR0cmlidXRlIGZvciBwbGF5IGFuZCBpZnJhbWUgdGl0bGVcbiAgICBzZXRUaXRsZSgpIHtcbiAgICAgIC8vIEZpbmQgdGhlIGN1cnJlbnQgdGV4dFxuICAgICAgbGV0IGxhYmVsID0gaTE4bi5nZXQoJ3BsYXknLCB0aGlzLmNvbmZpZyk7IC8vIElmIHRoZXJlJ3MgYSBtZWRpYSB0aXRsZSBzZXQsIHVzZSB0aGF0IGZvciB0aGUgbGFiZWxcblxuICAgICAgaWYgKGlzLnN0cmluZyh0aGlzLmNvbmZpZy50aXRsZSkgJiYgIWlzLmVtcHR5KHRoaXMuY29uZmlnLnRpdGxlKSkge1xuICAgICAgICBsYWJlbCArPSBgLCAke3RoaXMuY29uZmlnLnRpdGxlfWA7XG4gICAgICB9IC8vIElmIHRoZXJlJ3MgYSBwbGF5IGJ1dHRvbiwgc2V0IGxhYmVsXG5cblxuICAgICAgQXJyYXkuZnJvbSh0aGlzLmVsZW1lbnRzLmJ1dHRvbnMucGxheSB8fCBbXSkuZm9yRWFjaChidXR0b24gPT4ge1xuICAgICAgICBidXR0b24uc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgbGFiZWwpO1xuICAgICAgfSk7IC8vIFNldCBpZnJhbWUgdGl0bGVcbiAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9zYW1wb3R0cy9wbHlyL2lzc3Vlcy8xMjRcblxuICAgICAgaWYgKHRoaXMuaXNFbWJlZCkge1xuICAgICAgICBjb25zdCBpZnJhbWUgPSBnZXRFbGVtZW50LmNhbGwodGhpcywgJ2lmcmFtZScpO1xuXG4gICAgICAgIGlmICghaXMuZWxlbWVudChpZnJhbWUpKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9IC8vIERlZmF1bHQgdG8gbWVkaWEgdHlwZVxuXG5cbiAgICAgICAgY29uc3QgdGl0bGUgPSAhaXMuZW1wdHkodGhpcy5jb25maWcudGl0bGUpID8gdGhpcy5jb25maWcudGl0bGUgOiAndmlkZW8nO1xuICAgICAgICBjb25zdCBmb3JtYXQgPSBpMThuLmdldCgnZnJhbWVUaXRsZScsIHRoaXMuY29uZmlnKTtcbiAgICAgICAgaWZyYW1lLnNldEF0dHJpYnV0ZSgndGl0bGUnLCBmb3JtYXQucmVwbGFjZSgne3RpdGxlfScsIHRpdGxlKSk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIC8vIFRvZ2dsZSBwb3N0ZXJcbiAgICB0b2dnbGVQb3N0ZXIoZW5hYmxlKSB7XG4gICAgICB0b2dnbGVDbGFzcyh0aGlzLmVsZW1lbnRzLmNvbnRhaW5lciwgdGhpcy5jb25maWcuY2xhc3NOYW1lcy5wb3N0ZXJFbmFibGVkLCBlbmFibGUpO1xuICAgIH0sXG5cbiAgICAvLyBTZXQgdGhlIHBvc3RlciBpbWFnZSAoYXN5bmMpXG4gICAgLy8gVXNlZCBpbnRlcm5hbGx5IGZvciB0aGUgcG9zdGVyIHNldHRlciwgd2l0aCB0aGUgcGFzc2l2ZSBvcHRpb24gZm9yY2VkIHRvIGZhbHNlXG4gICAgc2V0UG9zdGVyKHBvc3RlciwgcGFzc2l2ZSA9IHRydWUpIHtcbiAgICAgIC8vIERvbid0IG92ZXJyaWRlIGlmIGNhbGwgaXMgcGFzc2l2ZVxuICAgICAgaWYgKHBhc3NpdmUgJiYgdGhpcy5wb3N0ZXIpIHtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcignUG9zdGVyIGFscmVhZHkgc2V0JykpO1xuICAgICAgfSAvLyBTZXQgcHJvcGVydHkgc3luY2hyb25vdXNseSB0byByZXNwZWN0IHRoZSBjYWxsIG9yZGVyXG5cblxuICAgICAgdGhpcy5tZWRpYS5zZXRBdHRyaWJ1dGUoJ2RhdGEtcG9zdGVyJywgcG9zdGVyKTsgLy8gU2hvdyB0aGUgcG9zdGVyXG5cbiAgICAgIHRoaXMuZWxlbWVudHMucG9zdGVyLnJlbW92ZUF0dHJpYnV0ZSgnaGlkZGVuJyk7IC8vIFdhaXQgdW50aWwgdWkgaXMgcmVhZHlcblxuICAgICAgcmV0dXJuIHJlYWR5LmNhbGwodGhpcykgLy8gTG9hZCBpbWFnZVxuICAgICAgLnRoZW4oKCkgPT4gbG9hZEltYWdlKHBvc3RlcikpLmNhdGNoKGVycm9yID0+IHtcbiAgICAgICAgLy8gSGlkZSBwb3N0ZXIgb24gZXJyb3IgdW5sZXNzIGl0J3MgYmVlbiBzZXQgYnkgYW5vdGhlciBjYWxsXG4gICAgICAgIGlmIChwb3N0ZXIgPT09IHRoaXMucG9zdGVyKSB7XG4gICAgICAgICAgdWkudG9nZ2xlUG9zdGVyLmNhbGwodGhpcywgZmFsc2UpO1xuICAgICAgICB9IC8vIFJldGhyb3dcblxuXG4gICAgICAgIHRocm93IGVycm9yO1xuICAgICAgfSkudGhlbigoKSA9PiB7XG4gICAgICAgIC8vIFByZXZlbnQgcmFjZSBjb25kaXRpb25zXG4gICAgICAgIGlmIChwb3N0ZXIgIT09IHRoaXMucG9zdGVyKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdzZXRQb3N0ZXIgY2FuY2VsbGVkIGJ5IGxhdGVyIGNhbGwgdG8gc2V0UG9zdGVyJyk7XG4gICAgICAgIH1cbiAgICAgIH0pLnRoZW4oKCkgPT4ge1xuICAgICAgICBPYmplY3QuYXNzaWduKHRoaXMuZWxlbWVudHMucG9zdGVyLnN0eWxlLCB7XG4gICAgICAgICAgYmFja2dyb3VuZEltYWdlOiBgdXJsKCcke3Bvc3Rlcn0nKWAsXG4gICAgICAgICAgLy8gUmVzZXQgYmFja2dyb3VuZFNpemUgYXMgd2VsbCAoc2luY2UgaXQgY2FuIGJlIHNldCB0byBcImNvdmVyXCIgZm9yIHBhZGRlZCB0aHVtYm5haWxzIGZvciB5b3V0dWJlKVxuICAgICAgICAgIGJhY2tncm91bmRTaXplOiAnJ1xuICAgICAgICB9KTtcbiAgICAgICAgdWkudG9nZ2xlUG9zdGVyLmNhbGwodGhpcywgdHJ1ZSk7XG4gICAgICAgIHJldHVybiBwb3N0ZXI7XG4gICAgICB9KTtcbiAgICB9LFxuXG4gICAgLy8gQ2hlY2sgcGxheWluZyBzdGF0ZVxuICAgIGNoZWNrUGxheWluZyhldmVudCkge1xuICAgICAgLy8gQ2xhc3MgaG9va3NcbiAgICAgIHRvZ2dsZUNsYXNzKHRoaXMuZWxlbWVudHMuY29udGFpbmVyLCB0aGlzLmNvbmZpZy5jbGFzc05hbWVzLnBsYXlpbmcsIHRoaXMucGxheWluZyk7XG4gICAgICB0b2dnbGVDbGFzcyh0aGlzLmVsZW1lbnRzLmNvbnRhaW5lciwgdGhpcy5jb25maWcuY2xhc3NOYW1lcy5wYXVzZWQsIHRoaXMucGF1c2VkKTtcbiAgICAgIHRvZ2dsZUNsYXNzKHRoaXMuZWxlbWVudHMuY29udGFpbmVyLCB0aGlzLmNvbmZpZy5jbGFzc05hbWVzLnN0b3BwZWQsIHRoaXMuc3RvcHBlZCk7IC8vIFNldCBzdGF0ZVxuXG4gICAgICBBcnJheS5mcm9tKHRoaXMuZWxlbWVudHMuYnV0dG9ucy5wbGF5IHx8IFtdKS5mb3JFYWNoKHRhcmdldCA9PiB7XG4gICAgICAgIE9iamVjdC5hc3NpZ24odGFyZ2V0LCB7XG4gICAgICAgICAgcHJlc3NlZDogdGhpcy5wbGF5aW5nXG4gICAgICAgIH0pO1xuICAgICAgICB0YXJnZXQuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgaTE4bi5nZXQodGhpcy5wbGF5aW5nID8gJ3BhdXNlJyA6ICdwbGF5JywgdGhpcy5jb25maWcpKTtcbiAgICAgIH0pOyAvLyBPbmx5IHVwZGF0ZSBjb250cm9scyBvbiBub24gdGltZXVwZGF0ZSBldmVudHNcblxuICAgICAgaWYgKGlzLmV2ZW50KGV2ZW50KSAmJiBldmVudC50eXBlID09PSAndGltZXVwZGF0ZScpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfSAvLyBUb2dnbGUgY29udHJvbHNcblxuXG4gICAgICB1aS50b2dnbGVDb250cm9scy5jYWxsKHRoaXMpO1xuICAgIH0sXG5cbiAgICAvLyBDaGVjayBpZiBtZWRpYSBpcyBsb2FkaW5nXG4gICAgY2hlY2tMb2FkaW5nKGV2ZW50KSB7XG4gICAgICB0aGlzLmxvYWRpbmcgPSBbJ3N0YWxsZWQnLCAnd2FpdGluZyddLmluY2x1ZGVzKGV2ZW50LnR5cGUpOyAvLyBDbGVhciB0aW1lclxuXG4gICAgICBjbGVhclRpbWVvdXQodGhpcy50aW1lcnMubG9hZGluZyk7IC8vIFRpbWVyIHRvIHByZXZlbnQgZmxpY2tlciB3aGVuIHNlZWtpbmdcblxuICAgICAgdGhpcy50aW1lcnMubG9hZGluZyA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAvLyBVcGRhdGUgcHJvZ3Jlc3MgYmFyIGxvYWRpbmcgY2xhc3Mgc3RhdGVcbiAgICAgICAgdG9nZ2xlQ2xhc3ModGhpcy5lbGVtZW50cy5jb250YWluZXIsIHRoaXMuY29uZmlnLmNsYXNzTmFtZXMubG9hZGluZywgdGhpcy5sb2FkaW5nKTsgLy8gVXBkYXRlIGNvbnRyb2xzIHZpc2liaWxpdHlcblxuICAgICAgICB1aS50b2dnbGVDb250cm9scy5jYWxsKHRoaXMpO1xuICAgICAgfSwgdGhpcy5sb2FkaW5nID8gMjUwIDogMCk7XG4gICAgfSxcblxuICAgIC8vIFRvZ2dsZSBjb250cm9scyBiYXNlZCBvbiBzdGF0ZSBhbmQgYGZvcmNlYCBhcmd1bWVudFxuICAgIHRvZ2dsZUNvbnRyb2xzKGZvcmNlKSB7XG4gICAgICBjb25zdCB7XG4gICAgICAgIGNvbnRyb2xzOiBjb250cm9sc0VsZW1lbnRcbiAgICAgIH0gPSB0aGlzLmVsZW1lbnRzO1xuXG4gICAgICBpZiAoY29udHJvbHNFbGVtZW50ICYmIHRoaXMuY29uZmlnLmhpZGVDb250cm9scykge1xuICAgICAgICAvLyBEb24ndCBoaWRlIGNvbnRyb2xzIGlmIGEgdG91Y2gtZGV2aWNlIHVzZXIgcmVjZW50bHkgc2Vla2VkLiAoTXVzdCBiZSBsaW1pdGVkIHRvIHRvdWNoIGRldmljZXMsIG9yIGl0IG9jY2FzaW9uYWxseSBwcmV2ZW50cyBkZXNrdG9wIGNvbnRyb2xzIGZyb20gaGlkaW5nLilcbiAgICAgICAgY29uc3QgcmVjZW50VG91Y2hTZWVrID0gdGhpcy50b3VjaCAmJiB0aGlzLmxhc3RTZWVrVGltZSArIDIwMDAgPiBEYXRlLm5vdygpOyAvLyBTaG93IGNvbnRyb2xzIGlmIGZvcmNlLCBsb2FkaW5nLCBwYXVzZWQsIGJ1dHRvbiBpbnRlcmFjdGlvbiwgb3IgcmVjZW50IHNlZWssIG90aGVyd2lzZSBoaWRlXG5cbiAgICAgICAgdGhpcy50b2dnbGVDb250cm9scyhCb29sZWFuKGZvcmNlIHx8IHRoaXMubG9hZGluZyB8fCB0aGlzLnBhdXNlZCB8fCBjb250cm9sc0VsZW1lbnQucHJlc3NlZCB8fCBjb250cm9sc0VsZW1lbnQuaG92ZXIgfHwgcmVjZW50VG91Y2hTZWVrKSk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIC8vIE1pZ3JhdGUgYW55IGN1c3RvbSBwcm9wZXJ0aWVzIGZyb20gdGhlIG1lZGlhIHRvIHRoZSBwYXJlbnRcbiAgICBtaWdyYXRlU3R5bGVzKCkge1xuICAgICAgLy8gTG9vcCB0aHJvdWdoIHZhbHVlcyAoYXMgdGhleSBhcmUgdGhlIGtleXMgd2hlbiB0aGUgb2JqZWN0IGlzIHNwcmVhZCDwn6SUKVxuICAgICAgT2JqZWN0LnZhbHVlcyh7IC4uLnRoaXMubWVkaWEuc3R5bGVcbiAgICAgIH0pIC8vIFdlJ3JlIG9ubHkgZnVzc2VkIGFib3V0IFBseXIgc3BlY2lmaWMgcHJvcGVydGllc1xuICAgICAgLmZpbHRlcihrZXkgPT4gIWlzLmVtcHR5KGtleSkgJiYgaXMuc3RyaW5nKGtleSkgJiYga2V5LnN0YXJ0c1dpdGgoJy0tcGx5cicpKS5mb3JFYWNoKGtleSA9PiB7XG4gICAgICAgIC8vIFNldCBvbiB0aGUgY29udGFpbmVyXG4gICAgICAgIHRoaXMuZWxlbWVudHMuY29udGFpbmVyLnN0eWxlLnNldFByb3BlcnR5KGtleSwgdGhpcy5tZWRpYS5zdHlsZS5nZXRQcm9wZXJ0eVZhbHVlKGtleSkpOyAvLyBDbGVhbiB1cCBmcm9tIG1lZGlhIGVsZW1lbnRcblxuICAgICAgICB0aGlzLm1lZGlhLnN0eWxlLnJlbW92ZVByb3BlcnR5KGtleSk7XG4gICAgICB9KTsgLy8gUmVtb3ZlIGF0dHJpYnV0ZSBpZiBlbXB0eVxuXG4gICAgICBpZiAoaXMuZW1wdHkodGhpcy5tZWRpYS5zdHlsZSkpIHtcbiAgICAgICAgdGhpcy5tZWRpYS5yZW1vdmVBdHRyaWJ1dGUoJ3N0eWxlJyk7XG4gICAgICB9XG4gICAgfVxuXG4gIH07XG5cbiAgY2xhc3MgTGlzdGVuZXJzIHtcbiAgICBjb25zdHJ1Y3RvcihfcGxheWVyKSB7XG4gICAgICBfZGVmaW5lUHJvcGVydHkkMSh0aGlzLCBcImZpcnN0VG91Y2hcIiwgKCkgPT4ge1xuICAgICAgICBjb25zdCB7XG4gICAgICAgICAgcGxheWVyXG4gICAgICAgIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCB7XG4gICAgICAgICAgZWxlbWVudHNcbiAgICAgICAgfSA9IHBsYXllcjtcbiAgICAgICAgcGxheWVyLnRvdWNoID0gdHJ1ZTsgLy8gQWRkIHRvdWNoIGNsYXNzXG5cbiAgICAgICAgdG9nZ2xlQ2xhc3MoZWxlbWVudHMuY29udGFpbmVyLCBwbGF5ZXIuY29uZmlnLmNsYXNzTmFtZXMuaXNUb3VjaCwgdHJ1ZSk7XG4gICAgICB9KTtcblxuICAgICAgX2RlZmluZVByb3BlcnR5JDEodGhpcywgXCJzZXRUYWJGb2N1c1wiLCBldmVudCA9PiB7XG4gICAgICAgIGNvbnN0IHtcbiAgICAgICAgICBwbGF5ZXJcbiAgICAgICAgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHtcbiAgICAgICAgICBlbGVtZW50c1xuICAgICAgICB9ID0gcGxheWVyO1xuICAgICAgICBjb25zdCB7XG4gICAgICAgICAga2V5LFxuICAgICAgICAgIHR5cGUsXG4gICAgICAgICAgdGltZVN0YW1wXG4gICAgICAgIH0gPSBldmVudDtcbiAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuZm9jdXNUaW1lcik7IC8vIElnbm9yZSBhbnkga2V5IG90aGVyIHRoYW4gdGFiXG5cbiAgICAgICAgaWYgKHR5cGUgPT09ICdrZXlkb3duJyAmJiBrZXkgIT09ICdUYWInKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9IC8vIFN0b3JlIHJlZmVyZW5jZSB0byBldmVudCB0aW1lU3RhbXBcblxuXG4gICAgICAgIGlmICh0eXBlID09PSAna2V5ZG93bicpIHtcbiAgICAgICAgICB0aGlzLmxhc3RLZXlEb3duID0gdGltZVN0YW1wO1xuICAgICAgICB9IC8vIFJlbW92ZSBjdXJyZW50IGNsYXNzZXNcblxuXG4gICAgICAgIGNvbnN0IHJlbW92ZUN1cnJlbnQgPSAoKSA9PiB7XG4gICAgICAgICAgY29uc3QgY2xhc3NOYW1lID0gcGxheWVyLmNvbmZpZy5jbGFzc05hbWVzLnRhYkZvY3VzO1xuICAgICAgICAgIGNvbnN0IGN1cnJlbnQgPSBnZXRFbGVtZW50cy5jYWxsKHBsYXllciwgYC4ke2NsYXNzTmFtZX1gKTtcbiAgICAgICAgICB0b2dnbGVDbGFzcyhjdXJyZW50LCBjbGFzc05hbWUsIGZhbHNlKTtcbiAgICAgICAgfTsgLy8gRGV0ZXJtaW5lIGlmIGEga2V5IHdhcyBwcmVzc2VkIHRvIHRyaWdnZXIgdGhpcyBldmVudFxuXG5cbiAgICAgICAgY29uc3Qgd2FzS2V5RG93biA9IHRpbWVTdGFtcCAtIHRoaXMubGFzdEtleURvd24gPD0gMjA7IC8vIElnbm9yZSBmb2N1cyBldmVudHMgaWYgYSBrZXkgd2FzIHByZXNzZWQgcHJpb3JcblxuICAgICAgICBpZiAodHlwZSA9PT0gJ2ZvY3VzJyAmJiAhd2FzS2V5RG93bikge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfSAvLyBSZW1vdmUgYWxsIGN1cnJlbnRcblxuXG4gICAgICAgIHJlbW92ZUN1cnJlbnQoKTsgLy8gRGVsYXkgdGhlIGFkZGluZyBvZiBjbGFzc25hbWUgdW50aWwgdGhlIGZvY3VzIGhhcyBjaGFuZ2VkXG4gICAgICAgIC8vIFRoaXMgZXZlbnQgZmlyZXMgYmVmb3JlIHRoZSBmb2N1c2luIGV2ZW50XG5cbiAgICAgICAgaWYgKHR5cGUgIT09ICdmb2N1c291dCcpIHtcbiAgICAgICAgICB0aGlzLmZvY3VzVGltZXIgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGZvY3VzZWQgPSBkb2N1bWVudC5hY3RpdmVFbGVtZW50OyAvLyBJZ25vcmUgaWYgY3VycmVudCBmb2N1cyBlbGVtZW50IGlzbid0IGluc2lkZSB0aGUgcGxheWVyXG5cbiAgICAgICAgICAgIGlmICghZWxlbWVudHMuY29udGFpbmVyLmNvbnRhaW5zKGZvY3VzZWQpKSB7XG4gICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdG9nZ2xlQ2xhc3MoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCwgcGxheWVyLmNvbmZpZy5jbGFzc05hbWVzLnRhYkZvY3VzLCB0cnVlKTtcbiAgICAgICAgICB9LCAxMCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICBfZGVmaW5lUHJvcGVydHkkMSh0aGlzLCBcImdsb2JhbFwiLCAodG9nZ2xlID0gdHJ1ZSkgPT4ge1xuICAgICAgICBjb25zdCB7XG4gICAgICAgICAgcGxheWVyXG4gICAgICAgIH0gPSB0aGlzOyAvLyBLZXlib2FyZCBzaG9ydGN1dHNcblxuICAgICAgICBpZiAocGxheWVyLmNvbmZpZy5rZXlib2FyZC5nbG9iYWwpIHtcbiAgICAgICAgICB0b2dnbGVMaXN0ZW5lci5jYWxsKHBsYXllciwgd2luZG93LCAna2V5ZG93biBrZXl1cCcsIHRoaXMuaGFuZGxlS2V5LCB0b2dnbGUsIGZhbHNlKTtcbiAgICAgICAgfSAvLyBDbGljayBhbnl3aGVyZSBjbG9zZXMgbWVudVxuXG5cbiAgICAgICAgdG9nZ2xlTGlzdGVuZXIuY2FsbChwbGF5ZXIsIGRvY3VtZW50LmJvZHksICdjbGljaycsIHRoaXMudG9nZ2xlTWVudSwgdG9nZ2xlKTsgLy8gRGV0ZWN0IHRvdWNoIGJ5IGV2ZW50c1xuXG4gICAgICAgIG9uY2UuY2FsbChwbGF5ZXIsIGRvY3VtZW50LmJvZHksICd0b3VjaHN0YXJ0JywgdGhpcy5maXJzdFRvdWNoKTsgLy8gVGFiIGZvY3VzIGRldGVjdGlvblxuXG4gICAgICAgIHRvZ2dsZUxpc3RlbmVyLmNhbGwocGxheWVyLCBkb2N1bWVudC5ib2R5LCAna2V5ZG93biBmb2N1cyBibHVyIGZvY3Vzb3V0JywgdGhpcy5zZXRUYWJGb2N1cywgdG9nZ2xlLCBmYWxzZSwgdHJ1ZSk7XG4gICAgICB9KTtcblxuICAgICAgX2RlZmluZVByb3BlcnR5JDEodGhpcywgXCJjb250YWluZXJcIiwgKCkgPT4ge1xuICAgICAgICBjb25zdCB7XG4gICAgICAgICAgcGxheWVyXG4gICAgICAgIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCB7XG4gICAgICAgICAgY29uZmlnLFxuICAgICAgICAgIGVsZW1lbnRzLFxuICAgICAgICAgIHRpbWVyc1xuICAgICAgICB9ID0gcGxheWVyOyAvLyBLZXlib2FyZCBzaG9ydGN1dHNcblxuICAgICAgICBpZiAoIWNvbmZpZy5rZXlib2FyZC5nbG9iYWwgJiYgY29uZmlnLmtleWJvYXJkLmZvY3VzZWQpIHtcbiAgICAgICAgICBvbi5jYWxsKHBsYXllciwgZWxlbWVudHMuY29udGFpbmVyLCAna2V5ZG93biBrZXl1cCcsIHRoaXMuaGFuZGxlS2V5LCBmYWxzZSk7XG4gICAgICAgIH0gLy8gVG9nZ2xlIGNvbnRyb2xzIG9uIG1vdXNlIGV2ZW50cyBhbmQgZW50ZXJpbmcgZnVsbHNjcmVlblxuXG5cbiAgICAgICAgb24uY2FsbChwbGF5ZXIsIGVsZW1lbnRzLmNvbnRhaW5lciwgJ21vdXNlbW92ZSBtb3VzZWxlYXZlIHRvdWNoc3RhcnQgdG91Y2htb3ZlIGVudGVyZnVsbHNjcmVlbiBleGl0ZnVsbHNjcmVlbicsIGV2ZW50ID0+IHtcbiAgICAgICAgICBjb25zdCB7XG4gICAgICAgICAgICBjb250cm9sczogY29udHJvbHNFbGVtZW50XG4gICAgICAgICAgfSA9IGVsZW1lbnRzOyAvLyBSZW1vdmUgYnV0dG9uIHN0YXRlcyBmb3IgZnVsbHNjcmVlblxuXG4gICAgICAgICAgaWYgKGNvbnRyb2xzRWxlbWVudCAmJiBldmVudC50eXBlID09PSAnZW50ZXJmdWxsc2NyZWVuJykge1xuICAgICAgICAgICAgY29udHJvbHNFbGVtZW50LnByZXNzZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIGNvbnRyb2xzRWxlbWVudC5ob3ZlciA9IGZhbHNlO1xuICAgICAgICAgIH0gLy8gU2hvdywgdGhlbiBoaWRlIGFmdGVyIGEgdGltZW91dCB1bmxlc3MgYW5vdGhlciBjb250cm9sIGV2ZW50IG9jY3Vyc1xuXG5cbiAgICAgICAgICBjb25zdCBzaG93ID0gWyd0b3VjaHN0YXJ0JywgJ3RvdWNobW92ZScsICdtb3VzZW1vdmUnXS5pbmNsdWRlcyhldmVudC50eXBlKTtcbiAgICAgICAgICBsZXQgZGVsYXkgPSAwO1xuXG4gICAgICAgICAgaWYgKHNob3cpIHtcbiAgICAgICAgICAgIHVpLnRvZ2dsZUNvbnRyb2xzLmNhbGwocGxheWVyLCB0cnVlKTsgLy8gVXNlIGxvbmdlciB0aW1lb3V0IGZvciB0b3VjaCBkZXZpY2VzXG5cbiAgICAgICAgICAgIGRlbGF5ID0gcGxheWVyLnRvdWNoID8gMzAwMCA6IDIwMDA7XG4gICAgICAgICAgfSAvLyBDbGVhciB0aW1lclxuXG5cbiAgICAgICAgICBjbGVhclRpbWVvdXQodGltZXJzLmNvbnRyb2xzKTsgLy8gU2V0IG5ldyB0aW1lciB0byBwcmV2ZW50IGZsaWNrZXIgd2hlbiBzZWVraW5nXG5cbiAgICAgICAgICB0aW1lcnMuY29udHJvbHMgPSBzZXRUaW1lb3V0KCgpID0+IHVpLnRvZ2dsZUNvbnRyb2xzLmNhbGwocGxheWVyLCBmYWxzZSksIGRlbGF5KTtcbiAgICAgICAgfSk7IC8vIFNldCBhIGd1dHRlciBmb3IgVmltZW9cblxuICAgICAgICBjb25zdCBzZXRHdXR0ZXIgPSAoKSA9PiB7XG4gICAgICAgICAgaWYgKCFwbGF5ZXIuaXNWaW1lbyB8fCBwbGF5ZXIuY29uZmlnLnZpbWVvLnByZW1pdW0pIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBjb25zdCB0YXJnZXQgPSBlbGVtZW50cy53cmFwcGVyO1xuICAgICAgICAgIGNvbnN0IHtcbiAgICAgICAgICAgIGFjdGl2ZVxuICAgICAgICAgIH0gPSBwbGF5ZXIuZnVsbHNjcmVlbjtcbiAgICAgICAgICBjb25zdCBbdmlkZW9XaWR0aCwgdmlkZW9IZWlnaHRdID0gZ2V0QXNwZWN0UmF0aW8uY2FsbChwbGF5ZXIpO1xuICAgICAgICAgIGNvbnN0IHVzZU5hdGl2ZUFzcGVjdFJhdGlvID0gc3VwcG9ydHNDU1MoYGFzcGVjdC1yYXRpbzogJHt2aWRlb1dpZHRofSAvICR7dmlkZW9IZWlnaHR9YCk7IC8vIElmIG5vdCBhY3RpdmUsIHJlbW92ZSBzdHlsZXNcblxuICAgICAgICAgIGlmICghYWN0aXZlKSB7XG4gICAgICAgICAgICBpZiAodXNlTmF0aXZlQXNwZWN0UmF0aW8pIHtcbiAgICAgICAgICAgICAgdGFyZ2V0LnN0eWxlLndpZHRoID0gbnVsbDtcbiAgICAgICAgICAgICAgdGFyZ2V0LnN0eWxlLmhlaWdodCA9IG51bGw7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICB0YXJnZXQuc3R5bGUubWF4V2lkdGggPSBudWxsO1xuICAgICAgICAgICAgICB0YXJnZXQuc3R5bGUubWFyZ2luID0gbnVsbDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH0gLy8gRGV0ZXJtaW5lIHdoaWNoIGRpbWVuc2lvbiB3aWxsIG92ZXJmbG93IGFuZCBjb25zdHJhaW4gdmlld1xuXG5cbiAgICAgICAgICBjb25zdCBbdmlld3BvcnRXaWR0aCwgdmlld3BvcnRIZWlnaHRdID0gZ2V0Vmlld3BvcnRTaXplKCk7XG4gICAgICAgICAgY29uc3Qgb3ZlcmZsb3cgPSB2aWV3cG9ydFdpZHRoIC8gdmlld3BvcnRIZWlnaHQgPiB2aWRlb1dpZHRoIC8gdmlkZW9IZWlnaHQ7XG5cbiAgICAgICAgICBpZiAodXNlTmF0aXZlQXNwZWN0UmF0aW8pIHtcbiAgICAgICAgICAgIHRhcmdldC5zdHlsZS53aWR0aCA9IG92ZXJmbG93ID8gJ2F1dG8nIDogJzEwMCUnO1xuICAgICAgICAgICAgdGFyZ2V0LnN0eWxlLmhlaWdodCA9IG92ZXJmbG93ID8gJzEwMCUnIDogJ2F1dG8nO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0YXJnZXQuc3R5bGUubWF4V2lkdGggPSBvdmVyZmxvdyA/IGAke3ZpZXdwb3J0SGVpZ2h0IC8gdmlkZW9IZWlnaHQgKiB2aWRlb1dpZHRofXB4YCA6IG51bGw7XG4gICAgICAgICAgICB0YXJnZXQuc3R5bGUubWFyZ2luID0gb3ZlcmZsb3cgPyAnMCBhdXRvJyA6IG51bGw7XG4gICAgICAgICAgfVxuICAgICAgICB9OyAvLyBIYW5kbGUgcmVzaXppbmdcblxuXG4gICAgICAgIGNvbnN0IHJlc2l6ZWQgPSAoKSA9PiB7XG4gICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVycy5yZXNpemVkKTtcbiAgICAgICAgICB0aW1lcnMucmVzaXplZCA9IHNldFRpbWVvdXQoc2V0R3V0dGVyLCA1MCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgb24uY2FsbChwbGF5ZXIsIGVsZW1lbnRzLmNvbnRhaW5lciwgJ2VudGVyZnVsbHNjcmVlbiBleGl0ZnVsbHNjcmVlbicsIGV2ZW50ID0+IHtcbiAgICAgICAgICBjb25zdCB7XG4gICAgICAgICAgICB0YXJnZXRcbiAgICAgICAgICB9ID0gcGxheWVyLmZ1bGxzY3JlZW47IC8vIElnbm9yZSBldmVudHMgbm90IGZyb20gdGFyZ2V0XG5cbiAgICAgICAgICBpZiAodGFyZ2V0ICE9PSBlbGVtZW50cy5jb250YWluZXIpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9IC8vIElmIGl0J3Mgbm90IGFuIGVtYmVkIGFuZCBubyByYXRpbyBzcGVjaWZpZWRcblxuXG4gICAgICAgICAgaWYgKCFwbGF5ZXIuaXNFbWJlZCAmJiBpcy5lbXB0eShwbGF5ZXIuY29uZmlnLnJhdGlvKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH0gLy8gU2V0IFZpbWVvIGd1dHRlclxuXG5cbiAgICAgICAgICBzZXRHdXR0ZXIoKTsgLy8gV2F0Y2ggZm9yIHJlc2l6ZXNcblxuICAgICAgICAgIGNvbnN0IG1ldGhvZCA9IGV2ZW50LnR5cGUgPT09ICdlbnRlcmZ1bGxzY3JlZW4nID8gb24gOiBvZmY7XG4gICAgICAgICAgbWV0aG9kLmNhbGwocGxheWVyLCB3aW5kb3csICdyZXNpemUnLCByZXNpemVkKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgICAgX2RlZmluZVByb3BlcnR5JDEodGhpcywgXCJtZWRpYVwiLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHtcbiAgICAgICAgICBwbGF5ZXJcbiAgICAgICAgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHtcbiAgICAgICAgICBlbGVtZW50c1xuICAgICAgICB9ID0gcGxheWVyOyAvLyBUaW1lIGNoYW5nZSBvbiBtZWRpYVxuXG4gICAgICAgIG9uLmNhbGwocGxheWVyLCBwbGF5ZXIubWVkaWEsICd0aW1ldXBkYXRlIHNlZWtpbmcgc2Vla2VkJywgZXZlbnQgPT4gY29udHJvbHMudGltZVVwZGF0ZS5jYWxsKHBsYXllciwgZXZlbnQpKTsgLy8gRGlzcGxheSBkdXJhdGlvblxuXG4gICAgICAgIG9uLmNhbGwocGxheWVyLCBwbGF5ZXIubWVkaWEsICdkdXJhdGlvbmNoYW5nZSBsb2FkZWRkYXRhIGxvYWRlZG1ldGFkYXRhJywgZXZlbnQgPT4gY29udHJvbHMuZHVyYXRpb25VcGRhdGUuY2FsbChwbGF5ZXIsIGV2ZW50KSk7IC8vIEhhbmRsZSB0aGUgbWVkaWEgZmluaXNoaW5nXG5cbiAgICAgICAgb24uY2FsbChwbGF5ZXIsIHBsYXllci5tZWRpYSwgJ2VuZGVkJywgKCkgPT4ge1xuICAgICAgICAgIC8vIFNob3cgcG9zdGVyIG9uIGVuZFxuICAgICAgICAgIGlmIChwbGF5ZXIuaXNIVE1MNSAmJiBwbGF5ZXIuaXNWaWRlbyAmJiBwbGF5ZXIuY29uZmlnLnJlc2V0T25FbmQpIHtcbiAgICAgICAgICAgIC8vIFJlc3RhcnRcbiAgICAgICAgICAgIHBsYXllci5yZXN0YXJ0KCk7IC8vIENhbGwgcGF1c2Ugb3RoZXJ3aXNlIElFMTEgd2lsbCBzdGFydCBwbGF5aW5nIHRoZSB2aWRlbyBhZ2FpblxuXG4gICAgICAgICAgICBwbGF5ZXIucGF1c2UoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pOyAvLyBDaGVjayBmb3IgYnVmZmVyIHByb2dyZXNzXG5cbiAgICAgICAgb24uY2FsbChwbGF5ZXIsIHBsYXllci5tZWRpYSwgJ3Byb2dyZXNzIHBsYXlpbmcgc2Vla2luZyBzZWVrZWQnLCBldmVudCA9PiBjb250cm9scy51cGRhdGVQcm9ncmVzcy5jYWxsKHBsYXllciwgZXZlbnQpKTsgLy8gSGFuZGxlIHZvbHVtZSBjaGFuZ2VzXG5cbiAgICAgICAgb24uY2FsbChwbGF5ZXIsIHBsYXllci5tZWRpYSwgJ3ZvbHVtZWNoYW5nZScsIGV2ZW50ID0+IGNvbnRyb2xzLnVwZGF0ZVZvbHVtZS5jYWxsKHBsYXllciwgZXZlbnQpKTsgLy8gSGFuZGxlIHBsYXkvcGF1c2VcblxuICAgICAgICBvbi5jYWxsKHBsYXllciwgcGxheWVyLm1lZGlhLCAncGxheWluZyBwbGF5IHBhdXNlIGVuZGVkIGVtcHRpZWQgdGltZXVwZGF0ZScsIGV2ZW50ID0+IHVpLmNoZWNrUGxheWluZy5jYWxsKHBsYXllciwgZXZlbnQpKTsgLy8gTG9hZGluZyBzdGF0ZVxuXG4gICAgICAgIG9uLmNhbGwocGxheWVyLCBwbGF5ZXIubWVkaWEsICd3YWl0aW5nIGNhbnBsYXkgc2Vla2VkIHBsYXlpbmcnLCBldmVudCA9PiB1aS5jaGVja0xvYWRpbmcuY2FsbChwbGF5ZXIsIGV2ZW50KSk7IC8vIENsaWNrIHZpZGVvXG5cbiAgICAgICAgaWYgKHBsYXllci5zdXBwb3J0ZWQudWkgJiYgcGxheWVyLmNvbmZpZy5jbGlja1RvUGxheSAmJiAhcGxheWVyLmlzQXVkaW8pIHtcbiAgICAgICAgICAvLyBSZS1mZXRjaCB0aGUgd3JhcHBlclxuICAgICAgICAgIGNvbnN0IHdyYXBwZXIgPSBnZXRFbGVtZW50LmNhbGwocGxheWVyLCBgLiR7cGxheWVyLmNvbmZpZy5jbGFzc05hbWVzLnZpZGVvfWApOyAvLyBCYWlsIGlmIHRoZXJlJ3Mgbm8gd3JhcHBlciAodGhpcyBzaG91bGQgbmV2ZXIgaGFwcGVuKVxuXG4gICAgICAgICAgaWYgKCFpcy5lbGVtZW50KHdyYXBwZXIpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfSAvLyBPbiBjbGljayBwbGF5LCBwYXVzZSBvciByZXN0YXJ0XG5cblxuICAgICAgICAgIG9uLmNhbGwocGxheWVyLCBlbGVtZW50cy5jb250YWluZXIsICdjbGljaycsIGV2ZW50ID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHRhcmdldHMgPSBbZWxlbWVudHMuY29udGFpbmVyLCB3cmFwcGVyXTsgLy8gSWdub3JlIGlmIGNsaWNrIGlmIG5vdCBjb250YWluZXIgb3IgaW4gdmlkZW8gd3JhcHBlclxuXG4gICAgICAgICAgICBpZiAoIXRhcmdldHMuaW5jbHVkZXMoZXZlbnQudGFyZ2V0KSAmJiAhd3JhcHBlci5jb250YWlucyhldmVudC50YXJnZXQpKSB7XG4gICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH0gLy8gVG91Y2ggZGV2aWNlcyB3aWxsIGp1c3Qgc2hvdyBjb250cm9scyAoaWYgaGlkZGVuKVxuXG5cbiAgICAgICAgICAgIGlmIChwbGF5ZXIudG91Y2ggJiYgcGxheWVyLmNvbmZpZy5oaWRlQ29udHJvbHMpIHtcbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAocGxheWVyLmVuZGVkKSB7XG4gICAgICAgICAgICAgIHRoaXMucHJveHkoZXZlbnQsIHBsYXllci5yZXN0YXJ0LCAncmVzdGFydCcpO1xuICAgICAgICAgICAgICB0aGlzLnByb3h5KGV2ZW50LCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgc2lsZW5jZVByb21pc2UocGxheWVyLnBsYXkoKSk7XG4gICAgICAgICAgICAgIH0sICdwbGF5Jyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICB0aGlzLnByb3h5KGV2ZW50LCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgc2lsZW5jZVByb21pc2UocGxheWVyLnRvZ2dsZVBsYXkoKSk7XG4gICAgICAgICAgICAgIH0sICdwbGF5Jyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gLy8gRGlzYWJsZSByaWdodCBjbGlja1xuXG5cbiAgICAgICAgaWYgKHBsYXllci5zdXBwb3J0ZWQudWkgJiYgcGxheWVyLmNvbmZpZy5kaXNhYmxlQ29udGV4dE1lbnUpIHtcbiAgICAgICAgICBvbi5jYWxsKHBsYXllciwgZWxlbWVudHMud3JhcHBlciwgJ2NvbnRleHRtZW51JywgZXZlbnQgPT4ge1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICB9LCBmYWxzZSk7XG4gICAgICAgIH0gLy8gVm9sdW1lIGNoYW5nZVxuXG5cbiAgICAgICAgb24uY2FsbChwbGF5ZXIsIHBsYXllci5tZWRpYSwgJ3ZvbHVtZWNoYW5nZScsICgpID0+IHtcbiAgICAgICAgICAvLyBTYXZlIHRvIHN0b3JhZ2VcbiAgICAgICAgICBwbGF5ZXIuc3RvcmFnZS5zZXQoe1xuICAgICAgICAgICAgdm9sdW1lOiBwbGF5ZXIudm9sdW1lLFxuICAgICAgICAgICAgbXV0ZWQ6IHBsYXllci5tdXRlZFxuICAgICAgICAgIH0pO1xuICAgICAgICB9KTsgLy8gU3BlZWQgY2hhbmdlXG5cbiAgICAgICAgb24uY2FsbChwbGF5ZXIsIHBsYXllci5tZWRpYSwgJ3JhdGVjaGFuZ2UnLCAoKSA9PiB7XG4gICAgICAgICAgLy8gVXBkYXRlIFVJXG4gICAgICAgICAgY29udHJvbHMudXBkYXRlU2V0dGluZy5jYWxsKHBsYXllciwgJ3NwZWVkJyk7IC8vIFNhdmUgdG8gc3RvcmFnZVxuXG4gICAgICAgICAgcGxheWVyLnN0b3JhZ2Uuc2V0KHtcbiAgICAgICAgICAgIHNwZWVkOiBwbGF5ZXIuc3BlZWRcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7IC8vIFF1YWxpdHkgY2hhbmdlXG5cbiAgICAgICAgb24uY2FsbChwbGF5ZXIsIHBsYXllci5tZWRpYSwgJ3F1YWxpdHljaGFuZ2UnLCBldmVudCA9PiB7XG4gICAgICAgICAgLy8gVXBkYXRlIFVJXG4gICAgICAgICAgY29udHJvbHMudXBkYXRlU2V0dGluZy5jYWxsKHBsYXllciwgJ3F1YWxpdHknLCBudWxsLCBldmVudC5kZXRhaWwucXVhbGl0eSk7XG4gICAgICAgIH0pOyAvLyBVcGRhdGUgZG93bmxvYWQgbGluayB3aGVuIHJlYWR5IGFuZCBpZiBxdWFsaXR5IGNoYW5nZXNcblxuICAgICAgICBvbi5jYWxsKHBsYXllciwgcGxheWVyLm1lZGlhLCAncmVhZHkgcXVhbGl0eWNoYW5nZScsICgpID0+IHtcbiAgICAgICAgICBjb250cm9scy5zZXREb3dubG9hZFVybC5jYWxsKHBsYXllcik7XG4gICAgICAgIH0pOyAvLyBQcm94eSBldmVudHMgdG8gY29udGFpbmVyXG4gICAgICAgIC8vIEJ1YmJsZSB1cCBrZXkgZXZlbnRzIGZvciBFZGdlXG5cbiAgICAgICAgY29uc3QgcHJveHlFdmVudHMgPSBwbGF5ZXIuY29uZmlnLmV2ZW50cy5jb25jYXQoWydrZXl1cCcsICdrZXlkb3duJ10pLmpvaW4oJyAnKTtcbiAgICAgICAgb24uY2FsbChwbGF5ZXIsIHBsYXllci5tZWRpYSwgcHJveHlFdmVudHMsIGV2ZW50ID0+IHtcbiAgICAgICAgICBsZXQge1xuICAgICAgICAgICAgZGV0YWlsID0ge31cbiAgICAgICAgICB9ID0gZXZlbnQ7IC8vIEdldCBlcnJvciBkZXRhaWxzIGZyb20gbWVkaWFcblxuICAgICAgICAgIGlmIChldmVudC50eXBlID09PSAnZXJyb3InKSB7XG4gICAgICAgICAgICBkZXRhaWwgPSBwbGF5ZXIubWVkaWEuZXJyb3I7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdHJpZ2dlckV2ZW50LmNhbGwocGxheWVyLCBlbGVtZW50cy5jb250YWluZXIsIGV2ZW50LnR5cGUsIHRydWUsIGRldGFpbCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAgIF9kZWZpbmVQcm9wZXJ0eSQxKHRoaXMsIFwicHJveHlcIiwgKGV2ZW50LCBkZWZhdWx0SGFuZGxlciwgY3VzdG9tSGFuZGxlcktleSkgPT4ge1xuICAgICAgICBjb25zdCB7XG4gICAgICAgICAgcGxheWVyXG4gICAgICAgIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCBjdXN0b21IYW5kbGVyID0gcGxheWVyLmNvbmZpZy5saXN0ZW5lcnNbY3VzdG9tSGFuZGxlcktleV07XG4gICAgICAgIGNvbnN0IGhhc0N1c3RvbUhhbmRsZXIgPSBpcy5mdW5jdGlvbihjdXN0b21IYW5kbGVyKTtcbiAgICAgICAgbGV0IHJldHVybmVkID0gdHJ1ZTsgLy8gRXhlY3V0ZSBjdXN0b20gaGFuZGxlclxuXG4gICAgICAgIGlmIChoYXNDdXN0b21IYW5kbGVyKSB7XG4gICAgICAgICAgcmV0dXJuZWQgPSBjdXN0b21IYW5kbGVyLmNhbGwocGxheWVyLCBldmVudCk7XG4gICAgICAgIH0gLy8gT25seSBjYWxsIGRlZmF1bHQgaGFuZGxlciBpZiBub3QgcHJldmVudGVkIGluIGN1c3RvbSBoYW5kbGVyXG5cblxuICAgICAgICBpZiAocmV0dXJuZWQgIT09IGZhbHNlICYmIGlzLmZ1bmN0aW9uKGRlZmF1bHRIYW5kbGVyKSkge1xuICAgICAgICAgIGRlZmF1bHRIYW5kbGVyLmNhbGwocGxheWVyLCBldmVudCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICBfZGVmaW5lUHJvcGVydHkkMSh0aGlzLCBcImJpbmRcIiwgKGVsZW1lbnQsIHR5cGUsIGRlZmF1bHRIYW5kbGVyLCBjdXN0b21IYW5kbGVyS2V5LCBwYXNzaXZlID0gdHJ1ZSkgPT4ge1xuICAgICAgICBjb25zdCB7XG4gICAgICAgICAgcGxheWVyXG4gICAgICAgIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCBjdXN0b21IYW5kbGVyID0gcGxheWVyLmNvbmZpZy5saXN0ZW5lcnNbY3VzdG9tSGFuZGxlcktleV07XG4gICAgICAgIGNvbnN0IGhhc0N1c3RvbUhhbmRsZXIgPSBpcy5mdW5jdGlvbihjdXN0b21IYW5kbGVyKTtcbiAgICAgICAgb24uY2FsbChwbGF5ZXIsIGVsZW1lbnQsIHR5cGUsIGV2ZW50ID0+IHRoaXMucHJveHkoZXZlbnQsIGRlZmF1bHRIYW5kbGVyLCBjdXN0b21IYW5kbGVyS2V5KSwgcGFzc2l2ZSAmJiAhaGFzQ3VzdG9tSGFuZGxlcik7XG4gICAgICB9KTtcblxuICAgICAgX2RlZmluZVByb3BlcnR5JDEodGhpcywgXCJjb250cm9sc1wiLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHtcbiAgICAgICAgICBwbGF5ZXJcbiAgICAgICAgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHtcbiAgICAgICAgICBlbGVtZW50c1xuICAgICAgICB9ID0gcGxheWVyOyAvLyBJRSBkb2Vzbid0IHN1cHBvcnQgaW5wdXQgZXZlbnQsIHNvIHdlIGZhbGxiYWNrIHRvIGNoYW5nZVxuXG4gICAgICAgIGNvbnN0IGlucHV0RXZlbnQgPSBicm93c2VyLmlzSUUgPyAnY2hhbmdlJyA6ICdpbnB1dCc7IC8vIFBsYXkvcGF1c2UgdG9nZ2xlXG5cbiAgICAgICAgaWYgKGVsZW1lbnRzLmJ1dHRvbnMucGxheSkge1xuICAgICAgICAgIEFycmF5LmZyb20oZWxlbWVudHMuYnV0dG9ucy5wbGF5KS5mb3JFYWNoKGJ1dHRvbiA9PiB7XG4gICAgICAgICAgICB0aGlzLmJpbmQoYnV0dG9uLCAnY2xpY2snLCAoKSA9PiB7XG4gICAgICAgICAgICAgIHNpbGVuY2VQcm9taXNlKHBsYXllci50b2dnbGVQbGF5KCkpO1xuICAgICAgICAgICAgfSwgJ3BsYXknKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSAvLyBQYXVzZVxuXG5cbiAgICAgICAgdGhpcy5iaW5kKGVsZW1lbnRzLmJ1dHRvbnMucmVzdGFydCwgJ2NsaWNrJywgcGxheWVyLnJlc3RhcnQsICdyZXN0YXJ0Jyk7IC8vIFJld2luZFxuXG4gICAgICAgIHRoaXMuYmluZChlbGVtZW50cy5idXR0b25zLnJld2luZCwgJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgICAgIC8vIFJlY29yZCBzZWVrIHRpbWUgc28gd2UgY2FuIHByZXZlbnQgaGlkaW5nIGNvbnRyb2xzIGZvciBhIGZldyBzZWNvbmRzIGFmdGVyIHJld2luZFxuICAgICAgICAgIHBsYXllci5sYXN0U2Vla1RpbWUgPSBEYXRlLm5vdygpO1xuICAgICAgICAgIHBsYXllci5yZXdpbmQoKTtcbiAgICAgICAgfSwgJ3Jld2luZCcpOyAvLyBSZXdpbmRcblxuICAgICAgICB0aGlzLmJpbmQoZWxlbWVudHMuYnV0dG9ucy5mYXN0Rm9yd2FyZCwgJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgICAgIC8vIFJlY29yZCBzZWVrIHRpbWUgc28gd2UgY2FuIHByZXZlbnQgaGlkaW5nIGNvbnRyb2xzIGZvciBhIGZldyBzZWNvbmRzIGFmdGVyIGZhc3QgZm9yd2FyZFxuICAgICAgICAgIHBsYXllci5sYXN0U2Vla1RpbWUgPSBEYXRlLm5vdygpO1xuICAgICAgICAgIHBsYXllci5mb3J3YXJkKCk7XG4gICAgICAgIH0sICdmYXN0Rm9yd2FyZCcpOyAvLyBNdXRlIHRvZ2dsZVxuXG4gICAgICAgIHRoaXMuYmluZChlbGVtZW50cy5idXR0b25zLm11dGUsICdjbGljaycsICgpID0+IHtcbiAgICAgICAgICBwbGF5ZXIubXV0ZWQgPSAhcGxheWVyLm11dGVkO1xuICAgICAgICB9LCAnbXV0ZScpOyAvLyBDYXB0aW9ucyB0b2dnbGVcblxuICAgICAgICB0aGlzLmJpbmQoZWxlbWVudHMuYnV0dG9ucy5jYXB0aW9ucywgJ2NsaWNrJywgKCkgPT4gcGxheWVyLnRvZ2dsZUNhcHRpb25zKCkpOyAvLyBEb3dubG9hZFxuXG4gICAgICAgIHRoaXMuYmluZChlbGVtZW50cy5idXR0b25zLmRvd25sb2FkLCAnY2xpY2snLCAoKSA9PiB7XG4gICAgICAgICAgdHJpZ2dlckV2ZW50LmNhbGwocGxheWVyLCBwbGF5ZXIubWVkaWEsICdkb3dubG9hZCcpO1xuICAgICAgICB9LCAnZG93bmxvYWQnKTsgLy8gRnVsbHNjcmVlbiB0b2dnbGVcblxuICAgICAgICB0aGlzLmJpbmQoZWxlbWVudHMuYnV0dG9ucy5mdWxsc2NyZWVuLCAnY2xpY2snLCAoKSA9PiB7XG4gICAgICAgICAgcGxheWVyLmZ1bGxzY3JlZW4udG9nZ2xlKCk7XG4gICAgICAgIH0sICdmdWxsc2NyZWVuJyk7IC8vIFBpY3R1cmUtaW4tUGljdHVyZVxuXG4gICAgICAgIHRoaXMuYmluZChlbGVtZW50cy5idXR0b25zLnBpcCwgJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgICAgIHBsYXllci5waXAgPSAndG9nZ2xlJztcbiAgICAgICAgfSwgJ3BpcCcpOyAvLyBBaXJwbGF5XG5cbiAgICAgICAgdGhpcy5iaW5kKGVsZW1lbnRzLmJ1dHRvbnMuYWlycGxheSwgJ2NsaWNrJywgcGxheWVyLmFpcnBsYXksICdhaXJwbGF5Jyk7IC8vIFNldHRpbmdzIG1lbnUgLSBjbGljayB0b2dnbGVcblxuICAgICAgICB0aGlzLmJpbmQoZWxlbWVudHMuYnV0dG9ucy5zZXR0aW5ncywgJ2NsaWNrJywgZXZlbnQgPT4ge1xuICAgICAgICAgIC8vIFByZXZlbnQgdGhlIGRvY3VtZW50IGNsaWNrIGxpc3RlbmVyIGNsb3NpbmcgdGhlIG1lbnVcbiAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgIGNvbnRyb2xzLnRvZ2dsZU1lbnUuY2FsbChwbGF5ZXIsIGV2ZW50KTtcbiAgICAgICAgfSwgbnVsbCwgZmFsc2UpOyAvLyBDYW4ndCBiZSBwYXNzaXZlIGFzIHdlJ3JlIHByZXZlbnRpbmcgZGVmYXVsdFxuICAgICAgICAvLyBTZXR0aW5ncyBtZW51IC0ga2V5Ym9hcmQgdG9nZ2xlXG4gICAgICAgIC8vIFdlIGhhdmUgdG8gYmluZCB0byBrZXl1cCBvdGhlcndpc2UgRmlyZWZveCB0cmlnZ2VycyBhIGNsaWNrIHdoZW4gYSBrZXlkb3duIGV2ZW50IGhhbmRsZXIgc2hpZnRzIGZvY3VzXG4gICAgICAgIC8vIGh0dHBzOi8vYnVnemlsbGEubW96aWxsYS5vcmcvc2hvd19idWcuY2dpP2lkPTEyMjAxNDNcblxuICAgICAgICB0aGlzLmJpbmQoZWxlbWVudHMuYnV0dG9ucy5zZXR0aW5ncywgJ2tleXVwJywgZXZlbnQgPT4ge1xuICAgICAgICAgIGlmICghWydTcGFjZScsICdFbnRlciddLmluY2x1ZGVzKGV2ZW50LmtleSkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9IC8vIEJlY2F1c2UgcmV0dXJuIHRyaWdnZXJzIGEgY2xpY2sgYW55d2F5LCBhbGwgd2UgbmVlZCB0byBkbyBpcyBzZXQgZm9jdXNcblxuXG4gICAgICAgICAgaWYgKGV2ZW50LmtleSA9PT0gJ0VudGVyJykge1xuICAgICAgICAgICAgY29udHJvbHMuZm9jdXNGaXJzdE1lbnVJdGVtLmNhbGwocGxheWVyLCBudWxsLCB0cnVlKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9IC8vIFByZXZlbnQgc2Nyb2xsXG5cblxuICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7IC8vIFByZXZlbnQgcGxheWluZyB2aWRlbyAoRmlyZWZveClcblxuICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOyAvLyBUb2dnbGUgbWVudVxuXG4gICAgICAgICAgY29udHJvbHMudG9nZ2xlTWVudS5jYWxsKHBsYXllciwgZXZlbnQpO1xuICAgICAgICB9LCBudWxsLCBmYWxzZSAvLyBDYW4ndCBiZSBwYXNzaXZlIGFzIHdlJ3JlIHByZXZlbnRpbmcgZGVmYXVsdFxuICAgICAgICApOyAvLyBFc2NhcGUgY2xvc2VzIG1lbnVcblxuICAgICAgICB0aGlzLmJpbmQoZWxlbWVudHMuc2V0dGluZ3MubWVudSwgJ2tleWRvd24nLCBldmVudCA9PiB7XG4gICAgICAgICAgaWYgKGV2ZW50LmtleSA9PT0gJ0VzY2FwZScpIHtcbiAgICAgICAgICAgIGNvbnRyb2xzLnRvZ2dsZU1lbnUuY2FsbChwbGF5ZXIsIGV2ZW50KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pOyAvLyBTZXQgcmFuZ2UgaW5wdXQgYWx0ZXJuYXRpdmUgXCJ2YWx1ZVwiLCB3aGljaCBtYXRjaGVzIHRoZSB0b29sdGlwIHRpbWUgKCM5NTQpXG5cbiAgICAgICAgdGhpcy5iaW5kKGVsZW1lbnRzLmlucHV0cy5zZWVrLCAnbW91c2Vkb3duIG1vdXNlbW92ZScsIGV2ZW50ID0+IHtcbiAgICAgICAgICBjb25zdCByZWN0ID0gZWxlbWVudHMucHJvZ3Jlc3MuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICAgICAgY29uc3QgcGVyY2VudCA9IDEwMCAvIHJlY3Qud2lkdGggKiAoZXZlbnQucGFnZVggLSByZWN0LmxlZnQpO1xuICAgICAgICAgIGV2ZW50LmN1cnJlbnRUYXJnZXQuc2V0QXR0cmlidXRlKCdzZWVrLXZhbHVlJywgcGVyY2VudCk7XG4gICAgICAgIH0pOyAvLyBQYXVzZSB3aGlsZSBzZWVraW5nXG5cbiAgICAgICAgdGhpcy5iaW5kKGVsZW1lbnRzLmlucHV0cy5zZWVrLCAnbW91c2Vkb3duIG1vdXNldXAga2V5ZG93biBrZXl1cCB0b3VjaHN0YXJ0IHRvdWNoZW5kJywgZXZlbnQgPT4ge1xuICAgICAgICAgIGNvbnN0IHNlZWsgPSBldmVudC5jdXJyZW50VGFyZ2V0O1xuICAgICAgICAgIGNvbnN0IGF0dHJpYnV0ZSA9ICdwbGF5LW9uLXNlZWtlZCc7XG5cbiAgICAgICAgICBpZiAoaXMua2V5Ym9hcmRFdmVudChldmVudCkgJiYgIVsnQXJyb3dMZWZ0JywgJ0Fycm93UmlnaHQnXS5pbmNsdWRlcyhldmVudC5rZXkpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfSAvLyBSZWNvcmQgc2VlayB0aW1lIHNvIHdlIGNhbiBwcmV2ZW50IGhpZGluZyBjb250cm9scyBmb3IgYSBmZXcgc2Vjb25kcyBhZnRlciBzZWVrXG5cblxuICAgICAgICAgIHBsYXllci5sYXN0U2Vla1RpbWUgPSBEYXRlLm5vdygpOyAvLyBXYXMgcGxheWluZyBiZWZvcmU/XG5cbiAgICAgICAgICBjb25zdCBwbGF5ID0gc2Vlay5oYXNBdHRyaWJ1dGUoYXR0cmlidXRlKTsgLy8gRG9uZSBzZWVraW5nXG5cbiAgICAgICAgICBjb25zdCBkb25lID0gWydtb3VzZXVwJywgJ3RvdWNoZW5kJywgJ2tleXVwJ10uaW5jbHVkZXMoZXZlbnQudHlwZSk7IC8vIElmIHdlJ3JlIGRvbmUgc2Vla2luZyBhbmQgaXQgd2FzIHBsYXlpbmcsIHJlc3VtZSBwbGF5YmFja1xuXG4gICAgICAgICAgaWYgKHBsYXkgJiYgZG9uZSkge1xuICAgICAgICAgICAgc2Vlay5yZW1vdmVBdHRyaWJ1dGUoYXR0cmlidXRlKTtcbiAgICAgICAgICAgIHNpbGVuY2VQcm9taXNlKHBsYXllci5wbGF5KCkpO1xuICAgICAgICAgIH0gZWxzZSBpZiAoIWRvbmUgJiYgcGxheWVyLnBsYXlpbmcpIHtcbiAgICAgICAgICAgIHNlZWsuc2V0QXR0cmlidXRlKGF0dHJpYnV0ZSwgJycpO1xuICAgICAgICAgICAgcGxheWVyLnBhdXNlKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTsgLy8gRml4IHJhbmdlIGlucHV0cyBvbiBpT1NcbiAgICAgICAgLy8gU3VwZXIgd2VpcmQgaU9TIGJ1ZyB3aGVyZSBhZnRlciB5b3UgaW50ZXJhY3Qgd2l0aCBhbiA8aW5wdXQgdHlwZT1cInJhbmdlXCI+LFxuICAgICAgICAvLyBpdCB0YWtlcyBvdmVyIGZ1cnRoZXIgaW50ZXJhY3Rpb25zIG9uIHRoZSBwYWdlLiBUaGlzIGlzIGEgaGFja1xuXG4gICAgICAgIGlmIChicm93c2VyLmlzSW9zKSB7XG4gICAgICAgICAgY29uc3QgaW5wdXRzID0gZ2V0RWxlbWVudHMuY2FsbChwbGF5ZXIsICdpbnB1dFt0eXBlPVwicmFuZ2VcIl0nKTtcbiAgICAgICAgICBBcnJheS5mcm9tKGlucHV0cykuZm9yRWFjaChpbnB1dCA9PiB0aGlzLmJpbmQoaW5wdXQsIGlucHV0RXZlbnQsIGV2ZW50ID0+IHJlcGFpbnQoZXZlbnQudGFyZ2V0KSkpO1xuICAgICAgICB9IC8vIFNlZWtcblxuXG4gICAgICAgIHRoaXMuYmluZChlbGVtZW50cy5pbnB1dHMuc2VlaywgaW5wdXRFdmVudCwgZXZlbnQgPT4ge1xuICAgICAgICAgIGNvbnN0IHNlZWsgPSBldmVudC5jdXJyZW50VGFyZ2V0OyAvLyBJZiBpdCBleGlzdHMsIHVzZSBzZWVrLXZhbHVlIGluc3RlYWQgb2YgXCJ2YWx1ZVwiIGZvciBjb25zaXN0ZW5jeSB3aXRoIHRvb2x0aXAgdGltZSAoIzk1NClcblxuICAgICAgICAgIGxldCBzZWVrVG8gPSBzZWVrLmdldEF0dHJpYnV0ZSgnc2Vlay12YWx1ZScpO1xuXG4gICAgICAgICAgaWYgKGlzLmVtcHR5KHNlZWtUbykpIHtcbiAgICAgICAgICAgIHNlZWtUbyA9IHNlZWsudmFsdWU7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgc2Vlay5yZW1vdmVBdHRyaWJ1dGUoJ3NlZWstdmFsdWUnKTtcbiAgICAgICAgICBwbGF5ZXIuY3VycmVudFRpbWUgPSBzZWVrVG8gLyBzZWVrLm1heCAqIHBsYXllci5kdXJhdGlvbjtcbiAgICAgICAgfSwgJ3NlZWsnKTsgLy8gU2VlayB0b29sdGlwXG5cbiAgICAgICAgdGhpcy5iaW5kKGVsZW1lbnRzLnByb2dyZXNzLCAnbW91c2VlbnRlciBtb3VzZWxlYXZlIG1vdXNlbW92ZScsIGV2ZW50ID0+IGNvbnRyb2xzLnVwZGF0ZVNlZWtUb29sdGlwLmNhbGwocGxheWVyLCBldmVudCkpOyAvLyBQcmV2aWV3IHRodW1ibmFpbHMgcGx1Z2luXG4gICAgICAgIC8vIFRPRE86IFJlYWxseSBuZWVkIHRvIHdvcmsgb24gc29tZSBzb3J0IG9mIHBsdWctaW4gd2lkZSBldmVudCBidXMgb3IgcHViLXN1YiBmb3IgdGhpc1xuXG4gICAgICAgIHRoaXMuYmluZChlbGVtZW50cy5wcm9ncmVzcywgJ21vdXNlbW92ZSB0b3VjaG1vdmUnLCBldmVudCA9PiB7XG4gICAgICAgICAgY29uc3Qge1xuICAgICAgICAgICAgcHJldmlld1RodW1ibmFpbHNcbiAgICAgICAgICB9ID0gcGxheWVyO1xuXG4gICAgICAgICAgaWYgKHByZXZpZXdUaHVtYm5haWxzICYmIHByZXZpZXdUaHVtYm5haWxzLmxvYWRlZCkge1xuICAgICAgICAgICAgcHJldmlld1RodW1ibmFpbHMuc3RhcnRNb3ZlKGV2ZW50KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pOyAvLyBIaWRlIHRodW1ibmFpbCBwcmV2aWV3IC0gb24gbW91c2UgY2xpY2ssIG1vdXNlIGxlYXZlLCBhbmQgdmlkZW8gcGxheS9zZWVrLiBBbGwgZm91ciBhcmUgcmVxdWlyZWQsIGUuZy4sIGZvciBidWZmZXJpbmdcblxuICAgICAgICB0aGlzLmJpbmQoZWxlbWVudHMucHJvZ3Jlc3MsICdtb3VzZWxlYXZlIHRvdWNoZW5kIGNsaWNrJywgKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IHtcbiAgICAgICAgICAgIHByZXZpZXdUaHVtYm5haWxzXG4gICAgICAgICAgfSA9IHBsYXllcjtcblxuICAgICAgICAgIGlmIChwcmV2aWV3VGh1bWJuYWlscyAmJiBwcmV2aWV3VGh1bWJuYWlscy5sb2FkZWQpIHtcbiAgICAgICAgICAgIHByZXZpZXdUaHVtYm5haWxzLmVuZE1vdmUoZmFsc2UsIHRydWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7IC8vIFNob3cgc2NydWJiaW5nIHByZXZpZXdcblxuICAgICAgICB0aGlzLmJpbmQoZWxlbWVudHMucHJvZ3Jlc3MsICdtb3VzZWRvd24gdG91Y2hzdGFydCcsIGV2ZW50ID0+IHtcbiAgICAgICAgICBjb25zdCB7XG4gICAgICAgICAgICBwcmV2aWV3VGh1bWJuYWlsc1xuICAgICAgICAgIH0gPSBwbGF5ZXI7XG5cbiAgICAgICAgICBpZiAocHJldmlld1RodW1ibmFpbHMgJiYgcHJldmlld1RodW1ibmFpbHMubG9hZGVkKSB7XG4gICAgICAgICAgICBwcmV2aWV3VGh1bWJuYWlscy5zdGFydFNjcnViYmluZyhldmVudCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5iaW5kKGVsZW1lbnRzLnByb2dyZXNzLCAnbW91c2V1cCB0b3VjaGVuZCcsIGV2ZW50ID0+IHtcbiAgICAgICAgICBjb25zdCB7XG4gICAgICAgICAgICBwcmV2aWV3VGh1bWJuYWlsc1xuICAgICAgICAgIH0gPSBwbGF5ZXI7XG5cbiAgICAgICAgICBpZiAocHJldmlld1RodW1ibmFpbHMgJiYgcHJldmlld1RodW1ibmFpbHMubG9hZGVkKSB7XG4gICAgICAgICAgICBwcmV2aWV3VGh1bWJuYWlscy5lbmRTY3J1YmJpbmcoZXZlbnQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7IC8vIFBvbHlmaWxsIGZvciBsb3dlciBmaWxsIGluIDxpbnB1dCB0eXBlPVwicmFuZ2VcIj4gZm9yIHdlYmtpdFxuXG4gICAgICAgIGlmIChicm93c2VyLmlzV2Via2l0KSB7XG4gICAgICAgICAgQXJyYXkuZnJvbShnZXRFbGVtZW50cy5jYWxsKHBsYXllciwgJ2lucHV0W3R5cGU9XCJyYW5nZVwiXScpKS5mb3JFYWNoKGVsZW1lbnQgPT4ge1xuICAgICAgICAgICAgdGhpcy5iaW5kKGVsZW1lbnQsICdpbnB1dCcsIGV2ZW50ID0+IGNvbnRyb2xzLnVwZGF0ZVJhbmdlRmlsbC5jYWxsKHBsYXllciwgZXZlbnQudGFyZ2V0KSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gLy8gQ3VycmVudCB0aW1lIGludmVydFxuICAgICAgICAvLyBPbmx5IGlmIG9uZSB0aW1lIGVsZW1lbnQgaXMgdXNlZCBmb3IgYm90aCBjdXJyZW50VGltZSBhbmQgZHVyYXRpb25cblxuXG4gICAgICAgIGlmIChwbGF5ZXIuY29uZmlnLnRvZ2dsZUludmVydCAmJiAhaXMuZWxlbWVudChlbGVtZW50cy5kaXNwbGF5LmR1cmF0aW9uKSkge1xuICAgICAgICAgIHRoaXMuYmluZChlbGVtZW50cy5kaXNwbGF5LmN1cnJlbnRUaW1lLCAnY2xpY2snLCAoKSA9PiB7XG4gICAgICAgICAgICAvLyBEbyBub3RoaW5nIGlmIHdlJ3JlIGF0IHRoZSBzdGFydFxuICAgICAgICAgICAgaWYgKHBsYXllci5jdXJyZW50VGltZSA9PT0gMCkge1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHBsYXllci5jb25maWcuaW52ZXJ0VGltZSA9ICFwbGF5ZXIuY29uZmlnLmludmVydFRpbWU7XG4gICAgICAgICAgICBjb250cm9scy50aW1lVXBkYXRlLmNhbGwocGxheWVyKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSAvLyBWb2x1bWVcblxuXG4gICAgICAgIHRoaXMuYmluZChlbGVtZW50cy5pbnB1dHMudm9sdW1lLCBpbnB1dEV2ZW50LCBldmVudCA9PiB7XG4gICAgICAgICAgcGxheWVyLnZvbHVtZSA9IGV2ZW50LnRhcmdldC52YWx1ZTtcbiAgICAgICAgfSwgJ3ZvbHVtZScpOyAvLyBVcGRhdGUgY29udHJvbHMuaG92ZXIgc3RhdGUgKHVzZWQgZm9yIHVpLnRvZ2dsZUNvbnRyb2xzIHRvIGF2b2lkIGhpZGluZyB3aGVuIGludGVyYWN0aW5nKVxuXG4gICAgICAgIHRoaXMuYmluZChlbGVtZW50cy5jb250cm9scywgJ21vdXNlZW50ZXIgbW91c2VsZWF2ZScsIGV2ZW50ID0+IHtcbiAgICAgICAgICBlbGVtZW50cy5jb250cm9scy5ob3ZlciA9ICFwbGF5ZXIudG91Y2ggJiYgZXZlbnQudHlwZSA9PT0gJ21vdXNlZW50ZXInO1xuICAgICAgICB9KTsgLy8gQWxzbyB1cGRhdGUgY29udHJvbHMuaG92ZXIgc3RhdGUgZm9yIGFueSBub24tcGxheWVyIGNoaWxkcmVuIG9mIGZ1bGxzY3JlZW4gZWxlbWVudCAoYXMgYWJvdmUpXG5cbiAgICAgICAgaWYgKGVsZW1lbnRzLmZ1bGxzY3JlZW4pIHtcbiAgICAgICAgICBBcnJheS5mcm9tKGVsZW1lbnRzLmZ1bGxzY3JlZW4uY2hpbGRyZW4pLmZpbHRlcihjID0+ICFjLmNvbnRhaW5zKGVsZW1lbnRzLmNvbnRhaW5lcikpLmZvckVhY2goY2hpbGQgPT4ge1xuICAgICAgICAgICAgdGhpcy5iaW5kKGNoaWxkLCAnbW91c2VlbnRlciBtb3VzZWxlYXZlJywgZXZlbnQgPT4ge1xuICAgICAgICAgICAgICBpZiAoZWxlbWVudHMuY29udHJvbHMpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50cy5jb250cm9scy5ob3ZlciA9ICFwbGF5ZXIudG91Y2ggJiYgZXZlbnQudHlwZSA9PT0gJ21vdXNlZW50ZXInO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSAvLyBVcGRhdGUgY29udHJvbHMucHJlc3NlZCBzdGF0ZSAodXNlZCBmb3IgdWkudG9nZ2xlQ29udHJvbHMgdG8gYXZvaWQgaGlkaW5nIHdoZW4gaW50ZXJhY3RpbmcpXG5cblxuICAgICAgICB0aGlzLmJpbmQoZWxlbWVudHMuY29udHJvbHMsICdtb3VzZWRvd24gbW91c2V1cCB0b3VjaHN0YXJ0IHRvdWNoZW5kIHRvdWNoY2FuY2VsJywgZXZlbnQgPT4ge1xuICAgICAgICAgIGVsZW1lbnRzLmNvbnRyb2xzLnByZXNzZWQgPSBbJ21vdXNlZG93bicsICd0b3VjaHN0YXJ0J10uaW5jbHVkZXMoZXZlbnQudHlwZSk7XG4gICAgICAgIH0pOyAvLyBTaG93IGNvbnRyb2xzIHdoZW4gdGhleSByZWNlaXZlIGZvY3VzIChlLmcuLCB3aGVuIHVzaW5nIGtleWJvYXJkIHRhYiBrZXkpXG5cbiAgICAgICAgdGhpcy5iaW5kKGVsZW1lbnRzLmNvbnRyb2xzLCAnZm9jdXNpbicsICgpID0+IHtcbiAgICAgICAgICBjb25zdCB7XG4gICAgICAgICAgICBjb25maWcsXG4gICAgICAgICAgICB0aW1lcnNcbiAgICAgICAgICB9ID0gcGxheWVyOyAvLyBTa2lwIHRyYW5zaXRpb24gdG8gcHJldmVudCBmb2N1cyBmcm9tIHNjcm9sbGluZyB0aGUgcGFyZW50IGVsZW1lbnRcblxuICAgICAgICAgIHRvZ2dsZUNsYXNzKGVsZW1lbnRzLmNvbnRyb2xzLCBjb25maWcuY2xhc3NOYW1lcy5ub1RyYW5zaXRpb24sIHRydWUpOyAvLyBUb2dnbGVcblxuICAgICAgICAgIHVpLnRvZ2dsZUNvbnRyb2xzLmNhbGwocGxheWVyLCB0cnVlKTsgLy8gUmVzdG9yZSB0cmFuc2l0aW9uXG5cbiAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgIHRvZ2dsZUNsYXNzKGVsZW1lbnRzLmNvbnRyb2xzLCBjb25maWcuY2xhc3NOYW1lcy5ub1RyYW5zaXRpb24sIGZhbHNlKTtcbiAgICAgICAgICB9LCAwKTsgLy8gRGVsYXkgYSBsaXR0bGUgbW9yZSBmb3IgbW91c2UgdXNlcnNcblxuICAgICAgICAgIGNvbnN0IGRlbGF5ID0gdGhpcy50b3VjaCA/IDMwMDAgOiA0MDAwOyAvLyBDbGVhciB0aW1lclxuXG4gICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVycy5jb250cm9scyk7IC8vIEhpZGUgYWdhaW4gYWZ0ZXIgZGVsYXlcblxuICAgICAgICAgIHRpbWVycy5jb250cm9scyA9IHNldFRpbWVvdXQoKCkgPT4gdWkudG9nZ2xlQ29udHJvbHMuY2FsbChwbGF5ZXIsIGZhbHNlKSwgZGVsYXkpO1xuICAgICAgICB9KTsgLy8gTW91c2Ugd2hlZWwgZm9yIHZvbHVtZVxuXG4gICAgICAgIHRoaXMuYmluZChlbGVtZW50cy5pbnB1dHMudm9sdW1lLCAnd2hlZWwnLCBldmVudCA9PiB7XG4gICAgICAgICAgLy8gRGV0ZWN0IFwibmF0dXJhbFwiIHNjcm9sbCAtIHN1cHBvcnRlZCBvbiBPUyBYIFNhZmFyaSBvbmx5XG4gICAgICAgICAgLy8gT3RoZXIgYnJvd3NlcnMgb24gT1MgWCB3aWxsIGJlIGludmVydGVkIHVudGlsIHN1cHBvcnQgaW1wcm92ZXNcbiAgICAgICAgICBjb25zdCBpbnZlcnRlZCA9IGV2ZW50LndlYmtpdERpcmVjdGlvbkludmVydGVkRnJvbURldmljZTsgLy8gR2V0IGRlbHRhIGZyb20gZXZlbnQuIEludmVydCBpZiBgaW52ZXJ0ZWRgIGlzIHRydWVcblxuICAgICAgICAgIGNvbnN0IFt4LCB5XSA9IFtldmVudC5kZWx0YVgsIC1ldmVudC5kZWx0YVldLm1hcCh2YWx1ZSA9PiBpbnZlcnRlZCA/IC12YWx1ZSA6IHZhbHVlKTsgLy8gVXNpbmcgdGhlIGJpZ2dlc3QgZGVsdGEsIG5vcm1hbGl6ZSB0byAxIG9yIC0xIChvciAwIGlmIG5vIGRlbHRhKVxuXG4gICAgICAgICAgY29uc3QgZGlyZWN0aW9uID0gTWF0aC5zaWduKE1hdGguYWJzKHgpID4gTWF0aC5hYnMoeSkgPyB4IDogeSk7IC8vIENoYW5nZSB0aGUgdm9sdW1lIGJ5IDIlXG5cbiAgICAgICAgICBwbGF5ZXIuaW5jcmVhc2VWb2x1bWUoZGlyZWN0aW9uIC8gNTApOyAvLyBEb24ndCBicmVhayBwYWdlIHNjcm9sbGluZyBhdCBtYXggYW5kIG1pblxuXG4gICAgICAgICAgY29uc3Qge1xuICAgICAgICAgICAgdm9sdW1lXG4gICAgICAgICAgfSA9IHBsYXllci5tZWRpYTtcblxuICAgICAgICAgIGlmIChkaXJlY3Rpb24gPT09IDEgJiYgdm9sdW1lIDwgMSB8fCBkaXJlY3Rpb24gPT09IC0xICYmIHZvbHVtZSA+IDApIHtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgfVxuICAgICAgICB9LCAndm9sdW1lJywgZmFsc2UpO1xuICAgICAgfSk7XG5cbiAgICAgIHRoaXMucGxheWVyID0gX3BsYXllcjtcbiAgICAgIHRoaXMubGFzdEtleSA9IG51bGw7XG4gICAgICB0aGlzLmZvY3VzVGltZXIgPSBudWxsO1xuICAgICAgdGhpcy5sYXN0S2V5RG93biA9IG51bGw7XG4gICAgICB0aGlzLmhhbmRsZUtleSA9IHRoaXMuaGFuZGxlS2V5LmJpbmQodGhpcyk7XG4gICAgICB0aGlzLnRvZ2dsZU1lbnUgPSB0aGlzLnRvZ2dsZU1lbnUuYmluZCh0aGlzKTtcbiAgICAgIHRoaXMuc2V0VGFiRm9jdXMgPSB0aGlzLnNldFRhYkZvY3VzLmJpbmQodGhpcyk7XG4gICAgICB0aGlzLmZpcnN0VG91Y2ggPSB0aGlzLmZpcnN0VG91Y2guYmluZCh0aGlzKTtcbiAgICB9IC8vIEhhbmRsZSBrZXkgcHJlc3Nlc1xuXG5cbiAgICBoYW5kbGVLZXkoZXZlbnQpIHtcbiAgICAgIGNvbnN0IHtcbiAgICAgICAgcGxheWVyXG4gICAgICB9ID0gdGhpcztcbiAgICAgIGNvbnN0IHtcbiAgICAgICAgZWxlbWVudHNcbiAgICAgIH0gPSBwbGF5ZXI7XG4gICAgICBjb25zdCB7XG4gICAgICAgIGtleSxcbiAgICAgICAgdHlwZSxcbiAgICAgICAgYWx0S2V5LFxuICAgICAgICBjdHJsS2V5LFxuICAgICAgICBtZXRhS2V5LFxuICAgICAgICBzaGlmdEtleVxuICAgICAgfSA9IGV2ZW50O1xuICAgICAgY29uc3QgcHJlc3NlZCA9IHR5cGUgPT09ICdrZXlkb3duJztcbiAgICAgIGNvbnN0IHJlcGVhdCA9IHByZXNzZWQgJiYga2V5ID09PSB0aGlzLmxhc3RLZXk7IC8vIEJhaWwgaWYgYSBtb2RpZmllciBrZXkgaXMgc2V0XG5cbiAgICAgIGlmIChhbHRLZXkgfHwgY3RybEtleSB8fCBtZXRhS2V5IHx8IHNoaWZ0S2V5KSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH0gLy8gSWYgdGhlIGV2ZW50IGlzIGJ1YmJsZWQgZnJvbSB0aGUgbWVkaWEgZWxlbWVudFxuICAgICAgLy8gRmlyZWZveCBkb2Vzbid0IGdldCB0aGUga2V5IGZvciB3aGF0ZXZlciByZWFzb25cblxuXG4gICAgICBpZiAoIWtleSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9IC8vIFNlZWsgYnkgaW5jcmVtZW50XG5cblxuICAgICAgY29uc3Qgc2Vla0J5SW5jcmVtZW50ID0gaW5jcmVtZW50ID0+IHtcbiAgICAgICAgLy8gRGl2aWRlIHRoZSBtYXggZHVyYXRpb24gaW50byAxMHRoJ3MgYW5kIHRpbWVzIGJ5IHRoZSBudW1iZXIgdmFsdWVcbiAgICAgICAgcGxheWVyLmN1cnJlbnRUaW1lID0gcGxheWVyLmR1cmF0aW9uIC8gMTAgKiBpbmNyZW1lbnQ7XG4gICAgICB9OyAvLyBIYW5kbGUgdGhlIGtleSBvbiBrZXlkb3duXG4gICAgICAvLyBSZXNldCBvbiBrZXl1cFxuXG5cbiAgICAgIGlmIChwcmVzc2VkKSB7XG4gICAgICAgIC8vIENoZWNrIGZvY3VzZWQgZWxlbWVudFxuICAgICAgICAvLyBhbmQgaWYgdGhlIGZvY3VzZWQgZWxlbWVudCBpcyBub3QgZWRpdGFibGUgKGUuZy4gdGV4dCBpbnB1dClcbiAgICAgICAgLy8gYW5kIGFueSB0aGF0IGFjY2VwdCBrZXkgaW5wdXQgaHR0cDovL3dlYmFpbS5vcmcvdGVjaG5pcXVlcy9rZXlib2FyZC9cbiAgICAgICAgY29uc3QgZm9jdXNlZCA9IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQ7XG5cbiAgICAgICAgaWYgKGlzLmVsZW1lbnQoZm9jdXNlZCkpIHtcbiAgICAgICAgICBjb25zdCB7XG4gICAgICAgICAgICBlZGl0YWJsZVxuICAgICAgICAgIH0gPSBwbGF5ZXIuY29uZmlnLnNlbGVjdG9ycztcbiAgICAgICAgICBjb25zdCB7XG4gICAgICAgICAgICBzZWVrXG4gICAgICAgICAgfSA9IGVsZW1lbnRzLmlucHV0cztcblxuICAgICAgICAgIGlmIChmb2N1c2VkICE9PSBzZWVrICYmIG1hdGNoZXMoZm9jdXNlZCwgZWRpdGFibGUpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKGV2ZW50LmtleSA9PT0gJ1NwYWNlJyAmJiBtYXRjaGVzKGZvY3VzZWQsICdidXR0b24sIFtyb2xlXj1cIm1lbnVpdGVtXCJdJykpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgIH0gLy8gV2hpY2gga2V5cyBzaG91bGQgd2UgcHJldmVudCBkZWZhdWx0XG5cblxuICAgICAgICBjb25zdCBwcmV2ZW50RGVmYXVsdCA9IFsnU3BhY2UnLCAnQXJyb3dMZWZ0JywgJ0Fycm93VXAnLCAnQXJyb3dSaWdodCcsICdBcnJvd0Rvd24nLCAnMCcsICcxJywgJzInLCAnMycsICc0JywgJzUnLCAnNicsICc3JywgJzgnLCAnOScsICdjJywgJ2YnLCAnaycsICdsJywgJ20nXTsgLy8gSWYgdGhlIGtleSBpcyBmb3VuZCBwcmV2ZW50IGRlZmF1bHQgKGUuZy4gcHJldmVudCBzY3JvbGxpbmcgZm9yIGFycm93cylcblxuICAgICAgICBpZiAocHJldmVudERlZmF1bHQuaW5jbHVkZXMoa2V5KSkge1xuICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIH1cblxuICAgICAgICBzd2l0Y2ggKGtleSkge1xuICAgICAgICAgIGNhc2UgJzAnOlxuICAgICAgICAgIGNhc2UgJzEnOlxuICAgICAgICAgIGNhc2UgJzInOlxuICAgICAgICAgIGNhc2UgJzMnOlxuICAgICAgICAgIGNhc2UgJzQnOlxuICAgICAgICAgIGNhc2UgJzUnOlxuICAgICAgICAgIGNhc2UgJzYnOlxuICAgICAgICAgIGNhc2UgJzcnOlxuICAgICAgICAgIGNhc2UgJzgnOlxuICAgICAgICAgIGNhc2UgJzknOlxuICAgICAgICAgICAgaWYgKCFyZXBlYXQpIHtcbiAgICAgICAgICAgICAgc2Vla0J5SW5jcmVtZW50KHBhcnNlSW50KGtleSwgMTApKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBjYXNlICdTcGFjZSc6XG4gICAgICAgICAgY2FzZSAnayc6XG4gICAgICAgICAgICBpZiAoIXJlcGVhdCkge1xuICAgICAgICAgICAgICBzaWxlbmNlUHJvbWlzZShwbGF5ZXIudG9nZ2xlUGxheSgpKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBjYXNlICdBcnJvd1VwJzpcbiAgICAgICAgICAgIHBsYXllci5pbmNyZWFzZVZvbHVtZSgwLjEpO1xuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBjYXNlICdBcnJvd0Rvd24nOlxuICAgICAgICAgICAgcGxheWVyLmRlY3JlYXNlVm9sdW1lKDAuMSk7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGNhc2UgJ20nOlxuICAgICAgICAgICAgaWYgKCFyZXBlYXQpIHtcbiAgICAgICAgICAgICAgcGxheWVyLm11dGVkID0gIXBsYXllci5tdXRlZDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBjYXNlICdBcnJvd1JpZ2h0JzpcbiAgICAgICAgICAgIHBsYXllci5mb3J3YXJkKCk7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGNhc2UgJ0Fycm93TGVmdCc6XG4gICAgICAgICAgICBwbGF5ZXIucmV3aW5kKCk7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGNhc2UgJ2YnOlxuICAgICAgICAgICAgcGxheWVyLmZ1bGxzY3JlZW4udG9nZ2xlKCk7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGNhc2UgJ2MnOlxuICAgICAgICAgICAgaWYgKCFyZXBlYXQpIHtcbiAgICAgICAgICAgICAgcGxheWVyLnRvZ2dsZUNhcHRpb25zKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgY2FzZSAnbCc6XG4gICAgICAgICAgICBwbGF5ZXIubG9vcCA9ICFwbGF5ZXIubG9vcDtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9IC8vIEVzY2FwZSBpcyBoYW5kbGUgbmF0aXZlbHkgd2hlbiBpbiBmdWxsIHNjcmVlblxuICAgICAgICAvLyBTbyB3ZSBvbmx5IG5lZWQgdG8gd29ycnkgYWJvdXQgbm9uIG5hdGl2ZVxuXG5cbiAgICAgICAgaWYgKGtleSA9PT0gJ0VzY2FwZScgJiYgIXBsYXllci5mdWxsc2NyZWVuLnVzaW5nTmF0aXZlICYmIHBsYXllci5mdWxsc2NyZWVuLmFjdGl2ZSkge1xuICAgICAgICAgIHBsYXllci5mdWxsc2NyZWVuLnRvZ2dsZSgpO1xuICAgICAgICB9IC8vIFN0b3JlIGxhc3Qga2V5IGZvciBuZXh0IGN5Y2xlXG5cblxuICAgICAgICB0aGlzLmxhc3RLZXkgPSBrZXk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmxhc3RLZXkgPSBudWxsO1xuICAgICAgfVxuICAgIH0gLy8gVG9nZ2xlIG1lbnVcblxuXG4gICAgdG9nZ2xlTWVudShldmVudCkge1xuICAgICAgY29udHJvbHMudG9nZ2xlTWVudS5jYWxsKHRoaXMucGxheWVyLCBldmVudCk7XG4gICAgfSAvLyBEZXZpY2UgaXMgdG91Y2ggZW5hYmxlZFxuXG5cbiAgfVxuXG4gIHZhciBjb21tb25qc0dsb2JhbCA9IHR5cGVvZiBnbG9iYWxUaGlzICE9PSAndW5kZWZpbmVkJyA/IGdsb2JhbFRoaXMgOiB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyA/IHdpbmRvdyA6IHR5cGVvZiBnbG9iYWwgIT09ICd1bmRlZmluZWQnID8gZ2xvYmFsIDogdHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnID8gc2VsZiA6IHt9O1xuXG4gIGZ1bmN0aW9uIGNyZWF0ZUNvbW1vbmpzTW9kdWxlKGZuLCBtb2R1bGUpIHtcbiAgXHRyZXR1cm4gbW9kdWxlID0geyBleHBvcnRzOiB7fSB9LCBmbihtb2R1bGUsIG1vZHVsZS5leHBvcnRzKSwgbW9kdWxlLmV4cG9ydHM7XG4gIH1cblxuICB2YXIgbG9hZGpzX3VtZCA9IGNyZWF0ZUNvbW1vbmpzTW9kdWxlKGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHtcbiAgICAoZnVuY3Rpb24gKHJvb3QsIGZhY3RvcnkpIHtcbiAgICAgIHtcbiAgICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7XG4gICAgICB9XG4gICAgfSkoY29tbW9uanNHbG9iYWwsIGZ1bmN0aW9uICgpIHtcbiAgICAgIC8qKlxuICAgICAgICogR2xvYmFsIGRlcGVuZGVuY2llcy5cbiAgICAgICAqIEBnbG9iYWwge09iamVjdH0gZG9jdW1lbnQgLSBET01cbiAgICAgICAqL1xuICAgICAgdmFyIGRldm51bGwgPSBmdW5jdGlvbiAoKSB7fSxcbiAgICAgICAgICBidW5kbGVJZENhY2hlID0ge30sXG4gICAgICAgICAgYnVuZGxlUmVzdWx0Q2FjaGUgPSB7fSxcbiAgICAgICAgICBidW5kbGVDYWxsYmFja1F1ZXVlID0ge307XG4gICAgICAvKipcbiAgICAgICAqIFN1YnNjcmliZSB0byBidW5kbGUgbG9hZCBldmVudC5cbiAgICAgICAqIEBwYXJhbSB7c3RyaW5nW119IGJ1bmRsZUlkcyAtIEJ1bmRsZSBpZHNcbiAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrRm4gLSBUaGUgY2FsbGJhY2sgZnVuY3Rpb25cbiAgICAgICAqL1xuXG5cbiAgICAgIGZ1bmN0aW9uIHN1YnNjcmliZShidW5kbGVJZHMsIGNhbGxiYWNrRm4pIHtcbiAgICAgICAgLy8gbGlzdGlmeVxuICAgICAgICBidW5kbGVJZHMgPSBidW5kbGVJZHMucHVzaCA/IGJ1bmRsZUlkcyA6IFtidW5kbGVJZHNdO1xuICAgICAgICB2YXIgZGVwc05vdEZvdW5kID0gW10sXG4gICAgICAgICAgICBpID0gYnVuZGxlSWRzLmxlbmd0aCxcbiAgICAgICAgICAgIG51bVdhaXRpbmcgPSBpLFxuICAgICAgICAgICAgZm4sXG4gICAgICAgICAgICBidW5kbGVJZCxcbiAgICAgICAgICAgIHIsXG4gICAgICAgICAgICBxOyAvLyBkZWZpbmUgY2FsbGJhY2sgZnVuY3Rpb25cblxuICAgICAgICBmbiA9IGZ1bmN0aW9uIChidW5kbGVJZCwgcGF0aHNOb3RGb3VuZCkge1xuICAgICAgICAgIGlmIChwYXRoc05vdEZvdW5kLmxlbmd0aCkgZGVwc05vdEZvdW5kLnB1c2goYnVuZGxlSWQpO1xuICAgICAgICAgIG51bVdhaXRpbmctLTtcbiAgICAgICAgICBpZiAoIW51bVdhaXRpbmcpIGNhbGxiYWNrRm4oZGVwc05vdEZvdW5kKTtcbiAgICAgICAgfTsgLy8gcmVnaXN0ZXIgY2FsbGJhY2tcblxuXG4gICAgICAgIHdoaWxlIChpLS0pIHtcbiAgICAgICAgICBidW5kbGVJZCA9IGJ1bmRsZUlkc1tpXTsgLy8gZXhlY3V0ZSBjYWxsYmFjayBpZiBpbiByZXN1bHQgY2FjaGVcblxuICAgICAgICAgIHIgPSBidW5kbGVSZXN1bHRDYWNoZVtidW5kbGVJZF07XG5cbiAgICAgICAgICBpZiAocikge1xuICAgICAgICAgICAgZm4oYnVuZGxlSWQsIHIpO1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgfSAvLyBhZGQgdG8gY2FsbGJhY2sgcXVldWVcblxuXG4gICAgICAgICAgcSA9IGJ1bmRsZUNhbGxiYWNrUXVldWVbYnVuZGxlSWRdID0gYnVuZGxlQ2FsbGJhY2tRdWV1ZVtidW5kbGVJZF0gfHwgW107XG4gICAgICAgICAgcS5wdXNoKGZuKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgLyoqXG4gICAgICAgKiBQdWJsaXNoIGJ1bmRsZSBsb2FkIGV2ZW50LlxuICAgICAgICogQHBhcmFtIHtzdHJpbmd9IGJ1bmRsZUlkIC0gQnVuZGxlIGlkXG4gICAgICAgKiBAcGFyYW0ge3N0cmluZ1tdfSBwYXRoc05vdEZvdW5kIC0gTGlzdCBvZiBmaWxlcyBub3QgZm91bmRcbiAgICAgICAqL1xuXG5cbiAgICAgIGZ1bmN0aW9uIHB1Ymxpc2goYnVuZGxlSWQsIHBhdGhzTm90Rm91bmQpIHtcbiAgICAgICAgLy8gZXhpdCBpZiBpZCBpc24ndCBkZWZpbmVkXG4gICAgICAgIGlmICghYnVuZGxlSWQpIHJldHVybjtcbiAgICAgICAgdmFyIHEgPSBidW5kbGVDYWxsYmFja1F1ZXVlW2J1bmRsZUlkXTsgLy8gY2FjaGUgcmVzdWx0XG5cbiAgICAgICAgYnVuZGxlUmVzdWx0Q2FjaGVbYnVuZGxlSWRdID0gcGF0aHNOb3RGb3VuZDsgLy8gZXhpdCBpZiBxdWV1ZSBpcyBlbXB0eVxuXG4gICAgICAgIGlmICghcSkgcmV0dXJuOyAvLyBlbXB0eSBjYWxsYmFjayBxdWV1ZVxuXG4gICAgICAgIHdoaWxlIChxLmxlbmd0aCkge1xuICAgICAgICAgIHFbMF0oYnVuZGxlSWQsIHBhdGhzTm90Rm91bmQpO1xuICAgICAgICAgIHEuc3BsaWNlKDAsIDEpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICAvKipcbiAgICAgICAqIEV4ZWN1dGUgY2FsbGJhY2tzLlxuICAgICAgICogQHBhcmFtIHtPYmplY3Qgb3IgRnVuY3Rpb259IGFyZ3MgLSBUaGUgY2FsbGJhY2sgYXJnc1xuICAgICAgICogQHBhcmFtIHtzdHJpbmdbXX0gZGVwc05vdEZvdW5kIC0gTGlzdCBvZiBkZXBlbmRlbmNpZXMgbm90IGZvdW5kXG4gICAgICAgKi9cblxuXG4gICAgICBmdW5jdGlvbiBleGVjdXRlQ2FsbGJhY2tzKGFyZ3MsIGRlcHNOb3RGb3VuZCkge1xuICAgICAgICAvLyBhY2NlcHQgZnVuY3Rpb24gYXMgYXJndW1lbnRcbiAgICAgICAgaWYgKGFyZ3MuY2FsbCkgYXJncyA9IHtcbiAgICAgICAgICBzdWNjZXNzOiBhcmdzXG4gICAgICAgIH07IC8vIHN1Y2Nlc3MgYW5kIGVycm9yIGNhbGxiYWNrc1xuXG4gICAgICAgIGlmIChkZXBzTm90Rm91bmQubGVuZ3RoKSAoYXJncy5lcnJvciB8fCBkZXZudWxsKShkZXBzTm90Rm91bmQpO2Vsc2UgKGFyZ3Muc3VjY2VzcyB8fCBkZXZudWxsKShhcmdzKTtcbiAgICAgIH1cbiAgICAgIC8qKlxuICAgICAgICogTG9hZCBpbmRpdmlkdWFsIGZpbGUuXG4gICAgICAgKiBAcGFyYW0ge3N0cmluZ30gcGF0aCAtIFRoZSBmaWxlIHBhdGhcbiAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrRm4gLSBUaGUgY2FsbGJhY2sgZnVuY3Rpb25cbiAgICAgICAqL1xuXG5cbiAgICAgIGZ1bmN0aW9uIGxvYWRGaWxlKHBhdGgsIGNhbGxiYWNrRm4sIGFyZ3MsIG51bVRyaWVzKSB7XG4gICAgICAgIHZhciBkb2MgPSBkb2N1bWVudCxcbiAgICAgICAgICAgIGFzeW5jID0gYXJncy5hc3luYyxcbiAgICAgICAgICAgIG1heFRyaWVzID0gKGFyZ3MubnVtUmV0cmllcyB8fCAwKSArIDEsXG4gICAgICAgICAgICBiZWZvcmVDYWxsYmFja0ZuID0gYXJncy5iZWZvcmUgfHwgZGV2bnVsbCxcbiAgICAgICAgICAgIHBhdGhuYW1lID0gcGF0aC5yZXBsYWNlKC9bXFw/fCNdLiokLywgJycpLFxuICAgICAgICAgICAgcGF0aFN0cmlwcGVkID0gcGF0aC5yZXBsYWNlKC9eKGNzc3xpbWcpIS8sICcnKSxcbiAgICAgICAgICAgIGlzTGVnYWN5SUVDc3MsXG4gICAgICAgICAgICBlO1xuICAgICAgICBudW1UcmllcyA9IG51bVRyaWVzIHx8IDA7XG5cbiAgICAgICAgaWYgKC8oXmNzcyF8XFwuY3NzJCkvLnRlc3QocGF0aG5hbWUpKSB7XG4gICAgICAgICAgLy8gY3NzXG4gICAgICAgICAgZSA9IGRvYy5jcmVhdGVFbGVtZW50KCdsaW5rJyk7XG4gICAgICAgICAgZS5yZWwgPSAnc3R5bGVzaGVldCc7XG4gICAgICAgICAgZS5ocmVmID0gcGF0aFN0cmlwcGVkOyAvLyB0YWcgSUU5K1xuXG4gICAgICAgICAgaXNMZWdhY3lJRUNzcyA9ICdoaWRlRm9jdXMnIGluIGU7IC8vIHVzZSBwcmVsb2FkIGluIElFIEVkZ2UgKHRvIGRldGVjdCBsb2FkIGVycm9ycylcblxuICAgICAgICAgIGlmIChpc0xlZ2FjeUlFQ3NzICYmIGUucmVsTGlzdCkge1xuICAgICAgICAgICAgaXNMZWdhY3lJRUNzcyA9IDA7XG4gICAgICAgICAgICBlLnJlbCA9ICdwcmVsb2FkJztcbiAgICAgICAgICAgIGUuYXMgPSAnc3R5bGUnO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmICgvKF5pbWchfFxcLihwbmd8Z2lmfGpwZ3xzdmd8d2VicCkkKS8udGVzdChwYXRobmFtZSkpIHtcbiAgICAgICAgICAvLyBpbWFnZVxuICAgICAgICAgIGUgPSBkb2MuY3JlYXRlRWxlbWVudCgnaW1nJyk7XG4gICAgICAgICAgZS5zcmMgPSBwYXRoU3RyaXBwZWQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gamF2YXNjcmlwdFxuICAgICAgICAgIGUgPSBkb2MuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7XG4gICAgICAgICAgZS5zcmMgPSBwYXRoO1xuICAgICAgICAgIGUuYXN5bmMgPSBhc3luYyA9PT0gdW5kZWZpbmVkID8gdHJ1ZSA6IGFzeW5jO1xuICAgICAgICB9XG5cbiAgICAgICAgZS5vbmxvYWQgPSBlLm9uZXJyb3IgPSBlLm9uYmVmb3JlbG9hZCA9IGZ1bmN0aW9uIChldikge1xuICAgICAgICAgIHZhciByZXN1bHQgPSBldi50eXBlWzBdOyAvLyB0cmVhdCBlbXB0eSBzdHlsZXNoZWV0cyBhcyBmYWlsdXJlcyB0byBnZXQgYXJvdW5kIGxhY2sgb2Ygb25lcnJvclxuICAgICAgICAgIC8vIHN1cHBvcnQgaW4gSUU5LTExXG5cbiAgICAgICAgICBpZiAoaXNMZWdhY3lJRUNzcykge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgaWYgKCFlLnNoZWV0LmNzc1RleHQubGVuZ3RoKSByZXN1bHQgPSAnZSc7XG4gICAgICAgICAgICB9IGNhdGNoICh4KSB7XG4gICAgICAgICAgICAgIC8vIHNoZWV0cyBvYmplY3RzIGNyZWF0ZWQgZnJvbSBsb2FkIGVycm9ycyBkb24ndCBhbGxvdyBhY2Nlc3MgdG9cbiAgICAgICAgICAgICAgLy8gYGNzc1RleHRgICh1bmxlc3MgZXJyb3IgaXMgQ29kZToxOCBTZWN1cml0eUVycm9yKVxuICAgICAgICAgICAgICBpZiAoeC5jb2RlICE9IDE4KSByZXN1bHQgPSAnZSc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSAvLyBoYW5kbGUgcmV0cmllcyBpbiBjYXNlIG9mIGxvYWQgZmFpbHVyZVxuXG5cbiAgICAgICAgICBpZiAocmVzdWx0ID09ICdlJykge1xuICAgICAgICAgICAgLy8gaW5jcmVtZW50IGNvdW50ZXJcbiAgICAgICAgICAgIG51bVRyaWVzICs9IDE7IC8vIGV4aXQgZnVuY3Rpb24gYW5kIHRyeSBhZ2FpblxuXG4gICAgICAgICAgICBpZiAobnVtVHJpZXMgPCBtYXhUcmllcykge1xuICAgICAgICAgICAgICByZXR1cm4gbG9hZEZpbGUocGF0aCwgY2FsbGJhY2tGbiwgYXJncywgbnVtVHJpZXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSBpZiAoZS5yZWwgPT0gJ3ByZWxvYWQnICYmIGUuYXMgPT0gJ3N0eWxlJykge1xuICAgICAgICAgICAgLy8gYWN0aXZhdGUgcHJlbG9hZGVkIHN0eWxlc2hlZXRzXG4gICAgICAgICAgICByZXR1cm4gZS5yZWwgPSAnc3R5bGVzaGVldCc7IC8vIGpzaGludCBpZ25vcmU6bGluZVxuICAgICAgICAgIH0gLy8gZXhlY3V0ZSBjYWxsYmFja1xuXG5cbiAgICAgICAgICBjYWxsYmFja0ZuKHBhdGgsIHJlc3VsdCwgZXYuZGVmYXVsdFByZXZlbnRlZCk7XG4gICAgICAgIH07IC8vIGFkZCB0byBkb2N1bWVudCAodW5sZXNzIGNhbGxiYWNrIHJldHVybnMgYGZhbHNlYClcblxuXG4gICAgICAgIGlmIChiZWZvcmVDYWxsYmFja0ZuKHBhdGgsIGUpICE9PSBmYWxzZSkgZG9jLmhlYWQuYXBwZW5kQ2hpbGQoZSk7XG4gICAgICB9XG4gICAgICAvKipcbiAgICAgICAqIExvYWQgbXVsdGlwbGUgZmlsZXMuXG4gICAgICAgKiBAcGFyYW0ge3N0cmluZ1tdfSBwYXRocyAtIFRoZSBmaWxlIHBhdGhzXG4gICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFja0ZuIC0gVGhlIGNhbGxiYWNrIGZ1bmN0aW9uXG4gICAgICAgKi9cblxuXG4gICAgICBmdW5jdGlvbiBsb2FkRmlsZXMocGF0aHMsIGNhbGxiYWNrRm4sIGFyZ3MpIHtcbiAgICAgICAgLy8gbGlzdGlmeSBwYXRoc1xuICAgICAgICBwYXRocyA9IHBhdGhzLnB1c2ggPyBwYXRocyA6IFtwYXRoc107XG4gICAgICAgIHZhciBudW1XYWl0aW5nID0gcGF0aHMubGVuZ3RoLFxuICAgICAgICAgICAgeCA9IG51bVdhaXRpbmcsXG4gICAgICAgICAgICBwYXRoc05vdEZvdW5kID0gW10sXG4gICAgICAgICAgICBmbixcbiAgICAgICAgICAgIGk7IC8vIGRlZmluZSBjYWxsYmFjayBmdW5jdGlvblxuXG4gICAgICAgIGZuID0gZnVuY3Rpb24gKHBhdGgsIHJlc3VsdCwgZGVmYXVsdFByZXZlbnRlZCkge1xuICAgICAgICAgIC8vIGhhbmRsZSBlcnJvclxuICAgICAgICAgIGlmIChyZXN1bHQgPT0gJ2UnKSBwYXRoc05vdEZvdW5kLnB1c2gocGF0aCk7IC8vIGhhbmRsZSBiZWZvcmVsb2FkIGV2ZW50LiBJZiBkZWZhdWx0UHJldmVudGVkIHRoZW4gdGhhdCBtZWFucyB0aGUgbG9hZFxuICAgICAgICAgIC8vIHdpbGwgYmUgYmxvY2tlZCAoZXguIEdob3N0ZXJ5L0FCUCBvbiBTYWZhcmkpXG5cbiAgICAgICAgICBpZiAocmVzdWx0ID09ICdiJykge1xuICAgICAgICAgICAgaWYgKGRlZmF1bHRQcmV2ZW50ZWQpIHBhdGhzTm90Rm91bmQucHVzaChwYXRoKTtlbHNlIHJldHVybjtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBudW1XYWl0aW5nLS07XG4gICAgICAgICAgaWYgKCFudW1XYWl0aW5nKSBjYWxsYmFja0ZuKHBhdGhzTm90Rm91bmQpO1xuICAgICAgICB9OyAvLyBsb2FkIHNjcmlwdHNcblxuXG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCB4OyBpKyspIGxvYWRGaWxlKHBhdGhzW2ldLCBmbiwgYXJncyk7XG4gICAgICB9XG4gICAgICAvKipcbiAgICAgICAqIEluaXRpYXRlIHNjcmlwdCBsb2FkIGFuZCByZWdpc3RlciBidW5kbGUuXG4gICAgICAgKiBAcGFyYW0geyhzdHJpbmd8c3RyaW5nW10pfSBwYXRocyAtIFRoZSBmaWxlIHBhdGhzXG4gICAgICAgKiBAcGFyYW0geyhzdHJpbmd8RnVuY3Rpb258T2JqZWN0KX0gW2FyZzFdIC0gVGhlICgxKSBidW5kbGVJZCBvciAoMikgc3VjY2Vzc1xuICAgICAgICogICBjYWxsYmFjayBvciAoMykgb2JqZWN0IGxpdGVyYWwgd2l0aCBzdWNjZXNzL2Vycm9yIGFyZ3VtZW50cywgbnVtUmV0cmllcyxcbiAgICAgICAqICAgZXRjLlxuICAgICAgICogQHBhcmFtIHsoRnVuY3Rpb258T2JqZWN0KX0gW2FyZzJdIC0gVGhlICgxKSBzdWNjZXNzIGNhbGxiYWNrIG9yICgyKSBvYmplY3RcbiAgICAgICAqICAgbGl0ZXJhbCB3aXRoIHN1Y2Nlc3MvZXJyb3IgYXJndW1lbnRzLCBudW1SZXRyaWVzLCBldGMuXG4gICAgICAgKi9cblxuXG4gICAgICBmdW5jdGlvbiBsb2FkanMocGF0aHMsIGFyZzEsIGFyZzIpIHtcbiAgICAgICAgdmFyIGJ1bmRsZUlkLCBhcmdzOyAvLyBidW5kbGVJZCAoaWYgc3RyaW5nKVxuXG4gICAgICAgIGlmIChhcmcxICYmIGFyZzEudHJpbSkgYnVuZGxlSWQgPSBhcmcxOyAvLyBhcmdzIChkZWZhdWx0IGlzIHt9KVxuXG4gICAgICAgIGFyZ3MgPSAoYnVuZGxlSWQgPyBhcmcyIDogYXJnMSkgfHwge307IC8vIHRocm93IGVycm9yIGlmIGJ1bmRsZSBpcyBhbHJlYWR5IGRlZmluZWRcblxuICAgICAgICBpZiAoYnVuZGxlSWQpIHtcbiAgICAgICAgICBpZiAoYnVuZGxlSWQgaW4gYnVuZGxlSWRDYWNoZSkge1xuICAgICAgICAgICAgdGhyb3cgXCJMb2FkSlNcIjtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYnVuZGxlSWRDYWNoZVtidW5kbGVJZF0gPSB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGxvYWRGbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgICBsb2FkRmlsZXMocGF0aHMsIGZ1bmN0aW9uIChwYXRoc05vdEZvdW5kKSB7XG4gICAgICAgICAgICAvLyBleGVjdXRlIGNhbGxiYWNrc1xuICAgICAgICAgICAgZXhlY3V0ZUNhbGxiYWNrcyhhcmdzLCBwYXRoc05vdEZvdW5kKTsgLy8gcmVzb2x2ZSBQcm9taXNlXG5cbiAgICAgICAgICAgIGlmIChyZXNvbHZlKSB7XG4gICAgICAgICAgICAgIGV4ZWN1dGVDYWxsYmFja3Moe1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IHJlc29sdmUsXG4gICAgICAgICAgICAgICAgZXJyb3I6IHJlamVjdFxuICAgICAgICAgICAgICB9LCBwYXRoc05vdEZvdW5kKTtcbiAgICAgICAgICAgIH0gLy8gcHVibGlzaCBidW5kbGUgbG9hZCBldmVudFxuXG5cbiAgICAgICAgICAgIHB1Ymxpc2goYnVuZGxlSWQsIHBhdGhzTm90Rm91bmQpO1xuICAgICAgICAgIH0sIGFyZ3MpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGFyZ3MucmV0dXJuUHJvbWlzZSkgcmV0dXJuIG5ldyBQcm9taXNlKGxvYWRGbik7ZWxzZSBsb2FkRm4oKTtcbiAgICAgIH1cbiAgICAgIC8qKlxuICAgICAgICogRXhlY3V0ZSBjYWxsYmFja3Mgd2hlbiBkZXBlbmRlbmNpZXMgaGF2ZSBiZWVuIHNhdGlzZmllZC5cbiAgICAgICAqIEBwYXJhbSB7KHN0cmluZ3xzdHJpbmdbXSl9IGRlcHMgLSBMaXN0IG9mIGJ1bmRsZSBpZHNcbiAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBhcmdzIC0gc3VjY2Vzcy9lcnJvciBhcmd1bWVudHNcbiAgICAgICAqL1xuXG5cbiAgICAgIGxvYWRqcy5yZWFkeSA9IGZ1bmN0aW9uIHJlYWR5KGRlcHMsIGFyZ3MpIHtcbiAgICAgICAgLy8gc3Vic2NyaWJlIHRvIGJ1bmRsZSBsb2FkIGV2ZW50XG4gICAgICAgIHN1YnNjcmliZShkZXBzLCBmdW5jdGlvbiAoZGVwc05vdEZvdW5kKSB7XG4gICAgICAgICAgLy8gZXhlY3V0ZSBjYWxsYmFja3NcbiAgICAgICAgICBleGVjdXRlQ2FsbGJhY2tzKGFyZ3MsIGRlcHNOb3RGb3VuZCk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gbG9hZGpzO1xuICAgICAgfTtcbiAgICAgIC8qKlxuICAgICAgICogTWFudWFsbHkgc2F0aXNmeSBidW5kbGUgZGVwZW5kZW5jaWVzLlxuICAgICAgICogQHBhcmFtIHtzdHJpbmd9IGJ1bmRsZUlkIC0gVGhlIGJ1bmRsZSBpZFxuICAgICAgICovXG5cblxuICAgICAgbG9hZGpzLmRvbmUgPSBmdW5jdGlvbiBkb25lKGJ1bmRsZUlkKSB7XG4gICAgICAgIHB1Ymxpc2goYnVuZGxlSWQsIFtdKTtcbiAgICAgIH07XG4gICAgICAvKipcbiAgICAgICAqIFJlc2V0IGxvYWRqcyBkZXBlbmRlbmNpZXMgc3RhdHVzZXNcbiAgICAgICAqL1xuXG5cbiAgICAgIGxvYWRqcy5yZXNldCA9IGZ1bmN0aW9uIHJlc2V0KCkge1xuICAgICAgICBidW5kbGVJZENhY2hlID0ge307XG4gICAgICAgIGJ1bmRsZVJlc3VsdENhY2hlID0ge307XG4gICAgICAgIGJ1bmRsZUNhbGxiYWNrUXVldWUgPSB7fTtcbiAgICAgIH07XG4gICAgICAvKipcbiAgICAgICAqIERldGVybWluZSBpZiBidW5kbGUgaGFzIGFscmVhZHkgYmVlbiBkZWZpbmVkXG4gICAgICAgKiBAcGFyYW0gU3RyaW5nfSBidW5kbGVJZCAtIFRoZSBidW5kbGUgaWRcbiAgICAgICAqL1xuXG5cbiAgICAgIGxvYWRqcy5pc0RlZmluZWQgPSBmdW5jdGlvbiBpc0RlZmluZWQoYnVuZGxlSWQpIHtcbiAgICAgICAgcmV0dXJuIGJ1bmRsZUlkIGluIGJ1bmRsZUlkQ2FjaGU7XG4gICAgICB9OyAvLyBleHBvcnRcblxuXG4gICAgICByZXR1cm4gbG9hZGpzO1xuICAgIH0pO1xuICB9KTtcblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICBmdW5jdGlvbiBsb2FkU2NyaXB0KHVybCkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICBsb2FkanNfdW1kKHVybCwge1xuICAgICAgICBzdWNjZXNzOiByZXNvbHZlLFxuICAgICAgICBlcnJvcjogcmVqZWN0XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiAgZnVuY3Rpb24gcGFyc2VJZCQxKHVybCkge1xuICAgIGlmIChpcy5lbXB0eSh1cmwpKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBpZiAoaXMubnVtYmVyKE51bWJlcih1cmwpKSkge1xuICAgICAgcmV0dXJuIHVybDtcbiAgICB9XG5cbiAgICBjb25zdCByZWdleCA9IC9eLioodmltZW8uY29tXFwvfHZpZGVvXFwvKShcXGQrKS4qLztcbiAgICByZXR1cm4gdXJsLm1hdGNoKHJlZ2V4KSA/IFJlZ0V4cC4kMiA6IHVybDtcbiAgfSAvLyBUcnkgdG8gZXh0cmFjdCBhIGhhc2ggZm9yIHByaXZhdGUgdmlkZW9zIGZyb20gdGhlIFVSTFxuXG5cbiAgZnVuY3Rpb24gcGFyc2VIYXNoKHVybCkge1xuICAgIC8qIFRoaXMgcmVnZXggbWF0Y2hlcyBhIGhleGFkZWNpbWFsIGhhc2ggaWYgZ2l2ZW4gaW4gYW55IG9mIHRoZXNlIGZvcm1zOlxuICAgICAqICAtIFtodHRwczovL3BsYXllci5ddmltZW8uY29tL3ZpZGVvL3tpZH0ve2hhc2h9Wz9wYXJhbXNdXG4gICAgICogIC0gW2h0dHBzOi8vcGxheWVyLl12aW1lby5jb20vdmlkZW8ve2lkfT9oPXtoYXNofVsmcGFyYW1zXVxuICAgICAqICAtIFtodHRwczovL3BsYXllci5ddmltZW8uY29tL3ZpZGVvL3tpZH0/W3BhcmFtc10maD17aGFzaH1cbiAgICAgKiAgLSB2aWRlby97aWR9L3toYXNofVxuICAgICAqIElmIG1hdGNoZWQsIHRoZSBoYXNoIGlzIGF2YWlsYWJsZSBpbiBjYXB0dXJlIGdyb3VwIDRcbiAgICAgKi9cbiAgICBjb25zdCByZWdleCA9IC9eLioodmltZW8uY29tXFwvfHZpZGVvXFwvKShcXGQrKShcXD8uKiYqaD18XFwvKSsoW1xcZCxhLWZdKykvO1xuICAgIGNvbnN0IGZvdW5kID0gdXJsLm1hdGNoKHJlZ2V4KTtcbiAgICByZXR1cm4gZm91bmQgJiYgZm91bmQubGVuZ3RoID09PSA1ID8gZm91bmRbNF0gOiBudWxsO1xuICB9IC8vIFNldCBwbGF5YmFjayBzdGF0ZSBhbmQgdHJpZ2dlciBjaGFuZ2UgKG9ubHkgb24gYWN0dWFsIGNoYW5nZSlcblxuXG4gIGZ1bmN0aW9uIGFzc3VyZVBsYXliYWNrU3RhdGUkMShwbGF5KSB7XG4gICAgaWYgKHBsYXkgJiYgIXRoaXMuZW1iZWQuaGFzUGxheWVkKSB7XG4gICAgICB0aGlzLmVtYmVkLmhhc1BsYXllZCA9IHRydWU7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMubWVkaWEucGF1c2VkID09PSBwbGF5KSB7XG4gICAgICB0aGlzLm1lZGlhLnBhdXNlZCA9ICFwbGF5O1xuICAgICAgdHJpZ2dlckV2ZW50LmNhbGwodGhpcywgdGhpcy5tZWRpYSwgcGxheSA/ICdwbGF5JyA6ICdwYXVzZScpO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0IHZpbWVvID0ge1xuICAgIHNldHVwKCkge1xuICAgICAgY29uc3QgcGxheWVyID0gdGhpczsgLy8gQWRkIGVtYmVkIGNsYXNzIGZvciByZXNwb25zaXZlXG5cbiAgICAgIHRvZ2dsZUNsYXNzKHBsYXllci5lbGVtZW50cy53cmFwcGVyLCBwbGF5ZXIuY29uZmlnLmNsYXNzTmFtZXMuZW1iZWQsIHRydWUpOyAvLyBTZXQgc3BlZWQgb3B0aW9ucyBmcm9tIGNvbmZpZ1xuXG4gICAgICBwbGF5ZXIub3B0aW9ucy5zcGVlZCA9IHBsYXllci5jb25maWcuc3BlZWQub3B0aW9uczsgLy8gU2V0IGludGlhbCByYXRpb1xuXG4gICAgICBzZXRBc3BlY3RSYXRpby5jYWxsKHBsYXllcik7IC8vIExvYWQgdGhlIFNESyBpZiBub3QgYWxyZWFkeVxuXG4gICAgICBpZiAoIWlzLm9iamVjdCh3aW5kb3cuVmltZW8pKSB7XG4gICAgICAgIGxvYWRTY3JpcHQocGxheWVyLmNvbmZpZy51cmxzLnZpbWVvLnNkaykudGhlbigoKSA9PiB7XG4gICAgICAgICAgdmltZW8ucmVhZHkuY2FsbChwbGF5ZXIpO1xuICAgICAgICB9KS5jYXRjaChlcnJvciA9PiB7XG4gICAgICAgICAgcGxheWVyLmRlYnVnLndhcm4oJ1ZpbWVvIFNESyAocGxheWVyLmpzKSBmYWlsZWQgdG8gbG9hZCcsIGVycm9yKTtcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2aW1lby5yZWFkeS5jYWxsKHBsYXllcik7XG4gICAgICB9XG4gICAgfSxcblxuICAgIC8vIEFQSSBSZWFkeVxuICAgIHJlYWR5KCkge1xuICAgICAgY29uc3QgcGxheWVyID0gdGhpcztcbiAgICAgIGNvbnN0IGNvbmZpZyA9IHBsYXllci5jb25maWcudmltZW87XG4gICAgICBjb25zdCB7XG4gICAgICAgIHByZW1pdW0sXG4gICAgICAgIHJlZmVycmVyUG9saWN5LFxuICAgICAgICAuLi5mcmFtZVBhcmFtc1xuICAgICAgfSA9IGNvbmZpZzsgLy8gR2V0IHRoZSBzb3VyY2UgVVJMIG9yIElEXG5cbiAgICAgIGxldCBzb3VyY2UgPSBwbGF5ZXIubWVkaWEuZ2V0QXR0cmlidXRlKCdzcmMnKTtcbiAgICAgIGxldCBoYXNoID0gJyc7IC8vIEdldCBmcm9tIDxkaXY+IGlmIG5lZWRlZFxuXG4gICAgICBpZiAoaXMuZW1wdHkoc291cmNlKSkge1xuICAgICAgICBzb3VyY2UgPSBwbGF5ZXIubWVkaWEuZ2V0QXR0cmlidXRlKHBsYXllci5jb25maWcuYXR0cmlidXRlcy5lbWJlZC5pZCk7IC8vIGhhc2ggY2FuIGFsc28gYmUgc2V0IGFzIGF0dHJpYnV0ZSBvbiB0aGUgPGRpdj5cblxuICAgICAgICBoYXNoID0gcGxheWVyLm1lZGlhLmdldEF0dHJpYnV0ZShwbGF5ZXIuY29uZmlnLmF0dHJpYnV0ZXMuZW1iZWQuaGFzaCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBoYXNoID0gcGFyc2VIYXNoKHNvdXJjZSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGhhc2hQYXJhbSA9IGhhc2ggPyB7XG4gICAgICAgIGg6IGhhc2hcbiAgICAgIH0gOiB7fTsgLy8gSWYgdGhlIG93bmVyIGhhcyBhIHBybyBvciBwcmVtaXVtIGFjY291bnQgdGhlbiB3ZSBjYW4gaGlkZSBjb250cm9scyBldGNcblxuICAgICAgaWYgKHByZW1pdW0pIHtcbiAgICAgICAgT2JqZWN0LmFzc2lnbihmcmFtZVBhcmFtcywge1xuICAgICAgICAgIGNvbnRyb2xzOiBmYWxzZSxcbiAgICAgICAgICBzaWRlZG9jazogZmFsc2VcbiAgICAgICAgfSk7XG4gICAgICB9IC8vIEdldCBWaW1lbyBwYXJhbXMgZm9yIHRoZSBpZnJhbWVcblxuXG4gICAgICBjb25zdCBwYXJhbXMgPSBidWlsZFVybFBhcmFtcyh7XG4gICAgICAgIGxvb3A6IHBsYXllci5jb25maWcubG9vcC5hY3RpdmUsXG4gICAgICAgIGF1dG9wbGF5OiBwbGF5ZXIuYXV0b3BsYXksXG4gICAgICAgIG11dGVkOiBwbGF5ZXIubXV0ZWQsXG4gICAgICAgIGdlc3R1cmU6ICdtZWRpYScsXG4gICAgICAgIHBsYXlzaW5saW5lOiAhdGhpcy5jb25maWcuZnVsbHNjcmVlbi5pb3NOYXRpdmUsXG4gICAgICAgIC8vIGhhc2ggaGFzIHRvIGJlIGFkZGVkIHRvIGlmcmFtZS1VUkxcbiAgICAgICAgLi4uaGFzaFBhcmFtLFxuICAgICAgICAuLi5mcmFtZVBhcmFtc1xuICAgICAgfSk7XG4gICAgICBjb25zdCBpZCA9IHBhcnNlSWQkMShzb3VyY2UpOyAvLyBCdWlsZCBhbiBpZnJhbWVcblxuICAgICAgY29uc3QgaWZyYW1lID0gY3JlYXRlRWxlbWVudCgnaWZyYW1lJyk7XG4gICAgICBjb25zdCBzcmMgPSBmb3JtYXQocGxheWVyLmNvbmZpZy51cmxzLnZpbWVvLmlmcmFtZSwgaWQsIHBhcmFtcyk7XG4gICAgICBpZnJhbWUuc2V0QXR0cmlidXRlKCdzcmMnLCBzcmMpO1xuICAgICAgaWZyYW1lLnNldEF0dHJpYnV0ZSgnYWxsb3dmdWxsc2NyZWVuJywgJycpO1xuICAgICAgaWZyYW1lLnNldEF0dHJpYnV0ZSgnYWxsb3cnLCBbJ2F1dG9wbGF5JywgJ2Z1bGxzY3JlZW4nLCAncGljdHVyZS1pbi1waWN0dXJlJywgJ2VuY3J5cHRlZC1tZWRpYScsICdhY2NlbGVyb21ldGVyJywgJ2d5cm9zY29wZSddLmpvaW4oJzsgJykpOyAvLyBTZXQgdGhlIHJlZmVycmVyIHBvbGljeSBpZiByZXF1aXJlZFxuXG4gICAgICBpZiAoIWlzLmVtcHR5KHJlZmVycmVyUG9saWN5KSkge1xuICAgICAgICBpZnJhbWUuc2V0QXR0cmlidXRlKCdyZWZlcnJlclBvbGljeScsIHJlZmVycmVyUG9saWN5KTtcbiAgICAgIH0gLy8gSW5qZWN0IHRoZSBwYWNrYWdlXG5cblxuICAgICAgaWYgKHByZW1pdW0gfHwgIWNvbmZpZy5jdXN0b21Db250cm9scykge1xuICAgICAgICBpZnJhbWUuc2V0QXR0cmlidXRlKCdkYXRhLXBvc3RlcicsIHBsYXllci5wb3N0ZXIpO1xuICAgICAgICBwbGF5ZXIubWVkaWEgPSByZXBsYWNlRWxlbWVudChpZnJhbWUsIHBsYXllci5tZWRpYSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCB3cmFwcGVyID0gY3JlYXRlRWxlbWVudCgnZGl2Jywge1xuICAgICAgICAgIGNsYXNzOiBwbGF5ZXIuY29uZmlnLmNsYXNzTmFtZXMuZW1iZWRDb250YWluZXIsXG4gICAgICAgICAgJ2RhdGEtcG9zdGVyJzogcGxheWVyLnBvc3RlclxuICAgICAgICB9KTtcbiAgICAgICAgd3JhcHBlci5hcHBlbmRDaGlsZChpZnJhbWUpO1xuICAgICAgICBwbGF5ZXIubWVkaWEgPSByZXBsYWNlRWxlbWVudCh3cmFwcGVyLCBwbGF5ZXIubWVkaWEpO1xuICAgICAgfSAvLyBHZXQgcG9zdGVyIGltYWdlXG5cblxuICAgICAgaWYgKCFjb25maWcuY3VzdG9tQ29udHJvbHMpIHtcbiAgICAgICAgZmV0Y2goZm9ybWF0KHBsYXllci5jb25maWcudXJscy52aW1lby5hcGksIHNyYykpLnRoZW4ocmVzcG9uc2UgPT4ge1xuICAgICAgICAgIGlmIChpcy5lbXB0eShyZXNwb25zZSkgfHwgIXJlc3BvbnNlLnRodW1ibmFpbF91cmwpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9IC8vIFNldCBhbmQgc2hvdyBwb3N0ZXJcblxuXG4gICAgICAgICAgdWkuc2V0UG9zdGVyLmNhbGwocGxheWVyLCByZXNwb25zZS50aHVtYm5haWxfdXJsKS5jYXRjaCgoKSA9PiB7fSk7XG4gICAgICAgIH0pO1xuICAgICAgfSAvLyBTZXR1cCBpbnN0YW5jZVxuICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3ZpbWVvL3BsYXllci5qc1xuXG5cbiAgICAgIHBsYXllci5lbWJlZCA9IG5ldyB3aW5kb3cuVmltZW8uUGxheWVyKGlmcmFtZSwge1xuICAgICAgICBhdXRvcGF1c2U6IHBsYXllci5jb25maWcuYXV0b3BhdXNlLFxuICAgICAgICBtdXRlZDogcGxheWVyLm11dGVkXG4gICAgICB9KTtcbiAgICAgIHBsYXllci5tZWRpYS5wYXVzZWQgPSB0cnVlO1xuICAgICAgcGxheWVyLm1lZGlhLmN1cnJlbnRUaW1lID0gMDsgLy8gRGlzYWJsZSBuYXRpdmUgdGV4dCB0cmFjayByZW5kZXJpbmdcblxuICAgICAgaWYgKHBsYXllci5zdXBwb3J0ZWQudWkpIHtcbiAgICAgICAgcGxheWVyLmVtYmVkLmRpc2FibGVUZXh0VHJhY2soKTtcbiAgICAgIH0gLy8gQ3JlYXRlIGEgZmF1eCBIVE1MNSBBUEkgdXNpbmcgdGhlIFZpbWVvIEFQSVxuXG5cbiAgICAgIHBsYXllci5tZWRpYS5wbGF5ID0gKCkgPT4ge1xuICAgICAgICBhc3N1cmVQbGF5YmFja1N0YXRlJDEuY2FsbChwbGF5ZXIsIHRydWUpO1xuICAgICAgICByZXR1cm4gcGxheWVyLmVtYmVkLnBsYXkoKTtcbiAgICAgIH07XG5cbiAgICAgIHBsYXllci5tZWRpYS5wYXVzZSA9ICgpID0+IHtcbiAgICAgICAgYXNzdXJlUGxheWJhY2tTdGF0ZSQxLmNhbGwocGxheWVyLCBmYWxzZSk7XG4gICAgICAgIHJldHVybiBwbGF5ZXIuZW1iZWQucGF1c2UoKTtcbiAgICAgIH07XG5cbiAgICAgIHBsYXllci5tZWRpYS5zdG9wID0gKCkgPT4ge1xuICAgICAgICBwbGF5ZXIucGF1c2UoKTtcbiAgICAgICAgcGxheWVyLmN1cnJlbnRUaW1lID0gMDtcbiAgICAgIH07IC8vIFNlZWtpbmdcblxuXG4gICAgICBsZXQge1xuICAgICAgICBjdXJyZW50VGltZVxuICAgICAgfSA9IHBsYXllci5tZWRpYTtcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwbGF5ZXIubWVkaWEsICdjdXJyZW50VGltZScsIHtcbiAgICAgICAgZ2V0KCkge1xuICAgICAgICAgIHJldHVybiBjdXJyZW50VGltZTtcbiAgICAgICAgfSxcblxuICAgICAgICBzZXQodGltZSkge1xuICAgICAgICAgIC8vIFZpbWVvIHdpbGwgYXV0b21hdGljYWxseSBwbGF5IG9uIHNlZWsgaWYgdGhlIHZpZGVvIGhhc24ndCBiZWVuIHBsYXllZCBiZWZvcmVcbiAgICAgICAgICAvLyBHZXQgY3VycmVudCBwYXVzZWQgc3RhdGUgYW5kIHZvbHVtZSBldGNcbiAgICAgICAgICBjb25zdCB7XG4gICAgICAgICAgICBlbWJlZCxcbiAgICAgICAgICAgIG1lZGlhLFxuICAgICAgICAgICAgcGF1c2VkLFxuICAgICAgICAgICAgdm9sdW1lXG4gICAgICAgICAgfSA9IHBsYXllcjtcbiAgICAgICAgICBjb25zdCByZXN0b3JlUGF1c2UgPSBwYXVzZWQgJiYgIWVtYmVkLmhhc1BsYXllZDsgLy8gU2V0IHNlZWtpbmcgc3RhdGUgYW5kIHRyaWdnZXIgZXZlbnRcblxuICAgICAgICAgIG1lZGlhLnNlZWtpbmcgPSB0cnVlO1xuICAgICAgICAgIHRyaWdnZXJFdmVudC5jYWxsKHBsYXllciwgbWVkaWEsICdzZWVraW5nJyk7IC8vIElmIHBhdXNlZCwgbXV0ZSB1bnRpbCBzZWVrIGlzIGNvbXBsZXRlXG5cbiAgICAgICAgICBQcm9taXNlLnJlc29sdmUocmVzdG9yZVBhdXNlICYmIGVtYmVkLnNldFZvbHVtZSgwKSkgLy8gU2Vla1xuICAgICAgICAgIC50aGVuKCgpID0+IGVtYmVkLnNldEN1cnJlbnRUaW1lKHRpbWUpKSAvLyBSZXN0b3JlIHBhdXNlZFxuICAgICAgICAgIC50aGVuKCgpID0+IHJlc3RvcmVQYXVzZSAmJiBlbWJlZC5wYXVzZSgpKSAvLyBSZXN0b3JlIHZvbHVtZVxuICAgICAgICAgIC50aGVuKCgpID0+IHJlc3RvcmVQYXVzZSAmJiBlbWJlZC5zZXRWb2x1bWUodm9sdW1lKSkuY2F0Y2goKCkgPT4gey8vIERvIG5vdGhpbmdcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICB9KTsgLy8gUGxheWJhY2sgc3BlZWRcblxuICAgICAgbGV0IHNwZWVkID0gcGxheWVyLmNvbmZpZy5zcGVlZC5zZWxlY3RlZDtcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwbGF5ZXIubWVkaWEsICdwbGF5YmFja1JhdGUnLCB7XG4gICAgICAgIGdldCgpIHtcbiAgICAgICAgICByZXR1cm4gc3BlZWQ7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0KGlucHV0KSB7XG4gICAgICAgICAgcGxheWVyLmVtYmVkLnNldFBsYXliYWNrUmF0ZShpbnB1dCkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICBzcGVlZCA9IGlucHV0O1xuICAgICAgICAgICAgdHJpZ2dlckV2ZW50LmNhbGwocGxheWVyLCBwbGF5ZXIubWVkaWEsICdyYXRlY2hhbmdlJyk7XG4gICAgICAgICAgfSkuY2F0Y2goKCkgPT4ge1xuICAgICAgICAgICAgLy8gQ2Fubm90IHNldCBQbGF5YmFjayBSYXRlLCBWaWRlbyBpcyBwcm9iYWJseSBub3Qgb24gUHJvIGFjY291bnRcbiAgICAgICAgICAgIHBsYXllci5vcHRpb25zLnNwZWVkID0gWzFdO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgIH0pOyAvLyBWb2x1bWVcblxuICAgICAgbGV0IHtcbiAgICAgICAgdm9sdW1lXG4gICAgICB9ID0gcGxheWVyLmNvbmZpZztcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwbGF5ZXIubWVkaWEsICd2b2x1bWUnLCB7XG4gICAgICAgIGdldCgpIHtcbiAgICAgICAgICByZXR1cm4gdm9sdW1lO1xuICAgICAgICB9LFxuXG4gICAgICAgIHNldChpbnB1dCkge1xuICAgICAgICAgIHBsYXllci5lbWJlZC5zZXRWb2x1bWUoaW5wdXQpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgdm9sdW1lID0gaW5wdXQ7XG4gICAgICAgICAgICB0cmlnZ2VyRXZlbnQuY2FsbChwbGF5ZXIsIHBsYXllci5tZWRpYSwgJ3ZvbHVtZWNoYW5nZScpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgIH0pOyAvLyBNdXRlZFxuXG4gICAgICBsZXQge1xuICAgICAgICBtdXRlZFxuICAgICAgfSA9IHBsYXllci5jb25maWc7XG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocGxheWVyLm1lZGlhLCAnbXV0ZWQnLCB7XG4gICAgICAgIGdldCgpIHtcbiAgICAgICAgICByZXR1cm4gbXV0ZWQ7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0KGlucHV0KSB7XG4gICAgICAgICAgY29uc3QgdG9nZ2xlID0gaXMuYm9vbGVhbihpbnB1dCkgPyBpbnB1dCA6IGZhbHNlO1xuICAgICAgICAgIHBsYXllci5lbWJlZC5zZXRWb2x1bWUodG9nZ2xlID8gMCA6IHBsYXllci5jb25maWcudm9sdW1lKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgIG11dGVkID0gdG9nZ2xlO1xuICAgICAgICAgICAgdHJpZ2dlckV2ZW50LmNhbGwocGxheWVyLCBwbGF5ZXIubWVkaWEsICd2b2x1bWVjaGFuZ2UnKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICB9KTsgLy8gTG9vcFxuXG4gICAgICBsZXQge1xuICAgICAgICBsb29wXG4gICAgICB9ID0gcGxheWVyLmNvbmZpZztcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwbGF5ZXIubWVkaWEsICdsb29wJywge1xuICAgICAgICBnZXQoKSB7XG4gICAgICAgICAgcmV0dXJuIGxvb3A7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0KGlucHV0KSB7XG4gICAgICAgICAgY29uc3QgdG9nZ2xlID0gaXMuYm9vbGVhbihpbnB1dCkgPyBpbnB1dCA6IHBsYXllci5jb25maWcubG9vcC5hY3RpdmU7XG4gICAgICAgICAgcGxheWVyLmVtYmVkLnNldExvb3AodG9nZ2xlKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgIGxvb3AgPSB0b2dnbGU7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgfSk7IC8vIFNvdXJjZVxuXG4gICAgICBsZXQgY3VycmVudFNyYztcbiAgICAgIHBsYXllci5lbWJlZC5nZXRWaWRlb1VybCgpLnRoZW4odmFsdWUgPT4ge1xuICAgICAgICBjdXJyZW50U3JjID0gdmFsdWU7XG4gICAgICAgIGNvbnRyb2xzLnNldERvd25sb2FkVXJsLmNhbGwocGxheWVyKTtcbiAgICAgIH0pLmNhdGNoKGVycm9yID0+IHtcbiAgICAgICAgdGhpcy5kZWJ1Zy53YXJuKGVycm9yKTtcbiAgICAgIH0pO1xuICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHBsYXllci5tZWRpYSwgJ2N1cnJlbnRTcmMnLCB7XG4gICAgICAgIGdldCgpIHtcbiAgICAgICAgICByZXR1cm4gY3VycmVudFNyYztcbiAgICAgICAgfVxuXG4gICAgICB9KTsgLy8gRW5kZWRcblxuICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHBsYXllci5tZWRpYSwgJ2VuZGVkJywge1xuICAgICAgICBnZXQoKSB7XG4gICAgICAgICAgcmV0dXJuIHBsYXllci5jdXJyZW50VGltZSA9PT0gcGxheWVyLmR1cmF0aW9uO1xuICAgICAgICB9XG5cbiAgICAgIH0pOyAvLyBTZXQgYXNwZWN0IHJhdGlvIGJhc2VkIG9uIHZpZGVvIHNpemVcblxuICAgICAgUHJvbWlzZS5hbGwoW3BsYXllci5lbWJlZC5nZXRWaWRlb1dpZHRoKCksIHBsYXllci5lbWJlZC5nZXRWaWRlb0hlaWdodCgpXSkudGhlbihkaW1lbnNpb25zID0+IHtcbiAgICAgICAgY29uc3QgW3dpZHRoLCBoZWlnaHRdID0gZGltZW5zaW9ucztcbiAgICAgICAgcGxheWVyLmVtYmVkLnJhdGlvID0gcm91bmRBc3BlY3RSYXRpbyh3aWR0aCwgaGVpZ2h0KTtcbiAgICAgICAgc2V0QXNwZWN0UmF0aW8uY2FsbCh0aGlzKTtcbiAgICAgIH0pOyAvLyBTZXQgYXV0b3BhdXNlXG5cbiAgICAgIHBsYXllci5lbWJlZC5zZXRBdXRvcGF1c2UocGxheWVyLmNvbmZpZy5hdXRvcGF1c2UpLnRoZW4oc3RhdGUgPT4ge1xuICAgICAgICBwbGF5ZXIuY29uZmlnLmF1dG9wYXVzZSA9IHN0YXRlO1xuICAgICAgfSk7IC8vIEdldCB0aXRsZVxuXG4gICAgICBwbGF5ZXIuZW1iZWQuZ2V0VmlkZW9UaXRsZSgpLnRoZW4odGl0bGUgPT4ge1xuICAgICAgICBwbGF5ZXIuY29uZmlnLnRpdGxlID0gdGl0bGU7XG4gICAgICAgIHVpLnNldFRpdGxlLmNhbGwodGhpcyk7XG4gICAgICB9KTsgLy8gR2V0IGN1cnJlbnQgdGltZVxuXG4gICAgICBwbGF5ZXIuZW1iZWQuZ2V0Q3VycmVudFRpbWUoKS50aGVuKHZhbHVlID0+IHtcbiAgICAgICAgY3VycmVudFRpbWUgPSB2YWx1ZTtcbiAgICAgICAgdHJpZ2dlckV2ZW50LmNhbGwocGxheWVyLCBwbGF5ZXIubWVkaWEsICd0aW1ldXBkYXRlJyk7XG4gICAgICB9KTsgLy8gR2V0IGR1cmF0aW9uXG5cbiAgICAgIHBsYXllci5lbWJlZC5nZXREdXJhdGlvbigpLnRoZW4odmFsdWUgPT4ge1xuICAgICAgICBwbGF5ZXIubWVkaWEuZHVyYXRpb24gPSB2YWx1ZTtcbiAgICAgICAgdHJpZ2dlckV2ZW50LmNhbGwocGxheWVyLCBwbGF5ZXIubWVkaWEsICdkdXJhdGlvbmNoYW5nZScpO1xuICAgICAgfSk7IC8vIEdldCBjYXB0aW9uc1xuXG4gICAgICBwbGF5ZXIuZW1iZWQuZ2V0VGV4dFRyYWNrcygpLnRoZW4odHJhY2tzID0+IHtcbiAgICAgICAgcGxheWVyLm1lZGlhLnRleHRUcmFja3MgPSB0cmFja3M7XG4gICAgICAgIGNhcHRpb25zLnNldHVwLmNhbGwocGxheWVyKTtcbiAgICAgIH0pO1xuICAgICAgcGxheWVyLmVtYmVkLm9uKCdjdWVjaGFuZ2UnLCAoe1xuICAgICAgICBjdWVzID0gW11cbiAgICAgIH0pID0+IHtcbiAgICAgICAgY29uc3Qgc3RyaXBwZWRDdWVzID0gY3Vlcy5tYXAoY3VlID0+IHN0cmlwSFRNTChjdWUudGV4dCkpO1xuICAgICAgICBjYXB0aW9ucy51cGRhdGVDdWVzLmNhbGwocGxheWVyLCBzdHJpcHBlZEN1ZXMpO1xuICAgICAgfSk7XG4gICAgICBwbGF5ZXIuZW1iZWQub24oJ2xvYWRlZCcsICgpID0+IHtcbiAgICAgICAgLy8gQXNzdXJlIHN0YXRlIGFuZCBldmVudHMgYXJlIHVwZGF0ZWQgb24gYXV0b3BsYXlcbiAgICAgICAgcGxheWVyLmVtYmVkLmdldFBhdXNlZCgpLnRoZW4ocGF1c2VkID0+IHtcbiAgICAgICAgICBhc3N1cmVQbGF5YmFja1N0YXRlJDEuY2FsbChwbGF5ZXIsICFwYXVzZWQpO1xuXG4gICAgICAgICAgaWYgKCFwYXVzZWQpIHtcbiAgICAgICAgICAgIHRyaWdnZXJFdmVudC5jYWxsKHBsYXllciwgcGxheWVyLm1lZGlhLCAncGxheWluZycpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKGlzLmVsZW1lbnQocGxheWVyLmVtYmVkLmVsZW1lbnQpICYmIHBsYXllci5zdXBwb3J0ZWQudWkpIHtcbiAgICAgICAgICBjb25zdCBmcmFtZSA9IHBsYXllci5lbWJlZC5lbGVtZW50OyAvLyBGaXgga2V5Ym9hcmQgZm9jdXMgaXNzdWVzXG4gICAgICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3NhbXBvdHRzL3BseXIvaXNzdWVzLzMxN1xuXG4gICAgICAgICAgZnJhbWUuc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsIC0xKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBwbGF5ZXIuZW1iZWQub24oJ2J1ZmZlcnN0YXJ0JywgKCkgPT4ge1xuICAgICAgICB0cmlnZ2VyRXZlbnQuY2FsbChwbGF5ZXIsIHBsYXllci5tZWRpYSwgJ3dhaXRpbmcnKTtcbiAgICAgIH0pO1xuICAgICAgcGxheWVyLmVtYmVkLm9uKCdidWZmZXJlbmQnLCAoKSA9PiB7XG4gICAgICAgIHRyaWdnZXJFdmVudC5jYWxsKHBsYXllciwgcGxheWVyLm1lZGlhLCAncGxheWluZycpO1xuICAgICAgfSk7XG4gICAgICBwbGF5ZXIuZW1iZWQub24oJ3BsYXknLCAoKSA9PiB7XG4gICAgICAgIGFzc3VyZVBsYXliYWNrU3RhdGUkMS5jYWxsKHBsYXllciwgdHJ1ZSk7XG4gICAgICAgIHRyaWdnZXJFdmVudC5jYWxsKHBsYXllciwgcGxheWVyLm1lZGlhLCAncGxheWluZycpO1xuICAgICAgfSk7XG4gICAgICBwbGF5ZXIuZW1iZWQub24oJ3BhdXNlJywgKCkgPT4ge1xuICAgICAgICBhc3N1cmVQbGF5YmFja1N0YXRlJDEuY2FsbChwbGF5ZXIsIGZhbHNlKTtcbiAgICAgIH0pO1xuICAgICAgcGxheWVyLmVtYmVkLm9uKCd0aW1ldXBkYXRlJywgZGF0YSA9PiB7XG4gICAgICAgIHBsYXllci5tZWRpYS5zZWVraW5nID0gZmFsc2U7XG4gICAgICAgIGN1cnJlbnRUaW1lID0gZGF0YS5zZWNvbmRzO1xuICAgICAgICB0cmlnZ2VyRXZlbnQuY2FsbChwbGF5ZXIsIHBsYXllci5tZWRpYSwgJ3RpbWV1cGRhdGUnKTtcbiAgICAgIH0pO1xuICAgICAgcGxheWVyLmVtYmVkLm9uKCdwcm9ncmVzcycsIGRhdGEgPT4ge1xuICAgICAgICBwbGF5ZXIubWVkaWEuYnVmZmVyZWQgPSBkYXRhLnBlcmNlbnQ7XG4gICAgICAgIHRyaWdnZXJFdmVudC5jYWxsKHBsYXllciwgcGxheWVyLm1lZGlhLCAncHJvZ3Jlc3MnKTsgLy8gQ2hlY2sgYWxsIGxvYWRlZFxuXG4gICAgICAgIGlmIChwYXJzZUludChkYXRhLnBlcmNlbnQsIDEwKSA9PT0gMSkge1xuICAgICAgICAgIHRyaWdnZXJFdmVudC5jYWxsKHBsYXllciwgcGxheWVyLm1lZGlhLCAnY2FucGxheXRocm91Z2gnKTtcbiAgICAgICAgfSAvLyBHZXQgZHVyYXRpb24gYXMgaWYgd2UgZG8gaXQgYmVmb3JlIGxvYWQsIGl0IGdpdmVzIGFuIGluY29ycmVjdCB2YWx1ZVxuICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vc2FtcG90dHMvcGx5ci9pc3N1ZXMvODkxXG5cblxuICAgICAgICBwbGF5ZXIuZW1iZWQuZ2V0RHVyYXRpb24oKS50aGVuKHZhbHVlID0+IHtcbiAgICAgICAgICBpZiAodmFsdWUgIT09IHBsYXllci5tZWRpYS5kdXJhdGlvbikge1xuICAgICAgICAgICAgcGxheWVyLm1lZGlhLmR1cmF0aW9uID0gdmFsdWU7XG4gICAgICAgICAgICB0cmlnZ2VyRXZlbnQuY2FsbChwbGF5ZXIsIHBsYXllci5tZWRpYSwgJ2R1cmF0aW9uY2hhbmdlJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgICAgcGxheWVyLmVtYmVkLm9uKCdzZWVrZWQnLCAoKSA9PiB7XG4gICAgICAgIHBsYXllci5tZWRpYS5zZWVraW5nID0gZmFsc2U7XG4gICAgICAgIHRyaWdnZXJFdmVudC5jYWxsKHBsYXllciwgcGxheWVyLm1lZGlhLCAnc2Vla2VkJyk7XG4gICAgICB9KTtcbiAgICAgIHBsYXllci5lbWJlZC5vbignZW5kZWQnLCAoKSA9PiB7XG4gICAgICAgIHBsYXllci5tZWRpYS5wYXVzZWQgPSB0cnVlO1xuICAgICAgICB0cmlnZ2VyRXZlbnQuY2FsbChwbGF5ZXIsIHBsYXllci5tZWRpYSwgJ2VuZGVkJyk7XG4gICAgICB9KTtcbiAgICAgIHBsYXllci5lbWJlZC5vbignZXJyb3InLCBkZXRhaWwgPT4ge1xuICAgICAgICBwbGF5ZXIubWVkaWEuZXJyb3IgPSBkZXRhaWw7XG4gICAgICAgIHRyaWdnZXJFdmVudC5jYWxsKHBsYXllciwgcGxheWVyLm1lZGlhLCAnZXJyb3InKTtcbiAgICAgIH0pOyAvLyBSZWJ1aWxkIFVJXG5cbiAgICAgIGlmIChjb25maWcuY3VzdG9tQ29udHJvbHMpIHtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB1aS5idWlsZC5jYWxsKHBsYXllciksIDApO1xuICAgICAgfVxuICAgIH1cblxuICB9O1xuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiAgZnVuY3Rpb24gcGFyc2VJZCh1cmwpIHtcbiAgICBpZiAoaXMuZW1wdHkodXJsKSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgY29uc3QgcmVnZXggPSAvXi4qKHlvdXR1LmJlXFwvfHZcXC98dVxcL1xcd1xcL3xlbWJlZFxcL3x3YXRjaFxcP3Y9fCZ2PSkoW14jJj9dKikuKi87XG4gICAgcmV0dXJuIHVybC5tYXRjaChyZWdleCkgPyBSZWdFeHAuJDIgOiB1cmw7XG4gIH0gLy8gU2V0IHBsYXliYWNrIHN0YXRlIGFuZCB0cmlnZ2VyIGNoYW5nZSAob25seSBvbiBhY3R1YWwgY2hhbmdlKVxuXG5cbiAgZnVuY3Rpb24gYXNzdXJlUGxheWJhY2tTdGF0ZShwbGF5KSB7XG4gICAgaWYgKHBsYXkgJiYgIXRoaXMuZW1iZWQuaGFzUGxheWVkKSB7XG4gICAgICB0aGlzLmVtYmVkLmhhc1BsYXllZCA9IHRydWU7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMubWVkaWEucGF1c2VkID09PSBwbGF5KSB7XG4gICAgICB0aGlzLm1lZGlhLnBhdXNlZCA9ICFwbGF5O1xuICAgICAgdHJpZ2dlckV2ZW50LmNhbGwodGhpcywgdGhpcy5tZWRpYSwgcGxheSA/ICdwbGF5JyA6ICdwYXVzZScpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGdldEhvc3QoY29uZmlnKSB7XG4gICAgaWYgKGNvbmZpZy5ub0Nvb2tpZSkge1xuICAgICAgcmV0dXJuICdodHRwczovL3d3dy55b3V0dWJlLW5vY29va2llLmNvbSc7XG4gICAgfVxuXG4gICAgaWYgKHdpbmRvdy5sb2NhdGlvbi5wcm90b2NvbCA9PT0gJ2h0dHA6Jykge1xuICAgICAgcmV0dXJuICdodHRwOi8vd3d3LnlvdXR1YmUuY29tJztcbiAgICB9IC8vIFVzZSBZb3VUdWJlJ3MgZGVmYXVsdFxuXG5cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG5cbiAgY29uc3QgeW91dHViZSA9IHtcbiAgICBzZXR1cCgpIHtcbiAgICAgIC8vIEFkZCBlbWJlZCBjbGFzcyBmb3IgcmVzcG9uc2l2ZVxuICAgICAgdG9nZ2xlQ2xhc3ModGhpcy5lbGVtZW50cy53cmFwcGVyLCB0aGlzLmNvbmZpZy5jbGFzc05hbWVzLmVtYmVkLCB0cnVlKTsgLy8gU2V0dXAgQVBJXG5cbiAgICAgIGlmIChpcy5vYmplY3Qod2luZG93LllUKSAmJiBpcy5mdW5jdGlvbih3aW5kb3cuWVQuUGxheWVyKSkge1xuICAgICAgICB5b3V0dWJlLnJlYWR5LmNhbGwodGhpcyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBSZWZlcmVuY2UgY3VycmVudCBnbG9iYWwgY2FsbGJhY2tcbiAgICAgICAgY29uc3QgY2FsbGJhY2sgPSB3aW5kb3cub25Zb3VUdWJlSWZyYW1lQVBJUmVhZHk7IC8vIFNldCBjYWxsYmFjayB0byBwcm9jZXNzIHF1ZXVlXG5cbiAgICAgICAgd2luZG93Lm9uWW91VHViZUlmcmFtZUFQSVJlYWR5ID0gKCkgPT4ge1xuICAgICAgICAgIC8vIENhbGwgZ2xvYmFsIGNhbGxiYWNrIGlmIHNldFxuICAgICAgICAgIGlmIChpcy5mdW5jdGlvbihjYWxsYmFjaykpIHtcbiAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgeW91dHViZS5yZWFkeS5jYWxsKHRoaXMpO1xuICAgICAgICB9OyAvLyBMb2FkIHRoZSBTREtcblxuXG4gICAgICAgIGxvYWRTY3JpcHQodGhpcy5jb25maWcudXJscy55b3V0dWJlLnNkaykuY2F0Y2goZXJyb3IgPT4ge1xuICAgICAgICAgIHRoaXMuZGVidWcud2FybignWW91VHViZSBBUEkgZmFpbGVkIHRvIGxvYWQnLCBlcnJvcik7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICAvLyBHZXQgdGhlIG1lZGlhIHRpdGxlXG4gICAgZ2V0VGl0bGUodmlkZW9JZCkge1xuICAgICAgY29uc3QgdXJsID0gZm9ybWF0KHRoaXMuY29uZmlnLnVybHMueW91dHViZS5hcGksIHZpZGVvSWQpO1xuICAgICAgZmV0Y2godXJsKS50aGVuKGRhdGEgPT4ge1xuICAgICAgICBpZiAoaXMub2JqZWN0KGRhdGEpKSB7XG4gICAgICAgICAgY29uc3Qge1xuICAgICAgICAgICAgdGl0bGUsXG4gICAgICAgICAgICBoZWlnaHQsXG4gICAgICAgICAgICB3aWR0aFxuICAgICAgICAgIH0gPSBkYXRhOyAvLyBTZXQgdGl0bGVcblxuICAgICAgICAgIHRoaXMuY29uZmlnLnRpdGxlID0gdGl0bGU7XG4gICAgICAgICAgdWkuc2V0VGl0bGUuY2FsbCh0aGlzKTsgLy8gU2V0IGFzcGVjdCByYXRpb1xuXG4gICAgICAgICAgdGhpcy5lbWJlZC5yYXRpbyA9IHJvdW5kQXNwZWN0UmF0aW8od2lkdGgsIGhlaWdodCk7XG4gICAgICAgIH1cblxuICAgICAgICBzZXRBc3BlY3RSYXRpby5jYWxsKHRoaXMpO1xuICAgICAgfSkuY2F0Y2goKCkgPT4ge1xuICAgICAgICAvLyBTZXQgYXNwZWN0IHJhdGlvXG4gICAgICAgIHNldEFzcGVjdFJhdGlvLmNhbGwodGhpcyk7XG4gICAgICB9KTtcbiAgICB9LFxuXG4gICAgLy8gQVBJIHJlYWR5XG4gICAgcmVhZHkoKSB7XG4gICAgICBjb25zdCBwbGF5ZXIgPSB0aGlzO1xuICAgICAgY29uc3QgY29uZmlnID0gcGxheWVyLmNvbmZpZy55b3V0dWJlOyAvLyBJZ25vcmUgYWxyZWFkeSBzZXR1cCAocmFjZSBjb25kaXRpb24pXG5cbiAgICAgIGNvbnN0IGN1cnJlbnRJZCA9IHBsYXllci5tZWRpYSAmJiBwbGF5ZXIubWVkaWEuZ2V0QXR0cmlidXRlKCdpZCcpO1xuXG4gICAgICBpZiAoIWlzLmVtcHR5KGN1cnJlbnRJZCkgJiYgY3VycmVudElkLnN0YXJ0c1dpdGgoJ3lvdXR1YmUtJykpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfSAvLyBHZXQgdGhlIHNvdXJjZSBVUkwgb3IgSURcblxuXG4gICAgICBsZXQgc291cmNlID0gcGxheWVyLm1lZGlhLmdldEF0dHJpYnV0ZSgnc3JjJyk7IC8vIEdldCBmcm9tIDxkaXY+IGlmIG5lZWRlZFxuXG4gICAgICBpZiAoaXMuZW1wdHkoc291cmNlKSkge1xuICAgICAgICBzb3VyY2UgPSBwbGF5ZXIubWVkaWEuZ2V0QXR0cmlidXRlKHRoaXMuY29uZmlnLmF0dHJpYnV0ZXMuZW1iZWQuaWQpO1xuICAgICAgfSAvLyBSZXBsYWNlIHRoZSA8aWZyYW1lPiB3aXRoIGEgPGRpdj4gZHVlIHRvIFlvdVR1YmUgQVBJIGlzc3Vlc1xuXG5cbiAgICAgIGNvbnN0IHZpZGVvSWQgPSBwYXJzZUlkKHNvdXJjZSk7XG4gICAgICBjb25zdCBpZCA9IGdlbmVyYXRlSWQocGxheWVyLnByb3ZpZGVyKTsgLy8gUmVwbGFjZSBtZWRpYSBlbGVtZW50XG5cbiAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGNyZWF0ZUVsZW1lbnQoJ2RpdicsIHtcbiAgICAgICAgaWQsXG4gICAgICAgICdkYXRhLXBvc3Rlcic6IGNvbmZpZy5jdXN0b21Db250cm9scyA/IHBsYXllci5wb3N0ZXIgOiB1bmRlZmluZWRcbiAgICAgIH0pO1xuICAgICAgcGxheWVyLm1lZGlhID0gcmVwbGFjZUVsZW1lbnQoY29udGFpbmVyLCBwbGF5ZXIubWVkaWEpOyAvLyBPbmx5IGxvYWQgdGhlIHBvc3RlciB3aGVuIHVzaW5nIGN1c3RvbSBjb250cm9sc1xuXG4gICAgICBpZiAoY29uZmlnLmN1c3RvbUNvbnRyb2xzKSB7XG4gICAgICAgIGNvbnN0IHBvc3RlclNyYyA9IHMgPT4gYGh0dHBzOi8vaS55dGltZy5jb20vdmkvJHt2aWRlb0lkfS8ke3N9ZGVmYXVsdC5qcGdgOyAvLyBDaGVjayB0aHVtYm5haWwgaW1hZ2VzIGluIG9yZGVyIG9mIHF1YWxpdHksIGJ1dCByZWplY3QgZmFsbGJhY2sgdGh1bWJuYWlscyAoMTIwcHggd2lkZSlcblxuXG4gICAgICAgIGxvYWRJbWFnZShwb3N0ZXJTcmMoJ21heHJlcycpLCAxMjEpIC8vIEhpZ2VzdCBxdWFsaXR5IGFuZCB1bnBhZGRlZFxuICAgICAgICAuY2F0Y2goKCkgPT4gbG9hZEltYWdlKHBvc3RlclNyYygnc2QnKSwgMTIxKSkgLy8gNDgwcCBwYWRkZWQgNDozXG4gICAgICAgIC5jYXRjaCgoKSA9PiBsb2FkSW1hZ2UocG9zdGVyU3JjKCdocScpKSkgLy8gMzYwcCBwYWRkZWQgNDozLiBBbHdheXMgZXhpc3RzXG4gICAgICAgIC50aGVuKGltYWdlID0+IHVpLnNldFBvc3Rlci5jYWxsKHBsYXllciwgaW1hZ2Uuc3JjKSkudGhlbihzcmMgPT4ge1xuICAgICAgICAgIC8vIElmIHRoZSBpbWFnZSBpcyBwYWRkZWQsIHVzZSBiYWNrZ3JvdW5kLXNpemUgXCJjb3ZlclwiIGluc3RlYWQgKGxpa2UgeW91dHViZSBkb2VzIHRvbyB3aXRoIHRoZWlyIHBvc3RlcnMpXG4gICAgICAgICAgaWYgKCFzcmMuaW5jbHVkZXMoJ21heHJlcycpKSB7XG4gICAgICAgICAgICBwbGF5ZXIuZWxlbWVudHMucG9zdGVyLnN0eWxlLmJhY2tncm91bmRTaXplID0gJ2NvdmVyJztcbiAgICAgICAgICB9XG4gICAgICAgIH0pLmNhdGNoKCgpID0+IHt9KTtcbiAgICAgIH0gLy8gU2V0dXAgaW5zdGFuY2VcbiAgICAgIC8vIGh0dHBzOi8vZGV2ZWxvcGVycy5nb29nbGUuY29tL3lvdXR1YmUvaWZyYW1lX2FwaV9yZWZlcmVuY2VcblxuXG4gICAgICBwbGF5ZXIuZW1iZWQgPSBuZXcgd2luZG93LllULlBsYXllcihwbGF5ZXIubWVkaWEsIHtcbiAgICAgICAgdmlkZW9JZCxcbiAgICAgICAgaG9zdDogZ2V0SG9zdChjb25maWcpLFxuICAgICAgICBwbGF5ZXJWYXJzOiBleHRlbmQoe30sIHtcbiAgICAgICAgICAvLyBBdXRvcGxheVxuICAgICAgICAgIGF1dG9wbGF5OiBwbGF5ZXIuY29uZmlnLmF1dG9wbGF5ID8gMSA6IDAsXG4gICAgICAgICAgLy8gaWZyYW1lIGludGVyZmFjZSBsYW5ndWFnZVxuICAgICAgICAgIGhsOiBwbGF5ZXIuY29uZmlnLmhsLFxuICAgICAgICAgIC8vIE9ubHkgc2hvdyBjb250cm9scyBpZiBub3QgZnVsbHkgc3VwcG9ydGVkIG9yIG9wdGVkIG91dFxuICAgICAgICAgIGNvbnRyb2xzOiBwbGF5ZXIuc3VwcG9ydGVkLnVpICYmIGNvbmZpZy5jdXN0b21Db250cm9scyA/IDAgOiAxLFxuICAgICAgICAgIC8vIERpc2FibGUga2V5Ym9hcmQgYXMgd2UgaGFuZGxlIGl0XG4gICAgICAgICAgZGlzYWJsZWtiOiAxLFxuICAgICAgICAgIC8vIEFsbG93IGlPUyBpbmxpbmUgcGxheWJhY2tcbiAgICAgICAgICBwbGF5c2lubGluZTogIXBsYXllci5jb25maWcuZnVsbHNjcmVlbi5pb3NOYXRpdmUgPyAxIDogMCxcbiAgICAgICAgICAvLyBDYXB0aW9ucyBhcmUgZmxha3kgb24gWW91VHViZVxuICAgICAgICAgIGNjX2xvYWRfcG9saWN5OiBwbGF5ZXIuY2FwdGlvbnMuYWN0aXZlID8gMSA6IDAsXG4gICAgICAgICAgY2NfbGFuZ19wcmVmOiBwbGF5ZXIuY29uZmlnLmNhcHRpb25zLmxhbmd1YWdlLFxuICAgICAgICAgIC8vIFRyYWNraW5nIGZvciBzdGF0c1xuICAgICAgICAgIHdpZGdldF9yZWZlcnJlcjogd2luZG93ID8gd2luZG93LmxvY2F0aW9uLmhyZWYgOiBudWxsXG4gICAgICAgIH0sIGNvbmZpZyksXG4gICAgICAgIGV2ZW50czoge1xuICAgICAgICAgIG9uRXJyb3IoZXZlbnQpIHtcbiAgICAgICAgICAgIC8vIFlvdVR1YmUgbWF5IGZpcmUgb25FcnJvciB0d2ljZSwgc28gb25seSBoYW5kbGUgaXQgb25jZVxuICAgICAgICAgICAgaWYgKCFwbGF5ZXIubWVkaWEuZXJyb3IpIHtcbiAgICAgICAgICAgICAgY29uc3QgY29kZSA9IGV2ZW50LmRhdGE7IC8vIE1lc3NhZ2VzIGNvcGllZCBmcm9tIGh0dHBzOi8vZGV2ZWxvcGVycy5nb29nbGUuY29tL3lvdXR1YmUvaWZyYW1lX2FwaV9yZWZlcmVuY2Ujb25FcnJvclxuXG4gICAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSB7XG4gICAgICAgICAgICAgICAgMjogJ1RoZSByZXF1ZXN0IGNvbnRhaW5zIGFuIGludmFsaWQgcGFyYW1ldGVyIHZhbHVlLiBGb3IgZXhhbXBsZSwgdGhpcyBlcnJvciBvY2N1cnMgaWYgeW91IHNwZWNpZnkgYSB2aWRlbyBJRCB0aGF0IGRvZXMgbm90IGhhdmUgMTEgY2hhcmFjdGVycywgb3IgaWYgdGhlIHZpZGVvIElEIGNvbnRhaW5zIGludmFsaWQgY2hhcmFjdGVycywgc3VjaCBhcyBleGNsYW1hdGlvbiBwb2ludHMgb3IgYXN0ZXJpc2tzLicsXG4gICAgICAgICAgICAgICAgNTogJ1RoZSByZXF1ZXN0ZWQgY29udGVudCBjYW5ub3QgYmUgcGxheWVkIGluIGFuIEhUTUw1IHBsYXllciBvciBhbm90aGVyIGVycm9yIHJlbGF0ZWQgdG8gdGhlIEhUTUw1IHBsYXllciBoYXMgb2NjdXJyZWQuJyxcbiAgICAgICAgICAgICAgICAxMDA6ICdUaGUgdmlkZW8gcmVxdWVzdGVkIHdhcyBub3QgZm91bmQuIFRoaXMgZXJyb3Igb2NjdXJzIHdoZW4gYSB2aWRlbyBoYXMgYmVlbiByZW1vdmVkIChmb3IgYW55IHJlYXNvbikgb3IgaGFzIGJlZW4gbWFya2VkIGFzIHByaXZhdGUuJyxcbiAgICAgICAgICAgICAgICAxMDE6ICdUaGUgb3duZXIgb2YgdGhlIHJlcXVlc3RlZCB2aWRlbyBkb2VzIG5vdCBhbGxvdyBpdCB0byBiZSBwbGF5ZWQgaW4gZW1iZWRkZWQgcGxheWVycy4nLFxuICAgICAgICAgICAgICAgIDE1MDogJ1RoZSBvd25lciBvZiB0aGUgcmVxdWVzdGVkIHZpZGVvIGRvZXMgbm90IGFsbG93IGl0IHRvIGJlIHBsYXllZCBpbiBlbWJlZGRlZCBwbGF5ZXJzLidcbiAgICAgICAgICAgICAgfVtjb2RlXSB8fCAnQW4gdW5rbm93biBlcnJvciBvY2N1cmVkJztcbiAgICAgICAgICAgICAgcGxheWVyLm1lZGlhLmVycm9yID0ge1xuICAgICAgICAgICAgICAgIGNvZGUsXG4gICAgICAgICAgICAgICAgbWVzc2FnZVxuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICB0cmlnZ2VyRXZlbnQuY2FsbChwbGF5ZXIsIHBsYXllci5tZWRpYSwgJ2Vycm9yJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcblxuICAgICAgICAgIG9uUGxheWJhY2tSYXRlQ2hhbmdlKGV2ZW50KSB7XG4gICAgICAgICAgICAvLyBHZXQgdGhlIGluc3RhbmNlXG4gICAgICAgICAgICBjb25zdCBpbnN0YW5jZSA9IGV2ZW50LnRhcmdldDsgLy8gR2V0IGN1cnJlbnQgc3BlZWRcblxuICAgICAgICAgICAgcGxheWVyLm1lZGlhLnBsYXliYWNrUmF0ZSA9IGluc3RhbmNlLmdldFBsYXliYWNrUmF0ZSgpO1xuICAgICAgICAgICAgdHJpZ2dlckV2ZW50LmNhbGwocGxheWVyLCBwbGF5ZXIubWVkaWEsICdyYXRlY2hhbmdlJyk7XG4gICAgICAgICAgfSxcblxuICAgICAgICAgIG9uUmVhZHkoZXZlbnQpIHtcbiAgICAgICAgICAgIC8vIEJhaWwgaWYgb25SZWFkeSBoYXMgYWxyZWFkeSBiZWVuIGNhbGxlZC4gU2VlIGlzc3VlICMxMTA4XG4gICAgICAgICAgICBpZiAoaXMuZnVuY3Rpb24ocGxheWVyLm1lZGlhLnBsYXkpKSB7XG4gICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH0gLy8gR2V0IHRoZSBpbnN0YW5jZVxuXG5cbiAgICAgICAgICAgIGNvbnN0IGluc3RhbmNlID0gZXZlbnQudGFyZ2V0OyAvLyBHZXQgdGhlIHRpdGxlXG5cbiAgICAgICAgICAgIHlvdXR1YmUuZ2V0VGl0bGUuY2FsbChwbGF5ZXIsIHZpZGVvSWQpOyAvLyBDcmVhdGUgYSBmYXV4IEhUTUw1IEFQSSB1c2luZyB0aGUgWW91VHViZSBBUElcblxuICAgICAgICAgICAgcGxheWVyLm1lZGlhLnBsYXkgPSAoKSA9PiB7XG4gICAgICAgICAgICAgIGFzc3VyZVBsYXliYWNrU3RhdGUuY2FsbChwbGF5ZXIsIHRydWUpO1xuICAgICAgICAgICAgICBpbnN0YW5jZS5wbGF5VmlkZW8oKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHBsYXllci5tZWRpYS5wYXVzZSA9ICgpID0+IHtcbiAgICAgICAgICAgICAgYXNzdXJlUGxheWJhY2tTdGF0ZS5jYWxsKHBsYXllciwgZmFsc2UpO1xuICAgICAgICAgICAgICBpbnN0YW5jZS5wYXVzZVZpZGVvKCk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBwbGF5ZXIubWVkaWEuc3RvcCA9ICgpID0+IHtcbiAgICAgICAgICAgICAgaW5zdGFuY2Uuc3RvcFZpZGVvKCk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBwbGF5ZXIubWVkaWEuZHVyYXRpb24gPSBpbnN0YW5jZS5nZXREdXJhdGlvbigpO1xuICAgICAgICAgICAgcGxheWVyLm1lZGlhLnBhdXNlZCA9IHRydWU7IC8vIFNlZWtpbmdcblxuICAgICAgICAgICAgcGxheWVyLm1lZGlhLmN1cnJlbnRUaW1lID0gMDtcbiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwbGF5ZXIubWVkaWEsICdjdXJyZW50VGltZScsIHtcbiAgICAgICAgICAgICAgZ2V0KCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBOdW1iZXIoaW5zdGFuY2UuZ2V0Q3VycmVudFRpbWUoKSk7XG4gICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgc2V0KHRpbWUpIHtcbiAgICAgICAgICAgICAgICAvLyBJZiBwYXVzZWQgYW5kIG5ldmVyIHBsYXllZCwgbXV0ZSBhdWRpbyBwcmV2ZW50aXZlbHkgKFlvdVR1YmUgc3RhcnRzIHBsYXlpbmcgb24gc2VlayBpZiB0aGUgdmlkZW8gaGFzbid0IGJlZW4gcGxheWVkIHlldCkuXG4gICAgICAgICAgICAgICAgaWYgKHBsYXllci5wYXVzZWQgJiYgIXBsYXllci5lbWJlZC5oYXNQbGF5ZWQpIHtcbiAgICAgICAgICAgICAgICAgIHBsYXllci5lbWJlZC5tdXRlKCk7XG4gICAgICAgICAgICAgICAgfSAvLyBTZXQgc2Vla2luZyBzdGF0ZSBhbmQgdHJpZ2dlciBldmVudFxuXG5cbiAgICAgICAgICAgICAgICBwbGF5ZXIubWVkaWEuc2Vla2luZyA9IHRydWU7XG4gICAgICAgICAgICAgICAgdHJpZ2dlckV2ZW50LmNhbGwocGxheWVyLCBwbGF5ZXIubWVkaWEsICdzZWVraW5nJyk7IC8vIFNlZWsgYWZ0ZXIgZXZlbnRzIHNlbnRcblxuICAgICAgICAgICAgICAgIGluc3RhbmNlLnNlZWtUbyh0aW1lKTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9KTsgLy8gUGxheWJhY2sgc3BlZWRcblxuICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHBsYXllci5tZWRpYSwgJ3BsYXliYWNrUmF0ZScsIHtcbiAgICAgICAgICAgICAgZ2V0KCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBpbnN0YW5jZS5nZXRQbGF5YmFja1JhdGUoKTtcbiAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICBzZXQoaW5wdXQpIHtcbiAgICAgICAgICAgICAgICBpbnN0YW5jZS5zZXRQbGF5YmFja1JhdGUoaW5wdXQpO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0pOyAvLyBWb2x1bWVcblxuICAgICAgICAgICAgbGV0IHtcbiAgICAgICAgICAgICAgdm9sdW1lXG4gICAgICAgICAgICB9ID0gcGxheWVyLmNvbmZpZztcbiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwbGF5ZXIubWVkaWEsICd2b2x1bWUnLCB7XG4gICAgICAgICAgICAgIGdldCgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdm9sdW1lO1xuICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgIHNldChpbnB1dCkge1xuICAgICAgICAgICAgICAgIHZvbHVtZSA9IGlucHV0O1xuICAgICAgICAgICAgICAgIGluc3RhbmNlLnNldFZvbHVtZSh2b2x1bWUgKiAxMDApO1xuICAgICAgICAgICAgICAgIHRyaWdnZXJFdmVudC5jYWxsKHBsYXllciwgcGxheWVyLm1lZGlhLCAndm9sdW1lY2hhbmdlJyk7XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSk7IC8vIE11dGVkXG5cbiAgICAgICAgICAgIGxldCB7XG4gICAgICAgICAgICAgIG11dGVkXG4gICAgICAgICAgICB9ID0gcGxheWVyLmNvbmZpZztcbiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwbGF5ZXIubWVkaWEsICdtdXRlZCcsIHtcbiAgICAgICAgICAgICAgZ2V0KCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBtdXRlZDtcbiAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICBzZXQoaW5wdXQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0b2dnbGUgPSBpcy5ib29sZWFuKGlucHV0KSA/IGlucHV0IDogbXV0ZWQ7XG4gICAgICAgICAgICAgICAgbXV0ZWQgPSB0b2dnbGU7XG4gICAgICAgICAgICAgICAgaW5zdGFuY2VbdG9nZ2xlID8gJ211dGUnIDogJ3VuTXV0ZSddKCk7XG4gICAgICAgICAgICAgICAgaW5zdGFuY2Uuc2V0Vm9sdW1lKHZvbHVtZSAqIDEwMCk7XG4gICAgICAgICAgICAgICAgdHJpZ2dlckV2ZW50LmNhbGwocGxheWVyLCBwbGF5ZXIubWVkaWEsICd2b2x1bWVjaGFuZ2UnKTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9KTsgLy8gU291cmNlXG5cbiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwbGF5ZXIubWVkaWEsICdjdXJyZW50U3JjJywge1xuICAgICAgICAgICAgICBnZXQoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGluc3RhbmNlLmdldFZpZGVvVXJsKCk7XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSk7IC8vIEVuZGVkXG5cbiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwbGF5ZXIubWVkaWEsICdlbmRlZCcsIHtcbiAgICAgICAgICAgICAgZ2V0KCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBwbGF5ZXIuY3VycmVudFRpbWUgPT09IHBsYXllci5kdXJhdGlvbjtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9KTsgLy8gR2V0IGF2YWlsYWJsZSBzcGVlZHNcblxuICAgICAgICAgICAgY29uc3Qgc3BlZWRzID0gaW5zdGFuY2UuZ2V0QXZhaWxhYmxlUGxheWJhY2tSYXRlcygpOyAvLyBGaWx0ZXIgYmFzZWQgb24gY29uZmlnXG5cbiAgICAgICAgICAgIHBsYXllci5vcHRpb25zLnNwZWVkID0gc3BlZWRzLmZpbHRlcihzID0+IHBsYXllci5jb25maWcuc3BlZWQub3B0aW9ucy5pbmNsdWRlcyhzKSk7IC8vIFNldCB0aGUgdGFiaW5kZXggdG8gYXZvaWQgZm9jdXMgZW50ZXJpbmcgaWZyYW1lXG5cbiAgICAgICAgICAgIGlmIChwbGF5ZXIuc3VwcG9ydGVkLnVpICYmIGNvbmZpZy5jdXN0b21Db250cm9scykge1xuICAgICAgICAgICAgICBwbGF5ZXIubWVkaWEuc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsIC0xKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdHJpZ2dlckV2ZW50LmNhbGwocGxheWVyLCBwbGF5ZXIubWVkaWEsICd0aW1ldXBkYXRlJyk7XG4gICAgICAgICAgICB0cmlnZ2VyRXZlbnQuY2FsbChwbGF5ZXIsIHBsYXllci5tZWRpYSwgJ2R1cmF0aW9uY2hhbmdlJyk7IC8vIFJlc2V0IHRpbWVyXG5cbiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwocGxheWVyLnRpbWVycy5idWZmZXJpbmcpOyAvLyBTZXR1cCBidWZmZXJpbmdcblxuICAgICAgICAgICAgcGxheWVyLnRpbWVycy5idWZmZXJpbmcgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICAgICAgICAgIC8vIEdldCBsb2FkZWQgJSBmcm9tIFlvdVR1YmVcbiAgICAgICAgICAgICAgcGxheWVyLm1lZGlhLmJ1ZmZlcmVkID0gaW5zdGFuY2UuZ2V0VmlkZW9Mb2FkZWRGcmFjdGlvbigpOyAvLyBUcmlnZ2VyIHByb2dyZXNzIG9ubHkgd2hlbiB3ZSBhY3R1YWxseSBidWZmZXIgc29tZXRoaW5nXG5cbiAgICAgICAgICAgICAgaWYgKHBsYXllci5tZWRpYS5sYXN0QnVmZmVyZWQgPT09IG51bGwgfHwgcGxheWVyLm1lZGlhLmxhc3RCdWZmZXJlZCA8IHBsYXllci5tZWRpYS5idWZmZXJlZCkge1xuICAgICAgICAgICAgICAgIHRyaWdnZXJFdmVudC5jYWxsKHBsYXllciwgcGxheWVyLm1lZGlhLCAncHJvZ3Jlc3MnKTtcbiAgICAgICAgICAgICAgfSAvLyBTZXQgbGFzdCBidWZmZXIgcG9pbnRcblxuXG4gICAgICAgICAgICAgIHBsYXllci5tZWRpYS5sYXN0QnVmZmVyZWQgPSBwbGF5ZXIubWVkaWEuYnVmZmVyZWQ7IC8vIEJhaWwgaWYgd2UncmUgYXQgMTAwJVxuXG4gICAgICAgICAgICAgIGlmIChwbGF5ZXIubWVkaWEuYnVmZmVyZWQgPT09IDEpIHtcbiAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKHBsYXllci50aW1lcnMuYnVmZmVyaW5nKTsgLy8gVHJpZ2dlciBldmVudFxuXG4gICAgICAgICAgICAgICAgdHJpZ2dlckV2ZW50LmNhbGwocGxheWVyLCBwbGF5ZXIubWVkaWEsICdjYW5wbGF5dGhyb3VnaCcpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCAyMDApOyAvLyBSZWJ1aWxkIFVJXG5cbiAgICAgICAgICAgIGlmIChjb25maWcuY3VzdG9tQ29udHJvbHMpIHtcbiAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB1aS5idWlsZC5jYWxsKHBsYXllciksIDUwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuXG4gICAgICAgICAgb25TdGF0ZUNoYW5nZShldmVudCkge1xuICAgICAgICAgICAgLy8gR2V0IHRoZSBpbnN0YW5jZVxuICAgICAgICAgICAgY29uc3QgaW5zdGFuY2UgPSBldmVudC50YXJnZXQ7IC8vIFJlc2V0IHRpbWVyXG5cbiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwocGxheWVyLnRpbWVycy5wbGF5aW5nKTtcbiAgICAgICAgICAgIGNvbnN0IHNlZWtlZCA9IHBsYXllci5tZWRpYS5zZWVraW5nICYmIFsxLCAyXS5pbmNsdWRlcyhldmVudC5kYXRhKTtcblxuICAgICAgICAgICAgaWYgKHNlZWtlZCkge1xuICAgICAgICAgICAgICAvLyBVbnNldCBzZWVraW5nIGFuZCBmaXJlIHNlZWtlZCBldmVudFxuICAgICAgICAgICAgICBwbGF5ZXIubWVkaWEuc2Vla2luZyA9IGZhbHNlO1xuICAgICAgICAgICAgICB0cmlnZ2VyRXZlbnQuY2FsbChwbGF5ZXIsIHBsYXllci5tZWRpYSwgJ3NlZWtlZCcpO1xuICAgICAgICAgICAgfSAvLyBIYW5kbGUgZXZlbnRzXG4gICAgICAgICAgICAvLyAtMSAgIFVuc3RhcnRlZFxuICAgICAgICAgICAgLy8gMCAgICBFbmRlZFxuICAgICAgICAgICAgLy8gMSAgICBQbGF5aW5nXG4gICAgICAgICAgICAvLyAyICAgIFBhdXNlZFxuICAgICAgICAgICAgLy8gMyAgICBCdWZmZXJpbmdcbiAgICAgICAgICAgIC8vIDUgICAgVmlkZW8gY3VlZFxuXG5cbiAgICAgICAgICAgIHN3aXRjaCAoZXZlbnQuZGF0YSkge1xuICAgICAgICAgICAgICBjYXNlIC0xOlxuICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBzY3J1YmJlclxuICAgICAgICAgICAgICAgIHRyaWdnZXJFdmVudC5jYWxsKHBsYXllciwgcGxheWVyLm1lZGlhLCAndGltZXVwZGF0ZScpOyAvLyBHZXQgbG9hZGVkICUgZnJvbSBZb3VUdWJlXG5cbiAgICAgICAgICAgICAgICBwbGF5ZXIubWVkaWEuYnVmZmVyZWQgPSBpbnN0YW5jZS5nZXRWaWRlb0xvYWRlZEZyYWN0aW9uKCk7XG4gICAgICAgICAgICAgICAgdHJpZ2dlckV2ZW50LmNhbGwocGxheWVyLCBwbGF5ZXIubWVkaWEsICdwcm9ncmVzcycpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgICBhc3N1cmVQbGF5YmFja1N0YXRlLmNhbGwocGxheWVyLCBmYWxzZSk7IC8vIFlvdVR1YmUgZG9lc24ndCBzdXBwb3J0IGxvb3AgZm9yIGEgc2luZ2xlIHZpZGVvLCBzbyBtaW1pY2sgaXQuXG5cbiAgICAgICAgICAgICAgICBpZiAocGxheWVyLm1lZGlhLmxvb3ApIHtcbiAgICAgICAgICAgICAgICAgIC8vIFlvdVR1YmUgbmVlZHMgYSBjYWxsIHRvIGBzdG9wVmlkZW9gIGJlZm9yZSBwbGF5aW5nIGFnYWluXG4gICAgICAgICAgICAgICAgICBpbnN0YW5jZS5zdG9wVmlkZW8oKTtcbiAgICAgICAgICAgICAgICAgIGluc3RhbmNlLnBsYXlWaWRlbygpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICB0cmlnZ2VyRXZlbnQuY2FsbChwbGF5ZXIsIHBsYXllci5tZWRpYSwgJ2VuZGVkJyk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgIC8vIFJlc3RvcmUgcGF1c2VkIHN0YXRlIChZb3VUdWJlIHN0YXJ0cyBwbGF5aW5nIG9uIHNlZWsgaWYgdGhlIHZpZGVvIGhhc24ndCBiZWVuIHBsYXllZCB5ZXQpXG4gICAgICAgICAgICAgICAgaWYgKGNvbmZpZy5jdXN0b21Db250cm9scyAmJiAhcGxheWVyLmNvbmZpZy5hdXRvcGxheSAmJiBwbGF5ZXIubWVkaWEucGF1c2VkICYmICFwbGF5ZXIuZW1iZWQuaGFzUGxheWVkKSB7XG4gICAgICAgICAgICAgICAgICBwbGF5ZXIubWVkaWEucGF1c2UoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgYXNzdXJlUGxheWJhY2tTdGF0ZS5jYWxsKHBsYXllciwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICB0cmlnZ2VyRXZlbnQuY2FsbChwbGF5ZXIsIHBsYXllci5tZWRpYSwgJ3BsYXlpbmcnKTsgLy8gUG9sbCB0byBnZXQgcGxheWJhY2sgcHJvZ3Jlc3NcblxuICAgICAgICAgICAgICAgICAgcGxheWVyLnRpbWVycy5wbGF5aW5nID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0cmlnZ2VyRXZlbnQuY2FsbChwbGF5ZXIsIHBsYXllci5tZWRpYSwgJ3RpbWV1cGRhdGUnKTtcbiAgICAgICAgICAgICAgICAgIH0sIDUwKTsgLy8gQ2hlY2sgZHVyYXRpb24gYWdhaW4gZHVlIHRvIFlvdVR1YmUgYnVnXG4gICAgICAgICAgICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vc2FtcG90dHMvcGx5ci9pc3N1ZXMvMzc0XG4gICAgICAgICAgICAgICAgICAvLyBodHRwczovL2NvZGUuZ29vZ2xlLmNvbS9wL2dkYXRhLWlzc3Vlcy9pc3N1ZXMvZGV0YWlsP2lkPTg2OTBcblxuICAgICAgICAgICAgICAgICAgaWYgKHBsYXllci5tZWRpYS5kdXJhdGlvbiAhPT0gaW5zdGFuY2UuZ2V0RHVyYXRpb24oKSkge1xuICAgICAgICAgICAgICAgICAgICBwbGF5ZXIubWVkaWEuZHVyYXRpb24gPSBpbnN0YW5jZS5nZXREdXJhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICB0cmlnZ2VyRXZlbnQuY2FsbChwbGF5ZXIsIHBsYXllci5tZWRpYSwgJ2R1cmF0aW9uY2hhbmdlJyk7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgIC8vIFJlc3RvcmUgYXVkaW8gKFlvdVR1YmUgc3RhcnRzIHBsYXlpbmcgb24gc2VlayBpZiB0aGUgdmlkZW8gaGFzbid0IGJlZW4gcGxheWVkIHlldClcbiAgICAgICAgICAgICAgICBpZiAoIXBsYXllci5tdXRlZCkge1xuICAgICAgICAgICAgICAgICAgcGxheWVyLmVtYmVkLnVuTXV0ZSgpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGFzc3VyZVBsYXliYWNrU3RhdGUuY2FsbChwbGF5ZXIsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgICAgLy8gVHJpZ2dlciB3YWl0aW5nIGV2ZW50IHRvIGFkZCBsb2FkaW5nIGNsYXNzZXMgdG8gY29udGFpbmVyIGFzIHRoZSB2aWRlbyBidWZmZXJzLlxuICAgICAgICAgICAgICAgIHRyaWdnZXJFdmVudC5jYWxsKHBsYXllciwgcGxheWVyLm1lZGlhLCAnd2FpdGluZycpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0cmlnZ2VyRXZlbnQuY2FsbChwbGF5ZXIsIHBsYXllci5lbGVtZW50cy5jb250YWluZXIsICdzdGF0ZWNoYW5nZScsIGZhbHNlLCB7XG4gICAgICAgICAgICAgIGNvZGU6IGV2ZW50LmRhdGFcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cblxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgfTtcblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICBjb25zdCBtZWRpYSA9IHtcbiAgICAvLyBTZXR1cCBtZWRpYVxuICAgIHNldHVwKCkge1xuICAgICAgLy8gSWYgdGhlcmUncyBubyBtZWRpYSwgYmFpbFxuICAgICAgaWYgKCF0aGlzLm1lZGlhKSB7XG4gICAgICAgIHRoaXMuZGVidWcud2FybignTm8gbWVkaWEgZWxlbWVudCBmb3VuZCEnKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfSAvLyBBZGQgdHlwZSBjbGFzc1xuXG5cbiAgICAgIHRvZ2dsZUNsYXNzKHRoaXMuZWxlbWVudHMuY29udGFpbmVyLCB0aGlzLmNvbmZpZy5jbGFzc05hbWVzLnR5cGUucmVwbGFjZSgnezB9JywgdGhpcy50eXBlKSwgdHJ1ZSk7IC8vIEFkZCBwcm92aWRlciBjbGFzc1xuXG4gICAgICB0b2dnbGVDbGFzcyh0aGlzLmVsZW1lbnRzLmNvbnRhaW5lciwgdGhpcy5jb25maWcuY2xhc3NOYW1lcy5wcm92aWRlci5yZXBsYWNlKCd7MH0nLCB0aGlzLnByb3ZpZGVyKSwgdHJ1ZSk7IC8vIEFkZCB2aWRlbyBjbGFzcyBmb3IgZW1iZWRzXG4gICAgICAvLyBUaGlzIHdpbGwgcmVxdWlyZSBjaGFuZ2VzIGlmIGF1ZGlvIGVtYmVkcyBhcmUgYWRkZWRcblxuICAgICAgaWYgKHRoaXMuaXNFbWJlZCkge1xuICAgICAgICB0b2dnbGVDbGFzcyh0aGlzLmVsZW1lbnRzLmNvbnRhaW5lciwgdGhpcy5jb25maWcuY2xhc3NOYW1lcy50eXBlLnJlcGxhY2UoJ3swfScsICd2aWRlbycpLCB0cnVlKTtcbiAgICAgIH0gLy8gSW5qZWN0IHRoZSBwbGF5ZXIgd3JhcHBlclxuXG5cbiAgICAgIGlmICh0aGlzLmlzVmlkZW8pIHtcbiAgICAgICAgLy8gQ3JlYXRlIHRoZSB3cmFwcGVyIGRpdlxuICAgICAgICB0aGlzLmVsZW1lbnRzLndyYXBwZXIgPSBjcmVhdGVFbGVtZW50KCdkaXYnLCB7XG4gICAgICAgICAgY2xhc3M6IHRoaXMuY29uZmlnLmNsYXNzTmFtZXMudmlkZW9cbiAgICAgICAgfSk7IC8vIFdyYXAgdGhlIHZpZGVvIGluIGEgY29udGFpbmVyXG5cbiAgICAgICAgd3JhcCh0aGlzLm1lZGlhLCB0aGlzLmVsZW1lbnRzLndyYXBwZXIpOyAvLyBQb3N0ZXIgaW1hZ2UgY29udGFpbmVyXG5cbiAgICAgICAgdGhpcy5lbGVtZW50cy5wb3N0ZXIgPSBjcmVhdGVFbGVtZW50KCdkaXYnLCB7XG4gICAgICAgICAgY2xhc3M6IHRoaXMuY29uZmlnLmNsYXNzTmFtZXMucG9zdGVyXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmVsZW1lbnRzLndyYXBwZXIuYXBwZW5kQ2hpbGQodGhpcy5lbGVtZW50cy5wb3N0ZXIpO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5pc0hUTUw1KSB7XG4gICAgICAgIGh0bWw1LnNldHVwLmNhbGwodGhpcyk7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMuaXNZb3VUdWJlKSB7XG4gICAgICAgIHlvdXR1YmUuc2V0dXAuY2FsbCh0aGlzKTtcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5pc1ZpbWVvKSB7XG4gICAgICAgIHZpbWVvLnNldHVwLmNhbGwodGhpcyk7XG4gICAgICB9XG4gICAgfVxuXG4gIH07XG5cbiAgY29uc3QgZGVzdHJveSA9IGluc3RhbmNlID0+IHtcbiAgICAvLyBEZXN0cm95IG91ciBhZHNNYW5hZ2VyXG4gICAgaWYgKGluc3RhbmNlLm1hbmFnZXIpIHtcbiAgICAgIGluc3RhbmNlLm1hbmFnZXIuZGVzdHJveSgpO1xuICAgIH0gLy8gRGVzdHJveSBvdXIgYWRzTWFuYWdlclxuXG5cbiAgICBpZiAoaW5zdGFuY2UuZWxlbWVudHMuZGlzcGxheUNvbnRhaW5lcikge1xuICAgICAgaW5zdGFuY2UuZWxlbWVudHMuZGlzcGxheUNvbnRhaW5lci5kZXN0cm95KCk7XG4gICAgfVxuXG4gICAgaW5zdGFuY2UuZWxlbWVudHMuY29udGFpbmVyLnJlbW92ZSgpO1xuICB9O1xuXG4gIGNsYXNzIEFkcyB7XG4gICAgLyoqXG4gICAgICogQWRzIGNvbnN0cnVjdG9yLlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBwbGF5ZXJcbiAgICAgKiBAcmV0dXJuIHtBZHN9XG4gICAgICovXG4gICAgY29uc3RydWN0b3IocGxheWVyKSB7XG4gICAgICBfZGVmaW5lUHJvcGVydHkkMSh0aGlzLCBcImxvYWRcIiwgKCkgPT4ge1xuICAgICAgICBpZiAoIXRoaXMuZW5hYmxlZCkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfSAvLyBDaGVjayBpZiB0aGUgR29vZ2xlIElNQTMgU0RLIGlzIGxvYWRlZCBvciBsb2FkIGl0IG91cnNlbHZlc1xuXG5cbiAgICAgICAgaWYgKCFpcy5vYmplY3Qod2luZG93Lmdvb2dsZSkgfHwgIWlzLm9iamVjdCh3aW5kb3cuZ29vZ2xlLmltYSkpIHtcbiAgICAgICAgICBsb2FkU2NyaXB0KHRoaXMucGxheWVyLmNvbmZpZy51cmxzLmdvb2dsZUlNQS5zZGspLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5yZWFkeSgpO1xuICAgICAgICAgIH0pLmNhdGNoKCgpID0+IHtcbiAgICAgICAgICAgIC8vIFNjcmlwdCBmYWlsZWQgdG8gbG9hZCBvciBpcyBibG9ja2VkXG4gICAgICAgICAgICB0aGlzLnRyaWdnZXIoJ2Vycm9yJywgbmV3IEVycm9yKCdHb29nbGUgSU1BIFNESyBmYWlsZWQgdG8gbG9hZCcpKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLnJlYWR5KCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICBfZGVmaW5lUHJvcGVydHkkMSh0aGlzLCBcInJlYWR5XCIsICgpID0+IHtcbiAgICAgICAgLy8gRG91YmxlIGNoZWNrIHdlJ3JlIGVuYWJsZWRcbiAgICAgICAgaWYgKCF0aGlzLmVuYWJsZWQpIHtcbiAgICAgICAgICBkZXN0cm95KHRoaXMpO1xuICAgICAgICB9IC8vIFN0YXJ0IHRpY2tpbmcgb3VyIHNhZmV0eSB0aW1lci4gSWYgdGhlIHdob2xlIGFkdmVydGlzZW1lbnRcbiAgICAgICAgLy8gdGhpbmcgZG9lc24ndCByZXNvbHZlIHdpdGhpbiBvdXIgc2V0IHRpbWU7IHdlIGJhaWxcblxuXG4gICAgICAgIHRoaXMuc3RhcnRTYWZldHlUaW1lcigxMjAwMCwgJ3JlYWR5KCknKTsgLy8gQ2xlYXIgdGhlIHNhZmV0eSB0aW1lclxuXG4gICAgICAgIHRoaXMubWFuYWdlclByb21pc2UudGhlbigoKSA9PiB7XG4gICAgICAgICAgdGhpcy5jbGVhclNhZmV0eVRpbWVyKCdvbkFkc01hbmFnZXJMb2FkZWQoKScpO1xuICAgICAgICB9KTsgLy8gU2V0IGxpc3RlbmVycyBvbiB0aGUgUGx5ciBpbnN0YW5jZVxuXG4gICAgICAgIHRoaXMubGlzdGVuZXJzKCk7IC8vIFNldHVwIHRoZSBJTUEgU0RLXG5cbiAgICAgICAgdGhpcy5zZXR1cElNQSgpO1xuICAgICAgfSk7XG5cbiAgICAgIF9kZWZpbmVQcm9wZXJ0eSQxKHRoaXMsIFwic2V0dXBJTUFcIiwgKCkgPT4ge1xuICAgICAgICAvLyBDcmVhdGUgdGhlIGNvbnRhaW5lciBmb3Igb3VyIGFkdmVydGlzZW1lbnRzXG4gICAgICAgIHRoaXMuZWxlbWVudHMuY29udGFpbmVyID0gY3JlYXRlRWxlbWVudCgnZGl2Jywge1xuICAgICAgICAgIGNsYXNzOiB0aGlzLnBsYXllci5jb25maWcuY2xhc3NOYW1lcy5hZHNcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucGxheWVyLmVsZW1lbnRzLmNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLmVsZW1lbnRzLmNvbnRhaW5lcik7IC8vIFNvIHdlIGNhbiBydW4gVlBBSUQyXG5cbiAgICAgICAgZ29vZ2xlLmltYS5zZXR0aW5ncy5zZXRWcGFpZE1vZGUoZ29vZ2xlLmltYS5JbWFTZGtTZXR0aW5ncy5WcGFpZE1vZGUuRU5BQkxFRCk7IC8vIFNldCBsYW5ndWFnZVxuXG4gICAgICAgIGdvb2dsZS5pbWEuc2V0dGluZ3Muc2V0TG9jYWxlKHRoaXMucGxheWVyLmNvbmZpZy5hZHMubGFuZ3VhZ2UpOyAvLyBTZXQgcGxheWJhY2sgZm9yIGlPUzEwK1xuXG4gICAgICAgIGdvb2dsZS5pbWEuc2V0dGluZ3Muc2V0RGlzYWJsZUN1c3RvbVBsYXliYWNrRm9ySU9TMTBQbHVzKHRoaXMucGxheWVyLmNvbmZpZy5wbGF5c2lubGluZSk7IC8vIFdlIGFzc3VtZSB0aGUgYWRDb250YWluZXIgaXMgdGhlIHZpZGVvIGNvbnRhaW5lciBvZiB0aGUgcGx5ciBlbGVtZW50IHRoYXQgd2lsbCBob3VzZSB0aGUgYWRzXG5cbiAgICAgICAgdGhpcy5lbGVtZW50cy5kaXNwbGF5Q29udGFpbmVyID0gbmV3IGdvb2dsZS5pbWEuQWREaXNwbGF5Q29udGFpbmVyKHRoaXMuZWxlbWVudHMuY29udGFpbmVyLCB0aGlzLnBsYXllci5tZWRpYSk7IC8vIENyZWF0ZSBhZHMgbG9hZGVyXG5cbiAgICAgICAgdGhpcy5sb2FkZXIgPSBuZXcgZ29vZ2xlLmltYS5BZHNMb2FkZXIodGhpcy5lbGVtZW50cy5kaXNwbGF5Q29udGFpbmVyKTsgLy8gTGlzdGVuIGFuZCByZXNwb25kIHRvIGFkcyBsb2FkZWQgYW5kIGVycm9yIGV2ZW50c1xuXG4gICAgICAgIHRoaXMubG9hZGVyLmFkZEV2ZW50TGlzdGVuZXIoZ29vZ2xlLmltYS5BZHNNYW5hZ2VyTG9hZGVkRXZlbnQuVHlwZS5BRFNfTUFOQUdFUl9MT0FERUQsIGV2ZW50ID0+IHRoaXMub25BZHNNYW5hZ2VyTG9hZGVkKGV2ZW50KSwgZmFsc2UpO1xuICAgICAgICB0aGlzLmxvYWRlci5hZGRFdmVudExpc3RlbmVyKGdvb2dsZS5pbWEuQWRFcnJvckV2ZW50LlR5cGUuQURfRVJST1IsIGVycm9yID0+IHRoaXMub25BZEVycm9yKGVycm9yKSwgZmFsc2UpOyAvLyBSZXF1ZXN0IHZpZGVvIGFkcyB0byBiZSBwcmUtbG9hZGVkXG5cbiAgICAgICAgdGhpcy5yZXF1ZXN0QWRzKCk7XG4gICAgICB9KTtcblxuICAgICAgX2RlZmluZVByb3BlcnR5JDEodGhpcywgXCJyZXF1ZXN0QWRzXCIsICgpID0+IHtcbiAgICAgICAgY29uc3Qge1xuICAgICAgICAgIGNvbnRhaW5lclxuICAgICAgICB9ID0gdGhpcy5wbGF5ZXIuZWxlbWVudHM7XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAvLyBSZXF1ZXN0IHZpZGVvIGFkc1xuICAgICAgICAgIGNvbnN0IHJlcXVlc3QgPSBuZXcgZ29vZ2xlLmltYS5BZHNSZXF1ZXN0KCk7XG4gICAgICAgICAgcmVxdWVzdC5hZFRhZ1VybCA9IHRoaXMudGFnVXJsOyAvLyBTcGVjaWZ5IHRoZSBsaW5lYXIgYW5kIG5vbmxpbmVhciBzbG90IHNpemVzLiBUaGlzIGhlbHBzIHRoZSBTREtcbiAgICAgICAgICAvLyB0byBzZWxlY3QgdGhlIGNvcnJlY3QgY3JlYXRpdmUgaWYgbXVsdGlwbGUgYXJlIHJldHVybmVkXG5cbiAgICAgICAgICByZXF1ZXN0LmxpbmVhckFkU2xvdFdpZHRoID0gY29udGFpbmVyLm9mZnNldFdpZHRoO1xuICAgICAgICAgIHJlcXVlc3QubGluZWFyQWRTbG90SGVpZ2h0ID0gY29udGFpbmVyLm9mZnNldEhlaWdodDtcbiAgICAgICAgICByZXF1ZXN0Lm5vbkxpbmVhckFkU2xvdFdpZHRoID0gY29udGFpbmVyLm9mZnNldFdpZHRoO1xuICAgICAgICAgIHJlcXVlc3Qubm9uTGluZWFyQWRTbG90SGVpZ2h0ID0gY29udGFpbmVyLm9mZnNldEhlaWdodDsgLy8gV2Ugb25seSBvdmVybGF5IGFkcyBhcyB3ZSBvbmx5IHN1cHBvcnQgdmlkZW8uXG5cbiAgICAgICAgICByZXF1ZXN0LmZvcmNlTm9uTGluZWFyRnVsbFNsb3QgPSBmYWxzZTsgLy8gTXV0ZSBiYXNlZCBvbiBjdXJyZW50IHN0YXRlXG5cbiAgICAgICAgICByZXF1ZXN0LnNldEFkV2lsbFBsYXlNdXRlZCghdGhpcy5wbGF5ZXIubXV0ZWQpO1xuICAgICAgICAgIHRoaXMubG9hZGVyLnJlcXVlc3RBZHMocmVxdWVzdCk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgdGhpcy5vbkFkRXJyb3IoZXJyb3IpO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgX2RlZmluZVByb3BlcnR5JDEodGhpcywgXCJwb2xsQ291bnRkb3duXCIsIChzdGFydCA9IGZhbHNlKSA9PiB7XG4gICAgICAgIGlmICghc3RhcnQpIHtcbiAgICAgICAgICBjbGVhckludGVydmFsKHRoaXMuY291bnRkb3duVGltZXIpO1xuICAgICAgICAgIHRoaXMuZWxlbWVudHMuY29udGFpbmVyLnJlbW92ZUF0dHJpYnV0ZSgnZGF0YS1iYWRnZS10ZXh0Jyk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgdXBkYXRlID0gKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IHRpbWUgPSBmb3JtYXRUaW1lKE1hdGgubWF4KHRoaXMubWFuYWdlci5nZXRSZW1haW5pbmdUaW1lKCksIDApKTtcbiAgICAgICAgICBjb25zdCBsYWJlbCA9IGAke2kxOG4uZ2V0KCdhZHZlcnRpc2VtZW50JywgdGhpcy5wbGF5ZXIuY29uZmlnKX0gLSAke3RpbWV9YDtcbiAgICAgICAgICB0aGlzLmVsZW1lbnRzLmNvbnRhaW5lci5zZXRBdHRyaWJ1dGUoJ2RhdGEtYmFkZ2UtdGV4dCcsIGxhYmVsKTtcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLmNvdW50ZG93blRpbWVyID0gc2V0SW50ZXJ2YWwodXBkYXRlLCAxMDApO1xuICAgICAgfSk7XG5cbiAgICAgIF9kZWZpbmVQcm9wZXJ0eSQxKHRoaXMsIFwib25BZHNNYW5hZ2VyTG9hZGVkXCIsIGV2ZW50ID0+IHtcbiAgICAgICAgLy8gTG9hZCBjb3VsZCBvY2N1ciBhZnRlciBhIHNvdXJjZSBjaGFuZ2UgKHJhY2UgY29uZGl0aW9uKVxuICAgICAgICBpZiAoIXRoaXMuZW5hYmxlZCkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfSAvLyBHZXQgdGhlIGFkcyBtYW5hZ2VyXG5cblxuICAgICAgICBjb25zdCBzZXR0aW5ncyA9IG5ldyBnb29nbGUuaW1hLkFkc1JlbmRlcmluZ1NldHRpbmdzKCk7IC8vIFRlbGwgdGhlIFNESyB0byBzYXZlIGFuZCByZXN0b3JlIGNvbnRlbnQgdmlkZW8gc3RhdGUgb24gb3VyIGJlaGFsZlxuXG4gICAgICAgIHNldHRpbmdzLnJlc3RvcmVDdXN0b21QbGF5YmFja1N0YXRlT25BZEJyZWFrQ29tcGxldGUgPSB0cnVlO1xuICAgICAgICBzZXR0aW5ncy5lbmFibGVQcmVsb2FkaW5nID0gdHJ1ZTsgLy8gVGhlIFNESyBpcyBwb2xsaW5nIGN1cnJlbnRUaW1lIG9uIHRoZSBjb250ZW50UGxheWJhY2suIEFuZCBuZWVkcyBhIGR1cmF0aW9uXG4gICAgICAgIC8vIHNvIGl0IGNhbiBkZXRlcm1pbmUgd2hlbiB0byBzdGFydCB0aGUgbWlkLSBhbmQgcG9zdC1yb2xsXG5cbiAgICAgICAgdGhpcy5tYW5hZ2VyID0gZXZlbnQuZ2V0QWRzTWFuYWdlcih0aGlzLnBsYXllciwgc2V0dGluZ3MpOyAvLyBHZXQgdGhlIGN1ZSBwb2ludHMgZm9yIGFueSBtaWQtcm9sbHMgYnkgZmlsdGVyaW5nIG91dCB0aGUgcHJlLSBhbmQgcG9zdC1yb2xsXG5cbiAgICAgICAgdGhpcy5jdWVQb2ludHMgPSB0aGlzLm1hbmFnZXIuZ2V0Q3VlUG9pbnRzKCk7IC8vIEFkZCBsaXN0ZW5lcnMgdG8gdGhlIHJlcXVpcmVkIGV2ZW50c1xuICAgICAgICAvLyBBZHZlcnRpc2VtZW50IGVycm9yIGV2ZW50c1xuXG4gICAgICAgIHRoaXMubWFuYWdlci5hZGRFdmVudExpc3RlbmVyKGdvb2dsZS5pbWEuQWRFcnJvckV2ZW50LlR5cGUuQURfRVJST1IsIGVycm9yID0+IHRoaXMub25BZEVycm9yKGVycm9yKSk7IC8vIEFkdmVydGlzZW1lbnQgcmVndWxhciBldmVudHNcblxuICAgICAgICBPYmplY3Qua2V5cyhnb29nbGUuaW1hLkFkRXZlbnQuVHlwZSkuZm9yRWFjaCh0eXBlID0+IHtcbiAgICAgICAgICB0aGlzLm1hbmFnZXIuYWRkRXZlbnRMaXN0ZW5lcihnb29nbGUuaW1hLkFkRXZlbnQuVHlwZVt0eXBlXSwgZSA9PiB0aGlzLm9uQWRFdmVudChlKSk7XG4gICAgICAgIH0pOyAvLyBSZXNvbHZlIG91ciBhZHNNYW5hZ2VyXG5cbiAgICAgICAgdGhpcy50cmlnZ2VyKCdsb2FkZWQnKTtcbiAgICAgIH0pO1xuXG4gICAgICBfZGVmaW5lUHJvcGVydHkkMSh0aGlzLCBcImFkZEN1ZVBvaW50c1wiLCAoKSA9PiB7XG4gICAgICAgIC8vIEFkZCBhZHZlcnRpc2VtZW50IGN1ZSdzIHdpdGhpbiB0aGUgdGltZSBsaW5lIGlmIGF2YWlsYWJsZVxuICAgICAgICBpZiAoIWlzLmVtcHR5KHRoaXMuY3VlUG9pbnRzKSkge1xuICAgICAgICAgIHRoaXMuY3VlUG9pbnRzLmZvckVhY2goY3VlUG9pbnQgPT4ge1xuICAgICAgICAgICAgaWYgKGN1ZVBvaW50ICE9PSAwICYmIGN1ZVBvaW50ICE9PSAtMSAmJiBjdWVQb2ludCA8IHRoaXMucGxheWVyLmR1cmF0aW9uKSB7XG4gICAgICAgICAgICAgIGNvbnN0IHNlZWtFbGVtZW50ID0gdGhpcy5wbGF5ZXIuZWxlbWVudHMucHJvZ3Jlc3M7XG5cbiAgICAgICAgICAgICAgaWYgKGlzLmVsZW1lbnQoc2Vla0VsZW1lbnQpKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgY3VlUGVyY2VudGFnZSA9IDEwMCAvIHRoaXMucGxheWVyLmR1cmF0aW9uICogY3VlUG9pbnQ7XG4gICAgICAgICAgICAgICAgY29uc3QgY3VlID0gY3JlYXRlRWxlbWVudCgnc3BhbicsIHtcbiAgICAgICAgICAgICAgICAgIGNsYXNzOiB0aGlzLnBsYXllci5jb25maWcuY2xhc3NOYW1lcy5jdWVzXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgY3VlLnN0eWxlLmxlZnQgPSBgJHtjdWVQZXJjZW50YWdlLnRvU3RyaW5nKCl9JWA7XG4gICAgICAgICAgICAgICAgc2Vla0VsZW1lbnQuYXBwZW5kQ2hpbGQoY3VlKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgX2RlZmluZVByb3BlcnR5JDEodGhpcywgXCJvbkFkRXZlbnRcIiwgZXZlbnQgPT4ge1xuICAgICAgICBjb25zdCB7XG4gICAgICAgICAgY29udGFpbmVyXG4gICAgICAgIH0gPSB0aGlzLnBsYXllci5lbGVtZW50czsgLy8gUmV0cmlldmUgdGhlIGFkIGZyb20gdGhlIGV2ZW50LiBTb21lIGV2ZW50cyAoZS5nLiBBTExfQURTX0NPTVBMRVRFRClcbiAgICAgICAgLy8gZG9uJ3QgaGF2ZSBhZCBvYmplY3QgYXNzb2NpYXRlZFxuXG4gICAgICAgIGNvbnN0IGFkID0gZXZlbnQuZ2V0QWQoKTtcbiAgICAgICAgY29uc3QgYWREYXRhID0gZXZlbnQuZ2V0QWREYXRhKCk7IC8vIFByb3h5IGV2ZW50XG5cbiAgICAgICAgY29uc3QgZGlzcGF0Y2hFdmVudCA9IHR5cGUgPT4ge1xuICAgICAgICAgIHRyaWdnZXJFdmVudC5jYWxsKHRoaXMucGxheWVyLCB0aGlzLnBsYXllci5tZWRpYSwgYGFkcyR7dHlwZS5yZXBsYWNlKC9fL2csICcnKS50b0xvd2VyQ2FzZSgpfWApO1xuICAgICAgICB9OyAvLyBCdWJibGUgdGhlIGV2ZW50XG5cblxuICAgICAgICBkaXNwYXRjaEV2ZW50KGV2ZW50LnR5cGUpO1xuXG4gICAgICAgIHN3aXRjaCAoZXZlbnQudHlwZSkge1xuICAgICAgICAgIGNhc2UgZ29vZ2xlLmltYS5BZEV2ZW50LlR5cGUuTE9BREVEOlxuICAgICAgICAgICAgLy8gVGhpcyBpcyB0aGUgZmlyc3QgZXZlbnQgc2VudCBmb3IgYW4gYWQgLSBpdCBpcyBwb3NzaWJsZSB0byBkZXRlcm1pbmUgd2hldGhlciB0aGVcbiAgICAgICAgICAgIC8vIGFkIGlzIGEgdmlkZW8gYWQgb3IgYW4gb3ZlcmxheVxuICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCdsb2FkZWQnKTsgLy8gU3RhcnQgY291bnRkb3duXG5cbiAgICAgICAgICAgIHRoaXMucG9sbENvdW50ZG93bih0cnVlKTtcblxuICAgICAgICAgICAgaWYgKCFhZC5pc0xpbmVhcigpKSB7XG4gICAgICAgICAgICAgIC8vIFBvc2l0aW9uIEFkRGlzcGxheUNvbnRhaW5lciBjb3JyZWN0bHkgZm9yIG92ZXJsYXlcbiAgICAgICAgICAgICAgYWQud2lkdGggPSBjb250YWluZXIub2Zmc2V0V2lkdGg7XG4gICAgICAgICAgICAgIGFkLmhlaWdodCA9IGNvbnRhaW5lci5vZmZzZXRIZWlnaHQ7XG4gICAgICAgICAgICB9IC8vIGNvbnNvbGUuaW5mbygnQWQgdHlwZTogJyArIGV2ZW50LmdldEFkKCkuZ2V0QWRQb2RJbmZvKCkuZ2V0UG9kSW5kZXgoKSk7XG4gICAgICAgICAgICAvLyBjb25zb2xlLmluZm8oJ0FkIHRpbWU6ICcgKyBldmVudC5nZXRBZCgpLmdldEFkUG9kSW5mbygpLmdldFRpbWVPZmZzZXQoKSk7XG5cblxuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBjYXNlIGdvb2dsZS5pbWEuQWRFdmVudC5UeXBlLlNUQVJURUQ6XG4gICAgICAgICAgICAvLyBTZXQgdm9sdW1lIHRvIG1hdGNoIHBsYXllclxuICAgICAgICAgICAgdGhpcy5tYW5hZ2VyLnNldFZvbHVtZSh0aGlzLnBsYXllci52b2x1bWUpO1xuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBjYXNlIGdvb2dsZS5pbWEuQWRFdmVudC5UeXBlLkFMTF9BRFNfQ09NUExFVEVEOlxuICAgICAgICAgICAgLy8gQWxsIGFkcyBmb3IgdGhlIGN1cnJlbnQgdmlkZW9zIGFyZSBkb25lLiBXZSBjYW4gbm93IHJlcXVlc3QgbmV3IGFkdmVydGlzZW1lbnRzXG4gICAgICAgICAgICAvLyBpbiBjYXNlIHRoZSB2aWRlbyBpcyByZS1wbGF5ZWRcbiAgICAgICAgICAgIC8vIFRPRE86IEV4YW1wbGUgZm9yIHdoYXQgaGFwcGVucyB3aGVuIGEgbmV4dCB2aWRlbyBpbiBhIHBsYXlsaXN0IHdvdWxkIGJlIGxvYWRlZC5cbiAgICAgICAgICAgIC8vIFNvIGhlcmUgd2UgbG9hZCBhIG5ldyB2aWRlbyB3aGVuIGFsbCBhZHMgYXJlIGRvbmUuXG4gICAgICAgICAgICAvLyBUaGVuIHdlIGxvYWQgbmV3IGFkcyB3aXRoaW4gYSBuZXcgYWRzTWFuYWdlci4gV2hlbiB0aGUgdmlkZW9cbiAgICAgICAgICAgIC8vIElzIHN0YXJ0ZWQgLSBhZnRlciAtIHRoZSBhZHMgYXJlIGxvYWRlZCwgdGhlbiB3ZSBnZXQgYWRzLlxuICAgICAgICAgICAgLy8gWW91IGNhbiBhbHNvIGVhc2lseSB0ZXN0IGNhbmNlbGxpbmcgYW5kIHJlbG9hZGluZyBieSBydW5uaW5nXG4gICAgICAgICAgICAvLyBwbGF5ZXIuYWRzLmNhbmNlbCgpIGFuZCBwbGF5ZXIuYWRzLnBsYXkgZnJvbSB0aGUgY29uc29sZSBJIGd1ZXNzLlxuICAgICAgICAgICAgLy8gdGhpcy5wbGF5ZXIuc291cmNlID0ge1xuICAgICAgICAgICAgLy8gICAgIHR5cGU6ICd2aWRlbycsXG4gICAgICAgICAgICAvLyAgICAgdGl0bGU6ICdWaWV3IEZyb20gQSBCbHVlIE1vb24nLFxuICAgICAgICAgICAgLy8gICAgIHNvdXJjZXM6IFt7XG4gICAgICAgICAgICAvLyAgICAgICAgIHNyYzpcbiAgICAgICAgICAgIC8vICdodHRwczovL2Nkbi5wbHlyLmlvL3N0YXRpYy9kZW1vL1ZpZXdfRnJvbV9BX0JsdWVfTW9vbl9UcmFpbGVyLUhELm1wNCcsIHR5cGU6XG4gICAgICAgICAgICAvLyAndmlkZW8vbXA0JywgfV0sIHBvc3RlcjpcbiAgICAgICAgICAgIC8vICdodHRwczovL2Nkbi5wbHlyLmlvL3N0YXRpYy9kZW1vL1ZpZXdfRnJvbV9BX0JsdWVfTW9vbl9UcmFpbGVyLUhELmpwZycsIHRyYWNrczpcbiAgICAgICAgICAgIC8vIFsgeyBraW5kOiAnY2FwdGlvbnMnLCBsYWJlbDogJ0VuZ2xpc2gnLCBzcmNsYW5nOiAnZW4nLCBzcmM6XG4gICAgICAgICAgICAvLyAnaHR0cHM6Ly9jZG4ucGx5ci5pby9zdGF0aWMvZGVtby9WaWV3X0Zyb21fQV9CbHVlX01vb25fVHJhaWxlci1IRC5lbi52dHQnLFxuICAgICAgICAgICAgLy8gZGVmYXVsdDogdHJ1ZSwgfSwgeyBraW5kOiAnY2FwdGlvbnMnLCBsYWJlbDogJ0ZyZW5jaCcsIHNyY2xhbmc6ICdmcicsIHNyYzpcbiAgICAgICAgICAgIC8vICdodHRwczovL2Nkbi5wbHlyLmlvL3N0YXRpYy9kZW1vL1ZpZXdfRnJvbV9BX0JsdWVfTW9vbl9UcmFpbGVyLUhELmZyLnZ0dCcsIH0sIF0sXG4gICAgICAgICAgICAvLyB9O1xuICAgICAgICAgICAgLy8gVE9ETzogU28gdGhlcmUgaXMgc3RpbGwgdGhpcyB0aGluZyB3aGVyZSBhIHZpZGVvIHNob3VsZCBvbmx5IGJlIGFsbG93ZWQgdG8gc3RhcnRcbiAgICAgICAgICAgIC8vIHBsYXlpbmcgd2hlbiB0aGUgSU1BIFNESyBpcyByZWFkeSBvciBoYXMgZmFpbGVkXG4gICAgICAgICAgICBpZiAodGhpcy5wbGF5ZXIuZW5kZWQpIHtcbiAgICAgICAgICAgICAgdGhpcy5sb2FkQWRzKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAvLyBUaGUgU0RLIHdvbid0IGFsbG93IG5ldyBhZHMgdG8gYmUgY2FsbGVkIHdpdGhvdXQgcmVjZWl2aW5nIGEgY29udGVudENvbXBsZXRlKClcbiAgICAgICAgICAgICAgdGhpcy5sb2FkZXIuY29udGVudENvbXBsZXRlKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgY2FzZSBnb29nbGUuaW1hLkFkRXZlbnQuVHlwZS5DT05URU5UX1BBVVNFX1JFUVVFU1RFRDpcbiAgICAgICAgICAgIC8vIFRoaXMgZXZlbnQgaW5kaWNhdGVzIHRoZSBhZCBoYXMgc3RhcnRlZCAtIHRoZSB2aWRlbyBwbGF5ZXIgY2FuIGFkanVzdCB0aGUgVUksXG4gICAgICAgICAgICAvLyBmb3IgZXhhbXBsZSBkaXNwbGF5IGEgcGF1c2UgYnV0dG9uIGFuZCByZW1haW5pbmcgdGltZS4gRmlyZWQgd2hlbiBjb250ZW50IHNob3VsZFxuICAgICAgICAgICAgLy8gYmUgcGF1c2VkLiBUaGlzIHVzdWFsbHkgaGFwcGVucyByaWdodCBiZWZvcmUgYW4gYWQgaXMgYWJvdXQgdG8gY292ZXIgdGhlIGNvbnRlbnRcbiAgICAgICAgICAgIHRoaXMucGF1c2VDb250ZW50KCk7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGNhc2UgZ29vZ2xlLmltYS5BZEV2ZW50LlR5cGUuQ09OVEVOVF9SRVNVTUVfUkVRVUVTVEVEOlxuICAgICAgICAgICAgLy8gVGhpcyBldmVudCBpbmRpY2F0ZXMgdGhlIGFkIGhhcyBmaW5pc2hlZCAtIHRoZSB2aWRlbyBwbGF5ZXIgY2FuIHBlcmZvcm1cbiAgICAgICAgICAgIC8vIGFwcHJvcHJpYXRlIFVJIGFjdGlvbnMsIHN1Y2ggYXMgcmVtb3ZpbmcgdGhlIHRpbWVyIGZvciByZW1haW5pbmcgdGltZSBkZXRlY3Rpb24uXG4gICAgICAgICAgICAvLyBGaXJlZCB3aGVuIGNvbnRlbnQgc2hvdWxkIGJlIHJlc3VtZWQuIFRoaXMgdXN1YWxseSBoYXBwZW5zIHdoZW4gYW4gYWQgZmluaXNoZXNcbiAgICAgICAgICAgIC8vIG9yIGNvbGxhcHNlc1xuICAgICAgICAgICAgdGhpcy5wb2xsQ291bnRkb3duKCk7XG4gICAgICAgICAgICB0aGlzLnJlc3VtZUNvbnRlbnQoKTtcbiAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgY2FzZSBnb29nbGUuaW1hLkFkRXZlbnQuVHlwZS5MT0c6XG4gICAgICAgICAgICBpZiAoYWREYXRhLmFkRXJyb3IpIHtcbiAgICAgICAgICAgICAgdGhpcy5wbGF5ZXIuZGVidWcud2FybihgTm9uLWZhdGFsIGFkIGVycm9yOiAke2FkRGF0YS5hZEVycm9yLmdldE1lc3NhZ2UoKX1gKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICBfZGVmaW5lUHJvcGVydHkkMSh0aGlzLCBcIm9uQWRFcnJvclwiLCBldmVudCA9PiB7XG4gICAgICAgIHRoaXMuY2FuY2VsKCk7XG4gICAgICAgIHRoaXMucGxheWVyLmRlYnVnLndhcm4oJ0FkcyBlcnJvcicsIGV2ZW50KTtcbiAgICAgIH0pO1xuXG4gICAgICBfZGVmaW5lUHJvcGVydHkkMSh0aGlzLCBcImxpc3RlbmVyc1wiLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHtcbiAgICAgICAgICBjb250YWluZXJcbiAgICAgICAgfSA9IHRoaXMucGxheWVyLmVsZW1lbnRzO1xuICAgICAgICBsZXQgdGltZTtcbiAgICAgICAgdGhpcy5wbGF5ZXIub24oJ2NhbnBsYXknLCAoKSA9PiB7XG4gICAgICAgICAgdGhpcy5hZGRDdWVQb2ludHMoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucGxheWVyLm9uKCdlbmRlZCcsICgpID0+IHtcbiAgICAgICAgICB0aGlzLmxvYWRlci5jb250ZW50Q29tcGxldGUoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucGxheWVyLm9uKCd0aW1ldXBkYXRlJywgKCkgPT4ge1xuICAgICAgICAgIHRpbWUgPSB0aGlzLnBsYXllci5jdXJyZW50VGltZTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucGxheWVyLm9uKCdzZWVrZWQnLCAoKSA9PiB7XG4gICAgICAgICAgY29uc3Qgc2Vla2VkVGltZSA9IHRoaXMucGxheWVyLmN1cnJlbnRUaW1lO1xuXG4gICAgICAgICAgaWYgKGlzLmVtcHR5KHRoaXMuY3VlUG9pbnRzKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHRoaXMuY3VlUG9pbnRzLmZvckVhY2goKGN1ZVBvaW50LCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgaWYgKHRpbWUgPCBjdWVQb2ludCAmJiBjdWVQb2ludCA8IHNlZWtlZFRpbWUpIHtcbiAgICAgICAgICAgICAgdGhpcy5tYW5hZ2VyLmRpc2NhcmRBZEJyZWFrKCk7XG4gICAgICAgICAgICAgIHRoaXMuY3VlUG9pbnRzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pOyAvLyBMaXN0ZW4gdG8gdGhlIHJlc2l6aW5nIG9mIHRoZSB3aW5kb3cuIEFuZCByZXNpemUgYWQgYWNjb3JkaW5nbHlcbiAgICAgICAgLy8gVE9ETzogZXZlbnR1YWxseSBpbXBsZW1lbnQgUmVzaXplT2JzZXJ2ZXJcblxuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgKCkgPT4ge1xuICAgICAgICAgIGlmICh0aGlzLm1hbmFnZXIpIHtcbiAgICAgICAgICAgIHRoaXMubWFuYWdlci5yZXNpemUoY29udGFpbmVyLm9mZnNldFdpZHRoLCBjb250YWluZXIub2Zmc2V0SGVpZ2h0LCBnb29nbGUuaW1hLlZpZXdNb2RlLk5PUk1BTCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICBfZGVmaW5lUHJvcGVydHkkMSh0aGlzLCBcInBsYXlcIiwgKCkgPT4ge1xuICAgICAgICBjb25zdCB7XG4gICAgICAgICAgY29udGFpbmVyXG4gICAgICAgIH0gPSB0aGlzLnBsYXllci5lbGVtZW50cztcblxuICAgICAgICBpZiAoIXRoaXMubWFuYWdlclByb21pc2UpIHtcbiAgICAgICAgICB0aGlzLnJlc3VtZUNvbnRlbnQoKTtcbiAgICAgICAgfSAvLyBQbGF5IHRoZSByZXF1ZXN0ZWQgYWR2ZXJ0aXNlbWVudCB3aGVuZXZlciB0aGUgYWRzTWFuYWdlciBpcyByZWFkeVxuXG5cbiAgICAgICAgdGhpcy5tYW5hZ2VyUHJvbWlzZS50aGVuKCgpID0+IHtcbiAgICAgICAgICAvLyBTZXQgdm9sdW1lIHRvIG1hdGNoIHBsYXllclxuICAgICAgICAgIHRoaXMubWFuYWdlci5zZXRWb2x1bWUodGhpcy5wbGF5ZXIudm9sdW1lKTsgLy8gSW5pdGlhbGl6ZSB0aGUgY29udGFpbmVyLiBNdXN0IGJlIGRvbmUgdmlhIGEgdXNlciBhY3Rpb24gb24gbW9iaWxlIGRldmljZXNcblxuICAgICAgICAgIHRoaXMuZWxlbWVudHMuZGlzcGxheUNvbnRhaW5lci5pbml0aWFsaXplKCk7XG5cbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgaWYgKCF0aGlzLmluaXRpYWxpemVkKSB7XG4gICAgICAgICAgICAgIC8vIEluaXRpYWxpemUgdGhlIGFkcyBtYW5hZ2VyLiBBZCBydWxlcyBwbGF5bGlzdCB3aWxsIHN0YXJ0IGF0IHRoaXMgdGltZVxuICAgICAgICAgICAgICB0aGlzLm1hbmFnZXIuaW5pdChjb250YWluZXIub2Zmc2V0V2lkdGgsIGNvbnRhaW5lci5vZmZzZXRIZWlnaHQsIGdvb2dsZS5pbWEuVmlld01vZGUuTk9STUFMKTsgLy8gQ2FsbCBwbGF5IHRvIHN0YXJ0IHNob3dpbmcgdGhlIGFkLiBTaW5nbGUgdmlkZW8gYW5kIG92ZXJsYXkgYWRzIHdpbGxcbiAgICAgICAgICAgICAgLy8gc3RhcnQgYXQgdGhpcyB0aW1lOyB0aGUgY2FsbCB3aWxsIGJlIGlnbm9yZWQgZm9yIGFkIHJ1bGVzXG5cbiAgICAgICAgICAgICAgdGhpcy5tYW5hZ2VyLnN0YXJ0KCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuaW5pdGlhbGl6ZWQgPSB0cnVlO1xuICAgICAgICAgIH0gY2F0Y2ggKGFkRXJyb3IpIHtcbiAgICAgICAgICAgIC8vIEFuIGVycm9yIG1heSBiZSB0aHJvd24gaWYgdGhlcmUgd2FzIGEgcHJvYmxlbSB3aXRoIHRoZVxuICAgICAgICAgICAgLy8gVkFTVCByZXNwb25zZVxuICAgICAgICAgICAgdGhpcy5vbkFkRXJyb3IoYWRFcnJvcik7XG4gICAgICAgICAgfVxuICAgICAgICB9KS5jYXRjaCgoKSA9PiB7fSk7XG4gICAgICB9KTtcblxuICAgICAgX2RlZmluZVByb3BlcnR5JDEodGhpcywgXCJyZXN1bWVDb250ZW50XCIsICgpID0+IHtcbiAgICAgICAgLy8gSGlkZSB0aGUgYWR2ZXJ0aXNlbWVudCBjb250YWluZXJcbiAgICAgICAgdGhpcy5lbGVtZW50cy5jb250YWluZXIuc3R5bGUuekluZGV4ID0gJyc7IC8vIEFkIGlzIHN0b3BwZWRcblxuICAgICAgICB0aGlzLnBsYXlpbmcgPSBmYWxzZTsgLy8gUGxheSB2aWRlb1xuXG4gICAgICAgIHNpbGVuY2VQcm9taXNlKHRoaXMucGxheWVyLm1lZGlhLnBsYXkoKSk7XG4gICAgICB9KTtcblxuICAgICAgX2RlZmluZVByb3BlcnR5JDEodGhpcywgXCJwYXVzZUNvbnRlbnRcIiwgKCkgPT4ge1xuICAgICAgICAvLyBTaG93IHRoZSBhZHZlcnRpc2VtZW50IGNvbnRhaW5lclxuICAgICAgICB0aGlzLmVsZW1lbnRzLmNvbnRhaW5lci5zdHlsZS56SW5kZXggPSAzOyAvLyBBZCBpcyBwbGF5aW5nXG5cbiAgICAgICAgdGhpcy5wbGF5aW5nID0gdHJ1ZTsgLy8gUGF1c2Ugb3VyIHZpZGVvLlxuXG4gICAgICAgIHRoaXMucGxheWVyLm1lZGlhLnBhdXNlKCk7XG4gICAgICB9KTtcblxuICAgICAgX2RlZmluZVByb3BlcnR5JDEodGhpcywgXCJjYW5jZWxcIiwgKCkgPT4ge1xuICAgICAgICAvLyBQYXVzZSBvdXIgdmlkZW9cbiAgICAgICAgaWYgKHRoaXMuaW5pdGlhbGl6ZWQpIHtcbiAgICAgICAgICB0aGlzLnJlc3VtZUNvbnRlbnQoKTtcbiAgICAgICAgfSAvLyBUZWxsIG91ciBpbnN0YW5jZSB0aGF0IHdlJ3JlIGRvbmUgZm9yIG5vd1xuXG5cbiAgICAgICAgdGhpcy50cmlnZ2VyKCdlcnJvcicpOyAvLyBSZS1jcmVhdGUgb3VyIGFkc01hbmFnZXJcblxuICAgICAgICB0aGlzLmxvYWRBZHMoKTtcbiAgICAgIH0pO1xuXG4gICAgICBfZGVmaW5lUHJvcGVydHkkMSh0aGlzLCBcImxvYWRBZHNcIiwgKCkgPT4ge1xuICAgICAgICAvLyBUZWxsIG91ciBhZHNNYW5hZ2VyIHRvIGdvIGJ5ZSBieWVcbiAgICAgICAgdGhpcy5tYW5hZ2VyUHJvbWlzZS50aGVuKCgpID0+IHtcbiAgICAgICAgICAvLyBEZXN0cm95IG91ciBhZHNNYW5hZ2VyXG4gICAgICAgICAgaWYgKHRoaXMubWFuYWdlcikge1xuICAgICAgICAgICAgdGhpcy5tYW5hZ2VyLmRlc3Ryb3koKTtcbiAgICAgICAgICB9IC8vIFJlLXNldCBvdXIgYWRzTWFuYWdlciBwcm9taXNlc1xuXG5cbiAgICAgICAgICB0aGlzLm1hbmFnZXJQcm9taXNlID0gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XG4gICAgICAgICAgICB0aGlzLm9uKCdsb2FkZWQnLCByZXNvbHZlKTtcbiAgICAgICAgICAgIHRoaXMucGxheWVyLmRlYnVnLmxvZyh0aGlzLm1hbmFnZXIpO1xuICAgICAgICAgIH0pOyAvLyBOb3cgdGhhdCB0aGUgbWFuYWdlciBoYXMgYmVlbiBkZXN0cm95ZWQgc2V0IGl0IHRvIGFsc28gYmUgdW4taW5pdGlhbGl6ZWRcblxuICAgICAgICAgIHRoaXMuaW5pdGlhbGl6ZWQgPSBmYWxzZTsgLy8gTm93IHJlcXVlc3Qgc29tZSBuZXcgYWR2ZXJ0aXNlbWVudHNcblxuICAgICAgICAgIHRoaXMucmVxdWVzdEFkcygpO1xuICAgICAgICB9KS5jYXRjaCgoKSA9PiB7fSk7XG4gICAgICB9KTtcblxuICAgICAgX2RlZmluZVByb3BlcnR5JDEodGhpcywgXCJ0cmlnZ2VyXCIsIChldmVudCwgLi4uYXJncykgPT4ge1xuICAgICAgICBjb25zdCBoYW5kbGVycyA9IHRoaXMuZXZlbnRzW2V2ZW50XTtcblxuICAgICAgICBpZiAoaXMuYXJyYXkoaGFuZGxlcnMpKSB7XG4gICAgICAgICAgaGFuZGxlcnMuZm9yRWFjaChoYW5kbGVyID0+IHtcbiAgICAgICAgICAgIGlmIChpcy5mdW5jdGlvbihoYW5kbGVyKSkge1xuICAgICAgICAgICAgICBoYW5kbGVyLmFwcGx5KHRoaXMsIGFyZ3MpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgX2RlZmluZVByb3BlcnR5JDEodGhpcywgXCJvblwiLCAoZXZlbnQsIGNhbGxiYWNrKSA9PiB7XG4gICAgICAgIGlmICghaXMuYXJyYXkodGhpcy5ldmVudHNbZXZlbnRdKSkge1xuICAgICAgICAgIHRoaXMuZXZlbnRzW2V2ZW50XSA9IFtdO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5ldmVudHNbZXZlbnRdLnB1c2goY2FsbGJhY2spO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgIH0pO1xuXG4gICAgICBfZGVmaW5lUHJvcGVydHkkMSh0aGlzLCBcInN0YXJ0U2FmZXR5VGltZXJcIiwgKHRpbWUsIGZyb20pID0+IHtcbiAgICAgICAgdGhpcy5wbGF5ZXIuZGVidWcubG9nKGBTYWZldHkgdGltZXIgaW52b2tlZCBmcm9tOiAke2Zyb219YCk7XG4gICAgICAgIHRoaXMuc2FmZXR5VGltZXIgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICB0aGlzLmNhbmNlbCgpO1xuICAgICAgICAgIHRoaXMuY2xlYXJTYWZldHlUaW1lcignc3RhcnRTYWZldHlUaW1lcigpJyk7XG4gICAgICAgIH0sIHRpbWUpO1xuICAgICAgfSk7XG5cbiAgICAgIF9kZWZpbmVQcm9wZXJ0eSQxKHRoaXMsIFwiY2xlYXJTYWZldHlUaW1lclwiLCBmcm9tID0+IHtcbiAgICAgICAgaWYgKCFpcy5udWxsT3JVbmRlZmluZWQodGhpcy5zYWZldHlUaW1lcikpIHtcbiAgICAgICAgICB0aGlzLnBsYXllci5kZWJ1Zy5sb2coYFNhZmV0eSB0aW1lciBjbGVhcmVkIGZyb206ICR7ZnJvbX1gKTtcbiAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5zYWZldHlUaW1lcik7XG4gICAgICAgICAgdGhpcy5zYWZldHlUaW1lciA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLnBsYXllciA9IHBsYXllcjtcbiAgICAgIHRoaXMuY29uZmlnID0gcGxheWVyLmNvbmZpZy5hZHM7XG4gICAgICB0aGlzLnBsYXlpbmcgPSBmYWxzZTtcbiAgICAgIHRoaXMuaW5pdGlhbGl6ZWQgPSBmYWxzZTtcbiAgICAgIHRoaXMuZWxlbWVudHMgPSB7XG4gICAgICAgIGNvbnRhaW5lcjogbnVsbCxcbiAgICAgICAgZGlzcGxheUNvbnRhaW5lcjogbnVsbFxuICAgICAgfTtcbiAgICAgIHRoaXMubWFuYWdlciA9IG51bGw7XG4gICAgICB0aGlzLmxvYWRlciA9IG51bGw7XG4gICAgICB0aGlzLmN1ZVBvaW50cyA9IG51bGw7XG4gICAgICB0aGlzLmV2ZW50cyA9IHt9O1xuICAgICAgdGhpcy5zYWZldHlUaW1lciA9IG51bGw7XG4gICAgICB0aGlzLmNvdW50ZG93blRpbWVyID0gbnVsbDsgLy8gU2V0dXAgYSBwcm9taXNlIHRvIHJlc29sdmUgd2hlbiB0aGUgSU1BIG1hbmFnZXIgaXMgcmVhZHlcblxuICAgICAgdGhpcy5tYW5hZ2VyUHJvbWlzZSA9IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgLy8gVGhlIGFkIGlzIGxvYWRlZCBhbmQgcmVhZHlcbiAgICAgICAgdGhpcy5vbignbG9hZGVkJywgcmVzb2x2ZSk7IC8vIEFkcyBmYWlsZWRcblxuICAgICAgICB0aGlzLm9uKCdlcnJvcicsIHJlamVjdCk7XG4gICAgICB9KTtcbiAgICAgIHRoaXMubG9hZCgpO1xuICAgIH1cblxuICAgIGdldCBlbmFibGVkKCkge1xuICAgICAgY29uc3Qge1xuICAgICAgICBjb25maWdcbiAgICAgIH0gPSB0aGlzO1xuICAgICAgcmV0dXJuIHRoaXMucGxheWVyLmlzSFRNTDUgJiYgdGhpcy5wbGF5ZXIuaXNWaWRlbyAmJiBjb25maWcuZW5hYmxlZCAmJiAoIWlzLmVtcHR5KGNvbmZpZy5wdWJsaXNoZXJJZCkgfHwgaXMudXJsKGNvbmZpZy50YWdVcmwpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogTG9hZCB0aGUgSU1BIFNES1xuICAgICAqL1xuXG5cbiAgICAvLyBCdWlsZCB0aGUgdGFnIFVSTFxuICAgIGdldCB0YWdVcmwoKSB7XG4gICAgICBjb25zdCB7XG4gICAgICAgIGNvbmZpZ1xuICAgICAgfSA9IHRoaXM7XG5cbiAgICAgIGlmIChpcy51cmwoY29uZmlnLnRhZ1VybCkpIHtcbiAgICAgICAgcmV0dXJuIGNvbmZpZy50YWdVcmw7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHBhcmFtcyA9IHtcbiAgICAgICAgQVZfUFVCTElTSEVSSUQ6ICc1OGMyNWJiMDA3M2VmNDQ4YjEwODdhZDYnLFxuICAgICAgICBBVl9DSEFOTkVMSUQ6ICc1YTA0NThkYzI4YTA2MTQ1ZTQ1MTlkMjEnLFxuICAgICAgICBBVl9VUkw6IHdpbmRvdy5sb2NhdGlvbi5ob3N0bmFtZSxcbiAgICAgICAgY2I6IERhdGUubm93KCksXG4gICAgICAgIEFWX1dJRFRIOiA2NDAsXG4gICAgICAgIEFWX0hFSUdIVDogNDgwLFxuICAgICAgICBBVl9DRElNMjogY29uZmlnLnB1Ymxpc2hlcklkXG4gICAgICB9O1xuICAgICAgY29uc3QgYmFzZSA9ICdodHRwczovL2dvLmFuaXZpZXcuY29tL2FwaS9hZHNlcnZlcjYvdmFzdC8nO1xuICAgICAgcmV0dXJuIGAke2Jhc2V9PyR7YnVpbGRVcmxQYXJhbXMocGFyYW1zKX1gO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBJbiBvcmRlciBmb3IgdGhlIFNESyB0byBkaXNwbGF5IGFkcyBmb3Igb3VyIHZpZGVvLCB3ZSBuZWVkIHRvIHRlbGwgaXQgd2hlcmUgdG8gcHV0IHRoZW0sXG4gICAgICogc28gaGVyZSB3ZSBkZWZpbmUgb3VyIGFkIGNvbnRhaW5lci4gVGhpcyBkaXYgaXMgc2V0IHVwIHRvIHJlbmRlciBvbiB0b3Agb2YgdGhlIHZpZGVvIHBsYXllci5cbiAgICAgKiBVc2luZyB0aGUgY29kZSBiZWxvdywgd2UgdGVsbCB0aGUgU0RLIHRvIHJlbmRlciBhZHMgd2l0aGluIHRoYXQgZGl2LiBXZSBhbHNvIHByb3ZpZGUgYVxuICAgICAqIGhhbmRsZSB0byB0aGUgY29udGVudCB2aWRlbyBwbGF5ZXIgLSB0aGUgU0RLIHdpbGwgcG9sbCB0aGUgY3VycmVudCB0aW1lIG9mIG91ciBwbGF5ZXIgdG9cbiAgICAgKiBwcm9wZXJseSBwbGFjZSBtaWQtcm9sbHMuIEFmdGVyIHdlIGNyZWF0ZSB0aGUgYWQgZGlzcGxheSBjb250YWluZXIsIHdlIGluaXRpYWxpemUgaXQuIE9uXG4gICAgICogbW9iaWxlIGRldmljZXMsIHRoaXMgaW5pdGlhbGl6YXRpb24gaXMgZG9uZSBhcyB0aGUgcmVzdWx0IG9mIGEgdXNlciBhY3Rpb24uXG4gICAgICovXG5cblxuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgYSBudW1iZXIgd2hvc2UgdmFsdWUgaXMgbGltaXRlZCB0byB0aGUgZ2l2ZW4gcmFuZ2UuXG4gICAqXG4gICAqIEV4YW1wbGU6IGxpbWl0IHRoZSBvdXRwdXQgb2YgdGhpcyBjb21wdXRhdGlvbiB0byBiZXR3ZWVuIDAgYW5kIDI1NVxuICAgKiAoeCAqIDI1NSkuY2xhbXAoMCwgMjU1KVxuICAgKlxuICAgKiBAcGFyYW0ge051bWJlcn0gaW5wdXRcbiAgICogQHBhcmFtIHtOdW1iZXJ9IG1pbiBUaGUgbG93ZXIgYm91bmRhcnkgb2YgdGhlIG91dHB1dCByYW5nZVxuICAgKiBAcGFyYW0ge051bWJlcn0gbWF4IFRoZSB1cHBlciBib3VuZGFyeSBvZiB0aGUgb3V0cHV0IHJhbmdlXG4gICAqIEByZXR1cm5zIEEgbnVtYmVyIHdpdGhpbiB0aGUgYm91bmRzIG9mIG1pbiBhbmQgbWF4XG4gICAqIEB0eXBlIE51bWJlclxuICAgKi9cbiAgZnVuY3Rpb24gY2xhbXAoaW5wdXQgPSAwLCBtaW4gPSAwLCBtYXggPSAyNTUpIHtcbiAgICByZXR1cm4gTWF0aC5taW4oTWF0aC5tYXgoaW5wdXQsIG1pbiksIG1heCk7XG4gIH1cblxuICBjb25zdCBwYXJzZVZ0dCA9IHZ0dERhdGFTdHJpbmcgPT4ge1xuICAgIGNvbnN0IHByb2Nlc3NlZExpc3QgPSBbXTtcbiAgICBjb25zdCBmcmFtZXMgPSB2dHREYXRhU3RyaW5nLnNwbGl0KC9cXHJcXG5cXHJcXG58XFxuXFxufFxcclxcci8pO1xuICAgIGZyYW1lcy5mb3JFYWNoKGZyYW1lID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHt9O1xuICAgICAgY29uc3QgbGluZXMgPSBmcmFtZS5zcGxpdCgvXFxyXFxufFxcbnxcXHIvKTtcbiAgICAgIGxpbmVzLmZvckVhY2gobGluZSA9PiB7XG4gICAgICAgIGlmICghaXMubnVtYmVyKHJlc3VsdC5zdGFydFRpbWUpKSB7XG4gICAgICAgICAgLy8gVGhlIGxpbmUgd2l0aCBzdGFydCBhbmQgZW5kIHRpbWVzIG9uIGl0IGlzIHRoZSBmaXJzdCBsaW5lIG9mIGludGVyZXN0XG4gICAgICAgICAgY29uc3QgbWF0Y2hUaW1lcyA9IGxpbmUubWF0Y2goLyhbMC05XXsyfSk/Oj8oWzAtOV17Mn0pOihbMC05XXsyfSkuKFswLTldezIsM30pKCA/LS0+ID8pKFswLTldezJ9KT86PyhbMC05XXsyfSk6KFswLTldezJ9KS4oWzAtOV17MiwzfSkvKTsgLy8gTm90ZSB0aGF0IHRoaXMgY3VycmVudGx5IGlnbm9yZXMgY2FwdGlvbiBmb3JtYXR0aW5nIGRpcmVjdGl2ZXMgdGhhdCBhcmUgb3B0aW9uYWxseSBvbiB0aGUgZW5kIG9mIHRoaXMgbGluZSAtIGZpbmUgZm9yIG5vbi1jYXB0aW9ucyBWVFRcblxuICAgICAgICAgIGlmIChtYXRjaFRpbWVzKSB7XG4gICAgICAgICAgICByZXN1bHQuc3RhcnRUaW1lID0gTnVtYmVyKG1hdGNoVGltZXNbMV0gfHwgMCkgKiA2MCAqIDYwICsgTnVtYmVyKG1hdGNoVGltZXNbMl0pICogNjAgKyBOdW1iZXIobWF0Y2hUaW1lc1szXSkgKyBOdW1iZXIoYDAuJHttYXRjaFRpbWVzWzRdfWApO1xuICAgICAgICAgICAgcmVzdWx0LmVuZFRpbWUgPSBOdW1iZXIobWF0Y2hUaW1lc1s2XSB8fCAwKSAqIDYwICogNjAgKyBOdW1iZXIobWF0Y2hUaW1lc1s3XSkgKiA2MCArIE51bWJlcihtYXRjaFRpbWVzWzhdKSArIE51bWJlcihgMC4ke21hdGNoVGltZXNbOV19YCk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKCFpcy5lbXB0eShsaW5lLnRyaW0oKSkgJiYgaXMuZW1wdHkocmVzdWx0LnRleHQpKSB7XG4gICAgICAgICAgLy8gSWYgd2UgYWxyZWFkeSBoYXZlIHRoZSBzdGFydFRpbWUsIHRoZW4gd2UncmUgZGVmaW5pdGVseSB1cCB0byB0aGUgdGV4dCBsaW5lKHMpXG4gICAgICAgICAgY29uc3QgbGluZVNwbGl0ID0gbGluZS50cmltKCkuc3BsaXQoJyN4eXdoPScpO1xuICAgICAgICAgIFtyZXN1bHQudGV4dF0gPSBsaW5lU3BsaXQ7IC8vIElmIHRoZXJlJ3MgY29udGVudCBpbiBsaW5lU3BsaXRbMV0sIHRoZW4gd2UgaGF2ZSBzcHJpdGVzLiBJZiBub3QsIHRoZW4gaXQncyBqdXN0IG9uZSBmcmFtZSBwZXIgaW1hZ2VcblxuICAgICAgICAgIGlmIChsaW5lU3BsaXRbMV0pIHtcbiAgICAgICAgICAgIFtyZXN1bHQueCwgcmVzdWx0LnksIHJlc3VsdC53LCByZXN1bHQuaF0gPSBsaW5lU3BsaXRbMV0uc3BsaXQoJywnKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICBpZiAocmVzdWx0LnRleHQpIHtcbiAgICAgICAgcHJvY2Vzc2VkTGlzdC5wdXNoKHJlc3VsdCk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIHByb2Nlc3NlZExpc3Q7XG4gIH07XG4gIC8qKlxuICAgKiBQcmV2aWV3IHRodW1ibmFpbHMgZm9yIHNlZWsgaG92ZXIgYW5kIHNjcnViYmluZ1xuICAgKiBTZWVraW5nOiBIb3ZlciBvdmVyIHRoZSBzZWVrIGJhciAoZGVza3RvcCBvbmx5KTogc2hvd3MgYSBzbWFsbCBwcmV2aWV3IGNvbnRhaW5lciBhYm92ZSB0aGUgc2VlayBiYXJcbiAgICogU2NydWJiaW5nOiBDbGljayBhbmQgZHJhZyB0aGUgc2VlayBiYXIgKGRlc2t0b3AgYW5kIG1vYmlsZSk6IHNob3dzIHRoZSBwcmV2aWV3IGltYWdlIG92ZXIgdGhlIGVudGlyZSB2aWRlbywgYXMgaWYgdGhlIHZpZGVvIGlzIHNjcnViYmluZyBhdCB2ZXJ5IGhpZ2ggc3BlZWRcbiAgICpcbiAgICogTm90ZXM6XG4gICAqIC0gVGh1bWJzIGFyZSBzZXQgdmlhIEpTIHNldHRpbmdzIG9uIFBseXIgaW5pdCwgbm90IEhUTUw1ICd0cmFjaycgcHJvcGVydHkuIFVzaW5nIHRoZSB0cmFjayBwcm9wZXJ0eSB3b3VsZCBiZSBhIGJpdCBncm9zcywgYmVjYXVzZSBpdCBkb2Vzbid0IHN1cHBvcnQgY3VzdG9tICdraW5kcycuIGtpbmQ9bWV0YWRhdGEgbWlnaHQgYmUgdXNlZCBmb3Igc29tZXRoaW5nIGVsc2UsIGFuZCB3ZSB3YW50IHRvIGFsbG93IG11bHRpcGxlIHRodW1ibmFpbHMgdHJhY2tzLiBUcmFja3MgbXVzdCBoYXZlIGEgdW5pcXVlIGNvbWJpbmF0aW9uIG9mICdraW5kJyBhbmQgJ2xhYmVsJy4gV2Ugd291bGQgaGF2ZSB0byBkbyBzb21ldGhpbmcgbGlrZSBraW5kPW1ldGFkYXRhLGxhYmVsPXRodW1ibmFpbHMxIC8ga2luZD1tZXRhZGF0YSxsYWJlbD10aHVtYm5haWxzMi4gU3F1YXJlIHBlZywgcm91bmQgaG9sZVxuICAgKiAtIFZUVCBpbmZvOiB0aGUgaW1hZ2UgVVJMIGlzIHJlbGF0aXZlIHRvIHRoZSBWVFQsIG5vdCB0aGUgY3VycmVudCBkb2N1bWVudC4gQnV0IGlmIHRoZSB1cmwgc3RhcnRzIHdpdGggYSBzbGFzaCwgaXQgd2lsbCBuYXR1cmFsbHkgYmUgcmVsYXRpdmUgdG8gdGhlIGN1cnJlbnQgZG9tYWluLiBodHRwczovL3N1cHBvcnQuandwbGF5ZXIuY29tL2FydGljbGVzL2hvdy10by1hZGQtcHJldmlldy10aHVtYm5haWxzXG4gICAqIC0gVGhpcyBpbXBsZW1lbnRhdGlvbiB1c2VzIG11bHRpcGxlIHNlcGFyYXRlIGltZyBlbGVtZW50cy4gT3RoZXIgaW1wbGVtZW50YXRpb25zIHVzZSBiYWNrZ3JvdW5kLWltYWdlIG9uIG9uZSBlbGVtZW50LiBUaGlzIHdvdWxkIGJlIG5pY2UgYW5kIHNpbXBsZSwgYnV0IEZpcmVmb3ggYW5kIFNhZmFyaSBoYXZlIGZsaWNrZXJpbmcgaXNzdWVzIHdpdGggcmVwbGFjaW5nIGJhY2tncm91bmRzIG9mIGxhcmdlciBpbWFnZXMuIEl0IHNlZW1zIHRoYXQgWW91VHViZSBwZXJoYXBzIG9ubHkgYXZvaWRzIHRoaXMgYmVjYXVzZSB0aGV5IGRvbid0IGhhdmUgdGhlIG9wdGlvbiBmb3IgaGlnaC1yZXMgcHJldmlld3MgKGV2ZW4gdGhlIGZ1bGxzY3JlZW4gb25lcywgd2hlbiBtb3VzZWRvd24vc2Vla2luZykuIEltYWdlcyBhcHBlYXIgb3ZlciB0aGUgdG9wIG9mIGVhY2ggb3RoZXIsIGFuZCBwcmV2aW91cyBvbmVzIGFyZSBkaXNjYXJkZWQgb25jZSB0aGUgbmV3IG9uZXMgaGF2ZSBiZWVuIHJlbmRlcmVkXG4gICAqL1xuXG5cbiAgY29uc3QgZml0UmF0aW8gPSAocmF0aW8sIG91dGVyKSA9PiB7XG4gICAgY29uc3QgdGFyZ2V0UmF0aW8gPSBvdXRlci53aWR0aCAvIG91dGVyLmhlaWdodDtcbiAgICBjb25zdCByZXN1bHQgPSB7fTtcblxuICAgIGlmIChyYXRpbyA+IHRhcmdldFJhdGlvKSB7XG4gICAgICByZXN1bHQud2lkdGggPSBvdXRlci53aWR0aDtcbiAgICAgIHJlc3VsdC5oZWlnaHQgPSAxIC8gcmF0aW8gKiBvdXRlci53aWR0aDtcbiAgICB9IGVsc2Uge1xuICAgICAgcmVzdWx0LmhlaWdodCA9IG91dGVyLmhlaWdodDtcbiAgICAgIHJlc3VsdC53aWR0aCA9IHJhdGlvICogb3V0ZXIuaGVpZ2h0O1xuICAgIH1cblxuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG5cbiAgY2xhc3MgUHJldmlld1RodW1ibmFpbHMge1xuICAgIC8qKlxuICAgICAqIFByZXZpZXdUaHVtYm5haWxzIGNvbnN0cnVjdG9yLlxuICAgICAqIEBwYXJhbSB7UGx5cn0gcGxheWVyXG4gICAgICogQHJldHVybiB7UHJldmlld1RodW1ibmFpbHN9XG4gICAgICovXG4gICAgY29uc3RydWN0b3IocGxheWVyKSB7XG4gICAgICBfZGVmaW5lUHJvcGVydHkkMSh0aGlzLCBcImxvYWRcIiwgKCkgPT4ge1xuICAgICAgICAvLyBUb2dnbGUgdGhlIHJlZ3VsYXIgc2VlayB0b29sdGlwXG4gICAgICAgIGlmICh0aGlzLnBsYXllci5lbGVtZW50cy5kaXNwbGF5LnNlZWtUb29sdGlwKSB7XG4gICAgICAgICAgdGhpcy5wbGF5ZXIuZWxlbWVudHMuZGlzcGxheS5zZWVrVG9vbHRpcC5oaWRkZW4gPSB0aGlzLmVuYWJsZWQ7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIXRoaXMuZW5hYmxlZCkgcmV0dXJuO1xuICAgICAgICB0aGlzLmdldFRodW1ibmFpbHMoKS50aGVuKCgpID0+IHtcbiAgICAgICAgICBpZiAoIXRoaXMuZW5hYmxlZCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH0gLy8gUmVuZGVyIERPTSBlbGVtZW50c1xuXG5cbiAgICAgICAgICB0aGlzLnJlbmRlcigpOyAvLyBDaGVjayB0byBzZWUgaWYgdGh1bWIgY29udGFpbmVyIHNpemUgd2FzIHNwZWNpZmllZCBtYW51YWxseSBpbiBDU1NcblxuICAgICAgICAgIHRoaXMuZGV0ZXJtaW5lQ29udGFpbmVyQXV0b1NpemluZygpO1xuICAgICAgICAgIHRoaXMubG9hZGVkID0gdHJ1ZTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgICAgX2RlZmluZVByb3BlcnR5JDEodGhpcywgXCJnZXRUaHVtYm5haWxzXCIsICgpID0+IHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xuICAgICAgICAgIGNvbnN0IHtcbiAgICAgICAgICAgIHNyY1xuICAgICAgICAgIH0gPSB0aGlzLnBsYXllci5jb25maWcucHJldmlld1RodW1ibmFpbHM7XG5cbiAgICAgICAgICBpZiAoaXMuZW1wdHkoc3JjKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdNaXNzaW5nIHByZXZpZXdUaHVtYm5haWxzLnNyYyBjb25maWcgYXR0cmlidXRlJyk7XG4gICAgICAgICAgfSAvLyBSZXNvbHZlIHByb21pc2VcblxuXG4gICAgICAgICAgY29uc3Qgc29ydEFuZFJlc29sdmUgPSAoKSA9PiB7XG4gICAgICAgICAgICAvLyBTb3J0IHNtYWxsZXN0IHRvIGJpZ2dlc3QgKGUuZy4sIFsxMjBwLCA0ODBwLCAxMDgwcF0pXG4gICAgICAgICAgICB0aGlzLnRodW1ibmFpbHMuc29ydCgoeCwgeSkgPT4geC5oZWlnaHQgLSB5LmhlaWdodCk7XG4gICAgICAgICAgICB0aGlzLnBsYXllci5kZWJ1Zy5sb2coJ1ByZXZpZXcgdGh1bWJuYWlscycsIHRoaXMudGh1bWJuYWlscyk7XG4gICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgICAgfTsgLy8gVmlhIGNhbGxiYWNrKClcblxuXG4gICAgICAgICAgaWYgKGlzLmZ1bmN0aW9uKHNyYykpIHtcbiAgICAgICAgICAgIHNyYyh0aHVtYm5haWxzID0+IHtcbiAgICAgICAgICAgICAgdGhpcy50aHVtYm5haWxzID0gdGh1bWJuYWlscztcbiAgICAgICAgICAgICAgc29ydEFuZFJlc29sdmUoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0gLy8gVlRUIHVybHNcbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIC8vIElmIHN0cmluZywgY29udmVydCBpbnRvIHNpbmdsZS1lbGVtZW50IGxpc3RcbiAgICAgICAgICAgIGNvbnN0IHVybHMgPSBpcy5zdHJpbmcoc3JjKSA/IFtzcmNdIDogc3JjOyAvLyBMb29wIHRocm91Z2ggZWFjaCBzcmMgVVJMLiBEb3dubG9hZCBhbmQgcHJvY2VzcyB0aGUgVlRUIGZpbGUsIHN0b3JpbmcgdGhlIHJlc3VsdGluZyBkYXRhIGluIHRoaXMudGh1bWJuYWlsc1xuXG4gICAgICAgICAgICBjb25zdCBwcm9taXNlcyA9IHVybHMubWFwKHUgPT4gdGhpcy5nZXRUaHVtYm5haWwodSkpOyAvLyBSZXNvbHZlXG5cbiAgICAgICAgICAgIFByb21pc2UuYWxsKHByb21pc2VzKS50aGVuKHNvcnRBbmRSZXNvbHZlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAgIF9kZWZpbmVQcm9wZXJ0eSQxKHRoaXMsIFwiZ2V0VGh1bWJuYWlsXCIsIHVybCA9PiB7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcbiAgICAgICAgICBmZXRjaCh1cmwpLnRoZW4ocmVzcG9uc2UgPT4ge1xuICAgICAgICAgICAgY29uc3QgdGh1bWJuYWlsID0ge1xuICAgICAgICAgICAgICBmcmFtZXM6IHBhcnNlVnR0KHJlc3BvbnNlKSxcbiAgICAgICAgICAgICAgaGVpZ2h0OiBudWxsLFxuICAgICAgICAgICAgICB1cmxQcmVmaXg6ICcnXG4gICAgICAgICAgICB9OyAvLyBJZiB0aGUgVVJMcyBkb24ndCBzdGFydCB3aXRoICcvJywgdGhlbiB3ZSBuZWVkIHRvIHNldCB0aGVpciByZWxhdGl2ZSBwYXRoIHRvIGJlIHRoZSBsb2NhdGlvbiBvZiB0aGUgVlRUIGZpbGVcbiAgICAgICAgICAgIC8vIElmIHRoZSBVUkxzIGRvIHN0YXJ0IHdpdGggJy8nLCB0aGVuIHRoZXkgb2J2aW91c2x5IGRvbid0IG5lZWQgYSBwcmVmaXgsIHNvIGl0IHdpbGwgcmVtYWluIGJsYW5rXG4gICAgICAgICAgICAvLyBJZiB0aGUgdGh1bWJuYWlsIFVSTHMgc3RhcnQgd2l0aCB3aXRoIG5vbmUgb2YgJy8nLCAnaHR0cDovLycgb3IgJ2h0dHBzOi8vJywgdGhlbiB3ZSBuZWVkIHRvIHNldCB0aGVpciByZWxhdGl2ZSBwYXRoIHRvIGJlIHRoZSBsb2NhdGlvbiBvZiB0aGUgVlRUIGZpbGVcblxuICAgICAgICAgICAgaWYgKCF0aHVtYm5haWwuZnJhbWVzWzBdLnRleHQuc3RhcnRzV2l0aCgnLycpICYmICF0aHVtYm5haWwuZnJhbWVzWzBdLnRleHQuc3RhcnRzV2l0aCgnaHR0cDovLycpICYmICF0aHVtYm5haWwuZnJhbWVzWzBdLnRleHQuc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuICAgICAgICAgICAgICB0aHVtYm5haWwudXJsUHJlZml4ID0gdXJsLnN1YnN0cmluZygwLCB1cmwubGFzdEluZGV4T2YoJy8nKSArIDEpO1xuICAgICAgICAgICAgfSAvLyBEb3dubG9hZCB0aGUgZmlyc3QgZnJhbWUsIHNvIHRoYXQgd2UgY2FuIGRldGVybWluZS9zZXQgdGhlIGhlaWdodCBvZiB0aGlzIHRodW1ibmFpbHNEZWZcblxuXG4gICAgICAgICAgICBjb25zdCB0ZW1wSW1hZ2UgPSBuZXcgSW1hZ2UoKTtcblxuICAgICAgICAgICAgdGVtcEltYWdlLm9ubG9hZCA9ICgpID0+IHtcbiAgICAgICAgICAgICAgdGh1bWJuYWlsLmhlaWdodCA9IHRlbXBJbWFnZS5uYXR1cmFsSGVpZ2h0O1xuICAgICAgICAgICAgICB0aHVtYm5haWwud2lkdGggPSB0ZW1wSW1hZ2UubmF0dXJhbFdpZHRoO1xuICAgICAgICAgICAgICB0aGlzLnRodW1ibmFpbHMucHVzaCh0aHVtYm5haWwpO1xuICAgICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB0ZW1wSW1hZ2Uuc3JjID0gdGh1bWJuYWlsLnVybFByZWZpeCArIHRodW1ibmFpbC5mcmFtZXNbMF0udGV4dDtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgICAgX2RlZmluZVByb3BlcnR5JDEodGhpcywgXCJzdGFydE1vdmVcIiwgZXZlbnQgPT4ge1xuICAgICAgICBpZiAoIXRoaXMubG9hZGVkKSByZXR1cm47XG4gICAgICAgIGlmICghaXMuZXZlbnQoZXZlbnQpIHx8ICFbJ3RvdWNobW92ZScsICdtb3VzZW1vdmUnXS5pbmNsdWRlcyhldmVudC50eXBlKSkgcmV0dXJuOyAvLyBXYWl0IHVudGlsIG1lZGlhIGhhcyBhIGR1cmF0aW9uXG5cbiAgICAgICAgaWYgKCF0aGlzLnBsYXllci5tZWRpYS5kdXJhdGlvbikgcmV0dXJuO1xuXG4gICAgICAgIGlmIChldmVudC50eXBlID09PSAndG91Y2htb3ZlJykge1xuICAgICAgICAgIC8vIENhbGN1bGF0ZSBzZWVrIGhvdmVyIHBvc2l0aW9uIGFzIGFwcHJveCB2aWRlbyBzZWNvbmRzXG4gICAgICAgICAgdGhpcy5zZWVrVGltZSA9IHRoaXMucGxheWVyLm1lZGlhLmR1cmF0aW9uICogKHRoaXMucGxheWVyLmVsZW1lbnRzLmlucHV0cy5zZWVrLnZhbHVlIC8gMTAwKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB2YXIgX3RoaXMkcGxheWVyJGNvbmZpZyRtLCBfdGhpcyRwbGF5ZXIkY29uZmlnJG0yO1xuXG4gICAgICAgICAgLy8gQ2FsY3VsYXRlIHNlZWsgaG92ZXIgcG9zaXRpb24gYXMgYXBwcm94IHZpZGVvIHNlY29uZHNcbiAgICAgICAgICBjb25zdCBjbGllbnRSZWN0ID0gdGhpcy5wbGF5ZXIuZWxlbWVudHMucHJvZ3Jlc3MuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICAgICAgY29uc3QgcGVyY2VudGFnZSA9IDEwMCAvIGNsaWVudFJlY3Qud2lkdGggKiAoZXZlbnQucGFnZVggLSBjbGllbnRSZWN0LmxlZnQpO1xuICAgICAgICAgIHRoaXMuc2Vla1RpbWUgPSB0aGlzLnBsYXllci5tZWRpYS5kdXJhdGlvbiAqIChwZXJjZW50YWdlIC8gMTAwKTtcblxuICAgICAgICAgIGlmICh0aGlzLnNlZWtUaW1lIDwgMCkge1xuICAgICAgICAgICAgLy8gVGhlIG1vdXNlbW92ZSBmaXJlcyBmb3IgMTArcHggb3V0IHRvIHRoZSBsZWZ0XG4gICAgICAgICAgICB0aGlzLnNlZWtUaW1lID0gMDtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAodGhpcy5zZWVrVGltZSA+IHRoaXMucGxheWVyLm1lZGlhLmR1cmF0aW9uIC0gMSkge1xuICAgICAgICAgICAgLy8gVG9vayAxIHNlY29uZCBvZmYgdGhlIGR1cmF0aW9uIGZvciBzYWZldHksIGJlY2F1c2UgZGlmZmVyZW50IHBsYXllcnMgY2FuIGRpc2FncmVlIG9uIHRoZSByZWFsIGR1cmF0aW9uIG9mIGEgdmlkZW9cbiAgICAgICAgICAgIHRoaXMuc2Vla1RpbWUgPSB0aGlzLnBsYXllci5tZWRpYS5kdXJhdGlvbiAtIDE7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdGhpcy5tb3VzZVBvc1ggPSBldmVudC5wYWdlWDsgLy8gU2V0IHRpbWUgdGV4dCBpbnNpZGUgaW1hZ2UgY29udGFpbmVyXG5cbiAgICAgICAgICB0aGlzLmVsZW1lbnRzLnRodW1iLnRpbWUuaW5uZXJUZXh0ID0gZm9ybWF0VGltZSh0aGlzLnNlZWtUaW1lKTsgLy8gR2V0IG1hcmtlciBwb2ludCBmb3IgdGltZVxuXG4gICAgICAgICAgY29uc3QgcG9pbnQgPSAoX3RoaXMkcGxheWVyJGNvbmZpZyRtID0gdGhpcy5wbGF5ZXIuY29uZmlnLm1hcmtlcnMpID09PSBudWxsIHx8IF90aGlzJHBsYXllciRjb25maWckbSA9PT0gdm9pZCAwID8gdm9pZCAwIDogKF90aGlzJHBsYXllciRjb25maWckbTIgPSBfdGhpcyRwbGF5ZXIkY29uZmlnJG0ucG9pbnRzKSA9PT0gbnVsbCB8fCBfdGhpcyRwbGF5ZXIkY29uZmlnJG0yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfdGhpcyRwbGF5ZXIkY29uZmlnJG0yLmZpbmQoKHtcbiAgICAgICAgICAgIHRpbWU6IHRcbiAgICAgICAgICB9KSA9PiB0ID09PSBNYXRoLnJvdW5kKHRoaXMuc2Vla1RpbWUpKTsgLy8gQXBwZW5kIHRoZSBwb2ludCBsYWJlbCB0byB0aGUgdG9vbHRpcFxuXG4gICAgICAgICAgaWYgKHBvaW50KSB7XG4gICAgICAgICAgICAvLyB0aGlzLmVsZW1lbnRzLnRodW1iLnRpbWUuaW5uZXJUZXh0LmNvbmNhdCgnXFxuJyk7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnRzLnRodW1iLnRpbWUuaW5zZXJ0QWRqYWNlbnRIVE1MKCdhZnRlcmJlZ2luJywgYCR7cG9pbnQubGFiZWx9PGJyPmApO1xuICAgICAgICAgIH1cbiAgICAgICAgfSAvLyBEb3dubG9hZCBhbmQgc2hvdyBpbWFnZVxuXG5cbiAgICAgICAgdGhpcy5zaG93SW1hZ2VBdEN1cnJlbnRUaW1lKCk7XG4gICAgICB9KTtcblxuICAgICAgX2RlZmluZVByb3BlcnR5JDEodGhpcywgXCJlbmRNb3ZlXCIsICgpID0+IHtcbiAgICAgICAgdGhpcy50b2dnbGVUaHVtYkNvbnRhaW5lcihmYWxzZSwgdHJ1ZSk7XG4gICAgICB9KTtcblxuICAgICAgX2RlZmluZVByb3BlcnR5JDEodGhpcywgXCJzdGFydFNjcnViYmluZ1wiLCBldmVudCA9PiB7XG4gICAgICAgIC8vIE9ubHkgYWN0IG9uIGxlZnQgbW91c2UgYnV0dG9uICgwKSwgb3IgdG91Y2ggZGV2aWNlIChldmVudC5idXR0b24gZG9lcyBub3QgZXhpc3Qgb3IgaXMgZmFsc2UpXG4gICAgICAgIGlmIChpcy5udWxsT3JVbmRlZmluZWQoZXZlbnQuYnV0dG9uKSB8fCBldmVudC5idXR0b24gPT09IGZhbHNlIHx8IGV2ZW50LmJ1dHRvbiA9PT0gMCkge1xuICAgICAgICAgIHRoaXMubW91c2VEb3duID0gdHJ1ZTsgLy8gV2FpdCB1bnRpbCBtZWRpYSBoYXMgYSBkdXJhdGlvblxuXG4gICAgICAgICAgaWYgKHRoaXMucGxheWVyLm1lZGlhLmR1cmF0aW9uKSB7XG4gICAgICAgICAgICB0aGlzLnRvZ2dsZVNjcnViYmluZ0NvbnRhaW5lcih0cnVlKTtcbiAgICAgICAgICAgIHRoaXMudG9nZ2xlVGh1bWJDb250YWluZXIoZmFsc2UsIHRydWUpOyAvLyBEb3dubG9hZCBhbmQgc2hvdyBpbWFnZVxuXG4gICAgICAgICAgICB0aGlzLnNob3dJbWFnZUF0Q3VycmVudFRpbWUoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICBfZGVmaW5lUHJvcGVydHkkMSh0aGlzLCBcImVuZFNjcnViYmluZ1wiLCAoKSA9PiB7XG4gICAgICAgIHRoaXMubW91c2VEb3duID0gZmFsc2U7IC8vIEhpZGUgc2NydWJiaW5nIHByZXZpZXcuIEJ1dCB3YWl0IHVudGlsIHRoZSB2aWRlbyBoYXMgc3VjY2Vzc2Z1bGx5IHNlZWtlZCBiZWZvcmUgaGlkaW5nIHRoZSBzY3J1YmJpbmcgcHJldmlld1xuXG4gICAgICAgIGlmIChNYXRoLmNlaWwodGhpcy5sYXN0VGltZSkgPT09IE1hdGguY2VpbCh0aGlzLnBsYXllci5tZWRpYS5jdXJyZW50VGltZSkpIHtcbiAgICAgICAgICAvLyBUaGUgdmlkZW8gd2FzIGFscmVhZHkgc2Vla2VkL2xvYWRlZCBhdCB0aGUgY2hvc2VuIHRpbWUgLSBoaWRlIGltbWVkaWF0ZWx5XG4gICAgICAgICAgdGhpcy50b2dnbGVTY3J1YmJpbmdDb250YWluZXIoZmFsc2UpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIFRoZSB2aWRlbyBoYXNuJ3Qgc2Vla2VkIHlldC4gV2FpdCBmb3IgdGhhdFxuICAgICAgICAgIG9uY2UuY2FsbCh0aGlzLnBsYXllciwgdGhpcy5wbGF5ZXIubWVkaWEsICd0aW1ldXBkYXRlJywgKCkgPT4ge1xuICAgICAgICAgICAgLy8gUmUtY2hlY2sgbW91c2Vkb3duIC0gd2UgbWlnaHQgaGF2ZSBhbHJlYWR5IHN0YXJ0ZWQgc2NydWJiaW5nIGFnYWluXG4gICAgICAgICAgICBpZiAoIXRoaXMubW91c2VEb3duKSB7XG4gICAgICAgICAgICAgIHRoaXMudG9nZ2xlU2NydWJiaW5nQ29udGFpbmVyKGZhbHNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIF9kZWZpbmVQcm9wZXJ0eSQxKHRoaXMsIFwibGlzdGVuZXJzXCIsICgpID0+IHtcbiAgICAgICAgLy8gSGlkZSB0aHVtYm5haWwgcHJldmlldyAtIG9uIG1vdXNlIGNsaWNrLCBtb3VzZSBsZWF2ZSAoaW4gbGlzdGVuZXJzLmpzIGZvciBub3cpLCBhbmQgdmlkZW8gcGxheS9zZWVrLiBBbGwgZm91ciBhcmUgcmVxdWlyZWQsIGUuZy4sIGZvciBidWZmZXJpbmdcbiAgICAgICAgdGhpcy5wbGF5ZXIub24oJ3BsYXknLCAoKSA9PiB7XG4gICAgICAgICAgdGhpcy50b2dnbGVUaHVtYkNvbnRhaW5lcihmYWxzZSwgdHJ1ZSk7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnBsYXllci5vbignc2Vla2VkJywgKCkgPT4ge1xuICAgICAgICAgIHRoaXMudG9nZ2xlVGh1bWJDb250YWluZXIoZmFsc2UpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5wbGF5ZXIub24oJ3RpbWV1cGRhdGUnLCAoKSA9PiB7XG4gICAgICAgICAgdGhpcy5sYXN0VGltZSA9IHRoaXMucGxheWVyLm1lZGlhLmN1cnJlbnRUaW1lO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICBfZGVmaW5lUHJvcGVydHkkMSh0aGlzLCBcInJlbmRlclwiLCAoKSA9PiB7XG4gICAgICAgIC8vIENyZWF0ZSBIVE1MIGVsZW1lbnQ6IHBseXJfX3ByZXZpZXctdGh1bWJuYWlsLWNvbnRhaW5lclxuICAgICAgICB0aGlzLmVsZW1lbnRzLnRodW1iLmNvbnRhaW5lciA9IGNyZWF0ZUVsZW1lbnQoJ2RpdicsIHtcbiAgICAgICAgICBjbGFzczogdGhpcy5wbGF5ZXIuY29uZmlnLmNsYXNzTmFtZXMucHJldmlld1RodW1ibmFpbHMudGh1bWJDb250YWluZXJcbiAgICAgICAgfSk7IC8vIFdyYXBwZXIgZm9yIHRoZSBpbWFnZSBmb3Igc3R5bGluZ1xuXG4gICAgICAgIHRoaXMuZWxlbWVudHMudGh1bWIuaW1hZ2VDb250YWluZXIgPSBjcmVhdGVFbGVtZW50KCdkaXYnLCB7XG4gICAgICAgICAgY2xhc3M6IHRoaXMucGxheWVyLmNvbmZpZy5jbGFzc05hbWVzLnByZXZpZXdUaHVtYm5haWxzLmltYWdlQ29udGFpbmVyXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmVsZW1lbnRzLnRodW1iLmNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLmVsZW1lbnRzLnRodW1iLmltYWdlQ29udGFpbmVyKTsgLy8gQ3JlYXRlIEhUTUwgZWxlbWVudCwgcGFyZW50K3NwYW46IHRpbWUgdGV4dCAoZS5nLiwgMDE6MzI6MDApXG5cbiAgICAgICAgY29uc3QgdGltZUNvbnRhaW5lciA9IGNyZWF0ZUVsZW1lbnQoJ2RpdicsIHtcbiAgICAgICAgICBjbGFzczogdGhpcy5wbGF5ZXIuY29uZmlnLmNsYXNzTmFtZXMucHJldmlld1RodW1ibmFpbHMudGltZUNvbnRhaW5lclxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5lbGVtZW50cy50aHVtYi50aW1lID0gY3JlYXRlRWxlbWVudCgnc3BhbicsIHt9LCAnMDA6MDAnKTtcbiAgICAgICAgdGltZUNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLmVsZW1lbnRzLnRodW1iLnRpbWUpO1xuICAgICAgICB0aGlzLmVsZW1lbnRzLnRodW1iLmltYWdlQ29udGFpbmVyLmFwcGVuZENoaWxkKHRpbWVDb250YWluZXIpOyAvLyBJbmplY3QgdGhlIHdob2xlIHRodW1iXG5cbiAgICAgICAgaWYgKGlzLmVsZW1lbnQodGhpcy5wbGF5ZXIuZWxlbWVudHMucHJvZ3Jlc3MpKSB7XG4gICAgICAgICAgdGhpcy5wbGF5ZXIuZWxlbWVudHMucHJvZ3Jlc3MuYXBwZW5kQ2hpbGQodGhpcy5lbGVtZW50cy50aHVtYi5jb250YWluZXIpO1xuICAgICAgICB9IC8vIENyZWF0ZSBIVE1MIGVsZW1lbnQ6IHBseXJfX3ByZXZpZXctc2NydWJiaW5nLWNvbnRhaW5lclxuXG5cbiAgICAgICAgdGhpcy5lbGVtZW50cy5zY3J1YmJpbmcuY29udGFpbmVyID0gY3JlYXRlRWxlbWVudCgnZGl2Jywge1xuICAgICAgICAgIGNsYXNzOiB0aGlzLnBsYXllci5jb25maWcuY2xhc3NOYW1lcy5wcmV2aWV3VGh1bWJuYWlscy5zY3J1YmJpbmdDb250YWluZXJcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucGxheWVyLmVsZW1lbnRzLndyYXBwZXIuYXBwZW5kQ2hpbGQodGhpcy5lbGVtZW50cy5zY3J1YmJpbmcuY29udGFpbmVyKTtcbiAgICAgIH0pO1xuXG4gICAgICBfZGVmaW5lUHJvcGVydHkkMSh0aGlzLCBcImRlc3Ryb3lcIiwgKCkgPT4ge1xuICAgICAgICBpZiAodGhpcy5lbGVtZW50cy50aHVtYi5jb250YWluZXIpIHtcbiAgICAgICAgICB0aGlzLmVsZW1lbnRzLnRodW1iLmNvbnRhaW5lci5yZW1vdmUoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmVsZW1lbnRzLnNjcnViYmluZy5jb250YWluZXIpIHtcbiAgICAgICAgICB0aGlzLmVsZW1lbnRzLnNjcnViYmluZy5jb250YWluZXIucmVtb3ZlKCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICBfZGVmaW5lUHJvcGVydHkkMSh0aGlzLCBcInNob3dJbWFnZUF0Q3VycmVudFRpbWVcIiwgKCkgPT4ge1xuICAgICAgICBpZiAodGhpcy5tb3VzZURvd24pIHtcbiAgICAgICAgICB0aGlzLnNldFNjcnViYmluZ0NvbnRhaW5lclNpemUoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLnNldFRodW1iQ29udGFpbmVyU2l6ZUFuZFBvcygpO1xuICAgICAgICB9IC8vIEZpbmQgdGhlIGRlc2lyZWQgdGh1bWJuYWlsIGluZGV4XG4gICAgICAgIC8vIFRPRE86IEhhbmRsZSBhIHZpZGVvIGxvbmdlciB0aGFuIHRoZSB0aHVtYnMgd2hlcmUgdGh1bWJOdW0gaXMgbnVsbFxuXG5cbiAgICAgICAgY29uc3QgdGh1bWJOdW0gPSB0aGlzLnRodW1ibmFpbHNbMF0uZnJhbWVzLmZpbmRJbmRleChmcmFtZSA9PiB0aGlzLnNlZWtUaW1lID49IGZyYW1lLnN0YXJ0VGltZSAmJiB0aGlzLnNlZWtUaW1lIDw9IGZyYW1lLmVuZFRpbWUpO1xuICAgICAgICBjb25zdCBoYXNUaHVtYiA9IHRodW1iTnVtID49IDA7XG4gICAgICAgIGxldCBxdWFsaXR5SW5kZXggPSAwOyAvLyBTaG93IHRoZSB0aHVtYiBjb250YWluZXIgaWYgd2UncmUgbm90IHNjcnViYmluZ1xuXG4gICAgICAgIGlmICghdGhpcy5tb3VzZURvd24pIHtcbiAgICAgICAgICB0aGlzLnRvZ2dsZVRodW1iQ29udGFpbmVyKGhhc1RodW1iKTtcbiAgICAgICAgfSAvLyBObyBtYXRjaGluZyB0aHVtYiBmb3VuZFxuXG5cbiAgICAgICAgaWYgKCFoYXNUaHVtYikge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfSAvLyBDaGVjayB0byBzZWUgaWYgd2UndmUgYWxyZWFkeSBkb3dubG9hZGVkIGhpZ2hlciBxdWFsaXR5IHZlcnNpb25zIG9mIHRoaXMgaW1hZ2VcblxuXG4gICAgICAgIHRoaXMudGh1bWJuYWlscy5mb3JFYWNoKCh0aHVtYm5haWwsIGluZGV4KSA9PiB7XG4gICAgICAgICAgaWYgKHRoaXMubG9hZGVkSW1hZ2VzLmluY2x1ZGVzKHRodW1ibmFpbC5mcmFtZXNbdGh1bWJOdW1dLnRleHQpKSB7XG4gICAgICAgICAgICBxdWFsaXR5SW5kZXggPSBpbmRleDtcbiAgICAgICAgICB9XG4gICAgICAgIH0pOyAvLyBPbmx5IHByb2NlZWQgaWYgZWl0aGVyIHRodW1iIG51bSBvciB0aHVtYmZpbGVuYW1lIGhhcyBjaGFuZ2VkXG5cbiAgICAgICAgaWYgKHRodW1iTnVtICE9PSB0aGlzLnNob3dpbmdUaHVtYikge1xuICAgICAgICAgIHRoaXMuc2hvd2luZ1RodW1iID0gdGh1bWJOdW07XG4gICAgICAgICAgdGhpcy5sb2FkSW1hZ2UocXVhbGl0eUluZGV4KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIF9kZWZpbmVQcm9wZXJ0eSQxKHRoaXMsIFwibG9hZEltYWdlXCIsIChxdWFsaXR5SW5kZXggPSAwKSA9PiB7XG4gICAgICAgIGNvbnN0IHRodW1iTnVtID0gdGhpcy5zaG93aW5nVGh1bWI7XG4gICAgICAgIGNvbnN0IHRodW1ibmFpbCA9IHRoaXMudGh1bWJuYWlsc1txdWFsaXR5SW5kZXhdO1xuICAgICAgICBjb25zdCB7XG4gICAgICAgICAgdXJsUHJlZml4XG4gICAgICAgIH0gPSB0aHVtYm5haWw7XG4gICAgICAgIGNvbnN0IGZyYW1lID0gdGh1bWJuYWlsLmZyYW1lc1t0aHVtYk51bV07XG4gICAgICAgIGNvbnN0IHRodW1iRmlsZW5hbWUgPSB0aHVtYm5haWwuZnJhbWVzW3RodW1iTnVtXS50ZXh0O1xuICAgICAgICBjb25zdCB0aHVtYlVybCA9IHVybFByZWZpeCArIHRodW1iRmlsZW5hbWU7XG5cbiAgICAgICAgaWYgKCF0aGlzLmN1cnJlbnRJbWFnZUVsZW1lbnQgfHwgdGhpcy5jdXJyZW50SW1hZ2VFbGVtZW50LmRhdGFzZXQuZmlsZW5hbWUgIT09IHRodW1iRmlsZW5hbWUpIHtcbiAgICAgICAgICAvLyBJZiB3ZSdyZSBhbHJlYWR5IGxvYWRpbmcgYSBwcmV2aW91cyBpbWFnZSwgcmVtb3ZlIGl0cyBvbmxvYWQgaGFuZGxlciAtIHdlIGRvbid0IHdhbnQgaXQgdG8gbG9hZCBhZnRlciB0aGlzIG9uZVxuICAgICAgICAgIC8vIE9ubHkgZG8gdGhpcyBpZiBub3QgdXNpbmcgc3ByaXRlcy4gV2l0aG91dCBzcHJpdGVzIHdlIHJlYWxseSB3YW50IHRvIHNob3cgYXMgbWFueSBpbWFnZXMgYXMgcG9zc2libGUsIGFzIGEgYmVzdC1lZmZvcnRcbiAgICAgICAgICBpZiAodGhpcy5sb2FkaW5nSW1hZ2UgJiYgdGhpcy51c2luZ1Nwcml0ZXMpIHtcbiAgICAgICAgICAgIHRoaXMubG9hZGluZ0ltYWdlLm9ubG9hZCA9IG51bGw7XG4gICAgICAgICAgfSAvLyBXZSdyZSBidWlsZGluZyBhbmQgYWRkaW5nIGEgbmV3IGltYWdlLiBJbiBvdGhlciBpbXBsZW1lbnRhdGlvbnMgb2Ygc2ltaWxhciBmdW5jdGlvbmFsaXR5IChZb3VUdWJlKSwgYmFja2dyb3VuZCBpbWFnZVxuICAgICAgICAgIC8vIGlzIGluc3RlYWQgdXNlZC4gQnV0IHRoaXMgY2F1c2VzIGlzc3VlcyB3aXRoIGxhcmdlciBpbWFnZXMgaW4gRmlyZWZveCBhbmQgU2FmYXJpIC0gc3dpdGNoaW5nIGJldHdlZW4gYmFja2dyb3VuZFxuICAgICAgICAgIC8vIGltYWdlcyBjYXVzZXMgYSBmbGlja2VyLiBQdXR0aW5nIGEgbmV3IGltYWdlIG92ZXIgdGhlIHRvcCBkb2VzIG5vdFxuXG5cbiAgICAgICAgICBjb25zdCBwcmV2aWV3SW1hZ2UgPSBuZXcgSW1hZ2UoKTtcbiAgICAgICAgICBwcmV2aWV3SW1hZ2Uuc3JjID0gdGh1bWJVcmw7XG4gICAgICAgICAgcHJldmlld0ltYWdlLmRhdGFzZXQuaW5kZXggPSB0aHVtYk51bTtcbiAgICAgICAgICBwcmV2aWV3SW1hZ2UuZGF0YXNldC5maWxlbmFtZSA9IHRodW1iRmlsZW5hbWU7XG4gICAgICAgICAgdGhpcy5zaG93aW5nVGh1bWJGaWxlbmFtZSA9IHRodW1iRmlsZW5hbWU7XG4gICAgICAgICAgdGhpcy5wbGF5ZXIuZGVidWcubG9nKGBMb2FkaW5nIGltYWdlOiAke3RodW1iVXJsfWApOyAvLyBGb3Igc29tZSByZWFzb24sIHBhc3NpbmcgdGhlIG5hbWVkIGZ1bmN0aW9uIGRpcmVjdGx5IGNhdXNlcyBpdCB0byBleGVjdXRlIGltbWVkaWF0ZWx5LiBTbyBJJ3ZlIHdyYXBwZWQgaXQgaW4gYW4gYW5vbnltb3VzIGZ1bmN0aW9uLi4uXG5cbiAgICAgICAgICBwcmV2aWV3SW1hZ2Uub25sb2FkID0gKCkgPT4gdGhpcy5zaG93SW1hZ2UocHJldmlld0ltYWdlLCBmcmFtZSwgcXVhbGl0eUluZGV4LCB0aHVtYk51bSwgdGh1bWJGaWxlbmFtZSwgdHJ1ZSk7XG5cbiAgICAgICAgICB0aGlzLmxvYWRpbmdJbWFnZSA9IHByZXZpZXdJbWFnZTtcbiAgICAgICAgICB0aGlzLnJlbW92ZU9sZEltYWdlcyhwcmV2aWV3SW1hZ2UpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgZXhpc3RpbmcgaW1hZ2VcbiAgICAgICAgICB0aGlzLnNob3dJbWFnZSh0aGlzLmN1cnJlbnRJbWFnZUVsZW1lbnQsIGZyYW1lLCBxdWFsaXR5SW5kZXgsIHRodW1iTnVtLCB0aHVtYkZpbGVuYW1lLCBmYWxzZSk7XG4gICAgICAgICAgdGhpcy5jdXJyZW50SW1hZ2VFbGVtZW50LmRhdGFzZXQuaW5kZXggPSB0aHVtYk51bTtcbiAgICAgICAgICB0aGlzLnJlbW92ZU9sZEltYWdlcyh0aGlzLmN1cnJlbnRJbWFnZUVsZW1lbnQpO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgX2RlZmluZVByb3BlcnR5JDEodGhpcywgXCJzaG93SW1hZ2VcIiwgKHByZXZpZXdJbWFnZSwgZnJhbWUsIHF1YWxpdHlJbmRleCwgdGh1bWJOdW0sIHRodW1iRmlsZW5hbWUsIG5ld0ltYWdlID0gdHJ1ZSkgPT4ge1xuICAgICAgICB0aGlzLnBsYXllci5kZWJ1Zy5sb2coYFNob3dpbmcgdGh1bWI6ICR7dGh1bWJGaWxlbmFtZX0uIG51bTogJHt0aHVtYk51bX0uIHF1YWw6ICR7cXVhbGl0eUluZGV4fS4gbmV3aW1nOiAke25ld0ltYWdlfWApO1xuICAgICAgICB0aGlzLnNldEltYWdlU2l6ZUFuZE9mZnNldChwcmV2aWV3SW1hZ2UsIGZyYW1lKTtcblxuICAgICAgICBpZiAobmV3SW1hZ2UpIHtcbiAgICAgICAgICB0aGlzLmN1cnJlbnRJbWFnZUNvbnRhaW5lci5hcHBlbmRDaGlsZChwcmV2aWV3SW1hZ2UpO1xuICAgICAgICAgIHRoaXMuY3VycmVudEltYWdlRWxlbWVudCA9IHByZXZpZXdJbWFnZTtcblxuICAgICAgICAgIGlmICghdGhpcy5sb2FkZWRJbWFnZXMuaW5jbHVkZXModGh1bWJGaWxlbmFtZSkpIHtcbiAgICAgICAgICAgIHRoaXMubG9hZGVkSW1hZ2VzLnB1c2godGh1bWJGaWxlbmFtZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9IC8vIFByZWxvYWQgaW1hZ2VzIGJlZm9yZSBhbmQgYWZ0ZXIgdGhlIGN1cnJlbnQgb25lXG4gICAgICAgIC8vIFNob3cgaGlnaGVyIHF1YWxpdHkgb2YgdGhlIHNhbWUgZnJhbWVcbiAgICAgICAgLy8gRWFjaCBzdGVwIGhlcmUgaGFzIGEgc2hvcnQgdGltZSBkZWxheSwgYW5kIG9ubHkgY29udGludWVzIGlmIHN0aWxsIGhvdmVyaW5nL3NlZWtpbmcgdGhlIHNhbWUgc3BvdC4gVGhpcyBpcyB0byBwcm90ZWN0IHNsb3cgY29ubmVjdGlvbnMgZnJvbSBvdmVybG9hZGluZ1xuXG5cbiAgICAgICAgdGhpcy5wcmVsb2FkTmVhcmJ5KHRodW1iTnVtLCB0cnVlKS50aGVuKHRoaXMucHJlbG9hZE5lYXJieSh0aHVtYk51bSwgZmFsc2UpKS50aGVuKHRoaXMuZ2V0SGlnaGVyUXVhbGl0eShxdWFsaXR5SW5kZXgsIHByZXZpZXdJbWFnZSwgZnJhbWUsIHRodW1iRmlsZW5hbWUpKTtcbiAgICAgIH0pO1xuXG4gICAgICBfZGVmaW5lUHJvcGVydHkkMSh0aGlzLCBcInJlbW92ZU9sZEltYWdlc1wiLCBjdXJyZW50SW1hZ2UgPT4ge1xuICAgICAgICAvLyBHZXQgYSBsaXN0IG9mIGFsbCBpbWFnZXMsIGNvbnZlcnQgaXQgZnJvbSBhIERPTSBsaXN0IHRvIGFuIGFycmF5XG4gICAgICAgIEFycmF5LmZyb20odGhpcy5jdXJyZW50SW1hZ2VDb250YWluZXIuY2hpbGRyZW4pLmZvckVhY2goaW1hZ2UgPT4ge1xuICAgICAgICAgIGlmIChpbWFnZS50YWdOYW1lLnRvTG93ZXJDYXNlKCkgIT09ICdpbWcnKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgY29uc3QgcmVtb3ZlRGVsYXkgPSB0aGlzLnVzaW5nU3ByaXRlcyA/IDUwMCA6IDEwMDA7XG5cbiAgICAgICAgICBpZiAoaW1hZ2UuZGF0YXNldC5pbmRleCAhPT0gY3VycmVudEltYWdlLmRhdGFzZXQuaW5kZXggJiYgIWltYWdlLmRhdGFzZXQuZGVsZXRpbmcpIHtcbiAgICAgICAgICAgIC8vIFdhaXQgMjAwbXMsIGFzIHRoZSBuZXcgaW1hZ2UgY2FuIHRha2Ugc29tZSB0aW1lIHRvIHNob3cgb24gY2VydGFpbiBicm93c2VycyAoZXZlbiB0aG91Z2ggaXQgd2FzIGRvd25sb2FkZWQgYmVmb3JlIHNob3dpbmcpLiBUaGlzIHdpbGwgcHJldmVudCBmbGlja2VyLCBhbmQgc2hvdyBzb21lIGdlbmVyb3NpdHkgdG93YXJkcyBzbG93ZXIgY2xpZW50c1xuICAgICAgICAgICAgLy8gRmlyc3Qgc2V0IGF0dHJpYnV0ZSAnZGVsZXRpbmcnIHRvIHByZXZlbnQgbXVsdGktaGFuZGxpbmcgb2YgdGhpcyBvbiByZXBlYXQgZmlyaW5nIG9mIHRoaXMgZnVuY3Rpb25cbiAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1wYXJhbS1yZWFzc2lnblxuICAgICAgICAgICAgaW1hZ2UuZGF0YXNldC5kZWxldGluZyA9IHRydWU7IC8vIFRoaXMgaGFzIHRvIGJlIHNldCBiZWZvcmUgdGhlIHRpbWVvdXQgLSB0byBwcmV2ZW50IGlzc3VlcyBzd2l0Y2hpbmcgYmV0d2VlbiBob3ZlciBhbmQgc2NydWJcblxuICAgICAgICAgICAgY29uc3Qge1xuICAgICAgICAgICAgICBjdXJyZW50SW1hZ2VDb250YWluZXJcbiAgICAgICAgICAgIH0gPSB0aGlzO1xuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgIGN1cnJlbnRJbWFnZUNvbnRhaW5lci5yZW1vdmVDaGlsZChpbWFnZSk7XG4gICAgICAgICAgICAgIHRoaXMucGxheWVyLmRlYnVnLmxvZyhgUmVtb3ZpbmcgdGh1bWI6ICR7aW1hZ2UuZGF0YXNldC5maWxlbmFtZX1gKTtcbiAgICAgICAgICAgIH0sIHJlbW92ZURlbGF5KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAgIF9kZWZpbmVQcm9wZXJ0eSQxKHRoaXMsIFwicHJlbG9hZE5lYXJieVwiLCAodGh1bWJOdW0sIGZvcndhcmQgPSB0cnVlKSA9PiB7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcbiAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG9sZFRodW1iRmlsZW5hbWUgPSB0aGlzLnRodW1ibmFpbHNbMF0uZnJhbWVzW3RodW1iTnVtXS50ZXh0O1xuXG4gICAgICAgICAgICBpZiAodGhpcy5zaG93aW5nVGh1bWJGaWxlbmFtZSA9PT0gb2xkVGh1bWJGaWxlbmFtZSkge1xuICAgICAgICAgICAgICAvLyBGaW5kIHRoZSBuZWFyZXN0IHRodW1icyB3aXRoIGRpZmZlcmVudCBmaWxlbmFtZXMuIFNvbWV0aW1lcyBpdCdsbCBiZSB0aGUgbmV4dCBpbmRleCwgYnV0IGluIHRoZSBjYXNlIG9mIHNwcml0ZXMsIGl0IG1pZ2h0IGJlIDEwMCsgYXdheVxuICAgICAgICAgICAgICBsZXQgdGh1bWJuYWlsc0Nsb25lO1xuXG4gICAgICAgICAgICAgIGlmIChmb3J3YXJkKSB7XG4gICAgICAgICAgICAgICAgdGh1bWJuYWlsc0Nsb25lID0gdGhpcy50aHVtYm5haWxzWzBdLmZyYW1lcy5zbGljZSh0aHVtYk51bSk7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGh1bWJuYWlsc0Nsb25lID0gdGhpcy50aHVtYm5haWxzWzBdLmZyYW1lcy5zbGljZSgwLCB0aHVtYk51bSkucmV2ZXJzZSgpO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgbGV0IGZvdW5kT25lID0gZmFsc2U7XG4gICAgICAgICAgICAgIHRodW1ibmFpbHNDbG9uZS5mb3JFYWNoKGZyYW1lID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdUaHVtYkZpbGVuYW1lID0gZnJhbWUudGV4dDtcblxuICAgICAgICAgICAgICAgIGlmIChuZXdUaHVtYkZpbGVuYW1lICE9PSBvbGRUaHVtYkZpbGVuYW1lKSB7XG4gICAgICAgICAgICAgICAgICAvLyBGb3VuZCBvbmUgd2l0aCBhIGRpZmZlcmVudCBmaWxlbmFtZS4gTWFrZSBzdXJlIGl0IGhhc24ndCBhbHJlYWR5IGJlZW4gbG9hZGVkIG9uIHRoaXMgcGFnZSB2aXNpdFxuICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLmxvYWRlZEltYWdlcy5pbmNsdWRlcyhuZXdUaHVtYkZpbGVuYW1lKSkge1xuICAgICAgICAgICAgICAgICAgICBmb3VuZE9uZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGxheWVyLmRlYnVnLmxvZyhgUHJlbG9hZGluZyB0aHVtYiBmaWxlbmFtZTogJHtuZXdUaHVtYkZpbGVuYW1lfWApO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB7XG4gICAgICAgICAgICAgICAgICAgICAgdXJsUHJlZml4XG4gICAgICAgICAgICAgICAgICAgIH0gPSB0aGlzLnRodW1ibmFpbHNbMF07XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHRodW1iVVJMID0gdXJsUHJlZml4ICsgbmV3VGh1bWJGaWxlbmFtZTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJldmlld0ltYWdlID0gbmV3IEltYWdlKCk7XG4gICAgICAgICAgICAgICAgICAgIHByZXZpZXdJbWFnZS5zcmMgPSB0aHVtYlVSTDtcblxuICAgICAgICAgICAgICAgICAgICBwcmV2aWV3SW1hZ2Uub25sb2FkID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGxheWVyLmRlYnVnLmxvZyhgUHJlbG9hZGVkIHRodW1iIGZpbGVuYW1lOiAke25ld1RodW1iRmlsZW5hbWV9YCk7XG4gICAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLmxvYWRlZEltYWdlcy5pbmNsdWRlcyhuZXdUaHVtYkZpbGVuYW1lKSkgdGhpcy5sb2FkZWRJbWFnZXMucHVzaChuZXdUaHVtYkZpbGVuYW1lKTsgLy8gV2UgZG9uJ3QgcmVzb2x2ZSB1bnRpbCB0aGUgdGh1bWIgaXMgbG9hZGVkXG5cbiAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9KTsgLy8gSWYgdGhlcmUgYXJlIG5vbmUgdG8gcHJlbG9hZCB0aGVuIHdlIHdhbnQgdG8gcmVzb2x2ZSBpbW1lZGlhdGVseVxuXG4gICAgICAgICAgICAgIGlmICghZm91bmRPbmUpIHtcbiAgICAgICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LCAzMDApO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICBfZGVmaW5lUHJvcGVydHkkMSh0aGlzLCBcImdldEhpZ2hlclF1YWxpdHlcIiwgKGN1cnJlbnRRdWFsaXR5SW5kZXgsIHByZXZpZXdJbWFnZSwgZnJhbWUsIHRodW1iRmlsZW5hbWUpID0+IHtcbiAgICAgICAgaWYgKGN1cnJlbnRRdWFsaXR5SW5kZXggPCB0aGlzLnRodW1ibmFpbHMubGVuZ3RoIC0gMSkge1xuICAgICAgICAgIC8vIE9ubHkgdXNlIHRoZSBoaWdoZXIgcXVhbGl0eSB2ZXJzaW9uIGlmIGl0J3MgZ29pbmcgdG8gbG9vayBhbnkgYmV0dGVyIC0gaWYgdGhlIGN1cnJlbnQgdGh1bWIgaXMgb2YgYSBsb3dlciBwaXhlbCBkZW5zaXR5IHRoYW4gdGhlIHRodW1ibmFpbCBjb250YWluZXJcbiAgICAgICAgICBsZXQgcHJldmlld0ltYWdlSGVpZ2h0ID0gcHJldmlld0ltYWdlLm5hdHVyYWxIZWlnaHQ7XG5cbiAgICAgICAgICBpZiAodGhpcy51c2luZ1Nwcml0ZXMpIHtcbiAgICAgICAgICAgIHByZXZpZXdJbWFnZUhlaWdodCA9IGZyYW1lLmg7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKHByZXZpZXdJbWFnZUhlaWdodCA8IHRoaXMudGh1bWJDb250YWluZXJIZWlnaHQpIHtcbiAgICAgICAgICAgIC8vIFJlY3Vyc2UgYmFjayB0byB0aGUgbG9hZEltYWdlIGZ1bmN0aW9uIC0gc2hvdyBhIGhpZ2hlciBxdWFsaXR5IG9uZSwgYnV0IG9ubHkgaWYgdGhlIHZpZXdlciBpcyBvbiB0aGlzIGZyYW1lIGZvciBhIHdoaWxlXG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgLy8gTWFrZSBzdXJlIHRoZSBtb3VzZSBoYXNuJ3QgYWxyZWFkeSBtb3ZlZCBvbiBhbmQgc3RhcnRlZCBob3ZlcmluZyBhdCBhbm90aGVyIGltYWdlXG4gICAgICAgICAgICAgIGlmICh0aGlzLnNob3dpbmdUaHVtYkZpbGVuYW1lID09PSB0aHVtYkZpbGVuYW1lKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5wbGF5ZXIuZGVidWcubG9nKGBTaG93aW5nIGhpZ2hlciBxdWFsaXR5IHRodW1iIGZvcjogJHt0aHVtYkZpbGVuYW1lfWApO1xuICAgICAgICAgICAgICAgIHRoaXMubG9hZEltYWdlKGN1cnJlbnRRdWFsaXR5SW5kZXggKyAxKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgMzAwKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICBfZGVmaW5lUHJvcGVydHkkMSh0aGlzLCBcInRvZ2dsZVRodW1iQ29udGFpbmVyXCIsICh0b2dnbGUgPSBmYWxzZSwgY2xlYXJTaG93aW5nID0gZmFsc2UpID0+IHtcbiAgICAgICAgY29uc3QgY2xhc3NOYW1lID0gdGhpcy5wbGF5ZXIuY29uZmlnLmNsYXNzTmFtZXMucHJldmlld1RodW1ibmFpbHMudGh1bWJDb250YWluZXJTaG93bjtcbiAgICAgICAgdGhpcy5lbGVtZW50cy50aHVtYi5jb250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZShjbGFzc05hbWUsIHRvZ2dsZSk7XG5cbiAgICAgICAgaWYgKCF0b2dnbGUgJiYgY2xlYXJTaG93aW5nKSB7XG4gICAgICAgICAgdGhpcy5zaG93aW5nVGh1bWIgPSBudWxsO1xuICAgICAgICAgIHRoaXMuc2hvd2luZ1RodW1iRmlsZW5hbWUgPSBudWxsO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgX2RlZmluZVByb3BlcnR5JDEodGhpcywgXCJ0b2dnbGVTY3J1YmJpbmdDb250YWluZXJcIiwgKHRvZ2dsZSA9IGZhbHNlKSA9PiB7XG4gICAgICAgIGNvbnN0IGNsYXNzTmFtZSA9IHRoaXMucGxheWVyLmNvbmZpZy5jbGFzc05hbWVzLnByZXZpZXdUaHVtYm5haWxzLnNjcnViYmluZ0NvbnRhaW5lclNob3duO1xuICAgICAgICB0aGlzLmVsZW1lbnRzLnNjcnViYmluZy5jb250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZShjbGFzc05hbWUsIHRvZ2dsZSk7XG5cbiAgICAgICAgaWYgKCF0b2dnbGUpIHtcbiAgICAgICAgICB0aGlzLnNob3dpbmdUaHVtYiA9IG51bGw7XG4gICAgICAgICAgdGhpcy5zaG93aW5nVGh1bWJGaWxlbmFtZSA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICBfZGVmaW5lUHJvcGVydHkkMSh0aGlzLCBcImRldGVybWluZUNvbnRhaW5lckF1dG9TaXppbmdcIiwgKCkgPT4ge1xuICAgICAgICBpZiAodGhpcy5lbGVtZW50cy50aHVtYi5pbWFnZUNvbnRhaW5lci5jbGllbnRIZWlnaHQgPiAyMCB8fCB0aGlzLmVsZW1lbnRzLnRodW1iLmltYWdlQ29udGFpbmVyLmNsaWVudFdpZHRoID4gMjApIHtcbiAgICAgICAgICAvLyBUaGlzIHdpbGwgcHJldmVudCBhdXRvIHNpemluZyBpbiB0aGlzLnNldFRodW1iQ29udGFpbmVyU2l6ZUFuZFBvcygpXG4gICAgICAgICAgdGhpcy5zaXplU3BlY2lmaWVkSW5DU1MgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgX2RlZmluZVByb3BlcnR5JDEodGhpcywgXCJzZXRUaHVtYkNvbnRhaW5lclNpemVBbmRQb3NcIiwgKCkgPT4ge1xuICAgICAgICBjb25zdCB7XG4gICAgICAgICAgaW1hZ2VDb250YWluZXJcbiAgICAgICAgfSA9IHRoaXMuZWxlbWVudHMudGh1bWI7XG5cbiAgICAgICAgaWYgKCF0aGlzLnNpemVTcGVjaWZpZWRJbkNTUykge1xuICAgICAgICAgIGNvbnN0IHRodW1iV2lkdGggPSBNYXRoLmZsb29yKHRoaXMudGh1bWJDb250YWluZXJIZWlnaHQgKiB0aGlzLnRodW1iQXNwZWN0UmF0aW8pO1xuICAgICAgICAgIGltYWdlQ29udGFpbmVyLnN0eWxlLmhlaWdodCA9IGAke3RoaXMudGh1bWJDb250YWluZXJIZWlnaHR9cHhgO1xuICAgICAgICAgIGltYWdlQ29udGFpbmVyLnN0eWxlLndpZHRoID0gYCR7dGh1bWJXaWR0aH1weGA7XG4gICAgICAgIH0gZWxzZSBpZiAoaW1hZ2VDb250YWluZXIuY2xpZW50SGVpZ2h0ID4gMjAgJiYgaW1hZ2VDb250YWluZXIuY2xpZW50V2lkdGggPCAyMCkge1xuICAgICAgICAgIGNvbnN0IHRodW1iV2lkdGggPSBNYXRoLmZsb29yKGltYWdlQ29udGFpbmVyLmNsaWVudEhlaWdodCAqIHRoaXMudGh1bWJBc3BlY3RSYXRpbyk7XG4gICAgICAgICAgaW1hZ2VDb250YWluZXIuc3R5bGUud2lkdGggPSBgJHt0aHVtYldpZHRofXB4YDtcbiAgICAgICAgfSBlbHNlIGlmIChpbWFnZUNvbnRhaW5lci5jbGllbnRIZWlnaHQgPCAyMCAmJiBpbWFnZUNvbnRhaW5lci5jbGllbnRXaWR0aCA+IDIwKSB7XG4gICAgICAgICAgY29uc3QgdGh1bWJIZWlnaHQgPSBNYXRoLmZsb29yKGltYWdlQ29udGFpbmVyLmNsaWVudFdpZHRoIC8gdGhpcy50aHVtYkFzcGVjdFJhdGlvKTtcbiAgICAgICAgICBpbWFnZUNvbnRhaW5lci5zdHlsZS5oZWlnaHQgPSBgJHt0aHVtYkhlaWdodH1weGA7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnNldFRodW1iQ29udGFpbmVyUG9zKCk7XG4gICAgICB9KTtcblxuICAgICAgX2RlZmluZVByb3BlcnR5JDEodGhpcywgXCJzZXRUaHVtYkNvbnRhaW5lclBvc1wiLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHNjcnViYmVyUmVjdCA9IHRoaXMucGxheWVyLmVsZW1lbnRzLnByb2dyZXNzLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgICBjb25zdCBjb250YWluZXJSZWN0ID0gdGhpcy5wbGF5ZXIuZWxlbWVudHMuY29udGFpbmVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgICBjb25zdCB7XG4gICAgICAgICAgY29udGFpbmVyXG4gICAgICAgIH0gPSB0aGlzLmVsZW1lbnRzLnRodW1iOyAvLyBGaW5kIHRoZSBsb3dlc3QgYW5kIGhpZ2hlc3QgZGVzaXJlZCBsZWZ0LXBvc2l0aW9uLCBzbyB3ZSBkb24ndCBzbGlkZSBvdXQgdGhlIHNpZGUgb2YgdGhlIHZpZGVvIGNvbnRhaW5lclxuXG4gICAgICAgIGNvbnN0IG1pbiA9IGNvbnRhaW5lclJlY3QubGVmdCAtIHNjcnViYmVyUmVjdC5sZWZ0ICsgMTA7XG4gICAgICAgIGNvbnN0IG1heCA9IGNvbnRhaW5lclJlY3QucmlnaHQgLSBzY3J1YmJlclJlY3QubGVmdCAtIGNvbnRhaW5lci5jbGllbnRXaWR0aCAtIDEwOyAvLyBTZXQgcHJldmlldyBjb250YWluZXIgcG9zaXRpb24gdG86IG1vdXNlcG9zLCBtaW51cyBzZWVrYmFyLmxlZnQsIG1pbnVzIGhhbGYgb2YgcHJldmlld0NvbnRhaW5lci5jbGllbnRXaWR0aFxuXG4gICAgICAgIGNvbnN0IHBvc2l0aW9uID0gdGhpcy5tb3VzZVBvc1ggLSBzY3J1YmJlclJlY3QubGVmdCAtIGNvbnRhaW5lci5jbGllbnRXaWR0aCAvIDI7XG4gICAgICAgIGNvbnN0IGNsYW1wZWQgPSBjbGFtcChwb3NpdGlvbiwgbWluLCBtYXgpOyAvLyBNb3ZlIHRoZSBwb3BvdmVyIHBvc2l0aW9uXG5cbiAgICAgICAgY29udGFpbmVyLnN0eWxlLmxlZnQgPSBgJHtjbGFtcGVkfXB4YDsgLy8gVGhlIGFycm93IGNhbiBmb2xsb3cgdGhlIGN1cnNvclxuXG4gICAgICAgIGNvbnRhaW5lci5zdHlsZS5zZXRQcm9wZXJ0eSgnLS1wcmV2aWV3LWFycm93LW9mZnNldCcsIGAke3Bvc2l0aW9uIC0gY2xhbXBlZH1weGApO1xuICAgICAgfSk7XG5cbiAgICAgIF9kZWZpbmVQcm9wZXJ0eSQxKHRoaXMsIFwic2V0U2NydWJiaW5nQ29udGFpbmVyU2l6ZVwiLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHtcbiAgICAgICAgICB3aWR0aCxcbiAgICAgICAgICBoZWlnaHRcbiAgICAgICAgfSA9IGZpdFJhdGlvKHRoaXMudGh1bWJBc3BlY3RSYXRpbywge1xuICAgICAgICAgIHdpZHRoOiB0aGlzLnBsYXllci5tZWRpYS5jbGllbnRXaWR0aCxcbiAgICAgICAgICBoZWlnaHQ6IHRoaXMucGxheWVyLm1lZGlhLmNsaWVudEhlaWdodFxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5lbGVtZW50cy5zY3J1YmJpbmcuY29udGFpbmVyLnN0eWxlLndpZHRoID0gYCR7d2lkdGh9cHhgO1xuICAgICAgICB0aGlzLmVsZW1lbnRzLnNjcnViYmluZy5jb250YWluZXIuc3R5bGUuaGVpZ2h0ID0gYCR7aGVpZ2h0fXB4YDtcbiAgICAgIH0pO1xuXG4gICAgICBfZGVmaW5lUHJvcGVydHkkMSh0aGlzLCBcInNldEltYWdlU2l6ZUFuZE9mZnNldFwiLCAocHJldmlld0ltYWdlLCBmcmFtZSkgPT4ge1xuICAgICAgICBpZiAoIXRoaXMudXNpbmdTcHJpdGVzKSByZXR1cm47IC8vIEZpbmQgZGlmZmVyZW5jZSBiZXR3ZWVuIGhlaWdodCBhbmQgcHJldmlldyBjb250YWluZXIgaGVpZ2h0XG5cbiAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IHRoaXMudGh1bWJDb250YWluZXJIZWlnaHQgLyBmcmFtZS5oOyAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcGFyYW0tcmVhc3NpZ25cblxuICAgICAgICBwcmV2aWV3SW1hZ2Uuc3R5bGUuaGVpZ2h0ID0gYCR7cHJldmlld0ltYWdlLm5hdHVyYWxIZWlnaHQgKiBtdWx0aXBsaWVyfXB4YDsgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXBhcmFtLXJlYXNzaWduXG5cbiAgICAgICAgcHJldmlld0ltYWdlLnN0eWxlLndpZHRoID0gYCR7cHJldmlld0ltYWdlLm5hdHVyYWxXaWR0aCAqIG11bHRpcGxpZXJ9cHhgOyAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcGFyYW0tcmVhc3NpZ25cblxuICAgICAgICBwcmV2aWV3SW1hZ2Uuc3R5bGUubGVmdCA9IGAtJHtmcmFtZS54ICogbXVsdGlwbGllcn1weGA7IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1wYXJhbS1yZWFzc2lnblxuXG4gICAgICAgIHByZXZpZXdJbWFnZS5zdHlsZS50b3AgPSBgLSR7ZnJhbWUueSAqIG11bHRpcGxpZXJ9cHhgO1xuICAgICAgfSk7XG5cbiAgICAgIHRoaXMucGxheWVyID0gcGxheWVyO1xuICAgICAgdGhpcy50aHVtYm5haWxzID0gW107XG4gICAgICB0aGlzLmxvYWRlZCA9IGZhbHNlO1xuICAgICAgdGhpcy5sYXN0TW91c2VNb3ZlVGltZSA9IERhdGUubm93KCk7XG4gICAgICB0aGlzLm1vdXNlRG93biA9IGZhbHNlO1xuICAgICAgdGhpcy5sb2FkZWRJbWFnZXMgPSBbXTtcbiAgICAgIHRoaXMuZWxlbWVudHMgPSB7XG4gICAgICAgIHRodW1iOiB7fSxcbiAgICAgICAgc2NydWJiaW5nOiB7fVxuICAgICAgfTtcbiAgICAgIHRoaXMubG9hZCgpO1xuICAgIH1cblxuICAgIGdldCBlbmFibGVkKCkge1xuICAgICAgcmV0dXJuIHRoaXMucGxheWVyLmlzSFRNTDUgJiYgdGhpcy5wbGF5ZXIuaXNWaWRlbyAmJiB0aGlzLnBsYXllci5jb25maWcucHJldmlld1RodW1ibmFpbHMuZW5hYmxlZDtcbiAgICB9XG5cbiAgICBnZXQgY3VycmVudEltYWdlQ29udGFpbmVyKCkge1xuICAgICAgcmV0dXJuIHRoaXMubW91c2VEb3duID8gdGhpcy5lbGVtZW50cy5zY3J1YmJpbmcuY29udGFpbmVyIDogdGhpcy5lbGVtZW50cy50aHVtYi5pbWFnZUNvbnRhaW5lcjtcbiAgICB9XG5cbiAgICBnZXQgdXNpbmdTcHJpdGVzKCkge1xuICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKHRoaXMudGh1bWJuYWlsc1swXS5mcmFtZXNbMF0pLmluY2x1ZGVzKCd3Jyk7XG4gICAgfVxuXG4gICAgZ2V0IHRodW1iQXNwZWN0UmF0aW8oKSB7XG4gICAgICBpZiAodGhpcy51c2luZ1Nwcml0ZXMpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudGh1bWJuYWlsc1swXS5mcmFtZXNbMF0udyAvIHRoaXMudGh1bWJuYWlsc1swXS5mcmFtZXNbMF0uaDtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRoaXMudGh1bWJuYWlsc1swXS53aWR0aCAvIHRoaXMudGh1bWJuYWlsc1swXS5oZWlnaHQ7XG4gICAgfVxuXG4gICAgZ2V0IHRodW1iQ29udGFpbmVySGVpZ2h0KCkge1xuICAgICAgaWYgKHRoaXMubW91c2VEb3duKSB7XG4gICAgICAgIGNvbnN0IHtcbiAgICAgICAgICBoZWlnaHRcbiAgICAgICAgfSA9IGZpdFJhdGlvKHRoaXMudGh1bWJBc3BlY3RSYXRpbywge1xuICAgICAgICAgIHdpZHRoOiB0aGlzLnBsYXllci5tZWRpYS5jbGllbnRXaWR0aCxcbiAgICAgICAgICBoZWlnaHQ6IHRoaXMucGxheWVyLm1lZGlhLmNsaWVudEhlaWdodFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGhlaWdodDtcbiAgICAgIH0gLy8gSWYgY3NzIGlzIHVzZWQgdGhpcyBuZWVkcyB0byByZXR1cm4gdGhlIGNzcyBoZWlnaHQgZm9yIHNwcml0ZXMgdG8gd29yayAoc2VlIHNldEltYWdlU2l6ZUFuZE9mZnNldClcblxuXG4gICAgICBpZiAodGhpcy5zaXplU3BlY2lmaWVkSW5DU1MpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZWxlbWVudHMudGh1bWIuaW1hZ2VDb250YWluZXIuY2xpZW50SGVpZ2h0O1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gTWF0aC5mbG9vcih0aGlzLnBsYXllci5tZWRpYS5jbGllbnRXaWR0aCAvIHRoaXMudGh1bWJBc3BlY3RSYXRpbyAvIDQpO1xuICAgIH1cblxuICAgIGdldCBjdXJyZW50SW1hZ2VFbGVtZW50KCkge1xuICAgICAgcmV0dXJuIHRoaXMubW91c2VEb3duID8gdGhpcy5jdXJyZW50U2NydWJiaW5nSW1hZ2VFbGVtZW50IDogdGhpcy5jdXJyZW50VGh1bWJuYWlsSW1hZ2VFbGVtZW50O1xuICAgIH1cblxuICAgIHNldCBjdXJyZW50SW1hZ2VFbGVtZW50KGVsZW1lbnQpIHtcbiAgICAgIGlmICh0aGlzLm1vdXNlRG93bikge1xuICAgICAgICB0aGlzLmN1cnJlbnRTY3J1YmJpbmdJbWFnZUVsZW1lbnQgPSBlbGVtZW50O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5jdXJyZW50VGh1bWJuYWlsSW1hZ2VFbGVtZW50ID0gZWxlbWVudDtcbiAgICAgIH1cbiAgICB9XG5cbiAgfVxuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIGNvbnN0IHNvdXJjZSA9IHtcbiAgICAvLyBBZGQgZWxlbWVudHMgdG8gSFRNTDUgbWVkaWEgKHNvdXJjZSwgdHJhY2tzLCBldGMpXG4gICAgaW5zZXJ0RWxlbWVudHModHlwZSwgYXR0cmlidXRlcykge1xuICAgICAgaWYgKGlzLnN0cmluZyhhdHRyaWJ1dGVzKSkge1xuICAgICAgICBpbnNlcnRFbGVtZW50KHR5cGUsIHRoaXMubWVkaWEsIHtcbiAgICAgICAgICBzcmM6IGF0dHJpYnV0ZXNcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2UgaWYgKGlzLmFycmF5KGF0dHJpYnV0ZXMpKSB7XG4gICAgICAgIGF0dHJpYnV0ZXMuZm9yRWFjaChhdHRyaWJ1dGUgPT4ge1xuICAgICAgICAgIGluc2VydEVsZW1lbnQodHlwZSwgdGhpcy5tZWRpYSwgYXR0cmlidXRlKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIC8vIFVwZGF0ZSBzb3VyY2VcbiAgICAvLyBTb3VyY2VzIGFyZSBub3QgY2hlY2tlZCBmb3Igc3VwcG9ydCBzbyBiZSBjYXJlZnVsXG4gICAgY2hhbmdlKGlucHV0KSB7XG4gICAgICBpZiAoIWdldERlZXAoaW5wdXQsICdzb3VyY2VzLmxlbmd0aCcpKSB7XG4gICAgICAgIHRoaXMuZGVidWcud2FybignSW52YWxpZCBzb3VyY2UgZm9ybWF0Jyk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH0gLy8gQ2FuY2VsIGN1cnJlbnQgbmV0d29yayByZXF1ZXN0c1xuXG5cbiAgICAgIGh0bWw1LmNhbmNlbFJlcXVlc3RzLmNhbGwodGhpcyk7IC8vIERlc3Ryb3kgaW5zdGFuY2UgYW5kIHJlLXNldHVwXG5cbiAgICAgIHRoaXMuZGVzdHJveS5jYWxsKHRoaXMsICgpID0+IHtcbiAgICAgICAgLy8gUmVzZXQgcXVhbGl0eSBvcHRpb25zXG4gICAgICAgIHRoaXMub3B0aW9ucy5xdWFsaXR5ID0gW107IC8vIFJlbW92ZSBlbGVtZW50c1xuXG4gICAgICAgIHJlbW92ZUVsZW1lbnQodGhpcy5tZWRpYSk7XG4gICAgICAgIHRoaXMubWVkaWEgPSBudWxsOyAvLyBSZXNldCBjbGFzcyBuYW1lXG5cbiAgICAgICAgaWYgKGlzLmVsZW1lbnQodGhpcy5lbGVtZW50cy5jb250YWluZXIpKSB7XG4gICAgICAgICAgdGhpcy5lbGVtZW50cy5jb250YWluZXIucmVtb3ZlQXR0cmlidXRlKCdjbGFzcycpO1xuICAgICAgICB9IC8vIFNldCB0aGUgdHlwZSBhbmQgcHJvdmlkZXJcblxuXG4gICAgICAgIGNvbnN0IHtcbiAgICAgICAgICBzb3VyY2VzLFxuICAgICAgICAgIHR5cGVcbiAgICAgICAgfSA9IGlucHV0O1xuICAgICAgICBjb25zdCBbe1xuICAgICAgICAgIHByb3ZpZGVyID0gcHJvdmlkZXJzLmh0bWw1LFxuICAgICAgICAgIHNyY1xuICAgICAgICB9XSA9IHNvdXJjZXM7XG4gICAgICAgIGNvbnN0IHRhZ05hbWUgPSBwcm92aWRlciA9PT0gJ2h0bWw1JyA/IHR5cGUgOiAnZGl2JztcbiAgICAgICAgY29uc3QgYXR0cmlidXRlcyA9IHByb3ZpZGVyID09PSAnaHRtbDUnID8ge30gOiB7XG4gICAgICAgICAgc3JjXG4gICAgICAgIH07XG4gICAgICAgIE9iamVjdC5hc3NpZ24odGhpcywge1xuICAgICAgICAgIHByb3ZpZGVyLFxuICAgICAgICAgIHR5cGUsXG4gICAgICAgICAgLy8gQ2hlY2sgZm9yIHN1cHBvcnRcbiAgICAgICAgICBzdXBwb3J0ZWQ6IHN1cHBvcnQuY2hlY2sodHlwZSwgcHJvdmlkZXIsIHRoaXMuY29uZmlnLnBsYXlzaW5saW5lKSxcbiAgICAgICAgICAvLyBDcmVhdGUgbmV3IGVsZW1lbnRcbiAgICAgICAgICBtZWRpYTogY3JlYXRlRWxlbWVudCh0YWdOYW1lLCBhdHRyaWJ1dGVzKVxuICAgICAgICB9KTsgLy8gSW5qZWN0IHRoZSBuZXcgZWxlbWVudFxuXG4gICAgICAgIHRoaXMuZWxlbWVudHMuY29udGFpbmVyLmFwcGVuZENoaWxkKHRoaXMubWVkaWEpOyAvLyBBdXRvcGxheSB0aGUgbmV3IHNvdXJjZT9cblxuICAgICAgICBpZiAoaXMuYm9vbGVhbihpbnB1dC5hdXRvcGxheSkpIHtcbiAgICAgICAgICB0aGlzLmNvbmZpZy5hdXRvcGxheSA9IGlucHV0LmF1dG9wbGF5O1xuICAgICAgICB9IC8vIFNldCBhdHRyaWJ1dGVzIGZvciBhdWRpbyBhbmQgdmlkZW9cblxuXG4gICAgICAgIGlmICh0aGlzLmlzSFRNTDUpIHtcbiAgICAgICAgICBpZiAodGhpcy5jb25maWcuY3Jvc3NvcmlnaW4pIHtcbiAgICAgICAgICAgIHRoaXMubWVkaWEuc2V0QXR0cmlidXRlKCdjcm9zc29yaWdpbicsICcnKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAodGhpcy5jb25maWcuYXV0b3BsYXkpIHtcbiAgICAgICAgICAgIHRoaXMubWVkaWEuc2V0QXR0cmlidXRlKCdhdXRvcGxheScsICcnKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAoIWlzLmVtcHR5KGlucHV0LnBvc3RlcikpIHtcbiAgICAgICAgICAgIHRoaXMucG9zdGVyID0gaW5wdXQucG9zdGVyO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmICh0aGlzLmNvbmZpZy5sb29wLmFjdGl2ZSkge1xuICAgICAgICAgICAgdGhpcy5tZWRpYS5zZXRBdHRyaWJ1dGUoJ2xvb3AnLCAnJyk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKHRoaXMuY29uZmlnLm11dGVkKSB7XG4gICAgICAgICAgICB0aGlzLm1lZGlhLnNldEF0dHJpYnV0ZSgnbXV0ZWQnLCAnJyk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKHRoaXMuY29uZmlnLnBsYXlzaW5saW5lKSB7XG4gICAgICAgICAgICB0aGlzLm1lZGlhLnNldEF0dHJpYnV0ZSgncGxheXNpbmxpbmUnLCAnJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9IC8vIFJlc3RvcmUgY2xhc3MgaG9va1xuXG5cbiAgICAgICAgdWkuYWRkU3R5bGVIb29rLmNhbGwodGhpcyk7IC8vIFNldCBuZXcgc291cmNlcyBmb3IgaHRtbDVcblxuICAgICAgICBpZiAodGhpcy5pc0hUTUw1KSB7XG4gICAgICAgICAgc291cmNlLmluc2VydEVsZW1lbnRzLmNhbGwodGhpcywgJ3NvdXJjZScsIHNvdXJjZXMpO1xuICAgICAgICB9IC8vIFNldCB2aWRlbyB0aXRsZVxuXG5cbiAgICAgICAgdGhpcy5jb25maWcudGl0bGUgPSBpbnB1dC50aXRsZTsgLy8gU2V0IHVwIGZyb20gc2NyYXRjaFxuXG4gICAgICAgIG1lZGlhLnNldHVwLmNhbGwodGhpcyk7IC8vIEhUTUw1IHN0dWZmXG5cbiAgICAgICAgaWYgKHRoaXMuaXNIVE1MNSkge1xuICAgICAgICAgIC8vIFNldHVwIGNhcHRpb25zXG4gICAgICAgICAgaWYgKE9iamVjdC5rZXlzKGlucHV0KS5pbmNsdWRlcygndHJhY2tzJykpIHtcbiAgICAgICAgICAgIHNvdXJjZS5pbnNlcnRFbGVtZW50cy5jYWxsKHRoaXMsICd0cmFjaycsIGlucHV0LnRyYWNrcyk7XG4gICAgICAgICAgfVxuICAgICAgICB9IC8vIElmIEhUTUw1IG9yIGVtYmVkIGJ1dCBub3QgZnVsbHkgc3VwcG9ydGVkLCBzZXR1cEludGVyZmFjZSBhbmQgY2FsbCByZWFkeSBub3dcblxuXG4gICAgICAgIGlmICh0aGlzLmlzSFRNTDUgfHwgdGhpcy5pc0VtYmVkICYmICF0aGlzLnN1cHBvcnRlZC51aSkge1xuICAgICAgICAgIC8vIFNldHVwIGludGVyZmFjZVxuICAgICAgICAgIHVpLmJ1aWxkLmNhbGwodGhpcyk7XG4gICAgICAgIH0gLy8gTG9hZCBIVE1MNSBzb3VyY2VzXG5cblxuICAgICAgICBpZiAodGhpcy5pc0hUTUw1KSB7XG4gICAgICAgICAgdGhpcy5tZWRpYS5sb2FkKCk7XG4gICAgICAgIH0gLy8gVXBkYXRlIHByZXZpZXdUaHVtYm5haWxzIGNvbmZpZyAmIHJlbG9hZCBwbHVnaW5cblxuXG4gICAgICAgIGlmICghaXMuZW1wdHkoaW5wdXQucHJldmlld1RodW1ibmFpbHMpKSB7XG4gICAgICAgICAgT2JqZWN0LmFzc2lnbih0aGlzLmNvbmZpZy5wcmV2aWV3VGh1bWJuYWlscywgaW5wdXQucHJldmlld1RodW1ibmFpbHMpOyAvLyBDbGVhbnVwIHByZXZpZXdUaHVtYm5haWxzIHBsdWdpbiBpZiBpdCB3YXMgbG9hZGVkXG5cbiAgICAgICAgICBpZiAodGhpcy5wcmV2aWV3VGh1bWJuYWlscyAmJiB0aGlzLnByZXZpZXdUaHVtYm5haWxzLmxvYWRlZCkge1xuICAgICAgICAgICAgdGhpcy5wcmV2aWV3VGh1bWJuYWlscy5kZXN0cm95KCk7XG4gICAgICAgICAgICB0aGlzLnByZXZpZXdUaHVtYm5haWxzID0gbnVsbDtcbiAgICAgICAgICB9IC8vIENyZWF0ZSBuZXcgaW5zdGFuY2UgaWYgaXQgaXMgc3RpbGwgZW5hYmxlZFxuXG5cbiAgICAgICAgICBpZiAodGhpcy5jb25maWcucHJldmlld1RodW1ibmFpbHMuZW5hYmxlZCkge1xuICAgICAgICAgICAgdGhpcy5wcmV2aWV3VGh1bWJuYWlscyA9IG5ldyBQcmV2aWV3VGh1bWJuYWlscyh0aGlzKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gLy8gVXBkYXRlIHRoZSBmdWxsc2NyZWVuIHN1cHBvcnRcblxuXG4gICAgICAgIHRoaXMuZnVsbHNjcmVlbi51cGRhdGUoKTtcbiAgICAgIH0sIHRydWUpO1xuICAgIH1cblxuICB9O1xuXG4gIC8vIFRPRE86IFVzZSBhIFdlYWtNYXAgZm9yIHByaXZhdGUgZ2xvYmFsc1xuICAvLyBjb25zdCBnbG9iYWxzID0gbmV3IFdlYWtNYXAoKTtcbiAgLy8gUGx5ciBpbnN0YW5jZVxuXG4gIGNsYXNzIFBseXIge1xuICAgIGNvbnN0cnVjdG9yKHRhcmdldCwgb3B0aW9ucykge1xuICAgICAgX2RlZmluZVByb3BlcnR5JDEodGhpcywgXCJwbGF5XCIsICgpID0+IHtcbiAgICAgICAgaWYgKCFpcy5mdW5jdGlvbih0aGlzLm1lZGlhLnBsYXkpKSB7XG4gICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH0gLy8gSW50ZWNlcHQgcGxheSB3aXRoIGFkc1xuXG5cbiAgICAgICAgaWYgKHRoaXMuYWRzICYmIHRoaXMuYWRzLmVuYWJsZWQpIHtcbiAgICAgICAgICB0aGlzLmFkcy5tYW5hZ2VyUHJvbWlzZS50aGVuKCgpID0+IHRoaXMuYWRzLnBsYXkoKSkuY2F0Y2goKCkgPT4gc2lsZW5jZVByb21pc2UodGhpcy5tZWRpYS5wbGF5KCkpKTtcbiAgICAgICAgfSAvLyBSZXR1cm4gdGhlIHByb21pc2UgKGZvciBIVE1MNSlcblxuXG4gICAgICAgIHJldHVybiB0aGlzLm1lZGlhLnBsYXkoKTtcbiAgICAgIH0pO1xuXG4gICAgICBfZGVmaW5lUHJvcGVydHkkMSh0aGlzLCBcInBhdXNlXCIsICgpID0+IHtcbiAgICAgICAgaWYgKCF0aGlzLnBsYXlpbmcgfHwgIWlzLmZ1bmN0aW9uKHRoaXMubWVkaWEucGF1c2UpKSB7XG4gICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcy5tZWRpYS5wYXVzZSgpO1xuICAgICAgfSk7XG5cbiAgICAgIF9kZWZpbmVQcm9wZXJ0eSQxKHRoaXMsIFwidG9nZ2xlUGxheVwiLCBpbnB1dCA9PiB7XG4gICAgICAgIC8vIFRvZ2dsZSBiYXNlZCBvbiBjdXJyZW50IHN0YXRlIGlmIG5vdGhpbmcgcGFzc2VkXG4gICAgICAgIGNvbnN0IHRvZ2dsZSA9IGlzLmJvb2xlYW4oaW5wdXQpID8gaW5wdXQgOiAhdGhpcy5wbGF5aW5nO1xuXG4gICAgICAgIGlmICh0b2dnbGUpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5wbGF5KCk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcy5wYXVzZSgpO1xuICAgICAgfSk7XG5cbiAgICAgIF9kZWZpbmVQcm9wZXJ0eSQxKHRoaXMsIFwic3RvcFwiLCAoKSA9PiB7XG4gICAgICAgIGlmICh0aGlzLmlzSFRNTDUpIHtcbiAgICAgICAgICB0aGlzLnBhdXNlKCk7XG4gICAgICAgICAgdGhpcy5yZXN0YXJ0KCk7XG4gICAgICAgIH0gZWxzZSBpZiAoaXMuZnVuY3Rpb24odGhpcy5tZWRpYS5zdG9wKSkge1xuICAgICAgICAgIHRoaXMubWVkaWEuc3RvcCgpO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgX2RlZmluZVByb3BlcnR5JDEodGhpcywgXCJyZXN0YXJ0XCIsICgpID0+IHtcbiAgICAgICAgdGhpcy5jdXJyZW50VGltZSA9IDA7XG4gICAgICB9KTtcblxuICAgICAgX2RlZmluZVByb3BlcnR5JDEodGhpcywgXCJyZXdpbmRcIiwgc2Vla1RpbWUgPT4ge1xuICAgICAgICB0aGlzLmN1cnJlbnRUaW1lIC09IGlzLm51bWJlcihzZWVrVGltZSkgPyBzZWVrVGltZSA6IHRoaXMuY29uZmlnLnNlZWtUaW1lO1xuICAgICAgfSk7XG5cbiAgICAgIF9kZWZpbmVQcm9wZXJ0eSQxKHRoaXMsIFwiZm9yd2FyZFwiLCBzZWVrVGltZSA9PiB7XG4gICAgICAgIHRoaXMuY3VycmVudFRpbWUgKz0gaXMubnVtYmVyKHNlZWtUaW1lKSA/IHNlZWtUaW1lIDogdGhpcy5jb25maWcuc2Vla1RpbWU7XG4gICAgICB9KTtcblxuICAgICAgX2RlZmluZVByb3BlcnR5JDEodGhpcywgXCJpbmNyZWFzZVZvbHVtZVwiLCBzdGVwID0+IHtcbiAgICAgICAgY29uc3Qgdm9sdW1lID0gdGhpcy5tZWRpYS5tdXRlZCA/IDAgOiB0aGlzLnZvbHVtZTtcbiAgICAgICAgdGhpcy52b2x1bWUgPSB2b2x1bWUgKyAoaXMubnVtYmVyKHN0ZXApID8gc3RlcCA6IDApO1xuICAgICAgfSk7XG5cbiAgICAgIF9kZWZpbmVQcm9wZXJ0eSQxKHRoaXMsIFwiZGVjcmVhc2VWb2x1bWVcIiwgc3RlcCA9PiB7XG4gICAgICAgIHRoaXMuaW5jcmVhc2VWb2x1bWUoLXN0ZXApO1xuICAgICAgfSk7XG5cbiAgICAgIF9kZWZpbmVQcm9wZXJ0eSQxKHRoaXMsIFwiYWlycGxheVwiLCAoKSA9PiB7XG4gICAgICAgIC8vIFNob3cgZGlhbG9nIGlmIHN1cHBvcnRlZFxuICAgICAgICBpZiAoc3VwcG9ydC5haXJwbGF5KSB7XG4gICAgICAgICAgdGhpcy5tZWRpYS53ZWJraXRTaG93UGxheWJhY2tUYXJnZXRQaWNrZXIoKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIF9kZWZpbmVQcm9wZXJ0eSQxKHRoaXMsIFwidG9nZ2xlQ29udHJvbHNcIiwgdG9nZ2xlID0+IHtcbiAgICAgICAgLy8gRG9uJ3QgdG9nZ2xlIGlmIG1pc3NpbmcgVUkgc3VwcG9ydCBvciBpZiBpdCdzIGF1ZGlvXG4gICAgICAgIGlmICh0aGlzLnN1cHBvcnRlZC51aSAmJiAhdGhpcy5pc0F1ZGlvKSB7XG4gICAgICAgICAgLy8gR2V0IHN0YXRlIGJlZm9yZSBjaGFuZ2VcbiAgICAgICAgICBjb25zdCBpc0hpZGRlbiA9IGhhc0NsYXNzKHRoaXMuZWxlbWVudHMuY29udGFpbmVyLCB0aGlzLmNvbmZpZy5jbGFzc05hbWVzLmhpZGVDb250cm9scyk7IC8vIE5lZ2F0ZSB0aGUgYXJndW1lbnQgaWYgbm90IHVuZGVmaW5lZCBzaW5jZSBhZGRpbmcgdGhlIGNsYXNzIHRvIGhpZGVzIHRoZSBjb250cm9sc1xuXG4gICAgICAgICAgY29uc3QgZm9yY2UgPSB0eXBlb2YgdG9nZ2xlID09PSAndW5kZWZpbmVkJyA/IHVuZGVmaW5lZCA6ICF0b2dnbGU7IC8vIEFwcGx5IGFuZCBnZXQgdXBkYXRlZCBzdGF0ZVxuXG4gICAgICAgICAgY29uc3QgaGlkaW5nID0gdG9nZ2xlQ2xhc3ModGhpcy5lbGVtZW50cy5jb250YWluZXIsIHRoaXMuY29uZmlnLmNsYXNzTmFtZXMuaGlkZUNvbnRyb2xzLCBmb3JjZSk7IC8vIENsb3NlIG1lbnVcblxuICAgICAgICAgIGlmIChoaWRpbmcgJiYgaXMuYXJyYXkodGhpcy5jb25maWcuY29udHJvbHMpICYmIHRoaXMuY29uZmlnLmNvbnRyb2xzLmluY2x1ZGVzKCdzZXR0aW5ncycpICYmICFpcy5lbXB0eSh0aGlzLmNvbmZpZy5zZXR0aW5ncykpIHtcbiAgICAgICAgICAgIGNvbnRyb2xzLnRvZ2dsZU1lbnUuY2FsbCh0aGlzLCBmYWxzZSk7XG4gICAgICAgICAgfSAvLyBUcmlnZ2VyIGV2ZW50IG9uIGNoYW5nZVxuXG5cbiAgICAgICAgICBpZiAoaGlkaW5nICE9PSBpc0hpZGRlbikge1xuICAgICAgICAgICAgY29uc3QgZXZlbnROYW1lID0gaGlkaW5nID8gJ2NvbnRyb2xzaGlkZGVuJyA6ICdjb250cm9sc3Nob3duJztcbiAgICAgICAgICAgIHRyaWdnZXJFdmVudC5jYWxsKHRoaXMsIHRoaXMubWVkaWEsIGV2ZW50TmFtZSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmV0dXJuICFoaWRpbmc7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9KTtcblxuICAgICAgX2RlZmluZVByb3BlcnR5JDEodGhpcywgXCJvblwiLCAoZXZlbnQsIGNhbGxiYWNrKSA9PiB7XG4gICAgICAgIG9uLmNhbGwodGhpcywgdGhpcy5lbGVtZW50cy5jb250YWluZXIsIGV2ZW50LCBjYWxsYmFjayk7XG4gICAgICB9KTtcblxuICAgICAgX2RlZmluZVByb3BlcnR5JDEodGhpcywgXCJvbmNlXCIsIChldmVudCwgY2FsbGJhY2spID0+IHtcbiAgICAgICAgb25jZS5jYWxsKHRoaXMsIHRoaXMuZWxlbWVudHMuY29udGFpbmVyLCBldmVudCwgY2FsbGJhY2spO1xuICAgICAgfSk7XG5cbiAgICAgIF9kZWZpbmVQcm9wZXJ0eSQxKHRoaXMsIFwib2ZmXCIsIChldmVudCwgY2FsbGJhY2spID0+IHtcbiAgICAgICAgb2ZmKHRoaXMuZWxlbWVudHMuY29udGFpbmVyLCBldmVudCwgY2FsbGJhY2spO1xuICAgICAgfSk7XG5cbiAgICAgIF9kZWZpbmVQcm9wZXJ0eSQxKHRoaXMsIFwiZGVzdHJveVwiLCAoY2FsbGJhY2ssIHNvZnQgPSBmYWxzZSkgPT4ge1xuICAgICAgICBpZiAoIXRoaXMucmVhZHkpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBkb25lID0gKCkgPT4ge1xuICAgICAgICAgIC8vIFJlc2V0IG92ZXJmbG93IChpbmNhc2UgZGVzdHJveWVkIHdoaWxlIGluIGZ1bGxzY3JlZW4pXG4gICAgICAgICAgZG9jdW1lbnQuYm9keS5zdHlsZS5vdmVyZmxvdyA9ICcnOyAvLyBHQyBmb3IgZW1iZWRcblxuICAgICAgICAgIHRoaXMuZW1iZWQgPSBudWxsOyAvLyBJZiBpdCdzIGEgc29mdCBkZXN0cm95LCBtYWtlIG1pbmltYWwgY2hhbmdlc1xuXG4gICAgICAgICAgaWYgKHNvZnQpIHtcbiAgICAgICAgICAgIGlmIChPYmplY3Qua2V5cyh0aGlzLmVsZW1lbnRzKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgLy8gUmVtb3ZlIGVsZW1lbnRzXG4gICAgICAgICAgICAgIHJlbW92ZUVsZW1lbnQodGhpcy5lbGVtZW50cy5idXR0b25zLnBsYXkpO1xuICAgICAgICAgICAgICByZW1vdmVFbGVtZW50KHRoaXMuZWxlbWVudHMuY2FwdGlvbnMpO1xuICAgICAgICAgICAgICByZW1vdmVFbGVtZW50KHRoaXMuZWxlbWVudHMuY29udHJvbHMpO1xuICAgICAgICAgICAgICByZW1vdmVFbGVtZW50KHRoaXMuZWxlbWVudHMud3JhcHBlcik7IC8vIENsZWFyIGZvciBHQ1xuXG4gICAgICAgICAgICAgIHRoaXMuZWxlbWVudHMuYnV0dG9ucy5wbGF5ID0gbnVsbDtcbiAgICAgICAgICAgICAgdGhpcy5lbGVtZW50cy5jYXB0aW9ucyA9IG51bGw7XG4gICAgICAgICAgICAgIHRoaXMuZWxlbWVudHMuY29udHJvbHMgPSBudWxsO1xuICAgICAgICAgICAgICB0aGlzLmVsZW1lbnRzLndyYXBwZXIgPSBudWxsO1xuICAgICAgICAgICAgfSAvLyBDYWxsYmFja1xuXG5cbiAgICAgICAgICAgIGlmIChpcy5mdW5jdGlvbihjYWxsYmFjaykpIHtcbiAgICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gVW5iaW5kIGxpc3RlbmVyc1xuICAgICAgICAgICAgdW5iaW5kTGlzdGVuZXJzLmNhbGwodGhpcyk7IC8vIENhbmNlbCBjdXJyZW50IG5ldHdvcmsgcmVxdWVzdHNcblxuICAgICAgICAgICAgaHRtbDUuY2FuY2VsUmVxdWVzdHMuY2FsbCh0aGlzKTsgLy8gUmVwbGFjZSB0aGUgY29udGFpbmVyIHdpdGggdGhlIG9yaWdpbmFsIGVsZW1lbnQgcHJvdmlkZWRcblxuICAgICAgICAgICAgcmVwbGFjZUVsZW1lbnQodGhpcy5lbGVtZW50cy5vcmlnaW5hbCwgdGhpcy5lbGVtZW50cy5jb250YWluZXIpOyAvLyBFdmVudFxuXG4gICAgICAgICAgICB0cmlnZ2VyRXZlbnQuY2FsbCh0aGlzLCB0aGlzLmVsZW1lbnRzLm9yaWdpbmFsLCAnZGVzdHJveWVkJywgdHJ1ZSk7IC8vIENhbGxiYWNrXG5cbiAgICAgICAgICAgIGlmIChpcy5mdW5jdGlvbihjYWxsYmFjaykpIHtcbiAgICAgICAgICAgICAgY2FsbGJhY2suY2FsbCh0aGlzLmVsZW1lbnRzLm9yaWdpbmFsKTtcbiAgICAgICAgICAgIH0gLy8gUmVzZXQgc3RhdGVcblxuXG4gICAgICAgICAgICB0aGlzLnJlYWR5ID0gZmFsc2U7IC8vIENsZWFyIGZvciBnYXJiYWdlIGNvbGxlY3Rpb25cblxuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgIHRoaXMuZWxlbWVudHMgPSBudWxsO1xuICAgICAgICAgICAgICB0aGlzLm1lZGlhID0gbnVsbDtcbiAgICAgICAgICAgIH0sIDIwMCk7XG4gICAgICAgICAgfVxuICAgICAgICB9OyAvLyBTdG9wIHBsYXliYWNrXG5cblxuICAgICAgICB0aGlzLnN0b3AoKTsgLy8gQ2xlYXIgdGltZW91dHNcblxuICAgICAgICBjbGVhclRpbWVvdXQodGhpcy50aW1lcnMubG9hZGluZyk7XG4gICAgICAgIGNsZWFyVGltZW91dCh0aGlzLnRpbWVycy5jb250cm9scyk7XG4gICAgICAgIGNsZWFyVGltZW91dCh0aGlzLnRpbWVycy5yZXNpemVkKTsgLy8gUHJvdmlkZXIgc3BlY2lmaWMgc3R1ZmZcblxuICAgICAgICBpZiAodGhpcy5pc0hUTUw1KSB7XG4gICAgICAgICAgLy8gUmVzdG9yZSBuYXRpdmUgdmlkZW8gY29udHJvbHNcbiAgICAgICAgICB1aS50b2dnbGVOYXRpdmVDb250cm9scy5jYWxsKHRoaXMsIHRydWUpOyAvLyBDbGVhbiB1cFxuXG4gICAgICAgICAgZG9uZSgpO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuaXNZb3VUdWJlKSB7XG4gICAgICAgICAgLy8gQ2xlYXIgdGltZXJzXG4gICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLnRpbWVycy5idWZmZXJpbmcpO1xuICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy50aW1lcnMucGxheWluZyk7IC8vIERlc3Ryb3kgWW91VHViZSBBUElcblxuICAgICAgICAgIGlmICh0aGlzLmVtYmVkICE9PSBudWxsICYmIGlzLmZ1bmN0aW9uKHRoaXMuZW1iZWQuZGVzdHJveSkpIHtcbiAgICAgICAgICAgIHRoaXMuZW1iZWQuZGVzdHJveSgpO1xuICAgICAgICAgIH0gLy8gQ2xlYW4gdXBcblxuXG4gICAgICAgICAgZG9uZSgpO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuaXNWaW1lbykge1xuICAgICAgICAgIC8vIERlc3Ryb3kgVmltZW8gQVBJXG4gICAgICAgICAgLy8gdGhlbiBjbGVhbiB1cCAod2FpdCwgdG8gcHJldmVudCBwb3N0bWVzc2FnZSBlcnJvcnMpXG4gICAgICAgICAgaWYgKHRoaXMuZW1iZWQgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHRoaXMuZW1iZWQudW5sb2FkKCkudGhlbihkb25lKTtcbiAgICAgICAgICB9IC8vIFZpbWVvIGRvZXMgbm90IGFsd2F5cyByZXR1cm5cblxuXG4gICAgICAgICAgc2V0VGltZW91dChkb25lLCAyMDApO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgX2RlZmluZVByb3BlcnR5JDEodGhpcywgXCJzdXBwb3J0c1wiLCB0eXBlID0+IHN1cHBvcnQubWltZS5jYWxsKHRoaXMsIHR5cGUpKTtcblxuICAgICAgdGhpcy50aW1lcnMgPSB7fTsgLy8gU3RhdGVcblxuICAgICAgdGhpcy5yZWFkeSA9IGZhbHNlO1xuICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7XG4gICAgICB0aGlzLmZhaWxlZCA9IGZhbHNlOyAvLyBUb3VjaCBkZXZpY2VcblxuICAgICAgdGhpcy50b3VjaCA9IHN1cHBvcnQudG91Y2g7IC8vIFNldCB0aGUgbWVkaWEgZWxlbWVudFxuXG4gICAgICB0aGlzLm1lZGlhID0gdGFyZ2V0OyAvLyBTdHJpbmcgc2VsZWN0b3IgcGFzc2VkXG5cbiAgICAgIGlmIChpcy5zdHJpbmcodGhpcy5tZWRpYSkpIHtcbiAgICAgICAgdGhpcy5tZWRpYSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwodGhpcy5tZWRpYSk7XG4gICAgICB9IC8vIGpRdWVyeSwgTm9kZUxpc3Qgb3IgQXJyYXkgcGFzc2VkLCB1c2UgZmlyc3QgZWxlbWVudFxuXG5cbiAgICAgIGlmICh3aW5kb3cualF1ZXJ5ICYmIHRoaXMubWVkaWEgaW5zdGFuY2VvZiBqUXVlcnkgfHwgaXMubm9kZUxpc3QodGhpcy5tZWRpYSkgfHwgaXMuYXJyYXkodGhpcy5tZWRpYSkpIHtcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lXG4gICAgICAgIHRoaXMubWVkaWEgPSB0aGlzLm1lZGlhWzBdO1xuICAgICAgfSAvLyBTZXQgY29uZmlnXG5cblxuICAgICAgdGhpcy5jb25maWcgPSBleHRlbmQoe30sIGRlZmF1bHRzLCBQbHlyLmRlZmF1bHRzLCBvcHRpb25zIHx8IHt9LCAoKCkgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIHJldHVybiBKU09OLnBhcnNlKHRoaXMubWVkaWEuZ2V0QXR0cmlidXRlKCdkYXRhLXBseXItY29uZmlnJykpO1xuICAgICAgICB9IGNhdGNoIChfKSB7XG4gICAgICAgICAgcmV0dXJuIHt9O1xuICAgICAgICB9XG4gICAgICB9KSgpKTsgLy8gRWxlbWVudHMgY2FjaGVcblxuICAgICAgdGhpcy5lbGVtZW50cyA9IHtcbiAgICAgICAgY29udGFpbmVyOiBudWxsLFxuICAgICAgICBmdWxsc2NyZWVuOiBudWxsLFxuICAgICAgICBjYXB0aW9uczogbnVsbCxcbiAgICAgICAgYnV0dG9uczoge30sXG4gICAgICAgIGRpc3BsYXk6IHt9LFxuICAgICAgICBwcm9ncmVzczoge30sXG4gICAgICAgIGlucHV0czoge30sXG4gICAgICAgIHNldHRpbmdzOiB7XG4gICAgICAgICAgcG9wdXA6IG51bGwsXG4gICAgICAgICAgbWVudTogbnVsbCxcbiAgICAgICAgICBwYW5lbHM6IHt9LFxuICAgICAgICAgIGJ1dHRvbnM6IHt9XG4gICAgICAgIH1cbiAgICAgIH07IC8vIENhcHRpb25zXG5cbiAgICAgIHRoaXMuY2FwdGlvbnMgPSB7XG4gICAgICAgIGFjdGl2ZTogbnVsbCxcbiAgICAgICAgY3VycmVudFRyYWNrOiAtMSxcbiAgICAgICAgbWV0YTogbmV3IFdlYWtNYXAoKVxuICAgICAgfTsgLy8gRnVsbHNjcmVlblxuXG4gICAgICB0aGlzLmZ1bGxzY3JlZW4gPSB7XG4gICAgICAgIGFjdGl2ZTogZmFsc2VcbiAgICAgIH07IC8vIE9wdGlvbnNcblxuICAgICAgdGhpcy5vcHRpb25zID0ge1xuICAgICAgICBzcGVlZDogW10sXG4gICAgICAgIHF1YWxpdHk6IFtdXG4gICAgICB9OyAvLyBEZWJ1Z2dpbmdcbiAgICAgIC8vIFRPRE86IG1vdmUgdG8gZ2xvYmFsc1xuXG4gICAgICB0aGlzLmRlYnVnID0gbmV3IENvbnNvbGUodGhpcy5jb25maWcuZGVidWcpOyAvLyBMb2cgY29uZmlnIG9wdGlvbnMgYW5kIHN1cHBvcnRcblxuICAgICAgdGhpcy5kZWJ1Zy5sb2coJ0NvbmZpZycsIHRoaXMuY29uZmlnKTtcbiAgICAgIHRoaXMuZGVidWcubG9nKCdTdXBwb3J0Jywgc3VwcG9ydCk7IC8vIFdlIG5lZWQgYW4gZWxlbWVudCB0byBzZXR1cFxuXG4gICAgICBpZiAoaXMubnVsbE9yVW5kZWZpbmVkKHRoaXMubWVkaWEpIHx8ICFpcy5lbGVtZW50KHRoaXMubWVkaWEpKSB7XG4gICAgICAgIHRoaXMuZGVidWcuZXJyb3IoJ1NldHVwIGZhaWxlZDogbm8gc3VpdGFibGUgZWxlbWVudCBwYXNzZWQnKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfSAvLyBCYWlsIGlmIHRoZSBlbGVtZW50IGlzIGluaXRpYWxpemVkXG5cblxuICAgICAgaWYgKHRoaXMubWVkaWEucGx5cikge1xuICAgICAgICB0aGlzLmRlYnVnLndhcm4oJ1RhcmdldCBhbHJlYWR5IHNldHVwJyk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH0gLy8gQmFpbCBpZiBub3QgZW5hYmxlZFxuXG5cbiAgICAgIGlmICghdGhpcy5jb25maWcuZW5hYmxlZCkge1xuICAgICAgICB0aGlzLmRlYnVnLmVycm9yKCdTZXR1cCBmYWlsZWQ6IGRpc2FibGVkIGJ5IGNvbmZpZycpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9IC8vIEJhaWwgaWYgZGlzYWJsZWQgb3Igbm8gYmFzaWMgc3VwcG9ydFxuICAgICAgLy8gWW91IG1heSB3YW50IHRvIGRpc2FibGUgY2VydGFpbiBVQXMgZXRjXG5cblxuICAgICAgaWYgKCFzdXBwb3J0LmNoZWNrKCkuYXBpKSB7XG4gICAgICAgIHRoaXMuZGVidWcuZXJyb3IoJ1NldHVwIGZhaWxlZDogbm8gc3VwcG9ydCcpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9IC8vIENhY2hlIG9yaWdpbmFsIGVsZW1lbnQgc3RhdGUgZm9yIC5kZXN0cm95KClcblxuXG4gICAgICBjb25zdCBjbG9uZSA9IHRoaXMubWVkaWEuY2xvbmVOb2RlKHRydWUpO1xuICAgICAgY2xvbmUuYXV0b3BsYXkgPSBmYWxzZTtcbiAgICAgIHRoaXMuZWxlbWVudHMub3JpZ2luYWwgPSBjbG9uZTsgLy8gU2V0IG1lZGlhIHR5cGUgYmFzZWQgb24gdGFnIG9yIGRhdGEgYXR0cmlidXRlXG4gICAgICAvLyBTdXBwb3J0ZWQ6IHZpZGVvLCBhdWRpbywgdmltZW8sIHlvdXR1YmVcblxuICAgICAgY29uc3QgX3R5cGUgPSB0aGlzLm1lZGlhLnRhZ05hbWUudG9Mb3dlckNhc2UoKTsgLy8gRW1iZWQgcHJvcGVydGllc1xuXG5cbiAgICAgIGxldCBpZnJhbWUgPSBudWxsO1xuICAgICAgbGV0IHVybCA9IG51bGw7IC8vIERpZmZlcmVudCBzZXR1cCBiYXNlZCBvbiB0eXBlXG5cbiAgICAgIHN3aXRjaCAoX3R5cGUpIHtcbiAgICAgICAgY2FzZSAnZGl2JzpcbiAgICAgICAgICAvLyBGaW5kIHRoZSBmcmFtZVxuICAgICAgICAgIGlmcmFtZSA9IHRoaXMubWVkaWEucXVlcnlTZWxlY3RvcignaWZyYW1lJyk7IC8vIDxpZnJhbWU+IHR5cGVcblxuICAgICAgICAgIGlmIChpcy5lbGVtZW50KGlmcmFtZSkpIHtcbiAgICAgICAgICAgIC8vIERldGVjdCBwcm92aWRlclxuICAgICAgICAgICAgdXJsID0gcGFyc2VVcmwoaWZyYW1lLmdldEF0dHJpYnV0ZSgnc3JjJykpO1xuICAgICAgICAgICAgdGhpcy5wcm92aWRlciA9IGdldFByb3ZpZGVyQnlVcmwodXJsLnRvU3RyaW5nKCkpOyAvLyBSZXdvcmsgZWxlbWVudHNcblxuICAgICAgICAgICAgdGhpcy5lbGVtZW50cy5jb250YWluZXIgPSB0aGlzLm1lZGlhO1xuICAgICAgICAgICAgdGhpcy5tZWRpYSA9IGlmcmFtZTsgLy8gUmVzZXQgY2xhc3NuYW1lXG5cbiAgICAgICAgICAgIHRoaXMuZWxlbWVudHMuY29udGFpbmVyLmNsYXNzTmFtZSA9ICcnOyAvLyBHZXQgYXR0cmlidXRlcyBmcm9tIFVSTCBhbmQgc2V0IGNvbmZpZ1xuXG4gICAgICAgICAgICBpZiAodXJsLnNlYXJjaC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgY29uc3QgdHJ1dGh5ID0gWycxJywgJ3RydWUnXTtcblxuICAgICAgICAgICAgICBpZiAodHJ1dGh5LmluY2x1ZGVzKHVybC5zZWFyY2hQYXJhbXMuZ2V0KCdhdXRvcGxheScpKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuY29uZmlnLmF1dG9wbGF5ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIGlmICh0cnV0aHkuaW5jbHVkZXModXJsLnNlYXJjaFBhcmFtcy5nZXQoJ2xvb3AnKSkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZy5sb29wLmFjdGl2ZSA9IHRydWU7XG4gICAgICAgICAgICAgIH0gLy8gVE9ETzogcmVwbGFjZSBmdWxsc2NyZWVuLmlvc05hdGl2ZSB3aXRoIHRoaXMgcGxheXNpbmxpbmUgY29uZmlnIG9wdGlvblxuICAgICAgICAgICAgICAvLyBZb3VUdWJlIHJlcXVpcmVzIHRoZSBwbGF5c2lubGluZSBpbiB0aGUgVVJMXG5cblxuICAgICAgICAgICAgICBpZiAodGhpcy5pc1lvdVR1YmUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZy5wbGF5c2lubGluZSA9IHRydXRoeS5pbmNsdWRlcyh1cmwuc2VhcmNoUGFyYW1zLmdldCgncGxheXNpbmxpbmUnKSk7XG4gICAgICAgICAgICAgICAgdGhpcy5jb25maWcueW91dHViZS5obCA9IHVybC5zZWFyY2hQYXJhbXMuZ2V0KCdobCcpOyAvLyBUT0RPOiBTaG91bGQgdGhpcyBiZSBzZXR0aW5nIGxhbmd1YWdlP1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuY29uZmlnLnBsYXlzaW5saW5lID0gdHJ1ZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyA8ZGl2PiB3aXRoIGF0dHJpYnV0ZXNcbiAgICAgICAgICAgIHRoaXMucHJvdmlkZXIgPSB0aGlzLm1lZGlhLmdldEF0dHJpYnV0ZSh0aGlzLmNvbmZpZy5hdHRyaWJ1dGVzLmVtYmVkLnByb3ZpZGVyKTsgLy8gUmVtb3ZlIGF0dHJpYnV0ZVxuXG4gICAgICAgICAgICB0aGlzLm1lZGlhLnJlbW92ZUF0dHJpYnV0ZSh0aGlzLmNvbmZpZy5hdHRyaWJ1dGVzLmVtYmVkLnByb3ZpZGVyKTtcbiAgICAgICAgICB9IC8vIFVuc3VwcG9ydGVkIG9yIG1pc3NpbmcgcHJvdmlkZXJcblxuXG4gICAgICAgICAgaWYgKGlzLmVtcHR5KHRoaXMucHJvdmlkZXIpIHx8ICFPYmplY3QudmFsdWVzKHByb3ZpZGVycykuaW5jbHVkZXModGhpcy5wcm92aWRlcikpIHtcbiAgICAgICAgICAgIHRoaXMuZGVidWcuZXJyb3IoJ1NldHVwIGZhaWxlZDogSW52YWxpZCBwcm92aWRlcicpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH0gLy8gQXVkaW8gd2lsbCBjb21lIGxhdGVyIGZvciBleHRlcm5hbCBwcm92aWRlcnNcblxuXG4gICAgICAgICAgdGhpcy50eXBlID0gdHlwZXMudmlkZW87XG4gICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgY2FzZSAndmlkZW8nOlxuICAgICAgICBjYXNlICdhdWRpbyc6XG4gICAgICAgICAgdGhpcy50eXBlID0gX3R5cGU7XG4gICAgICAgICAgdGhpcy5wcm92aWRlciA9IHByb3ZpZGVycy5odG1sNTsgLy8gR2V0IGNvbmZpZyBmcm9tIGF0dHJpYnV0ZXNcblxuICAgICAgICAgIGlmICh0aGlzLm1lZGlhLmhhc0F0dHJpYnV0ZSgnY3Jvc3NvcmlnaW4nKSkge1xuICAgICAgICAgICAgdGhpcy5jb25maWcuY3Jvc3NvcmlnaW4gPSB0cnVlO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmICh0aGlzLm1lZGlhLmhhc0F0dHJpYnV0ZSgnYXV0b3BsYXknKSkge1xuICAgICAgICAgICAgdGhpcy5jb25maWcuYXV0b3BsYXkgPSB0cnVlO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmICh0aGlzLm1lZGlhLmhhc0F0dHJpYnV0ZSgncGxheXNpbmxpbmUnKSB8fCB0aGlzLm1lZGlhLmhhc0F0dHJpYnV0ZSgnd2Via2l0LXBsYXlzaW5saW5lJykpIHtcbiAgICAgICAgICAgIHRoaXMuY29uZmlnLnBsYXlzaW5saW5lID0gdHJ1ZTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAodGhpcy5tZWRpYS5oYXNBdHRyaWJ1dGUoJ211dGVkJykpIHtcbiAgICAgICAgICAgIHRoaXMuY29uZmlnLm11dGVkID0gdHJ1ZTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAodGhpcy5tZWRpYS5oYXNBdHRyaWJ1dGUoJ2xvb3AnKSkge1xuICAgICAgICAgICAgdGhpcy5jb25maWcubG9vcC5hY3RpdmUgPSB0cnVlO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgdGhpcy5kZWJ1Zy5lcnJvcignU2V0dXAgZmFpbGVkOiB1bnN1cHBvcnRlZCB0eXBlJyk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgfSAvLyBDaGVjayBmb3Igc3VwcG9ydCBhZ2FpbiBidXQgd2l0aCB0eXBlXG5cblxuICAgICAgdGhpcy5zdXBwb3J0ZWQgPSBzdXBwb3J0LmNoZWNrKHRoaXMudHlwZSwgdGhpcy5wcm92aWRlciwgdGhpcy5jb25maWcucGxheXNpbmxpbmUpOyAvLyBJZiBubyBzdXBwb3J0IGZvciBldmVuIEFQSSwgYmFpbFxuXG4gICAgICBpZiAoIXRoaXMuc3VwcG9ydGVkLmFwaSkge1xuICAgICAgICB0aGlzLmRlYnVnLmVycm9yKCdTZXR1cCBmYWlsZWQ6IG5vIHN1cHBvcnQnKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmV2ZW50TGlzdGVuZXJzID0gW107IC8vIENyZWF0ZSBsaXN0ZW5lcnNcblxuICAgICAgdGhpcy5saXN0ZW5lcnMgPSBuZXcgTGlzdGVuZXJzKHRoaXMpOyAvLyBTZXR1cCBsb2NhbCBzdG9yYWdlIGZvciB1c2VyIHNldHRpbmdzXG5cbiAgICAgIHRoaXMuc3RvcmFnZSA9IG5ldyBTdG9yYWdlKHRoaXMpOyAvLyBTdG9yZSByZWZlcmVuY2VcblxuICAgICAgdGhpcy5tZWRpYS5wbHlyID0gdGhpczsgLy8gV3JhcCBtZWRpYVxuXG4gICAgICBpZiAoIWlzLmVsZW1lbnQodGhpcy5lbGVtZW50cy5jb250YWluZXIpKSB7XG4gICAgICAgIHRoaXMuZWxlbWVudHMuY29udGFpbmVyID0gY3JlYXRlRWxlbWVudCgnZGl2Jywge1xuICAgICAgICAgIHRhYmluZGV4OiAwXG4gICAgICAgIH0pO1xuICAgICAgICB3cmFwKHRoaXMubWVkaWEsIHRoaXMuZWxlbWVudHMuY29udGFpbmVyKTtcbiAgICAgIH0gLy8gTWlncmF0ZSBjdXN0b20gcHJvcGVydGllcyBmcm9tIG1lZGlhIHRvIGNvbnRhaW5lciAoc28gdGhleSB3b3JrIPCfmIkpXG5cblxuICAgICAgdWkubWlncmF0ZVN0eWxlcy5jYWxsKHRoaXMpOyAvLyBBZGQgc3R5bGUgaG9va1xuXG4gICAgICB1aS5hZGRTdHlsZUhvb2suY2FsbCh0aGlzKTsgLy8gU2V0dXAgbWVkaWFcblxuICAgICAgbWVkaWEuc2V0dXAuY2FsbCh0aGlzKTsgLy8gTGlzdGVuIGZvciBldmVudHMgaWYgZGVidWdnaW5nXG5cbiAgICAgIGlmICh0aGlzLmNvbmZpZy5kZWJ1Zykge1xuICAgICAgICBvbi5jYWxsKHRoaXMsIHRoaXMuZWxlbWVudHMuY29udGFpbmVyLCB0aGlzLmNvbmZpZy5ldmVudHMuam9pbignICcpLCBldmVudCA9PiB7XG4gICAgICAgICAgdGhpcy5kZWJ1Zy5sb2coYGV2ZW50OiAke2V2ZW50LnR5cGV9YCk7XG4gICAgICAgIH0pO1xuICAgICAgfSAvLyBTZXR1cCBmdWxsc2NyZWVuXG5cblxuICAgICAgdGhpcy5mdWxsc2NyZWVuID0gbmV3IEZ1bGxzY3JlZW4odGhpcyk7IC8vIFNldHVwIGludGVyZmFjZVxuICAgICAgLy8gSWYgZW1iZWQgYnV0IG5vdCBmdWxseSBzdXBwb3J0ZWQsIGJ1aWxkIGludGVyZmFjZSBub3cgdG8gYXZvaWQgZmxhc2ggb2YgY29udHJvbHNcblxuICAgICAgaWYgKHRoaXMuaXNIVE1MNSB8fCB0aGlzLmlzRW1iZWQgJiYgIXRoaXMuc3VwcG9ydGVkLnVpKSB7XG4gICAgICAgIHVpLmJ1aWxkLmNhbGwodGhpcyk7XG4gICAgICB9IC8vIENvbnRhaW5lciBsaXN0ZW5lcnNcblxuXG4gICAgICB0aGlzLmxpc3RlbmVycy5jb250YWluZXIoKTsgLy8gR2xvYmFsIGxpc3RlbmVyc1xuXG4gICAgICB0aGlzLmxpc3RlbmVycy5nbG9iYWwoKTsgLy8gU2V0dXAgYWRzIGlmIHByb3ZpZGVkXG5cbiAgICAgIGlmICh0aGlzLmNvbmZpZy5hZHMuZW5hYmxlZCkge1xuICAgICAgICB0aGlzLmFkcyA9IG5ldyBBZHModGhpcyk7XG4gICAgICB9IC8vIEF1dG9wbGF5IGlmIHJlcXVpcmVkXG5cblxuICAgICAgaWYgKHRoaXMuaXNIVE1MNSAmJiB0aGlzLmNvbmZpZy5hdXRvcGxheSkge1xuICAgICAgICB0aGlzLm9uY2UoJ2NhbnBsYXknLCAoKSA9PiBzaWxlbmNlUHJvbWlzZSh0aGlzLnBsYXkoKSkpO1xuICAgICAgfSAvLyBTZWVrIHRpbWUgd2lsbCBiZSByZWNvcmRlZCAoaW4gbGlzdGVuZXJzLmpzKSBzbyB3ZSBjYW4gcHJldmVudCBoaWRpbmcgY29udHJvbHMgZm9yIGEgZmV3IHNlY29uZHMgYWZ0ZXIgc2Vla1xuXG5cbiAgICAgIHRoaXMubGFzdFNlZWtUaW1lID0gMDsgLy8gU2V0dXAgcHJldmlldyB0aHVtYm5haWxzIGlmIGVuYWJsZWRcblxuICAgICAgaWYgKHRoaXMuY29uZmlnLnByZXZpZXdUaHVtYm5haWxzLmVuYWJsZWQpIHtcbiAgICAgICAgdGhpcy5wcmV2aWV3VGh1bWJuYWlscyA9IG5ldyBQcmV2aWV3VGh1bWJuYWlscyh0aGlzKTtcbiAgICAgIH1cbiAgICB9IC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vIEFQSVxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gICAgLyoqXG4gICAgICogVHlwZXMgYW5kIHByb3ZpZGVyIGhlbHBlcnNcbiAgICAgKi9cblxuXG4gICAgZ2V0IGlzSFRNTDUoKSB7XG4gICAgICByZXR1cm4gdGhpcy5wcm92aWRlciA9PT0gcHJvdmlkZXJzLmh0bWw1O1xuICAgIH1cblxuICAgIGdldCBpc0VtYmVkKCkge1xuICAgICAgcmV0dXJuIHRoaXMuaXNZb3VUdWJlIHx8IHRoaXMuaXNWaW1lbztcbiAgICB9XG5cbiAgICBnZXQgaXNZb3VUdWJlKCkge1xuICAgICAgcmV0dXJuIHRoaXMucHJvdmlkZXIgPT09IHByb3ZpZGVycy55b3V0dWJlO1xuICAgIH1cblxuICAgIGdldCBpc1ZpbWVvKCkge1xuICAgICAgcmV0dXJuIHRoaXMucHJvdmlkZXIgPT09IHByb3ZpZGVycy52aW1lbztcbiAgICB9XG5cbiAgICBnZXQgaXNWaWRlbygpIHtcbiAgICAgIHJldHVybiB0aGlzLnR5cGUgPT09IHR5cGVzLnZpZGVvO1xuICAgIH1cblxuICAgIGdldCBpc0F1ZGlvKCkge1xuICAgICAgcmV0dXJuIHRoaXMudHlwZSA9PT0gdHlwZXMuYXVkaW87XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFBsYXkgdGhlIG1lZGlhLCBvciBwbGF5IHRoZSBhZHZlcnRpc2VtZW50IChpZiB0aGV5IGFyZSBub3QgYmxvY2tlZClcbiAgICAgKi9cblxuXG4gICAgLyoqXG4gICAgICogR2V0IHBsYXlpbmcgc3RhdGVcbiAgICAgKi9cbiAgICBnZXQgcGxheWluZygpIHtcbiAgICAgIHJldHVybiBCb29sZWFuKHRoaXMucmVhZHkgJiYgIXRoaXMucGF1c2VkICYmICF0aGlzLmVuZGVkKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogR2V0IHBhdXNlZCBzdGF0ZVxuICAgICAqL1xuXG5cbiAgICBnZXQgcGF1c2VkKCkge1xuICAgICAgcmV0dXJuIEJvb2xlYW4odGhpcy5tZWRpYS5wYXVzZWQpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBHZXQgc3RvcHBlZCBzdGF0ZVxuICAgICAqL1xuXG5cbiAgICBnZXQgc3RvcHBlZCgpIHtcbiAgICAgIHJldHVybiBCb29sZWFuKHRoaXMucGF1c2VkICYmIHRoaXMuY3VycmVudFRpbWUgPT09IDApO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBHZXQgZW5kZWQgc3RhdGVcbiAgICAgKi9cblxuXG4gICAgZ2V0IGVuZGVkKCkge1xuICAgICAgcmV0dXJuIEJvb2xlYW4odGhpcy5tZWRpYS5lbmRlZCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRvZ2dsZSBwbGF5YmFjayBiYXNlZCBvbiBjdXJyZW50IHN0YXR1c1xuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gaW5wdXRcbiAgICAgKi9cblxuXG4gICAgLyoqXG4gICAgICogU2VlayB0byBhIHRpbWVcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gaW5wdXQgLSB3aGVyZSB0byBzZWVrIHRvIGluIHNlY29uZHMuIERlZmF1bHRzIHRvIDAgKHRoZSBzdGFydClcbiAgICAgKi9cbiAgICBzZXQgY3VycmVudFRpbWUoaW5wdXQpIHtcbiAgICAgIC8vIEJhaWwgaWYgbWVkaWEgZHVyYXRpb24gaXNuJ3QgYXZhaWxhYmxlIHlldFxuICAgICAgaWYgKCF0aGlzLmR1cmF0aW9uKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH0gLy8gVmFsaWRhdGUgaW5wdXRcblxuXG4gICAgICBjb25zdCBpbnB1dElzVmFsaWQgPSBpcy5udW1iZXIoaW5wdXQpICYmIGlucHV0ID4gMDsgLy8gU2V0XG5cbiAgICAgIHRoaXMubWVkaWEuY3VycmVudFRpbWUgPSBpbnB1dElzVmFsaWQgPyBNYXRoLm1pbihpbnB1dCwgdGhpcy5kdXJhdGlvbikgOiAwOyAvLyBMb2dnaW5nXG5cbiAgICAgIHRoaXMuZGVidWcubG9nKGBTZWVraW5nIHRvICR7dGhpcy5jdXJyZW50VGltZX0gc2Vjb25kc2ApO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBHZXQgY3VycmVudCB0aW1lXG4gICAgICovXG5cblxuICAgIGdldCBjdXJyZW50VGltZSgpIHtcbiAgICAgIHJldHVybiBOdW1iZXIodGhpcy5tZWRpYS5jdXJyZW50VGltZSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEdldCBidWZmZXJlZFxuICAgICAqL1xuXG5cbiAgICBnZXQgYnVmZmVyZWQoKSB7XG4gICAgICBjb25zdCB7XG4gICAgICAgIGJ1ZmZlcmVkXG4gICAgICB9ID0gdGhpcy5tZWRpYTsgLy8gWW91VHViZSAvIFZpbWVvIHJldHVybiBhIGZsb2F0IGJldHdlZW4gMC0xXG5cbiAgICAgIGlmIChpcy5udW1iZXIoYnVmZmVyZWQpKSB7XG4gICAgICAgIHJldHVybiBidWZmZXJlZDtcbiAgICAgIH0gLy8gSFRNTDVcbiAgICAgIC8vIFRPRE86IEhhbmRsZSBidWZmZXJlZCBjaHVua3Mgb2YgdGhlIG1lZGlhXG4gICAgICAvLyAoaS5lLiBzZWVrIHRvIGFub3RoZXIgc2VjdGlvbiBidWZmZXJzIG9ubHkgdGhhdCBzZWN0aW9uKVxuXG5cbiAgICAgIGlmIChidWZmZXJlZCAmJiBidWZmZXJlZC5sZW5ndGggJiYgdGhpcy5kdXJhdGlvbiA+IDApIHtcbiAgICAgICAgcmV0dXJuIGJ1ZmZlcmVkLmVuZCgwKSAvIHRoaXMuZHVyYXRpb247XG4gICAgICB9XG5cbiAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBHZXQgc2Vla2luZyBzdGF0dXNcbiAgICAgKi9cblxuXG4gICAgZ2V0IHNlZWtpbmcoKSB7XG4gICAgICByZXR1cm4gQm9vbGVhbih0aGlzLm1lZGlhLnNlZWtpbmcpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBHZXQgdGhlIGR1cmF0aW9uIG9mIHRoZSBjdXJyZW50IG1lZGlhXG4gICAgICovXG5cblxuICAgIGdldCBkdXJhdGlvbigpIHtcbiAgICAgIC8vIEZhdXggZHVyYXRpb24gc2V0IHZpYSBjb25maWdcbiAgICAgIGNvbnN0IGZhdXhEdXJhdGlvbiA9IHBhcnNlRmxvYXQodGhpcy5jb25maWcuZHVyYXRpb24pOyAvLyBNZWRpYSBkdXJhdGlvbiBjYW4gYmUgTmFOIG9yIEluZmluaXR5IGJlZm9yZSB0aGUgbWVkaWEgaGFzIGxvYWRlZFxuXG4gICAgICBjb25zdCByZWFsRHVyYXRpb24gPSAodGhpcy5tZWRpYSB8fCB7fSkuZHVyYXRpb247XG4gICAgICBjb25zdCBkdXJhdGlvbiA9ICFpcy5udW1iZXIocmVhbER1cmF0aW9uKSB8fCByZWFsRHVyYXRpb24gPT09IEluZmluaXR5ID8gMCA6IHJlYWxEdXJhdGlvbjsgLy8gSWYgY29uZmlnIGR1cmF0aW9uIGlzIGZ1bmt5LCB1c2UgcmVndWxhciBkdXJhdGlvblxuXG4gICAgICByZXR1cm4gZmF1eER1cmF0aW9uIHx8IGR1cmF0aW9uO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTZXQgdGhlIHBsYXllciB2b2x1bWVcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gdmFsdWUgLSBtdXN0IGJlIGJldHdlZW4gMCBhbmQgMS4gRGVmYXVsdHMgdG8gdGhlIHZhbHVlIGZyb20gbG9jYWwgc3RvcmFnZSBhbmQgY29uZmlnLnZvbHVtZSBpZiBub3Qgc2V0IGluIHN0b3JhZ2VcbiAgICAgKi9cblxuXG4gICAgc2V0IHZvbHVtZSh2YWx1ZSkge1xuICAgICAgbGV0IHZvbHVtZSA9IHZhbHVlO1xuICAgICAgY29uc3QgbWF4ID0gMTtcbiAgICAgIGNvbnN0IG1pbiA9IDA7XG5cbiAgICAgIGlmIChpcy5zdHJpbmcodm9sdW1lKSkge1xuICAgICAgICB2b2x1bWUgPSBOdW1iZXIodm9sdW1lKTtcbiAgICAgIH0gLy8gTG9hZCB2b2x1bWUgZnJvbSBzdG9yYWdlIGlmIG5vIHZhbHVlIHNwZWNpZmllZFxuXG5cbiAgICAgIGlmICghaXMubnVtYmVyKHZvbHVtZSkpIHtcbiAgICAgICAgdm9sdW1lID0gdGhpcy5zdG9yYWdlLmdldCgndm9sdW1lJyk7XG4gICAgICB9IC8vIFVzZSBjb25maWcgaWYgYWxsIGVsc2UgZmFpbHNcblxuXG4gICAgICBpZiAoIWlzLm51bWJlcih2b2x1bWUpKSB7XG4gICAgICAgICh7XG4gICAgICAgICAgdm9sdW1lXG4gICAgICAgIH0gPSB0aGlzLmNvbmZpZyk7XG4gICAgICB9IC8vIE1heGltdW0gaXMgdm9sdW1lTWF4XG5cblxuICAgICAgaWYgKHZvbHVtZSA+IG1heCkge1xuICAgICAgICB2b2x1bWUgPSBtYXg7XG4gICAgICB9IC8vIE1pbmltdW0gaXMgdm9sdW1lTWluXG5cblxuICAgICAgaWYgKHZvbHVtZSA8IG1pbikge1xuICAgICAgICB2b2x1bWUgPSBtaW47XG4gICAgICB9IC8vIFVwZGF0ZSBjb25maWdcblxuXG4gICAgICB0aGlzLmNvbmZpZy52b2x1bWUgPSB2b2x1bWU7IC8vIFNldCB0aGUgcGxheWVyIHZvbHVtZVxuXG4gICAgICB0aGlzLm1lZGlhLnZvbHVtZSA9IHZvbHVtZTsgLy8gSWYgbXV0ZWQsIGFuZCB3ZSdyZSBpbmNyZWFzaW5nIHZvbHVtZSBtYW51YWxseSwgcmVzZXQgbXV0ZWQgc3RhdGVcblxuICAgICAgaWYgKCFpcy5lbXB0eSh2YWx1ZSkgJiYgdGhpcy5tdXRlZCAmJiB2b2x1bWUgPiAwKSB7XG4gICAgICAgIHRoaXMubXV0ZWQgPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogR2V0IHRoZSBjdXJyZW50IHBsYXllciB2b2x1bWVcbiAgICAgKi9cblxuXG4gICAgZ2V0IHZvbHVtZSgpIHtcbiAgICAgIHJldHVybiBOdW1iZXIodGhpcy5tZWRpYS52b2x1bWUpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBJbmNyZWFzZSB2b2x1bWVcbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IHN0ZXAgLSBIb3cgbXVjaCB0byBkZWNyZWFzZSBieSAoYmV0d2VlbiAwIGFuZCAxKVxuICAgICAqL1xuXG5cbiAgICAvKipcbiAgICAgKiBTZXQgbXV0ZWQgc3RhdGVcbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IG11dGVcbiAgICAgKi9cbiAgICBzZXQgbXV0ZWQobXV0ZSkge1xuICAgICAgbGV0IHRvZ2dsZSA9IG11dGU7IC8vIExvYWQgbXV0ZWQgc3RhdGUgZnJvbSBzdG9yYWdlXG5cbiAgICAgIGlmICghaXMuYm9vbGVhbih0b2dnbGUpKSB7XG4gICAgICAgIHRvZ2dsZSA9IHRoaXMuc3RvcmFnZS5nZXQoJ211dGVkJyk7XG4gICAgICB9IC8vIFVzZSBjb25maWcgaWYgYWxsIGVsc2UgZmFpbHNcblxuXG4gICAgICBpZiAoIWlzLmJvb2xlYW4odG9nZ2xlKSkge1xuICAgICAgICB0b2dnbGUgPSB0aGlzLmNvbmZpZy5tdXRlZDtcbiAgICAgIH0gLy8gVXBkYXRlIGNvbmZpZ1xuXG5cbiAgICAgIHRoaXMuY29uZmlnLm11dGVkID0gdG9nZ2xlOyAvLyBTZXQgbXV0ZSBvbiB0aGUgcGxheWVyXG5cbiAgICAgIHRoaXMubWVkaWEubXV0ZWQgPSB0b2dnbGU7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEdldCBjdXJyZW50IG11dGVkIHN0YXRlXG4gICAgICovXG5cblxuICAgIGdldCBtdXRlZCgpIHtcbiAgICAgIHJldHVybiBCb29sZWFuKHRoaXMubWVkaWEubXV0ZWQpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDaGVjayBpZiB0aGUgbWVkaWEgaGFzIGF1ZGlvXG4gICAgICovXG5cblxuICAgIGdldCBoYXNBdWRpbygpIHtcbiAgICAgIC8vIEFzc3VtZSB5ZXMgZm9yIGFsbCBub24gSFRNTDUgKGFzIHdlIGNhbid0IHRlbGwuLi4pXG4gICAgICBpZiAoIXRoaXMuaXNIVE1MNSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMuaXNBdWRpbykge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH0gLy8gR2V0IGF1ZGlvIHRyYWNrc1xuXG5cbiAgICAgIHJldHVybiBCb29sZWFuKHRoaXMubWVkaWEubW96SGFzQXVkaW8pIHx8IEJvb2xlYW4odGhpcy5tZWRpYS53ZWJraXRBdWRpb0RlY29kZWRCeXRlQ291bnQpIHx8IEJvb2xlYW4odGhpcy5tZWRpYS5hdWRpb1RyYWNrcyAmJiB0aGlzLm1lZGlhLmF1ZGlvVHJhY2tzLmxlbmd0aCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNldCBwbGF5YmFjayBzcGVlZFxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBpbnB1dCAtIHRoZSBzcGVlZCBvZiBwbGF5YmFjayAoMC41LTIuMClcbiAgICAgKi9cblxuXG4gICAgc2V0IHNwZWVkKGlucHV0KSB7XG4gICAgICBsZXQgc3BlZWQgPSBudWxsO1xuXG4gICAgICBpZiAoaXMubnVtYmVyKGlucHV0KSkge1xuICAgICAgICBzcGVlZCA9IGlucHV0O1xuICAgICAgfVxuXG4gICAgICBpZiAoIWlzLm51bWJlcihzcGVlZCkpIHtcbiAgICAgICAgc3BlZWQgPSB0aGlzLnN0b3JhZ2UuZ2V0KCdzcGVlZCcpO1xuICAgICAgfVxuXG4gICAgICBpZiAoIWlzLm51bWJlcihzcGVlZCkpIHtcbiAgICAgICAgc3BlZWQgPSB0aGlzLmNvbmZpZy5zcGVlZC5zZWxlY3RlZDtcbiAgICAgIH0gLy8gQ2xhbXAgdG8gbWluL21heFxuXG5cbiAgICAgIGNvbnN0IHtcbiAgICAgICAgbWluaW11bVNwZWVkOiBtaW4sXG4gICAgICAgIG1heGltdW1TcGVlZDogbWF4XG4gICAgICB9ID0gdGhpcztcbiAgICAgIHNwZWVkID0gY2xhbXAoc3BlZWQsIG1pbiwgbWF4KTsgLy8gVXBkYXRlIGNvbmZpZ1xuXG4gICAgICB0aGlzLmNvbmZpZy5zcGVlZC5zZWxlY3RlZCA9IHNwZWVkOyAvLyBTZXQgbWVkaWEgc3BlZWRcblxuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIGlmICh0aGlzLm1lZGlhKSB7XG4gICAgICAgICAgdGhpcy5tZWRpYS5wbGF5YmFja1JhdGUgPSBzcGVlZDtcbiAgICAgICAgfVxuICAgICAgfSwgMCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEdldCBjdXJyZW50IHBsYXliYWNrIHNwZWVkXG4gICAgICovXG5cblxuICAgIGdldCBzcGVlZCgpIHtcbiAgICAgIHJldHVybiBOdW1iZXIodGhpcy5tZWRpYS5wbGF5YmFja1JhdGUpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBHZXQgdGhlIG1pbmltdW0gYWxsb3dlZCBzcGVlZFxuICAgICAqL1xuXG5cbiAgICBnZXQgbWluaW11bVNwZWVkKCkge1xuICAgICAgaWYgKHRoaXMuaXNZb3VUdWJlKSB7XG4gICAgICAgIC8vIGh0dHBzOi8vZGV2ZWxvcGVycy5nb29nbGUuY29tL3lvdXR1YmUvaWZyYW1lX2FwaV9yZWZlcmVuY2Ujc2V0UGxheWJhY2tSYXRlXG4gICAgICAgIHJldHVybiBNYXRoLm1pbiguLi50aGlzLm9wdGlvbnMuc3BlZWQpO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5pc1ZpbWVvKSB7XG4gICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS92aW1lby9wbGF5ZXIuanMvI3NldHBsYXliYWNrcmF0ZXBsYXliYWNrcmF0ZS1udW1iZXItcHJvbWlzZW51bWJlci1yYW5nZWVycm9yZXJyb3JcbiAgICAgICAgcmV0dXJuIDAuNTtcbiAgICAgIH0gLy8gaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9hLzMyMzIwMDIwLzExOTEzMTlcblxuXG4gICAgICByZXR1cm4gMC4wNjI1O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBHZXQgdGhlIG1heGltdW0gYWxsb3dlZCBzcGVlZFxuICAgICAqL1xuXG5cbiAgICBnZXQgbWF4aW11bVNwZWVkKCkge1xuICAgICAgaWYgKHRoaXMuaXNZb3VUdWJlKSB7XG4gICAgICAgIC8vIGh0dHBzOi8vZGV2ZWxvcGVycy5nb29nbGUuY29tL3lvdXR1YmUvaWZyYW1lX2FwaV9yZWZlcmVuY2Ujc2V0UGxheWJhY2tSYXRlXG4gICAgICAgIHJldHVybiBNYXRoLm1heCguLi50aGlzLm9wdGlvbnMuc3BlZWQpO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5pc1ZpbWVvKSB7XG4gICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS92aW1lby9wbGF5ZXIuanMvI3NldHBsYXliYWNrcmF0ZXBsYXliYWNrcmF0ZS1udW1iZXItcHJvbWlzZW51bWJlci1yYW5nZWVycm9yZXJyb3JcbiAgICAgICAgcmV0dXJuIDI7XG4gICAgICB9IC8vIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vYS8zMjMyMDAyMC8xMTkxMzE5XG5cblxuICAgICAgcmV0dXJuIDE2O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTZXQgcGxheWJhY2sgcXVhbGl0eVxuICAgICAqIEN1cnJlbnRseSBIVE1MNSAmIFlvdVR1YmUgb25seVxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBpbnB1dCAtIFF1YWxpdHkgbGV2ZWxcbiAgICAgKi9cblxuXG4gICAgc2V0IHF1YWxpdHkoaW5wdXQpIHtcbiAgICAgIGNvbnN0IGNvbmZpZyA9IHRoaXMuY29uZmlnLnF1YWxpdHk7XG4gICAgICBjb25zdCBvcHRpb25zID0gdGhpcy5vcHRpb25zLnF1YWxpdHk7XG5cbiAgICAgIGlmICghb3B0aW9ucy5sZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBsZXQgcXVhbGl0eSA9IFshaXMuZW1wdHkoaW5wdXQpICYmIE51bWJlcihpbnB1dCksIHRoaXMuc3RvcmFnZS5nZXQoJ3F1YWxpdHknKSwgY29uZmlnLnNlbGVjdGVkLCBjb25maWcuZGVmYXVsdF0uZmluZChpcy5udW1iZXIpO1xuICAgICAgbGV0IHVwZGF0ZVN0b3JhZ2UgPSB0cnVlO1xuXG4gICAgICBpZiAoIW9wdGlvbnMuaW5jbHVkZXMocXVhbGl0eSkpIHtcbiAgICAgICAgY29uc3QgdmFsdWUgPSBjbG9zZXN0KG9wdGlvbnMsIHF1YWxpdHkpO1xuICAgICAgICB0aGlzLmRlYnVnLndhcm4oYFVuc3VwcG9ydGVkIHF1YWxpdHkgb3B0aW9uOiAke3F1YWxpdHl9LCB1c2luZyAke3ZhbHVlfSBpbnN0ZWFkYCk7XG4gICAgICAgIHF1YWxpdHkgPSB2YWx1ZTsgLy8gRG9uJ3QgdXBkYXRlIHN0b3JhZ2UgaWYgcXVhbGl0eSBpcyBub3Qgc3VwcG9ydGVkXG5cbiAgICAgICAgdXBkYXRlU3RvcmFnZSA9IGZhbHNlO1xuICAgICAgfSAvLyBVcGRhdGUgY29uZmlnXG5cblxuICAgICAgY29uZmlnLnNlbGVjdGVkID0gcXVhbGl0eTsgLy8gU2V0IHF1YWxpdHlcblxuICAgICAgdGhpcy5tZWRpYS5xdWFsaXR5ID0gcXVhbGl0eTsgLy8gU2F2ZSB0byBzdG9yYWdlXG5cbiAgICAgIGlmICh1cGRhdGVTdG9yYWdlKSB7XG4gICAgICAgIHRoaXMuc3RvcmFnZS5zZXQoe1xuICAgICAgICAgIHF1YWxpdHlcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEdldCBjdXJyZW50IHF1YWxpdHkgbGV2ZWxcbiAgICAgKi9cblxuXG4gICAgZ2V0IHF1YWxpdHkoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tZWRpYS5xdWFsaXR5O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBUb2dnbGUgbG9vcFxuICAgICAqIFRPRE86IEZpbmlzaCBmYW5jeSBuZXcgbG9naWMuIFNldCB0aGUgaW5kaWNhdG9yIG9uIGxvYWQgYXMgdXNlciBtYXkgcGFzcyBsb29wIGFzIGNvbmZpZ1xuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gaW5wdXQgLSBXaGV0aGVyIHRvIGxvb3Agb3Igbm90XG4gICAgICovXG5cblxuICAgIHNldCBsb29wKGlucHV0KSB7XG4gICAgICBjb25zdCB0b2dnbGUgPSBpcy5ib29sZWFuKGlucHV0KSA/IGlucHV0IDogdGhpcy5jb25maWcubG9vcC5hY3RpdmU7XG4gICAgICB0aGlzLmNvbmZpZy5sb29wLmFjdGl2ZSA9IHRvZ2dsZTtcbiAgICAgIHRoaXMubWVkaWEubG9vcCA9IHRvZ2dsZTsgLy8gU2V0IGRlZmF1bHQgdG8gYmUgYSB0cnVlIHRvZ2dsZVxuXG4gICAgICAvKiBjb25zdCB0eXBlID0gWydzdGFydCcsICdlbmQnLCAnYWxsJywgJ25vbmUnLCAndG9nZ2xlJ10uaW5jbHVkZXMoaW5wdXQpID8gaW5wdXQgOiAndG9nZ2xlJztcbiAgICAgICAgICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICAgICAgICAgIGNhc2UgJ3N0YXJ0JzpcbiAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbmZpZy5sb29wLmVuZCAmJiB0aGlzLmNvbmZpZy5sb29wLmVuZCA8PSB0aGlzLmN1cnJlbnRUaW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25maWcubG9vcC5lbmQgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgdGhpcy5jb25maWcubG9vcC5zdGFydCA9IHRoaXMuY3VycmVudFRpbWU7XG4gICAgICAgICAgICAgICAgICAvLyB0aGlzLmNvbmZpZy5sb29wLmluZGljYXRvci5zdGFydCA9IHRoaXMuZWxlbWVudHMuZGlzcGxheS5wbGF5ZWQudmFsdWU7XG4gICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgIGNhc2UgJ2VuZCc6XG4gICAgICAgICAgICAgICAgICBpZiAodGhpcy5jb25maWcubG9vcC5zdGFydCA+PSB0aGlzLmN1cnJlbnRUaW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZy5sb29wLmVuZCA9IHRoaXMuY3VycmVudFRpbWU7XG4gICAgICAgICAgICAgICAgICAvLyB0aGlzLmNvbmZpZy5sb29wLmluZGljYXRvci5lbmQgPSB0aGlzLmVsZW1lbnRzLmRpc3BsYXkucGxheWVkLnZhbHVlO1xuICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICBjYXNlICdhbGwnOlxuICAgICAgICAgICAgICAgICAgdGhpcy5jb25maWcubG9vcC5zdGFydCA9IDA7XG4gICAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZy5sb29wLmVuZCA9IHRoaXMuZHVyYXRpb24gLSAyO1xuICAgICAgICAgICAgICAgICAgdGhpcy5jb25maWcubG9vcC5pbmRpY2F0b3Iuc3RhcnQgPSAwO1xuICAgICAgICAgICAgICAgICAgdGhpcy5jb25maWcubG9vcC5pbmRpY2F0b3IuZW5kID0gMTAwO1xuICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICBjYXNlICd0b2dnbGUnOlxuICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuY29uZmlnLmxvb3AuYWN0aXZlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25maWcubG9vcC5zdGFydCA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25maWcubG9vcC5lbmQgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZy5sb29wLnN0YXJ0ID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZy5sb29wLmVuZCA9IHRoaXMuZHVyYXRpb24gLSAyO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgdGhpcy5jb25maWcubG9vcC5zdGFydCA9IDA7XG4gICAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZy5sb29wLmVuZCA9IG51bGw7XG4gICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9ICovXG4gICAgfVxuICAgIC8qKlxuICAgICAqIEdldCBjdXJyZW50IGxvb3Agc3RhdGVcbiAgICAgKi9cblxuXG4gICAgZ2V0IGxvb3AoKSB7XG4gICAgICByZXR1cm4gQm9vbGVhbih0aGlzLm1lZGlhLmxvb3ApO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTZXQgbmV3IG1lZGlhIHNvdXJjZVxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBpbnB1dCAtIFRoZSBuZXcgc291cmNlIG9iamVjdCAoc2VlIGRvY3MpXG4gICAgICovXG5cblxuICAgIHNldCBzb3VyY2UoaW5wdXQpIHtcbiAgICAgIHNvdXJjZS5jaGFuZ2UuY2FsbCh0aGlzLCBpbnB1dCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEdldCBjdXJyZW50IHNvdXJjZVxuICAgICAqL1xuXG5cbiAgICBnZXQgc291cmNlKCkge1xuICAgICAgcmV0dXJuIHRoaXMubWVkaWEuY3VycmVudFNyYztcbiAgICB9XG4gICAgLyoqXG4gICAgICogR2V0IGEgZG93bmxvYWQgVVJMIChlaXRoZXIgc291cmNlIG9yIGN1c3RvbSlcbiAgICAgKi9cblxuXG4gICAgZ2V0IGRvd25sb2FkKCkge1xuICAgICAgY29uc3Qge1xuICAgICAgICBkb3dubG9hZFxuICAgICAgfSA9IHRoaXMuY29uZmlnLnVybHM7XG4gICAgICByZXR1cm4gaXMudXJsKGRvd25sb2FkKSA/IGRvd25sb2FkIDogdGhpcy5zb3VyY2U7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNldCB0aGUgZG93bmxvYWQgVVJMXG4gICAgICovXG5cblxuICAgIHNldCBkb3dubG9hZChpbnB1dCkge1xuICAgICAgaWYgKCFpcy51cmwoaW5wdXQpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgdGhpcy5jb25maWcudXJscy5kb3dubG9hZCA9IGlucHV0O1xuICAgICAgY29udHJvbHMuc2V0RG93bmxvYWRVcmwuY2FsbCh0aGlzKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU2V0IHRoZSBwb3N0ZXIgaW1hZ2UgZm9yIGEgdmlkZW9cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gaW5wdXQgLSB0aGUgVVJMIGZvciB0aGUgbmV3IHBvc3RlciBpbWFnZVxuICAgICAqL1xuXG5cbiAgICBzZXQgcG9zdGVyKGlucHV0KSB7XG4gICAgICBpZiAoIXRoaXMuaXNWaWRlbykge1xuICAgICAgICB0aGlzLmRlYnVnLndhcm4oJ1Bvc3RlciBjYW4gb25seSBiZSBzZXQgZm9yIHZpZGVvJyk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgdWkuc2V0UG9zdGVyLmNhbGwodGhpcywgaW5wdXQsIGZhbHNlKS5jYXRjaCgoKSA9PiB7fSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEdldCB0aGUgY3VycmVudCBwb3N0ZXIgaW1hZ2VcbiAgICAgKi9cblxuXG4gICAgZ2V0IHBvc3RlcigpIHtcbiAgICAgIGlmICghdGhpcy5pc1ZpZGVvKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGhpcy5tZWRpYS5nZXRBdHRyaWJ1dGUoJ3Bvc3RlcicpIHx8IHRoaXMubWVkaWEuZ2V0QXR0cmlidXRlKCdkYXRhLXBvc3RlcicpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBHZXQgdGhlIGN1cnJlbnQgYXNwZWN0IHJhdGlvIGluIHVzZVxuICAgICAqL1xuXG5cbiAgICBnZXQgcmF0aW8oKSB7XG4gICAgICBpZiAoIXRoaXMuaXNWaWRlbykge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cblxuICAgICAgY29uc3QgcmF0aW8gPSByZWR1Y2VBc3BlY3RSYXRpbyhnZXRBc3BlY3RSYXRpby5jYWxsKHRoaXMpKTtcbiAgICAgIHJldHVybiBpcy5hcnJheShyYXRpbykgPyByYXRpby5qb2luKCc6JykgOiByYXRpbztcbiAgICB9XG4gICAgLyoqXG4gICAgICogU2V0IHZpZGVvIGFzcGVjdCByYXRpb1xuICAgICAqL1xuXG5cbiAgICBzZXQgcmF0aW8oaW5wdXQpIHtcbiAgICAgIGlmICghdGhpcy5pc1ZpZGVvKSB7XG4gICAgICAgIHRoaXMuZGVidWcud2FybignQXNwZWN0IHJhdGlvIGNhbiBvbmx5IGJlIHNldCBmb3IgdmlkZW8nKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBpZiAoIWlzLnN0cmluZyhpbnB1dCkgfHwgIXZhbGlkYXRlQXNwZWN0UmF0aW8oaW5wdXQpKSB7XG4gICAgICAgIHRoaXMuZGVidWcuZXJyb3IoYEludmFsaWQgYXNwZWN0IHJhdGlvIHNwZWNpZmllZCAoJHtpbnB1dH0pYCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgdGhpcy5jb25maWcucmF0aW8gPSByZWR1Y2VBc3BlY3RSYXRpbyhpbnB1dCk7XG4gICAgICBzZXRBc3BlY3RSYXRpby5jYWxsKHRoaXMpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTZXQgdGhlIGF1dG9wbGF5IHN0YXRlXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBpbnB1dCAtIFdoZXRoZXIgdG8gYXV0b3BsYXkgb3Igbm90XG4gICAgICovXG5cblxuICAgIHNldCBhdXRvcGxheShpbnB1dCkge1xuICAgICAgdGhpcy5jb25maWcuYXV0b3BsYXkgPSBpcy5ib29sZWFuKGlucHV0KSA/IGlucHV0IDogdGhpcy5jb25maWcuYXV0b3BsYXk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEdldCB0aGUgY3VycmVudCBhdXRvcGxheSBzdGF0ZVxuICAgICAqL1xuXG5cbiAgICBnZXQgYXV0b3BsYXkoKSB7XG4gICAgICByZXR1cm4gQm9vbGVhbih0aGlzLmNvbmZpZy5hdXRvcGxheSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRvZ2dsZSBjYXB0aW9uc1xuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gaW5wdXQgLSBXaGV0aGVyIHRvIGVuYWJsZSBjYXB0aW9uc1xuICAgICAqL1xuXG5cbiAgICB0b2dnbGVDYXB0aW9ucyhpbnB1dCkge1xuICAgICAgY2FwdGlvbnMudG9nZ2xlLmNhbGwodGhpcywgaW5wdXQsIGZhbHNlKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU2V0IHRoZSBjYXB0aW9uIHRyYWNrIGJ5IGluZGV4XG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IGlucHV0IC0gQ2FwdGlvbiBpbmRleFxuICAgICAqL1xuXG5cbiAgICBzZXQgY3VycmVudFRyYWNrKGlucHV0KSB7XG4gICAgICBjYXB0aW9ucy5zZXQuY2FsbCh0aGlzLCBpbnB1dCwgZmFsc2UpO1xuICAgICAgY2FwdGlvbnMuc2V0dXAuY2FsbCh0aGlzKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogR2V0IHRoZSBjdXJyZW50IGNhcHRpb24gdHJhY2sgaW5kZXggKC0xIGlmIGRpc2FibGVkKVxuICAgICAqL1xuXG5cbiAgICBnZXQgY3VycmVudFRyYWNrKCkge1xuICAgICAgY29uc3Qge1xuICAgICAgICB0b2dnbGVkLFxuICAgICAgICBjdXJyZW50VHJhY2tcbiAgICAgIH0gPSB0aGlzLmNhcHRpb25zO1xuICAgICAgcmV0dXJuIHRvZ2dsZWQgPyBjdXJyZW50VHJhY2sgOiAtMTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU2V0IHRoZSB3YW50ZWQgbGFuZ3VhZ2UgZm9yIGNhcHRpb25zXG4gICAgICogU2luY2UgdHJhY2tzIGNhbiBiZSBhZGRlZCBsYXRlciBpdCB3b24ndCB1cGRhdGUgdGhlIGFjdHVhbCBjYXB0aW9uIHRyYWNrIHVudGlsIHRoZXJlIGlzIGEgbWF0Y2hpbmcgdHJhY2tcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gaW5wdXQgLSBUd28gY2hhcmFjdGVyIElTTyBsYW5ndWFnZSBjb2RlIChlLmcuIEVOLCBGUiwgUFQsIGV0YylcbiAgICAgKi9cblxuXG4gICAgc2V0IGxhbmd1YWdlKGlucHV0KSB7XG4gICAgICBjYXB0aW9ucy5zZXRMYW5ndWFnZS5jYWxsKHRoaXMsIGlucHV0LCBmYWxzZSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEdldCB0aGUgY3VycmVudCB0cmFjaydzIGxhbmd1YWdlXG4gICAgICovXG5cblxuICAgIGdldCBsYW5ndWFnZSgpIHtcbiAgICAgIHJldHVybiAoY2FwdGlvbnMuZ2V0Q3VycmVudFRyYWNrLmNhbGwodGhpcykgfHwge30pLmxhbmd1YWdlO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBUb2dnbGUgcGljdHVyZS1pbi1waWN0dXJlIHBsYXliYWNrIG9uIFdlYktpdC9NYWNPU1xuICAgICAqIFRPRE86IHVwZGF0ZSBwbGF5ZXIgd2l0aCBzdGF0ZSwgc3VwcG9ydCwgZW5hYmxlZFxuICAgICAqIFRPRE86IGRldGVjdCBvdXRzaWRlIGNoYW5nZXNcbiAgICAgKi9cblxuXG4gICAgc2V0IHBpcChpbnB1dCkge1xuICAgICAgLy8gQmFpbCBpZiBubyBzdXBwb3J0XG4gICAgICBpZiAoIXN1cHBvcnQucGlwKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH0gLy8gVG9nZ2xlIGJhc2VkIG9uIGN1cnJlbnQgc3RhdGUgaWYgbm90IHBhc3NlZFxuXG5cbiAgICAgIGNvbnN0IHRvZ2dsZSA9IGlzLmJvb2xlYW4oaW5wdXQpID8gaW5wdXQgOiAhdGhpcy5waXA7IC8vIFRvZ2dsZSBiYXNlZCBvbiBjdXJyZW50IHN0YXRlXG4gICAgICAvLyBTYWZhcmlcblxuICAgICAgaWYgKGlzLmZ1bmN0aW9uKHRoaXMubWVkaWEud2Via2l0U2V0UHJlc2VudGF0aW9uTW9kZSkpIHtcbiAgICAgICAgdGhpcy5tZWRpYS53ZWJraXRTZXRQcmVzZW50YXRpb25Nb2RlKHRvZ2dsZSA/IHBpcC5hY3RpdmUgOiBwaXAuaW5hY3RpdmUpO1xuICAgICAgfSAvLyBDaHJvbWVcblxuXG4gICAgICBpZiAoaXMuZnVuY3Rpb24odGhpcy5tZWRpYS5yZXF1ZXN0UGljdHVyZUluUGljdHVyZSkpIHtcbiAgICAgICAgaWYgKCF0aGlzLnBpcCAmJiB0b2dnbGUpIHtcbiAgICAgICAgICB0aGlzLm1lZGlhLnJlcXVlc3RQaWN0dXJlSW5QaWN0dXJlKCk7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5waXAgJiYgIXRvZ2dsZSkge1xuICAgICAgICAgIGRvY3VtZW50LmV4aXRQaWN0dXJlSW5QaWN0dXJlKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogR2V0IHRoZSBjdXJyZW50IHBpY3R1cmUtaW4tcGljdHVyZSBzdGF0ZVxuICAgICAqL1xuXG5cbiAgICBnZXQgcGlwKCkge1xuICAgICAgaWYgKCFzdXBwb3J0LnBpcCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0gLy8gU2FmYXJpXG5cblxuICAgICAgaWYgKCFpcy5lbXB0eSh0aGlzLm1lZGlhLndlYmtpdFByZXNlbnRhdGlvbk1vZGUpKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm1lZGlhLndlYmtpdFByZXNlbnRhdGlvbk1vZGUgPT09IHBpcC5hY3RpdmU7XG4gICAgICB9IC8vIENocm9tZVxuXG5cbiAgICAgIHJldHVybiB0aGlzLm1lZGlhID09PSBkb2N1bWVudC5waWN0dXJlSW5QaWN0dXJlRWxlbWVudDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU2V0cyB0aGUgcHJldmlldyB0aHVibW5haWxzIGZvciB0aGUgY3VycmVudCBzb3VyY2VcbiAgICAgKi9cblxuXG4gICAgc2V0UHJldmlld1RodW1ibmFpbHModGh1bWJuYWlsU291cmNlKSB7XG4gICAgICBpZiAodGhpcy5wcmV2aWV3VGh1bWJuYWlscyAmJiB0aGlzLnByZXZpZXdUaHVtYm5haWxzLmxvYWRlZCkge1xuICAgICAgICB0aGlzLnByZXZpZXdUaHVtYm5haWxzLmRlc3Ryb3koKTtcbiAgICAgICAgdGhpcy5wcmV2aWV3VGh1bWJuYWlscyA9IG51bGw7XG4gICAgICB9XG5cbiAgICAgIE9iamVjdC5hc3NpZ24odGhpcy5jb25maWcucHJldmlld1RodW1ibmFpbHMsIHRodW1ibmFpbFNvdXJjZSk7IC8vIENyZWF0ZSBuZXcgaW5zdGFuY2UgaWYgaXQgaXMgc3RpbGwgZW5hYmxlZFxuXG4gICAgICBpZiAodGhpcy5jb25maWcucHJldmlld1RodW1ibmFpbHMuZW5hYmxlZCkge1xuICAgICAgICB0aGlzLnByZXZpZXdUaHVtYm5haWxzID0gbmV3IFByZXZpZXdUaHVtYm5haWxzKHRoaXMpO1xuICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBUcmlnZ2VyIHRoZSBhaXJwbGF5IGRpYWxvZ1xuICAgICAqIFRPRE86IHVwZGF0ZSBwbGF5ZXIgd2l0aCBzdGF0ZSwgc3VwcG9ydCwgZW5hYmxlZFxuICAgICAqL1xuXG5cbiAgICAvKipcbiAgICAgKiBDaGVjayBmb3Igc3VwcG9ydFxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlIC0gUGxheWVyIHR5cGUgKGF1ZGlvL3ZpZGVvKVxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBwcm92aWRlciAtIFByb3ZpZGVyIChodG1sNS95b3V0dWJlL3ZpbWVvKVxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gaW5saW5lIC0gV2hlcmUgcGxheWVyIGhhcyBgcGxheXNpbmxpbmVgIHN0dHJpYnV0ZVxuICAgICAqL1xuICAgIHN0YXRpYyBzdXBwb3J0ZWQodHlwZSwgcHJvdmlkZXIsIGlubGluZSkge1xuICAgICAgcmV0dXJuIHN1cHBvcnQuY2hlY2sodHlwZSwgcHJvdmlkZXIsIGlubGluZSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIExvYWQgYW4gU1ZHIHNwcml0ZSBpbnRvIHRoZSBwYWdlXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHVybCAtIFVSTCBmb3IgdGhlIFNWRyBzcHJpdGVcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW2lkXSAtIFVuaXF1ZSBJRFxuICAgICAqL1xuXG5cbiAgICBzdGF0aWMgbG9hZFNwcml0ZSh1cmwsIGlkKSB7XG4gICAgICByZXR1cm4gbG9hZFNwcml0ZSh1cmwsIGlkKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU2V0dXAgbXVsdGlwbGUgaW5zdGFuY2VzXG4gICAgICogQHBhcmFtIHsqfSBzZWxlY3RvclxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zXG4gICAgICovXG5cblxuICAgIHN0YXRpYyBzZXR1cChzZWxlY3Rvciwgb3B0aW9ucyA9IHt9KSB7XG4gICAgICBsZXQgdGFyZ2V0cyA9IG51bGw7XG5cbiAgICAgIGlmIChpcy5zdHJpbmcoc2VsZWN0b3IpKSB7XG4gICAgICAgIHRhcmdldHMgPSBBcnJheS5mcm9tKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpKTtcbiAgICAgIH0gZWxzZSBpZiAoaXMubm9kZUxpc3Qoc2VsZWN0b3IpKSB7XG4gICAgICAgIHRhcmdldHMgPSBBcnJheS5mcm9tKHNlbGVjdG9yKTtcbiAgICAgIH0gZWxzZSBpZiAoaXMuYXJyYXkoc2VsZWN0b3IpKSB7XG4gICAgICAgIHRhcmdldHMgPSBzZWxlY3Rvci5maWx0ZXIoaXMuZWxlbWVudCk7XG4gICAgICB9XG5cbiAgICAgIGlmIChpcy5lbXB0eSh0YXJnZXRzKSkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRhcmdldHMubWFwKHQgPT4gbmV3IFBseXIodCwgb3B0aW9ucykpO1xuICAgIH1cblxuICB9XG5cbiAgUGx5ci5kZWZhdWx0cyA9IGNsb25lRGVlcChkZWZhdWx0cyk7XG5cbiAgcmV0dXJuIFBseXI7XG5cbn0pKTtcbiIsImZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhlLHQpe2lmKCEoZSBpbnN0YW5jZW9mIHQpKXRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb25cIil9ZnVuY3Rpb24gX2RlZmluZVByb3BlcnRpZXMoZSx0KXtmb3IodmFyIG49MDtuPHQubGVuZ3RoO24rKyl7dmFyIHI9dFtuXTtyLmVudW1lcmFibGU9ci5lbnVtZXJhYmxlfHwhMSxyLmNvbmZpZ3VyYWJsZT0hMCxcInZhbHVlXCJpbiByJiYoci53cml0YWJsZT0hMCksT2JqZWN0LmRlZmluZVByb3BlcnR5KGUsci5rZXkscil9fWZ1bmN0aW9uIF9jcmVhdGVDbGFzcyhlLHQsbil7cmV0dXJuIHQmJl9kZWZpbmVQcm9wZXJ0aWVzKGUucHJvdG90eXBlLHQpLG4mJl9kZWZpbmVQcm9wZXJ0aWVzKGUsbiksZX1mdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkoZSx0LG4pe3JldHVybiB0IGluIGU/T2JqZWN0LmRlZmluZVByb3BlcnR5KGUsdCx7dmFsdWU6bixlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMCx3cml0YWJsZTohMH0pOmVbdF09bixlfWZ1bmN0aW9uIG93bktleXMoZSx0KXt2YXIgbj1PYmplY3Qua2V5cyhlKTtpZihPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKXt2YXIgcj1PYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKGUpO3QmJihyPXIuZmlsdGVyKChmdW5jdGlvbih0KXtyZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihlLHQpLmVudW1lcmFibGV9KSkpLG4ucHVzaC5hcHBseShuLHIpfXJldHVybiBufWZ1bmN0aW9uIF9vYmplY3RTcHJlYWQyKGUpe2Zvcih2YXIgdD0xO3Q8YXJndW1lbnRzLmxlbmd0aDt0Kyspe3ZhciBuPW51bGwhPWFyZ3VtZW50c1t0XT9hcmd1bWVudHNbdF06e307dCUyP293bktleXMoT2JqZWN0KG4pLCEwKS5mb3JFYWNoKChmdW5jdGlvbih0KXtfZGVmaW5lUHJvcGVydHkoZSx0LG5bdF0pfSkpOk9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzP09iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKGUsT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMobikpOm93bktleXMoT2JqZWN0KG4pKS5mb3JFYWNoKChmdW5jdGlvbih0KXtPYmplY3QuZGVmaW5lUHJvcGVydHkoZSx0LE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iobix0KSl9KSl9cmV0dXJuIGV9dmFyIGRlZmF1bHRzPXthZGRDU1M6ITAsdGh1bWJXaWR0aDoxNSx3YXRjaDohMH07ZnVuY3Rpb24gbWF0Y2hlcyhlLHQpe3JldHVybiBmdW5jdGlvbigpe3JldHVybiBBcnJheS5mcm9tKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwodCkpLmluY2x1ZGVzKHRoaXMpfS5jYWxsKGUsdCl9ZnVuY3Rpb24gdHJpZ2dlcihlLHQpe2lmKGUmJnQpe3ZhciBuPW5ldyBFdmVudCh0LHtidWJibGVzOiEwfSk7ZS5kaXNwYXRjaEV2ZW50KG4pfX12YXIgZ2V0Q29uc3RydWN0b3I9ZnVuY3Rpb24oZSl7cmV0dXJuIG51bGwhPWU/ZS5jb25zdHJ1Y3RvcjpudWxsfSxpbnN0YW5jZU9mPWZ1bmN0aW9uKGUsdCl7cmV0dXJuISEoZSYmdCYmZSBpbnN0YW5jZW9mIHQpfSxpc051bGxPclVuZGVmaW5lZD1mdW5jdGlvbihlKXtyZXR1cm4gbnVsbD09ZX0saXNPYmplY3Q9ZnVuY3Rpb24oZSl7cmV0dXJuIGdldENvbnN0cnVjdG9yKGUpPT09T2JqZWN0fSxpc051bWJlcj1mdW5jdGlvbihlKXtyZXR1cm4gZ2V0Q29uc3RydWN0b3IoZSk9PT1OdW1iZXImJiFOdW1iZXIuaXNOYU4oZSl9LGlzU3RyaW5nPWZ1bmN0aW9uKGUpe3JldHVybiBnZXRDb25zdHJ1Y3RvcihlKT09PVN0cmluZ30saXNCb29sZWFuPWZ1bmN0aW9uKGUpe3JldHVybiBnZXRDb25zdHJ1Y3RvcihlKT09PUJvb2xlYW59LGlzRnVuY3Rpb249ZnVuY3Rpb24oZSl7cmV0dXJuIGdldENvbnN0cnVjdG9yKGUpPT09RnVuY3Rpb259LGlzQXJyYXk9ZnVuY3Rpb24oZSl7cmV0dXJuIEFycmF5LmlzQXJyYXkoZSl9LGlzTm9kZUxpc3Q9ZnVuY3Rpb24oZSl7cmV0dXJuIGluc3RhbmNlT2YoZSxOb2RlTGlzdCl9LGlzRWxlbWVudD1mdW5jdGlvbihlKXtyZXR1cm4gaW5zdGFuY2VPZihlLEVsZW1lbnQpfSxpc0V2ZW50PWZ1bmN0aW9uKGUpe3JldHVybiBpbnN0YW5jZU9mKGUsRXZlbnQpfSxpc0VtcHR5PWZ1bmN0aW9uKGUpe3JldHVybiBpc051bGxPclVuZGVmaW5lZChlKXx8KGlzU3RyaW5nKGUpfHxpc0FycmF5KGUpfHxpc05vZGVMaXN0KGUpKSYmIWUubGVuZ3RofHxpc09iamVjdChlKSYmIU9iamVjdC5rZXlzKGUpLmxlbmd0aH0saXM9e251bGxPclVuZGVmaW5lZDppc051bGxPclVuZGVmaW5lZCxvYmplY3Q6aXNPYmplY3QsbnVtYmVyOmlzTnVtYmVyLHN0cmluZzppc1N0cmluZyxib29sZWFuOmlzQm9vbGVhbixmdW5jdGlvbjppc0Z1bmN0aW9uLGFycmF5OmlzQXJyYXksbm9kZUxpc3Q6aXNOb2RlTGlzdCxlbGVtZW50OmlzRWxlbWVudCxldmVudDppc0V2ZW50LGVtcHR5OmlzRW1wdHl9O2Z1bmN0aW9uIGdldERlY2ltYWxQbGFjZXMoZSl7dmFyIHQ9XCJcIi5jb25jYXQoZSkubWF0Y2goLyg/OlxcLihcXGQrKSk/KD86W2VFXShbKy1dP1xcZCspKT8kLyk7cmV0dXJuIHQ/TWF0aC5tYXgoMCwodFsxXT90WzFdLmxlbmd0aDowKS0odFsyXT8rdFsyXTowKSk6MH1mdW5jdGlvbiByb3VuZChlLHQpe2lmKDE+dCl7dmFyIG49Z2V0RGVjaW1hbFBsYWNlcyh0KTtyZXR1cm4gcGFyc2VGbG9hdChlLnRvRml4ZWQobikpfXJldHVybiBNYXRoLnJvdW5kKGUvdCkqdH12YXIgUmFuZ2VUb3VjaD1mdW5jdGlvbigpe2Z1bmN0aW9uIGUodCxuKXtfY2xhc3NDYWxsQ2hlY2sodGhpcyxlKSxpcy5lbGVtZW50KHQpP3RoaXMuZWxlbWVudD10OmlzLnN0cmluZyh0KSYmKHRoaXMuZWxlbWVudD1kb2N1bWVudC5xdWVyeVNlbGVjdG9yKHQpKSxpcy5lbGVtZW50KHRoaXMuZWxlbWVudCkmJmlzLmVtcHR5KHRoaXMuZWxlbWVudC5yYW5nZVRvdWNoKSYmKHRoaXMuY29uZmlnPV9vYmplY3RTcHJlYWQyKHt9LGRlZmF1bHRzLHt9LG4pLHRoaXMuaW5pdCgpKX1yZXR1cm4gX2NyZWF0ZUNsYXNzKGUsW3trZXk6XCJpbml0XCIsdmFsdWU6ZnVuY3Rpb24oKXtlLmVuYWJsZWQmJih0aGlzLmNvbmZpZy5hZGRDU1MmJih0aGlzLmVsZW1lbnQuc3R5bGUudXNlclNlbGVjdD1cIm5vbmVcIix0aGlzLmVsZW1lbnQuc3R5bGUud2ViS2l0VXNlclNlbGVjdD1cIm5vbmVcIix0aGlzLmVsZW1lbnQuc3R5bGUudG91Y2hBY3Rpb249XCJtYW5pcHVsYXRpb25cIiksdGhpcy5saXN0ZW5lcnMoITApLHRoaXMuZWxlbWVudC5yYW5nZVRvdWNoPXRoaXMpfX0se2tleTpcImRlc3Ryb3lcIix2YWx1ZTpmdW5jdGlvbigpe2UuZW5hYmxlZCYmKHRoaXMuY29uZmlnLmFkZENTUyYmKHRoaXMuZWxlbWVudC5zdHlsZS51c2VyU2VsZWN0PVwiXCIsdGhpcy5lbGVtZW50LnN0eWxlLndlYktpdFVzZXJTZWxlY3Q9XCJcIix0aGlzLmVsZW1lbnQuc3R5bGUudG91Y2hBY3Rpb249XCJcIiksdGhpcy5saXN0ZW5lcnMoITEpLHRoaXMuZWxlbWVudC5yYW5nZVRvdWNoPW51bGwpfX0se2tleTpcImxpc3RlbmVyc1wiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciB0PXRoaXMsbj1lP1wiYWRkRXZlbnRMaXN0ZW5lclwiOlwicmVtb3ZlRXZlbnRMaXN0ZW5lclwiO1tcInRvdWNoc3RhcnRcIixcInRvdWNobW92ZVwiLFwidG91Y2hlbmRcIl0uZm9yRWFjaCgoZnVuY3Rpb24oZSl7dC5lbGVtZW50W25dKGUsKGZ1bmN0aW9uKGUpe3JldHVybiB0LnNldChlKX0pLCExKX0pKX19LHtrZXk6XCJnZXRcIix2YWx1ZTpmdW5jdGlvbih0KXtpZighZS5lbmFibGVkfHwhaXMuZXZlbnQodCkpcmV0dXJuIG51bGw7dmFyIG4scj10LnRhcmdldCxpPXQuY2hhbmdlZFRvdWNoZXNbMF0sbz1wYXJzZUZsb2F0KHIuZ2V0QXR0cmlidXRlKFwibWluXCIpKXx8MCxzPXBhcnNlRmxvYXQoci5nZXRBdHRyaWJ1dGUoXCJtYXhcIikpfHwxMDAsdT1wYXJzZUZsb2F0KHIuZ2V0QXR0cmlidXRlKFwic3RlcFwiKSl8fDEsYz1yLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLGE9MTAwL2Mud2lkdGgqKHRoaXMuY29uZmlnLnRodW1iV2lkdGgvMikvMTAwO3JldHVybiAwPihuPTEwMC9jLndpZHRoKihpLmNsaWVudFgtYy5sZWZ0KSk/bj0wOjEwMDxuJiYobj0xMDApLDUwPm4/bi09KDEwMC0yKm4pKmE6NTA8biYmKG4rPTIqKG4tNTApKmEpLG8rcm91bmQobi8xMDAqKHMtbyksdSl9fSx7a2V5Olwic2V0XCIsdmFsdWU6ZnVuY3Rpb24odCl7ZS5lbmFibGVkJiZpcy5ldmVudCh0KSYmIXQudGFyZ2V0LmRpc2FibGVkJiYodC5wcmV2ZW50RGVmYXVsdCgpLHQudGFyZ2V0LnZhbHVlPXRoaXMuZ2V0KHQpLHRyaWdnZXIodC50YXJnZXQsXCJ0b3VjaGVuZFwiPT09dC50eXBlP1wiY2hhbmdlXCI6XCJpbnB1dFwiKSl9fV0sW3trZXk6XCJzZXR1cFwiLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciBuPTE8YXJndW1lbnRzLmxlbmd0aCYmdm9pZCAwIT09YXJndW1lbnRzWzFdP2FyZ3VtZW50c1sxXTp7fSxyPW51bGw7aWYoaXMuZW1wdHkodCl8fGlzLnN0cmluZyh0KT9yPUFycmF5LmZyb20oZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChpcy5zdHJpbmcodCk/dDonaW5wdXRbdHlwZT1cInJhbmdlXCJdJykpOmlzLmVsZW1lbnQodCk/cj1bdF06aXMubm9kZUxpc3QodCk/cj1BcnJheS5mcm9tKHQpOmlzLmFycmF5KHQpJiYocj10LmZpbHRlcihpcy5lbGVtZW50KSksaXMuZW1wdHkocikpcmV0dXJuIG51bGw7dmFyIGk9X29iamVjdFNwcmVhZDIoe30sZGVmYXVsdHMse30sbik7aWYoaXMuc3RyaW5nKHQpJiZpLndhdGNoKXt2YXIgbz1uZXcgTXV0YXRpb25PYnNlcnZlcigoZnVuY3Rpb24obil7QXJyYXkuZnJvbShuKS5mb3JFYWNoKChmdW5jdGlvbihuKXtBcnJheS5mcm9tKG4uYWRkZWROb2RlcykuZm9yRWFjaCgoZnVuY3Rpb24obil7aXMuZWxlbWVudChuKSYmbWF0Y2hlcyhuLHQpJiZuZXcgZShuLGkpfSkpfSkpfSkpO28ub2JzZXJ2ZShkb2N1bWVudC5ib2R5LHtjaGlsZExpc3Q6ITAsc3VidHJlZTohMH0pfXJldHVybiByLm1hcCgoZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBlKHQsbil9KSl9fSx7a2V5OlwiZW5hYmxlZFwiLGdldDpmdW5jdGlvbigpe3JldHVyblwib250b3VjaHN0YXJ0XCJpbiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnR9fV0pLGV9KCk7ZXhwb3J0IGRlZmF1bHQgUmFuZ2VUb3VjaDsiLCIvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gVHlwZSBjaGVja2luZyB1dGlsc1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuY29uc3QgZ2V0Q29uc3RydWN0b3IgPSAoaW5wdXQpID0+IChpbnB1dCAhPT0gbnVsbCAmJiB0eXBlb2YgaW5wdXQgIT09ICd1bmRlZmluZWQnID8gaW5wdXQuY29uc3RydWN0b3IgOiBudWxsKTtcbmNvbnN0IGluc3RhbmNlT2YgPSAoaW5wdXQsIGNvbnN0cnVjdG9yKSA9PiBCb29sZWFuKGlucHV0ICYmIGNvbnN0cnVjdG9yICYmIGlucHV0IGluc3RhbmNlb2YgY29uc3RydWN0b3IpO1xuY29uc3QgaXNOdWxsT3JVbmRlZmluZWQgPSAoaW5wdXQpID0+IGlucHV0ID09PSBudWxsIHx8IHR5cGVvZiBpbnB1dCA9PT0gJ3VuZGVmaW5lZCc7XG5jb25zdCBpc09iamVjdCA9IChpbnB1dCkgPT4gZ2V0Q29uc3RydWN0b3IoaW5wdXQpID09PSBPYmplY3Q7XG5jb25zdCBpc051bWJlciA9IChpbnB1dCkgPT4gZ2V0Q29uc3RydWN0b3IoaW5wdXQpID09PSBOdW1iZXIgJiYgIU51bWJlci5pc05hTihpbnB1dCk7XG5jb25zdCBpc1N0cmluZyA9IChpbnB1dCkgPT4gZ2V0Q29uc3RydWN0b3IoaW5wdXQpID09PSBTdHJpbmc7XG5jb25zdCBpc0Jvb2xlYW4gPSAoaW5wdXQpID0+IGdldENvbnN0cnVjdG9yKGlucHV0KSA9PT0gQm9vbGVhbjtcbmNvbnN0IGlzRnVuY3Rpb24gPSAoaW5wdXQpID0+IGdldENvbnN0cnVjdG9yKGlucHV0KSA9PT0gRnVuY3Rpb247XG5jb25zdCBpc0FycmF5ID0gKGlucHV0KSA9PiBBcnJheS5pc0FycmF5KGlucHV0KTtcbmNvbnN0IGlzV2Vha01hcCA9IChpbnB1dCkgPT4gaW5zdGFuY2VPZihpbnB1dCwgV2Vha01hcCk7XG5jb25zdCBpc05vZGVMaXN0ID0gKGlucHV0KSA9PiBpbnN0YW5jZU9mKGlucHV0LCBOb2RlTGlzdCk7XG5jb25zdCBpc1RleHROb2RlID0gKGlucHV0KSA9PiBnZXRDb25zdHJ1Y3RvcihpbnB1dCkgPT09IFRleHQ7XG5jb25zdCBpc0V2ZW50ID0gKGlucHV0KSA9PiBpbnN0YW5jZU9mKGlucHV0LCBFdmVudCk7XG5jb25zdCBpc0tleWJvYXJkRXZlbnQgPSAoaW5wdXQpID0+IGluc3RhbmNlT2YoaW5wdXQsIEtleWJvYXJkRXZlbnQpO1xuY29uc3QgaXNDdWUgPSAoaW5wdXQpID0+IGluc3RhbmNlT2YoaW5wdXQsIHdpbmRvdy5UZXh0VHJhY2tDdWUpIHx8IGluc3RhbmNlT2YoaW5wdXQsIHdpbmRvdy5WVFRDdWUpO1xuY29uc3QgaXNUcmFjayA9IChpbnB1dCkgPT4gaW5zdGFuY2VPZihpbnB1dCwgVGV4dFRyYWNrKSB8fCAoIWlzTnVsbE9yVW5kZWZpbmVkKGlucHV0KSAmJiBpc1N0cmluZyhpbnB1dC5raW5kKSk7XG5jb25zdCBpc1Byb21pc2UgPSAoaW5wdXQpID0+IGluc3RhbmNlT2YoaW5wdXQsIFByb21pc2UpICYmIGlzRnVuY3Rpb24oaW5wdXQudGhlbik7XG5cbmNvbnN0IGlzRWxlbWVudCA9IChpbnB1dCkgPT5cbiAgaW5wdXQgIT09IG51bGwgJiZcbiAgdHlwZW9mIGlucHV0ID09PSAnb2JqZWN0JyAmJlxuICBpbnB1dC5ub2RlVHlwZSA9PT0gMSAmJlxuICB0eXBlb2YgaW5wdXQuc3R5bGUgPT09ICdvYmplY3QnICYmXG4gIHR5cGVvZiBpbnB1dC5vd25lckRvY3VtZW50ID09PSAnb2JqZWN0JztcblxuY29uc3QgaXNFbXB0eSA9IChpbnB1dCkgPT5cbiAgaXNOdWxsT3JVbmRlZmluZWQoaW5wdXQpIHx8XG4gICgoaXNTdHJpbmcoaW5wdXQpIHx8IGlzQXJyYXkoaW5wdXQpIHx8IGlzTm9kZUxpc3QoaW5wdXQpKSAmJiAhaW5wdXQubGVuZ3RoKSB8fFxuICAoaXNPYmplY3QoaW5wdXQpICYmICFPYmplY3Qua2V5cyhpbnB1dCkubGVuZ3RoKTtcblxuY29uc3QgaXNVcmwgPSAoaW5wdXQpID0+IHtcbiAgLy8gQWNjZXB0IGEgVVJMIG9iamVjdFxuICBpZiAoaW5zdGFuY2VPZihpbnB1dCwgd2luZG93LlVSTCkpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIC8vIE11c3QgYmUgc3RyaW5nIGZyb20gaGVyZVxuICBpZiAoIWlzU3RyaW5nKGlucHV0KSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIC8vIEFkZCB0aGUgcHJvdG9jb2wgaWYgcmVxdWlyZWRcbiAgbGV0IHN0cmluZyA9IGlucHV0O1xuICBpZiAoIWlucHV0LnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCAhaW5wdXQuc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkge1xuICAgIHN0cmluZyA9IGBodHRwOi8vJHtpbnB1dH1gO1xuICB9XG5cbiAgdHJ5IHtcbiAgICByZXR1cm4gIWlzRW1wdHkobmV3IFVSTChzdHJpbmcpLmhvc3RuYW1lKTtcbiAgfSBjYXRjaCAoXykge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufTtcblxuZXhwb3J0IGRlZmF1bHQge1xuICBudWxsT3JVbmRlZmluZWQ6IGlzTnVsbE9yVW5kZWZpbmVkLFxuICBvYmplY3Q6IGlzT2JqZWN0LFxuICBudW1iZXI6IGlzTnVtYmVyLFxuICBzdHJpbmc6IGlzU3RyaW5nLFxuICBib29sZWFuOiBpc0Jvb2xlYW4sXG4gIGZ1bmN0aW9uOiBpc0Z1bmN0aW9uLFxuICBhcnJheTogaXNBcnJheSxcbiAgd2Vha01hcDogaXNXZWFrTWFwLFxuICBub2RlTGlzdDogaXNOb2RlTGlzdCxcbiAgZWxlbWVudDogaXNFbGVtZW50LFxuICB0ZXh0Tm9kZTogaXNUZXh0Tm9kZSxcbiAgZXZlbnQ6IGlzRXZlbnQsXG4gIGtleWJvYXJkRXZlbnQ6IGlzS2V5Ym9hcmRFdmVudCxcbiAgY3VlOiBpc0N1ZSxcbiAgdHJhY2s6IGlzVHJhY2ssXG4gIHByb21pc2U6IGlzUHJvbWlzZSxcbiAgdXJsOiBpc1VybCxcbiAgZW1wdHk6IGlzRW1wdHksXG59O1xuIiwiLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEFuaW1hdGlvbiB1dGlsc1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuaW1wb3J0IGlzIGZyb20gJy4vaXMnO1xuXG5leHBvcnQgY29uc3QgdHJhbnNpdGlvbkVuZEV2ZW50ID0gKCgpID0+IHtcbiAgY29uc3QgZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcblxuICBjb25zdCBldmVudHMgPSB7XG4gICAgV2Via2l0VHJhbnNpdGlvbjogJ3dlYmtpdFRyYW5zaXRpb25FbmQnLFxuICAgIE1velRyYW5zaXRpb246ICd0cmFuc2l0aW9uZW5kJyxcbiAgICBPVHJhbnNpdGlvbjogJ29UcmFuc2l0aW9uRW5kIG90cmFuc2l0aW9uZW5kJyxcbiAgICB0cmFuc2l0aW9uOiAndHJhbnNpdGlvbmVuZCcsXG4gIH07XG5cbiAgY29uc3QgdHlwZSA9IE9iamVjdC5rZXlzKGV2ZW50cykuZmluZCgoZXZlbnQpID0+IGVsZW1lbnQuc3R5bGVbZXZlbnRdICE9PSB1bmRlZmluZWQpO1xuXG4gIHJldHVybiBpcy5zdHJpbmcodHlwZSkgPyBldmVudHNbdHlwZV0gOiBmYWxzZTtcbn0pKCk7XG5cbi8vIEZvcmNlIHJlcGFpbnQgb2YgZWxlbWVudFxuZXhwb3J0IGZ1bmN0aW9uIHJlcGFpbnQoZWxlbWVudCwgZGVsYXkpIHtcbiAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1wYXJhbS1yZWFzc2lnblxuICAgICAgZWxlbWVudC5oaWRkZW4gPSB0cnVlO1xuXG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdW51c2VkLWV4cHJlc3Npb25zXG4gICAgICBlbGVtZW50Lm9mZnNldEhlaWdodDtcblxuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXBhcmFtLXJlYXNzaWduXG4gICAgICBlbGVtZW50LmhpZGRlbiA9IGZhbHNlO1xuICAgIH0gY2F0Y2ggKF8pIHtcbiAgICAgIC8vIERvIG5vdGhpbmdcbiAgICB9XG4gIH0sIGRlbGF5KTtcbn1cbiIsIi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBCcm93c2VyIHNuaWZmaW5nXG4vLyBVbmZvcnR1bmF0ZWx5LCBkdWUgdG8gbWl4ZWQgc3VwcG9ydCwgVUEgc25pZmZpbmcgaXMgcmVxdWlyZWRcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmNvbnN0IGJyb3dzZXIgPSB7XG4gIGlzSUU6IEJvb2xlYW4od2luZG93LmRvY3VtZW50LmRvY3VtZW50TW9kZSksXG4gIGlzRWRnZTogd2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQuaW5jbHVkZXMoJ0VkZ2UnKSxcbiAgaXNXZWJraXQ6ICdXZWJraXRBcHBlYXJhbmNlJyBpbiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc3R5bGUgJiYgIS9FZGdlLy50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpLFxuICBpc0lQaG9uZTogLyhpUGhvbmV8aVBvZCkvZ2kudGVzdChuYXZpZ2F0b3IucGxhdGZvcm0pLFxuICBpc0lvczpcbiAgICAobmF2aWdhdG9yLnBsYXRmb3JtID09PSAnTWFjSW50ZWwnICYmIG5hdmlnYXRvci5tYXhUb3VjaFBvaW50cyA+IDEpIHx8XG4gICAgLyhpUGFkfGlQaG9uZXxpUG9kKS9naS50ZXN0KG5hdmlnYXRvci5wbGF0Zm9ybSksXG59O1xuXG5leHBvcnQgZGVmYXVsdCBicm93c2VyO1xuIiwiLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIE9iamVjdCB1dGlsc1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuaW1wb3J0IGlzIGZyb20gJy4vaXMnO1xuXG4vLyBDbG9uZSBuZXN0ZWQgb2JqZWN0c1xuZXhwb3J0IGZ1bmN0aW9uIGNsb25lRGVlcChvYmplY3QpIHtcbiAgcmV0dXJuIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkob2JqZWN0KSk7XG59XG5cbi8vIEdldCBhIG5lc3RlZCB2YWx1ZSBpbiBhbiBvYmplY3RcbmV4cG9ydCBmdW5jdGlvbiBnZXREZWVwKG9iamVjdCwgcGF0aCkge1xuICByZXR1cm4gcGF0aC5zcGxpdCgnLicpLnJlZHVjZSgob2JqLCBrZXkpID0+IG9iaiAmJiBvYmpba2V5XSwgb2JqZWN0KTtcbn1cblxuLy8gRGVlcCBleHRlbmQgZGVzdGluYXRpb24gb2JqZWN0IHdpdGggTiBtb3JlIG9iamVjdHNcbmV4cG9ydCBmdW5jdGlvbiBleHRlbmQodGFyZ2V0ID0ge30sIC4uLnNvdXJjZXMpIHtcbiAgaWYgKCFzb3VyY2VzLmxlbmd0aCkge1xuICAgIHJldHVybiB0YXJnZXQ7XG4gIH1cblxuICBjb25zdCBzb3VyY2UgPSBzb3VyY2VzLnNoaWZ0KCk7XG5cbiAgaWYgKCFpcy5vYmplY3Qoc291cmNlKSkge1xuICAgIHJldHVybiB0YXJnZXQ7XG4gIH1cblxuICBPYmplY3Qua2V5cyhzb3VyY2UpLmZvckVhY2goKGtleSkgPT4ge1xuICAgIGlmIChpcy5vYmplY3Qoc291cmNlW2tleV0pKSB7XG4gICAgICBpZiAoIU9iamVjdC5rZXlzKHRhcmdldCkuaW5jbHVkZXMoa2V5KSkge1xuICAgICAgICBPYmplY3QuYXNzaWduKHRhcmdldCwgeyBba2V5XToge30gfSk7XG4gICAgICB9XG5cbiAgICAgIGV4dGVuZCh0YXJnZXRba2V5XSwgc291cmNlW2tleV0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBPYmplY3QuYXNzaWduKHRhcmdldCwgeyBba2V5XTogc291cmNlW2tleV0gfSk7XG4gICAgfVxuICB9KTtcblxuICByZXR1cm4gZXh0ZW5kKHRhcmdldCwgLi4uc291cmNlcyk7XG59XG4iLCIvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gRWxlbWVudCB1dGlsc1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuaW1wb3J0IGlzIGZyb20gJy4vaXMnO1xuaW1wb3J0IHsgZXh0ZW5kIH0gZnJvbSAnLi9vYmplY3RzJztcblxuLy8gV3JhcCBhbiBlbGVtZW50XG5leHBvcnQgZnVuY3Rpb24gd3JhcChlbGVtZW50cywgd3JhcHBlcikge1xuICAvLyBDb252ZXJ0IGBlbGVtZW50c2AgdG8gYW4gYXJyYXksIGlmIG5lY2Vzc2FyeS5cbiAgY29uc3QgdGFyZ2V0cyA9IGVsZW1lbnRzLmxlbmd0aCA/IGVsZW1lbnRzIDogW2VsZW1lbnRzXTtcblxuICAvLyBMb29wcyBiYWNrd2FyZHMgdG8gcHJldmVudCBoYXZpbmcgdG8gY2xvbmUgdGhlIHdyYXBwZXIgb24gdGhlXG4gIC8vIGZpcnN0IGVsZW1lbnQgKHNlZSBgY2hpbGRgIGJlbG93KS5cbiAgQXJyYXkuZnJvbSh0YXJnZXRzKVxuICAgIC5yZXZlcnNlKClcbiAgICAuZm9yRWFjaCgoZWxlbWVudCwgaW5kZXgpID0+IHtcbiAgICAgIGNvbnN0IGNoaWxkID0gaW5kZXggPiAwID8gd3JhcHBlci5jbG9uZU5vZGUodHJ1ZSkgOiB3cmFwcGVyO1xuICAgICAgLy8gQ2FjaGUgdGhlIGN1cnJlbnQgcGFyZW50IGFuZCBzaWJsaW5nLlxuICAgICAgY29uc3QgcGFyZW50ID0gZWxlbWVudC5wYXJlbnROb2RlO1xuICAgICAgY29uc3Qgc2libGluZyA9IGVsZW1lbnQubmV4dFNpYmxpbmc7XG5cbiAgICAgIC8vIFdyYXAgdGhlIGVsZW1lbnQgKGlzIGF1dG9tYXRpY2FsbHkgcmVtb3ZlZCBmcm9tIGl0cyBjdXJyZW50XG4gICAgICAvLyBwYXJlbnQpLlxuICAgICAgY2hpbGQuYXBwZW5kQ2hpbGQoZWxlbWVudCk7XG5cbiAgICAgIC8vIElmIHRoZSBlbGVtZW50IGhhZCBhIHNpYmxpbmcsIGluc2VydCB0aGUgd3JhcHBlciBiZWZvcmVcbiAgICAgIC8vIHRoZSBzaWJsaW5nIHRvIG1haW50YWluIHRoZSBIVE1MIHN0cnVjdHVyZTsgb3RoZXJ3aXNlLCBqdXN0XG4gICAgICAvLyBhcHBlbmQgaXQgdG8gdGhlIHBhcmVudC5cbiAgICAgIGlmIChzaWJsaW5nKSB7XG4gICAgICAgIHBhcmVudC5pbnNlcnRCZWZvcmUoY2hpbGQsIHNpYmxpbmcpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcGFyZW50LmFwcGVuZENoaWxkKGNoaWxkKTtcbiAgICAgIH1cbiAgICB9KTtcbn1cblxuLy8gU2V0IGF0dHJpYnV0ZXNcbmV4cG9ydCBmdW5jdGlvbiBzZXRBdHRyaWJ1dGVzKGVsZW1lbnQsIGF0dHJpYnV0ZXMpIHtcbiAgaWYgKCFpcy5lbGVtZW50KGVsZW1lbnQpIHx8IGlzLmVtcHR5KGF0dHJpYnV0ZXMpKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gQXNzdW1lIG51bGwgYW5kIHVuZGVmaW5lZCBhdHRyaWJ1dGVzIHNob3VsZCBiZSBsZWZ0IG91dCxcbiAgLy8gU2V0dGluZyB0aGVtIHdvdWxkIG90aGVyd2lzZSBjb252ZXJ0IHRoZW0gdG8gXCJudWxsXCIgYW5kIFwidW5kZWZpbmVkXCJcbiAgT2JqZWN0LmVudHJpZXMoYXR0cmlidXRlcylcbiAgICAuZmlsdGVyKChbLCB2YWx1ZV0pID0+ICFpcy5udWxsT3JVbmRlZmluZWQodmFsdWUpKVxuICAgIC5mb3JFYWNoKChba2V5LCB2YWx1ZV0pID0+IGVsZW1lbnQuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpKTtcbn1cblxuLy8gQ3JlYXRlIGEgRG9jdW1lbnRGcmFnbWVudFxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUVsZW1lbnQodHlwZSwgYXR0cmlidXRlcywgdGV4dCkge1xuICAvLyBDcmVhdGUgYSBuZXcgPGVsZW1lbnQ+XG4gIGNvbnN0IGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KHR5cGUpO1xuXG4gIC8vIFNldCBhbGwgcGFzc2VkIGF0dHJpYnV0ZXNcbiAgaWYgKGlzLm9iamVjdChhdHRyaWJ1dGVzKSkge1xuICAgIHNldEF0dHJpYnV0ZXMoZWxlbWVudCwgYXR0cmlidXRlcyk7XG4gIH1cblxuICAvLyBBZGQgdGV4dCBub2RlXG4gIGlmIChpcy5zdHJpbmcodGV4dCkpIHtcbiAgICBlbGVtZW50LmlubmVyVGV4dCA9IHRleHQ7XG4gIH1cblxuICAvLyBSZXR1cm4gYnVpbHQgZWxlbWVudFxuICByZXR1cm4gZWxlbWVudDtcbn1cblxuLy8gSW5hZXJ0IGFuIGVsZW1lbnQgYWZ0ZXIgYW5vdGhlclxuZXhwb3J0IGZ1bmN0aW9uIGluc2VydEFmdGVyKGVsZW1lbnQsIHRhcmdldCkge1xuICBpZiAoIWlzLmVsZW1lbnQoZWxlbWVudCkgfHwgIWlzLmVsZW1lbnQodGFyZ2V0KSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHRhcmdldC5wYXJlbnROb2RlLmluc2VydEJlZm9yZShlbGVtZW50LCB0YXJnZXQubmV4dFNpYmxpbmcpO1xufVxuXG4vLyBJbnNlcnQgYSBEb2N1bWVudEZyYWdtZW50XG5leHBvcnQgZnVuY3Rpb24gaW5zZXJ0RWxlbWVudCh0eXBlLCBwYXJlbnQsIGF0dHJpYnV0ZXMsIHRleHQpIHtcbiAgaWYgKCFpcy5lbGVtZW50KHBhcmVudCkpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBwYXJlbnQuYXBwZW5kQ2hpbGQoY3JlYXRlRWxlbWVudCh0eXBlLCBhdHRyaWJ1dGVzLCB0ZXh0KSk7XG59XG5cbi8vIFJlbW92ZSBlbGVtZW50KHMpXG5leHBvcnQgZnVuY3Rpb24gcmVtb3ZlRWxlbWVudChlbGVtZW50KSB7XG4gIGlmIChpcy5ub2RlTGlzdChlbGVtZW50KSB8fCBpcy5hcnJheShlbGVtZW50KSkge1xuICAgIEFycmF5LmZyb20oZWxlbWVudCkuZm9yRWFjaChyZW1vdmVFbGVtZW50KTtcbiAgICByZXR1cm47XG4gIH1cblxuICBpZiAoIWlzLmVsZW1lbnQoZWxlbWVudCkgfHwgIWlzLmVsZW1lbnQoZWxlbWVudC5wYXJlbnROb2RlKSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGVsZW1lbnQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChlbGVtZW50KTtcbn1cblxuLy8gUmVtb3ZlIGFsbCBjaGlsZCBlbGVtZW50c1xuZXhwb3J0IGZ1bmN0aW9uIGVtcHR5RWxlbWVudChlbGVtZW50KSB7XG4gIGlmICghaXMuZWxlbWVudChlbGVtZW50KSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGxldCB7IGxlbmd0aCB9ID0gZWxlbWVudC5jaGlsZE5vZGVzO1xuXG4gIHdoaWxlIChsZW5ndGggPiAwKSB7XG4gICAgZWxlbWVudC5yZW1vdmVDaGlsZChlbGVtZW50Lmxhc3RDaGlsZCk7XG4gICAgbGVuZ3RoIC09IDE7XG4gIH1cbn1cblxuLy8gUmVwbGFjZSBlbGVtZW50XG5leHBvcnQgZnVuY3Rpb24gcmVwbGFjZUVsZW1lbnQobmV3Q2hpbGQsIG9sZENoaWxkKSB7XG4gIGlmICghaXMuZWxlbWVudChvbGRDaGlsZCkgfHwgIWlzLmVsZW1lbnQob2xkQ2hpbGQucGFyZW50Tm9kZSkgfHwgIWlzLmVsZW1lbnQobmV3Q2hpbGQpKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBvbGRDaGlsZC5wYXJlbnROb2RlLnJlcGxhY2VDaGlsZChuZXdDaGlsZCwgb2xkQ2hpbGQpO1xuXG4gIHJldHVybiBuZXdDaGlsZDtcbn1cblxuLy8gR2V0IGFuIGF0dHJpYnV0ZSBvYmplY3QgZnJvbSBhIHN0cmluZyBzZWxlY3RvclxuZXhwb3J0IGZ1bmN0aW9uIGdldEF0dHJpYnV0ZXNGcm9tU2VsZWN0b3Ioc2VsLCBleGlzdGluZ0F0dHJpYnV0ZXMpIHtcbiAgLy8gRm9yIGV4YW1wbGU6XG4gIC8vICcudGVzdCcgdG8geyBjbGFzczogJ3Rlc3QnIH1cbiAgLy8gJyN0ZXN0JyB0byB7IGlkOiAndGVzdCcgfVxuICAvLyAnW2RhdGEtdGVzdD1cInRlc3RcIl0nIHRvIHsgJ2RhdGEtdGVzdCc6ICd0ZXN0JyB9XG5cbiAgaWYgKCFpcy5zdHJpbmcoc2VsKSB8fCBpcy5lbXB0eShzZWwpKSB7XG4gICAgcmV0dXJuIHt9O1xuICB9XG5cbiAgY29uc3QgYXR0cmlidXRlcyA9IHt9O1xuICBjb25zdCBleGlzdGluZyA9IGV4dGVuZCh7fSwgZXhpc3RpbmdBdHRyaWJ1dGVzKTtcblxuICBzZWwuc3BsaXQoJywnKS5mb3JFYWNoKChzKSA9PiB7XG4gICAgLy8gUmVtb3ZlIHdoaXRlc3BhY2VcbiAgICBjb25zdCBzZWxlY3RvciA9IHMudHJpbSgpO1xuICAgIGNvbnN0IGNsYXNzTmFtZSA9IHNlbGVjdG9yLnJlcGxhY2UoJy4nLCAnJyk7XG4gICAgY29uc3Qgc3RyaXBwZWQgPSBzZWxlY3Rvci5yZXBsYWNlKC9bW1xcXV0vZywgJycpO1xuICAgIC8vIEdldCB0aGUgcGFydHMgYW5kIHZhbHVlXG4gICAgY29uc3QgcGFydHMgPSBzdHJpcHBlZC5zcGxpdCgnPScpO1xuICAgIGNvbnN0IFtrZXldID0gcGFydHM7XG4gICAgY29uc3QgdmFsdWUgPSBwYXJ0cy5sZW5ndGggPiAxID8gcGFydHNbMV0ucmVwbGFjZSgvW1wiJ10vZywgJycpIDogJyc7XG4gICAgLy8gR2V0IHRoZSBmaXJzdCBjaGFyYWN0ZXJcbiAgICBjb25zdCBzdGFydCA9IHNlbGVjdG9yLmNoYXJBdCgwKTtcblxuICAgIHN3aXRjaCAoc3RhcnQpIHtcbiAgICAgIGNhc2UgJy4nOlxuICAgICAgICAvLyBBZGQgdG8gZXhpc3RpbmcgY2xhc3NuYW1lXG4gICAgICAgIGlmIChpcy5zdHJpbmcoZXhpc3RpbmcuY2xhc3MpKSB7XG4gICAgICAgICAgYXR0cmlidXRlcy5jbGFzcyA9IGAke2V4aXN0aW5nLmNsYXNzfSAke2NsYXNzTmFtZX1gO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGF0dHJpYnV0ZXMuY2xhc3MgPSBjbGFzc05hbWU7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgJyMnOlxuICAgICAgICAvLyBJRCBzZWxlY3RvclxuICAgICAgICBhdHRyaWJ1dGVzLmlkID0gc2VsZWN0b3IucmVwbGFjZSgnIycsICcnKTtcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgJ1snOlxuICAgICAgICAvLyBBdHRyaWJ1dGUgc2VsZWN0b3JcbiAgICAgICAgYXR0cmlidXRlc1trZXldID0gdmFsdWU7XG5cbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgfSk7XG5cbiAgcmV0dXJuIGV4dGVuZChleGlzdGluZywgYXR0cmlidXRlcyk7XG59XG5cbi8vIFRvZ2dsZSBoaWRkZW5cbmV4cG9ydCBmdW5jdGlvbiB0b2dnbGVIaWRkZW4oZWxlbWVudCwgaGlkZGVuKSB7XG4gIGlmICghaXMuZWxlbWVudChlbGVtZW50KSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGxldCBoaWRlID0gaGlkZGVuO1xuXG4gIGlmICghaXMuYm9vbGVhbihoaWRlKSkge1xuICAgIGhpZGUgPSAhZWxlbWVudC5oaWRkZW47XG4gIH1cblxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcGFyYW0tcmVhc3NpZ25cbiAgZWxlbWVudC5oaWRkZW4gPSBoaWRlO1xufVxuXG4vLyBNaXJyb3IgRWxlbWVudC5jbGFzc0xpc3QudG9nZ2xlLCB3aXRoIElFIGNvbXBhdGliaWxpdHkgZm9yIFwiZm9yY2VcIiBhcmd1bWVudFxuZXhwb3J0IGZ1bmN0aW9uIHRvZ2dsZUNsYXNzKGVsZW1lbnQsIGNsYXNzTmFtZSwgZm9yY2UpIHtcbiAgaWYgKGlzLm5vZGVMaXN0KGVsZW1lbnQpKSB7XG4gICAgcmV0dXJuIEFycmF5LmZyb20oZWxlbWVudCkubWFwKChlKSA9PiB0b2dnbGVDbGFzcyhlLCBjbGFzc05hbWUsIGZvcmNlKSk7XG4gIH1cblxuICBpZiAoaXMuZWxlbWVudChlbGVtZW50KSkge1xuICAgIGxldCBtZXRob2QgPSAndG9nZ2xlJztcbiAgICBpZiAodHlwZW9mIGZvcmNlICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgbWV0aG9kID0gZm9yY2UgPyAnYWRkJyA6ICdyZW1vdmUnO1xuICAgIH1cblxuICAgIGVsZW1lbnQuY2xhc3NMaXN0W21ldGhvZF0oY2xhc3NOYW1lKTtcbiAgICByZXR1cm4gZWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoY2xhc3NOYW1lKTtcbiAgfVxuXG4gIHJldHVybiBmYWxzZTtcbn1cblxuLy8gSGFzIGNsYXNzIG5hbWVcbmV4cG9ydCBmdW5jdGlvbiBoYXNDbGFzcyhlbGVtZW50LCBjbGFzc05hbWUpIHtcbiAgcmV0dXJuIGlzLmVsZW1lbnQoZWxlbWVudCkgJiYgZWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoY2xhc3NOYW1lKTtcbn1cblxuLy8gRWxlbWVudCBtYXRjaGVzIHNlbGVjdG9yXG5leHBvcnQgZnVuY3Rpb24gbWF0Y2hlcyhlbGVtZW50LCBzZWxlY3Rvcikge1xuICBjb25zdCB7IHByb3RvdHlwZSB9ID0gRWxlbWVudDtcblxuICBmdW5jdGlvbiBtYXRjaCgpIHtcbiAgICByZXR1cm4gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKHNlbGVjdG9yKSkuaW5jbHVkZXModGhpcyk7XG4gIH1cblxuICBjb25zdCBtZXRob2QgPVxuICAgIHByb3RvdHlwZS5tYXRjaGVzIHx8XG4gICAgcHJvdG90eXBlLndlYmtpdE1hdGNoZXNTZWxlY3RvciB8fFxuICAgIHByb3RvdHlwZS5tb3pNYXRjaGVzU2VsZWN0b3IgfHxcbiAgICBwcm90b3R5cGUubXNNYXRjaGVzU2VsZWN0b3IgfHxcbiAgICBtYXRjaDtcblxuICByZXR1cm4gbWV0aG9kLmNhbGwoZWxlbWVudCwgc2VsZWN0b3IpO1xufVxuXG4vLyBDbG9zZXN0IGFuY2VzdG9yIGVsZW1lbnQgbWF0Y2hpbmcgc2VsZWN0b3IgKGFsc28gdGVzdHMgZWxlbWVudCBpdHNlbGYpXG5leHBvcnQgZnVuY3Rpb24gY2xvc2VzdChlbGVtZW50LCBzZWxlY3Rvcikge1xuICBjb25zdCB7IHByb3RvdHlwZSB9ID0gRWxlbWVudDtcblxuICAvLyBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvRWxlbWVudC9jbG9zZXN0I1BvbHlmaWxsXG4gIGZ1bmN0aW9uIGNsb3Nlc3RFbGVtZW50KCkge1xuICAgIGxldCBlbCA9IHRoaXM7XG5cbiAgICBkbyB7XG4gICAgICBpZiAobWF0Y2hlcy5tYXRjaGVzKGVsLCBzZWxlY3RvcikpIHJldHVybiBlbDtcbiAgICAgIGVsID0gZWwucGFyZW50RWxlbWVudCB8fCBlbC5wYXJlbnROb2RlO1xuICAgIH0gd2hpbGUgKGVsICE9PSBudWxsICYmIGVsLm5vZGVUeXBlID09PSAxKTtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIGNvbnN0IG1ldGhvZCA9IHByb3RvdHlwZS5jbG9zZXN0IHx8IGNsb3Nlc3RFbGVtZW50O1xuXG4gIHJldHVybiBtZXRob2QuY2FsbChlbGVtZW50LCBzZWxlY3Rvcik7XG59XG5cbi8vIEZpbmQgYWxsIGVsZW1lbnRzXG5leHBvcnQgZnVuY3Rpb24gZ2V0RWxlbWVudHMoc2VsZWN0b3IpIHtcbiAgcmV0dXJuIHRoaXMuZWxlbWVudHMuY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpO1xufVxuXG4vLyBGaW5kIGEgc2luZ2xlIGVsZW1lbnRcbmV4cG9ydCBmdW5jdGlvbiBnZXRFbGVtZW50KHNlbGVjdG9yKSB7XG4gIHJldHVybiB0aGlzLmVsZW1lbnRzLmNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKTtcbn1cblxuLy8gU2V0IGZvY3VzIGFuZCB0YWIgZm9jdXMgY2xhc3NcbmV4cG9ydCBmdW5jdGlvbiBzZXRGb2N1cyhlbGVtZW50ID0gbnVsbCwgdGFiRm9jdXMgPSBmYWxzZSkge1xuICBpZiAoIWlzLmVsZW1lbnQoZWxlbWVudCkpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBTZXQgcmVndWxhciBmb2N1c1xuICBlbGVtZW50LmZvY3VzKHsgcHJldmVudFNjcm9sbDogdHJ1ZSB9KTtcblxuICAvLyBJZiB3ZSB3YW50IHRvIG1pbWljIGtleWJvYXJkIGZvY3VzIHZpYSB0YWJcbiAgaWYgKHRhYkZvY3VzKSB7XG4gICAgdG9nZ2xlQ2xhc3MoZWxlbWVudCwgdGhpcy5jb25maWcuY2xhc3NOYW1lcy50YWJGb2N1cyk7XG4gIH1cbn1cbiIsIi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBQbHlyIHN1cHBvcnQgY2hlY2tzXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5pbXBvcnQgeyB0cmFuc2l0aW9uRW5kRXZlbnQgfSBmcm9tICcuL3V0aWxzL2FuaW1hdGlvbic7XG5pbXBvcnQgYnJvd3NlciBmcm9tICcuL3V0aWxzL2Jyb3dzZXInO1xuaW1wb3J0IHsgY3JlYXRlRWxlbWVudCB9IGZyb20gJy4vdXRpbHMvZWxlbWVudHMnO1xuaW1wb3J0IGlzIGZyb20gJy4vdXRpbHMvaXMnO1xuXG4vLyBEZWZhdWx0IGNvZGVjcyBmb3IgY2hlY2tpbmcgbWltZXR5cGUgc3VwcG9ydFxuY29uc3QgZGVmYXVsdENvZGVjcyA9IHtcbiAgJ2F1ZGlvL29nZyc6ICd2b3JiaXMnLFxuICAnYXVkaW8vd2F2JzogJzEnLFxuICAndmlkZW8vd2VibSc6ICd2cDgsIHZvcmJpcycsXG4gICd2aWRlby9tcDQnOiAnYXZjMS40MkUwMUUsIG1wNGEuNDAuMicsXG4gICd2aWRlby9vZ2cnOiAndGhlb3JhJyxcbn07XG5cbi8vIENoZWNrIGZvciBmZWF0dXJlIHN1cHBvcnRcbmNvbnN0IHN1cHBvcnQgPSB7XG4gIC8vIEJhc2ljIHN1cHBvcnRcbiAgYXVkaW86ICdjYW5QbGF5VHlwZScgaW4gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYXVkaW8nKSxcbiAgdmlkZW86ICdjYW5QbGF5VHlwZScgaW4gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndmlkZW8nKSxcblxuICAvLyBDaGVjayBmb3Igc3VwcG9ydFxuICAvLyBCYXNpYyBmdW5jdGlvbmFsaXR5IHZzIGZ1bGwgVUlcbiAgY2hlY2sodHlwZSwgcHJvdmlkZXIsIHBsYXlzaW5saW5lKSB7XG4gICAgY29uc3QgY2FuUGxheUlubGluZSA9IGJyb3dzZXIuaXNJUGhvbmUgJiYgcGxheXNpbmxpbmUgJiYgc3VwcG9ydC5wbGF5c2lubGluZTtcbiAgICBjb25zdCBhcGkgPSBzdXBwb3J0W3R5cGVdIHx8IHByb3ZpZGVyICE9PSAnaHRtbDUnO1xuICAgIGNvbnN0IHVpID0gYXBpICYmIHN1cHBvcnQucmFuZ2VJbnB1dCAmJiAodHlwZSAhPT0gJ3ZpZGVvJyB8fCAhYnJvd3Nlci5pc0lQaG9uZSB8fCBjYW5QbGF5SW5saW5lKTtcblxuICAgIHJldHVybiB7XG4gICAgICBhcGksXG4gICAgICB1aSxcbiAgICB9O1xuICB9LFxuXG4gIC8vIFBpY3R1cmUtaW4tcGljdHVyZSBzdXBwb3J0XG4gIC8vIFNhZmFyaSAmIENocm9tZSBvbmx5IGN1cnJlbnRseVxuICBwaXA6ICgoKSA9PiB7XG4gICAgaWYgKGJyb3dzZXIuaXNJUGhvbmUpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICAvLyBTYWZhcmlcbiAgICAvLyBodHRwczovL2RldmVsb3Blci5hcHBsZS5jb20vZG9jdW1lbnRhdGlvbi93ZWJraXRqcy9hZGRpbmdfcGljdHVyZV9pbl9waWN0dXJlX3RvX3lvdXJfc2FmYXJpX21lZGlhX2NvbnRyb2xzXG4gICAgaWYgKGlzLmZ1bmN0aW9uKGNyZWF0ZUVsZW1lbnQoJ3ZpZGVvJykud2Via2l0U2V0UHJlc2VudGF0aW9uTW9kZSkpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIC8vIENocm9tZVxuICAgIC8vIGh0dHBzOi8vZGV2ZWxvcGVycy5nb29nbGUuY29tL3dlYi91cGRhdGVzLzIwMTgvMTAvd2F0Y2gtdmlkZW8tdXNpbmctcGljdHVyZS1pbi1waWN0dXJlXG4gICAgaWYgKGRvY3VtZW50LnBpY3R1cmVJblBpY3R1cmVFbmFibGVkICYmICFjcmVhdGVFbGVtZW50KCd2aWRlbycpLmRpc2FibGVQaWN0dXJlSW5QaWN0dXJlKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH0pKCksXG5cbiAgLy8gQWlycGxheSBzdXBwb3J0XG4gIC8vIFNhZmFyaSBvbmx5IGN1cnJlbnRseVxuICBhaXJwbGF5OiBpcy5mdW5jdGlvbih3aW5kb3cuV2ViS2l0UGxheWJhY2tUYXJnZXRBdmFpbGFiaWxpdHlFdmVudCksXG5cbiAgLy8gSW5saW5lIHBsYXliYWNrIHN1cHBvcnRcbiAgLy8gaHR0cHM6Ly93ZWJraXQub3JnL2Jsb2cvNjc4NC9uZXctdmlkZW8tcG9saWNpZXMtZm9yLWlvcy9cbiAgcGxheXNpbmxpbmU6ICdwbGF5c0lubGluZScgaW4gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndmlkZW8nKSxcblxuICAvLyBDaGVjayBmb3IgbWltZSB0eXBlIHN1cHBvcnQgYWdhaW5zdCBhIHBsYXllciBpbnN0YW5jZVxuICAvLyBDcmVkaXRzOiBodHRwOi8vZGl2ZWludG9odG1sNS5pbmZvL2V2ZXJ5dGhpbmcuaHRtbFxuICAvLyBSZWxhdGVkOiBodHRwOi8vd3d3LmxlYW5iYWNrcGxheWVyLmNvbS90ZXN0L2g1bXQuaHRtbFxuICBtaW1lKGlucHV0KSB7XG4gICAgaWYgKGlzLmVtcHR5KGlucHV0KSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGNvbnN0IFttZWRpYVR5cGVdID0gaW5wdXQuc3BsaXQoJy8nKTtcbiAgICBsZXQgdHlwZSA9IGlucHV0O1xuXG4gICAgLy8gVmVyaWZ5IHdlJ3JlIHVzaW5nIEhUTUw1IGFuZCB0aGVyZSdzIG5vIG1lZGlhIHR5cGUgbWlzbWF0Y2hcbiAgICBpZiAoIXRoaXMuaXNIVE1MNSB8fCBtZWRpYVR5cGUgIT09IHRoaXMudHlwZSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8vIEFkZCBjb2RlYyBpZiByZXF1aXJlZFxuICAgIGlmIChPYmplY3Qua2V5cyhkZWZhdWx0Q29kZWNzKS5pbmNsdWRlcyh0eXBlKSkge1xuICAgICAgdHlwZSArPSBgOyBjb2RlY3M9XCIke2RlZmF1bHRDb2RlY3NbaW5wdXRdfVwiYDtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgcmV0dXJuIEJvb2xlYW4odHlwZSAmJiB0aGlzLm1lZGlhLmNhblBsYXlUeXBlKHR5cGUpLnJlcGxhY2UoL25vLywgJycpKTtcbiAgICB9IGNhdGNoIChfKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9LFxuXG4gIC8vIENoZWNrIGZvciB0ZXh0VHJhY2tzIHN1cHBvcnRcbiAgdGV4dFRyYWNrczogJ3RleHRUcmFja3MnIGluIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3ZpZGVvJyksXG5cbiAgLy8gPGlucHV0IHR5cGU9XCJyYW5nZVwiPiBTbGlkZXJzXG4gIHJhbmdlSW5wdXQ6ICgoKSA9PiB7XG4gICAgY29uc3QgcmFuZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpO1xuICAgIHJhbmdlLnR5cGUgPSAncmFuZ2UnO1xuICAgIHJldHVybiByYW5nZS50eXBlID09PSAncmFuZ2UnO1xuICB9KSgpLFxuXG4gIC8vIFRvdWNoXG4gIC8vIE5PVEU6IFJlbWVtYmVyIGEgZGV2aWNlIGNhbiBiZSBtb3VzZSArIHRvdWNoIGVuYWJsZWQgc28gd2UgY2hlY2sgb24gZmlyc3QgdG91Y2ggZXZlbnRcbiAgdG91Y2g6ICdvbnRvdWNoc3RhcnQnIGluIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCxcblxuICAvLyBEZXRlY3QgdHJhbnNpdGlvbnMgc3VwcG9ydFxuICB0cmFuc2l0aW9uczogdHJhbnNpdGlvbkVuZEV2ZW50ICE9PSBmYWxzZSxcblxuICAvLyBSZWR1Y2VkIG1vdGlvbiBpT1MgJiBNYWNPUyBzZXR0aW5nXG4gIC8vIGh0dHBzOi8vd2Via2l0Lm9yZy9ibG9nLzc1NTEvcmVzcG9uc2l2ZS1kZXNpZ24tZm9yLW1vdGlvbi9cbiAgcmVkdWNlZE1vdGlvbjogJ21hdGNoTWVkaWEnIGluIHdpbmRvdyAmJiB3aW5kb3cubWF0Y2hNZWRpYSgnKHByZWZlcnMtcmVkdWNlZC1tb3Rpb24pJykubWF0Y2hlcyxcbn07XG5cbmV4cG9ydCBkZWZhdWx0IHN1cHBvcnQ7XG4iLCIvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gRXZlbnQgdXRpbHNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmltcG9ydCBpcyBmcm9tICcuL2lzJztcblxuLy8gQ2hlY2sgZm9yIHBhc3NpdmUgZXZlbnQgbGlzdGVuZXIgc3VwcG9ydFxuLy8gaHR0cHM6Ly9naXRodWIuY29tL1dJQ0cvRXZlbnRMaXN0ZW5lck9wdGlvbnMvYmxvYi9naC1wYWdlcy9leHBsYWluZXIubWRcbi8vIGh0dHBzOi8vd3d3LnlvdXR1YmUuY29tL3dhdGNoP3Y9TlBNNjE3MkoyMmdcbmNvbnN0IHN1cHBvcnRzUGFzc2l2ZUxpc3RlbmVycyA9ICgoKSA9PiB7XG4gIC8vIFRlc3QgdmlhIGEgZ2V0dGVyIGluIHRoZSBvcHRpb25zIG9iamVjdCB0byBzZWUgaWYgdGhlIHBhc3NpdmUgcHJvcGVydHkgaXMgYWNjZXNzZWRcbiAgbGV0IHN1cHBvcnRlZCA9IGZhbHNlO1xuICB0cnkge1xuICAgIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuZGVmaW5lUHJvcGVydHkoe30sICdwYXNzaXZlJywge1xuICAgICAgZ2V0KCkge1xuICAgICAgICBzdXBwb3J0ZWQgPSB0cnVlO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG4gICAgfSk7XG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Rlc3QnLCBudWxsLCBvcHRpb25zKTtcbiAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigndGVzdCcsIG51bGwsIG9wdGlvbnMpO1xuICB9IGNhdGNoIChfKSB7XG4gICAgLy8gRG8gbm90aGluZ1xuICB9XG5cbiAgcmV0dXJuIHN1cHBvcnRlZDtcbn0pKCk7XG5cbi8vIFRvZ2dsZSBldmVudCBsaXN0ZW5lclxuZXhwb3J0IGZ1bmN0aW9uIHRvZ2dsZUxpc3RlbmVyKGVsZW1lbnQsIGV2ZW50LCBjYWxsYmFjaywgdG9nZ2xlID0gZmFsc2UsIHBhc3NpdmUgPSB0cnVlLCBjYXB0dXJlID0gZmFsc2UpIHtcbiAgLy8gQmFpbCBpZiBubyBlbGVtZW50LCBldmVudCwgb3IgY2FsbGJhY2tcbiAgaWYgKCFlbGVtZW50IHx8ICEoJ2FkZEV2ZW50TGlzdGVuZXInIGluIGVsZW1lbnQpIHx8IGlzLmVtcHR5KGV2ZW50KSB8fCAhaXMuZnVuY3Rpb24oY2FsbGJhY2spKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gQWxsb3cgbXVsdGlwbGUgZXZlbnRzXG4gIGNvbnN0IGV2ZW50cyA9IGV2ZW50LnNwbGl0KCcgJyk7XG4gIC8vIEJ1aWxkIG9wdGlvbnNcbiAgLy8gRGVmYXVsdCB0byBqdXN0IHRoZSBjYXB0dXJlIGJvb2xlYW4gZm9yIGJyb3dzZXJzIHdpdGggbm8gcGFzc2l2ZSBsaXN0ZW5lciBzdXBwb3J0XG4gIGxldCBvcHRpb25zID0gY2FwdHVyZTtcblxuICAvLyBJZiBwYXNzaXZlIGV2ZW50cyBsaXN0ZW5lcnMgYXJlIHN1cHBvcnRlZFxuICBpZiAoc3VwcG9ydHNQYXNzaXZlTGlzdGVuZXJzKSB7XG4gICAgb3B0aW9ucyA9IHtcbiAgICAgIC8vIFdoZXRoZXIgdGhlIGxpc3RlbmVyIGNhbiBiZSBwYXNzaXZlIChpLmUuIGRlZmF1bHQgbmV2ZXIgcHJldmVudGVkKVxuICAgICAgcGFzc2l2ZSxcbiAgICAgIC8vIFdoZXRoZXIgdGhlIGxpc3RlbmVyIGlzIGEgY2FwdHVyaW5nIGxpc3RlbmVyIG9yIG5vdFxuICAgICAgY2FwdHVyZSxcbiAgICB9O1xuICB9XG5cbiAgLy8gSWYgYSBzaW5nbGUgbm9kZSBpcyBwYXNzZWQsIGJpbmQgdGhlIGV2ZW50IGxpc3RlbmVyXG4gIGV2ZW50cy5mb3JFYWNoKCh0eXBlKSA9PiB7XG4gICAgaWYgKHRoaXMgJiYgdGhpcy5ldmVudExpc3RlbmVycyAmJiB0b2dnbGUpIHtcbiAgICAgIC8vIENhY2hlIGV2ZW50IGxpc3RlbmVyXG4gICAgICB0aGlzLmV2ZW50TGlzdGVuZXJzLnB1c2goeyBlbGVtZW50LCB0eXBlLCBjYWxsYmFjaywgb3B0aW9ucyB9KTtcbiAgICB9XG5cbiAgICBlbGVtZW50W3RvZ2dsZSA/ICdhZGRFdmVudExpc3RlbmVyJyA6ICdyZW1vdmVFdmVudExpc3RlbmVyJ10odHlwZSwgY2FsbGJhY2ssIG9wdGlvbnMpO1xuICB9KTtcbn1cblxuLy8gQmluZCBldmVudCBoYW5kbGVyXG5leHBvcnQgZnVuY3Rpb24gb24oZWxlbWVudCwgZXZlbnRzID0gJycsIGNhbGxiYWNrLCBwYXNzaXZlID0gdHJ1ZSwgY2FwdHVyZSA9IGZhbHNlKSB7XG4gIHRvZ2dsZUxpc3RlbmVyLmNhbGwodGhpcywgZWxlbWVudCwgZXZlbnRzLCBjYWxsYmFjaywgdHJ1ZSwgcGFzc2l2ZSwgY2FwdHVyZSk7XG59XG5cbi8vIFVuYmluZCBldmVudCBoYW5kbGVyXG5leHBvcnQgZnVuY3Rpb24gb2ZmKGVsZW1lbnQsIGV2ZW50cyA9ICcnLCBjYWxsYmFjaywgcGFzc2l2ZSA9IHRydWUsIGNhcHR1cmUgPSBmYWxzZSkge1xuICB0b2dnbGVMaXN0ZW5lci5jYWxsKHRoaXMsIGVsZW1lbnQsIGV2ZW50cywgY2FsbGJhY2ssIGZhbHNlLCBwYXNzaXZlLCBjYXB0dXJlKTtcbn1cblxuLy8gQmluZCBvbmNlLW9ubHkgZXZlbnQgaGFuZGxlclxuZXhwb3J0IGZ1bmN0aW9uIG9uY2UoZWxlbWVudCwgZXZlbnRzID0gJycsIGNhbGxiYWNrLCBwYXNzaXZlID0gdHJ1ZSwgY2FwdHVyZSA9IGZhbHNlKSB7XG4gIGNvbnN0IG9uY2VDYWxsYmFjayA9ICguLi5hcmdzKSA9PiB7XG4gICAgb2ZmKGVsZW1lbnQsIGV2ZW50cywgb25jZUNhbGxiYWNrLCBwYXNzaXZlLCBjYXB0dXJlKTtcbiAgICBjYWxsYmFjay5hcHBseSh0aGlzLCBhcmdzKTtcbiAgfTtcblxuICB0b2dnbGVMaXN0ZW5lci5jYWxsKHRoaXMsIGVsZW1lbnQsIGV2ZW50cywgb25jZUNhbGxiYWNrLCB0cnVlLCBwYXNzaXZlLCBjYXB0dXJlKTtcbn1cblxuLy8gVHJpZ2dlciBldmVudFxuZXhwb3J0IGZ1bmN0aW9uIHRyaWdnZXJFdmVudChlbGVtZW50LCB0eXBlID0gJycsIGJ1YmJsZXMgPSBmYWxzZSwgZGV0YWlsID0ge30pIHtcbiAgLy8gQmFpbCBpZiBubyBlbGVtZW50XG4gIGlmICghaXMuZWxlbWVudChlbGVtZW50KSB8fCBpcy5lbXB0eSh0eXBlKSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIENyZWF0ZSBhbmQgZGlzcGF0Y2ggdGhlIGV2ZW50XG4gIGNvbnN0IGV2ZW50ID0gbmV3IEN1c3RvbUV2ZW50KHR5cGUsIHtcbiAgICBidWJibGVzLFxuICAgIGRldGFpbDogeyAuLi5kZXRhaWwsIHBseXI6IHRoaXMgfSxcbiAgfSk7XG5cbiAgLy8gRGlzcGF0Y2ggdGhlIGV2ZW50XG4gIGVsZW1lbnQuZGlzcGF0Y2hFdmVudChldmVudCk7XG59XG5cbi8vIFVuYmluZCBhbGwgY2FjaGVkIGV2ZW50IGxpc3RlbmVyc1xuZXhwb3J0IGZ1bmN0aW9uIHVuYmluZExpc3RlbmVycygpIHtcbiAgaWYgKHRoaXMgJiYgdGhpcy5ldmVudExpc3RlbmVycykge1xuICAgIHRoaXMuZXZlbnRMaXN0ZW5lcnMuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgY29uc3QgeyBlbGVtZW50LCB0eXBlLCBjYWxsYmFjaywgb3B0aW9ucyB9ID0gaXRlbTtcbiAgICAgIGVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcih0eXBlLCBjYWxsYmFjaywgb3B0aW9ucyk7XG4gICAgfSk7XG5cbiAgICB0aGlzLmV2ZW50TGlzdGVuZXJzID0gW107XG4gIH1cbn1cblxuLy8gUnVuIG1ldGhvZCB3aGVuIC8gaWYgcGxheWVyIGlzIHJlYWR5XG5leHBvcnQgZnVuY3Rpb24gcmVhZHkoKSB7XG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT5cbiAgICB0aGlzLnJlYWR5ID8gc2V0VGltZW91dChyZXNvbHZlLCAwKSA6IG9uLmNhbGwodGhpcywgdGhpcy5lbGVtZW50cy5jb250YWluZXIsICdyZWFkeScsIHJlc29sdmUpLFxuICApLnRoZW4oKCkgPT4ge30pO1xufVxuIiwiaW1wb3J0IGlzIGZyb20gJy4vaXMnO1xuLyoqXG4gKiBTaWxlbmNlIGEgUHJvbWlzZS1saWtlIG9iamVjdC5cbiAqIFRoaXMgaXMgdXNlZnVsIGZvciBhdm9pZGluZyBub24taGFybWZ1bCwgYnV0IHBvdGVudGlhbGx5IGNvbmZ1c2luZyBcInVuY2F1Z2h0XG4gKiBwbGF5IHByb21pc2VcIiByZWplY3Rpb24gZXJyb3IgbWVzc2FnZXMuXG4gKiBAcGFyYW0gIHtPYmplY3R9IHZhbHVlIEFuIG9iamVjdCB0aGF0IG1heSBvciBtYXkgbm90IGJlIGBQcm9taXNlYC1saWtlLlxuICovXG5leHBvcnQgZnVuY3Rpb24gc2lsZW5jZVByb21pc2UodmFsdWUpIHtcbiAgaWYgKGlzLnByb21pc2UodmFsdWUpKSB7XG4gICAgdmFsdWUudGhlbihudWxsLCAoKSA9PiB7fSk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgeyBzaWxlbmNlUHJvbWlzZSB9O1xuIiwiLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEFycmF5IHV0aWxzXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5pbXBvcnQgaXMgZnJvbSAnLi9pcyc7XG5cbi8vIFJlbW92ZSBkdXBsaWNhdGVzIGluIGFuIGFycmF5XG5leHBvcnQgZnVuY3Rpb24gZGVkdXBlKGFycmF5KSB7XG4gIGlmICghaXMuYXJyYXkoYXJyYXkpKSB7XG4gICAgcmV0dXJuIGFycmF5O1xuICB9XG5cbiAgcmV0dXJuIGFycmF5LmZpbHRlcigoaXRlbSwgaW5kZXgpID0+IGFycmF5LmluZGV4T2YoaXRlbSkgPT09IGluZGV4KTtcbn1cblxuLy8gR2V0IHRoZSBjbG9zZXN0IHZhbHVlIGluIGFuIGFycmF5XG5leHBvcnQgZnVuY3Rpb24gY2xvc2VzdChhcnJheSwgdmFsdWUpIHtcbiAgaWYgKCFpcy5hcnJheShhcnJheSkgfHwgIWFycmF5Lmxlbmd0aCkge1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgcmV0dXJuIGFycmF5LnJlZHVjZSgocHJldiwgY3VycikgPT4gKE1hdGguYWJzKGN1cnIgLSB2YWx1ZSkgPCBNYXRoLmFicyhwcmV2IC0gdmFsdWUpID8gY3VyciA6IHByZXYpKTtcbn1cbiIsIi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBTdHlsZSB1dGlsc1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuaW1wb3J0IHsgY2xvc2VzdCB9IGZyb20gJy4vYXJyYXlzJztcbmltcG9ydCBpcyBmcm9tICcuL2lzJztcblxuLy8gQ2hlY2sgc3VwcG9ydCBmb3IgYSBDU1MgZGVjbGFyYXRpb25cbmV4cG9ydCBmdW5jdGlvbiBzdXBwb3J0c0NTUyhkZWNsYXJhdGlvbikge1xuICBpZiAoIXdpbmRvdyB8fCAhd2luZG93LkNTUykge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHJldHVybiB3aW5kb3cuQ1NTLnN1cHBvcnRzKGRlY2xhcmF0aW9uKTtcbn1cblxuLy8gU3RhbmRhcmQvY29tbW9uIGFzcGVjdCByYXRpb3NcbmNvbnN0IHN0YW5kYXJkUmF0aW9zID0gW1xuICBbMSwgMV0sXG4gIFs0LCAzXSxcbiAgWzMsIDRdLFxuICBbNSwgNF0sXG4gIFs0LCA1XSxcbiAgWzMsIDJdLFxuICBbMiwgM10sXG4gIFsxNiwgMTBdLFxuICBbMTAsIDE2XSxcbiAgWzE2LCA5XSxcbiAgWzksIDE2XSxcbiAgWzIxLCA5XSxcbiAgWzksIDIxXSxcbiAgWzMyLCA5XSxcbiAgWzksIDMyXSxcbl0ucmVkdWNlKChvdXQsIFt4LCB5XSkgPT4gKHsgLi4ub3V0LCBbeCAvIHldOiBbeCwgeV0gfSksIHt9KTtcblxuLy8gVmFsaWRhdGUgYW4gYXNwZWN0IHJhdGlvXG5leHBvcnQgZnVuY3Rpb24gdmFsaWRhdGVBc3BlY3RSYXRpbyhpbnB1dCkge1xuICBpZiAoIWlzLmFycmF5KGlucHV0KSAmJiAoIWlzLnN0cmluZyhpbnB1dCkgfHwgIWlucHV0LmluY2x1ZGVzKCc6JykpKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgY29uc3QgcmF0aW8gPSBpcy5hcnJheShpbnB1dCkgPyBpbnB1dCA6IGlucHV0LnNwbGl0KCc6Jyk7XG5cbiAgcmV0dXJuIHJhdGlvLm1hcChOdW1iZXIpLmV2ZXJ5KGlzLm51bWJlcik7XG59XG5cbi8vIFJlZHVjZSBhbiBhc3BlY3QgcmF0aW8gdG8gaXQncyBsb3dlc3QgZm9ybVxuZXhwb3J0IGZ1bmN0aW9uIHJlZHVjZUFzcGVjdFJhdGlvKHJhdGlvKSB7XG4gIGlmICghaXMuYXJyYXkocmF0aW8pIHx8ICFyYXRpby5ldmVyeShpcy5udW1iZXIpKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBjb25zdCBbd2lkdGgsIGhlaWdodF0gPSByYXRpbztcbiAgY29uc3QgZ2V0RGl2aWRlciA9ICh3LCBoKSA9PiAoaCA9PT0gMCA/IHcgOiBnZXREaXZpZGVyKGgsIHcgJSBoKSk7XG4gIGNvbnN0IGRpdmlkZXIgPSBnZXREaXZpZGVyKHdpZHRoLCBoZWlnaHQpO1xuXG4gIHJldHVybiBbd2lkdGggLyBkaXZpZGVyLCBoZWlnaHQgLyBkaXZpZGVyXTtcbn1cblxuLy8gQ2FsY3VsYXRlIGFuIGFzcGVjdCByYXRpb1xuZXhwb3J0IGZ1bmN0aW9uIGdldEFzcGVjdFJhdGlvKGlucHV0KSB7XG4gIGNvbnN0IHBhcnNlID0gKHJhdGlvKSA9PiAodmFsaWRhdGVBc3BlY3RSYXRpbyhyYXRpbykgPyByYXRpby5zcGxpdCgnOicpLm1hcChOdW1iZXIpIDogbnVsbCk7XG4gIC8vIFRyeSBwcm92aWRlZCByYXRpb1xuICBsZXQgcmF0aW8gPSBwYXJzZShpbnB1dCk7XG5cbiAgLy8gR2V0IGZyb20gY29uZmlnXG4gIGlmIChyYXRpbyA9PT0gbnVsbCkge1xuICAgIHJhdGlvID0gcGFyc2UodGhpcy5jb25maWcucmF0aW8pO1xuICB9XG5cbiAgLy8gR2V0IGZyb20gZW1iZWRcbiAgaWYgKHJhdGlvID09PSBudWxsICYmICFpcy5lbXB0eSh0aGlzLmVtYmVkKSAmJiBpcy5hcnJheSh0aGlzLmVtYmVkLnJhdGlvKSkge1xuICAgICh7IHJhdGlvIH0gPSB0aGlzLmVtYmVkKTtcbiAgfVxuXG4gIC8vIEdldCBmcm9tIEhUTUw1IHZpZGVvXG4gIGlmIChyYXRpbyA9PT0gbnVsbCAmJiB0aGlzLmlzSFRNTDUpIHtcbiAgICBjb25zdCB7IHZpZGVvV2lkdGgsIHZpZGVvSGVpZ2h0IH0gPSB0aGlzLm1lZGlhO1xuICAgIHJhdGlvID0gW3ZpZGVvV2lkdGgsIHZpZGVvSGVpZ2h0XTtcbiAgfVxuXG4gIHJldHVybiByZWR1Y2VBc3BlY3RSYXRpbyhyYXRpbyk7XG59XG5cbi8vIFNldCBhc3BlY3QgcmF0aW8gZm9yIHJlc3BvbnNpdmUgY29udGFpbmVyXG5leHBvcnQgZnVuY3Rpb24gc2V0QXNwZWN0UmF0aW8oaW5wdXQpIHtcbiAgaWYgKCF0aGlzLmlzVmlkZW8pIHtcbiAgICByZXR1cm4ge307XG4gIH1cblxuICBjb25zdCB7IHdyYXBwZXIgfSA9IHRoaXMuZWxlbWVudHM7XG4gIGNvbnN0IHJhdGlvID0gZ2V0QXNwZWN0UmF0aW8uY2FsbCh0aGlzLCBpbnB1dCk7XG5cbiAgaWYgKCFpcy5hcnJheShyYXRpbykpIHtcbiAgICByZXR1cm4ge307XG4gIH1cblxuICBjb25zdCBbeCwgeV0gPSByZWR1Y2VBc3BlY3RSYXRpbyhyYXRpbyk7XG4gIGNvbnN0IHVzZU5hdGl2ZSA9IHN1cHBvcnRzQ1NTKGBhc3BlY3QtcmF0aW86ICR7eH0vJHt5fWApO1xuICBjb25zdCBwYWRkaW5nID0gKDEwMCAvIHgpICogeTtcblxuICBpZiAodXNlTmF0aXZlKSB7XG4gICAgd3JhcHBlci5zdHlsZS5hc3BlY3RSYXRpbyA9IGAke3h9LyR7eX1gO1xuICB9IGVsc2Uge1xuICAgIHdyYXBwZXIuc3R5bGUucGFkZGluZ0JvdHRvbSA9IGAke3BhZGRpbmd9JWA7XG4gIH1cblxuICAvLyBGb3IgVmltZW8gd2UgaGF2ZSBhbiBleHRyYSA8ZGl2PiB0byBoaWRlIHRoZSBzdGFuZGFyZCBjb250cm9scyBhbmQgVUlcbiAgaWYgKHRoaXMuaXNWaW1lbyAmJiAhdGhpcy5jb25maWcudmltZW8ucHJlbWl1bSAmJiB0aGlzLnN1cHBvcnRlZC51aSkge1xuICAgIGNvbnN0IGhlaWdodCA9ICgxMDAgLyB0aGlzLm1lZGlhLm9mZnNldFdpZHRoKSAqIHBhcnNlSW50KHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKHRoaXMubWVkaWEpLnBhZGRpbmdCb3R0b20sIDEwKTtcbiAgICBjb25zdCBvZmZzZXQgPSAoaGVpZ2h0IC0gcGFkZGluZykgLyAoaGVpZ2h0IC8gNTApO1xuXG4gICAgaWYgKHRoaXMuZnVsbHNjcmVlbi5hY3RpdmUpIHtcbiAgICAgIHdyYXBwZXIuc3R5bGUucGFkZGluZ0JvdHRvbSA9IG51bGw7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMubWVkaWEuc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZVkoLSR7b2Zmc2V0fSUpYDtcbiAgICB9XG4gIH0gZWxzZSBpZiAodGhpcy5pc0hUTUw1KSB7XG4gICAgd3JhcHBlci5jbGFzc0xpc3QuYWRkKHRoaXMuY29uZmlnLmNsYXNzTmFtZXMudmlkZW9GaXhlZFJhdGlvKTtcbiAgfVxuXG4gIHJldHVybiB7IHBhZGRpbmcsIHJhdGlvIH07XG59XG5cbi8vIFJvdW5kIGFuIGFzcGVjdCByYXRpbyB0byBjbG9zZXN0IHN0YW5kYXJkIHJhdGlvXG5leHBvcnQgZnVuY3Rpb24gcm91bmRBc3BlY3RSYXRpbyh4LCB5LCB0b2xlcmFuY2UgPSAwLjA1KSB7XG4gIGNvbnN0IHJhdGlvID0geCAvIHk7XG4gIGNvbnN0IGNsb3Nlc3RSYXRpbyA9IGNsb3Nlc3QoT2JqZWN0LmtleXMoc3RhbmRhcmRSYXRpb3MpLCByYXRpbyk7XG5cbiAgLy8gQ2hlY2sgbWF0Y2ggaXMgd2l0aGluIHRvbGVyYW5jZVxuICBpZiAoTWF0aC5hYnMoY2xvc2VzdFJhdGlvIC0gcmF0aW8pIDw9IHRvbGVyYW5jZSkge1xuICAgIHJldHVybiBzdGFuZGFyZFJhdGlvc1tjbG9zZXN0UmF0aW9dO1xuICB9XG5cbiAgLy8gTm8gbWF0Y2hcbiAgcmV0dXJuIFt4LCB5XTtcbn1cblxuLy8gR2V0IHRoZSBzaXplIG9mIHRoZSB2aWV3cG9ydFxuLy8gaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMTI0ODA4MS9ob3ctdG8tZ2V0LXRoZS1icm93c2VyLXZpZXdwb3J0LWRpbWVuc2lvbnNcbmV4cG9ydCBmdW5jdGlvbiBnZXRWaWV3cG9ydFNpemUoKSB7XG4gIGNvbnN0IHdpZHRoID0gTWF0aC5tYXgoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoIHx8IDAsIHdpbmRvdy5pbm5lcldpZHRoIHx8IDApO1xuICBjb25zdCBoZWlnaHQgPSBNYXRoLm1heChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0IHx8IDAsIHdpbmRvdy5pbm5lckhlaWdodCB8fCAwKTtcbiAgcmV0dXJuIFt3aWR0aCwgaGVpZ2h0XTtcbn1cbiIsIi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBQbHlyIEhUTUw1IGhlbHBlcnNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmltcG9ydCBzdXBwb3J0IGZyb20gJy4vc3VwcG9ydCc7XG5pbXBvcnQgeyByZW1vdmVFbGVtZW50IH0gZnJvbSAnLi91dGlscy9lbGVtZW50cyc7XG5pbXBvcnQgeyB0cmlnZ2VyRXZlbnQgfSBmcm9tICcuL3V0aWxzL2V2ZW50cyc7XG5pbXBvcnQgaXMgZnJvbSAnLi91dGlscy9pcyc7XG5pbXBvcnQgeyBzaWxlbmNlUHJvbWlzZSB9IGZyb20gJy4vdXRpbHMvcHJvbWlzZSc7XG5pbXBvcnQgeyBzZXRBc3BlY3RSYXRpbyB9IGZyb20gJy4vdXRpbHMvc3R5bGUnO1xuXG5jb25zdCBodG1sNSA9IHtcbiAgZ2V0U291cmNlcygpIHtcbiAgICBpZiAoIXRoaXMuaXNIVE1MNSkge1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cblxuICAgIGNvbnN0IHNvdXJjZXMgPSBBcnJheS5mcm9tKHRoaXMubWVkaWEucXVlcnlTZWxlY3RvckFsbCgnc291cmNlJykpO1xuXG4gICAgLy8gRmlsdGVyIG91dCB1bnN1cHBvcnRlZCBzb3VyY2VzIChpZiB0eXBlIGlzIHNwZWNpZmllZClcbiAgICByZXR1cm4gc291cmNlcy5maWx0ZXIoKHNvdXJjZSkgPT4ge1xuICAgICAgY29uc3QgdHlwZSA9IHNvdXJjZS5nZXRBdHRyaWJ1dGUoJ3R5cGUnKTtcblxuICAgICAgaWYgKGlzLmVtcHR5KHR5cGUpKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gc3VwcG9ydC5taW1lLmNhbGwodGhpcywgdHlwZSk7XG4gICAgfSk7XG4gIH0sXG5cbiAgLy8gR2V0IHF1YWxpdHkgbGV2ZWxzXG4gIGdldFF1YWxpdHlPcHRpb25zKCkge1xuICAgIC8vIFdoZXRoZXIgd2UncmUgZm9yY2luZyBhbGwgb3B0aW9ucyAoZS5nLiBmb3Igc3RyZWFtaW5nKVxuICAgIGlmICh0aGlzLmNvbmZpZy5xdWFsaXR5LmZvcmNlZCkge1xuICAgICAgcmV0dXJuIHRoaXMuY29uZmlnLnF1YWxpdHkub3B0aW9ucztcbiAgICB9XG5cbiAgICAvLyBHZXQgc2l6ZXMgZnJvbSA8c291cmNlPiBlbGVtZW50c1xuICAgIHJldHVybiBodG1sNS5nZXRTb3VyY2VzXG4gICAgICAuY2FsbCh0aGlzKVxuICAgICAgLm1hcCgoc291cmNlKSA9PiBOdW1iZXIoc291cmNlLmdldEF0dHJpYnV0ZSgnc2l6ZScpKSlcbiAgICAgIC5maWx0ZXIoQm9vbGVhbik7XG4gIH0sXG5cbiAgc2V0dXAoKSB7XG4gICAgaWYgKCF0aGlzLmlzSFRNTDUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBwbGF5ZXIgPSB0aGlzO1xuXG4gICAgLy8gU2V0IHNwZWVkIG9wdGlvbnMgZnJvbSBjb25maWdcbiAgICBwbGF5ZXIub3B0aW9ucy5zcGVlZCA9IHBsYXllci5jb25maWcuc3BlZWQub3B0aW9ucztcblxuICAgIC8vIFNldCBhc3BlY3QgcmF0aW8gaWYgZml4ZWRcbiAgICBpZiAoIWlzLmVtcHR5KHRoaXMuY29uZmlnLnJhdGlvKSkge1xuICAgICAgc2V0QXNwZWN0UmF0aW8uY2FsbChwbGF5ZXIpO1xuICAgIH1cblxuICAgIC8vIFF1YWxpdHlcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocGxheWVyLm1lZGlhLCAncXVhbGl0eScsIHtcbiAgICAgIGdldCgpIHtcbiAgICAgICAgLy8gR2V0IHNvdXJjZXNcbiAgICAgICAgY29uc3Qgc291cmNlcyA9IGh0bWw1LmdldFNvdXJjZXMuY2FsbChwbGF5ZXIpO1xuICAgICAgICBjb25zdCBzb3VyY2UgPSBzb3VyY2VzLmZpbmQoKHMpID0+IHMuZ2V0QXR0cmlidXRlKCdzcmMnKSA9PT0gcGxheWVyLnNvdXJjZSk7XG5cbiAgICAgICAgLy8gUmV0dXJuIHNpemUsIGlmIG1hdGNoIGlzIGZvdW5kXG4gICAgICAgIHJldHVybiBzb3VyY2UgJiYgTnVtYmVyKHNvdXJjZS5nZXRBdHRyaWJ1dGUoJ3NpemUnKSk7XG4gICAgICB9LFxuICAgICAgc2V0KGlucHV0KSB7XG4gICAgICAgIGlmIChwbGF5ZXIucXVhbGl0eSA9PT0gaW5wdXQpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICAvLyBJZiB3ZSdyZSB1c2luZyBhbiBleHRlcm5hbCBoYW5kbGVyLi4uXG4gICAgICAgIGlmIChwbGF5ZXIuY29uZmlnLnF1YWxpdHkuZm9yY2VkICYmIGlzLmZ1bmN0aW9uKHBsYXllci5jb25maWcucXVhbGl0eS5vbkNoYW5nZSkpIHtcbiAgICAgICAgICBwbGF5ZXIuY29uZmlnLnF1YWxpdHkub25DaGFuZ2UoaW5wdXQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIEdldCBzb3VyY2VzXG4gICAgICAgICAgY29uc3Qgc291cmNlcyA9IGh0bWw1LmdldFNvdXJjZXMuY2FsbChwbGF5ZXIpO1xuICAgICAgICAgIC8vIEdldCBmaXJzdCBtYXRjaCBmb3IgcmVxdWVzdGVkIHNpemVcbiAgICAgICAgICBjb25zdCBzb3VyY2UgPSBzb3VyY2VzLmZpbmQoKHMpID0+IE51bWJlcihzLmdldEF0dHJpYnV0ZSgnc2l6ZScpKSA9PT0gaW5wdXQpO1xuXG4gICAgICAgICAgLy8gTm8gbWF0Y2hpbmcgc291cmNlIGZvdW5kXG4gICAgICAgICAgaWYgKCFzb3VyY2UpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBHZXQgY3VycmVudCBzdGF0ZVxuICAgICAgICAgIGNvbnN0IHsgY3VycmVudFRpbWUsIHBhdXNlZCwgcHJlbG9hZCwgcmVhZHlTdGF0ZSwgcGxheWJhY2tSYXRlIH0gPSBwbGF5ZXIubWVkaWE7XG5cbiAgICAgICAgICAvLyBTZXQgbmV3IHNvdXJjZVxuICAgICAgICAgIHBsYXllci5tZWRpYS5zcmMgPSBzb3VyY2UuZ2V0QXR0cmlidXRlKCdzcmMnKTtcblxuICAgICAgICAgIC8vIFByZXZlbnQgbG9hZGluZyBpZiBwcmVsb2FkPVwibm9uZVwiIGFuZCB0aGUgY3VycmVudCBzb3VyY2UgaXNuJ3QgbG9hZGVkICgjMTA0NClcbiAgICAgICAgICBpZiAocHJlbG9hZCAhPT0gJ25vbmUnIHx8IHJlYWR5U3RhdGUpIHtcbiAgICAgICAgICAgIC8vIFJlc3RvcmUgdGltZVxuICAgICAgICAgICAgcGxheWVyLm9uY2UoJ2xvYWRlZG1ldGFkYXRhJywgKCkgPT4ge1xuICAgICAgICAgICAgICBwbGF5ZXIuc3BlZWQgPSBwbGF5YmFja1JhdGU7XG4gICAgICAgICAgICAgIHBsYXllci5jdXJyZW50VGltZSA9IGN1cnJlbnRUaW1lO1xuXG4gICAgICAgICAgICAgIC8vIFJlc3VtZSBwbGF5aW5nXG4gICAgICAgICAgICAgIGlmICghcGF1c2VkKSB7XG4gICAgICAgICAgICAgICAgc2lsZW5jZVByb21pc2UocGxheWVyLnBsYXkoKSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBMb2FkIG5ldyBzb3VyY2VcbiAgICAgICAgICAgIHBsYXllci5tZWRpYS5sb2FkKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gVHJpZ2dlciBjaGFuZ2UgZXZlbnRcbiAgICAgICAgdHJpZ2dlckV2ZW50LmNhbGwocGxheWVyLCBwbGF5ZXIubWVkaWEsICdxdWFsaXR5Y2hhbmdlJywgZmFsc2UsIHtcbiAgICAgICAgICBxdWFsaXR5OiBpbnB1dCxcbiAgICAgICAgfSk7XG4gICAgICB9LFxuICAgIH0pO1xuICB9LFxuXG4gIC8vIENhbmNlbCBjdXJyZW50IG5ldHdvcmsgcmVxdWVzdHNcbiAgLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9zYW1wb3R0cy9wbHlyL2lzc3Vlcy8xNzRcbiAgY2FuY2VsUmVxdWVzdHMoKSB7XG4gICAgaWYgKCF0aGlzLmlzSFRNTDUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBSZW1vdmUgY2hpbGQgc291cmNlc1xuICAgIHJlbW92ZUVsZW1lbnQoaHRtbDUuZ2V0U291cmNlcy5jYWxsKHRoaXMpKTtcblxuICAgIC8vIFNldCBibGFuayB2aWRlbyBzcmMgYXR0cmlidXRlXG4gICAgLy8gVGhpcyBpcyB0byBwcmV2ZW50IGEgTUVESUFfRVJSX1NSQ19OT1RfU1VQUE9SVEVEIGVycm9yXG4gICAgLy8gSW5mbzogaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8zMjIzMTU3OS9ob3ctdG8tcHJvcGVybHktZGlzcG9zZS1vZi1hbi1odG1sNS12aWRlby1hbmQtY2xvc2Utc29ja2V0LW9yLWNvbm5lY3Rpb25cbiAgICB0aGlzLm1lZGlhLnNldEF0dHJpYnV0ZSgnc3JjJywgdGhpcy5jb25maWcuYmxhbmtWaWRlbyk7XG5cbiAgICAvLyBMb2FkIHRoZSBuZXcgZW1wdHkgc291cmNlXG4gICAgLy8gVGhpcyB3aWxsIGNhbmNlbCBleGlzdGluZyByZXF1ZXN0c1xuICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vc2FtcG90dHMvcGx5ci9pc3N1ZXMvMTc0XG4gICAgdGhpcy5tZWRpYS5sb2FkKCk7XG5cbiAgICAvLyBEZWJ1Z2dpbmdcbiAgICB0aGlzLmRlYnVnLmxvZygnQ2FuY2VsbGVkIG5ldHdvcmsgcmVxdWVzdHMnKTtcbiAgfSxcbn07XG5cbmV4cG9ydCBkZWZhdWx0IGh0bWw1O1xuIiwiLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFN0cmluZyB1dGlsc1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuaW1wb3J0IGlzIGZyb20gJy4vaXMnO1xuXG4vLyBHZW5lcmF0ZSBhIHJhbmRvbSBJRFxuZXhwb3J0IGZ1bmN0aW9uIGdlbmVyYXRlSWQocHJlZml4KSB7XG4gIHJldHVybiBgJHtwcmVmaXh9LSR7TWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwMDApfWA7XG59XG5cbi8vIEZvcm1hdCBzdHJpbmdcbmV4cG9ydCBmdW5jdGlvbiBmb3JtYXQoaW5wdXQsIC4uLmFyZ3MpIHtcbiAgaWYgKGlzLmVtcHR5KGlucHV0KSkgcmV0dXJuIGlucHV0O1xuXG4gIHJldHVybiBpbnB1dC50b1N0cmluZygpLnJlcGxhY2UoL3soXFxkKyl9L2csIChtYXRjaCwgaSkgPT4gYXJnc1tpXS50b1N0cmluZygpKTtcbn1cblxuLy8gR2V0IHBlcmNlbnRhZ2VcbmV4cG9ydCBmdW5jdGlvbiBnZXRQZXJjZW50YWdlKGN1cnJlbnQsIG1heCkge1xuICBpZiAoY3VycmVudCA9PT0gMCB8fCBtYXggPT09IDAgfHwgTnVtYmVyLmlzTmFOKGN1cnJlbnQpIHx8IE51bWJlci5pc05hTihtYXgpKSB7XG4gICAgcmV0dXJuIDA7XG4gIH1cblxuICByZXR1cm4gKChjdXJyZW50IC8gbWF4KSAqIDEwMCkudG9GaXhlZCgyKTtcbn1cblxuLy8gUmVwbGFjZSBhbGwgb2NjdXJyZW5jZXMgb2YgYSBzdHJpbmcgaW4gYSBzdHJpbmdcbmV4cG9ydCBjb25zdCByZXBsYWNlQWxsID0gKGlucHV0ID0gJycsIGZpbmQgPSAnJywgcmVwbGFjZSA9ICcnKSA9PlxuICBpbnB1dC5yZXBsYWNlKG5ldyBSZWdFeHAoZmluZC50b1N0cmluZygpLnJlcGxhY2UoLyhbLiorP149IToke30oKXxbXFxdL1xcXFxdKS9nLCAnXFxcXCQxJyksICdnJyksIHJlcGxhY2UudG9TdHJpbmcoKSk7XG5cbi8vIENvbnZlcnQgdG8gdGl0bGUgY2FzZVxuZXhwb3J0IGNvbnN0IHRvVGl0bGVDYXNlID0gKGlucHV0ID0gJycpID0+XG4gIGlucHV0LnRvU3RyaW5nKCkucmVwbGFjZSgvXFx3XFxTKi9nLCAodGV4dCkgPT4gdGV4dC5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHRleHQuc2xpY2UoMSkudG9Mb3dlckNhc2UoKSk7XG5cbi8vIENvbnZlcnQgc3RyaW5nIHRvIHBhc2NhbENhc2VcbmV4cG9ydCBmdW5jdGlvbiB0b1Bhc2NhbENhc2UoaW5wdXQgPSAnJykge1xuICBsZXQgc3RyaW5nID0gaW5wdXQudG9TdHJpbmcoKTtcblxuICAvLyBDb252ZXJ0IGtlYmFiIGNhc2VcbiAgc3RyaW5nID0gcmVwbGFjZUFsbChzdHJpbmcsICctJywgJyAnKTtcblxuICAvLyBDb252ZXJ0IHNuYWtlIGNhc2VcbiAgc3RyaW5nID0gcmVwbGFjZUFsbChzdHJpbmcsICdfJywgJyAnKTtcblxuICAvLyBDb252ZXJ0IHRvIHRpdGxlIGNhc2VcbiAgc3RyaW5nID0gdG9UaXRsZUNhc2Uoc3RyaW5nKTtcblxuICAvLyBDb252ZXJ0IHRvIHBhc2NhbCBjYXNlXG4gIHJldHVybiByZXBsYWNlQWxsKHN0cmluZywgJyAnLCAnJyk7XG59XG5cbi8vIENvbnZlcnQgc3RyaW5nIHRvIHBhc2NhbENhc2VcbmV4cG9ydCBmdW5jdGlvbiB0b0NhbWVsQ2FzZShpbnB1dCA9ICcnKSB7XG4gIGxldCBzdHJpbmcgPSBpbnB1dC50b1N0cmluZygpO1xuXG4gIC8vIENvbnZlcnQgdG8gcGFzY2FsIGNhc2VcbiAgc3RyaW5nID0gdG9QYXNjYWxDYXNlKHN0cmluZyk7XG5cbiAgLy8gQ29udmVydCBmaXJzdCBjaGFyYWN0ZXIgdG8gbG93ZXJjYXNlXG4gIHJldHVybiBzdHJpbmcuY2hhckF0KDApLnRvTG93ZXJDYXNlKCkgKyBzdHJpbmcuc2xpY2UoMSk7XG59XG5cbi8vIFJlbW92ZSBIVE1MIGZyb20gYSBzdHJpbmdcbmV4cG9ydCBmdW5jdGlvbiBzdHJpcEhUTUwoc291cmNlKSB7XG4gIGNvbnN0IGZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xuICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gIGZyYWdtZW50LmFwcGVuZENoaWxkKGVsZW1lbnQpO1xuICBlbGVtZW50LmlubmVySFRNTCA9IHNvdXJjZTtcbiAgcmV0dXJuIGZyYWdtZW50LmZpcnN0Q2hpbGQuaW5uZXJUZXh0O1xufVxuXG4vLyBMaWtlIG91dGVySFRNTCwgYnV0IGFsc28gd29ya3MgZm9yIERvY3VtZW50RnJhZ21lbnRcbmV4cG9ydCBmdW5jdGlvbiBnZXRIVE1MKGVsZW1lbnQpIHtcbiAgY29uc3Qgd3JhcHBlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICB3cmFwcGVyLmFwcGVuZENoaWxkKGVsZW1lbnQpO1xuICByZXR1cm4gd3JhcHBlci5pbm5lckhUTUw7XG59XG4iLCIvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUGx5ciBpbnRlcm5hdGlvbmFsaXphdGlvblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuaW1wb3J0IGlzIGZyb20gJy4vaXMnO1xuaW1wb3J0IHsgZ2V0RGVlcCB9IGZyb20gJy4vb2JqZWN0cyc7XG5pbXBvcnQgeyByZXBsYWNlQWxsIH0gZnJvbSAnLi9zdHJpbmdzJztcblxuLy8gU2tpcCBpMThuIGZvciBhYmJyZXZpYXRpb25zIGFuZCBicmFuZCBuYW1lc1xuY29uc3QgcmVzb3VyY2VzID0ge1xuICBwaXA6ICdQSVAnLFxuICBhaXJwbGF5OiAnQWlyUGxheScsXG4gIGh0bWw1OiAnSFRNTDUnLFxuICB2aW1lbzogJ1ZpbWVvJyxcbiAgeW91dHViZTogJ1lvdVR1YmUnLFxufTtcblxuY29uc3QgaTE4biA9IHtcbiAgZ2V0KGtleSA9ICcnLCBjb25maWcgPSB7fSkge1xuICAgIGlmIChpcy5lbXB0eShrZXkpIHx8IGlzLmVtcHR5KGNvbmZpZykpIHtcbiAgICAgIHJldHVybiAnJztcbiAgICB9XG5cbiAgICBsZXQgc3RyaW5nID0gZ2V0RGVlcChjb25maWcuaTE4biwga2V5KTtcblxuICAgIGlmIChpcy5lbXB0eShzdHJpbmcpKSB7XG4gICAgICBpZiAoT2JqZWN0LmtleXMocmVzb3VyY2VzKS5pbmNsdWRlcyhrZXkpKSB7XG4gICAgICAgIHJldHVybiByZXNvdXJjZXNba2V5XTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuICcnO1xuICAgIH1cblxuICAgIGNvbnN0IHJlcGxhY2UgPSB7XG4gICAgICAne3NlZWt0aW1lfSc6IGNvbmZpZy5zZWVrVGltZSxcbiAgICAgICd7dGl0bGV9JzogY29uZmlnLnRpdGxlLFxuICAgIH07XG5cbiAgICBPYmplY3QuZW50cmllcyhyZXBsYWNlKS5mb3JFYWNoKChbaywgdl0pID0+IHtcbiAgICAgIHN0cmluZyA9IHJlcGxhY2VBbGwoc3RyaW5nLCBrLCB2KTtcbiAgICB9KTtcblxuICAgIHJldHVybiBzdHJpbmc7XG4gIH0sXG59O1xuXG5leHBvcnQgZGVmYXVsdCBpMThuO1xuIiwiLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFBseXIgc3RvcmFnZVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuaW1wb3J0IGlzIGZyb20gJy4vdXRpbHMvaXMnO1xuaW1wb3J0IHsgZXh0ZW5kIH0gZnJvbSAnLi91dGlscy9vYmplY3RzJztcblxuY2xhc3MgU3RvcmFnZSB7XG4gIGNvbnN0cnVjdG9yKHBsYXllcikge1xuICAgIHRoaXMuZW5hYmxlZCA9IHBsYXllci5jb25maWcuc3RvcmFnZS5lbmFibGVkO1xuICAgIHRoaXMua2V5ID0gcGxheWVyLmNvbmZpZy5zdG9yYWdlLmtleTtcbiAgfVxuXG4gIC8vIENoZWNrIGZvciBhY3R1YWwgc3VwcG9ydCAoc2VlIGlmIHdlIGNhbiB1c2UgaXQpXG4gIHN0YXRpYyBnZXQgc3VwcG9ydGVkKCkge1xuICAgIHRyeSB7XG4gICAgICBpZiAoISgnbG9jYWxTdG9yYWdlJyBpbiB3aW5kb3cpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgdGVzdCA9ICdfX190ZXN0JztcblxuICAgICAgLy8gVHJ5IHRvIHVzZSBpdCAoaXQgbWlnaHQgYmUgZGlzYWJsZWQsIGUuZy4gdXNlciBpcyBpbiBwcml2YXRlIG1vZGUpXG4gICAgICAvLyBzZWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9zYW1wb3R0cy9wbHlyL2lzc3Vlcy8xMzFcbiAgICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbSh0ZXN0LCB0ZXN0KTtcbiAgICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSh0ZXN0KTtcblxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBjYXRjaCAoXykge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIGdldCA9IChrZXkpID0+IHtcbiAgICBpZiAoIVN0b3JhZ2Uuc3VwcG9ydGVkIHx8ICF0aGlzLmVuYWJsZWQpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGNvbnN0IHN0b3JlID0gd2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKHRoaXMua2V5KTtcblxuICAgIGlmIChpcy5lbXB0eShzdG9yZSkpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGNvbnN0IGpzb24gPSBKU09OLnBhcnNlKHN0b3JlKTtcblxuICAgIHJldHVybiBpcy5zdHJpbmcoa2V5KSAmJiBrZXkubGVuZ3RoID8ganNvbltrZXldIDoganNvbjtcbiAgfTtcblxuICBzZXQgPSAob2JqZWN0KSA9PiB7XG4gICAgLy8gQmFpbCBpZiB3ZSBkb24ndCBoYXZlIGxvY2FsU3RvcmFnZSBzdXBwb3J0IG9yIGl0J3MgZGlzYWJsZWRcbiAgICBpZiAoIVN0b3JhZ2Uuc3VwcG9ydGVkIHx8ICF0aGlzLmVuYWJsZWQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBDYW4gb25seSBzdG9yZSBvYmplY3RzdFxuICAgIGlmICghaXMub2JqZWN0KG9iamVjdCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBHZXQgY3VycmVudCBzdG9yYWdlXG4gICAgbGV0IHN0b3JhZ2UgPSB0aGlzLmdldCgpO1xuXG4gICAgLy8gRGVmYXVsdCB0byBlbXB0eSBvYmplY3RcbiAgICBpZiAoaXMuZW1wdHkoc3RvcmFnZSkpIHtcbiAgICAgIHN0b3JhZ2UgPSB7fTtcbiAgICB9XG5cbiAgICAvLyBVcGRhdGUgdGhlIHdvcmtpbmcgY29weSBvZiB0aGUgdmFsdWVzXG4gICAgZXh0ZW5kKHN0b3JhZ2UsIG9iamVjdCk7XG5cbiAgICAvLyBVcGRhdGUgc3RvcmFnZVxuICAgIHRyeSB7XG4gICAgICB3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0odGhpcy5rZXksIEpTT04uc3RyaW5naWZ5KHN0b3JhZ2UpKTtcbiAgICB9IGNhdGNoIChfKSB7XG4gICAgICAvLyBEbyBub3RoaW5nXG4gICAgfVxuICB9O1xufVxuXG5leHBvcnQgZGVmYXVsdCBTdG9yYWdlO1xuIiwiLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEZldGNoIHdyYXBwZXJcbi8vIFVzaW5nIFhIUiB0byBhdm9pZCBpc3N1ZXMgd2l0aCBvbGRlciBicm93c2Vyc1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gZmV0Y2godXJsLCByZXNwb25zZVR5cGUgPSAndGV4dCcpIHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVxdWVzdCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuXG4gICAgICAvLyBDaGVjayBmb3IgQ09SUyBzdXBwb3J0XG4gICAgICBpZiAoISgnd2l0aENyZWRlbnRpYWxzJyBpbiByZXF1ZXN0KSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsICgpID0+IHtcbiAgICAgICAgaWYgKHJlc3BvbnNlVHlwZSA9PT0gJ3RleHQnKSB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHJlc29sdmUoSlNPTi5wYXJzZShyZXF1ZXN0LnJlc3BvbnNlVGV4dCkpO1xuICAgICAgICAgIH0gY2F0Y2ggKF8pIHtcbiAgICAgICAgICAgIHJlc29sdmUocmVxdWVzdC5yZXNwb25zZVRleHQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXNvbHZlKHJlcXVlc3QucmVzcG9uc2UpO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsICgpID0+IHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKHJlcXVlc3Quc3RhdHVzKTtcbiAgICAgIH0pO1xuXG4gICAgICByZXF1ZXN0Lm9wZW4oJ0dFVCcsIHVybCwgdHJ1ZSk7XG5cbiAgICAgIC8vIFNldCB0aGUgcmVxdWlyZWQgcmVzcG9uc2UgdHlwZVxuICAgICAgcmVxdWVzdC5yZXNwb25zZVR5cGUgPSByZXNwb25zZVR5cGU7XG5cbiAgICAgIHJlcXVlc3Quc2VuZCgpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZWplY3QoZXJyb3IpO1xuICAgIH1cbiAgfSk7XG59XG4iLCIvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gU3ByaXRlIGxvYWRlclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuaW1wb3J0IFN0b3JhZ2UgZnJvbSAnLi4vc3RvcmFnZSc7XG5pbXBvcnQgZmV0Y2ggZnJvbSAnLi9mZXRjaCc7XG5pbXBvcnQgaXMgZnJvbSAnLi9pcyc7XG5cbi8vIExvYWQgYW4gZXh0ZXJuYWwgU1ZHIHNwcml0ZVxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gbG9hZFNwcml0ZSh1cmwsIGlkKSB7XG4gIGlmICghaXMuc3RyaW5nKHVybCkpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBwcmVmaXggPSAnY2FjaGUnO1xuICBjb25zdCBoYXNJZCA9IGlzLnN0cmluZyhpZCk7XG4gIGxldCBpc0NhY2hlZCA9IGZhbHNlO1xuICBjb25zdCBleGlzdHMgPSAoKSA9PiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCkgIT09IG51bGw7XG5cbiAgY29uc3QgdXBkYXRlID0gKGNvbnRhaW5lciwgZGF0YSkgPT4ge1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1wYXJhbS1yZWFzc2lnblxuICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSBkYXRhO1xuXG4gICAgLy8gQ2hlY2sgYWdhaW4gaW5jYXNlIG9mIHJhY2UgY29uZGl0aW9uXG4gICAgaWYgKGhhc0lkICYmIGV4aXN0cygpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gSW5qZWN0IHRoZSBTVkcgdG8gdGhlIGJvZHlcbiAgICBkb2N1bWVudC5ib2R5Lmluc2VydEFkamFjZW50RWxlbWVudCgnYWZ0ZXJiZWdpbicsIGNvbnRhaW5lcik7XG4gIH07XG5cbiAgLy8gT25seSBsb2FkIG9uY2UgaWYgSUQgc2V0XG4gIGlmICghaGFzSWQgfHwgIWV4aXN0cygpKSB7XG4gICAgY29uc3QgdXNlU3RvcmFnZSA9IFN0b3JhZ2Uuc3VwcG9ydGVkO1xuICAgIC8vIENyZWF0ZSBjb250YWluZXJcbiAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBjb250YWluZXIuc2V0QXR0cmlidXRlKCdoaWRkZW4nLCAnJyk7XG5cbiAgICBpZiAoaGFzSWQpIHtcbiAgICAgIGNvbnRhaW5lci5zZXRBdHRyaWJ1dGUoJ2lkJywgaWQpO1xuICAgIH1cblxuICAgIC8vIENoZWNrIGluIGNhY2hlXG4gICAgaWYgKHVzZVN0b3JhZ2UpIHtcbiAgICAgIGNvbnN0IGNhY2hlZCA9IHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbShgJHtwcmVmaXh9LSR7aWR9YCk7XG4gICAgICBpc0NhY2hlZCA9IGNhY2hlZCAhPT0gbnVsbDtcblxuICAgICAgaWYgKGlzQ2FjaGVkKSB7XG4gICAgICAgIGNvbnN0IGRhdGEgPSBKU09OLnBhcnNlKGNhY2hlZCk7XG4gICAgICAgIHVwZGF0ZShjb250YWluZXIsIGRhdGEuY29udGVudCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gR2V0IHRoZSBzcHJpdGVcbiAgICBmZXRjaCh1cmwpXG4gICAgICAudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICAgIGlmIChpcy5lbXB0eShyZXN1bHQpKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHVzZVN0b3JhZ2UpIHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKFxuICAgICAgICAgICAgICBgJHtwcmVmaXh9LSR7aWR9YCxcbiAgICAgICAgICAgICAgSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgICAgIGNvbnRlbnQ6IHJlc3VsdCxcbiAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0gY2F0Y2ggKF8pIHtcbiAgICAgICAgICAgIC8vIERvIG5vdGhpbmdcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB1cGRhdGUoY29udGFpbmVyLCByZXN1bHQpO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaCgoKSA9PiB7fSk7XG4gIH1cbn1cbiIsIi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBUaW1lIHV0aWxzXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5pbXBvcnQgaXMgZnJvbSAnLi9pcyc7XG5cbi8vIFRpbWUgaGVscGVyc1xuZXhwb3J0IGNvbnN0IGdldEhvdXJzID0gKHZhbHVlKSA9PiBNYXRoLnRydW5jKCh2YWx1ZSAvIDYwIC8gNjApICUgNjAsIDEwKTtcbmV4cG9ydCBjb25zdCBnZXRNaW51dGVzID0gKHZhbHVlKSA9PiBNYXRoLnRydW5jKCh2YWx1ZSAvIDYwKSAlIDYwLCAxMCk7XG5leHBvcnQgY29uc3QgZ2V0U2Vjb25kcyA9ICh2YWx1ZSkgPT4gTWF0aC50cnVuYyh2YWx1ZSAlIDYwLCAxMCk7XG5cbi8vIEZvcm1hdCB0aW1lIHRvIFVJIGZyaWVuZGx5IHN0cmluZ1xuZXhwb3J0IGZ1bmN0aW9uIGZvcm1hdFRpbWUodGltZSA9IDAsIGRpc3BsYXlIb3VycyA9IGZhbHNlLCBpbnZlcnRlZCA9IGZhbHNlKSB7XG4gIC8vIEJhaWwgaWYgdGhlIHZhbHVlIGlzbid0IGEgbnVtYmVyXG4gIGlmICghaXMubnVtYmVyKHRpbWUpKSB7XG4gICAgcmV0dXJuIGZvcm1hdFRpbWUodW5kZWZpbmVkLCBkaXNwbGF5SG91cnMsIGludmVydGVkKTtcbiAgfVxuXG4gIC8vIEZvcm1hdCB0aW1lIGNvbXBvbmVudCB0byBhZGQgbGVhZGluZyB6ZXJvXG4gIGNvbnN0IGZvcm1hdCA9ICh2YWx1ZSkgPT4gYDAke3ZhbHVlfWAuc2xpY2UoLTIpO1xuICAvLyBCcmVha2Rvd24gdG8gaG91cnMsIG1pbnMsIHNlY3NcbiAgbGV0IGhvdXJzID0gZ2V0SG91cnModGltZSk7XG4gIGNvbnN0IG1pbnMgPSBnZXRNaW51dGVzKHRpbWUpO1xuICBjb25zdCBzZWNzID0gZ2V0U2Vjb25kcyh0aW1lKTtcblxuICAvLyBEbyB3ZSBuZWVkIHRvIGRpc3BsYXkgaG91cnM/XG4gIGlmIChkaXNwbGF5SG91cnMgfHwgaG91cnMgPiAwKSB7XG4gICAgaG91cnMgPSBgJHtob3Vyc306YDtcbiAgfSBlbHNlIHtcbiAgICBob3VycyA9ICcnO1xuICB9XG5cbiAgLy8gUmVuZGVyXG4gIHJldHVybiBgJHtpbnZlcnRlZCAmJiB0aW1lID4gMCA/ICctJyA6ICcnfSR7aG91cnN9JHtmb3JtYXQobWlucyl9OiR7Zm9ybWF0KHNlY3MpfWA7XG59XG4iLCIvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUGx5ciBjb250cm9sc1xuLy8gVE9ETzogVGhpcyBuZWVkcyB0byBiZSBzcGxpdCBpbnRvIHNtYWxsZXIgZmlsZXMgYW5kIGNsZWFuZWQgdXBcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmltcG9ydCBSYW5nZVRvdWNoIGZyb20gJ3JhbmdldG91Y2gnO1xuXG5pbXBvcnQgY2FwdGlvbnMgZnJvbSAnLi9jYXB0aW9ucyc7XG5pbXBvcnQgaHRtbDUgZnJvbSAnLi9odG1sNSc7XG5pbXBvcnQgc3VwcG9ydCBmcm9tICcuL3N1cHBvcnQnO1xuaW1wb3J0IHsgcmVwYWludCwgdHJhbnNpdGlvbkVuZEV2ZW50IH0gZnJvbSAnLi91dGlscy9hbmltYXRpb24nO1xuaW1wb3J0IHsgZGVkdXBlIH0gZnJvbSAnLi91dGlscy9hcnJheXMnO1xuaW1wb3J0IGJyb3dzZXIgZnJvbSAnLi91dGlscy9icm93c2VyJztcbmltcG9ydCB7XG4gIGNyZWF0ZUVsZW1lbnQsXG4gIGVtcHR5RWxlbWVudCxcbiAgZ2V0QXR0cmlidXRlc0Zyb21TZWxlY3RvcixcbiAgZ2V0RWxlbWVudCxcbiAgZ2V0RWxlbWVudHMsXG4gIGhhc0NsYXNzLFxuICBtYXRjaGVzLFxuICByZW1vdmVFbGVtZW50LFxuICBzZXRBdHRyaWJ1dGVzLFxuICBzZXRGb2N1cyxcbiAgdG9nZ2xlQ2xhc3MsXG4gIHRvZ2dsZUhpZGRlbixcbn0gZnJvbSAnLi91dGlscy9lbGVtZW50cyc7XG5pbXBvcnQgeyBvZmYsIG9uIH0gZnJvbSAnLi91dGlscy9ldmVudHMnO1xuaW1wb3J0IGkxOG4gZnJvbSAnLi91dGlscy9pMThuJztcbmltcG9ydCBpcyBmcm9tICcuL3V0aWxzL2lzJztcbmltcG9ydCBsb2FkU3ByaXRlIGZyb20gJy4vdXRpbHMvbG9hZC1zcHJpdGUnO1xuaW1wb3J0IHsgZXh0ZW5kIH0gZnJvbSAnLi91dGlscy9vYmplY3RzJztcbmltcG9ydCB7IGdldFBlcmNlbnRhZ2UsIHJlcGxhY2VBbGwsIHRvQ2FtZWxDYXNlLCB0b1RpdGxlQ2FzZSB9IGZyb20gJy4vdXRpbHMvc3RyaW5ncyc7XG5pbXBvcnQgeyBmb3JtYXRUaW1lLCBnZXRIb3VycyB9IGZyb20gJy4vdXRpbHMvdGltZSc7XG5cbi8vIFRPRE86IERvbid0IGV4cG9ydCBhIG1hc3NpdmUgb2JqZWN0IC0gYnJlYWsgZG93biBhbmQgY3JlYXRlIGNsYXNzXG5jb25zdCBjb250cm9scyA9IHtcbiAgLy8gR2V0IGljb24gVVJMXG4gIGdldEljb25VcmwoKSB7XG4gICAgY29uc3QgdXJsID0gbmV3IFVSTCh0aGlzLmNvbmZpZy5pY29uVXJsLCB3aW5kb3cubG9jYXRpb24pO1xuICAgIGNvbnN0IGhvc3QgPSB3aW5kb3cubG9jYXRpb24uaG9zdCA/IHdpbmRvdy5sb2NhdGlvbi5ob3N0IDogd2luZG93LnRvcC5sb2NhdGlvbi5ob3N0O1xuICAgIGNvbnN0IGNvcnMgPSB1cmwuaG9zdCAhPT0gaG9zdCB8fCAoYnJvd3Nlci5pc0lFICYmICF3aW5kb3cuc3ZnNGV2ZXJ5Ym9keSk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgdXJsOiB0aGlzLmNvbmZpZy5pY29uVXJsLFxuICAgICAgY29ycyxcbiAgICB9O1xuICB9LFxuXG4gIC8vIEZpbmQgdGhlIFVJIGNvbnRyb2xzXG4gIGZpbmRFbGVtZW50cygpIHtcbiAgICB0cnkge1xuICAgICAgdGhpcy5lbGVtZW50cy5jb250cm9scyA9IGdldEVsZW1lbnQuY2FsbCh0aGlzLCB0aGlzLmNvbmZpZy5zZWxlY3RvcnMuY29udHJvbHMud3JhcHBlcik7XG5cbiAgICAgIC8vIEJ1dHRvbnNcbiAgICAgIHRoaXMuZWxlbWVudHMuYnV0dG9ucyA9IHtcbiAgICAgICAgcGxheTogZ2V0RWxlbWVudHMuY2FsbCh0aGlzLCB0aGlzLmNvbmZpZy5zZWxlY3RvcnMuYnV0dG9ucy5wbGF5KSxcbiAgICAgICAgcGF1c2U6IGdldEVsZW1lbnQuY2FsbCh0aGlzLCB0aGlzLmNvbmZpZy5zZWxlY3RvcnMuYnV0dG9ucy5wYXVzZSksXG4gICAgICAgIHJlc3RhcnQ6IGdldEVsZW1lbnQuY2FsbCh0aGlzLCB0aGlzLmNvbmZpZy5zZWxlY3RvcnMuYnV0dG9ucy5yZXN0YXJ0KSxcbiAgICAgICAgcmV3aW5kOiBnZXRFbGVtZW50LmNhbGwodGhpcywgdGhpcy5jb25maWcuc2VsZWN0b3JzLmJ1dHRvbnMucmV3aW5kKSxcbiAgICAgICAgZmFzdEZvcndhcmQ6IGdldEVsZW1lbnQuY2FsbCh0aGlzLCB0aGlzLmNvbmZpZy5zZWxlY3RvcnMuYnV0dG9ucy5mYXN0Rm9yd2FyZCksXG4gICAgICAgIG11dGU6IGdldEVsZW1lbnQuY2FsbCh0aGlzLCB0aGlzLmNvbmZpZy5zZWxlY3RvcnMuYnV0dG9ucy5tdXRlKSxcbiAgICAgICAgcGlwOiBnZXRFbGVtZW50LmNhbGwodGhpcywgdGhpcy5jb25maWcuc2VsZWN0b3JzLmJ1dHRvbnMucGlwKSxcbiAgICAgICAgYWlycGxheTogZ2V0RWxlbWVudC5jYWxsKHRoaXMsIHRoaXMuY29uZmlnLnNlbGVjdG9ycy5idXR0b25zLmFpcnBsYXkpLFxuICAgICAgICBzZXR0aW5nczogZ2V0RWxlbWVudC5jYWxsKHRoaXMsIHRoaXMuY29uZmlnLnNlbGVjdG9ycy5idXR0b25zLnNldHRpbmdzKSxcbiAgICAgICAgY2FwdGlvbnM6IGdldEVsZW1lbnQuY2FsbCh0aGlzLCB0aGlzLmNvbmZpZy5zZWxlY3RvcnMuYnV0dG9ucy5jYXB0aW9ucyksXG4gICAgICAgIGZ1bGxzY3JlZW46IGdldEVsZW1lbnQuY2FsbCh0aGlzLCB0aGlzLmNvbmZpZy5zZWxlY3RvcnMuYnV0dG9ucy5mdWxsc2NyZWVuKSxcbiAgICAgIH07XG5cbiAgICAgIC8vIFByb2dyZXNzXG4gICAgICB0aGlzLmVsZW1lbnRzLnByb2dyZXNzID0gZ2V0RWxlbWVudC5jYWxsKHRoaXMsIHRoaXMuY29uZmlnLnNlbGVjdG9ycy5wcm9ncmVzcyk7XG5cbiAgICAgIC8vIElucHV0c1xuICAgICAgdGhpcy5lbGVtZW50cy5pbnB1dHMgPSB7XG4gICAgICAgIHNlZWs6IGdldEVsZW1lbnQuY2FsbCh0aGlzLCB0aGlzLmNvbmZpZy5zZWxlY3RvcnMuaW5wdXRzLnNlZWspLFxuICAgICAgICB2b2x1bWU6IGdldEVsZW1lbnQuY2FsbCh0aGlzLCB0aGlzLmNvbmZpZy5zZWxlY3RvcnMuaW5wdXRzLnZvbHVtZSksXG4gICAgICB9O1xuXG4gICAgICAvLyBEaXNwbGF5XG4gICAgICB0aGlzLmVsZW1lbnRzLmRpc3BsYXkgPSB7XG4gICAgICAgIGJ1ZmZlcjogZ2V0RWxlbWVudC5jYWxsKHRoaXMsIHRoaXMuY29uZmlnLnNlbGVjdG9ycy5kaXNwbGF5LmJ1ZmZlciksXG4gICAgICAgIGN1cnJlbnRUaW1lOiBnZXRFbGVtZW50LmNhbGwodGhpcywgdGhpcy5jb25maWcuc2VsZWN0b3JzLmRpc3BsYXkuY3VycmVudFRpbWUpLFxuICAgICAgICBkdXJhdGlvbjogZ2V0RWxlbWVudC5jYWxsKHRoaXMsIHRoaXMuY29uZmlnLnNlbGVjdG9ycy5kaXNwbGF5LmR1cmF0aW9uKSxcbiAgICAgIH07XG5cbiAgICAgIC8vIFNlZWsgdG9vbHRpcFxuICAgICAgaWYgKGlzLmVsZW1lbnQodGhpcy5lbGVtZW50cy5wcm9ncmVzcykpIHtcbiAgICAgICAgdGhpcy5lbGVtZW50cy5kaXNwbGF5LnNlZWtUb29sdGlwID0gdGhpcy5lbGVtZW50cy5wcm9ncmVzcy5xdWVyeVNlbGVjdG9yKGAuJHt0aGlzLmNvbmZpZy5jbGFzc05hbWVzLnRvb2x0aXB9YCk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAvLyBMb2cgaXRcbiAgICAgIHRoaXMuZGVidWcud2FybignSXQgbG9va3MgbGlrZSB0aGVyZSBpcyBhIHByb2JsZW0gd2l0aCB5b3VyIGN1c3RvbSBjb250cm9scyBIVE1MJywgZXJyb3IpO1xuXG4gICAgICAvLyBSZXN0b3JlIG5hdGl2ZSB2aWRlbyBjb250cm9sc1xuICAgICAgdGhpcy50b2dnbGVOYXRpdmVDb250cm9scyh0cnVlKTtcblxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfSxcblxuICAvLyBDcmVhdGUgPHN2Zz4gaWNvblxuICBjcmVhdGVJY29uKHR5cGUsIGF0dHJpYnV0ZXMpIHtcbiAgICBjb25zdCBuYW1lc3BhY2UgPSAnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnO1xuICAgIGNvbnN0IGljb25VcmwgPSBjb250cm9scy5nZXRJY29uVXJsLmNhbGwodGhpcyk7XG4gICAgY29uc3QgaWNvblBhdGggPSBgJHshaWNvblVybC5jb3JzID8gaWNvblVybC51cmwgOiAnJ30jJHt0aGlzLmNvbmZpZy5pY29uUHJlZml4fWA7XG4gICAgLy8gQ3JlYXRlIDxzdmc+XG4gICAgY29uc3QgaWNvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhuYW1lc3BhY2UsICdzdmcnKTtcbiAgICBzZXRBdHRyaWJ1dGVzKFxuICAgICAgaWNvbixcbiAgICAgIGV4dGVuZChhdHRyaWJ1dGVzLCB7XG4gICAgICAgICdhcmlhLWhpZGRlbic6ICd0cnVlJyxcbiAgICAgICAgZm9jdXNhYmxlOiAnZmFsc2UnLFxuICAgICAgfSksXG4gICAgKTtcblxuICAgIC8vIENyZWF0ZSB0aGUgPHVzZT4gdG8gcmVmZXJlbmNlIHNwcml0ZVxuICAgIGNvbnN0IHVzZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhuYW1lc3BhY2UsICd1c2UnKTtcbiAgICBjb25zdCBwYXRoID0gYCR7aWNvblBhdGh9LSR7dHlwZX1gO1xuXG4gICAgLy8gU2V0IGBocmVmYCBhdHRyaWJ1dGVzXG4gICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3NhbXBvdHRzL3BseXIvaXNzdWVzLzQ2MFxuICAgIC8vIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL1NWRy9BdHRyaWJ1dGUveGxpbms6aHJlZlxuICAgIGlmICgnaHJlZicgaW4gdXNlKSB7XG4gICAgICB1c2Uuc2V0QXR0cmlidXRlTlMoJ2h0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsnLCAnaHJlZicsIHBhdGgpO1xuICAgIH1cblxuICAgIC8vIEFsd2F5cyBzZXQgdGhlIG9sZGVyIGF0dHJpYnV0ZSBldmVuIHRob3VnaCBpdCdzIFwiZGVwcmVjYXRlZFwiIChpdCdsbCBiZSBhcm91bmQgZm9yIGFnZXMpXG4gICAgdXNlLnNldEF0dHJpYnV0ZU5TKCdodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rJywgJ3hsaW5rOmhyZWYnLCBwYXRoKTtcblxuICAgIC8vIEFkZCA8dXNlPiB0byA8c3ZnPlxuICAgIGljb24uYXBwZW5kQ2hpbGQodXNlKTtcblxuICAgIHJldHVybiBpY29uO1xuICB9LFxuXG4gIC8vIENyZWF0ZSBoaWRkZW4gdGV4dCBsYWJlbFxuICBjcmVhdGVMYWJlbChrZXksIGF0dHIgPSB7fSkge1xuICAgIGNvbnN0IHRleHQgPSBpMThuLmdldChrZXksIHRoaXMuY29uZmlnKTtcbiAgICBjb25zdCBhdHRyaWJ1dGVzID0geyAuLi5hdHRyLCBjbGFzczogW2F0dHIuY2xhc3MsIHRoaXMuY29uZmlnLmNsYXNzTmFtZXMuaGlkZGVuXS5maWx0ZXIoQm9vbGVhbikuam9pbignICcpIH07XG5cbiAgICByZXR1cm4gY3JlYXRlRWxlbWVudCgnc3BhbicsIGF0dHJpYnV0ZXMsIHRleHQpO1xuICB9LFxuXG4gIC8vIENyZWF0ZSBhIGJhZGdlXG4gIGNyZWF0ZUJhZGdlKHRleHQpIHtcbiAgICBpZiAoaXMuZW1wdHkodGV4dCkpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGNvbnN0IGJhZGdlID0gY3JlYXRlRWxlbWVudCgnc3BhbicsIHtcbiAgICAgIGNsYXNzOiB0aGlzLmNvbmZpZy5jbGFzc05hbWVzLm1lbnUudmFsdWUsXG4gICAgfSk7XG5cbiAgICBiYWRnZS5hcHBlbmRDaGlsZChcbiAgICAgIGNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICdzcGFuJyxcbiAgICAgICAge1xuICAgICAgICAgIGNsYXNzOiB0aGlzLmNvbmZpZy5jbGFzc05hbWVzLm1lbnUuYmFkZ2UsXG4gICAgICAgIH0sXG4gICAgICAgIHRleHQsXG4gICAgICApLFxuICAgICk7XG5cbiAgICByZXR1cm4gYmFkZ2U7XG4gIH0sXG5cbiAgLy8gQ3JlYXRlIGEgPGJ1dHRvbj5cbiAgY3JlYXRlQnV0dG9uKGJ1dHRvblR5cGUsIGF0dHIpIHtcbiAgICBjb25zdCBhdHRyaWJ1dGVzID0gZXh0ZW5kKHt9LCBhdHRyKTtcbiAgICBsZXQgdHlwZSA9IHRvQ2FtZWxDYXNlKGJ1dHRvblR5cGUpO1xuXG4gICAgY29uc3QgcHJvcHMgPSB7XG4gICAgICBlbGVtZW50OiAnYnV0dG9uJyxcbiAgICAgIHRvZ2dsZTogZmFsc2UsXG4gICAgICBsYWJlbDogbnVsbCxcbiAgICAgIGljb246IG51bGwsXG4gICAgICBsYWJlbFByZXNzZWQ6IG51bGwsXG4gICAgICBpY29uUHJlc3NlZDogbnVsbCxcbiAgICB9O1xuXG4gICAgWydlbGVtZW50JywgJ2ljb24nLCAnbGFiZWwnXS5mb3JFYWNoKChrZXkpID0+IHtcbiAgICAgIGlmIChPYmplY3Qua2V5cyhhdHRyaWJ1dGVzKS5pbmNsdWRlcyhrZXkpKSB7XG4gICAgICAgIHByb3BzW2tleV0gPSBhdHRyaWJ1dGVzW2tleV07XG4gICAgICAgIGRlbGV0ZSBhdHRyaWJ1dGVzW2tleV07XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBEZWZhdWx0IHRvICdidXR0b24nIHR5cGUgdG8gcHJldmVudCBmb3JtIHN1Ym1pc3Npb25cbiAgICBpZiAocHJvcHMuZWxlbWVudCA9PT0gJ2J1dHRvbicgJiYgIU9iamVjdC5rZXlzKGF0dHJpYnV0ZXMpLmluY2x1ZGVzKCd0eXBlJykpIHtcbiAgICAgIGF0dHJpYnV0ZXMudHlwZSA9ICdidXR0b24nO1xuICAgIH1cblxuICAgIC8vIFNldCBjbGFzcyBuYW1lXG4gICAgaWYgKE9iamVjdC5rZXlzKGF0dHJpYnV0ZXMpLmluY2x1ZGVzKCdjbGFzcycpKSB7XG4gICAgICBpZiAoIWF0dHJpYnV0ZXMuY2xhc3Muc3BsaXQoJyAnKS5zb21lKChjKSA9PiBjID09PSB0aGlzLmNvbmZpZy5jbGFzc05hbWVzLmNvbnRyb2wpKSB7XG4gICAgICAgIGV4dGVuZChhdHRyaWJ1dGVzLCB7XG4gICAgICAgICAgY2xhc3M6IGAke2F0dHJpYnV0ZXMuY2xhc3N9ICR7dGhpcy5jb25maWcuY2xhc3NOYW1lcy5jb250cm9sfWAsXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBhdHRyaWJ1dGVzLmNsYXNzID0gdGhpcy5jb25maWcuY2xhc3NOYW1lcy5jb250cm9sO1xuICAgIH1cblxuICAgIC8vIExhcmdlIHBsYXkgYnV0dG9uXG4gICAgc3dpdGNoIChidXR0b25UeXBlKSB7XG4gICAgICBjYXNlICdwbGF5JzpcbiAgICAgICAgcHJvcHMudG9nZ2xlID0gdHJ1ZTtcbiAgICAgICAgcHJvcHMubGFiZWwgPSAncGxheSc7XG4gICAgICAgIHByb3BzLmxhYmVsUHJlc3NlZCA9ICdwYXVzZSc7XG4gICAgICAgIHByb3BzLmljb24gPSAncGxheSc7XG4gICAgICAgIHByb3BzLmljb25QcmVzc2VkID0gJ3BhdXNlJztcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgJ211dGUnOlxuICAgICAgICBwcm9wcy50b2dnbGUgPSB0cnVlO1xuICAgICAgICBwcm9wcy5sYWJlbCA9ICdtdXRlJztcbiAgICAgICAgcHJvcHMubGFiZWxQcmVzc2VkID0gJ3VubXV0ZSc7XG4gICAgICAgIHByb3BzLmljb24gPSAndm9sdW1lJztcbiAgICAgICAgcHJvcHMuaWNvblByZXNzZWQgPSAnbXV0ZWQnO1xuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSAnY2FwdGlvbnMnOlxuICAgICAgICBwcm9wcy50b2dnbGUgPSB0cnVlO1xuICAgICAgICBwcm9wcy5sYWJlbCA9ICdlbmFibGVDYXB0aW9ucyc7XG4gICAgICAgIHByb3BzLmxhYmVsUHJlc3NlZCA9ICdkaXNhYmxlQ2FwdGlvbnMnO1xuICAgICAgICBwcm9wcy5pY29uID0gJ2NhcHRpb25zLW9mZic7XG4gICAgICAgIHByb3BzLmljb25QcmVzc2VkID0gJ2NhcHRpb25zLW9uJztcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgJ2Z1bGxzY3JlZW4nOlxuICAgICAgICBwcm9wcy50b2dnbGUgPSB0cnVlO1xuICAgICAgICBwcm9wcy5sYWJlbCA9ICdlbnRlckZ1bGxzY3JlZW4nO1xuICAgICAgICBwcm9wcy5sYWJlbFByZXNzZWQgPSAnZXhpdEZ1bGxzY3JlZW4nO1xuICAgICAgICBwcm9wcy5pY29uID0gJ2VudGVyLWZ1bGxzY3JlZW4nO1xuICAgICAgICBwcm9wcy5pY29uUHJlc3NlZCA9ICdleGl0LWZ1bGxzY3JlZW4nO1xuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSAncGxheS1sYXJnZSc6XG4gICAgICAgIGF0dHJpYnV0ZXMuY2xhc3MgKz0gYCAke3RoaXMuY29uZmlnLmNsYXNzTmFtZXMuY29udHJvbH0tLW92ZXJsYWlkYDtcbiAgICAgICAgdHlwZSA9ICdwbGF5JztcbiAgICAgICAgcHJvcHMubGFiZWwgPSAncGxheSc7XG4gICAgICAgIHByb3BzLmljb24gPSAncGxheSc7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBkZWZhdWx0OlxuICAgICAgICBpZiAoaXMuZW1wdHkocHJvcHMubGFiZWwpKSB7XG4gICAgICAgICAgcHJvcHMubGFiZWwgPSB0eXBlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpcy5lbXB0eShwcm9wcy5pY29uKSkge1xuICAgICAgICAgIHByb3BzLmljb24gPSBidXR0b25UeXBlO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgYnV0dG9uID0gY3JlYXRlRWxlbWVudChwcm9wcy5lbGVtZW50KTtcblxuICAgIC8vIFNldHVwIHRvZ2dsZSBpY29uIGFuZCBsYWJlbHNcbiAgICBpZiAocHJvcHMudG9nZ2xlKSB7XG4gICAgICAvLyBJY29uXG4gICAgICBidXR0b24uYXBwZW5kQ2hpbGQoXG4gICAgICAgIGNvbnRyb2xzLmNyZWF0ZUljb24uY2FsbCh0aGlzLCBwcm9wcy5pY29uUHJlc3NlZCwge1xuICAgICAgICAgIGNsYXNzOiAnaWNvbi0tcHJlc3NlZCcsXG4gICAgICAgIH0pLFxuICAgICAgKTtcbiAgICAgIGJ1dHRvbi5hcHBlbmRDaGlsZChcbiAgICAgICAgY29udHJvbHMuY3JlYXRlSWNvbi5jYWxsKHRoaXMsIHByb3BzLmljb24sIHtcbiAgICAgICAgICBjbGFzczogJ2ljb24tLW5vdC1wcmVzc2VkJyxcbiAgICAgICAgfSksXG4gICAgICApO1xuXG4gICAgICAvLyBMYWJlbC9Ub29sdGlwXG4gICAgICBidXR0b24uYXBwZW5kQ2hpbGQoXG4gICAgICAgIGNvbnRyb2xzLmNyZWF0ZUxhYmVsLmNhbGwodGhpcywgcHJvcHMubGFiZWxQcmVzc2VkLCB7XG4gICAgICAgICAgY2xhc3M6ICdsYWJlbC0tcHJlc3NlZCcsXG4gICAgICAgIH0pLFxuICAgICAgKTtcbiAgICAgIGJ1dHRvbi5hcHBlbmRDaGlsZChcbiAgICAgICAgY29udHJvbHMuY3JlYXRlTGFiZWwuY2FsbCh0aGlzLCBwcm9wcy5sYWJlbCwge1xuICAgICAgICAgIGNsYXNzOiAnbGFiZWwtLW5vdC1wcmVzc2VkJyxcbiAgICAgICAgfSksXG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICBidXR0b24uYXBwZW5kQ2hpbGQoY29udHJvbHMuY3JlYXRlSWNvbi5jYWxsKHRoaXMsIHByb3BzLmljb24pKTtcbiAgICAgIGJ1dHRvbi5hcHBlbmRDaGlsZChjb250cm9scy5jcmVhdGVMYWJlbC5jYWxsKHRoaXMsIHByb3BzLmxhYmVsKSk7XG4gICAgfVxuXG4gICAgLy8gTWVyZ2UgYW5kIHNldCBhdHRyaWJ1dGVzXG4gICAgZXh0ZW5kKGF0dHJpYnV0ZXMsIGdldEF0dHJpYnV0ZXNGcm9tU2VsZWN0b3IodGhpcy5jb25maWcuc2VsZWN0b3JzLmJ1dHRvbnNbdHlwZV0sIGF0dHJpYnV0ZXMpKTtcbiAgICBzZXRBdHRyaWJ1dGVzKGJ1dHRvbiwgYXR0cmlidXRlcyk7XG5cbiAgICAvLyBXZSBoYXZlIG11bHRpcGxlIHBsYXkgYnV0dG9uc1xuICAgIGlmICh0eXBlID09PSAncGxheScpIHtcbiAgICAgIGlmICghaXMuYXJyYXkodGhpcy5lbGVtZW50cy5idXR0b25zW3R5cGVdKSkge1xuICAgICAgICB0aGlzLmVsZW1lbnRzLmJ1dHRvbnNbdHlwZV0gPSBbXTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5lbGVtZW50cy5idXR0b25zW3R5cGVdLnB1c2goYnV0dG9uKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5lbGVtZW50cy5idXR0b25zW3R5cGVdID0gYnV0dG9uO1xuICAgIH1cblxuICAgIHJldHVybiBidXR0b247XG4gIH0sXG5cbiAgLy8gQ3JlYXRlIGFuIDxpbnB1dCB0eXBlPSdyYW5nZSc+XG4gIGNyZWF0ZVJhbmdlKHR5cGUsIGF0dHJpYnV0ZXMpIHtcbiAgICAvLyBTZWVrIGlucHV0XG4gICAgY29uc3QgaW5wdXQgPSBjcmVhdGVFbGVtZW50KFxuICAgICAgJ2lucHV0JyxcbiAgICAgIGV4dGVuZChcbiAgICAgICAgZ2V0QXR0cmlidXRlc0Zyb21TZWxlY3Rvcih0aGlzLmNvbmZpZy5zZWxlY3RvcnMuaW5wdXRzW3R5cGVdKSxcbiAgICAgICAge1xuICAgICAgICAgIHR5cGU6ICdyYW5nZScsXG4gICAgICAgICAgbWluOiAwLFxuICAgICAgICAgIG1heDogMTAwLFxuICAgICAgICAgIHN0ZXA6IDAuMDEsXG4gICAgICAgICAgdmFsdWU6IDAsXG4gICAgICAgICAgYXV0b2NvbXBsZXRlOiAnb2ZmJyxcbiAgICAgICAgICAvLyBBMTF5IGZpeGVzIGZvciBodHRwczovL2dpdGh1Yi5jb20vc2FtcG90dHMvcGx5ci9pc3N1ZXMvOTA1XG4gICAgICAgICAgcm9sZTogJ3NsaWRlcicsXG4gICAgICAgICAgJ2FyaWEtbGFiZWwnOiBpMThuLmdldCh0eXBlLCB0aGlzLmNvbmZpZyksXG4gICAgICAgICAgJ2FyaWEtdmFsdWVtaW4nOiAwLFxuICAgICAgICAgICdhcmlhLXZhbHVlbWF4JzogMTAwLFxuICAgICAgICAgICdhcmlhLXZhbHVlbm93JzogMCxcbiAgICAgICAgfSxcbiAgICAgICAgYXR0cmlidXRlcyxcbiAgICAgICksXG4gICAgKTtcblxuICAgIHRoaXMuZWxlbWVudHMuaW5wdXRzW3R5cGVdID0gaW5wdXQ7XG5cbiAgICAvLyBTZXQgdGhlIGZpbGwgZm9yIHdlYmtpdCBub3dcbiAgICBjb250cm9scy51cGRhdGVSYW5nZUZpbGwuY2FsbCh0aGlzLCBpbnB1dCk7XG5cbiAgICAvLyBJbXByb3ZlIHN1cHBvcnQgb24gdG91Y2ggZGV2aWNlc1xuICAgIFJhbmdlVG91Y2guc2V0dXAoaW5wdXQpO1xuXG4gICAgcmV0dXJuIGlucHV0O1xuICB9LFxuXG4gIC8vIENyZWF0ZSBhIDxwcm9ncmVzcz5cbiAgY3JlYXRlUHJvZ3Jlc3ModHlwZSwgYXR0cmlidXRlcykge1xuICAgIGNvbnN0IHByb2dyZXNzID0gY3JlYXRlRWxlbWVudChcbiAgICAgICdwcm9ncmVzcycsXG4gICAgICBleHRlbmQoXG4gICAgICAgIGdldEF0dHJpYnV0ZXNGcm9tU2VsZWN0b3IodGhpcy5jb25maWcuc2VsZWN0b3JzLmRpc3BsYXlbdHlwZV0pLFxuICAgICAgICB7XG4gICAgICAgICAgbWluOiAwLFxuICAgICAgICAgIG1heDogMTAwLFxuICAgICAgICAgIHZhbHVlOiAwLFxuICAgICAgICAgIHJvbGU6ICdwcm9ncmVzc2JhcicsXG4gICAgICAgICAgJ2FyaWEtaGlkZGVuJzogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICAgICAgYXR0cmlidXRlcyxcbiAgICAgICksXG4gICAgKTtcblxuICAgIC8vIENyZWF0ZSB0aGUgbGFiZWwgaW5zaWRlXG4gICAgaWYgKHR5cGUgIT09ICd2b2x1bWUnKSB7XG4gICAgICBwcm9ncmVzcy5hcHBlbmRDaGlsZChjcmVhdGVFbGVtZW50KCdzcGFuJywgbnVsbCwgJzAnKSk7XG5cbiAgICAgIGNvbnN0IHN1ZmZpeEtleSA9IHtcbiAgICAgICAgcGxheWVkOiAncGxheWVkJyxcbiAgICAgICAgYnVmZmVyOiAnYnVmZmVyZWQnLFxuICAgICAgfVt0eXBlXTtcbiAgICAgIGNvbnN0IHN1ZmZpeCA9IHN1ZmZpeEtleSA/IGkxOG4uZ2V0KHN1ZmZpeEtleSwgdGhpcy5jb25maWcpIDogJyc7XG5cbiAgICAgIHByb2dyZXNzLmlubmVyVGV4dCA9IGAlICR7c3VmZml4LnRvTG93ZXJDYXNlKCl9YDtcbiAgICB9XG5cbiAgICB0aGlzLmVsZW1lbnRzLmRpc3BsYXlbdHlwZV0gPSBwcm9ncmVzcztcblxuICAgIHJldHVybiBwcm9ncmVzcztcbiAgfSxcblxuICAvLyBDcmVhdGUgdGltZSBkaXNwbGF5XG4gIGNyZWF0ZVRpbWUodHlwZSwgYXR0cnMpIHtcbiAgICBjb25zdCBhdHRyaWJ1dGVzID0gZ2V0QXR0cmlidXRlc0Zyb21TZWxlY3Rvcih0aGlzLmNvbmZpZy5zZWxlY3RvcnMuZGlzcGxheVt0eXBlXSwgYXR0cnMpO1xuXG4gICAgY29uc3QgY29udGFpbmVyID0gY3JlYXRlRWxlbWVudChcbiAgICAgICdkaXYnLFxuICAgICAgZXh0ZW5kKGF0dHJpYnV0ZXMsIHtcbiAgICAgICAgY2xhc3M6IGAke2F0dHJpYnV0ZXMuY2xhc3MgPyBhdHRyaWJ1dGVzLmNsYXNzIDogJyd9ICR7dGhpcy5jb25maWcuY2xhc3NOYW1lcy5kaXNwbGF5LnRpbWV9IGAudHJpbSgpLFxuICAgICAgICAnYXJpYS1sYWJlbCc6IGkxOG4uZ2V0KHR5cGUsIHRoaXMuY29uZmlnKSxcbiAgICAgIH0pLFxuICAgICAgJzAwOjAwJyxcbiAgICApO1xuXG4gICAgLy8gUmVmZXJlbmNlIGZvciB1cGRhdGVzXG4gICAgdGhpcy5lbGVtZW50cy5kaXNwbGF5W3R5cGVdID0gY29udGFpbmVyO1xuXG4gICAgcmV0dXJuIGNvbnRhaW5lcjtcbiAgfSxcblxuICAvLyBCaW5kIGtleWJvYXJkIHNob3J0Y3V0cyBmb3IgYSBtZW51IGl0ZW1cbiAgLy8gV2UgaGF2ZSB0byBiaW5kIHRvIGtleXVwIG90aGVyd2lzZSBGaXJlZm94IHRyaWdnZXJzIGEgY2xpY2sgd2hlbiBhIGtleWRvd24gZXZlbnQgaGFuZGxlciBzaGlmdHMgZm9jdXNcbiAgLy8gaHR0cHM6Ly9idWd6aWxsYS5tb3ppbGxhLm9yZy9zaG93X2J1Zy5jZ2k/aWQ9MTIyMDE0M1xuICBiaW5kTWVudUl0ZW1TaG9ydGN1dHMobWVudUl0ZW0sIHR5cGUpIHtcbiAgICAvLyBOYXZpZ2F0ZSB0aHJvdWdoIG1lbnVzIHZpYSBhcnJvdyBrZXlzIGFuZCBzcGFjZVxuICAgIG9uLmNhbGwoXG4gICAgICB0aGlzLFxuICAgICAgbWVudUl0ZW0sXG4gICAgICAna2V5ZG93biBrZXl1cCcsXG4gICAgICAoZXZlbnQpID0+IHtcbiAgICAgICAgLy8gV2Ugb25seSBjYXJlIGFib3V0IHNwYWNlIGFuZCDirIbvuI8g4qyH77iP77iPIOKeoe+4j1xuICAgICAgICBpZiAoIVsnU3BhY2UnLCAnQXJyb3dVcCcsICdBcnJvd0Rvd24nLCAnQXJyb3dSaWdodCddLmluY2x1ZGVzKGV2ZW50LmtleSkpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICAvLyBQcmV2ZW50IHBsYXkgLyBzZWVrXG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuXG4gICAgICAgIC8vIFdlJ3JlIGp1c3QgaGVyZSB0byBwcmV2ZW50IHRoZSBrZXlkb3duIGJ1YmJsaW5nXG4gICAgICAgIGlmIChldmVudC50eXBlID09PSAna2V5ZG93bicpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBpc1JhZGlvQnV0dG9uID0gbWF0Y2hlcyhtZW51SXRlbSwgJ1tyb2xlPVwibWVudWl0ZW1yYWRpb1wiXScpO1xuXG4gICAgICAgIC8vIFNob3cgdGhlIHJlc3BlY3RpdmUgbWVudVxuICAgICAgICBpZiAoIWlzUmFkaW9CdXR0b24gJiYgWydTcGFjZScsICdBcnJvd1JpZ2h0J10uaW5jbHVkZXMoZXZlbnQua2V5KSkge1xuICAgICAgICAgIGNvbnRyb2xzLnNob3dNZW51UGFuZWwuY2FsbCh0aGlzLCB0eXBlLCB0cnVlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBsZXQgdGFyZ2V0O1xuXG4gICAgICAgICAgaWYgKGV2ZW50LmtleSAhPT0gJ1NwYWNlJykge1xuICAgICAgICAgICAgaWYgKGV2ZW50LmtleSA9PT0gJ0Fycm93RG93bicgfHwgKGlzUmFkaW9CdXR0b24gJiYgZXZlbnQua2V5ID09PSAnQXJyb3dSaWdodCcpKSB7XG4gICAgICAgICAgICAgIHRhcmdldCA9IG1lbnVJdGVtLm5leHRFbGVtZW50U2libGluZztcblxuICAgICAgICAgICAgICBpZiAoIWlzLmVsZW1lbnQodGFyZ2V0KSkge1xuICAgICAgICAgICAgICAgIHRhcmdldCA9IG1lbnVJdGVtLnBhcmVudE5vZGUuZmlyc3RFbGVtZW50Q2hpbGQ7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHRhcmdldCA9IG1lbnVJdGVtLnByZXZpb3VzRWxlbWVudFNpYmxpbmc7XG5cbiAgICAgICAgICAgICAgaWYgKCFpcy5lbGVtZW50KHRhcmdldCkpIHtcbiAgICAgICAgICAgICAgICB0YXJnZXQgPSBtZW51SXRlbS5wYXJlbnROb2RlLmxhc3RFbGVtZW50Q2hpbGQ7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc2V0Rm9jdXMuY2FsbCh0aGlzLCB0YXJnZXQsIHRydWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGZhbHNlLFxuICAgICk7XG5cbiAgICAvLyBFbnRlciB3aWxsIGZpcmUgYSBgY2xpY2tgIGV2ZW50IGJ1dCB3ZSBzdGlsbCBuZWVkIHRvIG1hbmFnZSBmb2N1c1xuICAgIC8vIFNvIHdlIGJpbmQgdG8ga2V5dXAgd2hpY2ggZmlyZXMgYWZ0ZXIgYW5kIHNldCBmb2N1cyBoZXJlXG4gICAgb24uY2FsbCh0aGlzLCBtZW51SXRlbSwgJ2tleXVwJywgKGV2ZW50KSA9PiB7XG4gICAgICBpZiAoZXZlbnQua2V5ICE9PSAnUmV0dXJuJykgcmV0dXJuO1xuXG4gICAgICBjb250cm9scy5mb2N1c0ZpcnN0TWVudUl0ZW0uY2FsbCh0aGlzLCBudWxsLCB0cnVlKTtcbiAgICB9KTtcbiAgfSxcblxuICAvLyBDcmVhdGUgYSBzZXR0aW5ncyBtZW51IGl0ZW1cbiAgY3JlYXRlTWVudUl0ZW0oeyB2YWx1ZSwgbGlzdCwgdHlwZSwgdGl0bGUsIGJhZGdlID0gbnVsbCwgY2hlY2tlZCA9IGZhbHNlIH0pIHtcbiAgICBjb25zdCBhdHRyaWJ1dGVzID0gZ2V0QXR0cmlidXRlc0Zyb21TZWxlY3Rvcih0aGlzLmNvbmZpZy5zZWxlY3RvcnMuaW5wdXRzW3R5cGVdKTtcblxuICAgIGNvbnN0IG1lbnVJdGVtID0gY3JlYXRlRWxlbWVudChcbiAgICAgICdidXR0b24nLFxuICAgICAgZXh0ZW5kKGF0dHJpYnV0ZXMsIHtcbiAgICAgICAgdHlwZTogJ2J1dHRvbicsXG4gICAgICAgIHJvbGU6ICdtZW51aXRlbXJhZGlvJyxcbiAgICAgICAgY2xhc3M6IGAke3RoaXMuY29uZmlnLmNsYXNzTmFtZXMuY29udHJvbH0gJHthdHRyaWJ1dGVzLmNsYXNzID8gYXR0cmlidXRlcy5jbGFzcyA6ICcnfWAudHJpbSgpLFxuICAgICAgICAnYXJpYS1jaGVja2VkJzogY2hlY2tlZCxcbiAgICAgICAgdmFsdWUsXG4gICAgICB9KSxcbiAgICApO1xuXG4gICAgY29uc3QgZmxleCA9IGNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcblxuICAgIC8vIFdlIGhhdmUgdG8gc2V0IGFzIEhUTUwgaW5jYXNlIG9mIHNwZWNpYWwgY2hhcmFjdGVyc1xuICAgIGZsZXguaW5uZXJIVE1MID0gdGl0bGU7XG5cbiAgICBpZiAoaXMuZWxlbWVudChiYWRnZSkpIHtcbiAgICAgIGZsZXguYXBwZW5kQ2hpbGQoYmFkZ2UpO1xuICAgIH1cblxuICAgIG1lbnVJdGVtLmFwcGVuZENoaWxkKGZsZXgpO1xuXG4gICAgLy8gUmVwbGljYXRlIHJhZGlvIGJ1dHRvbiBiZWhhdmlvclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShtZW51SXRlbSwgJ2NoZWNrZWQnLCB7XG4gICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgZ2V0KCkge1xuICAgICAgICByZXR1cm4gbWVudUl0ZW0uZ2V0QXR0cmlidXRlKCdhcmlhLWNoZWNrZWQnKSA9PT0gJ3RydWUnO1xuICAgICAgfSxcbiAgICAgIHNldChjaGVjaykge1xuICAgICAgICAvLyBFbnN1cmUgZXhjbHVzaXZpdHlcbiAgICAgICAgaWYgKGNoZWNrKSB7XG4gICAgICAgICAgQXJyYXkuZnJvbShtZW51SXRlbS5wYXJlbnROb2RlLmNoaWxkcmVuKVxuICAgICAgICAgICAgLmZpbHRlcigobm9kZSkgPT4gbWF0Y2hlcyhub2RlLCAnW3JvbGU9XCJtZW51aXRlbXJhZGlvXCJdJykpXG4gICAgICAgICAgICAuZm9yRWFjaCgobm9kZSkgPT4gbm9kZS5zZXRBdHRyaWJ1dGUoJ2FyaWEtY2hlY2tlZCcsICdmYWxzZScpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIG1lbnVJdGVtLnNldEF0dHJpYnV0ZSgnYXJpYS1jaGVja2VkJywgY2hlY2sgPyAndHJ1ZScgOiAnZmFsc2UnKTtcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICB0aGlzLmxpc3RlbmVycy5iaW5kKFxuICAgICAgbWVudUl0ZW0sXG4gICAgICAnY2xpY2sga2V5dXAnLFxuICAgICAgKGV2ZW50KSA9PiB7XG4gICAgICAgIGlmIChpcy5rZXlib2FyZEV2ZW50KGV2ZW50KSAmJiBldmVudC5rZXkgIT09ICdTcGFjZScpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcblxuICAgICAgICBtZW51SXRlbS5jaGVja2VkID0gdHJ1ZTtcblxuICAgICAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgICAgICBjYXNlICdsYW5ndWFnZSc6XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRUcmFjayA9IE51bWJlcih2YWx1ZSk7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGNhc2UgJ3F1YWxpdHknOlxuICAgICAgICAgICAgdGhpcy5xdWFsaXR5ID0gdmFsdWU7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGNhc2UgJ3NwZWVkJzpcbiAgICAgICAgICAgIHRoaXMuc3BlZWQgPSBwYXJzZUZsb2F0KHZhbHVlKTtcbiAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICAgICAgY29udHJvbHMuc2hvd01lbnVQYW5lbC5jYWxsKHRoaXMsICdob21lJywgaXMua2V5Ym9hcmRFdmVudChldmVudCkpO1xuICAgICAgfSxcbiAgICAgIHR5cGUsXG4gICAgICBmYWxzZSxcbiAgICApO1xuXG4gICAgY29udHJvbHMuYmluZE1lbnVJdGVtU2hvcnRjdXRzLmNhbGwodGhpcywgbWVudUl0ZW0sIHR5cGUpO1xuXG4gICAgbGlzdC5hcHBlbmRDaGlsZChtZW51SXRlbSk7XG4gIH0sXG5cbiAgLy8gRm9ybWF0IGEgdGltZSBmb3IgZGlzcGxheVxuICBmb3JtYXRUaW1lKHRpbWUgPSAwLCBpbnZlcnRlZCA9IGZhbHNlKSB7XG4gICAgLy8gQmFpbCBpZiB0aGUgdmFsdWUgaXNuJ3QgYSBudW1iZXJcbiAgICBpZiAoIWlzLm51bWJlcih0aW1lKSkge1xuICAgICAgcmV0dXJuIHRpbWU7XG4gICAgfVxuXG4gICAgLy8gQWx3YXlzIGRpc3BsYXkgaG91cnMgaWYgZHVyYXRpb24gaXMgb3ZlciBhbiBob3VyXG4gICAgY29uc3QgZm9yY2VIb3VycyA9IGdldEhvdXJzKHRoaXMuZHVyYXRpb24pID4gMDtcblxuICAgIHJldHVybiBmb3JtYXRUaW1lKHRpbWUsIGZvcmNlSG91cnMsIGludmVydGVkKTtcbiAgfSxcblxuICAvLyBVcGRhdGUgdGhlIGRpc3BsYXllZCB0aW1lXG4gIHVwZGF0ZVRpbWVEaXNwbGF5KHRhcmdldCA9IG51bGwsIHRpbWUgPSAwLCBpbnZlcnRlZCA9IGZhbHNlKSB7XG4gICAgLy8gQmFpbCBpZiB0aGVyZSdzIG5vIGVsZW1lbnQgdG8gZGlzcGxheSBvciB0aGUgdmFsdWUgaXNuJ3QgYSBudW1iZXJcbiAgICBpZiAoIWlzLmVsZW1lbnQodGFyZ2V0KSB8fCAhaXMubnVtYmVyKHRpbWUpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXBhcmFtLXJlYXNzaWduXG4gICAgdGFyZ2V0LmlubmVyVGV4dCA9IGNvbnRyb2xzLmZvcm1hdFRpbWUodGltZSwgaW52ZXJ0ZWQpO1xuICB9LFxuXG4gIC8vIFVwZGF0ZSB2b2x1bWUgVUkgYW5kIHN0b3JhZ2VcbiAgdXBkYXRlVm9sdW1lKCkge1xuICAgIGlmICghdGhpcy5zdXBwb3J0ZWQudWkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBVcGRhdGUgcmFuZ2VcbiAgICBpZiAoaXMuZWxlbWVudCh0aGlzLmVsZW1lbnRzLmlucHV0cy52b2x1bWUpKSB7XG4gICAgICBjb250cm9scy5zZXRSYW5nZS5jYWxsKHRoaXMsIHRoaXMuZWxlbWVudHMuaW5wdXRzLnZvbHVtZSwgdGhpcy5tdXRlZCA/IDAgOiB0aGlzLnZvbHVtZSk7XG4gICAgfVxuXG4gICAgLy8gVXBkYXRlIG11dGUgc3RhdGVcbiAgICBpZiAoaXMuZWxlbWVudCh0aGlzLmVsZW1lbnRzLmJ1dHRvbnMubXV0ZSkpIHtcbiAgICAgIHRoaXMuZWxlbWVudHMuYnV0dG9ucy5tdXRlLnByZXNzZWQgPSB0aGlzLm11dGVkIHx8IHRoaXMudm9sdW1lID09PSAwO1xuICAgIH1cbiAgfSxcblxuICAvLyBVcGRhdGUgc2VlayB2YWx1ZSBhbmQgbG93ZXIgZmlsbFxuICBzZXRSYW5nZSh0YXJnZXQsIHZhbHVlID0gMCkge1xuICAgIGlmICghaXMuZWxlbWVudCh0YXJnZXQpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lXG4gICAgdGFyZ2V0LnZhbHVlID0gdmFsdWU7XG5cbiAgICAvLyBXZWJraXQgcmFuZ2UgZmlsbFxuICAgIGNvbnRyb2xzLnVwZGF0ZVJhbmdlRmlsbC5jYWxsKHRoaXMsIHRhcmdldCk7XG4gIH0sXG5cbiAgLy8gVXBkYXRlIDxwcm9ncmVzcz4gZWxlbWVudHNcbiAgdXBkYXRlUHJvZ3Jlc3MoZXZlbnQpIHtcbiAgICBpZiAoIXRoaXMuc3VwcG9ydGVkLnVpIHx8ICFpcy5ldmVudChldmVudCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBsZXQgdmFsdWUgPSAwO1xuXG4gICAgY29uc3Qgc2V0UHJvZ3Jlc3MgPSAodGFyZ2V0LCBpbnB1dCkgPT4ge1xuICAgICAgY29uc3QgdmFsID0gaXMubnVtYmVyKGlucHV0KSA/IGlucHV0IDogMDtcbiAgICAgIGNvbnN0IHByb2dyZXNzID0gaXMuZWxlbWVudCh0YXJnZXQpID8gdGFyZ2V0IDogdGhpcy5lbGVtZW50cy5kaXNwbGF5LmJ1ZmZlcjtcblxuICAgICAgLy8gVXBkYXRlIHZhbHVlIGFuZCBsYWJlbFxuICAgICAgaWYgKGlzLmVsZW1lbnQocHJvZ3Jlc3MpKSB7XG4gICAgICAgIHByb2dyZXNzLnZhbHVlID0gdmFsO1xuXG4gICAgICAgIC8vIFVwZGF0ZSB0ZXh0IGxhYmVsIGluc2lkZVxuICAgICAgICBjb25zdCBsYWJlbCA9IHByb2dyZXNzLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdzcGFuJylbMF07XG4gICAgICAgIGlmIChpcy5lbGVtZW50KGxhYmVsKSkge1xuICAgICAgICAgIGxhYmVsLmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID0gdmFsO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcblxuICAgIGlmIChldmVudCkge1xuICAgICAgc3dpdGNoIChldmVudC50eXBlKSB7XG4gICAgICAgIC8vIFZpZGVvIHBsYXlpbmdcbiAgICAgICAgY2FzZSAndGltZXVwZGF0ZSc6XG4gICAgICAgIGNhc2UgJ3NlZWtpbmcnOlxuICAgICAgICBjYXNlICdzZWVrZWQnOlxuICAgICAgICAgIHZhbHVlID0gZ2V0UGVyY2VudGFnZSh0aGlzLmN1cnJlbnRUaW1lLCB0aGlzLmR1cmF0aW9uKTtcblxuICAgICAgICAgIC8vIFNldCBzZWVrIHJhbmdlIHZhbHVlIG9ubHkgaWYgaXQncyBhICduYXR1cmFsJyB0aW1lIGV2ZW50XG4gICAgICAgICAgaWYgKGV2ZW50LnR5cGUgPT09ICd0aW1ldXBkYXRlJykge1xuICAgICAgICAgICAgY29udHJvbHMuc2V0UmFuZ2UuY2FsbCh0aGlzLCB0aGlzLmVsZW1lbnRzLmlucHV0cy5zZWVrLCB2YWx1ZSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgLy8gQ2hlY2sgYnVmZmVyIHN0YXR1c1xuICAgICAgICBjYXNlICdwbGF5aW5nJzpcbiAgICAgICAgY2FzZSAncHJvZ3Jlc3MnOlxuICAgICAgICAgIHNldFByb2dyZXNzKHRoaXMuZWxlbWVudHMuZGlzcGxheS5idWZmZXIsIHRoaXMuYnVmZmVyZWQgKiAxMDApO1xuXG4gICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gIH0sXG5cbiAgLy8gV2Via2l0IHBvbHlmaWxsIGZvciBsb3dlciBmaWxsIHJhbmdlXG4gIHVwZGF0ZVJhbmdlRmlsbCh0YXJnZXQpIHtcbiAgICAvLyBHZXQgcmFuZ2UgZnJvbSBldmVudCBpZiBldmVudCBwYXNzZWRcbiAgICBjb25zdCByYW5nZSA9IGlzLmV2ZW50KHRhcmdldCkgPyB0YXJnZXQudGFyZ2V0IDogdGFyZ2V0O1xuXG4gICAgLy8gTmVlZHMgdG8gYmUgYSB2YWxpZCA8aW5wdXQgdHlwZT0ncmFuZ2UnPlxuICAgIGlmICghaXMuZWxlbWVudChyYW5nZSkgfHwgcmFuZ2UuZ2V0QXR0cmlidXRlKCd0eXBlJykgIT09ICdyYW5nZScpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBTZXQgYXJpYSB2YWx1ZXMgZm9yIGh0dHBzOi8vZ2l0aHViLmNvbS9zYW1wb3R0cy9wbHlyL2lzc3Vlcy85MDVcbiAgICBpZiAobWF0Y2hlcyhyYW5nZSwgdGhpcy5jb25maWcuc2VsZWN0b3JzLmlucHV0cy5zZWVrKSkge1xuICAgICAgcmFuZ2Uuc2V0QXR0cmlidXRlKCdhcmlhLXZhbHVlbm93JywgdGhpcy5jdXJyZW50VGltZSk7XG4gICAgICBjb25zdCBjdXJyZW50VGltZSA9IGNvbnRyb2xzLmZvcm1hdFRpbWUodGhpcy5jdXJyZW50VGltZSk7XG4gICAgICBjb25zdCBkdXJhdGlvbiA9IGNvbnRyb2xzLmZvcm1hdFRpbWUodGhpcy5kdXJhdGlvbik7XG4gICAgICBjb25zdCBmb3JtYXQgPSBpMThuLmdldCgnc2Vla0xhYmVsJywgdGhpcy5jb25maWcpO1xuICAgICAgcmFuZ2Uuc2V0QXR0cmlidXRlKFxuICAgICAgICAnYXJpYS12YWx1ZXRleHQnLFxuICAgICAgICBmb3JtYXQucmVwbGFjZSgne2N1cnJlbnRUaW1lfScsIGN1cnJlbnRUaW1lKS5yZXBsYWNlKCd7ZHVyYXRpb259JywgZHVyYXRpb24pLFxuICAgICAgKTtcbiAgICB9IGVsc2UgaWYgKG1hdGNoZXMocmFuZ2UsIHRoaXMuY29uZmlnLnNlbGVjdG9ycy5pbnB1dHMudm9sdW1lKSkge1xuICAgICAgY29uc3QgcGVyY2VudCA9IHJhbmdlLnZhbHVlICogMTAwO1xuICAgICAgcmFuZ2Uuc2V0QXR0cmlidXRlKCdhcmlhLXZhbHVlbm93JywgcGVyY2VudCk7XG4gICAgICByYW5nZS5zZXRBdHRyaWJ1dGUoJ2FyaWEtdmFsdWV0ZXh0JywgYCR7cGVyY2VudC50b0ZpeGVkKDEpfSVgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmFuZ2Uuc2V0QXR0cmlidXRlKCdhcmlhLXZhbHVlbm93JywgcmFuZ2UudmFsdWUpO1xuICAgIH1cblxuICAgIC8vIFdlYktpdCBvbmx5XG4gICAgaWYgKCFicm93c2VyLmlzV2Via2l0KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gU2V0IENTUyBjdXN0b20gcHJvcGVydHlcbiAgICByYW5nZS5zdHlsZS5zZXRQcm9wZXJ0eSgnLS12YWx1ZScsIGAkeyhyYW5nZS52YWx1ZSAvIHJhbmdlLm1heCkgKiAxMDB9JWApO1xuICB9LFxuXG4gIC8vIFVwZGF0ZSBob3ZlciB0b29sdGlwIGZvciBzZWVraW5nXG4gIHVwZGF0ZVNlZWtUb29sdGlwKGV2ZW50KSB7XG4gICAgLy8gQmFpbCBpZiBzZXR0aW5nIG5vdCB0cnVlXG4gICAgaWYgKFxuICAgICAgIXRoaXMuY29uZmlnLnRvb2x0aXBzLnNlZWsgfHxcbiAgICAgICFpcy5lbGVtZW50KHRoaXMuZWxlbWVudHMuaW5wdXRzLnNlZWspIHx8XG4gICAgICAhaXMuZWxlbWVudCh0aGlzLmVsZW1lbnRzLmRpc3BsYXkuc2Vla1Rvb2x0aXApIHx8XG4gICAgICB0aGlzLmR1cmF0aW9uID09PSAwXG4gICAgKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgdGlwRWxlbWVudCA9IHRoaXMuZWxlbWVudHMuZGlzcGxheS5zZWVrVG9vbHRpcDtcbiAgICBjb25zdCB2aXNpYmxlID0gYCR7dGhpcy5jb25maWcuY2xhc3NOYW1lcy50b29sdGlwfS0tdmlzaWJsZWA7XG4gICAgY29uc3QgdG9nZ2xlID0gKHNob3cpID0+IHRvZ2dsZUNsYXNzKHRpcEVsZW1lbnQsIHZpc2libGUsIHNob3cpO1xuXG4gICAgLy8gSGlkZSBvbiB0b3VjaFxuICAgIGlmICh0aGlzLnRvdWNoKSB7XG4gICAgICB0b2dnbGUoZmFsc2UpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIERldGVybWluZSBwZXJjZW50YWdlLCBpZiBhbHJlYWR5IHZpc2libGVcbiAgICBsZXQgcGVyY2VudCA9IDA7XG4gICAgY29uc3QgY2xpZW50UmVjdCA9IHRoaXMuZWxlbWVudHMucHJvZ3Jlc3MuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG5cbiAgICBpZiAoaXMuZXZlbnQoZXZlbnQpKSB7XG4gICAgICBwZXJjZW50ID0gKDEwMCAvIGNsaWVudFJlY3Qud2lkdGgpICogKGV2ZW50LnBhZ2VYIC0gY2xpZW50UmVjdC5sZWZ0KTtcbiAgICB9IGVsc2UgaWYgKGhhc0NsYXNzKHRpcEVsZW1lbnQsIHZpc2libGUpKSB7XG4gICAgICBwZXJjZW50ID0gcGFyc2VGbG9hdCh0aXBFbGVtZW50LnN0eWxlLmxlZnQsIDEwKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIFNldCBib3VuZHNcbiAgICBpZiAocGVyY2VudCA8IDApIHtcbiAgICAgIHBlcmNlbnQgPSAwO1xuICAgIH0gZWxzZSBpZiAocGVyY2VudCA+IDEwMCkge1xuICAgICAgcGVyY2VudCA9IDEwMDtcbiAgICB9XG5cbiAgICBjb25zdCB0aW1lID0gKHRoaXMuZHVyYXRpb24gLyAxMDApICogcGVyY2VudDtcblxuICAgIC8vIERpc3BsYXkgdGhlIHRpbWUgYSBjbGljayB3b3VsZCBzZWVrIHRvXG4gICAgdGlwRWxlbWVudC5pbm5lclRleHQgPSBjb250cm9scy5mb3JtYXRUaW1lKHRpbWUpO1xuXG4gICAgLy8gR2V0IG1hcmtlciBwb2ludCBmb3IgdGltZVxuICAgIGNvbnN0IHBvaW50ID0gdGhpcy5jb25maWcubWFya2Vycz8ucG9pbnRzPy5maW5kKCh7IHRpbWU6IHQgfSkgPT4gdCA9PT0gTWF0aC5yb3VuZCh0aW1lKSk7XG5cbiAgICAvLyBBcHBlbmQgdGhlIHBvaW50IGxhYmVsIHRvIHRoZSB0b29sdGlwXG4gICAgaWYgKHBvaW50KSB7XG4gICAgICB0aXBFbGVtZW50Lmluc2VydEFkamFjZW50SFRNTCgnYWZ0ZXJiZWdpbicsIGAke3BvaW50LmxhYmVsfTxicj5gKTtcbiAgICB9XG5cbiAgICAvLyBTZXQgcG9zaXRpb25cbiAgICB0aXBFbGVtZW50LnN0eWxlLmxlZnQgPSBgJHtwZXJjZW50fSVgO1xuXG4gICAgLy8gU2hvdy9oaWRlIHRoZSB0b29sdGlwXG4gICAgLy8gSWYgdGhlIGV2ZW50IGlzIGEgbW91ZXMgaW4vb3V0IGFuZCBwZXJjZW50YWdlIGlzIGluc2lkZSBib3VuZHNcbiAgICBpZiAoaXMuZXZlbnQoZXZlbnQpICYmIFsnbW91c2VlbnRlcicsICdtb3VzZWxlYXZlJ10uaW5jbHVkZXMoZXZlbnQudHlwZSkpIHtcbiAgICAgIHRvZ2dsZShldmVudC50eXBlID09PSAnbW91c2VlbnRlcicpO1xuICAgIH1cbiAgfSxcblxuICAvLyBIYW5kbGUgdGltZSBjaGFuZ2UgZXZlbnRcbiAgdGltZVVwZGF0ZShldmVudCkge1xuICAgIC8vIE9ubHkgaW52ZXJ0IGlmIG9ubHkgb25lIHRpbWUgZWxlbWVudCBpcyBkaXNwbGF5ZWQgYW5kIHVzZWQgZm9yIGJvdGggZHVyYXRpb24gYW5kIGN1cnJlbnRUaW1lXG4gICAgY29uc3QgaW52ZXJ0ID0gIWlzLmVsZW1lbnQodGhpcy5lbGVtZW50cy5kaXNwbGF5LmR1cmF0aW9uKSAmJiB0aGlzLmNvbmZpZy5pbnZlcnRUaW1lO1xuXG4gICAgLy8gRHVyYXRpb25cbiAgICBjb250cm9scy51cGRhdGVUaW1lRGlzcGxheS5jYWxsKFxuICAgICAgdGhpcyxcbiAgICAgIHRoaXMuZWxlbWVudHMuZGlzcGxheS5jdXJyZW50VGltZSxcbiAgICAgIGludmVydCA/IHRoaXMuZHVyYXRpb24gLSB0aGlzLmN1cnJlbnRUaW1lIDogdGhpcy5jdXJyZW50VGltZSxcbiAgICAgIGludmVydCxcbiAgICApO1xuXG4gICAgLy8gSWdub3JlIHVwZGF0ZXMgd2hpbGUgc2Vla2luZ1xuICAgIGlmIChldmVudCAmJiBldmVudC50eXBlID09PSAndGltZXVwZGF0ZScgJiYgdGhpcy5tZWRpYS5zZWVraW5nKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gUGxheWluZyBwcm9ncmVzc1xuICAgIGNvbnRyb2xzLnVwZGF0ZVByb2dyZXNzLmNhbGwodGhpcywgZXZlbnQpO1xuICB9LFxuXG4gIC8vIFNob3cgdGhlIGR1cmF0aW9uIG9uIG1ldGFkYXRhbG9hZGVkIG9yIGR1cmF0aW9uY2hhbmdlIGV2ZW50c1xuICBkdXJhdGlvblVwZGF0ZSgpIHtcbiAgICAvLyBCYWlsIGlmIG5vIFVJIG9yIGR1cmF0aW9uY2hhbmdlIGV2ZW50IHRyaWdnZXJlZCBhZnRlciBwbGF5aW5nL3NlZWsgd2hlbiBpbnZlcnRUaW1lIGlzIGZhbHNlXG4gICAgaWYgKCF0aGlzLnN1cHBvcnRlZC51aSB8fCAoIXRoaXMuY29uZmlnLmludmVydFRpbWUgJiYgdGhpcy5jdXJyZW50VGltZSkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBJZiBkdXJhdGlvbiBpcyB0aGUgMioqMzIgKHNoYWthKSwgSW5maW5pdHkgKEhMUyksIERBU0gtSUYgKE51bWJlci5NQVhfU0FGRV9JTlRFR0VSIHx8IE51bWJlci5NQVhfVkFMVUUpIGluZGljYXRpbmcgbGl2ZSB3ZSBoaWRlIHRoZSBjdXJyZW50VGltZSBhbmQgcHJvZ3Jlc3NiYXIuXG4gICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3ZpZGVvLWRldi9obHMuanMvYmxvYi81ODIwZDI5ZDNjNGM4YTQ2ZThiNzVmMWUzYWZhM2U2OGMxYTlhMmRiL3NyYy9jb250cm9sbGVyL2J1ZmZlci1jb250cm9sbGVyLmpzI0w0MTVcbiAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vZ29vZ2xlL3NoYWthLXBsYXllci9ibG9iLzRkODg5MDU0NjMxZjRlMWNmMGZiZDgwZGRkMmI3MTg4N2MwMmUyMzIvbGliL21lZGlhL3N0cmVhbWluZ19lbmdpbmUuanMjTDEwNjJcbiAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vRGFzaC1JbmR1c3RyeS1Gb3J1bS9kYXNoLmpzL2Jsb2IvNjk4NTlmNTFiOTY5NjQ1YjIzNDY2NjgwMGQ0Y2I1OTZkODljNjAyZC9zcmMvZGFzaC9tb2RlbHMvRGFzaE1hbmlmZXN0TW9kZWwuanMjTDMzOFxuICAgIGlmICh0aGlzLmR1cmF0aW9uID49IDIgKiogMzIpIHtcbiAgICAgIHRvZ2dsZUhpZGRlbih0aGlzLmVsZW1lbnRzLmRpc3BsYXkuY3VycmVudFRpbWUsIHRydWUpO1xuICAgICAgdG9nZ2xlSGlkZGVuKHRoaXMuZWxlbWVudHMucHJvZ3Jlc3MsIHRydWUpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIFVwZGF0ZSBBUklBIHZhbHVlc1xuICAgIGlmIChpcy5lbGVtZW50KHRoaXMuZWxlbWVudHMuaW5wdXRzLnNlZWspKSB7XG4gICAgICB0aGlzLmVsZW1lbnRzLmlucHV0cy5zZWVrLnNldEF0dHJpYnV0ZSgnYXJpYS12YWx1ZW1heCcsIHRoaXMuZHVyYXRpb24pO1xuICAgIH1cblxuICAgIC8vIElmIHRoZXJlJ3MgYSBzcG90IHRvIGRpc3BsYXkgZHVyYXRpb25cbiAgICBjb25zdCBoYXNEdXJhdGlvbiA9IGlzLmVsZW1lbnQodGhpcy5lbGVtZW50cy5kaXNwbGF5LmR1cmF0aW9uKTtcblxuICAgIC8vIElmIHRoZXJlJ3Mgb25seSBvbmUgdGltZSBkaXNwbGF5LCBkaXNwbGF5IGR1cmF0aW9uIHRoZXJlXG4gICAgaWYgKCFoYXNEdXJhdGlvbiAmJiB0aGlzLmNvbmZpZy5kaXNwbGF5RHVyYXRpb24gJiYgdGhpcy5wYXVzZWQpIHtcbiAgICAgIGNvbnRyb2xzLnVwZGF0ZVRpbWVEaXNwbGF5LmNhbGwodGhpcywgdGhpcy5lbGVtZW50cy5kaXNwbGF5LmN1cnJlbnRUaW1lLCB0aGlzLmR1cmF0aW9uKTtcbiAgICB9XG5cbiAgICAvLyBJZiB0aGVyZSdzIGEgZHVyYXRpb24gZWxlbWVudCwgdXBkYXRlIGNvbnRlbnRcbiAgICBpZiAoaGFzRHVyYXRpb24pIHtcbiAgICAgIGNvbnRyb2xzLnVwZGF0ZVRpbWVEaXNwbGF5LmNhbGwodGhpcywgdGhpcy5lbGVtZW50cy5kaXNwbGF5LmR1cmF0aW9uLCB0aGlzLmR1cmF0aW9uKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5jb25maWcubWFya2Vycy5lbmFibGVkKSB7XG4gICAgICBjb250cm9scy5zZXRNYXJrZXJzLmNhbGwodGhpcyk7XG4gICAgfVxuXG4gICAgLy8gVXBkYXRlIHRoZSB0b29sdGlwIChpZiB2aXNpYmxlKVxuICAgIGNvbnRyb2xzLnVwZGF0ZVNlZWtUb29sdGlwLmNhbGwodGhpcyk7XG4gIH0sXG5cbiAgLy8gSGlkZS9zaG93IGEgdGFiXG4gIHRvZ2dsZU1lbnVCdXR0b24oc2V0dGluZywgdG9nZ2xlKSB7XG4gICAgdG9nZ2xlSGlkZGVuKHRoaXMuZWxlbWVudHMuc2V0dGluZ3MuYnV0dG9uc1tzZXR0aW5nXSwgIXRvZ2dsZSk7XG4gIH0sXG5cbiAgLy8gVXBkYXRlIHRoZSBzZWxlY3RlZCBzZXR0aW5nXG4gIHVwZGF0ZVNldHRpbmcoc2V0dGluZywgY29udGFpbmVyLCBpbnB1dCkge1xuICAgIGNvbnN0IHBhbmUgPSB0aGlzLmVsZW1lbnRzLnNldHRpbmdzLnBhbmVsc1tzZXR0aW5nXTtcbiAgICBsZXQgdmFsdWUgPSBudWxsO1xuICAgIGxldCBsaXN0ID0gY29udGFpbmVyO1xuXG4gICAgaWYgKHNldHRpbmcgPT09ICdjYXB0aW9ucycpIHtcbiAgICAgIHZhbHVlID0gdGhpcy5jdXJyZW50VHJhY2s7XG4gICAgfSBlbHNlIHtcbiAgICAgIHZhbHVlID0gIWlzLmVtcHR5KGlucHV0KSA/IGlucHV0IDogdGhpc1tzZXR0aW5nXTtcblxuICAgICAgLy8gR2V0IGRlZmF1bHRcbiAgICAgIGlmIChpcy5lbXB0eSh2YWx1ZSkpIHtcbiAgICAgICAgdmFsdWUgPSB0aGlzLmNvbmZpZ1tzZXR0aW5nXS5kZWZhdWx0O1xuICAgICAgfVxuXG4gICAgICAvLyBVbnN1cHBvcnRlZCB2YWx1ZVxuICAgICAgaWYgKCFpcy5lbXB0eSh0aGlzLm9wdGlvbnNbc2V0dGluZ10pICYmICF0aGlzLm9wdGlvbnNbc2V0dGluZ10uaW5jbHVkZXModmFsdWUpKSB7XG4gICAgICAgIHRoaXMuZGVidWcud2FybihgVW5zdXBwb3J0ZWQgdmFsdWUgb2YgJyR7dmFsdWV9JyBmb3IgJHtzZXR0aW5nfWApO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vIERpc2FibGVkIHZhbHVlXG4gICAgICBpZiAoIXRoaXMuY29uZmlnW3NldHRpbmddLm9wdGlvbnMuaW5jbHVkZXModmFsdWUpKSB7XG4gICAgICAgIHRoaXMuZGVidWcud2FybihgRGlzYWJsZWQgdmFsdWUgb2YgJyR7dmFsdWV9JyBmb3IgJHtzZXR0aW5nfWApO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gR2V0IHRoZSBsaXN0IGlmIHdlIG5lZWQgdG9cbiAgICBpZiAoIWlzLmVsZW1lbnQobGlzdCkpIHtcbiAgICAgIGxpc3QgPSBwYW5lICYmIHBhbmUucXVlcnlTZWxlY3RvcignW3JvbGU9XCJtZW51XCJdJyk7XG4gICAgfVxuXG4gICAgLy8gSWYgdGhlcmUncyBubyBsaXN0IGl0IG1lYW5zIGl0J3Mgbm90IGJlZW4gcmVuZGVyZWQuLi5cbiAgICBpZiAoIWlzLmVsZW1lbnQobGlzdCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBVcGRhdGUgdGhlIGxhYmVsXG4gICAgY29uc3QgbGFiZWwgPSB0aGlzLmVsZW1lbnRzLnNldHRpbmdzLmJ1dHRvbnNbc2V0dGluZ10ucXVlcnlTZWxlY3RvcihgLiR7dGhpcy5jb25maWcuY2xhc3NOYW1lcy5tZW51LnZhbHVlfWApO1xuICAgIGxhYmVsLmlubmVySFRNTCA9IGNvbnRyb2xzLmdldExhYmVsLmNhbGwodGhpcywgc2V0dGluZywgdmFsdWUpO1xuXG4gICAgLy8gRmluZCB0aGUgcmFkaW8gb3B0aW9uIGFuZCBjaGVjayBpdFxuICAgIGNvbnN0IHRhcmdldCA9IGxpc3QgJiYgbGlzdC5xdWVyeVNlbGVjdG9yKGBbdmFsdWU9XCIke3ZhbHVlfVwiXWApO1xuXG4gICAgaWYgKGlzLmVsZW1lbnQodGFyZ2V0KSkge1xuICAgICAgdGFyZ2V0LmNoZWNrZWQgPSB0cnVlO1xuICAgIH1cbiAgfSxcblxuICAvLyBUcmFuc2xhdGUgYSB2YWx1ZSBpbnRvIGEgbmljZSBsYWJlbFxuICBnZXRMYWJlbChzZXR0aW5nLCB2YWx1ZSkge1xuICAgIHN3aXRjaCAoc2V0dGluZykge1xuICAgICAgY2FzZSAnc3BlZWQnOlxuICAgICAgICByZXR1cm4gdmFsdWUgPT09IDEgPyBpMThuLmdldCgnbm9ybWFsJywgdGhpcy5jb25maWcpIDogYCR7dmFsdWV9JnRpbWVzO2A7XG5cbiAgICAgIGNhc2UgJ3F1YWxpdHknOlxuICAgICAgICBpZiAoaXMubnVtYmVyKHZhbHVlKSkge1xuICAgICAgICAgIGNvbnN0IGxhYmVsID0gaTE4bi5nZXQoYHF1YWxpdHlMYWJlbC4ke3ZhbHVlfWAsIHRoaXMuY29uZmlnKTtcblxuICAgICAgICAgIGlmICghbGFiZWwubGVuZ3RoKSB7XG4gICAgICAgICAgICByZXR1cm4gYCR7dmFsdWV9cGA7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmV0dXJuIGxhYmVsO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRvVGl0bGVDYXNlKHZhbHVlKTtcblxuICAgICAgY2FzZSAnY2FwdGlvbnMnOlxuICAgICAgICByZXR1cm4gY2FwdGlvbnMuZ2V0TGFiZWwuY2FsbCh0aGlzKTtcblxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9LFxuXG4gIC8vIFNldCB0aGUgcXVhbGl0eSBtZW51XG4gIHNldFF1YWxpdHlNZW51KG9wdGlvbnMpIHtcbiAgICAvLyBNZW51IHJlcXVpcmVkXG4gICAgaWYgKCFpcy5lbGVtZW50KHRoaXMuZWxlbWVudHMuc2V0dGluZ3MucGFuZWxzLnF1YWxpdHkpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgdHlwZSA9ICdxdWFsaXR5JztcbiAgICBjb25zdCBsaXN0ID0gdGhpcy5lbGVtZW50cy5zZXR0aW5ncy5wYW5lbHMucXVhbGl0eS5xdWVyeVNlbGVjdG9yKCdbcm9sZT1cIm1lbnVcIl0nKTtcblxuICAgIC8vIFNldCBvcHRpb25zIGlmIHBhc3NlZCBhbmQgZmlsdGVyIGJhc2VkIG9uIHVuaXF1ZW5lc3MgYW5kIGNvbmZpZ1xuICAgIGlmIChpcy5hcnJheShvcHRpb25zKSkge1xuICAgICAgdGhpcy5vcHRpb25zLnF1YWxpdHkgPSBkZWR1cGUob3B0aW9ucykuZmlsdGVyKChxdWFsaXR5KSA9PiB0aGlzLmNvbmZpZy5xdWFsaXR5Lm9wdGlvbnMuaW5jbHVkZXMocXVhbGl0eSkpO1xuICAgIH1cblxuICAgIC8vIFRvZ2dsZSB0aGUgcGFuZSBhbmQgdGFiXG4gICAgY29uc3QgdG9nZ2xlID0gIWlzLmVtcHR5KHRoaXMub3B0aW9ucy5xdWFsaXR5KSAmJiB0aGlzLm9wdGlvbnMucXVhbGl0eS5sZW5ndGggPiAxO1xuICAgIGNvbnRyb2xzLnRvZ2dsZU1lbnVCdXR0b24uY2FsbCh0aGlzLCB0eXBlLCB0b2dnbGUpO1xuXG4gICAgLy8gRW1wdHkgdGhlIG1lbnVcbiAgICBlbXB0eUVsZW1lbnQobGlzdCk7XG5cbiAgICAvLyBDaGVjayBpZiB3ZSBuZWVkIHRvIHRvZ2dsZSB0aGUgcGFyZW50XG4gICAgY29udHJvbHMuY2hlY2tNZW51LmNhbGwodGhpcyk7XG5cbiAgICAvLyBJZiB3ZSdyZSBoaWRpbmcsIG5vdGhpbmcgbW9yZSB0byBkb1xuICAgIGlmICghdG9nZ2xlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gR2V0IHRoZSBiYWRnZSBIVE1MIGZvciBIRCwgNEsgZXRjXG4gICAgY29uc3QgZ2V0QmFkZ2UgPSAocXVhbGl0eSkgPT4ge1xuICAgICAgY29uc3QgbGFiZWwgPSBpMThuLmdldChgcXVhbGl0eUJhZGdlLiR7cXVhbGl0eX1gLCB0aGlzLmNvbmZpZyk7XG5cbiAgICAgIGlmICghbGFiZWwubGVuZ3RoKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gY29udHJvbHMuY3JlYXRlQmFkZ2UuY2FsbCh0aGlzLCBsYWJlbCk7XG4gICAgfTtcblxuICAgIC8vIFNvcnQgb3B0aW9ucyBieSB0aGUgY29uZmlnIGFuZCB0aGVuIHJlbmRlciBvcHRpb25zXG4gICAgdGhpcy5vcHRpb25zLnF1YWxpdHlcbiAgICAgIC5zb3J0KChhLCBiKSA9PiB7XG4gICAgICAgIGNvbnN0IHNvcnRpbmcgPSB0aGlzLmNvbmZpZy5xdWFsaXR5Lm9wdGlvbnM7XG4gICAgICAgIHJldHVybiBzb3J0aW5nLmluZGV4T2YoYSkgPiBzb3J0aW5nLmluZGV4T2YoYikgPyAxIDogLTE7XG4gICAgICB9KVxuICAgICAgLmZvckVhY2goKHF1YWxpdHkpID0+IHtcbiAgICAgICAgY29udHJvbHMuY3JlYXRlTWVudUl0ZW0uY2FsbCh0aGlzLCB7XG4gICAgICAgICAgdmFsdWU6IHF1YWxpdHksXG4gICAgICAgICAgbGlzdCxcbiAgICAgICAgICB0eXBlLFxuICAgICAgICAgIHRpdGxlOiBjb250cm9scy5nZXRMYWJlbC5jYWxsKHRoaXMsICdxdWFsaXR5JywgcXVhbGl0eSksXG4gICAgICAgICAgYmFkZ2U6IGdldEJhZGdlKHF1YWxpdHkpLFxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgY29udHJvbHMudXBkYXRlU2V0dGluZy5jYWxsKHRoaXMsIHR5cGUsIGxpc3QpO1xuICB9LFxuXG4gIC8vIFNldCB0aGUgbG9vcGluZyBvcHRpb25zXG4gIC8qIHNldExvb3BNZW51KCkge1xuICAgICAgICAvLyBNZW51IHJlcXVpcmVkXG4gICAgICAgIGlmICghaXMuZWxlbWVudCh0aGlzLmVsZW1lbnRzLnNldHRpbmdzLnBhbmVscy5sb29wKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgb3B0aW9ucyA9IFsnc3RhcnQnLCAnZW5kJywgJ2FsbCcsICdyZXNldCddO1xuICAgICAgICBjb25zdCBsaXN0ID0gdGhpcy5lbGVtZW50cy5zZXR0aW5ncy5wYW5lbHMubG9vcC5xdWVyeVNlbGVjdG9yKCdbcm9sZT1cIm1lbnVcIl0nKTtcblxuICAgICAgICAvLyBTaG93IHRoZSBwYW5lIGFuZCB0YWJcbiAgICAgICAgdG9nZ2xlSGlkZGVuKHRoaXMuZWxlbWVudHMuc2V0dGluZ3MuYnV0dG9ucy5sb29wLCBmYWxzZSk7XG4gICAgICAgIHRvZ2dsZUhpZGRlbih0aGlzLmVsZW1lbnRzLnNldHRpbmdzLnBhbmVscy5sb29wLCBmYWxzZSk7XG5cbiAgICAgICAgLy8gVG9nZ2xlIHRoZSBwYW5lIGFuZCB0YWJcbiAgICAgICAgY29uc3QgdG9nZ2xlID0gIWlzLmVtcHR5KHRoaXMubG9vcC5vcHRpb25zKTtcbiAgICAgICAgY29udHJvbHMudG9nZ2xlTWVudUJ1dHRvbi5jYWxsKHRoaXMsICdsb29wJywgdG9nZ2xlKTtcblxuICAgICAgICAvLyBFbXB0eSB0aGUgbWVudVxuICAgICAgICBlbXB0eUVsZW1lbnQobGlzdCk7XG5cbiAgICAgICAgb3B0aW9ucy5mb3JFYWNoKG9wdGlvbiA9PiB7XG4gICAgICAgICAgICBjb25zdCBpdGVtID0gY3JlYXRlRWxlbWVudCgnbGknKTtcblxuICAgICAgICAgICAgY29uc3QgYnV0dG9uID0gY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICAnYnV0dG9uJyxcbiAgICAgICAgICAgICAgICBleHRlbmQoZ2V0QXR0cmlidXRlc0Zyb21TZWxlY3Rvcih0aGlzLmNvbmZpZy5zZWxlY3RvcnMuYnV0dG9ucy5sb29wKSwge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnYnV0dG9uJyxcbiAgICAgICAgICAgICAgICAgICAgY2xhc3M6IHRoaXMuY29uZmlnLmNsYXNzTmFtZXMuY29udHJvbCxcbiAgICAgICAgICAgICAgICAgICAgJ2RhdGEtcGx5ci1sb29wLWFjdGlvbic6IG9wdGlvbixcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICBpMThuLmdldChvcHRpb24sIHRoaXMuY29uZmlnKVxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgaWYgKFsnc3RhcnQnLCAnZW5kJ10uaW5jbHVkZXMob3B0aW9uKSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGJhZGdlID0gY29udHJvbHMuY3JlYXRlQmFkZ2UuY2FsbCh0aGlzLCAnMDA6MDAnKTtcbiAgICAgICAgICAgICAgICBidXR0b24uYXBwZW5kQ2hpbGQoYmFkZ2UpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpdGVtLmFwcGVuZENoaWxkKGJ1dHRvbik7XG4gICAgICAgICAgICBsaXN0LmFwcGVuZENoaWxkKGl0ZW0pO1xuICAgICAgICB9KTtcbiAgICB9LCAqL1xuXG4gIC8vIEdldCBjdXJyZW50IHNlbGVjdGVkIGNhcHRpb24gbGFuZ3VhZ2VcbiAgLy8gVE9ETzogcmV3b3JrIHRoaXMgdG8gdXNlciB0aGUgZ2V0dGVyIGluIHRoZSBBUEk/XG5cbiAgLy8gU2V0IGEgbGlzdCBvZiBhdmFpbGFibGUgY2FwdGlvbnMgbGFuZ3VhZ2VzXG4gIHNldENhcHRpb25zTWVudSgpIHtcbiAgICAvLyBNZW51IHJlcXVpcmVkXG4gICAgaWYgKCFpcy5lbGVtZW50KHRoaXMuZWxlbWVudHMuc2V0dGluZ3MucGFuZWxzLmNhcHRpb25zKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIFRPRE86IENhcHRpb25zIG9yIGxhbmd1YWdlPyBDdXJyZW50bHkgaXQncyBtaXhlZFxuICAgIGNvbnN0IHR5cGUgPSAnY2FwdGlvbnMnO1xuICAgIGNvbnN0IGxpc3QgPSB0aGlzLmVsZW1lbnRzLnNldHRpbmdzLnBhbmVscy5jYXB0aW9ucy5xdWVyeVNlbGVjdG9yKCdbcm9sZT1cIm1lbnVcIl0nKTtcbiAgICBjb25zdCB0cmFja3MgPSBjYXB0aW9ucy5nZXRUcmFja3MuY2FsbCh0aGlzKTtcbiAgICBjb25zdCB0b2dnbGUgPSBCb29sZWFuKHRyYWNrcy5sZW5ndGgpO1xuXG4gICAgLy8gVG9nZ2xlIHRoZSBwYW5lIGFuZCB0YWJcbiAgICBjb250cm9scy50b2dnbGVNZW51QnV0dG9uLmNhbGwodGhpcywgdHlwZSwgdG9nZ2xlKTtcblxuICAgIC8vIEVtcHR5IHRoZSBtZW51XG4gICAgZW1wdHlFbGVtZW50KGxpc3QpO1xuXG4gICAgLy8gQ2hlY2sgaWYgd2UgbmVlZCB0byB0b2dnbGUgdGhlIHBhcmVudFxuICAgIGNvbnRyb2xzLmNoZWNrTWVudS5jYWxsKHRoaXMpO1xuXG4gICAgLy8gSWYgdGhlcmUncyBubyBjYXB0aW9ucywgYmFpbFxuICAgIGlmICghdG9nZ2xlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gR2VuZXJhdGUgb3B0aW9ucyBkYXRhXG4gICAgY29uc3Qgb3B0aW9ucyA9IHRyYWNrcy5tYXAoKHRyYWNrLCB2YWx1ZSkgPT4gKHtcbiAgICAgIHZhbHVlLFxuICAgICAgY2hlY2tlZDogdGhpcy5jYXB0aW9ucy50b2dnbGVkICYmIHRoaXMuY3VycmVudFRyYWNrID09PSB2YWx1ZSxcbiAgICAgIHRpdGxlOiBjYXB0aW9ucy5nZXRMYWJlbC5jYWxsKHRoaXMsIHRyYWNrKSxcbiAgICAgIGJhZGdlOiB0cmFjay5sYW5ndWFnZSAmJiBjb250cm9scy5jcmVhdGVCYWRnZS5jYWxsKHRoaXMsIHRyYWNrLmxhbmd1YWdlLnRvVXBwZXJDYXNlKCkpLFxuICAgICAgbGlzdCxcbiAgICAgIHR5cGU6ICdsYW5ndWFnZScsXG4gICAgfSkpO1xuXG4gICAgLy8gQWRkIHRoZSBcIkRpc2FibGVkXCIgb3B0aW9uIHRvIHR1cm4gb2ZmIGNhcHRpb25zXG4gICAgb3B0aW9ucy51bnNoaWZ0KHtcbiAgICAgIHZhbHVlOiAtMSxcbiAgICAgIGNoZWNrZWQ6ICF0aGlzLmNhcHRpb25zLnRvZ2dsZWQsXG4gICAgICB0aXRsZTogaTE4bi5nZXQoJ2Rpc2FibGVkJywgdGhpcy5jb25maWcpLFxuICAgICAgbGlzdCxcbiAgICAgIHR5cGU6ICdsYW5ndWFnZScsXG4gICAgfSk7XG5cbiAgICAvLyBHZW5lcmF0ZSBvcHRpb25zXG4gICAgb3B0aW9ucy5mb3JFYWNoKGNvbnRyb2xzLmNyZWF0ZU1lbnVJdGVtLmJpbmQodGhpcykpO1xuXG4gICAgY29udHJvbHMudXBkYXRlU2V0dGluZy5jYWxsKHRoaXMsIHR5cGUsIGxpc3QpO1xuICB9LFxuXG4gIC8vIFNldCBhIGxpc3Qgb2YgYXZhaWxhYmxlIGNhcHRpb25zIGxhbmd1YWdlc1xuICBzZXRTcGVlZE1lbnUoKSB7XG4gICAgLy8gTWVudSByZXF1aXJlZFxuICAgIGlmICghaXMuZWxlbWVudCh0aGlzLmVsZW1lbnRzLnNldHRpbmdzLnBhbmVscy5zcGVlZCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCB0eXBlID0gJ3NwZWVkJztcbiAgICBjb25zdCBsaXN0ID0gdGhpcy5lbGVtZW50cy5zZXR0aW5ncy5wYW5lbHMuc3BlZWQucXVlcnlTZWxlY3RvcignW3JvbGU9XCJtZW51XCJdJyk7XG5cbiAgICAvLyBGaWx0ZXIgb3V0IGludmFsaWQgc3BlZWRzXG4gICAgdGhpcy5vcHRpb25zLnNwZWVkID0gdGhpcy5vcHRpb25zLnNwZWVkLmZpbHRlcigobykgPT4gbyA+PSB0aGlzLm1pbmltdW1TcGVlZCAmJiBvIDw9IHRoaXMubWF4aW11bVNwZWVkKTtcblxuICAgIC8vIFRvZ2dsZSB0aGUgcGFuZSBhbmQgdGFiXG4gICAgY29uc3QgdG9nZ2xlID0gIWlzLmVtcHR5KHRoaXMub3B0aW9ucy5zcGVlZCkgJiYgdGhpcy5vcHRpb25zLnNwZWVkLmxlbmd0aCA+IDE7XG4gICAgY29udHJvbHMudG9nZ2xlTWVudUJ1dHRvbi5jYWxsKHRoaXMsIHR5cGUsIHRvZ2dsZSk7XG5cbiAgICAvLyBFbXB0eSB0aGUgbWVudVxuICAgIGVtcHR5RWxlbWVudChsaXN0KTtcblxuICAgIC8vIENoZWNrIGlmIHdlIG5lZWQgdG8gdG9nZ2xlIHRoZSBwYXJlbnRcbiAgICBjb250cm9scy5jaGVja01lbnUuY2FsbCh0aGlzKTtcblxuICAgIC8vIElmIHdlJ3JlIGhpZGluZywgbm90aGluZyBtb3JlIHRvIGRvXG4gICAgaWYgKCF0b2dnbGUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBDcmVhdGUgaXRlbXNcbiAgICB0aGlzLm9wdGlvbnMuc3BlZWQuZm9yRWFjaCgoc3BlZWQpID0+IHtcbiAgICAgIGNvbnRyb2xzLmNyZWF0ZU1lbnVJdGVtLmNhbGwodGhpcywge1xuICAgICAgICB2YWx1ZTogc3BlZWQsXG4gICAgICAgIGxpc3QsXG4gICAgICAgIHR5cGUsXG4gICAgICAgIHRpdGxlOiBjb250cm9scy5nZXRMYWJlbC5jYWxsKHRoaXMsICdzcGVlZCcsIHNwZWVkKSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgY29udHJvbHMudXBkYXRlU2V0dGluZy5jYWxsKHRoaXMsIHR5cGUsIGxpc3QpO1xuICB9LFxuXG4gIC8vIENoZWNrIGlmIHdlIG5lZWQgdG8gaGlkZS9zaG93IHRoZSBzZXR0aW5ncyBtZW51XG4gIGNoZWNrTWVudSgpIHtcbiAgICBjb25zdCB7IGJ1dHRvbnMgfSA9IHRoaXMuZWxlbWVudHMuc2V0dGluZ3M7XG4gICAgY29uc3QgdmlzaWJsZSA9ICFpcy5lbXB0eShidXR0b25zKSAmJiBPYmplY3QudmFsdWVzKGJ1dHRvbnMpLnNvbWUoKGJ1dHRvbikgPT4gIWJ1dHRvbi5oaWRkZW4pO1xuXG4gICAgdG9nZ2xlSGlkZGVuKHRoaXMuZWxlbWVudHMuc2V0dGluZ3MubWVudSwgIXZpc2libGUpO1xuICB9LFxuXG4gIC8vIEZvY3VzIHRoZSBmaXJzdCBtZW51IGl0ZW0gaW4gYSBnaXZlbiAob3IgdmlzaWJsZSkgbWVudVxuICBmb2N1c0ZpcnN0TWVudUl0ZW0ocGFuZSwgdGFiRm9jdXMgPSBmYWxzZSkge1xuICAgIGlmICh0aGlzLmVsZW1lbnRzLnNldHRpbmdzLnBvcHVwLmhpZGRlbikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGxldCB0YXJnZXQgPSBwYW5lO1xuXG4gICAgaWYgKCFpcy5lbGVtZW50KHRhcmdldCkpIHtcbiAgICAgIHRhcmdldCA9IE9iamVjdC52YWx1ZXModGhpcy5lbGVtZW50cy5zZXR0aW5ncy5wYW5lbHMpLmZpbmQoKHApID0+ICFwLmhpZGRlbik7XG4gICAgfVxuXG4gICAgY29uc3QgZmlyc3RJdGVtID0gdGFyZ2V0LnF1ZXJ5U2VsZWN0b3IoJ1tyb2xlXj1cIm1lbnVpdGVtXCJdJyk7XG5cbiAgICBzZXRGb2N1cy5jYWxsKHRoaXMsIGZpcnN0SXRlbSwgdGFiRm9jdXMpO1xuICB9LFxuXG4gIC8vIFNob3cvaGlkZSBtZW51XG4gIHRvZ2dsZU1lbnUoaW5wdXQpIHtcbiAgICBjb25zdCB7IHBvcHVwIH0gPSB0aGlzLmVsZW1lbnRzLnNldHRpbmdzO1xuICAgIGNvbnN0IGJ1dHRvbiA9IHRoaXMuZWxlbWVudHMuYnV0dG9ucy5zZXR0aW5ncztcblxuICAgIC8vIE1lbnUgYW5kIGJ1dHRvbiBhcmUgcmVxdWlyZWRcbiAgICBpZiAoIWlzLmVsZW1lbnQocG9wdXApIHx8ICFpcy5lbGVtZW50KGJ1dHRvbikpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBUcnVlIHRvZ2dsZSBieSBkZWZhdWx0XG4gICAgY29uc3QgeyBoaWRkZW4gfSA9IHBvcHVwO1xuICAgIGxldCBzaG93ID0gaGlkZGVuO1xuXG4gICAgaWYgKGlzLmJvb2xlYW4oaW5wdXQpKSB7XG4gICAgICBzaG93ID0gaW5wdXQ7XG4gICAgfSBlbHNlIGlmIChpcy5rZXlib2FyZEV2ZW50KGlucHV0KSAmJiBpbnB1dC5rZXkgPT09ICdFc2NhcGUnKSB7XG4gICAgICBzaG93ID0gZmFsc2U7XG4gICAgfSBlbHNlIGlmIChpcy5ldmVudChpbnB1dCkpIHtcbiAgICAgIC8vIElmIFBseXIgaXMgaW4gYSBzaGFkb3dET00sIHRoZSBldmVudCB0YXJnZXQgaXMgc2V0IHRvIHRoZSBjb21wb25lbnQsIGluc3RlYWQgb2YgdGhlXG4gICAgICAvLyBFbGVtZW50IGluIHRoZSBzaGFkb3dET00uIFRoZSBwYXRoLCBpZiBhdmFpbGFibGUsIGlzIGNvbXBsZXRlLlxuICAgICAgY29uc3QgdGFyZ2V0ID0gaXMuZnVuY3Rpb24oaW5wdXQuY29tcG9zZWRQYXRoKSA/IGlucHV0LmNvbXBvc2VkUGF0aCgpWzBdIDogaW5wdXQudGFyZ2V0O1xuICAgICAgY29uc3QgaXNNZW51SXRlbSA9IHBvcHVwLmNvbnRhaW5zKHRhcmdldCk7XG5cbiAgICAgIC8vIElmIHRoZSBjbGljayB3YXMgaW5zaWRlIHRoZSBtZW51IG9yIGlmIHRoZSBjbGlja1xuICAgICAgLy8gd2Fzbid0IHRoZSBidXR0b24gb3IgbWVudSBpdGVtIGFuZCB3ZSdyZSB0cnlpbmcgdG9cbiAgICAgIC8vIHNob3cgdGhlIG1lbnUgKGEgZG9jIGNsaWNrIHNob3VsZG4ndCBzaG93IHRoZSBtZW51KVxuICAgICAgaWYgKGlzTWVudUl0ZW0gfHwgKCFpc01lbnVJdGVtICYmIGlucHV0LnRhcmdldCAhPT0gYnV0dG9uICYmIHNob3cpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBTZXQgYnV0dG9uIGF0dHJpYnV0ZXNcbiAgICBidXR0b24uc2V0QXR0cmlidXRlKCdhcmlhLWV4cGFuZGVkJywgc2hvdyk7XG5cbiAgICAvLyBTaG93IHRoZSBhY3R1YWwgcG9wdXBcbiAgICB0b2dnbGVIaWRkZW4ocG9wdXAsICFzaG93KTtcblxuICAgIC8vIEFkZCBjbGFzcyBob29rXG4gICAgdG9nZ2xlQ2xhc3ModGhpcy5lbGVtZW50cy5jb250YWluZXIsIHRoaXMuY29uZmlnLmNsYXNzTmFtZXMubWVudS5vcGVuLCBzaG93KTtcblxuICAgIC8vIEZvY3VzIHRoZSBmaXJzdCBpdGVtIGlmIGtleSBpbnRlcmFjdGlvblxuICAgIGlmIChzaG93ICYmIGlzLmtleWJvYXJkRXZlbnQoaW5wdXQpKSB7XG4gICAgICBjb250cm9scy5mb2N1c0ZpcnN0TWVudUl0ZW0uY2FsbCh0aGlzLCBudWxsLCB0cnVlKTtcbiAgICB9IGVsc2UgaWYgKCFzaG93ICYmICFoaWRkZW4pIHtcbiAgICAgIC8vIElmIGNsb3NpbmcsIHJlLWZvY3VzIHRoZSBidXR0b25cbiAgICAgIHNldEZvY3VzLmNhbGwodGhpcywgYnV0dG9uLCBpcy5rZXlib2FyZEV2ZW50KGlucHV0KSk7XG4gICAgfVxuICB9LFxuXG4gIC8vIEdldCB0aGUgbmF0dXJhbCBzaXplIG9mIGEgbWVudSBwYW5lbFxuICBnZXRNZW51U2l6ZSh0YWIpIHtcbiAgICBjb25zdCBjbG9uZSA9IHRhYi5jbG9uZU5vZGUodHJ1ZSk7XG4gICAgY2xvbmUuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnO1xuICAgIGNsb25lLnN0eWxlLm9wYWNpdHkgPSAwO1xuICAgIGNsb25lLnJlbW92ZUF0dHJpYnV0ZSgnaGlkZGVuJyk7XG5cbiAgICAvLyBBcHBlbmQgdG8gcGFyZW50IHNvIHdlIGdldCB0aGUgXCJyZWFsXCIgc2l6ZVxuICAgIHRhYi5wYXJlbnROb2RlLmFwcGVuZENoaWxkKGNsb25lKTtcblxuICAgIC8vIEdldCB0aGUgc2l6ZXMgYmVmb3JlIHdlIHJlbW92ZVxuICAgIGNvbnN0IHdpZHRoID0gY2xvbmUuc2Nyb2xsV2lkdGg7XG4gICAgY29uc3QgaGVpZ2h0ID0gY2xvbmUuc2Nyb2xsSGVpZ2h0O1xuXG4gICAgLy8gUmVtb3ZlIGZyb20gdGhlIERPTVxuICAgIHJlbW92ZUVsZW1lbnQoY2xvbmUpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHdpZHRoLFxuICAgICAgaGVpZ2h0LFxuICAgIH07XG4gIH0sXG5cbiAgLy8gU2hvdyBhIHBhbmVsIGluIHRoZSBtZW51XG4gIHNob3dNZW51UGFuZWwodHlwZSA9ICcnLCB0YWJGb2N1cyA9IGZhbHNlKSB7XG4gICAgY29uc3QgdGFyZ2V0ID0gdGhpcy5lbGVtZW50cy5jb250YWluZXIucXVlcnlTZWxlY3RvcihgI3BseXItc2V0dGluZ3MtJHt0aGlzLmlkfS0ke3R5cGV9YCk7XG5cbiAgICAvLyBOb3RoaW5nIHRvIHNob3csIGJhaWxcbiAgICBpZiAoIWlzLmVsZW1lbnQodGFyZ2V0KSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIEhpZGUgYWxsIG90aGVyIHBhbmVsc1xuICAgIGNvbnN0IGNvbnRhaW5lciA9IHRhcmdldC5wYXJlbnROb2RlO1xuICAgIGNvbnN0IGN1cnJlbnQgPSBBcnJheS5mcm9tKGNvbnRhaW5lci5jaGlsZHJlbikuZmluZCgobm9kZSkgPT4gIW5vZGUuaGlkZGVuKTtcblxuICAgIC8vIElmIHdlIGNhbiBkbyBmYW5jeSBhbmltYXRpb25zLCB3ZSdsbCBhbmltYXRlIHRoZSBoZWlnaHQvd2lkdGhcbiAgICBpZiAoc3VwcG9ydC50cmFuc2l0aW9ucyAmJiAhc3VwcG9ydC5yZWR1Y2VkTW90aW9uKSB7XG4gICAgICAvLyBTZXQgdGhlIGN1cnJlbnQgd2lkdGggYXMgYSBiYXNlXG4gICAgICBjb250YWluZXIuc3R5bGUud2lkdGggPSBgJHtjdXJyZW50LnNjcm9sbFdpZHRofXB4YDtcbiAgICAgIGNvbnRhaW5lci5zdHlsZS5oZWlnaHQgPSBgJHtjdXJyZW50LnNjcm9sbEhlaWdodH1weGA7XG5cbiAgICAgIC8vIEdldCBwb3RlbnRpYWwgc2l6ZXNcbiAgICAgIGNvbnN0IHNpemUgPSBjb250cm9scy5nZXRNZW51U2l6ZS5jYWxsKHRoaXMsIHRhcmdldCk7XG5cbiAgICAgIC8vIFJlc3RvcmUgYXV0byBoZWlnaHQvd2lkdGhcbiAgICAgIGNvbnN0IHJlc3RvcmUgPSAoZXZlbnQpID0+IHtcbiAgICAgICAgLy8gV2UncmUgb25seSBib3RoZXJlZCBhYm91dCBoZWlnaHQgYW5kIHdpZHRoIG9uIHRoZSBjb250YWluZXJcbiAgICAgICAgaWYgKGV2ZW50LnRhcmdldCAhPT0gY29udGFpbmVyIHx8ICFbJ3dpZHRoJywgJ2hlaWdodCddLmluY2x1ZGVzKGV2ZW50LnByb3BlcnR5TmFtZSkpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICAvLyBSZXZlcnQgYmFjayB0byBhdXRvXG4gICAgICAgIGNvbnRhaW5lci5zdHlsZS53aWR0aCA9ICcnO1xuICAgICAgICBjb250YWluZXIuc3R5bGUuaGVpZ2h0ID0gJyc7XG5cbiAgICAgICAgLy8gT25seSBsaXN0ZW4gb25jZVxuICAgICAgICBvZmYuY2FsbCh0aGlzLCBjb250YWluZXIsIHRyYW5zaXRpb25FbmRFdmVudCwgcmVzdG9yZSk7XG4gICAgICB9O1xuXG4gICAgICAvLyBMaXN0ZW4gZm9yIHRoZSB0cmFuc2l0aW9uIGZpbmlzaGluZyBhbmQgcmVzdG9yZSBhdXRvIGhlaWdodC93aWR0aFxuICAgICAgb24uY2FsbCh0aGlzLCBjb250YWluZXIsIHRyYW5zaXRpb25FbmRFdmVudCwgcmVzdG9yZSk7XG5cbiAgICAgIC8vIFNldCBkaW1lbnNpb25zIHRvIHRhcmdldFxuICAgICAgY29udGFpbmVyLnN0eWxlLndpZHRoID0gYCR7c2l6ZS53aWR0aH1weGA7XG4gICAgICBjb250YWluZXIuc3R5bGUuaGVpZ2h0ID0gYCR7c2l6ZS5oZWlnaHR9cHhgO1xuICAgIH1cblxuICAgIC8vIFNldCBhdHRyaWJ1dGVzIG9uIGN1cnJlbnQgdGFiXG4gICAgdG9nZ2xlSGlkZGVuKGN1cnJlbnQsIHRydWUpO1xuXG4gICAgLy8gU2V0IGF0dHJpYnV0ZXMgb24gdGFyZ2V0XG4gICAgdG9nZ2xlSGlkZGVuKHRhcmdldCwgZmFsc2UpO1xuXG4gICAgLy8gRm9jdXMgdGhlIGZpcnN0IGl0ZW1cbiAgICBjb250cm9scy5mb2N1c0ZpcnN0TWVudUl0ZW0uY2FsbCh0aGlzLCB0YXJnZXQsIHRhYkZvY3VzKTtcbiAgfSxcblxuICAvLyBTZXQgdGhlIGRvd25sb2FkIFVSTFxuICBzZXREb3dubG9hZFVybCgpIHtcbiAgICBjb25zdCBidXR0b24gPSB0aGlzLmVsZW1lbnRzLmJ1dHRvbnMuZG93bmxvYWQ7XG5cbiAgICAvLyBCYWlsIGlmIG5vIGJ1dHRvblxuICAgIGlmICghaXMuZWxlbWVudChidXR0b24pKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gU2V0IGF0dHJpYnV0ZVxuICAgIGJ1dHRvbi5zZXRBdHRyaWJ1dGUoJ2hyZWYnLCB0aGlzLmRvd25sb2FkKTtcbiAgfSxcblxuICAvLyBCdWlsZCB0aGUgZGVmYXVsdCBIVE1MXG4gIGNyZWF0ZShkYXRhKSB7XG4gICAgY29uc3Qge1xuICAgICAgYmluZE1lbnVJdGVtU2hvcnRjdXRzLFxuICAgICAgY3JlYXRlQnV0dG9uLFxuICAgICAgY3JlYXRlUHJvZ3Jlc3MsXG4gICAgICBjcmVhdGVSYW5nZSxcbiAgICAgIGNyZWF0ZVRpbWUsXG4gICAgICBzZXRRdWFsaXR5TWVudSxcbiAgICAgIHNldFNwZWVkTWVudSxcbiAgICAgIHNob3dNZW51UGFuZWwsXG4gICAgfSA9IGNvbnRyb2xzO1xuICAgIHRoaXMuZWxlbWVudHMuY29udHJvbHMgPSBudWxsO1xuXG4gICAgLy8gTGFyZ2VyIG92ZXJsYWlkIHBsYXkgYnV0dG9uXG4gICAgaWYgKGlzLmFycmF5KHRoaXMuY29uZmlnLmNvbnRyb2xzKSAmJiB0aGlzLmNvbmZpZy5jb250cm9scy5pbmNsdWRlcygncGxheS1sYXJnZScpKSB7XG4gICAgICB0aGlzLmVsZW1lbnRzLmNvbnRhaW5lci5hcHBlbmRDaGlsZChjcmVhdGVCdXR0b24uY2FsbCh0aGlzLCAncGxheS1sYXJnZScpKTtcbiAgICB9XG5cbiAgICAvLyBDcmVhdGUgdGhlIGNvbnRhaW5lclxuICAgIGNvbnN0IGNvbnRhaW5lciA9IGNyZWF0ZUVsZW1lbnQoJ2RpdicsIGdldEF0dHJpYnV0ZXNGcm9tU2VsZWN0b3IodGhpcy5jb25maWcuc2VsZWN0b3JzLmNvbnRyb2xzLndyYXBwZXIpKTtcbiAgICB0aGlzLmVsZW1lbnRzLmNvbnRyb2xzID0gY29udGFpbmVyO1xuXG4gICAgLy8gRGVmYXVsdCBpdGVtIGF0dHJpYnV0ZXNcbiAgICBjb25zdCBkZWZhdWx0QXR0cmlidXRlcyA9IHsgY2xhc3M6ICdwbHlyX19jb250cm9sc19faXRlbScgfTtcblxuICAgIC8vIExvb3AgdGhyb3VnaCBjb250cm9scyBpbiBvcmRlclxuICAgIGRlZHVwZShpcy5hcnJheSh0aGlzLmNvbmZpZy5jb250cm9scykgPyB0aGlzLmNvbmZpZy5jb250cm9scyA6IFtdKS5mb3JFYWNoKChjb250cm9sKSA9PiB7XG4gICAgICAvLyBSZXN0YXJ0IGJ1dHRvblxuICAgICAgaWYgKGNvbnRyb2wgPT09ICdyZXN0YXJ0Jykge1xuICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoY3JlYXRlQnV0dG9uLmNhbGwodGhpcywgJ3Jlc3RhcnQnLCBkZWZhdWx0QXR0cmlidXRlcykpO1xuICAgICAgfVxuXG4gICAgICAvLyBSZXdpbmQgYnV0dG9uXG4gICAgICBpZiAoY29udHJvbCA9PT0gJ3Jld2luZCcpIHtcbiAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGNyZWF0ZUJ1dHRvbi5jYWxsKHRoaXMsICdyZXdpbmQnLCBkZWZhdWx0QXR0cmlidXRlcykpO1xuICAgICAgfVxuXG4gICAgICAvLyBQbGF5L1BhdXNlIGJ1dHRvblxuICAgICAgaWYgKGNvbnRyb2wgPT09ICdwbGF5Jykge1xuICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoY3JlYXRlQnV0dG9uLmNhbGwodGhpcywgJ3BsYXknLCBkZWZhdWx0QXR0cmlidXRlcykpO1xuICAgICAgfVxuXG4gICAgICAvLyBGYXN0IGZvcndhcmQgYnV0dG9uXG4gICAgICBpZiAoY29udHJvbCA9PT0gJ2Zhc3QtZm9yd2FyZCcpIHtcbiAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGNyZWF0ZUJ1dHRvbi5jYWxsKHRoaXMsICdmYXN0LWZvcndhcmQnLCBkZWZhdWx0QXR0cmlidXRlcykpO1xuICAgICAgfVxuXG4gICAgICAvLyBQcm9ncmVzc1xuICAgICAgaWYgKGNvbnRyb2wgPT09ICdwcm9ncmVzcycpIHtcbiAgICAgICAgY29uc3QgcHJvZ3Jlc3NDb250YWluZXIgPSBjcmVhdGVFbGVtZW50KCdkaXYnLCB7XG4gICAgICAgICAgY2xhc3M6IGAke2RlZmF1bHRBdHRyaWJ1dGVzLmNsYXNzfSBwbHlyX19wcm9ncmVzc19fY29udGFpbmVyYCxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgcHJvZ3Jlc3MgPSBjcmVhdGVFbGVtZW50KCdkaXYnLCBnZXRBdHRyaWJ1dGVzRnJvbVNlbGVjdG9yKHRoaXMuY29uZmlnLnNlbGVjdG9ycy5wcm9ncmVzcykpO1xuXG4gICAgICAgIC8vIFNlZWsgcmFuZ2Ugc2xpZGVyXG4gICAgICAgIHByb2dyZXNzLmFwcGVuZENoaWxkKFxuICAgICAgICAgIGNyZWF0ZVJhbmdlLmNhbGwodGhpcywgJ3NlZWsnLCB7XG4gICAgICAgICAgICBpZDogYHBseXItc2Vlay0ke2RhdGEuaWR9YCxcbiAgICAgICAgICB9KSxcbiAgICAgICAgKTtcblxuICAgICAgICAvLyBCdWZmZXIgcHJvZ3Jlc3NcbiAgICAgICAgcHJvZ3Jlc3MuYXBwZW5kQ2hpbGQoY3JlYXRlUHJvZ3Jlc3MuY2FsbCh0aGlzLCAnYnVmZmVyJykpO1xuXG4gICAgICAgIC8vIFRPRE86IEFkZCBsb29wIGRpc3BsYXkgaW5kaWNhdG9yXG5cbiAgICAgICAgLy8gU2VlayB0b29sdGlwXG4gICAgICAgIGlmICh0aGlzLmNvbmZpZy50b29sdGlwcy5zZWVrKSB7XG4gICAgICAgICAgY29uc3QgdG9vbHRpcCA9IGNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAnc3BhbicsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGNsYXNzOiB0aGlzLmNvbmZpZy5jbGFzc05hbWVzLnRvb2x0aXAsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgJzAwOjAwJyxcbiAgICAgICAgICApO1xuXG4gICAgICAgICAgcHJvZ3Jlc3MuYXBwZW5kQ2hpbGQodG9vbHRpcCk7XG4gICAgICAgICAgdGhpcy5lbGVtZW50cy5kaXNwbGF5LnNlZWtUb29sdGlwID0gdG9vbHRpcDtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZWxlbWVudHMucHJvZ3Jlc3MgPSBwcm9ncmVzcztcbiAgICAgICAgcHJvZ3Jlc3NDb250YWluZXIuYXBwZW5kQ2hpbGQodGhpcy5lbGVtZW50cy5wcm9ncmVzcyk7XG4gICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChwcm9ncmVzc0NvbnRhaW5lcik7XG4gICAgICB9XG5cbiAgICAgIC8vIE1lZGlhIGN1cnJlbnQgdGltZSBkaXNwbGF5XG4gICAgICBpZiAoY29udHJvbCA9PT0gJ2N1cnJlbnQtdGltZScpIHtcbiAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGNyZWF0ZVRpbWUuY2FsbCh0aGlzLCAnY3VycmVudFRpbWUnLCBkZWZhdWx0QXR0cmlidXRlcykpO1xuICAgICAgfVxuXG4gICAgICAvLyBNZWRpYSBkdXJhdGlvbiBkaXNwbGF5XG4gICAgICBpZiAoY29udHJvbCA9PT0gJ2R1cmF0aW9uJykge1xuICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoY3JlYXRlVGltZS5jYWxsKHRoaXMsICdkdXJhdGlvbicsIGRlZmF1bHRBdHRyaWJ1dGVzKSk7XG4gICAgICB9XG5cbiAgICAgIC8vIFZvbHVtZSBjb250cm9sc1xuICAgICAgaWYgKGNvbnRyb2wgPT09ICdtdXRlJyB8fCBjb250cm9sID09PSAndm9sdW1lJykge1xuICAgICAgICBsZXQgeyB2b2x1bWUgfSA9IHRoaXMuZWxlbWVudHM7XG5cbiAgICAgICAgLy8gQ3JlYXRlIHRoZSB2b2x1bWUgY29udGFpbmVyIGlmIG5lZWRlZFxuICAgICAgICBpZiAoIWlzLmVsZW1lbnQodm9sdW1lKSB8fCAhY29udGFpbmVyLmNvbnRhaW5zKHZvbHVtZSkpIHtcbiAgICAgICAgICB2b2x1bWUgPSBjcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgJ2RpdicsXG4gICAgICAgICAgICBleHRlbmQoe30sIGRlZmF1bHRBdHRyaWJ1dGVzLCB7XG4gICAgICAgICAgICAgIGNsYXNzOiBgJHtkZWZhdWx0QXR0cmlidXRlcy5jbGFzc30gcGx5cl9fdm9sdW1lYC50cmltKCksXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICApO1xuXG4gICAgICAgICAgdGhpcy5lbGVtZW50cy52b2x1bWUgPSB2b2x1bWU7XG5cbiAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQodm9sdW1lKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFRvZ2dsZSBtdXRlIGJ1dHRvblxuICAgICAgICBpZiAoY29udHJvbCA9PT0gJ211dGUnKSB7XG4gICAgICAgICAgdm9sdW1lLmFwcGVuZENoaWxkKGNyZWF0ZUJ1dHRvbi5jYWxsKHRoaXMsICdtdXRlJykpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVm9sdW1lIHJhbmdlIGNvbnRyb2xcbiAgICAgICAgLy8gSWdub3JlZCBvbiBpT1MgYXMgaXQncyBoYW5kbGVkIGdsb2JhbGx5XG4gICAgICAgIC8vIGh0dHBzOi8vZGV2ZWxvcGVyLmFwcGxlLmNvbS9saWJyYXJ5L3NhZmFyaS9kb2N1bWVudGF0aW9uL0F1ZGlvVmlkZW8vQ29uY2VwdHVhbC9Vc2luZ19IVE1MNV9BdWRpb19WaWRlby9EZXZpY2UtU3BlY2lmaWNDb25zaWRlcmF0aW9ucy9EZXZpY2UtU3BlY2lmaWNDb25zaWRlcmF0aW9ucy5odG1sXG4gICAgICAgIGlmIChjb250cm9sID09PSAndm9sdW1lJyAmJiAhYnJvd3Nlci5pc0lvcykge1xuICAgICAgICAgIC8vIFNldCB0aGUgYXR0cmlidXRlc1xuICAgICAgICAgIGNvbnN0IGF0dHJpYnV0ZXMgPSB7XG4gICAgICAgICAgICBtYXg6IDEsXG4gICAgICAgICAgICBzdGVwOiAwLjA1LFxuICAgICAgICAgICAgdmFsdWU6IHRoaXMuY29uZmlnLnZvbHVtZSxcbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgLy8gQ3JlYXRlIHRoZSB2b2x1bWUgcmFuZ2Ugc2xpZGVyXG4gICAgICAgICAgdm9sdW1lLmFwcGVuZENoaWxkKFxuICAgICAgICAgICAgY3JlYXRlUmFuZ2UuY2FsbChcbiAgICAgICAgICAgICAgdGhpcyxcbiAgICAgICAgICAgICAgJ3ZvbHVtZScsXG4gICAgICAgICAgICAgIGV4dGVuZChhdHRyaWJ1dGVzLCB7XG4gICAgICAgICAgICAgICAgaWQ6IGBwbHlyLXZvbHVtZS0ke2RhdGEuaWR9YCxcbiAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICApLFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gVG9nZ2xlIGNhcHRpb25zIGJ1dHRvblxuICAgICAgaWYgKGNvbnRyb2wgPT09ICdjYXB0aW9ucycpIHtcbiAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGNyZWF0ZUJ1dHRvbi5jYWxsKHRoaXMsICdjYXB0aW9ucycsIGRlZmF1bHRBdHRyaWJ1dGVzKSk7XG4gICAgICB9XG5cbiAgICAgIC8vIFNldHRpbmdzIGJ1dHRvbiAvIG1lbnVcbiAgICAgIGlmIChjb250cm9sID09PSAnc2V0dGluZ3MnICYmICFpcy5lbXB0eSh0aGlzLmNvbmZpZy5zZXR0aW5ncykpIHtcbiAgICAgICAgY29uc3Qgd3JhcHBlciA9IGNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgJ2RpdicsXG4gICAgICAgICAgZXh0ZW5kKHt9LCBkZWZhdWx0QXR0cmlidXRlcywge1xuICAgICAgICAgICAgY2xhc3M6IGAke2RlZmF1bHRBdHRyaWJ1dGVzLmNsYXNzfSBwbHlyX19tZW51YC50cmltKCksXG4gICAgICAgICAgICBoaWRkZW46ICcnLFxuICAgICAgICAgIH0pLFxuICAgICAgICApO1xuXG4gICAgICAgIHdyYXBwZXIuYXBwZW5kQ2hpbGQoXG4gICAgICAgICAgY3JlYXRlQnV0dG9uLmNhbGwodGhpcywgJ3NldHRpbmdzJywge1xuICAgICAgICAgICAgJ2FyaWEtaGFzcG9wdXAnOiB0cnVlLFxuICAgICAgICAgICAgJ2FyaWEtY29udHJvbHMnOiBgcGx5ci1zZXR0aW5ncy0ke2RhdGEuaWR9YCxcbiAgICAgICAgICAgICdhcmlhLWV4cGFuZGVkJzogZmFsc2UsXG4gICAgICAgICAgfSksXG4gICAgICAgICk7XG5cbiAgICAgICAgY29uc3QgcG9wdXAgPSBjcmVhdGVFbGVtZW50KCdkaXYnLCB7XG4gICAgICAgICAgY2xhc3M6ICdwbHlyX19tZW51X19jb250YWluZXInLFxuICAgICAgICAgIGlkOiBgcGx5ci1zZXR0aW5ncy0ke2RhdGEuaWR9YCxcbiAgICAgICAgICBoaWRkZW46ICcnLFxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBpbm5lciA9IGNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuXG4gICAgICAgIGNvbnN0IGhvbWUgPSBjcmVhdGVFbGVtZW50KCdkaXYnLCB7XG4gICAgICAgICAgaWQ6IGBwbHlyLXNldHRpbmdzLSR7ZGF0YS5pZH0taG9tZWAsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIENyZWF0ZSB0aGUgbWVudVxuICAgICAgICBjb25zdCBtZW51ID0gY3JlYXRlRWxlbWVudCgnZGl2Jywge1xuICAgICAgICAgIHJvbGU6ICdtZW51JyxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaG9tZS5hcHBlbmRDaGlsZChtZW51KTtcbiAgICAgICAgaW5uZXIuYXBwZW5kQ2hpbGQoaG9tZSk7XG4gICAgICAgIHRoaXMuZWxlbWVudHMuc2V0dGluZ3MucGFuZWxzLmhvbWUgPSBob21lO1xuXG4gICAgICAgIC8vIEJ1aWxkIHRoZSBtZW51IGl0ZW1zXG4gICAgICAgIHRoaXMuY29uZmlnLnNldHRpbmdzLmZvckVhY2goKHR5cGUpID0+IHtcbiAgICAgICAgICAvLyBUT0RPOiBidW5kbGUgdGhpcyB3aXRoIHRoZSBjcmVhdGVNZW51SXRlbSBoZWxwZXIgYW5kIGJpbmRpbmdzXG4gICAgICAgICAgY29uc3QgbWVudUl0ZW0gPSBjcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgJ2J1dHRvbicsXG4gICAgICAgICAgICBleHRlbmQoZ2V0QXR0cmlidXRlc0Zyb21TZWxlY3Rvcih0aGlzLmNvbmZpZy5zZWxlY3RvcnMuYnV0dG9ucy5zZXR0aW5ncyksIHtcbiAgICAgICAgICAgICAgdHlwZTogJ2J1dHRvbicsXG4gICAgICAgICAgICAgIGNsYXNzOiBgJHt0aGlzLmNvbmZpZy5jbGFzc05hbWVzLmNvbnRyb2x9ICR7dGhpcy5jb25maWcuY2xhc3NOYW1lcy5jb250cm9sfS0tZm9yd2FyZGAsXG4gICAgICAgICAgICAgIHJvbGU6ICdtZW51aXRlbScsXG4gICAgICAgICAgICAgICdhcmlhLWhhc3BvcHVwJzogdHJ1ZSxcbiAgICAgICAgICAgICAgaGlkZGVuOiAnJyxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICk7XG5cbiAgICAgICAgICAvLyBCaW5kIG1lbnUgc2hvcnRjdXRzIGZvciBrZXlib2FyZCB1c2Vyc1xuICAgICAgICAgIGJpbmRNZW51SXRlbVNob3J0Y3V0cy5jYWxsKHRoaXMsIG1lbnVJdGVtLCB0eXBlKTtcblxuICAgICAgICAgIC8vIFNob3cgbWVudSBvbiBjbGlja1xuICAgICAgICAgIG9uLmNhbGwodGhpcywgbWVudUl0ZW0sICdjbGljaycsICgpID0+IHtcbiAgICAgICAgICAgIHNob3dNZW51UGFuZWwuY2FsbCh0aGlzLCB0eXBlLCBmYWxzZSk7XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICBjb25zdCBmbGV4ID0gY3JlYXRlRWxlbWVudCgnc3BhbicsIG51bGwsIGkxOG4uZ2V0KHR5cGUsIHRoaXMuY29uZmlnKSk7XG5cbiAgICAgICAgICBjb25zdCB2YWx1ZSA9IGNyZWF0ZUVsZW1lbnQoJ3NwYW4nLCB7XG4gICAgICAgICAgICBjbGFzczogdGhpcy5jb25maWcuY2xhc3NOYW1lcy5tZW51LnZhbHVlLFxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgLy8gU3BlZWQgY29udGFpbnMgSFRNTCBlbnRpdGllc1xuICAgICAgICAgIHZhbHVlLmlubmVySFRNTCA9IGRhdGFbdHlwZV07XG5cbiAgICAgICAgICBmbGV4LmFwcGVuZENoaWxkKHZhbHVlKTtcbiAgICAgICAgICBtZW51SXRlbS5hcHBlbmRDaGlsZChmbGV4KTtcbiAgICAgICAgICBtZW51LmFwcGVuZENoaWxkKG1lbnVJdGVtKTtcblxuICAgICAgICAgIC8vIEJ1aWxkIHRoZSBwYW5lc1xuICAgICAgICAgIGNvbnN0IHBhbmUgPSBjcmVhdGVFbGVtZW50KCdkaXYnLCB7XG4gICAgICAgICAgICBpZDogYHBseXItc2V0dGluZ3MtJHtkYXRhLmlkfS0ke3R5cGV9YCxcbiAgICAgICAgICAgIGhpZGRlbjogJycsXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICAvLyBCYWNrIGJ1dHRvblxuICAgICAgICAgIGNvbnN0IGJhY2tCdXR0b24gPSBjcmVhdGVFbGVtZW50KCdidXR0b24nLCB7XG4gICAgICAgICAgICB0eXBlOiAnYnV0dG9uJyxcbiAgICAgICAgICAgIGNsYXNzOiBgJHt0aGlzLmNvbmZpZy5jbGFzc05hbWVzLmNvbnRyb2x9ICR7dGhpcy5jb25maWcuY2xhc3NOYW1lcy5jb250cm9sfS0tYmFja2AsXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICAvLyBWaXNpYmxlIGxhYmVsXG4gICAgICAgICAgYmFja0J1dHRvbi5hcHBlbmRDaGlsZChcbiAgICAgICAgICAgIGNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgICdzcGFuJyxcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICdhcmlhLWhpZGRlbic6IHRydWUsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIGkxOG4uZ2V0KHR5cGUsIHRoaXMuY29uZmlnKSxcbiAgICAgICAgICAgICksXG4gICAgICAgICAgKTtcblxuICAgICAgICAgIC8vIFNjcmVlbiByZWFkZXIgbGFiZWxcbiAgICAgICAgICBiYWNrQnV0dG9uLmFwcGVuZENoaWxkKFxuICAgICAgICAgICAgY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgJ3NwYW4nLFxuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgY2xhc3M6IHRoaXMuY29uZmlnLmNsYXNzTmFtZXMuaGlkZGVuLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBpMThuLmdldCgnbWVudUJhY2snLCB0aGlzLmNvbmZpZyksXG4gICAgICAgICAgICApLFxuICAgICAgICAgICk7XG5cbiAgICAgICAgICAvLyBHbyBiYWNrIHZpYSBrZXlib2FyZFxuICAgICAgICAgIG9uLmNhbGwoXG4gICAgICAgICAgICB0aGlzLFxuICAgICAgICAgICAgcGFuZSxcbiAgICAgICAgICAgICdrZXlkb3duJyxcbiAgICAgICAgICAgIChldmVudCkgPT4ge1xuICAgICAgICAgICAgICBpZiAoZXZlbnQua2V5ICE9PSAnQXJyb3dMZWZ0JykgcmV0dXJuO1xuXG4gICAgICAgICAgICAgIC8vIFByZXZlbnQgc2Vla1xuICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcblxuICAgICAgICAgICAgICAvLyBTaG93IHRoZSByZXNwZWN0aXZlIG1lbnVcbiAgICAgICAgICAgICAgc2hvd01lbnVQYW5lbC5jYWxsKHRoaXMsICdob21lJywgdHJ1ZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZmFsc2UsXG4gICAgICAgICAgKTtcblxuICAgICAgICAgIC8vIEdvIGJhY2sgdmlhIGJ1dHRvbiBjbGlja1xuICAgICAgICAgIG9uLmNhbGwodGhpcywgYmFja0J1dHRvbiwgJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgICAgICAgc2hvd01lbnVQYW5lbC5jYWxsKHRoaXMsICdob21lJywgZmFsc2UpO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgLy8gQWRkIHRvIHBhbmVcbiAgICAgICAgICBwYW5lLmFwcGVuZENoaWxkKGJhY2tCdXR0b24pO1xuXG4gICAgICAgICAgLy8gTWVudVxuICAgICAgICAgIHBhbmUuYXBwZW5kQ2hpbGQoXG4gICAgICAgICAgICBjcmVhdGVFbGVtZW50KCdkaXYnLCB7XG4gICAgICAgICAgICAgIHJvbGU6ICdtZW51JyxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICk7XG5cbiAgICAgICAgICBpbm5lci5hcHBlbmRDaGlsZChwYW5lKTtcblxuICAgICAgICAgIHRoaXMuZWxlbWVudHMuc2V0dGluZ3MuYnV0dG9uc1t0eXBlXSA9IG1lbnVJdGVtO1xuICAgICAgICAgIHRoaXMuZWxlbWVudHMuc2V0dGluZ3MucGFuZWxzW3R5cGVdID0gcGFuZTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcG9wdXAuYXBwZW5kQ2hpbGQoaW5uZXIpO1xuICAgICAgICB3cmFwcGVyLmFwcGVuZENoaWxkKHBvcHVwKTtcbiAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHdyYXBwZXIpO1xuXG4gICAgICAgIHRoaXMuZWxlbWVudHMuc2V0dGluZ3MucG9wdXAgPSBwb3B1cDtcbiAgICAgICAgdGhpcy5lbGVtZW50cy5zZXR0aW5ncy5tZW51ID0gd3JhcHBlcjtcbiAgICAgIH1cblxuICAgICAgLy8gUGljdHVyZSBpbiBwaWN0dXJlIGJ1dHRvblxuICAgICAgaWYgKGNvbnRyb2wgPT09ICdwaXAnICYmIHN1cHBvcnQucGlwKSB7XG4gICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChjcmVhdGVCdXR0b24uY2FsbCh0aGlzLCAncGlwJywgZGVmYXVsdEF0dHJpYnV0ZXMpKTtcbiAgICAgIH1cblxuICAgICAgLy8gQWlycGxheSBidXR0b25cbiAgICAgIGlmIChjb250cm9sID09PSAnYWlycGxheScgJiYgc3VwcG9ydC5haXJwbGF5KSB7XG4gICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChjcmVhdGVCdXR0b24uY2FsbCh0aGlzLCAnYWlycGxheScsIGRlZmF1bHRBdHRyaWJ1dGVzKSk7XG4gICAgICB9XG5cbiAgICAgIC8vIERvd25sb2FkIGJ1dHRvblxuICAgICAgaWYgKGNvbnRyb2wgPT09ICdkb3dubG9hZCcpIHtcbiAgICAgICAgY29uc3QgYXR0cmlidXRlcyA9IGV4dGVuZCh7fSwgZGVmYXVsdEF0dHJpYnV0ZXMsIHtcbiAgICAgICAgICBlbGVtZW50OiAnYScsXG4gICAgICAgICAgaHJlZjogdGhpcy5kb3dubG9hZCxcbiAgICAgICAgICB0YXJnZXQ6ICdfYmxhbmsnLFxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBTZXQgZG93bmxvYWQgYXR0cmlidXRlIGZvciBIVE1MNSBvbmx5XG4gICAgICAgIGlmICh0aGlzLmlzSFRNTDUpIHtcbiAgICAgICAgICBhdHRyaWJ1dGVzLmRvd25sb2FkID0gJyc7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB7IGRvd25sb2FkIH0gPSB0aGlzLmNvbmZpZy51cmxzO1xuXG4gICAgICAgIGlmICghaXMudXJsKGRvd25sb2FkKSAmJiB0aGlzLmlzRW1iZWQpIHtcbiAgICAgICAgICBleHRlbmQoYXR0cmlidXRlcywge1xuICAgICAgICAgICAgaWNvbjogYGxvZ28tJHt0aGlzLnByb3ZpZGVyfWAsXG4gICAgICAgICAgICBsYWJlbDogdGhpcy5wcm92aWRlcixcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChjcmVhdGVCdXR0b24uY2FsbCh0aGlzLCAnZG93bmxvYWQnLCBhdHRyaWJ1dGVzKSk7XG4gICAgICB9XG5cbiAgICAgIC8vIFRvZ2dsZSBmdWxsc2NyZWVuIGJ1dHRvblxuICAgICAgaWYgKGNvbnRyb2wgPT09ICdmdWxsc2NyZWVuJykge1xuICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoY3JlYXRlQnV0dG9uLmNhbGwodGhpcywgJ2Z1bGxzY3JlZW4nLCBkZWZhdWx0QXR0cmlidXRlcykpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gU2V0IGF2YWlsYWJsZSBxdWFsaXR5IGxldmVsc1xuICAgIGlmICh0aGlzLmlzSFRNTDUpIHtcbiAgICAgIHNldFF1YWxpdHlNZW51LmNhbGwodGhpcywgaHRtbDUuZ2V0UXVhbGl0eU9wdGlvbnMuY2FsbCh0aGlzKSk7XG4gICAgfVxuXG4gICAgc2V0U3BlZWRNZW51LmNhbGwodGhpcyk7XG5cbiAgICByZXR1cm4gY29udGFpbmVyO1xuICB9LFxuXG4gIC8vIEluc2VydCBjb250cm9sc1xuICBpbmplY3QoKSB7XG4gICAgLy8gU3ByaXRlXG4gICAgaWYgKHRoaXMuY29uZmlnLmxvYWRTcHJpdGUpIHtcbiAgICAgIGNvbnN0IGljb24gPSBjb250cm9scy5nZXRJY29uVXJsLmNhbGwodGhpcyk7XG5cbiAgICAgIC8vIE9ubHkgbG9hZCBleHRlcm5hbCBzcHJpdGUgdXNpbmcgQUpBWFxuICAgICAgaWYgKGljb24uY29ycykge1xuICAgICAgICBsb2FkU3ByaXRlKGljb24udXJsLCAnc3ByaXRlLXBseXInKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBDcmVhdGUgYSB1bmlxdWUgSURcbiAgICB0aGlzLmlkID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwMDApO1xuXG4gICAgLy8gTnVsbCBieSBkZWZhdWx0XG4gICAgbGV0IGNvbnRhaW5lciA9IG51bGw7XG4gICAgdGhpcy5lbGVtZW50cy5jb250cm9scyA9IG51bGw7XG5cbiAgICAvLyBTZXQgdGVtcGxhdGUgcHJvcGVydGllc1xuICAgIGNvbnN0IHByb3BzID0ge1xuICAgICAgaWQ6IHRoaXMuaWQsXG4gICAgICBzZWVrdGltZTogdGhpcy5jb25maWcuc2Vla1RpbWUsXG4gICAgICB0aXRsZTogdGhpcy5jb25maWcudGl0bGUsXG4gICAgfTtcbiAgICBsZXQgdXBkYXRlID0gdHJ1ZTtcblxuICAgIC8vIElmIGZ1bmN0aW9uLCBydW4gaXQgYW5kIHVzZSBvdXRwdXRcbiAgICBpZiAoaXMuZnVuY3Rpb24odGhpcy5jb25maWcuY29udHJvbHMpKSB7XG4gICAgICB0aGlzLmNvbmZpZy5jb250cm9scyA9IHRoaXMuY29uZmlnLmNvbnRyb2xzLmNhbGwodGhpcywgcHJvcHMpO1xuICAgIH1cblxuICAgIC8vIENvbnZlcnQgZmFsc3kgY29udHJvbHMgdG8gZW1wdHkgYXJyYXkgKHByaW1hcmlseSBmb3IgZW1wdHkgc3RyaW5ncylcbiAgICBpZiAoIXRoaXMuY29uZmlnLmNvbnRyb2xzKSB7XG4gICAgICB0aGlzLmNvbmZpZy5jb250cm9scyA9IFtdO1xuICAgIH1cblxuICAgIGlmIChpcy5lbGVtZW50KHRoaXMuY29uZmlnLmNvbnRyb2xzKSB8fCBpcy5zdHJpbmcodGhpcy5jb25maWcuY29udHJvbHMpKSB7XG4gICAgICAvLyBIVE1MRWxlbWVudCBvciBOb24tZW1wdHkgc3RyaW5nIHBhc3NlZCBhcyB0aGUgb3B0aW9uXG4gICAgICBjb250YWluZXIgPSB0aGlzLmNvbmZpZy5jb250cm9scztcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gQ3JlYXRlIGNvbnRyb2xzXG4gICAgICBjb250YWluZXIgPSBjb250cm9scy5jcmVhdGUuY2FsbCh0aGlzLCB7XG4gICAgICAgIGlkOiB0aGlzLmlkLFxuICAgICAgICBzZWVrdGltZTogdGhpcy5jb25maWcuc2Vla1RpbWUsXG4gICAgICAgIHNwZWVkOiB0aGlzLnNwZWVkLFxuICAgICAgICBxdWFsaXR5OiB0aGlzLnF1YWxpdHksXG4gICAgICAgIGNhcHRpb25zOiBjYXB0aW9ucy5nZXRMYWJlbC5jYWxsKHRoaXMpLFxuICAgICAgICAvLyBUT0RPOiBMb29waW5nXG4gICAgICAgIC8vIGxvb3A6ICdOb25lJyxcbiAgICAgIH0pO1xuICAgICAgdXBkYXRlID0gZmFsc2U7XG4gICAgfVxuXG4gICAgLy8gUmVwbGFjZSBwcm9wcyB3aXRoIHRoZWlyIHZhbHVlXG4gICAgY29uc3QgcmVwbGFjZSA9IChpbnB1dCkgPT4ge1xuICAgICAgbGV0IHJlc3VsdCA9IGlucHV0O1xuXG4gICAgICBPYmplY3QuZW50cmllcyhwcm9wcykuZm9yRWFjaCgoW2tleSwgdmFsdWVdKSA9PiB7XG4gICAgICAgIHJlc3VsdCA9IHJlcGxhY2VBbGwocmVzdWx0LCBgeyR7a2V5fX1gLCB2YWx1ZSk7XG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9O1xuXG4gICAgLy8gVXBkYXRlIG1hcmt1cFxuICAgIGlmICh1cGRhdGUpIHtcbiAgICAgIGlmIChpcy5zdHJpbmcodGhpcy5jb25maWcuY29udHJvbHMpKSB7XG4gICAgICAgIGNvbnRhaW5lciA9IHJlcGxhY2UoY29udGFpbmVyKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBDb250cm9scyBjb250YWluZXJcbiAgICBsZXQgdGFyZ2V0O1xuXG4gICAgLy8gSW5qZWN0IHRvIGN1c3RvbSBsb2NhdGlvblxuICAgIGlmIChpcy5zdHJpbmcodGhpcy5jb25maWcuc2VsZWN0b3JzLmNvbnRyb2xzLmNvbnRhaW5lcikpIHtcbiAgICAgIHRhcmdldCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5jb25maWcuc2VsZWN0b3JzLmNvbnRyb2xzLmNvbnRhaW5lcik7XG4gICAgfVxuXG4gICAgLy8gSW5qZWN0IGludG8gdGhlIGNvbnRhaW5lciBieSBkZWZhdWx0XG4gICAgaWYgKCFpcy5lbGVtZW50KHRhcmdldCkpIHtcbiAgICAgIHRhcmdldCA9IHRoaXMuZWxlbWVudHMuY29udGFpbmVyO1xuICAgIH1cblxuICAgIC8vIEluamVjdCBjb250cm9scyBIVE1MIChuZWVkcyB0byBiZSBiZWZvcmUgY2FwdGlvbnMsIGhlbmNlIFwiYWZ0ZXJiZWdpblwiKVxuICAgIGNvbnN0IGluc2VydE1ldGhvZCA9IGlzLmVsZW1lbnQoY29udGFpbmVyKSA/ICdpbnNlcnRBZGphY2VudEVsZW1lbnQnIDogJ2luc2VydEFkamFjZW50SFRNTCc7XG4gICAgdGFyZ2V0W2luc2VydE1ldGhvZF0oJ2FmdGVyYmVnaW4nLCBjb250YWluZXIpO1xuXG4gICAgLy8gRmluZCB0aGUgZWxlbWVudHMgaWYgbmVlZCBiZVxuICAgIGlmICghaXMuZWxlbWVudCh0aGlzLmVsZW1lbnRzLmNvbnRyb2xzKSkge1xuICAgICAgY29udHJvbHMuZmluZEVsZW1lbnRzLmNhbGwodGhpcyk7XG4gICAgfVxuXG4gICAgLy8gQWRkIHByZXNzZWQgcHJvcGVydHkgdG8gYnV0dG9uc1xuICAgIGlmICghaXMuZW1wdHkodGhpcy5lbGVtZW50cy5idXR0b25zKSkge1xuICAgICAgY29uc3QgYWRkUHJvcGVydHkgPSAoYnV0dG9uKSA9PiB7XG4gICAgICAgIGNvbnN0IGNsYXNzTmFtZSA9IHRoaXMuY29uZmlnLmNsYXNzTmFtZXMuY29udHJvbFByZXNzZWQ7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShidXR0b24sICdwcmVzc2VkJywge1xuICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgICAgZ2V0KCkge1xuICAgICAgICAgICAgcmV0dXJuIGhhc0NsYXNzKGJ1dHRvbiwgY2xhc3NOYW1lKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHNldChwcmVzc2VkID0gZmFsc2UpIHtcbiAgICAgICAgICAgIHRvZ2dsZUNsYXNzKGJ1dHRvbiwgY2xhc3NOYW1lLCBwcmVzc2VkKTtcbiAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICAgIH07XG5cbiAgICAgIC8vIFRvZ2dsZSBjbGFzc25hbWUgd2hlbiBwcmVzc2VkIHByb3BlcnR5IGlzIHNldFxuICAgICAgT2JqZWN0LnZhbHVlcyh0aGlzLmVsZW1lbnRzLmJ1dHRvbnMpXG4gICAgICAgIC5maWx0ZXIoQm9vbGVhbilcbiAgICAgICAgLmZvckVhY2goKGJ1dHRvbikgPT4ge1xuICAgICAgICAgIGlmIChpcy5hcnJheShidXR0b24pIHx8IGlzLm5vZGVMaXN0KGJ1dHRvbikpIHtcbiAgICAgICAgICAgIEFycmF5LmZyb20oYnV0dG9uKS5maWx0ZXIoQm9vbGVhbikuZm9yRWFjaChhZGRQcm9wZXJ0eSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGFkZFByb3BlcnR5KGJ1dHRvbik7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBFZGdlIHNvbWV0aW1lcyBkb2Vzbid0IGZpbmlzaCB0aGUgcGFpbnQgc28gZm9yY2UgYSByZXBhaW50XG4gICAgaWYgKGJyb3dzZXIuaXNFZGdlKSB7XG4gICAgICByZXBhaW50KHRhcmdldCk7XG4gICAgfVxuXG4gICAgLy8gU2V0dXAgdG9vbHRpcHNcbiAgICBpZiAodGhpcy5jb25maWcudG9vbHRpcHMuY29udHJvbHMpIHtcbiAgICAgIGNvbnN0IHsgY2xhc3NOYW1lcywgc2VsZWN0b3JzIH0gPSB0aGlzLmNvbmZpZztcbiAgICAgIGNvbnN0IHNlbGVjdG9yID0gYCR7c2VsZWN0b3JzLmNvbnRyb2xzLndyYXBwZXJ9ICR7c2VsZWN0b3JzLmxhYmVsc30gLiR7Y2xhc3NOYW1lcy5oaWRkZW59YDtcbiAgICAgIGNvbnN0IGxhYmVscyA9IGdldEVsZW1lbnRzLmNhbGwodGhpcywgc2VsZWN0b3IpO1xuXG4gICAgICBBcnJheS5mcm9tKGxhYmVscykuZm9yRWFjaCgobGFiZWwpID0+IHtcbiAgICAgICAgdG9nZ2xlQ2xhc3MobGFiZWwsIHRoaXMuY29uZmlnLmNsYXNzTmFtZXMuaGlkZGVuLCBmYWxzZSk7XG4gICAgICAgIHRvZ2dsZUNsYXNzKGxhYmVsLCB0aGlzLmNvbmZpZy5jbGFzc05hbWVzLnRvb2x0aXAsIHRydWUpO1xuICAgICAgfSk7XG4gICAgfVxuICB9LFxuXG4gIC8vIFNldCBtZWRpYSBtZXRhZGF0YVxuICBzZXRNZWRpYU1ldGFkYXRhKCkge1xuICAgIHRyeSB7XG4gICAgICBpZiAoJ21lZGlhU2Vzc2lvbicgaW4gbmF2aWdhdG9yKSB7XG4gICAgICAgIG5hdmlnYXRvci5tZWRpYVNlc3Npb24ubWV0YWRhdGEgPSBuZXcgd2luZG93Lk1lZGlhTWV0YWRhdGEoe1xuICAgICAgICAgIHRpdGxlOiB0aGlzLmNvbmZpZy5tZWRpYU1ldGFkYXRhLnRpdGxlLFxuICAgICAgICAgIGFydGlzdDogdGhpcy5jb25maWcubWVkaWFNZXRhZGF0YS5hcnRpc3QsXG4gICAgICAgICAgYWxidW06IHRoaXMuY29uZmlnLm1lZGlhTWV0YWRhdGEuYWxidW0sXG4gICAgICAgICAgYXJ0d29yazogdGhpcy5jb25maWcubWVkaWFNZXRhZGF0YS5hcnR3b3JrLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChfKSB7XG4gICAgICAvLyBEbyBub3RoaW5nXG4gICAgfVxuICB9LFxuXG4gIC8vIEFkZCBtYXJrZXJzXG4gIHNldE1hcmtlcnMoKSB7XG4gICAgaWYgKCF0aGlzLmR1cmF0aW9uIHx8IHRoaXMuZWxlbWVudHMubWFya2VycykgcmV0dXJuO1xuXG4gICAgLy8gR2V0IHZhbGlkIHBvaW50c1xuICAgIGNvbnN0IHBvaW50cyA9IHRoaXMuY29uZmlnLm1hcmtlcnM/LnBvaW50cz8uZmlsdGVyKCh7IHRpbWUgfSkgPT4gdGltZSA+IDAgJiYgdGltZSA8IHRoaXMuZHVyYXRpb24pO1xuICAgIGlmICghcG9pbnRzPy5sZW5ndGgpIHJldHVybjtcblxuICAgIGNvbnN0IGNvbnRhaW5lckZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xuICAgIGNvbnN0IHBvaW50c0ZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xuICAgIGxldCB0aXBFbGVtZW50ID0gbnVsbDtcbiAgICBjb25zdCB0aXBWaXNpYmxlID0gYCR7dGhpcy5jb25maWcuY2xhc3NOYW1lcy50b29sdGlwfS0tdmlzaWJsZWA7XG4gICAgY29uc3QgdG9nZ2xlVGlwID0gKHNob3cpID0+IHRvZ2dsZUNsYXNzKHRpcEVsZW1lbnQsIHRpcFZpc2libGUsIHNob3cpO1xuXG4gICAgLy8gSW5qZWN0IG1hcmtlcnMgdG8gcHJvZ3Jlc3MgY29udGFpbmVyXG4gICAgcG9pbnRzLmZvckVhY2goKHBvaW50KSA9PiB7XG4gICAgICBjb25zdCBtYXJrZXJFbGVtZW50ID0gY3JlYXRlRWxlbWVudChcbiAgICAgICAgJ3NwYW4nLFxuICAgICAgICB7XG4gICAgICAgICAgY2xhc3M6IHRoaXMuY29uZmlnLmNsYXNzTmFtZXMubWFya2VyLFxuICAgICAgICB9LFxuICAgICAgICAnJyxcbiAgICAgICk7XG5cbiAgICAgIGNvbnN0IGxlZnQgPSBgJHsocG9pbnQudGltZSAvIHRoaXMuZHVyYXRpb24pICogMTAwfSVgO1xuXG4gICAgICBpZiAodGlwRWxlbWVudCkge1xuICAgICAgICAvLyBTaG93IG9uIGhvdmVyXG4gICAgICAgIG1hcmtlckVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VlbnRlcicsICgpID0+IHtcbiAgICAgICAgICBpZiAocG9pbnQubGFiZWwpIHJldHVybjtcbiAgICAgICAgICB0aXBFbGVtZW50LnN0eWxlLmxlZnQgPSBsZWZ0O1xuICAgICAgICAgIHRpcEVsZW1lbnQuaW5uZXJIVE1MID0gcG9pbnQubGFiZWw7XG4gICAgICAgICAgdG9nZ2xlVGlwKHRydWUpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBIaWRlIG9uIGxlYXZlXG4gICAgICAgIG1hcmtlckVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VsZWF2ZScsICgpID0+IHtcbiAgICAgICAgICB0b2dnbGVUaXAoZmFsc2UpO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgbWFya2VyRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgICAgdGhpcy5jdXJyZW50VGltZSA9IHBvaW50LnRpbWU7XG4gICAgICB9KTtcblxuICAgICAgbWFya2VyRWxlbWVudC5zdHlsZS5sZWZ0ID0gbGVmdDtcbiAgICAgIHBvaW50c0ZyYWdtZW50LmFwcGVuZENoaWxkKG1hcmtlckVsZW1lbnQpO1xuICAgIH0pO1xuXG4gICAgY29udGFpbmVyRnJhZ21lbnQuYXBwZW5kQ2hpbGQocG9pbnRzRnJhZ21lbnQpO1xuXG4gICAgLy8gSW5qZWN0IGEgdG9vbHRpcCBpZiBuZWVkZWRcbiAgICBpZiAoIXRoaXMuY29uZmlnLnRvb2x0aXBzLnNlZWspIHtcbiAgICAgIHRpcEVsZW1lbnQgPSBjcmVhdGVFbGVtZW50KFxuICAgICAgICAnc3BhbicsXG4gICAgICAgIHtcbiAgICAgICAgICBjbGFzczogdGhpcy5jb25maWcuY2xhc3NOYW1lcy50b29sdGlwLFxuICAgICAgICB9LFxuICAgICAgICAnJyxcbiAgICAgICk7XG5cbiAgICAgIGNvbnRhaW5lckZyYWdtZW50LmFwcGVuZENoaWxkKHRpcEVsZW1lbnQpO1xuICAgIH1cblxuICAgIHRoaXMuZWxlbWVudHMubWFya2VycyA9IHtcbiAgICAgIHBvaW50czogcG9pbnRzRnJhZ21lbnQsXG4gICAgICB0aXA6IHRpcEVsZW1lbnQsXG4gICAgfTtcblxuICAgIHRoaXMuZWxlbWVudHMucHJvZ3Jlc3MuYXBwZW5kQ2hpbGQoY29udGFpbmVyRnJhZ21lbnQpO1xuICB9LFxufTtcblxuZXhwb3J0IGRlZmF1bHQgY29udHJvbHM7XG4iLCIvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gVVJMIHV0aWxzXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5pbXBvcnQgaXMgZnJvbSAnLi9pcyc7XG5cbi8qKlxuICogUGFyc2UgYSBzdHJpbmcgdG8gYSBVUkwgb2JqZWN0XG4gKiBAcGFyYW0ge1N0cmluZ30gaW5wdXQgLSB0aGUgVVJMIHRvIGJlIHBhcnNlZFxuICogQHBhcmFtIHtCb29sZWFufSBzYWZlIC0gZmFpbHNhZmUgcGFyc2luZ1xuICovXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VVcmwoaW5wdXQsIHNhZmUgPSB0cnVlKSB7XG4gIGxldCB1cmwgPSBpbnB1dDtcblxuICBpZiAoc2FmZSkge1xuICAgIGNvbnN0IHBhcnNlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcbiAgICBwYXJzZXIuaHJlZiA9IHVybDtcbiAgICB1cmwgPSBwYXJzZXIuaHJlZjtcbiAgfVxuXG4gIHRyeSB7XG4gICAgcmV0dXJuIG5ldyBVUkwodXJsKTtcbiAgfSBjYXRjaCAoXykge1xuICAgIHJldHVybiBudWxsO1xuICB9XG59XG5cbi8vIENvbnZlcnQgb2JqZWN0IHRvIFVSTFNlYXJjaFBhcmFtc1xuZXhwb3J0IGZ1bmN0aW9uIGJ1aWxkVXJsUGFyYW1zKGlucHV0KSB7XG4gIGNvbnN0IHBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMoKTtcblxuICBpZiAoaXMub2JqZWN0KGlucHV0KSkge1xuICAgIE9iamVjdC5lbnRyaWVzKGlucHV0KS5mb3JFYWNoKChba2V5LCB2YWx1ZV0pID0+IHtcbiAgICAgIHBhcmFtcy5zZXQoa2V5LCB2YWx1ZSk7XG4gICAgfSk7XG4gIH1cblxuICByZXR1cm4gcGFyYW1zO1xufVxuIiwiLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFBseXIgQ2FwdGlvbnNcbi8vIFRPRE86IENyZWF0ZSBhcyBjbGFzc1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuaW1wb3J0IGNvbnRyb2xzIGZyb20gJy4vY29udHJvbHMnO1xuaW1wb3J0IHN1cHBvcnQgZnJvbSAnLi9zdXBwb3J0JztcbmltcG9ydCB7IGRlZHVwZSB9IGZyb20gJy4vdXRpbHMvYXJyYXlzJztcbmltcG9ydCBicm93c2VyIGZyb20gJy4vdXRpbHMvYnJvd3Nlcic7XG5pbXBvcnQge1xuICBjcmVhdGVFbGVtZW50LFxuICBlbXB0eUVsZW1lbnQsXG4gIGdldEF0dHJpYnV0ZXNGcm9tU2VsZWN0b3IsXG4gIGluc2VydEFmdGVyLFxuICByZW1vdmVFbGVtZW50LFxuICB0b2dnbGVDbGFzcyxcbn0gZnJvbSAnLi91dGlscy9lbGVtZW50cyc7XG5pbXBvcnQgeyBvbiwgdHJpZ2dlckV2ZW50IH0gZnJvbSAnLi91dGlscy9ldmVudHMnO1xuaW1wb3J0IGZldGNoIGZyb20gJy4vdXRpbHMvZmV0Y2gnO1xuaW1wb3J0IGkxOG4gZnJvbSAnLi91dGlscy9pMThuJztcbmltcG9ydCBpcyBmcm9tICcuL3V0aWxzL2lzJztcbmltcG9ydCB7IGdldEhUTUwgfSBmcm9tICcuL3V0aWxzL3N0cmluZ3MnO1xuaW1wb3J0IHsgcGFyc2VVcmwgfSBmcm9tICcuL3V0aWxzL3VybHMnO1xuXG5jb25zdCBjYXB0aW9ucyA9IHtcbiAgLy8gU2V0dXAgY2FwdGlvbnNcbiAgc2V0dXAoKSB7XG4gICAgLy8gUmVxdWlyZXMgVUkgc3VwcG9ydFxuICAgIGlmICghdGhpcy5zdXBwb3J0ZWQudWkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBPbmx5IFZpbWVvIGFuZCBIVE1MNSB2aWRlbyBzdXBwb3J0ZWQgYXQgdGhpcyBwb2ludFxuICAgIGlmICghdGhpcy5pc1ZpZGVvIHx8IHRoaXMuaXNZb3VUdWJlIHx8ICh0aGlzLmlzSFRNTDUgJiYgIXN1cHBvcnQudGV4dFRyYWNrcykpIHtcbiAgICAgIC8vIENsZWFyIG1lbnUgYW5kIGhpZGVcbiAgICAgIGlmIChcbiAgICAgICAgaXMuYXJyYXkodGhpcy5jb25maWcuY29udHJvbHMpICYmXG4gICAgICAgIHRoaXMuY29uZmlnLmNvbnRyb2xzLmluY2x1ZGVzKCdzZXR0aW5ncycpICYmXG4gICAgICAgIHRoaXMuY29uZmlnLnNldHRpbmdzLmluY2x1ZGVzKCdjYXB0aW9ucycpXG4gICAgICApIHtcbiAgICAgICAgY29udHJvbHMuc2V0Q2FwdGlvbnNNZW51LmNhbGwodGhpcyk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBJbmplY3QgdGhlIGNvbnRhaW5lclxuICAgIGlmICghaXMuZWxlbWVudCh0aGlzLmVsZW1lbnRzLmNhcHRpb25zKSkge1xuICAgICAgdGhpcy5lbGVtZW50cy5jYXB0aW9ucyA9IGNyZWF0ZUVsZW1lbnQoJ2RpdicsIGdldEF0dHJpYnV0ZXNGcm9tU2VsZWN0b3IodGhpcy5jb25maWcuc2VsZWN0b3JzLmNhcHRpb25zKSk7XG5cbiAgICAgIGluc2VydEFmdGVyKHRoaXMuZWxlbWVudHMuY2FwdGlvbnMsIHRoaXMuZWxlbWVudHMud3JhcHBlcik7XG4gICAgfVxuXG4gICAgLy8gRml4IElFIGNhcHRpb25zIGlmIENPUlMgaXMgdXNlZFxuICAgIC8vIEZldGNoIGNhcHRpb25zIGFuZCBpbmplY3QgYXMgYmxvYnMgaW5zdGVhZCAoZGF0YSBVUklzIG5vdCBzdXBwb3J0ZWQhKVxuICAgIGlmIChicm93c2VyLmlzSUUgJiYgd2luZG93LlVSTCkge1xuICAgICAgY29uc3QgZWxlbWVudHMgPSB0aGlzLm1lZGlhLnF1ZXJ5U2VsZWN0b3JBbGwoJ3RyYWNrJyk7XG5cbiAgICAgIEFycmF5LmZyb20oZWxlbWVudHMpLmZvckVhY2goKHRyYWNrKSA9PiB7XG4gICAgICAgIGNvbnN0IHNyYyA9IHRyYWNrLmdldEF0dHJpYnV0ZSgnc3JjJyk7XG4gICAgICAgIGNvbnN0IHVybCA9IHBhcnNlVXJsKHNyYyk7XG5cbiAgICAgICAgaWYgKFxuICAgICAgICAgIHVybCAhPT0gbnVsbCAmJlxuICAgICAgICAgIHVybC5ob3N0bmFtZSAhPT0gd2luZG93LmxvY2F0aW9uLmhyZWYuaG9zdG5hbWUgJiZcbiAgICAgICAgICBbJ2h0dHA6JywgJ2h0dHBzOiddLmluY2x1ZGVzKHVybC5wcm90b2NvbClcbiAgICAgICAgKSB7XG4gICAgICAgICAgZmV0Y2goc3JjLCAnYmxvYicpXG4gICAgICAgICAgICAudGhlbigoYmxvYikgPT4ge1xuICAgICAgICAgICAgICB0cmFjay5zZXRBdHRyaWJ1dGUoJ3NyYycsIHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuY2F0Y2goKCkgPT4ge1xuICAgICAgICAgICAgICByZW1vdmVFbGVtZW50KHRyYWNrKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBHZXQgYW5kIHNldCBpbml0aWFsIGRhdGFcbiAgICAvLyBUaGUgXCJwcmVmZXJyZWRcIiBvcHRpb25zIGFyZSBub3QgcmVhbGl6ZWQgdW5sZXNzIC8gdW50aWwgdGhlIHdhbnRlZCBsYW5ndWFnZSBoYXMgYSBtYXRjaFxuICAgIC8vICogbGFuZ3VhZ2VzOiBBcnJheSBvZiB1c2VyJ3MgYnJvd3NlciBsYW5ndWFnZXMuXG4gICAgLy8gKiBsYW5ndWFnZTogIFRoZSBsYW5ndWFnZSBwcmVmZXJyZWQgYnkgdXNlciBzZXR0aW5ncyBvciBjb25maWdcbiAgICAvLyAqIGFjdGl2ZTogICAgVGhlIHN0YXRlIHByZWZlcnJlZCBieSB1c2VyIHNldHRpbmdzIG9yIGNvbmZpZ1xuICAgIC8vICogdG9nZ2xlZDogICBUaGUgcmVhbCBjYXB0aW9ucyBzdGF0ZVxuXG4gICAgY29uc3QgYnJvd3Nlckxhbmd1YWdlcyA9IG5hdmlnYXRvci5sYW5ndWFnZXMgfHwgW25hdmlnYXRvci5sYW5ndWFnZSB8fCBuYXZpZ2F0b3IudXNlckxhbmd1YWdlIHx8ICdlbiddO1xuICAgIGNvbnN0IGxhbmd1YWdlcyA9IGRlZHVwZShicm93c2VyTGFuZ3VhZ2VzLm1hcCgobGFuZ3VhZ2UpID0+IGxhbmd1YWdlLnNwbGl0KCctJylbMF0pKTtcbiAgICBsZXQgbGFuZ3VhZ2UgPSAodGhpcy5zdG9yYWdlLmdldCgnbGFuZ3VhZ2UnKSB8fCB0aGlzLmNvbmZpZy5jYXB0aW9ucy5sYW5ndWFnZSB8fCAnYXV0bycpLnRvTG93ZXJDYXNlKCk7XG5cbiAgICAvLyBVc2UgZmlyc3QgYnJvd3NlciBsYW5ndWFnZSB3aGVuIGxhbmd1YWdlIGlzICdhdXRvJ1xuICAgIGlmIChsYW5ndWFnZSA9PT0gJ2F1dG8nKSB7XG4gICAgICBbbGFuZ3VhZ2VdID0gbGFuZ3VhZ2VzO1xuICAgIH1cblxuICAgIGxldCBhY3RpdmUgPSB0aGlzLnN0b3JhZ2UuZ2V0KCdjYXB0aW9ucycpO1xuICAgIGlmICghaXMuYm9vbGVhbihhY3RpdmUpKSB7XG4gICAgICAoeyBhY3RpdmUgfSA9IHRoaXMuY29uZmlnLmNhcHRpb25zKTtcbiAgICB9XG5cbiAgICBPYmplY3QuYXNzaWduKHRoaXMuY2FwdGlvbnMsIHtcbiAgICAgIHRvZ2dsZWQ6IGZhbHNlLFxuICAgICAgYWN0aXZlLFxuICAgICAgbGFuZ3VhZ2UsXG4gICAgICBsYW5ndWFnZXMsXG4gICAgfSk7XG5cbiAgICAvLyBXYXRjaCBjaGFuZ2VzIHRvIHRleHRUcmFja3MgYW5kIHVwZGF0ZSBjYXB0aW9ucyBtZW51XG4gICAgaWYgKHRoaXMuaXNIVE1MNSkge1xuICAgICAgY29uc3QgdHJhY2tFdmVudHMgPSB0aGlzLmNvbmZpZy5jYXB0aW9ucy51cGRhdGUgPyAnYWRkdHJhY2sgcmVtb3ZldHJhY2snIDogJ3JlbW92ZXRyYWNrJztcbiAgICAgIG9uLmNhbGwodGhpcywgdGhpcy5tZWRpYS50ZXh0VHJhY2tzLCB0cmFja0V2ZW50cywgY2FwdGlvbnMudXBkYXRlLmJpbmQodGhpcykpO1xuICAgIH1cblxuICAgIC8vIFVwZGF0ZSBhdmFpbGFibGUgbGFuZ3VhZ2VzIGluIGxpc3QgbmV4dCB0aWNrICh0aGUgZXZlbnQgbXVzdCBub3QgYmUgdHJpZ2dlcmVkIGJlZm9yZSB0aGUgbGlzdGVuZXJzKVxuICAgIHNldFRpbWVvdXQoY2FwdGlvbnMudXBkYXRlLmJpbmQodGhpcyksIDApO1xuICB9LFxuXG4gIC8vIFVwZGF0ZSBhdmFpbGFibGUgbGFuZ3VhZ2Ugb3B0aW9ucyBpbiBzZXR0aW5ncyBiYXNlZCBvbiB0cmFja3NcbiAgdXBkYXRlKCkge1xuICAgIGNvbnN0IHRyYWNrcyA9IGNhcHRpb25zLmdldFRyYWNrcy5jYWxsKHRoaXMsIHRydWUpO1xuICAgIC8vIEdldCB0aGUgd2FudGVkIGxhbmd1YWdlXG4gICAgY29uc3QgeyBhY3RpdmUsIGxhbmd1YWdlLCBtZXRhLCBjdXJyZW50VHJhY2tOb2RlIH0gPSB0aGlzLmNhcHRpb25zO1xuICAgIGNvbnN0IGxhbmd1YWdlRXhpc3RzID0gQm9vbGVhbih0cmFja3MuZmluZCgodHJhY2spID0+IHRyYWNrLmxhbmd1YWdlID09PSBsYW5ndWFnZSkpO1xuXG4gICAgLy8gSGFuZGxlIHRyYWNrcyAoYWRkIGV2ZW50IGxpc3RlbmVyIGFuZCBcInBzZXVkb1wiLWRlZmF1bHQpXG4gICAgaWYgKHRoaXMuaXNIVE1MNSAmJiB0aGlzLmlzVmlkZW8pIHtcbiAgICAgIHRyYWNrc1xuICAgICAgICAuZmlsdGVyKCh0cmFjaykgPT4gIW1ldGEuZ2V0KHRyYWNrKSlcbiAgICAgICAgLmZvckVhY2goKHRyYWNrKSA9PiB7XG4gICAgICAgICAgdGhpcy5kZWJ1Zy5sb2coJ1RyYWNrIGFkZGVkJywgdHJhY2spO1xuXG4gICAgICAgICAgLy8gQXR0ZW1wdCB0byBzdG9yZSBpZiB0aGUgb3JpZ2luYWwgZG9tIGVsZW1lbnQgd2FzIFwiZGVmYXVsdFwiXG4gICAgICAgICAgbWV0YS5zZXQodHJhY2ssIHtcbiAgICAgICAgICAgIGRlZmF1bHQ6IHRyYWNrLm1vZGUgPT09ICdzaG93aW5nJyxcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIC8vIFR1cm4gb2ZmIG5hdGl2ZSBjYXB0aW9uIHJlbmRlcmluZyB0byBhdm9pZCBkb3VibGUgY2FwdGlvbnNcbiAgICAgICAgICAvLyBOb3RlOiBtb2RlPSdoaWRkZW4nIGZvcmNlcyBhIHRyYWNrIHRvIGRvd25sb2FkLiBUbyBlbnN1cmUgZXZlcnkgdHJhY2tcbiAgICAgICAgICAvLyBpc24ndCBkb3dubG9hZGVkIGF0IG9uY2UsIG9ubHkgJ3Nob3dpbmcnIHRyYWNrcyBzaG91bGQgYmUgcmVhc3NpZ25lZFxuICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1wYXJhbS1yZWFzc2lnblxuICAgICAgICAgIGlmICh0cmFjay5tb2RlID09PSAnc2hvd2luZycpIHtcbiAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1wYXJhbS1yZWFzc2lnblxuICAgICAgICAgICAgdHJhY2subW9kZSA9ICdoaWRkZW4nO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIEFkZCBldmVudCBsaXN0ZW5lciBmb3IgY3VlIGNoYW5nZXNcbiAgICAgICAgICBvbi5jYWxsKHRoaXMsIHRyYWNrLCAnY3VlY2hhbmdlJywgKCkgPT4gY2FwdGlvbnMudXBkYXRlQ3Vlcy5jYWxsKHRoaXMpKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gVXBkYXRlIGxhbmd1YWdlIGZpcnN0IHRpbWUgaXQgbWF0Y2hlcywgb3IgaWYgdGhlIHByZXZpb3VzIG1hdGNoaW5nIHRyYWNrIHdhcyByZW1vdmVkXG4gICAgaWYgKChsYW5ndWFnZUV4aXN0cyAmJiB0aGlzLmxhbmd1YWdlICE9PSBsYW5ndWFnZSkgfHwgIXRyYWNrcy5pbmNsdWRlcyhjdXJyZW50VHJhY2tOb2RlKSkge1xuICAgICAgY2FwdGlvbnMuc2V0TGFuZ3VhZ2UuY2FsbCh0aGlzLCBsYW5ndWFnZSk7XG4gICAgICBjYXB0aW9ucy50b2dnbGUuY2FsbCh0aGlzLCBhY3RpdmUgJiYgbGFuZ3VhZ2VFeGlzdHMpO1xuICAgIH1cblxuICAgIC8vIEVuYWJsZSBvciBkaXNhYmxlIGNhcHRpb25zIGJhc2VkIG9uIHRyYWNrIGxlbmd0aFxuICAgIGlmICh0aGlzLmVsZW1lbnRzKSB7XG4gICAgICB0b2dnbGVDbGFzcyh0aGlzLmVsZW1lbnRzLmNvbnRhaW5lciwgdGhpcy5jb25maWcuY2xhc3NOYW1lcy5jYXB0aW9ucy5lbmFibGVkLCAhaXMuZW1wdHkodHJhY2tzKSk7XG4gICAgfVxuXG4gICAgLy8gVXBkYXRlIGF2YWlsYWJsZSBsYW5ndWFnZXMgaW4gbGlzdFxuICAgIGlmIChcbiAgICAgIGlzLmFycmF5KHRoaXMuY29uZmlnLmNvbnRyb2xzKSAmJlxuICAgICAgdGhpcy5jb25maWcuY29udHJvbHMuaW5jbHVkZXMoJ3NldHRpbmdzJykgJiZcbiAgICAgIHRoaXMuY29uZmlnLnNldHRpbmdzLmluY2x1ZGVzKCdjYXB0aW9ucycpXG4gICAgKSB7XG4gICAgICBjb250cm9scy5zZXRDYXB0aW9uc01lbnUuY2FsbCh0aGlzKTtcbiAgICB9XG4gIH0sXG5cbiAgLy8gVG9nZ2xlIGNhcHRpb25zIGRpc3BsYXlcbiAgLy8gVXNlZCBpbnRlcm5hbGx5IGZvciB0aGUgdG9nZ2xlQ2FwdGlvbnMgbWV0aG9kLCB3aXRoIHRoZSBwYXNzaXZlIG9wdGlvbiBmb3JjZWQgdG8gZmFsc2VcbiAgdG9nZ2xlKGlucHV0LCBwYXNzaXZlID0gdHJ1ZSkge1xuICAgIC8vIElmIHRoZXJlJ3Mgbm8gZnVsbCBzdXBwb3J0XG4gICAgaWYgKCF0aGlzLnN1cHBvcnRlZC51aSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IHsgdG9nZ2xlZCB9ID0gdGhpcy5jYXB0aW9uczsgLy8gQ3VycmVudCBzdGF0ZVxuICAgIGNvbnN0IGFjdGl2ZUNsYXNzID0gdGhpcy5jb25maWcuY2xhc3NOYW1lcy5jYXB0aW9ucy5hY3RpdmU7XG4gICAgLy8gR2V0IHRoZSBuZXh0IHN0YXRlXG4gICAgLy8gSWYgdGhlIG1ldGhvZCBpcyBjYWxsZWQgd2l0aG91dCBwYXJhbWV0ZXIsIHRvZ2dsZSBiYXNlZCBvbiBjdXJyZW50IHZhbHVlXG4gICAgY29uc3QgYWN0aXZlID0gaXMubnVsbE9yVW5kZWZpbmVkKGlucHV0KSA/ICF0b2dnbGVkIDogaW5wdXQ7XG5cbiAgICAvLyBVcGRhdGUgc3RhdGUgYW5kIHRyaWdnZXIgZXZlbnRcbiAgICBpZiAoYWN0aXZlICE9PSB0b2dnbGVkKSB7XG4gICAgICAvLyBXaGVuIHBhc3NpdmUsIGRvbid0IG92ZXJyaWRlIHVzZXIgcHJlZmVyZW5jZXNcbiAgICAgIGlmICghcGFzc2l2ZSkge1xuICAgICAgICB0aGlzLmNhcHRpb25zLmFjdGl2ZSA9IGFjdGl2ZTtcbiAgICAgICAgdGhpcy5zdG9yYWdlLnNldCh7IGNhcHRpb25zOiBhY3RpdmUgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIEZvcmNlIGxhbmd1YWdlIGlmIHRoZSBjYWxsIGlzbid0IHBhc3NpdmUgYW5kIHRoZXJlIGlzIG5vIG1hdGNoaW5nIGxhbmd1YWdlIHRvIHRvZ2dsZSB0b1xuICAgICAgaWYgKCF0aGlzLmxhbmd1YWdlICYmIGFjdGl2ZSAmJiAhcGFzc2l2ZSkge1xuICAgICAgICBjb25zdCB0cmFja3MgPSBjYXB0aW9ucy5nZXRUcmFja3MuY2FsbCh0aGlzKTtcbiAgICAgICAgY29uc3QgdHJhY2sgPSBjYXB0aW9ucy5maW5kVHJhY2suY2FsbCh0aGlzLCBbdGhpcy5jYXB0aW9ucy5sYW5ndWFnZSwgLi4udGhpcy5jYXB0aW9ucy5sYW5ndWFnZXNdLCB0cnVlKTtcblxuICAgICAgICAvLyBPdmVycmlkZSB1c2VyIHByZWZlcmVuY2VzIHRvIGF2b2lkIHN3aXRjaGluZyBsYW5ndWFnZXMgaWYgYSBtYXRjaGluZyB0cmFjayBpcyBhZGRlZFxuICAgICAgICB0aGlzLmNhcHRpb25zLmxhbmd1YWdlID0gdHJhY2subGFuZ3VhZ2U7XG5cbiAgICAgICAgLy8gU2V0IGNhcHRpb24sIGJ1dCBkb24ndCBzdG9yZSBpbiBsb2NhbFN0b3JhZ2UgYXMgdXNlciBwcmVmZXJlbmNlXG4gICAgICAgIGNhcHRpb25zLnNldC5jYWxsKHRoaXMsIHRyYWNrcy5pbmRleE9mKHRyYWNrKSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgLy8gVG9nZ2xlIGJ1dHRvbiBpZiBpdCdzIGVuYWJsZWRcbiAgICAgIGlmICh0aGlzLmVsZW1lbnRzLmJ1dHRvbnMuY2FwdGlvbnMpIHtcbiAgICAgICAgdGhpcy5lbGVtZW50cy5idXR0b25zLmNhcHRpb25zLnByZXNzZWQgPSBhY3RpdmU7XG4gICAgICB9XG5cbiAgICAgIC8vIEFkZCBjbGFzcyBob29rXG4gICAgICB0b2dnbGVDbGFzcyh0aGlzLmVsZW1lbnRzLmNvbnRhaW5lciwgYWN0aXZlQ2xhc3MsIGFjdGl2ZSk7XG5cbiAgICAgIHRoaXMuY2FwdGlvbnMudG9nZ2xlZCA9IGFjdGl2ZTtcblxuICAgICAgLy8gVXBkYXRlIHNldHRpbmdzIG1lbnVcbiAgICAgIGNvbnRyb2xzLnVwZGF0ZVNldHRpbmcuY2FsbCh0aGlzLCAnY2FwdGlvbnMnKTtcblxuICAgICAgLy8gVHJpZ2dlciBldmVudCAobm90IHVzZWQgaW50ZXJuYWxseSlcbiAgICAgIHRyaWdnZXJFdmVudC5jYWxsKHRoaXMsIHRoaXMubWVkaWEsIGFjdGl2ZSA/ICdjYXB0aW9uc2VuYWJsZWQnIDogJ2NhcHRpb25zZGlzYWJsZWQnKTtcbiAgICB9XG5cbiAgICAvLyBXYWl0IGZvciB0aGUgY2FsbCBzdGFjayB0byBjbGVhciBiZWZvcmUgc2V0dGluZyBtb2RlPSdoaWRkZW4nXG4gICAgLy8gb24gdGhlIGFjdGl2ZSB0cmFjayAtIGZvcmNpbmcgdGhlIGJyb3dzZXIgdG8gZG93bmxvYWQgaXRcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIGlmIChhY3RpdmUgJiYgdGhpcy5jYXB0aW9ucy50b2dnbGVkKSB7XG4gICAgICAgIHRoaXMuY2FwdGlvbnMuY3VycmVudFRyYWNrTm9kZS5tb2RlID0gJ2hpZGRlbic7XG4gICAgICB9XG4gICAgfSk7XG4gIH0sXG5cbiAgLy8gU2V0IGNhcHRpb25zIGJ5IHRyYWNrIGluZGV4XG4gIC8vIFVzZWQgaW50ZXJuYWxseSBmb3IgdGhlIGN1cnJlbnRUcmFjayBzZXR0ZXIgd2l0aCB0aGUgcGFzc2l2ZSBvcHRpb24gZm9yY2VkIHRvIGZhbHNlXG4gIHNldChpbmRleCwgcGFzc2l2ZSA9IHRydWUpIHtcbiAgICBjb25zdCB0cmFja3MgPSBjYXB0aW9ucy5nZXRUcmFja3MuY2FsbCh0aGlzKTtcblxuICAgIC8vIERpc2FibGUgY2FwdGlvbnMgaWYgc2V0dGluZyB0byAtMVxuICAgIGlmIChpbmRleCA9PT0gLTEpIHtcbiAgICAgIGNhcHRpb25zLnRvZ2dsZS5jYWxsKHRoaXMsIGZhbHNlLCBwYXNzaXZlKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoIWlzLm51bWJlcihpbmRleCkpIHtcbiAgICAgIHRoaXMuZGVidWcud2FybignSW52YWxpZCBjYXB0aW9uIGFyZ3VtZW50JywgaW5kZXgpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICghKGluZGV4IGluIHRyYWNrcykpIHtcbiAgICAgIHRoaXMuZGVidWcud2FybignVHJhY2sgbm90IGZvdW5kJywgaW5kZXgpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmNhcHRpb25zLmN1cnJlbnRUcmFjayAhPT0gaW5kZXgpIHtcbiAgICAgIHRoaXMuY2FwdGlvbnMuY3VycmVudFRyYWNrID0gaW5kZXg7XG4gICAgICBjb25zdCB0cmFjayA9IHRyYWNrc1tpbmRleF07XG4gICAgICBjb25zdCB7IGxhbmd1YWdlIH0gPSB0cmFjayB8fCB7fTtcblxuICAgICAgLy8gU3RvcmUgcmVmZXJlbmNlIHRvIG5vZGUgZm9yIGludmFsaWRhdGlvbiBvbiByZW1vdmVcbiAgICAgIHRoaXMuY2FwdGlvbnMuY3VycmVudFRyYWNrTm9kZSA9IHRyYWNrO1xuXG4gICAgICAvLyBVcGRhdGUgc2V0dGluZ3MgbWVudVxuICAgICAgY29udHJvbHMudXBkYXRlU2V0dGluZy5jYWxsKHRoaXMsICdjYXB0aW9ucycpO1xuXG4gICAgICAvLyBXaGVuIHBhc3NpdmUsIGRvbid0IG92ZXJyaWRlIHVzZXIgcHJlZmVyZW5jZXNcbiAgICAgIGlmICghcGFzc2l2ZSkge1xuICAgICAgICB0aGlzLmNhcHRpb25zLmxhbmd1YWdlID0gbGFuZ3VhZ2U7XG4gICAgICAgIHRoaXMuc3RvcmFnZS5zZXQoeyBsYW5ndWFnZSB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gSGFuZGxlIFZpbWVvIGNhcHRpb25zXG4gICAgICBpZiAodGhpcy5pc1ZpbWVvKSB7XG4gICAgICAgIHRoaXMuZW1iZWQuZW5hYmxlVGV4dFRyYWNrKGxhbmd1YWdlKTtcbiAgICAgIH1cblxuICAgICAgLy8gVHJpZ2dlciBldmVudFxuICAgICAgdHJpZ2dlckV2ZW50LmNhbGwodGhpcywgdGhpcy5tZWRpYSwgJ2xhbmd1YWdlY2hhbmdlJyk7XG4gICAgfVxuXG4gICAgLy8gU2hvdyBjYXB0aW9uc1xuICAgIGNhcHRpb25zLnRvZ2dsZS5jYWxsKHRoaXMsIHRydWUsIHBhc3NpdmUpO1xuXG4gICAgaWYgKHRoaXMuaXNIVE1MNSAmJiB0aGlzLmlzVmlkZW8pIHtcbiAgICAgIC8vIElmIHdlIGNoYW5nZSB0aGUgYWN0aXZlIHRyYWNrIHdoaWxlIGEgY3VlIGlzIGFscmVhZHkgZGlzcGxheWVkIHdlIG5lZWQgdG8gdXBkYXRlIGl0XG4gICAgICBjYXB0aW9ucy51cGRhdGVDdWVzLmNhbGwodGhpcyk7XG4gICAgfVxuICB9LFxuXG4gIC8vIFNldCBjYXB0aW9ucyBieSBsYW5ndWFnZVxuICAvLyBVc2VkIGludGVybmFsbHkgZm9yIHRoZSBsYW5ndWFnZSBzZXR0ZXIgd2l0aCB0aGUgcGFzc2l2ZSBvcHRpb24gZm9yY2VkIHRvIGZhbHNlXG4gIHNldExhbmd1YWdlKGlucHV0LCBwYXNzaXZlID0gdHJ1ZSkge1xuICAgIGlmICghaXMuc3RyaW5nKGlucHV0KSkge1xuICAgICAgdGhpcy5kZWJ1Zy53YXJuKCdJbnZhbGlkIGxhbmd1YWdlIGFyZ3VtZW50JywgaW5wdXQpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAvLyBOb3JtYWxpemVcbiAgICBjb25zdCBsYW5ndWFnZSA9IGlucHV0LnRvTG93ZXJDYXNlKCk7XG4gICAgdGhpcy5jYXB0aW9ucy5sYW5ndWFnZSA9IGxhbmd1YWdlO1xuXG4gICAgLy8gU2V0IGN1cnJlbnRUcmFja1xuICAgIGNvbnN0IHRyYWNrcyA9IGNhcHRpb25zLmdldFRyYWNrcy5jYWxsKHRoaXMpO1xuICAgIGNvbnN0IHRyYWNrID0gY2FwdGlvbnMuZmluZFRyYWNrLmNhbGwodGhpcywgW2xhbmd1YWdlXSk7XG4gICAgY2FwdGlvbnMuc2V0LmNhbGwodGhpcywgdHJhY2tzLmluZGV4T2YodHJhY2spLCBwYXNzaXZlKTtcbiAgfSxcblxuICAvLyBHZXQgY3VycmVudCB2YWxpZCBjYXB0aW9uIHRyYWNrc1xuICAvLyBJZiB1cGRhdGUgaXMgZmFsc2UgaXQgd2lsbCBhbHNvIGlnbm9yZSB0cmFja3Mgd2l0aG91dCBtZXRhZGF0YVxuICAvLyBUaGlzIGlzIHVzZWQgdG8gXCJmcmVlemVcIiB0aGUgbGFuZ3VhZ2Ugb3B0aW9ucyB3aGVuIGNhcHRpb25zLnVwZGF0ZSBpcyBmYWxzZVxuICBnZXRUcmFja3ModXBkYXRlID0gZmFsc2UpIHtcbiAgICAvLyBIYW5kbGUgbWVkaWEgb3IgdGV4dFRyYWNrcyBtaXNzaW5nIG9yIG51bGxcbiAgICBjb25zdCB0cmFja3MgPSBBcnJheS5mcm9tKCh0aGlzLm1lZGlhIHx8IHt9KS50ZXh0VHJhY2tzIHx8IFtdKTtcbiAgICAvLyBGb3IgSFRNTDUsIHVzZSBjYWNoZSBpbnN0ZWFkIG9mIGN1cnJlbnQgdHJhY2tzIHdoZW4gaXQgZXhpc3RzIChpZiBjYXB0aW9ucy51cGRhdGUgaXMgZmFsc2UpXG4gICAgLy8gRmlsdGVyIG91dCByZW1vdmVkIHRyYWNrcyBhbmQgdHJhY2tzIHRoYXQgYXJlbid0IGNhcHRpb25zL3N1YnRpdGxlcyAoZm9yIGV4YW1wbGUgbWV0YWRhdGEpXG4gICAgcmV0dXJuIHRyYWNrc1xuICAgICAgLmZpbHRlcigodHJhY2spID0+ICF0aGlzLmlzSFRNTDUgfHwgdXBkYXRlIHx8IHRoaXMuY2FwdGlvbnMubWV0YS5oYXModHJhY2spKVxuICAgICAgLmZpbHRlcigodHJhY2spID0+IFsnY2FwdGlvbnMnLCAnc3VidGl0bGVzJ10uaW5jbHVkZXModHJhY2sua2luZCkpO1xuICB9LFxuXG4gIC8vIE1hdGNoIHRyYWNrcyBiYXNlZCBvbiBsYW5ndWFnZXMgYW5kIGdldCB0aGUgZmlyc3RcbiAgZmluZFRyYWNrKGxhbmd1YWdlcywgZm9yY2UgPSBmYWxzZSkge1xuICAgIGNvbnN0IHRyYWNrcyA9IGNhcHRpb25zLmdldFRyYWNrcy5jYWxsKHRoaXMpO1xuICAgIGNvbnN0IHNvcnRJc0RlZmF1bHQgPSAodHJhY2spID0+IE51bWJlcigodGhpcy5jYXB0aW9ucy5tZXRhLmdldCh0cmFjaykgfHwge30pLmRlZmF1bHQpO1xuICAgIGNvbnN0IHNvcnRlZCA9IEFycmF5LmZyb20odHJhY2tzKS5zb3J0KChhLCBiKSA9PiBzb3J0SXNEZWZhdWx0KGIpIC0gc29ydElzRGVmYXVsdChhKSk7XG4gICAgbGV0IHRyYWNrO1xuXG4gICAgbGFuZ3VhZ2VzLmV2ZXJ5KChsYW5ndWFnZSkgPT4ge1xuICAgICAgdHJhY2sgPSBzb3J0ZWQuZmluZCgodCkgPT4gdC5sYW5ndWFnZSA9PT0gbGFuZ3VhZ2UpO1xuICAgICAgcmV0dXJuICF0cmFjazsgLy8gQnJlYWsgaXRlcmF0aW9uIGlmIHRoZXJlIGlzIGEgbWF0Y2hcbiAgICB9KTtcblxuICAgIC8vIElmIG5vIG1hdGNoIGlzIGZvdW5kIGJ1dCBpcyByZXF1aXJlZCwgZ2V0IGZpcnN0XG4gICAgcmV0dXJuIHRyYWNrIHx8IChmb3JjZSA/IHNvcnRlZFswXSA6IHVuZGVmaW5lZCk7XG4gIH0sXG5cbiAgLy8gR2V0IHRoZSBjdXJyZW50IHRyYWNrXG4gIGdldEN1cnJlbnRUcmFjaygpIHtcbiAgICByZXR1cm4gY2FwdGlvbnMuZ2V0VHJhY2tzLmNhbGwodGhpcylbdGhpcy5jdXJyZW50VHJhY2tdO1xuICB9LFxuXG4gIC8vIEdldCBVSSBsYWJlbCBmb3IgdHJhY2tcbiAgZ2V0TGFiZWwodHJhY2spIHtcbiAgICBsZXQgY3VycmVudFRyYWNrID0gdHJhY2s7XG5cbiAgICBpZiAoIWlzLnRyYWNrKGN1cnJlbnRUcmFjaykgJiYgc3VwcG9ydC50ZXh0VHJhY2tzICYmIHRoaXMuY2FwdGlvbnMudG9nZ2xlZCkge1xuICAgICAgY3VycmVudFRyYWNrID0gY2FwdGlvbnMuZ2V0Q3VycmVudFRyYWNrLmNhbGwodGhpcyk7XG4gICAgfVxuXG4gICAgaWYgKGlzLnRyYWNrKGN1cnJlbnRUcmFjaykpIHtcbiAgICAgIGlmICghaXMuZW1wdHkoY3VycmVudFRyYWNrLmxhYmVsKSkge1xuICAgICAgICByZXR1cm4gY3VycmVudFRyYWNrLmxhYmVsO1xuICAgICAgfVxuXG4gICAgICBpZiAoIWlzLmVtcHR5KGN1cnJlbnRUcmFjay5sYW5ndWFnZSkpIHtcbiAgICAgICAgcmV0dXJuIHRyYWNrLmxhbmd1YWdlLnRvVXBwZXJDYXNlKCk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBpMThuLmdldCgnZW5hYmxlZCcsIHRoaXMuY29uZmlnKTtcbiAgICB9XG5cbiAgICByZXR1cm4gaTE4bi5nZXQoJ2Rpc2FibGVkJywgdGhpcy5jb25maWcpO1xuICB9LFxuXG4gIC8vIFVwZGF0ZSBjYXB0aW9ucyB1c2luZyBjdXJyZW50IHRyYWNrJ3MgYWN0aXZlIGN1ZXNcbiAgLy8gQWxzbyBvcHRpb25hbCBhcnJheSBhcmd1bWVudCBpbiBjYXNlIHRoZXJlIGlzbid0IGFueSB0cmFjayAoZXg6IHZpbWVvKVxuICB1cGRhdGVDdWVzKGlucHV0KSB7XG4gICAgLy8gUmVxdWlyZXMgVUlcbiAgICBpZiAoIXRoaXMuc3VwcG9ydGVkLnVpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKCFpcy5lbGVtZW50KHRoaXMuZWxlbWVudHMuY2FwdGlvbnMpKSB7XG4gICAgICB0aGlzLmRlYnVnLndhcm4oJ05vIGNhcHRpb25zIGVsZW1lbnQgdG8gcmVuZGVyIHRvJyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gT25seSBhY2NlcHQgYXJyYXkgb3IgZW1wdHkgaW5wdXRcbiAgICBpZiAoIWlzLm51bGxPclVuZGVmaW5lZChpbnB1dCkgJiYgIUFycmF5LmlzQXJyYXkoaW5wdXQpKSB7XG4gICAgICB0aGlzLmRlYnVnLndhcm4oJ3VwZGF0ZUN1ZXM6IEludmFsaWQgaW5wdXQnLCBpbnB1dCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgbGV0IGN1ZXMgPSBpbnB1dDtcblxuICAgIC8vIEdldCBjdWVzIGZyb20gdHJhY2tcbiAgICBpZiAoIWN1ZXMpIHtcbiAgICAgIGNvbnN0IHRyYWNrID0gY2FwdGlvbnMuZ2V0Q3VycmVudFRyYWNrLmNhbGwodGhpcyk7XG5cbiAgICAgIGN1ZXMgPSBBcnJheS5mcm9tKCh0cmFjayB8fCB7fSkuYWN0aXZlQ3VlcyB8fCBbXSlcbiAgICAgICAgLm1hcCgoY3VlKSA9PiBjdWUuZ2V0Q3VlQXNIVE1MKCkpXG4gICAgICAgIC5tYXAoZ2V0SFRNTCk7XG4gICAgfVxuXG4gICAgLy8gU2V0IG5ldyBjYXB0aW9uIHRleHRcbiAgICBjb25zdCBjb250ZW50ID0gY3Vlcy5tYXAoKGN1ZVRleHQpID0+IGN1ZVRleHQudHJpbSgpKS5qb2luKCdcXG4nKTtcbiAgICBjb25zdCBjaGFuZ2VkID0gY29udGVudCAhPT0gdGhpcy5lbGVtZW50cy5jYXB0aW9ucy5pbm5lckhUTUw7XG5cbiAgICBpZiAoY2hhbmdlZCkge1xuICAgICAgLy8gRW1wdHkgdGhlIGNvbnRhaW5lciBhbmQgY3JlYXRlIGEgbmV3IGNoaWxkIGVsZW1lbnRcbiAgICAgIGVtcHR5RWxlbWVudCh0aGlzLmVsZW1lbnRzLmNhcHRpb25zKTtcbiAgICAgIGNvbnN0IGNhcHRpb24gPSBjcmVhdGVFbGVtZW50KCdzcGFuJywgZ2V0QXR0cmlidXRlc0Zyb21TZWxlY3Rvcih0aGlzLmNvbmZpZy5zZWxlY3RvcnMuY2FwdGlvbikpO1xuICAgICAgY2FwdGlvbi5pbm5lckhUTUwgPSBjb250ZW50O1xuICAgICAgdGhpcy5lbGVtZW50cy5jYXB0aW9ucy5hcHBlbmRDaGlsZChjYXB0aW9uKTtcblxuICAgICAgLy8gVHJpZ2dlciBldmVudFxuICAgICAgdHJpZ2dlckV2ZW50LmNhbGwodGhpcywgdGhpcy5tZWRpYSwgJ2N1ZWNoYW5nZScpO1xuICAgIH1cbiAgfSxcbn07XG5cbmV4cG9ydCBkZWZhdWx0IGNhcHRpb25zO1xuIiwiLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFBseXIgZGVmYXVsdCBjb25maWdcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmNvbnN0IGRlZmF1bHRzID0ge1xuICAvLyBEaXNhYmxlXG4gIGVuYWJsZWQ6IHRydWUsXG5cbiAgLy8gQ3VzdG9tIG1lZGlhIHRpdGxlXG4gIHRpdGxlOiAnJyxcblxuICAvLyBMb2dnaW5nIHRvIGNvbnNvbGVcbiAgZGVidWc6IGZhbHNlLFxuXG4gIC8vIEF1dG8gcGxheSAoaWYgc3VwcG9ydGVkKVxuICBhdXRvcGxheTogZmFsc2UsXG5cbiAgLy8gT25seSBhbGxvdyBvbmUgbWVkaWEgcGxheWluZyBhdCBvbmNlICh2aW1lbyBvbmx5KVxuICBhdXRvcGF1c2U6IHRydWUsXG5cbiAgLy8gQWxsb3cgaW5saW5lIHBsYXliYWNrIG9uIGlPUyAodGhpcyBlZmZlY3RzIFlvdVR1YmUvVmltZW8gLSBIVE1MNSByZXF1aXJlcyB0aGUgYXR0cmlidXRlIHByZXNlbnQpXG4gIC8vIFRPRE86IFJlbW92ZSBpb3NOYXRpdmUgZnVsbHNjcmVlbiBvcHRpb24gaW4gZmF2b3VyIG9mIHRoaXMgKGxvZ2ljIG5lZWRzIHdvcmspXG4gIHBsYXlzaW5saW5lOiB0cnVlLFxuXG4gIC8vIERlZmF1bHQgdGltZSB0byBza2lwIHdoZW4gcmV3aW5kL2Zhc3QgZm9yd2FyZFxuICBzZWVrVGltZTogMTAsXG5cbiAgLy8gRGVmYXVsdCB2b2x1bWVcbiAgdm9sdW1lOiAxLFxuICBtdXRlZDogZmFsc2UsXG5cbiAgLy8gUGFzcyBhIGN1c3RvbSBkdXJhdGlvblxuICBkdXJhdGlvbjogbnVsbCxcblxuICAvLyBEaXNwbGF5IHRoZSBtZWRpYSBkdXJhdGlvbiBvbiBsb2FkIGluIHRoZSBjdXJyZW50IHRpbWUgcG9zaXRpb25cbiAgLy8gSWYgeW91IGhhdmUgb3B0ZWQgdG8gZGlzcGxheSBib3RoIGR1cmF0aW9uIGFuZCBjdXJyZW50VGltZSwgdGhpcyBpcyBpZ25vcmVkXG4gIGRpc3BsYXlEdXJhdGlvbjogdHJ1ZSxcblxuICAvLyBJbnZlcnQgdGhlIGN1cnJlbnQgdGltZSB0byBiZSBhIGNvdW50ZG93blxuICBpbnZlcnRUaW1lOiB0cnVlLFxuXG4gIC8vIENsaWNraW5nIHRoZSBjdXJyZW50VGltZSBpbnZlcnRzIGl0J3MgdmFsdWUgdG8gc2hvdyB0aW1lIGxlZnQgcmF0aGVyIHRoYW4gZWxhcHNlZFxuICB0b2dnbGVJbnZlcnQ6IHRydWUsXG5cbiAgLy8gRm9yY2UgYW4gYXNwZWN0IHJhdGlvXG4gIC8vIFRoZSBmb3JtYXQgbXVzdCBiZSBgJ3c6aCdgIChlLmcuIGAnMTY6OSdgKVxuICByYXRpbzogbnVsbCxcblxuICAvLyBDbGljayB2aWRlbyBjb250YWluZXIgdG8gcGxheS9wYXVzZVxuICBjbGlja1RvUGxheTogdHJ1ZSxcblxuICAvLyBBdXRvIGhpZGUgdGhlIGNvbnRyb2xzXG4gIGhpZGVDb250cm9sczogdHJ1ZSxcblxuICAvLyBSZXNldCB0byBzdGFydCB3aGVuIHBsYXliYWNrIGVuZGVkXG4gIHJlc2V0T25FbmQ6IGZhbHNlLFxuXG4gIC8vIERpc2FibGUgdGhlIHN0YW5kYXJkIGNvbnRleHQgbWVudVxuICBkaXNhYmxlQ29udGV4dE1lbnU6IHRydWUsXG5cbiAgLy8gU3ByaXRlIChmb3IgaWNvbnMpXG4gIGxvYWRTcHJpdGU6IHRydWUsXG4gIGljb25QcmVmaXg6ICdwbHlyJyxcbiAgaWNvblVybDogJ2h0dHBzOi8vY2RuLnBseXIuaW8vMy43LjIvcGx5ci5zdmcnLFxuXG4gIC8vIEJsYW5rIHZpZGVvICh1c2VkIHRvIHByZXZlbnQgZXJyb3JzIG9uIHNvdXJjZSBjaGFuZ2UpXG4gIGJsYW5rVmlkZW86ICdodHRwczovL2Nkbi5wbHlyLmlvL3N0YXRpYy9ibGFuay5tcDQnLFxuXG4gIC8vIFF1YWxpdHkgZGVmYXVsdFxuICBxdWFsaXR5OiB7XG4gICAgZGVmYXVsdDogNTc2LFxuICAgIC8vIFRoZSBvcHRpb25zIHRvIGRpc3BsYXkgaW4gdGhlIFVJLCBpZiBhdmFpbGFibGUgZm9yIHRoZSBzb3VyY2UgbWVkaWFcbiAgICBvcHRpb25zOiBbNDMyMCwgMjg4MCwgMjE2MCwgMTQ0MCwgMTA4MCwgNzIwLCA1NzYsIDQ4MCwgMzYwLCAyNDBdLFxuICAgIGZvcmNlZDogZmFsc2UsXG4gICAgb25DaGFuZ2U6IG51bGwsXG4gIH0sXG5cbiAgLy8gU2V0IGxvb3BzXG4gIGxvb3A6IHtcbiAgICBhY3RpdmU6IGZhbHNlLFxuICAgIC8vIHN0YXJ0OiBudWxsLFxuICAgIC8vIGVuZDogbnVsbCxcbiAgfSxcblxuICAvLyBTcGVlZCBkZWZhdWx0IGFuZCBvcHRpb25zIHRvIGRpc3BsYXlcbiAgc3BlZWQ6IHtcbiAgICBzZWxlY3RlZDogMSxcbiAgICAvLyBUaGUgb3B0aW9ucyB0byBkaXNwbGF5IGluIHRoZSBVSSwgaWYgYXZhaWxhYmxlIGZvciB0aGUgc291cmNlIG1lZGlhIChlLmcuIFZpbWVvIGFuZCBZb3VUdWJlIG9ubHkgc3VwcG9ydCAwLjV4LTR4KVxuICAgIG9wdGlvbnM6IFswLjUsIDAuNzUsIDEsIDEuMjUsIDEuNSwgMS43NSwgMiwgNF0sXG4gIH0sXG5cbiAgLy8gS2V5Ym9hcmQgc2hvcnRjdXQgc2V0dGluZ3NcbiAga2V5Ym9hcmQ6IHtcbiAgICBmb2N1c2VkOiB0cnVlLFxuICAgIGdsb2JhbDogZmFsc2UsXG4gIH0sXG5cbiAgLy8gRGlzcGxheSB0b29sdGlwc1xuICB0b29sdGlwczoge1xuICAgIGNvbnRyb2xzOiBmYWxzZSxcbiAgICBzZWVrOiB0cnVlLFxuICB9LFxuXG4gIC8vIENhcHRpb25zIHNldHRpbmdzXG4gIGNhcHRpb25zOiB7XG4gICAgYWN0aXZlOiBmYWxzZSxcbiAgICBsYW5ndWFnZTogJ2F1dG8nLFxuICAgIC8vIExpc3RlbiB0byBuZXcgdHJhY2tzIGFkZGVkIGFmdGVyIFBseXIgaXMgaW5pdGlhbGl6ZWQuXG4gICAgLy8gVGhpcyBpcyBuZWVkZWQgZm9yIHN0cmVhbWluZyBjYXB0aW9ucywgYnV0IG1heSByZXN1bHQgaW4gdW5zZWxlY3RhYmxlIG9wdGlvbnNcbiAgICB1cGRhdGU6IGZhbHNlLFxuICB9LFxuXG4gIC8vIEZ1bGxzY3JlZW4gc2V0dGluZ3NcbiAgZnVsbHNjcmVlbjoge1xuICAgIGVuYWJsZWQ6IHRydWUsIC8vIEFsbG93IGZ1bGxzY3JlZW4/XG4gICAgZmFsbGJhY2s6IHRydWUsIC8vIEZhbGxiYWNrIHVzaW5nIGZ1bGwgdmlld3BvcnQvd2luZG93XG4gICAgaW9zTmF0aXZlOiBmYWxzZSwgLy8gVXNlIHRoZSBuYXRpdmUgZnVsbHNjcmVlbiBpbiBpT1MgKGRpc2FibGVzIGN1c3RvbSBjb250cm9scylcbiAgICAvLyBTZWxlY3RvciBmb3IgdGhlIGZ1bGxzY3JlZW4gY29udGFpbmVyIHNvIGNvbnRleHR1YWwgLyBub24tcGxheWVyIGNvbnRlbnQgY2FuIHJlbWFpbiB2aXNpYmxlIGluIGZ1bGxzY3JlZW4gbW9kZVxuICAgIC8vIE5vbi1hbmNlc3RvcnMgb2YgdGhlIHBsYXllciBlbGVtZW50IHdpbGwgYmUgaWdub3JlZFxuICAgIC8vIGNvbnRhaW5lcjogbnVsbCwgLy8gZGVmYXVsdHMgdG8gdGhlIHBsYXllciBlbGVtZW50XG4gIH0sXG5cbiAgLy8gTG9jYWwgc3RvcmFnZVxuICBzdG9yYWdlOiB7XG4gICAgZW5hYmxlZDogdHJ1ZSxcbiAgICBrZXk6ICdwbHlyJyxcbiAgfSxcblxuICAvLyBEZWZhdWx0IGNvbnRyb2xzXG4gIGNvbnRyb2xzOiBbXG4gICAgJ3BsYXktbGFyZ2UnLFxuICAgIC8vICdyZXN0YXJ0JyxcbiAgICAvLyAncmV3aW5kJyxcbiAgICAncGxheScsXG4gICAgLy8gJ2Zhc3QtZm9yd2FyZCcsXG4gICAgJ3Byb2dyZXNzJyxcbiAgICAnY3VycmVudC10aW1lJyxcbiAgICAvLyAnZHVyYXRpb24nLFxuICAgICdtdXRlJyxcbiAgICAndm9sdW1lJyxcbiAgICAnY2FwdGlvbnMnLFxuICAgICdzZXR0aW5ncycsXG4gICAgJ3BpcCcsXG4gICAgJ2FpcnBsYXknLFxuICAgIC8vICdkb3dubG9hZCcsXG4gICAgJ2Z1bGxzY3JlZW4nLFxuICBdLFxuICBzZXR0aW5nczogWydjYXB0aW9ucycsICdxdWFsaXR5JywgJ3NwZWVkJ10sXG5cbiAgLy8gTG9jYWxpc2F0aW9uXG4gIGkxOG46IHtcbiAgICByZXN0YXJ0OiAnUmVzdGFydCcsXG4gICAgcmV3aW5kOiAnUmV3aW5kIHtzZWVrdGltZX1zJyxcbiAgICBwbGF5OiAnUGxheScsXG4gICAgcGF1c2U6ICdQYXVzZScsXG4gICAgZmFzdEZvcndhcmQ6ICdGb3J3YXJkIHtzZWVrdGltZX1zJyxcbiAgICBzZWVrOiAnU2VlaycsXG4gICAgc2Vla0xhYmVsOiAne2N1cnJlbnRUaW1lfSBvZiB7ZHVyYXRpb259JyxcbiAgICBwbGF5ZWQ6ICdQbGF5ZWQnLFxuICAgIGJ1ZmZlcmVkOiAnQnVmZmVyZWQnLFxuICAgIGN1cnJlbnRUaW1lOiAnQ3VycmVudCB0aW1lJyxcbiAgICBkdXJhdGlvbjogJ0R1cmF0aW9uJyxcbiAgICB2b2x1bWU6ICdWb2x1bWUnLFxuICAgIG11dGU6ICdNdXRlJyxcbiAgICB1bm11dGU6ICdVbm11dGUnLFxuICAgIGVuYWJsZUNhcHRpb25zOiAnRW5hYmxlIGNhcHRpb25zJyxcbiAgICBkaXNhYmxlQ2FwdGlvbnM6ICdEaXNhYmxlIGNhcHRpb25zJyxcbiAgICBkb3dubG9hZDogJ0Rvd25sb2FkJyxcbiAgICBlbnRlckZ1bGxzY3JlZW46ICdFbnRlciBmdWxsc2NyZWVuJyxcbiAgICBleGl0RnVsbHNjcmVlbjogJ0V4aXQgZnVsbHNjcmVlbicsXG4gICAgZnJhbWVUaXRsZTogJ1BsYXllciBmb3Ige3RpdGxlfScsXG4gICAgY2FwdGlvbnM6ICdDYXB0aW9ucycsXG4gICAgc2V0dGluZ3M6ICdTZXR0aW5ncycsXG4gICAgcGlwOiAnUElQJyxcbiAgICBtZW51QmFjazogJ0dvIGJhY2sgdG8gcHJldmlvdXMgbWVudScsXG4gICAgc3BlZWQ6ICdTcGVlZCcsXG4gICAgbm9ybWFsOiAnTm9ybWFsJyxcbiAgICBxdWFsaXR5OiAnUXVhbGl0eScsXG4gICAgbG9vcDogJ0xvb3AnLFxuICAgIHN0YXJ0OiAnU3RhcnQnLFxuICAgIGVuZDogJ0VuZCcsXG4gICAgYWxsOiAnQWxsJyxcbiAgICByZXNldDogJ1Jlc2V0JyxcbiAgICBkaXNhYmxlZDogJ0Rpc2FibGVkJyxcbiAgICBlbmFibGVkOiAnRW5hYmxlZCcsXG4gICAgYWR2ZXJ0aXNlbWVudDogJ0FkJyxcbiAgICBxdWFsaXR5QmFkZ2U6IHtcbiAgICAgIDIxNjA6ICc0SycsXG4gICAgICAxNDQwOiAnSEQnLFxuICAgICAgMTA4MDogJ0hEJyxcbiAgICAgIDcyMDogJ0hEJyxcbiAgICAgIDU3NjogJ1NEJyxcbiAgICAgIDQ4MDogJ1NEJyxcbiAgICB9LFxuICB9LFxuXG4gIC8vIFVSTHNcbiAgdXJsczoge1xuICAgIGRvd25sb2FkOiBudWxsLFxuICAgIHZpbWVvOiB7XG4gICAgICBzZGs6ICdodHRwczovL3BsYXllci52aW1lby5jb20vYXBpL3BsYXllci5qcycsXG4gICAgICBpZnJhbWU6ICdodHRwczovL3BsYXllci52aW1lby5jb20vdmlkZW8vezB9P3sxfScsXG4gICAgICBhcGk6ICdodHRwczovL3ZpbWVvLmNvbS9hcGkvb2VtYmVkLmpzb24/dXJsPXswfScsXG4gICAgfSxcbiAgICB5b3V0dWJlOiB7XG4gICAgICBzZGs6ICdodHRwczovL3d3dy55b3V0dWJlLmNvbS9pZnJhbWVfYXBpJyxcbiAgICAgIGFwaTogJ2h0dHBzOi8vbm9lbWJlZC5jb20vZW1iZWQ/dXJsPWh0dHBzOi8vd3d3LnlvdXR1YmUuY29tL3dhdGNoP3Y9ezB9JyxcbiAgICB9LFxuICAgIGdvb2dsZUlNQToge1xuICAgICAgc2RrOiAnaHR0cHM6Ly9pbWFzZGsuZ29vZ2xlYXBpcy5jb20vanMvc2RrbG9hZGVyL2ltYTMuanMnLFxuICAgIH0sXG4gIH0sXG5cbiAgLy8gQ3VzdG9tIGNvbnRyb2wgbGlzdGVuZXJzXG4gIGxpc3RlbmVyczoge1xuICAgIHNlZWs6IG51bGwsXG4gICAgcGxheTogbnVsbCxcbiAgICBwYXVzZTogbnVsbCxcbiAgICByZXN0YXJ0OiBudWxsLFxuICAgIHJld2luZDogbnVsbCxcbiAgICBmYXN0Rm9yd2FyZDogbnVsbCxcbiAgICBtdXRlOiBudWxsLFxuICAgIHZvbHVtZTogbnVsbCxcbiAgICBjYXB0aW9uczogbnVsbCxcbiAgICBkb3dubG9hZDogbnVsbCxcbiAgICBmdWxsc2NyZWVuOiBudWxsLFxuICAgIHBpcDogbnVsbCxcbiAgICBhaXJwbGF5OiBudWxsLFxuICAgIHNwZWVkOiBudWxsLFxuICAgIHF1YWxpdHk6IG51bGwsXG4gICAgbG9vcDogbnVsbCxcbiAgICBsYW5ndWFnZTogbnVsbCxcbiAgfSxcblxuICAvLyBFdmVudHMgdG8gd2F0Y2ggYW5kIGJ1YmJsZVxuICBldmVudHM6IFtcbiAgICAvLyBFdmVudHMgdG8gd2F0Y2ggb24gSFRNTDUgbWVkaWEgZWxlbWVudHMgYW5kIGJ1YmJsZVxuICAgIC8vIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuL2RvY3MvV2ViL0d1aWRlL0V2ZW50cy9NZWRpYV9ldmVudHNcbiAgICAnZW5kZWQnLFxuICAgICdwcm9ncmVzcycsXG4gICAgJ3N0YWxsZWQnLFxuICAgICdwbGF5aW5nJyxcbiAgICAnd2FpdGluZycsXG4gICAgJ2NhbnBsYXknLFxuICAgICdjYW5wbGF5dGhyb3VnaCcsXG4gICAgJ2xvYWRzdGFydCcsXG4gICAgJ2xvYWRlZGRhdGEnLFxuICAgICdsb2FkZWRtZXRhZGF0YScsXG4gICAgJ3RpbWV1cGRhdGUnLFxuICAgICd2b2x1bWVjaGFuZ2UnLFxuICAgICdwbGF5JyxcbiAgICAncGF1c2UnLFxuICAgICdlcnJvcicsXG4gICAgJ3NlZWtpbmcnLFxuICAgICdzZWVrZWQnLFxuICAgICdlbXB0aWVkJyxcbiAgICAncmF0ZWNoYW5nZScsXG4gICAgJ2N1ZWNoYW5nZScsXG5cbiAgICAvLyBDdXN0b20gZXZlbnRzXG4gICAgJ2Rvd25sb2FkJyxcbiAgICAnZW50ZXJmdWxsc2NyZWVuJyxcbiAgICAnZXhpdGZ1bGxzY3JlZW4nLFxuICAgICdjYXB0aW9uc2VuYWJsZWQnLFxuICAgICdjYXB0aW9uc2Rpc2FibGVkJyxcbiAgICAnbGFuZ3VhZ2VjaGFuZ2UnLFxuICAgICdjb250cm9sc2hpZGRlbicsXG4gICAgJ2NvbnRyb2xzc2hvd24nLFxuICAgICdyZWFkeScsXG5cbiAgICAvLyBZb3VUdWJlXG4gICAgJ3N0YXRlY2hhbmdlJyxcblxuICAgIC8vIFF1YWxpdHlcbiAgICAncXVhbGl0eWNoYW5nZScsXG5cbiAgICAvLyBBZHNcbiAgICAnYWRzbG9hZGVkJyxcbiAgICAnYWRzY29udGVudHBhdXNlJyxcbiAgICAnYWRzY29udGVudHJlc3VtZScsXG4gICAgJ2Fkc3RhcnRlZCcsXG4gICAgJ2Fkc21pZHBvaW50JyxcbiAgICAnYWRzY29tcGxldGUnLFxuICAgICdhZHNhbGxjb21wbGV0ZScsXG4gICAgJ2Fkc2ltcHJlc3Npb24nLFxuICAgICdhZHNjbGljaycsXG4gIF0sXG5cbiAgLy8gU2VsZWN0b3JzXG4gIC8vIENoYW5nZSB0aGVzZSB0byBtYXRjaCB5b3VyIHRlbXBsYXRlIGlmIHVzaW5nIGN1c3RvbSBIVE1MXG4gIHNlbGVjdG9yczoge1xuICAgIGVkaXRhYmxlOiAnaW5wdXQsIHRleHRhcmVhLCBzZWxlY3QsIFtjb250ZW50ZWRpdGFibGVdJyxcbiAgICBjb250YWluZXI6ICcucGx5cicsXG4gICAgY29udHJvbHM6IHtcbiAgICAgIGNvbnRhaW5lcjogbnVsbCxcbiAgICAgIHdyYXBwZXI6ICcucGx5cl9fY29udHJvbHMnLFxuICAgIH0sXG4gICAgbGFiZWxzOiAnW2RhdGEtcGx5cl0nLFxuICAgIGJ1dHRvbnM6IHtcbiAgICAgIHBsYXk6ICdbZGF0YS1wbHlyPVwicGxheVwiXScsXG4gICAgICBwYXVzZTogJ1tkYXRhLXBseXI9XCJwYXVzZVwiXScsXG4gICAgICByZXN0YXJ0OiAnW2RhdGEtcGx5cj1cInJlc3RhcnRcIl0nLFxuICAgICAgcmV3aW5kOiAnW2RhdGEtcGx5cj1cInJld2luZFwiXScsXG4gICAgICBmYXN0Rm9yd2FyZDogJ1tkYXRhLXBseXI9XCJmYXN0LWZvcndhcmRcIl0nLFxuICAgICAgbXV0ZTogJ1tkYXRhLXBseXI9XCJtdXRlXCJdJyxcbiAgICAgIGNhcHRpb25zOiAnW2RhdGEtcGx5cj1cImNhcHRpb25zXCJdJyxcbiAgICAgIGRvd25sb2FkOiAnW2RhdGEtcGx5cj1cImRvd25sb2FkXCJdJyxcbiAgICAgIGZ1bGxzY3JlZW46ICdbZGF0YS1wbHlyPVwiZnVsbHNjcmVlblwiXScsXG4gICAgICBwaXA6ICdbZGF0YS1wbHlyPVwicGlwXCJdJyxcbiAgICAgIGFpcnBsYXk6ICdbZGF0YS1wbHlyPVwiYWlycGxheVwiXScsXG4gICAgICBzZXR0aW5nczogJ1tkYXRhLXBseXI9XCJzZXR0aW5nc1wiXScsXG4gICAgICBsb29wOiAnW2RhdGEtcGx5cj1cImxvb3BcIl0nLFxuICAgIH0sXG4gICAgaW5wdXRzOiB7XG4gICAgICBzZWVrOiAnW2RhdGEtcGx5cj1cInNlZWtcIl0nLFxuICAgICAgdm9sdW1lOiAnW2RhdGEtcGx5cj1cInZvbHVtZVwiXScsXG4gICAgICBzcGVlZDogJ1tkYXRhLXBseXI9XCJzcGVlZFwiXScsXG4gICAgICBsYW5ndWFnZTogJ1tkYXRhLXBseXI9XCJsYW5ndWFnZVwiXScsXG4gICAgICBxdWFsaXR5OiAnW2RhdGEtcGx5cj1cInF1YWxpdHlcIl0nLFxuICAgIH0sXG4gICAgZGlzcGxheToge1xuICAgICAgY3VycmVudFRpbWU6ICcucGx5cl9fdGltZS0tY3VycmVudCcsXG4gICAgICBkdXJhdGlvbjogJy5wbHlyX190aW1lLS1kdXJhdGlvbicsXG4gICAgICBidWZmZXI6ICcucGx5cl9fcHJvZ3Jlc3NfX2J1ZmZlcicsXG4gICAgICBsb29wOiAnLnBseXJfX3Byb2dyZXNzX19sb29wJywgLy8gVXNlZCBsYXRlclxuICAgICAgdm9sdW1lOiAnLnBseXJfX3ZvbHVtZS0tZGlzcGxheScsXG4gICAgfSxcbiAgICBwcm9ncmVzczogJy5wbHlyX19wcm9ncmVzcycsXG4gICAgY2FwdGlvbnM6ICcucGx5cl9fY2FwdGlvbnMnLFxuICAgIGNhcHRpb246ICcucGx5cl9fY2FwdGlvbicsXG4gIH0sXG5cbiAgLy8gQ2xhc3MgaG9va3MgYWRkZWQgdG8gdGhlIHBsYXllciBpbiBkaWZmZXJlbnQgc3RhdGVzXG4gIGNsYXNzTmFtZXM6IHtcbiAgICB0eXBlOiAncGx5ci0tezB9JyxcbiAgICBwcm92aWRlcjogJ3BseXItLXswfScsXG4gICAgdmlkZW86ICdwbHlyX192aWRlby13cmFwcGVyJyxcbiAgICBlbWJlZDogJ3BseXJfX3ZpZGVvLWVtYmVkJyxcbiAgICB2aWRlb0ZpeGVkUmF0aW86ICdwbHlyX192aWRlby13cmFwcGVyLS1maXhlZC1yYXRpbycsXG4gICAgZW1iZWRDb250YWluZXI6ICdwbHlyX192aWRlby1lbWJlZF9fY29udGFpbmVyJyxcbiAgICBwb3N0ZXI6ICdwbHlyX19wb3N0ZXInLFxuICAgIHBvc3RlckVuYWJsZWQ6ICdwbHlyX19wb3N0ZXItZW5hYmxlZCcsXG4gICAgYWRzOiAncGx5cl9fYWRzJyxcbiAgICBjb250cm9sOiAncGx5cl9fY29udHJvbCcsXG4gICAgY29udHJvbFByZXNzZWQ6ICdwbHlyX19jb250cm9sLS1wcmVzc2VkJyxcbiAgICBwbGF5aW5nOiAncGx5ci0tcGxheWluZycsXG4gICAgcGF1c2VkOiAncGx5ci0tcGF1c2VkJyxcbiAgICBzdG9wcGVkOiAncGx5ci0tc3RvcHBlZCcsXG4gICAgbG9hZGluZzogJ3BseXItLWxvYWRpbmcnLFxuICAgIGhvdmVyOiAncGx5ci0taG92ZXInLFxuICAgIHRvb2x0aXA6ICdwbHlyX190b29sdGlwJyxcbiAgICBjdWVzOiAncGx5cl9fY3VlcycsXG4gICAgbWFya2VyOiAncGx5cl9fcHJvZ3Jlc3NfX21hcmtlcicsXG4gICAgaGlkZGVuOiAncGx5cl9fc3Itb25seScsXG4gICAgaGlkZUNvbnRyb2xzOiAncGx5ci0taGlkZS1jb250cm9scycsXG4gICAgaXNJb3M6ICdwbHlyLS1pcy1pb3MnLFxuICAgIGlzVG91Y2g6ICdwbHlyLS1pcy10b3VjaCcsXG4gICAgdWlTdXBwb3J0ZWQ6ICdwbHlyLS1mdWxsLXVpJyxcbiAgICBub1RyYW5zaXRpb246ICdwbHlyLS1uby10cmFuc2l0aW9uJyxcbiAgICBkaXNwbGF5OiB7XG4gICAgICB0aW1lOiAncGx5cl9fdGltZScsXG4gICAgfSxcbiAgICBtZW51OiB7XG4gICAgICB2YWx1ZTogJ3BseXJfX21lbnVfX3ZhbHVlJyxcbiAgICAgIGJhZGdlOiAncGx5cl9fYmFkZ2UnLFxuICAgICAgb3BlbjogJ3BseXItLW1lbnUtb3BlbicsXG4gICAgfSxcbiAgICBjYXB0aW9uczoge1xuICAgICAgZW5hYmxlZDogJ3BseXItLWNhcHRpb25zLWVuYWJsZWQnLFxuICAgICAgYWN0aXZlOiAncGx5ci0tY2FwdGlvbnMtYWN0aXZlJyxcbiAgICB9LFxuICAgIGZ1bGxzY3JlZW46IHtcbiAgICAgIGVuYWJsZWQ6ICdwbHlyLS1mdWxsc2NyZWVuLWVuYWJsZWQnLFxuICAgICAgZmFsbGJhY2s6ICdwbHlyLS1mdWxsc2NyZWVuLWZhbGxiYWNrJyxcbiAgICB9LFxuICAgIHBpcDoge1xuICAgICAgc3VwcG9ydGVkOiAncGx5ci0tcGlwLXN1cHBvcnRlZCcsXG4gICAgICBhY3RpdmU6ICdwbHlyLS1waXAtYWN0aXZlJyxcbiAgICB9LFxuICAgIGFpcnBsYXk6IHtcbiAgICAgIHN1cHBvcnRlZDogJ3BseXItLWFpcnBsYXktc3VwcG9ydGVkJyxcbiAgICAgIGFjdGl2ZTogJ3BseXItLWFpcnBsYXktYWN0aXZlJyxcbiAgICB9LFxuICAgIHRhYkZvY3VzOiAncGx5cl9fdGFiLWZvY3VzJyxcbiAgICBwcmV2aWV3VGh1bWJuYWlsczoge1xuICAgICAgLy8gVG9vbHRpcCB0aHVtYnNcbiAgICAgIHRodW1iQ29udGFpbmVyOiAncGx5cl9fcHJldmlldy10aHVtYicsXG4gICAgICB0aHVtYkNvbnRhaW5lclNob3duOiAncGx5cl9fcHJldmlldy10aHVtYi0taXMtc2hvd24nLFxuICAgICAgaW1hZ2VDb250YWluZXI6ICdwbHlyX19wcmV2aWV3LXRodW1iX19pbWFnZS1jb250YWluZXInLFxuICAgICAgdGltZUNvbnRhaW5lcjogJ3BseXJfX3ByZXZpZXctdGh1bWJfX3RpbWUtY29udGFpbmVyJyxcbiAgICAgIC8vIFNjcnViYmluZ1xuICAgICAgc2NydWJiaW5nQ29udGFpbmVyOiAncGx5cl9fcHJldmlldy1zY3J1YmJpbmcnLFxuICAgICAgc2NydWJiaW5nQ29udGFpbmVyU2hvd246ICdwbHlyX19wcmV2aWV3LXNjcnViYmluZy0taXMtc2hvd24nLFxuICAgIH0sXG4gIH0sXG5cbiAgLy8gRW1iZWQgYXR0cmlidXRlc1xuICBhdHRyaWJ1dGVzOiB7XG4gICAgZW1iZWQ6IHtcbiAgICAgIHByb3ZpZGVyOiAnZGF0YS1wbHlyLXByb3ZpZGVyJyxcbiAgICAgIGlkOiAnZGF0YS1wbHlyLWVtYmVkLWlkJyxcbiAgICAgIGhhc2g6ICdkYXRhLXBseXItZW1iZWQtaGFzaCcsXG4gICAgfSxcbiAgfSxcblxuICAvLyBBZHZlcnRpc2VtZW50cyBwbHVnaW5cbiAgLy8gUmVnaXN0ZXIgZm9yIGFuIGFjY291bnQgaGVyZTogaHR0cDovL3ZpLmFpL3B1Ymxpc2hlci12aWRlby1tb25ldGl6YXRpb24vP2FpZD1wbHlyaW9cbiAgYWRzOiB7XG4gICAgZW5hYmxlZDogZmFsc2UsXG4gICAgcHVibGlzaGVySWQ6ICcnLFxuICAgIHRhZ1VybDogJycsXG4gIH0sXG5cbiAgLy8gUHJldmlldyBUaHVtYm5haWxzIHBsdWdpblxuICBwcmV2aWV3VGh1bWJuYWlsczoge1xuICAgIGVuYWJsZWQ6IGZhbHNlLFxuICAgIHNyYzogJycsXG4gIH0sXG5cbiAgLy8gVmltZW8gcGx1Z2luXG4gIHZpbWVvOiB7XG4gICAgYnlsaW5lOiBmYWxzZSxcbiAgICBwb3J0cmFpdDogZmFsc2UsXG4gICAgdGl0bGU6IGZhbHNlLFxuICAgIHNwZWVkOiB0cnVlLFxuICAgIHRyYW5zcGFyZW50OiBmYWxzZSxcbiAgICAvLyBDdXN0b20gc2V0dGluZ3MgZnJvbSBQbHlyXG4gICAgY3VzdG9tQ29udHJvbHM6IHRydWUsXG4gICAgcmVmZXJyZXJQb2xpY3k6IG51bGwsIC8vIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9IVE1MSUZyYW1lRWxlbWVudC9yZWZlcnJlclBvbGljeVxuICAgIC8vIFdoZXRoZXIgdGhlIG93bmVyIG9mIHRoZSB2aWRlbyBoYXMgYSBQcm8gb3IgQnVzaW5lc3MgYWNjb3VudFxuICAgIC8vICh3aGljaCBhbGxvd3MgdXMgdG8gcHJvcGVybHkgaGlkZSBjb250cm9scyB3aXRob3V0IENTUyBoYWNrcywgZXRjKVxuICAgIHByZW1pdW06IGZhbHNlLFxuICB9LFxuXG4gIC8vIFlvdVR1YmUgcGx1Z2luXG4gIHlvdXR1YmU6IHtcbiAgICByZWw6IDAsIC8vIE5vIHJlbGF0ZWQgdmlkc1xuICAgIHNob3dpbmZvOiAwLCAvLyBIaWRlIGluZm9cbiAgICBpdl9sb2FkX3BvbGljeTogMywgLy8gSGlkZSBhbm5vdGF0aW9uc1xuICAgIG1vZGVzdGJyYW5kaW5nOiAxLCAvLyBIaWRlIGxvZ29zIGFzIG11Y2ggYXMgcG9zc2libGUgKHRoZXkgc3RpbGwgc2hvdyBvbmUgaW4gdGhlIGNvcm5lciB3aGVuIHBhdXNlZClcbiAgICAvLyBDdXN0b20gc2V0dGluZ3MgZnJvbSBQbHlyXG4gICAgY3VzdG9tQ29udHJvbHM6IHRydWUsXG4gICAgbm9Db29raWU6IGZhbHNlLCAvLyBXaGV0aGVyIHRvIHVzZSBhbiBhbHRlcm5hdGl2ZSB2ZXJzaW9uIG9mIFlvdVR1YmUgd2l0aG91dCBjb29raWVzXG4gIH0sXG5cbiAgLy8gTWVkaWEgTWV0YWRhdGFcbiAgbWVkaWFNZXRhZGF0YToge1xuICAgIHRpdGxlOiAnJyxcbiAgICBhcnRpc3Q6ICcnLFxuICAgIGFsYnVtOiAnJyxcbiAgICBhcnR3b3JrOiBbXSxcbiAgfSxcblxuICAvLyBNYXJrZXJzXG4gIG1hcmtlcnM6IHtcbiAgICBlbmFibGVkOiBmYWxzZSxcbiAgICBwb2ludHM6IFtdLFxuICB9LFxufTtcblxuZXhwb3J0IGRlZmF1bHQgZGVmYXVsdHM7XG4iLCIvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUGx5ciBzdGF0ZXNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBjb25zdCBwaXAgPSB7XG4gIGFjdGl2ZTogJ3BpY3R1cmUtaW4tcGljdHVyZScsXG4gIGluYWN0aXZlOiAnaW5saW5lJyxcbn07XG5cbmV4cG9ydCBkZWZhdWx0IHsgcGlwIH07XG4iLCIvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUGx5ciBzdXBwb3J0ZWQgdHlwZXMgYW5kIHByb3ZpZGVyc1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGNvbnN0IHByb3ZpZGVycyA9IHtcbiAgaHRtbDU6ICdodG1sNScsXG4gIHlvdXR1YmU6ICd5b3V0dWJlJyxcbiAgdmltZW86ICd2aW1lbycsXG59O1xuXG5leHBvcnQgY29uc3QgdHlwZXMgPSB7XG4gIGF1ZGlvOiAnYXVkaW8nLFxuICB2aWRlbzogJ3ZpZGVvJyxcbn07XG5cbi8qKlxuICogR2V0IHByb3ZpZGVyIGJ5IFVSTFxuICogQHBhcmFtIHtTdHJpbmd9IHVybFxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0UHJvdmlkZXJCeVVybCh1cmwpIHtcbiAgLy8gWW91VHViZVxuICBpZiAoL14oaHR0cHM/OlxcL1xcLyk/KHd3d1xcLik/KHlvdXR1YmVcXC5jb218eW91dHViZS1ub2Nvb2tpZVxcLmNvbXx5b3V0dVxcLj9iZSlcXC8uKyQvLnRlc3QodXJsKSkge1xuICAgIHJldHVybiBwcm92aWRlcnMueW91dHViZTtcbiAgfVxuXG4gIC8vIFZpbWVvXG4gIGlmICgvXmh0dHBzPzpcXC9cXC9wbGF5ZXIudmltZW8uY29tXFwvdmlkZW9cXC9cXGR7MCw5fSg/PVxcYnxcXC8pLy50ZXN0KHVybCkpIHtcbiAgICByZXR1cm4gcHJvdmlkZXJzLnZpbWVvO1xuICB9XG5cbiAgcmV0dXJuIG51bGw7XG59XG5cbmV4cG9ydCBkZWZhdWx0IHsgcHJvdmlkZXJzLCB0eXBlcyB9O1xuIiwiLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIENvbnNvbGUgd3JhcHBlclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuY29uc3Qgbm9vcCA9ICgpID0+IHt9O1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBDb25zb2xlIHtcbiAgY29uc3RydWN0b3IoZW5hYmxlZCA9IGZhbHNlKSB7XG4gICAgdGhpcy5lbmFibGVkID0gd2luZG93LmNvbnNvbGUgJiYgZW5hYmxlZDtcblxuICAgIGlmICh0aGlzLmVuYWJsZWQpIHtcbiAgICAgIHRoaXMubG9nKCdEZWJ1Z2dpbmcgZW5hYmxlZCcpO1xuICAgIH1cbiAgfVxuXG4gIGdldCBsb2coKSB7XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNvbnNvbGVcbiAgICByZXR1cm4gdGhpcy5lbmFibGVkID8gRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQuY2FsbChjb25zb2xlLmxvZywgY29uc29sZSkgOiBub29wO1xuICB9XG5cbiAgZ2V0IHdhcm4oKSB7XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNvbnNvbGVcbiAgICByZXR1cm4gdGhpcy5lbmFibGVkID8gRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQuY2FsbChjb25zb2xlLndhcm4sIGNvbnNvbGUpIDogbm9vcDtcbiAgfVxuXG4gIGdldCBlcnJvcigpIHtcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uc29sZVxuICAgIHJldHVybiB0aGlzLmVuYWJsZWQgPyBGdW5jdGlvbi5wcm90b3R5cGUuYmluZC5jYWxsKGNvbnNvbGUuZXJyb3IsIGNvbnNvbGUpIDogbm9vcDtcbiAgfVxufVxuIiwiLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEZ1bGxzY3JlZW4gd3JhcHBlclxuLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL0Z1bGxzY3JlZW5fQVBJI3ByZWZpeGluZ1xuLy8gaHR0cHM6Ly93ZWJraXQub3JnL2Jsb2cvNzkyOS9kZXNpZ25pbmctd2Vic2l0ZXMtZm9yLWlwaG9uZS14L1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuaW1wb3J0IGJyb3dzZXIgZnJvbSAnLi91dGlscy9icm93c2VyJztcbmltcG9ydCB7IGNsb3Nlc3QsIGdldEVsZW1lbnRzLCBoYXNDbGFzcywgdG9nZ2xlQ2xhc3MgfSBmcm9tICcuL3V0aWxzL2VsZW1lbnRzJztcbmltcG9ydCB7IG9uLCB0cmlnZ2VyRXZlbnQgfSBmcm9tICcuL3V0aWxzL2V2ZW50cyc7XG5pbXBvcnQgaXMgZnJvbSAnLi91dGlscy9pcyc7XG5pbXBvcnQgeyBzaWxlbmNlUHJvbWlzZSB9IGZyb20gJy4vdXRpbHMvcHJvbWlzZSc7XG5cbmNsYXNzIEZ1bGxzY3JlZW4ge1xuICBjb25zdHJ1Y3RvcihwbGF5ZXIpIHtcbiAgICAvLyBLZWVwIHJlZmVyZW5jZSB0byBwYXJlbnRcbiAgICB0aGlzLnBsYXllciA9IHBsYXllcjtcblxuICAgIC8vIEdldCBwcmVmaXhcbiAgICB0aGlzLnByZWZpeCA9IEZ1bGxzY3JlZW4ucHJlZml4O1xuICAgIHRoaXMucHJvcGVydHkgPSBGdWxsc2NyZWVuLnByb3BlcnR5O1xuXG4gICAgLy8gU2Nyb2xsIHBvc2l0aW9uXG4gICAgdGhpcy5zY3JvbGxQb3NpdGlvbiA9IHsgeDogMCwgeTogMCB9O1xuXG4gICAgLy8gRm9yY2UgdGhlIHVzZSBvZiAnZnVsbCB3aW5kb3cvYnJvd3NlcicgcmF0aGVyIHRoYW4gZnVsbHNjcmVlblxuICAgIHRoaXMuZm9yY2VGYWxsYmFjayA9IHBsYXllci5jb25maWcuZnVsbHNjcmVlbi5mYWxsYmFjayA9PT0gJ2ZvcmNlJztcblxuICAgIC8vIEdldCB0aGUgZnVsbHNjcmVlbiBlbGVtZW50XG4gICAgLy8gQ2hlY2tzIGNvbnRhaW5lciBpcyBhbiBhbmNlc3RvciwgZGVmYXVsdHMgdG8gbnVsbFxuICAgIHRoaXMucGxheWVyLmVsZW1lbnRzLmZ1bGxzY3JlZW4gPVxuICAgICAgcGxheWVyLmNvbmZpZy5mdWxsc2NyZWVuLmNvbnRhaW5lciAmJiBjbG9zZXN0KHRoaXMucGxheWVyLmVsZW1lbnRzLmNvbnRhaW5lciwgcGxheWVyLmNvbmZpZy5mdWxsc2NyZWVuLmNvbnRhaW5lcik7XG5cbiAgICAvLyBSZWdpc3RlciBldmVudCBsaXN0ZW5lcnNcbiAgICAvLyBIYW5kbGUgZXZlbnQgKGluY2FzZSB1c2VyIHByZXNzZXMgZXNjYXBlIGV0YylcbiAgICBvbi5jYWxsKFxuICAgICAgdGhpcy5wbGF5ZXIsXG4gICAgICBkb2N1bWVudCxcbiAgICAgIHRoaXMucHJlZml4ID09PSAnbXMnID8gJ01TRnVsbHNjcmVlbkNoYW5nZScgOiBgJHt0aGlzLnByZWZpeH1mdWxsc2NyZWVuY2hhbmdlYCxcbiAgICAgICgpID0+IHtcbiAgICAgICAgLy8gVE9ETzogRmlsdGVyIGZvciB0YXJnZXQ/P1xuICAgICAgICB0aGlzLm9uQ2hhbmdlKCk7XG4gICAgICB9LFxuICAgICk7XG5cbiAgICAvLyBGdWxsc2NyZWVuIHRvZ2dsZSBvbiBkb3VibGUgY2xpY2tcbiAgICBvbi5jYWxsKHRoaXMucGxheWVyLCB0aGlzLnBsYXllci5lbGVtZW50cy5jb250YWluZXIsICdkYmxjbGljaycsIChldmVudCkgPT4ge1xuICAgICAgLy8gSWdub3JlIGRvdWJsZSBjbGljayBpbiBjb250cm9sc1xuICAgICAgaWYgKGlzLmVsZW1lbnQodGhpcy5wbGF5ZXIuZWxlbWVudHMuY29udHJvbHMpICYmIHRoaXMucGxheWVyLmVsZW1lbnRzLmNvbnRyb2xzLmNvbnRhaW5zKGV2ZW50LnRhcmdldCkpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICB0aGlzLnBsYXllci5saXN0ZW5lcnMucHJveHkoZXZlbnQsIHRoaXMudG9nZ2xlLCAnZnVsbHNjcmVlbicpO1xuICAgIH0pO1xuXG4gICAgLy8gVGFwIGZvY3VzIHdoZW4gaW4gZnVsbHNjcmVlblxuICAgIG9uLmNhbGwodGhpcywgdGhpcy5wbGF5ZXIuZWxlbWVudHMuY29udGFpbmVyLCAna2V5ZG93bicsIChldmVudCkgPT4gdGhpcy50cmFwRm9jdXMoZXZlbnQpKTtcblxuICAgIC8vIFVwZGF0ZSB0aGUgVUlcbiAgICB0aGlzLnVwZGF0ZSgpO1xuXG4gICAgLy8gdGhpcy50b2dnbGUgPSB0aGlzLnRvZ2dsZS5iaW5kKHRoaXMpO1xuICB9XG5cbiAgLy8gRGV0ZXJtaW5lIGlmIG5hdGl2ZSBzdXBwb3J0ZWRcbiAgc3RhdGljIGdldCBuYXRpdmUoKSB7XG4gICAgcmV0dXJuICEhKFxuICAgICAgZG9jdW1lbnQuZnVsbHNjcmVlbkVuYWJsZWQgfHxcbiAgICAgIGRvY3VtZW50LndlYmtpdEZ1bGxzY3JlZW5FbmFibGVkIHx8XG4gICAgICBkb2N1bWVudC5tb3pGdWxsU2NyZWVuRW5hYmxlZCB8fFxuICAgICAgZG9jdW1lbnQubXNGdWxsc2NyZWVuRW5hYmxlZFxuICAgICk7XG4gIH1cblxuICAvLyBJZiB3ZSdyZSBhY3R1YWxseSB1c2luZyBuYXRpdmVcbiAgZ2V0IHVzaW5nTmF0aXZlKCkge1xuICAgIHJldHVybiBGdWxsc2NyZWVuLm5hdGl2ZSAmJiAhdGhpcy5mb3JjZUZhbGxiYWNrO1xuICB9XG5cbiAgLy8gR2V0IHRoZSBwcmVmaXggZm9yIGhhbmRsZXJzXG4gIHN0YXRpYyBnZXQgcHJlZml4KCkge1xuICAgIC8vIE5vIHByZWZpeFxuICAgIGlmIChpcy5mdW5jdGlvbihkb2N1bWVudC5leGl0RnVsbHNjcmVlbikpIHtcbiAgICAgIHJldHVybiAnJztcbiAgICB9XG5cbiAgICAvLyBDaGVjayBmb3IgZnVsbHNjcmVlbiBzdXBwb3J0IGJ5IHZlbmRvciBwcmVmaXhcbiAgICBsZXQgdmFsdWUgPSAnJztcbiAgICBjb25zdCBwcmVmaXhlcyA9IFsnd2Via2l0JywgJ21veicsICdtcyddO1xuXG4gICAgcHJlZml4ZXMuc29tZSgocHJlKSA9PiB7XG4gICAgICBpZiAoaXMuZnVuY3Rpb24oZG9jdW1lbnRbYCR7cHJlfUV4aXRGdWxsc2NyZWVuYF0pIHx8IGlzLmZ1bmN0aW9uKGRvY3VtZW50W2Ake3ByZX1DYW5jZWxGdWxsU2NyZWVuYF0pKSB7XG4gICAgICAgIHZhbHVlID0gcHJlO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIHZhbHVlO1xuICB9XG5cbiAgc3RhdGljIGdldCBwcm9wZXJ0eSgpIHtcbiAgICByZXR1cm4gdGhpcy5wcmVmaXggPT09ICdtb3onID8gJ0Z1bGxTY3JlZW4nIDogJ0Z1bGxzY3JlZW4nO1xuICB9XG5cbiAgLy8gRGV0ZXJtaW5lIGlmIGZ1bGxzY3JlZW4gaXMgZW5hYmxlZFxuICBnZXQgZW5hYmxlZCgpIHtcbiAgICByZXR1cm4gKFxuICAgICAgKEZ1bGxzY3JlZW4ubmF0aXZlIHx8IHRoaXMucGxheWVyLmNvbmZpZy5mdWxsc2NyZWVuLmZhbGxiYWNrKSAmJlxuICAgICAgdGhpcy5wbGF5ZXIuY29uZmlnLmZ1bGxzY3JlZW4uZW5hYmxlZCAmJlxuICAgICAgdGhpcy5wbGF5ZXIuc3VwcG9ydGVkLnVpICYmXG4gICAgICB0aGlzLnBsYXllci5pc1ZpZGVvXG4gICAgKTtcbiAgfVxuXG4gIC8vIEdldCBhY3RpdmUgc3RhdGVcbiAgZ2V0IGFjdGl2ZSgpIHtcbiAgICBpZiAoIXRoaXMuZW5hYmxlZCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8vIEZhbGxiYWNrIHVzaW5nIGNsYXNzbmFtZVxuICAgIGlmICghRnVsbHNjcmVlbi5uYXRpdmUgfHwgdGhpcy5mb3JjZUZhbGxiYWNrKSB7XG4gICAgICByZXR1cm4gaGFzQ2xhc3ModGhpcy50YXJnZXQsIHRoaXMucGxheWVyLmNvbmZpZy5jbGFzc05hbWVzLmZ1bGxzY3JlZW4uZmFsbGJhY2spO1xuICAgIH1cblxuICAgIGNvbnN0IGVsZW1lbnQgPSAhdGhpcy5wcmVmaXhcbiAgICAgID8gdGhpcy50YXJnZXQuZ2V0Um9vdE5vZGUoKS5mdWxsc2NyZWVuRWxlbWVudFxuICAgICAgOiB0aGlzLnRhcmdldC5nZXRSb290Tm9kZSgpW2Ake3RoaXMucHJlZml4fSR7dGhpcy5wcm9wZXJ0eX1FbGVtZW50YF07XG5cbiAgICByZXR1cm4gZWxlbWVudCAmJiBlbGVtZW50LnNoYWRvd1Jvb3QgPyBlbGVtZW50ID09PSB0aGlzLnRhcmdldC5nZXRSb290Tm9kZSgpLmhvc3QgOiBlbGVtZW50ID09PSB0aGlzLnRhcmdldDtcbiAgfVxuXG4gIC8vIEdldCB0YXJnZXQgZWxlbWVudFxuICBnZXQgdGFyZ2V0KCkge1xuICAgIHJldHVybiBicm93c2VyLmlzSW9zICYmIHRoaXMucGxheWVyLmNvbmZpZy5mdWxsc2NyZWVuLmlvc05hdGl2ZVxuICAgICAgPyB0aGlzLnBsYXllci5tZWRpYVxuICAgICAgOiB0aGlzLnBsYXllci5lbGVtZW50cy5mdWxsc2NyZWVuIHx8IHRoaXMucGxheWVyLmVsZW1lbnRzLmNvbnRhaW5lcjtcbiAgfVxuXG4gIG9uQ2hhbmdlID0gKCkgPT4ge1xuICAgIGlmICghdGhpcy5lbmFibGVkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gVXBkYXRlIHRvZ2dsZSBidXR0b25cbiAgICBjb25zdCBidXR0b24gPSB0aGlzLnBsYXllci5lbGVtZW50cy5idXR0b25zLmZ1bGxzY3JlZW47XG4gICAgaWYgKGlzLmVsZW1lbnQoYnV0dG9uKSkge1xuICAgICAgYnV0dG9uLnByZXNzZWQgPSB0aGlzLmFjdGl2ZTtcbiAgICB9XG5cbiAgICAvLyBBbHdheXMgdHJpZ2dlciBldmVudHMgb24gdGhlIHBseXIgLyBtZWRpYSBlbGVtZW50IChub3QgYSBmdWxsc2NyZWVuIGNvbnRhaW5lcikgYW5kIGxldCB0aGVtIGJ1YmJsZSB1cFxuICAgIGNvbnN0IHRhcmdldCA9IHRoaXMudGFyZ2V0ID09PSB0aGlzLnBsYXllci5tZWRpYSA/IHRoaXMudGFyZ2V0IDogdGhpcy5wbGF5ZXIuZWxlbWVudHMuY29udGFpbmVyO1xuICAgIC8vIFRyaWdnZXIgYW4gZXZlbnRcbiAgICB0cmlnZ2VyRXZlbnQuY2FsbCh0aGlzLnBsYXllciwgdGFyZ2V0LCB0aGlzLmFjdGl2ZSA/ICdlbnRlcmZ1bGxzY3JlZW4nIDogJ2V4aXRmdWxsc2NyZWVuJywgdHJ1ZSk7XG4gIH07XG5cbiAgdG9nZ2xlRmFsbGJhY2sgPSAodG9nZ2xlID0gZmFsc2UpID0+IHtcbiAgICAvLyBTdG9yZSBvciByZXN0b3JlIHNjcm9sbCBwb3NpdGlvblxuICAgIGlmICh0b2dnbGUpIHtcbiAgICAgIHRoaXMuc2Nyb2xsUG9zaXRpb24gPSB7XG4gICAgICAgIHg6IHdpbmRvdy5zY3JvbGxYIHx8IDAsXG4gICAgICAgIHk6IHdpbmRvdy5zY3JvbGxZIHx8IDAsXG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICB3aW5kb3cuc2Nyb2xsVG8odGhpcy5zY3JvbGxQb3NpdGlvbi54LCB0aGlzLnNjcm9sbFBvc2l0aW9uLnkpO1xuICAgIH1cblxuICAgIC8vIFRvZ2dsZSBzY3JvbGxcbiAgICBkb2N1bWVudC5ib2R5LnN0eWxlLm92ZXJmbG93ID0gdG9nZ2xlID8gJ2hpZGRlbicgOiAnJztcblxuICAgIC8vIFRvZ2dsZSBjbGFzcyBob29rXG4gICAgdG9nZ2xlQ2xhc3ModGhpcy50YXJnZXQsIHRoaXMucGxheWVyLmNvbmZpZy5jbGFzc05hbWVzLmZ1bGxzY3JlZW4uZmFsbGJhY2ssIHRvZ2dsZSk7XG5cbiAgICAvLyBGb3JjZSBmdWxsIHZpZXdwb3J0IG9uIGlQaG9uZSBYK1xuICAgIGlmIChicm93c2VyLmlzSW9zKSB7XG4gICAgICBsZXQgdmlld3BvcnQgPSBkb2N1bWVudC5oZWFkLnF1ZXJ5U2VsZWN0b3IoJ21ldGFbbmFtZT1cInZpZXdwb3J0XCJdJyk7XG4gICAgICBjb25zdCBwcm9wZXJ0eSA9ICd2aWV3cG9ydC1maXQ9Y292ZXInO1xuXG4gICAgICAvLyBJbmplY3QgdGhlIHZpZXdwb3J0IG1ldGEgaWYgcmVxdWlyZWRcbiAgICAgIGlmICghdmlld3BvcnQpIHtcbiAgICAgICAgdmlld3BvcnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdtZXRhJyk7XG4gICAgICAgIHZpZXdwb3J0LnNldEF0dHJpYnV0ZSgnbmFtZScsICd2aWV3cG9ydCcpO1xuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayBpZiB0aGUgcHJvcGVydHkgYWxyZWFkeSBleGlzdHNcbiAgICAgIGNvbnN0IGhhc1Byb3BlcnR5ID0gaXMuc3RyaW5nKHZpZXdwb3J0LmNvbnRlbnQpICYmIHZpZXdwb3J0LmNvbnRlbnQuaW5jbHVkZXMocHJvcGVydHkpO1xuXG4gICAgICBpZiAodG9nZ2xlKSB7XG4gICAgICAgIHRoaXMuY2xlYW51cFZpZXdwb3J0ID0gIWhhc1Byb3BlcnR5O1xuXG4gICAgICAgIGlmICghaGFzUHJvcGVydHkpIHtcbiAgICAgICAgICB2aWV3cG9ydC5jb250ZW50ICs9IGAsJHtwcm9wZXJ0eX1gO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKHRoaXMuY2xlYW51cFZpZXdwb3J0KSB7XG4gICAgICAgIHZpZXdwb3J0LmNvbnRlbnQgPSB2aWV3cG9ydC5jb250ZW50XG4gICAgICAgICAgLnNwbGl0KCcsJylcbiAgICAgICAgICAuZmlsdGVyKChwYXJ0KSA9PiBwYXJ0LnRyaW0oKSAhPT0gcHJvcGVydHkpXG4gICAgICAgICAgLmpvaW4oJywnKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBUb2dnbGUgYnV0dG9uIGFuZCBmaXJlIGV2ZW50c1xuICAgIHRoaXMub25DaGFuZ2UoKTtcbiAgfTtcblxuICAvLyBUcmFwIGZvY3VzIGluc2lkZSBjb250YWluZXJcbiAgdHJhcEZvY3VzID0gKGV2ZW50KSA9PiB7XG4gICAgLy8gQmFpbCBpZiBpT1MsIG5vdCBhY3RpdmUsIG5vdCB0aGUgdGFiIGtleVxuICAgIGlmIChicm93c2VyLmlzSW9zIHx8ICF0aGlzLmFjdGl2ZSB8fCBldmVudC5rZXkgIT09ICdUYWInKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gR2V0IHRoZSBjdXJyZW50IGZvY3VzZWQgZWxlbWVudFxuICAgIGNvbnN0IGZvY3VzZWQgPSBkb2N1bWVudC5hY3RpdmVFbGVtZW50O1xuICAgIGNvbnN0IGZvY3VzYWJsZSA9IGdldEVsZW1lbnRzLmNhbGwodGhpcy5wbGF5ZXIsICdhW2hyZWZdLCBidXR0b246bm90KDpkaXNhYmxlZCksIGlucHV0Om5vdCg6ZGlzYWJsZWQpLCBbdGFiaW5kZXhdJyk7XG4gICAgY29uc3QgW2ZpcnN0XSA9IGZvY3VzYWJsZTtcbiAgICBjb25zdCBsYXN0ID0gZm9jdXNhYmxlW2ZvY3VzYWJsZS5sZW5ndGggLSAxXTtcblxuICAgIGlmIChmb2N1c2VkID09PSBsYXN0ICYmICFldmVudC5zaGlmdEtleSkge1xuICAgICAgLy8gTW92ZSBmb2N1cyB0byBmaXJzdCBlbGVtZW50IHRoYXQgY2FuIGJlIHRhYmJlZCBpZiBTaGlmdCBpc24ndCB1c2VkXG4gICAgICBmaXJzdC5mb2N1cygpO1xuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICB9IGVsc2UgaWYgKGZvY3VzZWQgPT09IGZpcnN0ICYmIGV2ZW50LnNoaWZ0S2V5KSB7XG4gICAgICAvLyBNb3ZlIGZvY3VzIHRvIGxhc3QgZWxlbWVudCB0aGF0IGNhbiBiZSB0YWJiZWQgaWYgU2hpZnQgaXMgdXNlZFxuICAgICAgbGFzdC5mb2N1cygpO1xuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICB9XG4gIH07XG5cbiAgLy8gVXBkYXRlIFVJXG4gIHVwZGF0ZSA9ICgpID0+IHtcbiAgICBpZiAodGhpcy5lbmFibGVkKSB7XG4gICAgICBsZXQgbW9kZTtcblxuICAgICAgaWYgKHRoaXMuZm9yY2VGYWxsYmFjaykge1xuICAgICAgICBtb2RlID0gJ0ZhbGxiYWNrIChmb3JjZWQpJztcbiAgICAgIH0gZWxzZSBpZiAoRnVsbHNjcmVlbi5uYXRpdmUpIHtcbiAgICAgICAgbW9kZSA9ICdOYXRpdmUnO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbW9kZSA9ICdGYWxsYmFjayc7XG4gICAgICB9XG5cbiAgICAgIHRoaXMucGxheWVyLmRlYnVnLmxvZyhgJHttb2RlfSBmdWxsc2NyZWVuIGVuYWJsZWRgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5wbGF5ZXIuZGVidWcubG9nKCdGdWxsc2NyZWVuIG5vdCBzdXBwb3J0ZWQgYW5kIGZhbGxiYWNrIGRpc2FibGVkJyk7XG4gICAgfVxuXG4gICAgLy8gQWRkIHN0eWxpbmcgaG9vayB0byBzaG93IGJ1dHRvblxuICAgIHRvZ2dsZUNsYXNzKHRoaXMucGxheWVyLmVsZW1lbnRzLmNvbnRhaW5lciwgdGhpcy5wbGF5ZXIuY29uZmlnLmNsYXNzTmFtZXMuZnVsbHNjcmVlbi5lbmFibGVkLCB0aGlzLmVuYWJsZWQpO1xuICB9O1xuXG4gIC8vIE1ha2UgYW4gZWxlbWVudCBmdWxsc2NyZWVuXG4gIGVudGVyID0gKCkgPT4ge1xuICAgIGlmICghdGhpcy5lbmFibGVkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gaU9TIG5hdGl2ZSBmdWxsc2NyZWVuIGRvZXNuJ3QgbmVlZCB0aGUgcmVxdWVzdCBzdGVwXG4gICAgaWYgKGJyb3dzZXIuaXNJb3MgJiYgdGhpcy5wbGF5ZXIuY29uZmlnLmZ1bGxzY3JlZW4uaW9zTmF0aXZlKSB7XG4gICAgICBpZiAodGhpcy5wbGF5ZXIuaXNWaW1lbykge1xuICAgICAgICB0aGlzLnBsYXllci5lbWJlZC5yZXF1ZXN0RnVsbHNjcmVlbigpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy50YXJnZXQud2Via2l0RW50ZXJGdWxsc2NyZWVuKCk7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmICghRnVsbHNjcmVlbi5uYXRpdmUgfHwgdGhpcy5mb3JjZUZhbGxiYWNrKSB7XG4gICAgICB0aGlzLnRvZ2dsZUZhbGxiYWNrKHRydWUpO1xuICAgIH0gZWxzZSBpZiAoIXRoaXMucHJlZml4KSB7XG4gICAgICB0aGlzLnRhcmdldC5yZXF1ZXN0RnVsbHNjcmVlbih7IG5hdmlnYXRpb25VSTogJ2hpZGUnIH0pO1xuICAgIH0gZWxzZSBpZiAoIWlzLmVtcHR5KHRoaXMucHJlZml4KSkge1xuICAgICAgdGhpcy50YXJnZXRbYCR7dGhpcy5wcmVmaXh9UmVxdWVzdCR7dGhpcy5wcm9wZXJ0eX1gXSgpO1xuICAgIH1cbiAgfTtcblxuICAvLyBCYWlsIGZyb20gZnVsbHNjcmVlblxuICBleGl0ID0gKCkgPT4ge1xuICAgIGlmICghdGhpcy5lbmFibGVkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gaU9TIG5hdGl2ZSBmdWxsc2NyZWVuXG4gICAgaWYgKGJyb3dzZXIuaXNJb3MgJiYgdGhpcy5wbGF5ZXIuY29uZmlnLmZ1bGxzY3JlZW4uaW9zTmF0aXZlKSB7XG4gICAgICB0aGlzLnRhcmdldC53ZWJraXRFeGl0RnVsbHNjcmVlbigpO1xuICAgICAgc2lsZW5jZVByb21pc2UodGhpcy5wbGF5ZXIucGxheSgpKTtcbiAgICB9IGVsc2UgaWYgKCFGdWxsc2NyZWVuLm5hdGl2ZSB8fCB0aGlzLmZvcmNlRmFsbGJhY2spIHtcbiAgICAgIHRoaXMudG9nZ2xlRmFsbGJhY2soZmFsc2UpO1xuICAgIH0gZWxzZSBpZiAoIXRoaXMucHJlZml4KSB7XG4gICAgICAoZG9jdW1lbnQuY2FuY2VsRnVsbFNjcmVlbiB8fCBkb2N1bWVudC5leGl0RnVsbHNjcmVlbikuY2FsbChkb2N1bWVudCk7XG4gICAgfSBlbHNlIGlmICghaXMuZW1wdHkodGhpcy5wcmVmaXgpKSB7XG4gICAgICBjb25zdCBhY3Rpb24gPSB0aGlzLnByZWZpeCA9PT0gJ21veicgPyAnQ2FuY2VsJyA6ICdFeGl0JztcbiAgICAgIGRvY3VtZW50W2Ake3RoaXMucHJlZml4fSR7YWN0aW9ufSR7dGhpcy5wcm9wZXJ0eX1gXSgpO1xuICAgIH1cbiAgfTtcblxuICAvLyBUb2dnbGUgc3RhdGVcbiAgdG9nZ2xlID0gKCkgPT4ge1xuICAgIGlmICghdGhpcy5hY3RpdmUpIHtcbiAgICAgIHRoaXMuZW50ZXIoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5leGl0KCk7XG4gICAgfVxuICB9O1xufVxuXG5leHBvcnQgZGVmYXVsdCBGdWxsc2NyZWVuO1xuIiwiLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIExvYWQgaW1hZ2UgYXZvaWRpbmcgeGhyL2ZldGNoIENPUlMgaXNzdWVzXG4vLyBTZXJ2ZXIgc3RhdHVzIGNhbid0IGJlIG9idGFpbmVkIHRoaXMgd2F5IHVuZm9ydHVuYXRlbHksIHNvIHRoaXMgdXNlcyBcIm5hdHVyYWxXaWR0aFwiIHRvIGRldGVybWluZSBpZiB0aGUgaW1hZ2UgaGFzIGxvYWRlZFxuLy8gQnkgZGVmYXVsdCBpdCBjaGVja3MgaWYgaXQgaXMgYXQgbGVhc3QgMXB4LCBidXQgeW91IGNhbiBhZGQgYSBzZWNvbmQgYXJndW1lbnQgdG8gY2hhbmdlIHRoaXNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGxvYWRJbWFnZShzcmMsIG1pbldpZHRoID0gMSkge1xuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgIGNvbnN0IGltYWdlID0gbmV3IEltYWdlKCk7XG5cbiAgICBjb25zdCBoYW5kbGVyID0gKCkgPT4ge1xuICAgICAgZGVsZXRlIGltYWdlLm9ubG9hZDtcbiAgICAgIGRlbGV0ZSBpbWFnZS5vbmVycm9yO1xuICAgICAgKGltYWdlLm5hdHVyYWxXaWR0aCA+PSBtaW5XaWR0aCA/IHJlc29sdmUgOiByZWplY3QpKGltYWdlKTtcbiAgICB9O1xuXG4gICAgT2JqZWN0LmFzc2lnbihpbWFnZSwgeyBvbmxvYWQ6IGhhbmRsZXIsIG9uZXJyb3I6IGhhbmRsZXIsIHNyYyB9KTtcbiAgfSk7XG59XG4iLCIvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUGx5ciBVSVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuaW1wb3J0IGNhcHRpb25zIGZyb20gJy4vY2FwdGlvbnMnO1xuaW1wb3J0IGNvbnRyb2xzIGZyb20gJy4vY29udHJvbHMnO1xuaW1wb3J0IHN1cHBvcnQgZnJvbSAnLi9zdXBwb3J0JztcbmltcG9ydCBicm93c2VyIGZyb20gJy4vdXRpbHMvYnJvd3Nlcic7XG5pbXBvcnQgeyBnZXRFbGVtZW50LCB0b2dnbGVDbGFzcyB9IGZyb20gJy4vdXRpbHMvZWxlbWVudHMnO1xuaW1wb3J0IHsgcmVhZHksIHRyaWdnZXJFdmVudCB9IGZyb20gJy4vdXRpbHMvZXZlbnRzJztcbmltcG9ydCBpMThuIGZyb20gJy4vdXRpbHMvaTE4bic7XG5pbXBvcnQgaXMgZnJvbSAnLi91dGlscy9pcyc7XG5pbXBvcnQgbG9hZEltYWdlIGZyb20gJy4vdXRpbHMvbG9hZC1pbWFnZSc7XG5cbmNvbnN0IHVpID0ge1xuICBhZGRTdHlsZUhvb2soKSB7XG4gICAgdG9nZ2xlQ2xhc3ModGhpcy5lbGVtZW50cy5jb250YWluZXIsIHRoaXMuY29uZmlnLnNlbGVjdG9ycy5jb250YWluZXIucmVwbGFjZSgnLicsICcnKSwgdHJ1ZSk7XG4gICAgdG9nZ2xlQ2xhc3ModGhpcy5lbGVtZW50cy5jb250YWluZXIsIHRoaXMuY29uZmlnLmNsYXNzTmFtZXMudWlTdXBwb3J0ZWQsIHRoaXMuc3VwcG9ydGVkLnVpKTtcbiAgfSxcblxuICAvLyBUb2dnbGUgbmF0aXZlIEhUTUw1IG1lZGlhIGNvbnRyb2xzXG4gIHRvZ2dsZU5hdGl2ZUNvbnRyb2xzKHRvZ2dsZSA9IGZhbHNlKSB7XG4gICAgaWYgKHRvZ2dsZSAmJiB0aGlzLmlzSFRNTDUpIHtcbiAgICAgIHRoaXMubWVkaWEuc2V0QXR0cmlidXRlKCdjb250cm9scycsICcnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5tZWRpYS5yZW1vdmVBdHRyaWJ1dGUoJ2NvbnRyb2xzJyk7XG4gICAgfVxuICB9LFxuXG4gIC8vIFNldHVwIHRoZSBVSVxuICBidWlsZCgpIHtcbiAgICAvLyBSZS1hdHRhY2ggbWVkaWEgZWxlbWVudCBsaXN0ZW5lcnNcbiAgICAvLyBUT0RPOiBVc2UgZXZlbnQgYnViYmxpbmc/XG4gICAgdGhpcy5saXN0ZW5lcnMubWVkaWEoKTtcblxuICAgIC8vIERvbid0IHNldHVwIGludGVyZmFjZSBpZiBubyBzdXBwb3J0XG4gICAgaWYgKCF0aGlzLnN1cHBvcnRlZC51aSkge1xuICAgICAgdGhpcy5kZWJ1Zy53YXJuKGBCYXNpYyBzdXBwb3J0IG9ubHkgZm9yICR7dGhpcy5wcm92aWRlcn0gJHt0aGlzLnR5cGV9YCk7XG5cbiAgICAgIC8vIFJlc3RvcmUgbmF0aXZlIGNvbnRyb2xzXG4gICAgICB1aS50b2dnbGVOYXRpdmVDb250cm9scy5jYWxsKHRoaXMsIHRydWUpO1xuXG4gICAgICAvLyBCYWlsXG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gSW5qZWN0IGN1c3RvbSBjb250cm9scyBpZiBub3QgcHJlc2VudFxuICAgIGlmICghaXMuZWxlbWVudCh0aGlzLmVsZW1lbnRzLmNvbnRyb2xzKSkge1xuICAgICAgLy8gSW5qZWN0IGN1c3RvbSBjb250cm9sc1xuICAgICAgY29udHJvbHMuaW5qZWN0LmNhbGwodGhpcyk7XG5cbiAgICAgIC8vIFJlLWF0dGFjaCBjb250cm9sIGxpc3RlbmVyc1xuICAgICAgdGhpcy5saXN0ZW5lcnMuY29udHJvbHMoKTtcbiAgICB9XG5cbiAgICAvLyBSZW1vdmUgbmF0aXZlIGNvbnRyb2xzXG4gICAgdWkudG9nZ2xlTmF0aXZlQ29udHJvbHMuY2FsbCh0aGlzKTtcblxuICAgIC8vIFNldHVwIGNhcHRpb25zIGZvciBIVE1MNVxuICAgIGlmICh0aGlzLmlzSFRNTDUpIHtcbiAgICAgIGNhcHRpb25zLnNldHVwLmNhbGwodGhpcyk7XG4gICAgfVxuXG4gICAgLy8gUmVzZXQgdm9sdW1lXG4gICAgdGhpcy52b2x1bWUgPSBudWxsO1xuXG4gICAgLy8gUmVzZXQgbXV0ZSBzdGF0ZVxuICAgIHRoaXMubXV0ZWQgPSBudWxsO1xuXG4gICAgLy8gUmVzZXQgbG9vcCBzdGF0ZVxuICAgIHRoaXMubG9vcCA9IG51bGw7XG5cbiAgICAvLyBSZXNldCBxdWFsaXR5IHNldHRpbmdcbiAgICB0aGlzLnF1YWxpdHkgPSBudWxsO1xuXG4gICAgLy8gUmVzZXQgc3BlZWRcbiAgICB0aGlzLnNwZWVkID0gbnVsbDtcblxuICAgIC8vIFJlc2V0IHZvbHVtZSBkaXNwbGF5XG4gICAgY29udHJvbHMudXBkYXRlVm9sdW1lLmNhbGwodGhpcyk7XG5cbiAgICAvLyBSZXNldCB0aW1lIGRpc3BsYXlcbiAgICBjb250cm9scy50aW1lVXBkYXRlLmNhbGwodGhpcyk7XG5cbiAgICAvLyBSZXNldCBkdXJhdGlvbiBkaXNwbGF5XG4gICAgY29udHJvbHMuZHVyYXRpb25VcGRhdGUuY2FsbCh0aGlzKTtcblxuICAgIC8vIFVwZGF0ZSB0aGUgVUlcbiAgICB1aS5jaGVja1BsYXlpbmcuY2FsbCh0aGlzKTtcblxuICAgIC8vIENoZWNrIGZvciBwaWN0dXJlLWluLXBpY3R1cmUgc3VwcG9ydFxuICAgIHRvZ2dsZUNsYXNzKFxuICAgICAgdGhpcy5lbGVtZW50cy5jb250YWluZXIsXG4gICAgICB0aGlzLmNvbmZpZy5jbGFzc05hbWVzLnBpcC5zdXBwb3J0ZWQsXG4gICAgICBzdXBwb3J0LnBpcCAmJiB0aGlzLmlzSFRNTDUgJiYgdGhpcy5pc1ZpZGVvLFxuICAgICk7XG5cbiAgICAvLyBDaGVjayBmb3IgYWlycGxheSBzdXBwb3J0XG4gICAgdG9nZ2xlQ2xhc3ModGhpcy5lbGVtZW50cy5jb250YWluZXIsIHRoaXMuY29uZmlnLmNsYXNzTmFtZXMuYWlycGxheS5zdXBwb3J0ZWQsIHN1cHBvcnQuYWlycGxheSAmJiB0aGlzLmlzSFRNTDUpO1xuXG4gICAgLy8gQWRkIGlPUyBjbGFzc1xuICAgIHRvZ2dsZUNsYXNzKHRoaXMuZWxlbWVudHMuY29udGFpbmVyLCB0aGlzLmNvbmZpZy5jbGFzc05hbWVzLmlzSW9zLCBicm93c2VyLmlzSW9zKTtcblxuICAgIC8vIEFkZCB0b3VjaCBjbGFzc1xuICAgIHRvZ2dsZUNsYXNzKHRoaXMuZWxlbWVudHMuY29udGFpbmVyLCB0aGlzLmNvbmZpZy5jbGFzc05hbWVzLmlzVG91Y2gsIHRoaXMudG91Y2gpO1xuXG4gICAgLy8gUmVhZHkgZm9yIEFQSSBjYWxsc1xuICAgIHRoaXMucmVhZHkgPSB0cnVlO1xuXG4gICAgLy8gUmVhZHkgZXZlbnQgYXQgZW5kIG9mIGV4ZWN1dGlvbiBzdGFja1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgdHJpZ2dlckV2ZW50LmNhbGwodGhpcywgdGhpcy5tZWRpYSwgJ3JlYWR5Jyk7XG4gICAgfSwgMCk7XG5cbiAgICAvLyBTZXQgdGhlIHRpdGxlXG4gICAgdWkuc2V0VGl0bGUuY2FsbCh0aGlzKTtcblxuICAgIC8vIEFzc3VyZSB0aGUgcG9zdGVyIGltYWdlIGlzIHNldCwgaWYgdGhlIHByb3BlcnR5IHdhcyBhZGRlZCBiZWZvcmUgdGhlIGVsZW1lbnQgd2FzIGNyZWF0ZWRcbiAgICBpZiAodGhpcy5wb3N0ZXIpIHtcbiAgICAgIHVpLnNldFBvc3Rlci5jYWxsKHRoaXMsIHRoaXMucG9zdGVyLCBmYWxzZSkuY2F0Y2goKCkgPT4ge30pO1xuICAgIH1cblxuICAgIC8vIE1hbnVhbGx5IHNldCB0aGUgZHVyYXRpb24gaWYgdXNlciBoYXMgb3ZlcnJpZGRlbiBpdC5cbiAgICAvLyBUaGUgZXZlbnQgbGlzdGVuZXJzIGZvciBpdCBkb2Vzbid0IGdldCBjYWxsZWQgaWYgcHJlbG9hZCBpcyBkaXNhYmxlZCAoIzcwMSlcbiAgICBpZiAodGhpcy5jb25maWcuZHVyYXRpb24pIHtcbiAgICAgIGNvbnRyb2xzLmR1cmF0aW9uVXBkYXRlLmNhbGwodGhpcyk7XG4gICAgfVxuXG4gICAgLy8gTWVkaWEgbWV0YWRhdGFcbiAgICBpZiAodGhpcy5jb25maWcubWVkaWFNZXRhZGF0YSkge1xuICAgICAgY29udHJvbHMuc2V0TWVkaWFNZXRhZGF0YS5jYWxsKHRoaXMpO1xuICAgIH1cbiAgfSxcblxuICAvLyBTZXR1cCBhcmlhIGF0dHJpYnV0ZSBmb3IgcGxheSBhbmQgaWZyYW1lIHRpdGxlXG4gIHNldFRpdGxlKCkge1xuICAgIC8vIEZpbmQgdGhlIGN1cnJlbnQgdGV4dFxuICAgIGxldCBsYWJlbCA9IGkxOG4uZ2V0KCdwbGF5JywgdGhpcy5jb25maWcpO1xuXG4gICAgLy8gSWYgdGhlcmUncyBhIG1lZGlhIHRpdGxlIHNldCwgdXNlIHRoYXQgZm9yIHRoZSBsYWJlbFxuICAgIGlmIChpcy5zdHJpbmcodGhpcy5jb25maWcudGl0bGUpICYmICFpcy5lbXB0eSh0aGlzLmNvbmZpZy50aXRsZSkpIHtcbiAgICAgIGxhYmVsICs9IGAsICR7dGhpcy5jb25maWcudGl0bGV9YDtcbiAgICB9XG5cbiAgICAvLyBJZiB0aGVyZSdzIGEgcGxheSBidXR0b24sIHNldCBsYWJlbFxuICAgIEFycmF5LmZyb20odGhpcy5lbGVtZW50cy5idXR0b25zLnBsYXkgfHwgW10pLmZvckVhY2goKGJ1dHRvbikgPT4ge1xuICAgICAgYnV0dG9uLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsIGxhYmVsKTtcbiAgICB9KTtcblxuICAgIC8vIFNldCBpZnJhbWUgdGl0bGVcbiAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vc2FtcG90dHMvcGx5ci9pc3N1ZXMvMTI0XG4gICAgaWYgKHRoaXMuaXNFbWJlZCkge1xuICAgICAgY29uc3QgaWZyYW1lID0gZ2V0RWxlbWVudC5jYWxsKHRoaXMsICdpZnJhbWUnKTtcblxuICAgICAgaWYgKCFpcy5lbGVtZW50KGlmcmFtZSkpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICAvLyBEZWZhdWx0IHRvIG1lZGlhIHR5cGVcbiAgICAgIGNvbnN0IHRpdGxlID0gIWlzLmVtcHR5KHRoaXMuY29uZmlnLnRpdGxlKSA/IHRoaXMuY29uZmlnLnRpdGxlIDogJ3ZpZGVvJztcbiAgICAgIGNvbnN0IGZvcm1hdCA9IGkxOG4uZ2V0KCdmcmFtZVRpdGxlJywgdGhpcy5jb25maWcpO1xuXG4gICAgICBpZnJhbWUuc2V0QXR0cmlidXRlKCd0aXRsZScsIGZvcm1hdC5yZXBsYWNlKCd7dGl0bGV9JywgdGl0bGUpKTtcbiAgICB9XG4gIH0sXG5cbiAgLy8gVG9nZ2xlIHBvc3RlclxuICB0b2dnbGVQb3N0ZXIoZW5hYmxlKSB7XG4gICAgdG9nZ2xlQ2xhc3ModGhpcy5lbGVtZW50cy5jb250YWluZXIsIHRoaXMuY29uZmlnLmNsYXNzTmFtZXMucG9zdGVyRW5hYmxlZCwgZW5hYmxlKTtcbiAgfSxcblxuICAvLyBTZXQgdGhlIHBvc3RlciBpbWFnZSAoYXN5bmMpXG4gIC8vIFVzZWQgaW50ZXJuYWxseSBmb3IgdGhlIHBvc3RlciBzZXR0ZXIsIHdpdGggdGhlIHBhc3NpdmUgb3B0aW9uIGZvcmNlZCB0byBmYWxzZVxuICBzZXRQb3N0ZXIocG9zdGVyLCBwYXNzaXZlID0gdHJ1ZSkge1xuICAgIC8vIERvbid0IG92ZXJyaWRlIGlmIGNhbGwgaXMgcGFzc2l2ZVxuICAgIGlmIChwYXNzaXZlICYmIHRoaXMucG9zdGVyKSB7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKCdQb3N0ZXIgYWxyZWFkeSBzZXQnKSk7XG4gICAgfVxuXG4gICAgLy8gU2V0IHByb3BlcnR5IHN5bmNocm9ub3VzbHkgdG8gcmVzcGVjdCB0aGUgY2FsbCBvcmRlclxuICAgIHRoaXMubWVkaWEuc2V0QXR0cmlidXRlKCdkYXRhLXBvc3RlcicsIHBvc3Rlcik7XG5cbiAgICAvLyBTaG93IHRoZSBwb3N0ZXJcbiAgICB0aGlzLmVsZW1lbnRzLnBvc3Rlci5yZW1vdmVBdHRyaWJ1dGUoJ2hpZGRlbicpO1xuXG4gICAgLy8gV2FpdCB1bnRpbCB1aSBpcyByZWFkeVxuICAgIHJldHVybiAoXG4gICAgICByZWFkeVxuICAgICAgICAuY2FsbCh0aGlzKVxuICAgICAgICAvLyBMb2FkIGltYWdlXG4gICAgICAgIC50aGVuKCgpID0+IGxvYWRJbWFnZShwb3N0ZXIpKVxuICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7XG4gICAgICAgICAgLy8gSGlkZSBwb3N0ZXIgb24gZXJyb3IgdW5sZXNzIGl0J3MgYmVlbiBzZXQgYnkgYW5vdGhlciBjYWxsXG4gICAgICAgICAgaWYgKHBvc3RlciA9PT0gdGhpcy5wb3N0ZXIpIHtcbiAgICAgICAgICAgIHVpLnRvZ2dsZVBvc3Rlci5jYWxsKHRoaXMsIGZhbHNlKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgLy8gUmV0aHJvd1xuICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICB9KVxuICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgLy8gUHJldmVudCByYWNlIGNvbmRpdGlvbnNcbiAgICAgICAgICBpZiAocG9zdGVyICE9PSB0aGlzLnBvc3Rlcikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdzZXRQb3N0ZXIgY2FuY2VsbGVkIGJ5IGxhdGVyIGNhbGwgdG8gc2V0UG9zdGVyJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgT2JqZWN0LmFzc2lnbih0aGlzLmVsZW1lbnRzLnBvc3Rlci5zdHlsZSwge1xuICAgICAgICAgICAgYmFja2dyb3VuZEltYWdlOiBgdXJsKCcke3Bvc3Rlcn0nKWAsXG4gICAgICAgICAgICAvLyBSZXNldCBiYWNrZ3JvdW5kU2l6ZSBhcyB3ZWxsIChzaW5jZSBpdCBjYW4gYmUgc2V0IHRvIFwiY292ZXJcIiBmb3IgcGFkZGVkIHRodW1ibmFpbHMgZm9yIHlvdXR1YmUpXG4gICAgICAgICAgICBiYWNrZ3JvdW5kU2l6ZTogJycsXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICB1aS50b2dnbGVQb3N0ZXIuY2FsbCh0aGlzLCB0cnVlKTtcblxuICAgICAgICAgIHJldHVybiBwb3N0ZXI7XG4gICAgICAgIH0pXG4gICAgKTtcbiAgfSxcblxuICAvLyBDaGVjayBwbGF5aW5nIHN0YXRlXG4gIGNoZWNrUGxheWluZyhldmVudCkge1xuICAgIC8vIENsYXNzIGhvb2tzXG4gICAgdG9nZ2xlQ2xhc3ModGhpcy5lbGVtZW50cy5jb250YWluZXIsIHRoaXMuY29uZmlnLmNsYXNzTmFtZXMucGxheWluZywgdGhpcy5wbGF5aW5nKTtcbiAgICB0b2dnbGVDbGFzcyh0aGlzLmVsZW1lbnRzLmNvbnRhaW5lciwgdGhpcy5jb25maWcuY2xhc3NOYW1lcy5wYXVzZWQsIHRoaXMucGF1c2VkKTtcbiAgICB0b2dnbGVDbGFzcyh0aGlzLmVsZW1lbnRzLmNvbnRhaW5lciwgdGhpcy5jb25maWcuY2xhc3NOYW1lcy5zdG9wcGVkLCB0aGlzLnN0b3BwZWQpO1xuXG4gICAgLy8gU2V0IHN0YXRlXG4gICAgQXJyYXkuZnJvbSh0aGlzLmVsZW1lbnRzLmJ1dHRvbnMucGxheSB8fCBbXSkuZm9yRWFjaCgodGFyZ2V0KSA9PiB7XG4gICAgICBPYmplY3QuYXNzaWduKHRhcmdldCwgeyBwcmVzc2VkOiB0aGlzLnBsYXlpbmcgfSk7XG4gICAgICB0YXJnZXQuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgaTE4bi5nZXQodGhpcy5wbGF5aW5nID8gJ3BhdXNlJyA6ICdwbGF5JywgdGhpcy5jb25maWcpKTtcbiAgICB9KTtcblxuICAgIC8vIE9ubHkgdXBkYXRlIGNvbnRyb2xzIG9uIG5vbiB0aW1ldXBkYXRlIGV2ZW50c1xuICAgIGlmIChpcy5ldmVudChldmVudCkgJiYgZXZlbnQudHlwZSA9PT0gJ3RpbWV1cGRhdGUnKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gVG9nZ2xlIGNvbnRyb2xzXG4gICAgdWkudG9nZ2xlQ29udHJvbHMuY2FsbCh0aGlzKTtcbiAgfSxcblxuICAvLyBDaGVjayBpZiBtZWRpYSBpcyBsb2FkaW5nXG4gIGNoZWNrTG9hZGluZyhldmVudCkge1xuICAgIHRoaXMubG9hZGluZyA9IFsnc3RhbGxlZCcsICd3YWl0aW5nJ10uaW5jbHVkZXMoZXZlbnQudHlwZSk7XG5cbiAgICAvLyBDbGVhciB0aW1lclxuICAgIGNsZWFyVGltZW91dCh0aGlzLnRpbWVycy5sb2FkaW5nKTtcblxuICAgIC8vIFRpbWVyIHRvIHByZXZlbnQgZmxpY2tlciB3aGVuIHNlZWtpbmdcbiAgICB0aGlzLnRpbWVycy5sb2FkaW5nID0gc2V0VGltZW91dChcbiAgICAgICgpID0+IHtcbiAgICAgICAgLy8gVXBkYXRlIHByb2dyZXNzIGJhciBsb2FkaW5nIGNsYXNzIHN0YXRlXG4gICAgICAgIHRvZ2dsZUNsYXNzKHRoaXMuZWxlbWVudHMuY29udGFpbmVyLCB0aGlzLmNvbmZpZy5jbGFzc05hbWVzLmxvYWRpbmcsIHRoaXMubG9hZGluZyk7XG5cbiAgICAgICAgLy8gVXBkYXRlIGNvbnRyb2xzIHZpc2liaWxpdHlcbiAgICAgICAgdWkudG9nZ2xlQ29udHJvbHMuY2FsbCh0aGlzKTtcbiAgICAgIH0sXG4gICAgICB0aGlzLmxvYWRpbmcgPyAyNTAgOiAwLFxuICAgICk7XG4gIH0sXG5cbiAgLy8gVG9nZ2xlIGNvbnRyb2xzIGJhc2VkIG9uIHN0YXRlIGFuZCBgZm9yY2VgIGFyZ3VtZW50XG4gIHRvZ2dsZUNvbnRyb2xzKGZvcmNlKSB7XG4gICAgY29uc3QgeyBjb250cm9sczogY29udHJvbHNFbGVtZW50IH0gPSB0aGlzLmVsZW1lbnRzO1xuXG4gICAgaWYgKGNvbnRyb2xzRWxlbWVudCAmJiB0aGlzLmNvbmZpZy5oaWRlQ29udHJvbHMpIHtcbiAgICAgIC8vIERvbid0IGhpZGUgY29udHJvbHMgaWYgYSB0b3VjaC1kZXZpY2UgdXNlciByZWNlbnRseSBzZWVrZWQuIChNdXN0IGJlIGxpbWl0ZWQgdG8gdG91Y2ggZGV2aWNlcywgb3IgaXQgb2NjYXNpb25hbGx5IHByZXZlbnRzIGRlc2t0b3AgY29udHJvbHMgZnJvbSBoaWRpbmcuKVxuICAgICAgY29uc3QgcmVjZW50VG91Y2hTZWVrID0gdGhpcy50b3VjaCAmJiB0aGlzLmxhc3RTZWVrVGltZSArIDIwMDAgPiBEYXRlLm5vdygpO1xuXG4gICAgICAvLyBTaG93IGNvbnRyb2xzIGlmIGZvcmNlLCBsb2FkaW5nLCBwYXVzZWQsIGJ1dHRvbiBpbnRlcmFjdGlvbiwgb3IgcmVjZW50IHNlZWssIG90aGVyd2lzZSBoaWRlXG4gICAgICB0aGlzLnRvZ2dsZUNvbnRyb2xzKFxuICAgICAgICBCb29sZWFuKFxuICAgICAgICAgIGZvcmNlIHx8IHRoaXMubG9hZGluZyB8fCB0aGlzLnBhdXNlZCB8fCBjb250cm9sc0VsZW1lbnQucHJlc3NlZCB8fCBjb250cm9sc0VsZW1lbnQuaG92ZXIgfHwgcmVjZW50VG91Y2hTZWVrLFxuICAgICAgICApLFxuICAgICAgKTtcbiAgICB9XG4gIH0sXG5cbiAgLy8gTWlncmF0ZSBhbnkgY3VzdG9tIHByb3BlcnRpZXMgZnJvbSB0aGUgbWVkaWEgdG8gdGhlIHBhcmVudFxuICBtaWdyYXRlU3R5bGVzKCkge1xuICAgIC8vIExvb3AgdGhyb3VnaCB2YWx1ZXMgKGFzIHRoZXkgYXJlIHRoZSBrZXlzIHdoZW4gdGhlIG9iamVjdCBpcyBzcHJlYWQg8J+klClcbiAgICBPYmplY3QudmFsdWVzKHsgLi4udGhpcy5tZWRpYS5zdHlsZSB9KVxuICAgICAgLy8gV2UncmUgb25seSBmdXNzZWQgYWJvdXQgUGx5ciBzcGVjaWZpYyBwcm9wZXJ0aWVzXG4gICAgICAuZmlsdGVyKChrZXkpID0+ICFpcy5lbXB0eShrZXkpICYmIGlzLnN0cmluZyhrZXkpICYmIGtleS5zdGFydHNXaXRoKCctLXBseXInKSlcbiAgICAgIC5mb3JFYWNoKChrZXkpID0+IHtcbiAgICAgICAgLy8gU2V0IG9uIHRoZSBjb250YWluZXJcbiAgICAgICAgdGhpcy5lbGVtZW50cy5jb250YWluZXIuc3R5bGUuc2V0UHJvcGVydHkoa2V5LCB0aGlzLm1lZGlhLnN0eWxlLmdldFByb3BlcnR5VmFsdWUoa2V5KSk7XG5cbiAgICAgICAgLy8gQ2xlYW4gdXAgZnJvbSBtZWRpYSBlbGVtZW50XG4gICAgICAgIHRoaXMubWVkaWEuc3R5bGUucmVtb3ZlUHJvcGVydHkoa2V5KTtcbiAgICAgIH0pO1xuXG4gICAgLy8gUmVtb3ZlIGF0dHJpYnV0ZSBpZiBlbXB0eVxuICAgIGlmIChpcy5lbXB0eSh0aGlzLm1lZGlhLnN0eWxlKSkge1xuICAgICAgdGhpcy5tZWRpYS5yZW1vdmVBdHRyaWJ1dGUoJ3N0eWxlJyk7XG4gICAgfVxuICB9LFxufTtcblxuZXhwb3J0IGRlZmF1bHQgdWk7XG4iLCIvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUGx5ciBFdmVudCBMaXN0ZW5lcnNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmltcG9ydCBjb250cm9scyBmcm9tICcuL2NvbnRyb2xzJztcbmltcG9ydCB1aSBmcm9tICcuL3VpJztcbmltcG9ydCB7IHJlcGFpbnQgfSBmcm9tICcuL3V0aWxzL2FuaW1hdGlvbic7XG5pbXBvcnQgYnJvd3NlciBmcm9tICcuL3V0aWxzL2Jyb3dzZXInO1xuaW1wb3J0IHsgZ2V0RWxlbWVudCwgZ2V0RWxlbWVudHMsIG1hdGNoZXMsIHRvZ2dsZUNsYXNzIH0gZnJvbSAnLi91dGlscy9lbGVtZW50cyc7XG5pbXBvcnQgeyBvZmYsIG9uLCBvbmNlLCB0b2dnbGVMaXN0ZW5lciwgdHJpZ2dlckV2ZW50IH0gZnJvbSAnLi91dGlscy9ldmVudHMnO1xuaW1wb3J0IGlzIGZyb20gJy4vdXRpbHMvaXMnO1xuaW1wb3J0IHsgc2lsZW5jZVByb21pc2UgfSBmcm9tICcuL3V0aWxzL3Byb21pc2UnO1xuaW1wb3J0IHsgZ2V0QXNwZWN0UmF0aW8sIGdldFZpZXdwb3J0U2l6ZSwgc3VwcG9ydHNDU1MgfSBmcm9tICcuL3V0aWxzL3N0eWxlJztcblxuY2xhc3MgTGlzdGVuZXJzIHtcbiAgY29uc3RydWN0b3IocGxheWVyKSB7XG4gICAgdGhpcy5wbGF5ZXIgPSBwbGF5ZXI7XG4gICAgdGhpcy5sYXN0S2V5ID0gbnVsbDtcbiAgICB0aGlzLmZvY3VzVGltZXIgPSBudWxsO1xuICAgIHRoaXMubGFzdEtleURvd24gPSBudWxsO1xuXG4gICAgdGhpcy5oYW5kbGVLZXkgPSB0aGlzLmhhbmRsZUtleS5iaW5kKHRoaXMpO1xuICAgIHRoaXMudG9nZ2xlTWVudSA9IHRoaXMudG9nZ2xlTWVudS5iaW5kKHRoaXMpO1xuICAgIHRoaXMuc2V0VGFiRm9jdXMgPSB0aGlzLnNldFRhYkZvY3VzLmJpbmQodGhpcyk7XG4gICAgdGhpcy5maXJzdFRvdWNoID0gdGhpcy5maXJzdFRvdWNoLmJpbmQodGhpcyk7XG4gIH1cblxuICAvLyBIYW5kbGUga2V5IHByZXNzZXNcbiAgaGFuZGxlS2V5KGV2ZW50KSB7XG4gICAgY29uc3QgeyBwbGF5ZXIgfSA9IHRoaXM7XG4gICAgY29uc3QgeyBlbGVtZW50cyB9ID0gcGxheWVyO1xuICAgIGNvbnN0IHsga2V5LCB0eXBlLCBhbHRLZXksIGN0cmxLZXksIG1ldGFLZXksIHNoaWZ0S2V5IH0gPSBldmVudDtcbiAgICBjb25zdCBwcmVzc2VkID0gdHlwZSA9PT0gJ2tleWRvd24nO1xuICAgIGNvbnN0IHJlcGVhdCA9IHByZXNzZWQgJiYga2V5ID09PSB0aGlzLmxhc3RLZXk7XG5cbiAgICAvLyBCYWlsIGlmIGEgbW9kaWZpZXIga2V5IGlzIHNldFxuICAgIGlmIChhbHRLZXkgfHwgY3RybEtleSB8fCBtZXRhS2V5IHx8IHNoaWZ0S2V5KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gSWYgdGhlIGV2ZW50IGlzIGJ1YmJsZWQgZnJvbSB0aGUgbWVkaWEgZWxlbWVudFxuICAgIC8vIEZpcmVmb3ggZG9lc24ndCBnZXQgdGhlIGtleSBmb3Igd2hhdGV2ZXIgcmVhc29uXG4gICAgaWYgKCFrZXkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBTZWVrIGJ5IGluY3JlbWVudFxuICAgIGNvbnN0IHNlZWtCeUluY3JlbWVudCA9IChpbmNyZW1lbnQpID0+IHtcbiAgICAgIC8vIERpdmlkZSB0aGUgbWF4IGR1cmF0aW9uIGludG8gMTB0aCdzIGFuZCB0aW1lcyBieSB0aGUgbnVtYmVyIHZhbHVlXG4gICAgICBwbGF5ZXIuY3VycmVudFRpbWUgPSAocGxheWVyLmR1cmF0aW9uIC8gMTApICogaW5jcmVtZW50O1xuICAgIH07XG5cbiAgICAvLyBIYW5kbGUgdGhlIGtleSBvbiBrZXlkb3duXG4gICAgLy8gUmVzZXQgb24ga2V5dXBcbiAgICBpZiAocHJlc3NlZCkge1xuICAgICAgLy8gQ2hlY2sgZm9jdXNlZCBlbGVtZW50XG4gICAgICAvLyBhbmQgaWYgdGhlIGZvY3VzZWQgZWxlbWVudCBpcyBub3QgZWRpdGFibGUgKGUuZy4gdGV4dCBpbnB1dClcbiAgICAgIC8vIGFuZCBhbnkgdGhhdCBhY2NlcHQga2V5IGlucHV0IGh0dHA6Ly93ZWJhaW0ub3JnL3RlY2huaXF1ZXMva2V5Ym9hcmQvXG4gICAgICBjb25zdCBmb2N1c2VkID0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudDtcbiAgICAgIGlmIChpcy5lbGVtZW50KGZvY3VzZWQpKSB7XG4gICAgICAgIGNvbnN0IHsgZWRpdGFibGUgfSA9IHBsYXllci5jb25maWcuc2VsZWN0b3JzO1xuICAgICAgICBjb25zdCB7IHNlZWsgfSA9IGVsZW1lbnRzLmlucHV0cztcblxuICAgICAgICBpZiAoZm9jdXNlZCAhPT0gc2VlayAmJiBtYXRjaGVzKGZvY3VzZWQsIGVkaXRhYmxlKSkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChldmVudC5rZXkgPT09ICdTcGFjZScgJiYgbWF0Y2hlcyhmb2N1c2VkLCAnYnV0dG9uLCBbcm9sZV49XCJtZW51aXRlbVwiXScpKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIFdoaWNoIGtleXMgc2hvdWxkIHdlIHByZXZlbnQgZGVmYXVsdFxuICAgICAgY29uc3QgcHJldmVudERlZmF1bHQgPSBbXG4gICAgICAgICdTcGFjZScsXG4gICAgICAgICdBcnJvd0xlZnQnLFxuICAgICAgICAnQXJyb3dVcCcsXG4gICAgICAgICdBcnJvd1JpZ2h0JyxcbiAgICAgICAgJ0Fycm93RG93bicsXG5cbiAgICAgICAgJzAnLFxuICAgICAgICAnMScsXG4gICAgICAgICcyJyxcbiAgICAgICAgJzMnLFxuICAgICAgICAnNCcsXG4gICAgICAgICc1JyxcbiAgICAgICAgJzYnLFxuICAgICAgICAnNycsXG4gICAgICAgICc4JyxcbiAgICAgICAgJzknLFxuXG4gICAgICAgICdjJyxcbiAgICAgICAgJ2YnLFxuICAgICAgICAnaycsXG4gICAgICAgICdsJyxcbiAgICAgICAgJ20nLFxuICAgICAgXTtcblxuICAgICAgLy8gSWYgdGhlIGtleSBpcyBmb3VuZCBwcmV2ZW50IGRlZmF1bHQgKGUuZy4gcHJldmVudCBzY3JvbGxpbmcgZm9yIGFycm93cylcbiAgICAgIGlmIChwcmV2ZW50RGVmYXVsdC5pbmNsdWRlcyhrZXkpKSB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgfVxuXG4gICAgICBzd2l0Y2ggKGtleSkge1xuICAgICAgICBjYXNlICcwJzpcbiAgICAgICAgY2FzZSAnMSc6XG4gICAgICAgIGNhc2UgJzInOlxuICAgICAgICBjYXNlICczJzpcbiAgICAgICAgY2FzZSAnNCc6XG4gICAgICAgIGNhc2UgJzUnOlxuICAgICAgICBjYXNlICc2JzpcbiAgICAgICAgY2FzZSAnNyc6XG4gICAgICAgIGNhc2UgJzgnOlxuICAgICAgICBjYXNlICc5JzpcbiAgICAgICAgICBpZiAoIXJlcGVhdCkge1xuICAgICAgICAgICAgc2Vla0J5SW5jcmVtZW50KHBhcnNlSW50KGtleSwgMTApKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgY2FzZSAnU3BhY2UnOlxuICAgICAgICBjYXNlICdrJzpcbiAgICAgICAgICBpZiAoIXJlcGVhdCkge1xuICAgICAgICAgICAgc2lsZW5jZVByb21pc2UocGxheWVyLnRvZ2dsZVBsYXkoKSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgIGNhc2UgJ0Fycm93VXAnOlxuICAgICAgICAgIHBsYXllci5pbmNyZWFzZVZvbHVtZSgwLjEpO1xuICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgIGNhc2UgJ0Fycm93RG93bic6XG4gICAgICAgICAgcGxheWVyLmRlY3JlYXNlVm9sdW1lKDAuMSk7XG4gICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgY2FzZSAnbSc6XG4gICAgICAgICAgaWYgKCFyZXBlYXQpIHtcbiAgICAgICAgICAgIHBsYXllci5tdXRlZCA9ICFwbGF5ZXIubXV0ZWQ7XG4gICAgICAgICAgfVxuICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgIGNhc2UgJ0Fycm93UmlnaHQnOlxuICAgICAgICAgIHBsYXllci5mb3J3YXJkKCk7XG4gICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgY2FzZSAnQXJyb3dMZWZ0JzpcbiAgICAgICAgICBwbGF5ZXIucmV3aW5kKCk7XG4gICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgY2FzZSAnZic6XG4gICAgICAgICAgcGxheWVyLmZ1bGxzY3JlZW4udG9nZ2xlKCk7XG4gICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgY2FzZSAnYyc6XG4gICAgICAgICAgaWYgKCFyZXBlYXQpIHtcbiAgICAgICAgICAgIHBsYXllci50b2dnbGVDYXB0aW9ucygpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBicmVhaztcblxuICAgICAgICBjYXNlICdsJzpcbiAgICAgICAgICBwbGF5ZXIubG9vcCA9ICFwbGF5ZXIubG9vcDtcbiAgICAgICAgICBicmVhaztcblxuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuXG4gICAgICAvLyBFc2NhcGUgaXMgaGFuZGxlIG5hdGl2ZWx5IHdoZW4gaW4gZnVsbCBzY3JlZW5cbiAgICAgIC8vIFNvIHdlIG9ubHkgbmVlZCB0byB3b3JyeSBhYm91dCBub24gbmF0aXZlXG4gICAgICBpZiAoa2V5ID09PSAnRXNjYXBlJyAmJiAhcGxheWVyLmZ1bGxzY3JlZW4udXNpbmdOYXRpdmUgJiYgcGxheWVyLmZ1bGxzY3JlZW4uYWN0aXZlKSB7XG4gICAgICAgIHBsYXllci5mdWxsc2NyZWVuLnRvZ2dsZSgpO1xuICAgICAgfVxuXG4gICAgICAvLyBTdG9yZSBsYXN0IGtleSBmb3IgbmV4dCBjeWNsZVxuICAgICAgdGhpcy5sYXN0S2V5ID0ga2V5O1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmxhc3RLZXkgPSBudWxsO1xuICAgIH1cbiAgfVxuXG4gIC8vIFRvZ2dsZSBtZW51XG4gIHRvZ2dsZU1lbnUoZXZlbnQpIHtcbiAgICBjb250cm9scy50b2dnbGVNZW51LmNhbGwodGhpcy5wbGF5ZXIsIGV2ZW50KTtcbiAgfVxuXG4gIC8vIERldmljZSBpcyB0b3VjaCBlbmFibGVkXG4gIGZpcnN0VG91Y2ggPSAoKSA9PiB7XG4gICAgY29uc3QgeyBwbGF5ZXIgfSA9IHRoaXM7XG4gICAgY29uc3QgeyBlbGVtZW50cyB9ID0gcGxheWVyO1xuXG4gICAgcGxheWVyLnRvdWNoID0gdHJ1ZTtcblxuICAgIC8vIEFkZCB0b3VjaCBjbGFzc1xuICAgIHRvZ2dsZUNsYXNzKGVsZW1lbnRzLmNvbnRhaW5lciwgcGxheWVyLmNvbmZpZy5jbGFzc05hbWVzLmlzVG91Y2gsIHRydWUpO1xuICB9O1xuXG4gIHNldFRhYkZvY3VzID0gKGV2ZW50KSA9PiB7XG4gICAgY29uc3QgeyBwbGF5ZXIgfSA9IHRoaXM7XG4gICAgY29uc3QgeyBlbGVtZW50cyB9ID0gcGxheWVyO1xuICAgIGNvbnN0IHsga2V5LCB0eXBlLCB0aW1lU3RhbXAgfSA9IGV2ZW50O1xuXG4gICAgY2xlYXJUaW1lb3V0KHRoaXMuZm9jdXNUaW1lcik7XG5cbiAgICAvLyBJZ25vcmUgYW55IGtleSBvdGhlciB0aGFuIHRhYlxuICAgIGlmICh0eXBlID09PSAna2V5ZG93bicgJiYga2V5ICE9PSAnVGFiJykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIFN0b3JlIHJlZmVyZW5jZSB0byBldmVudCB0aW1lU3RhbXBcbiAgICBpZiAodHlwZSA9PT0gJ2tleWRvd24nKSB7XG4gICAgICB0aGlzLmxhc3RLZXlEb3duID0gdGltZVN0YW1wO1xuICAgIH1cblxuICAgIC8vIFJlbW92ZSBjdXJyZW50IGNsYXNzZXNcbiAgICBjb25zdCByZW1vdmVDdXJyZW50ID0gKCkgPT4ge1xuICAgICAgY29uc3QgY2xhc3NOYW1lID0gcGxheWVyLmNvbmZpZy5jbGFzc05hbWVzLnRhYkZvY3VzO1xuICAgICAgY29uc3QgY3VycmVudCA9IGdldEVsZW1lbnRzLmNhbGwocGxheWVyLCBgLiR7Y2xhc3NOYW1lfWApO1xuICAgICAgdG9nZ2xlQ2xhc3MoY3VycmVudCwgY2xhc3NOYW1lLCBmYWxzZSk7XG4gICAgfTtcblxuICAgIC8vIERldGVybWluZSBpZiBhIGtleSB3YXMgcHJlc3NlZCB0byB0cmlnZ2VyIHRoaXMgZXZlbnRcbiAgICBjb25zdCB3YXNLZXlEb3duID0gdGltZVN0YW1wIC0gdGhpcy5sYXN0S2V5RG93biA8PSAyMDtcblxuICAgIC8vIElnbm9yZSBmb2N1cyBldmVudHMgaWYgYSBrZXkgd2FzIHByZXNzZWQgcHJpb3JcbiAgICBpZiAodHlwZSA9PT0gJ2ZvY3VzJyAmJiAhd2FzS2V5RG93bikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIFJlbW92ZSBhbGwgY3VycmVudFxuICAgIHJlbW92ZUN1cnJlbnQoKTtcblxuICAgIC8vIERlbGF5IHRoZSBhZGRpbmcgb2YgY2xhc3NuYW1lIHVudGlsIHRoZSBmb2N1cyBoYXMgY2hhbmdlZFxuICAgIC8vIFRoaXMgZXZlbnQgZmlyZXMgYmVmb3JlIHRoZSBmb2N1c2luIGV2ZW50XG4gICAgaWYgKHR5cGUgIT09ICdmb2N1c291dCcpIHtcbiAgICAgIHRoaXMuZm9jdXNUaW1lciA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICBjb25zdCBmb2N1c2VkID0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudDtcblxuICAgICAgICAvLyBJZ25vcmUgaWYgY3VycmVudCBmb2N1cyBlbGVtZW50IGlzbid0IGluc2lkZSB0aGUgcGxheWVyXG4gICAgICAgIGlmICghZWxlbWVudHMuY29udGFpbmVyLmNvbnRhaW5zKGZvY3VzZWQpKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdG9nZ2xlQ2xhc3MoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCwgcGxheWVyLmNvbmZpZy5jbGFzc05hbWVzLnRhYkZvY3VzLCB0cnVlKTtcbiAgICAgIH0sIDEwKTtcbiAgICB9XG4gIH07XG5cbiAgLy8gR2xvYmFsIHdpbmRvdyAmIGRvY3VtZW50IGxpc3RlbmVyc1xuICBnbG9iYWwgPSAodG9nZ2xlID0gdHJ1ZSkgPT4ge1xuICAgIGNvbnN0IHsgcGxheWVyIH0gPSB0aGlzO1xuXG4gICAgLy8gS2V5Ym9hcmQgc2hvcnRjdXRzXG4gICAgaWYgKHBsYXllci5jb25maWcua2V5Ym9hcmQuZ2xvYmFsKSB7XG4gICAgICB0b2dnbGVMaXN0ZW5lci5jYWxsKHBsYXllciwgd2luZG93LCAna2V5ZG93biBrZXl1cCcsIHRoaXMuaGFuZGxlS2V5LCB0b2dnbGUsIGZhbHNlKTtcbiAgICB9XG5cbiAgICAvLyBDbGljayBhbnl3aGVyZSBjbG9zZXMgbWVudVxuICAgIHRvZ2dsZUxpc3RlbmVyLmNhbGwocGxheWVyLCBkb2N1bWVudC5ib2R5LCAnY2xpY2snLCB0aGlzLnRvZ2dsZU1lbnUsIHRvZ2dsZSk7XG5cbiAgICAvLyBEZXRlY3QgdG91Y2ggYnkgZXZlbnRzXG4gICAgb25jZS5jYWxsKHBsYXllciwgZG9jdW1lbnQuYm9keSwgJ3RvdWNoc3RhcnQnLCB0aGlzLmZpcnN0VG91Y2gpO1xuXG4gICAgLy8gVGFiIGZvY3VzIGRldGVjdGlvblxuICAgIHRvZ2dsZUxpc3RlbmVyLmNhbGwocGxheWVyLCBkb2N1bWVudC5ib2R5LCAna2V5ZG93biBmb2N1cyBibHVyIGZvY3Vzb3V0JywgdGhpcy5zZXRUYWJGb2N1cywgdG9nZ2xlLCBmYWxzZSwgdHJ1ZSk7XG4gIH07XG5cbiAgLy8gQ29udGFpbmVyIGxpc3RlbmVyc1xuICBjb250YWluZXIgPSAoKSA9PiB7XG4gICAgY29uc3QgeyBwbGF5ZXIgfSA9IHRoaXM7XG4gICAgY29uc3QgeyBjb25maWcsIGVsZW1lbnRzLCB0aW1lcnMgfSA9IHBsYXllcjtcblxuICAgIC8vIEtleWJvYXJkIHNob3J0Y3V0c1xuICAgIGlmICghY29uZmlnLmtleWJvYXJkLmdsb2JhbCAmJiBjb25maWcua2V5Ym9hcmQuZm9jdXNlZCkge1xuICAgICAgb24uY2FsbChwbGF5ZXIsIGVsZW1lbnRzLmNvbnRhaW5lciwgJ2tleWRvd24ga2V5dXAnLCB0aGlzLmhhbmRsZUtleSwgZmFsc2UpO1xuICAgIH1cblxuICAgIC8vIFRvZ2dsZSBjb250cm9scyBvbiBtb3VzZSBldmVudHMgYW5kIGVudGVyaW5nIGZ1bGxzY3JlZW5cbiAgICBvbi5jYWxsKFxuICAgICAgcGxheWVyLFxuICAgICAgZWxlbWVudHMuY29udGFpbmVyLFxuICAgICAgJ21vdXNlbW92ZSBtb3VzZWxlYXZlIHRvdWNoc3RhcnQgdG91Y2htb3ZlIGVudGVyZnVsbHNjcmVlbiBleGl0ZnVsbHNjcmVlbicsXG4gICAgICAoZXZlbnQpID0+IHtcbiAgICAgICAgY29uc3QgeyBjb250cm9sczogY29udHJvbHNFbGVtZW50IH0gPSBlbGVtZW50cztcblxuICAgICAgICAvLyBSZW1vdmUgYnV0dG9uIHN0YXRlcyBmb3IgZnVsbHNjcmVlblxuICAgICAgICBpZiAoY29udHJvbHNFbGVtZW50ICYmIGV2ZW50LnR5cGUgPT09ICdlbnRlcmZ1bGxzY3JlZW4nKSB7XG4gICAgICAgICAgY29udHJvbHNFbGVtZW50LnByZXNzZWQgPSBmYWxzZTtcbiAgICAgICAgICBjb250cm9sc0VsZW1lbnQuaG92ZXIgPSBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFNob3csIHRoZW4gaGlkZSBhZnRlciBhIHRpbWVvdXQgdW5sZXNzIGFub3RoZXIgY29udHJvbCBldmVudCBvY2N1cnNcbiAgICAgICAgY29uc3Qgc2hvdyA9IFsndG91Y2hzdGFydCcsICd0b3VjaG1vdmUnLCAnbW91c2Vtb3ZlJ10uaW5jbHVkZXMoZXZlbnQudHlwZSk7XG4gICAgICAgIGxldCBkZWxheSA9IDA7XG5cbiAgICAgICAgaWYgKHNob3cpIHtcbiAgICAgICAgICB1aS50b2dnbGVDb250cm9scy5jYWxsKHBsYXllciwgdHJ1ZSk7XG4gICAgICAgICAgLy8gVXNlIGxvbmdlciB0aW1lb3V0IGZvciB0b3VjaCBkZXZpY2VzXG4gICAgICAgICAgZGVsYXkgPSBwbGF5ZXIudG91Y2ggPyAzMDAwIDogMjAwMDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENsZWFyIHRpbWVyXG4gICAgICAgIGNsZWFyVGltZW91dCh0aW1lcnMuY29udHJvbHMpO1xuXG4gICAgICAgIC8vIFNldCBuZXcgdGltZXIgdG8gcHJldmVudCBmbGlja2VyIHdoZW4gc2Vla2luZ1xuICAgICAgICB0aW1lcnMuY29udHJvbHMgPSBzZXRUaW1lb3V0KCgpID0+IHVpLnRvZ2dsZUNvbnRyb2xzLmNhbGwocGxheWVyLCBmYWxzZSksIGRlbGF5KTtcbiAgICAgIH0sXG4gICAgKTtcblxuICAgIC8vIFNldCBhIGd1dHRlciBmb3IgVmltZW9cbiAgICBjb25zdCBzZXRHdXR0ZXIgPSAoKSA9PiB7XG4gICAgICBpZiAoIXBsYXllci5pc1ZpbWVvIHx8IHBsYXllci5jb25maWcudmltZW8ucHJlbWl1bSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHRhcmdldCA9IGVsZW1lbnRzLndyYXBwZXI7XG4gICAgICBjb25zdCB7IGFjdGl2ZSB9ID0gcGxheWVyLmZ1bGxzY3JlZW47XG4gICAgICBjb25zdCBbdmlkZW9XaWR0aCwgdmlkZW9IZWlnaHRdID0gZ2V0QXNwZWN0UmF0aW8uY2FsbChwbGF5ZXIpO1xuICAgICAgY29uc3QgdXNlTmF0aXZlQXNwZWN0UmF0aW8gPSBzdXBwb3J0c0NTUyhgYXNwZWN0LXJhdGlvOiAke3ZpZGVvV2lkdGh9IC8gJHt2aWRlb0hlaWdodH1gKTtcblxuICAgICAgLy8gSWYgbm90IGFjdGl2ZSwgcmVtb3ZlIHN0eWxlc1xuICAgICAgaWYgKCFhY3RpdmUpIHtcbiAgICAgICAgaWYgKHVzZU5hdGl2ZUFzcGVjdFJhdGlvKSB7XG4gICAgICAgICAgdGFyZ2V0LnN0eWxlLndpZHRoID0gbnVsbDtcbiAgICAgICAgICB0YXJnZXQuc3R5bGUuaGVpZ2h0ID0gbnVsbDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0YXJnZXQuc3R5bGUubWF4V2lkdGggPSBudWxsO1xuICAgICAgICAgIHRhcmdldC5zdHlsZS5tYXJnaW4gPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgLy8gRGV0ZXJtaW5lIHdoaWNoIGRpbWVuc2lvbiB3aWxsIG92ZXJmbG93IGFuZCBjb25zdHJhaW4gdmlld1xuICAgICAgY29uc3QgW3ZpZXdwb3J0V2lkdGgsIHZpZXdwb3J0SGVpZ2h0XSA9IGdldFZpZXdwb3J0U2l6ZSgpO1xuICAgICAgY29uc3Qgb3ZlcmZsb3cgPSB2aWV3cG9ydFdpZHRoIC8gdmlld3BvcnRIZWlnaHQgPiB2aWRlb1dpZHRoIC8gdmlkZW9IZWlnaHQ7XG5cbiAgICAgIGlmICh1c2VOYXRpdmVBc3BlY3RSYXRpbykge1xuICAgICAgICB0YXJnZXQuc3R5bGUud2lkdGggPSBvdmVyZmxvdyA/ICdhdXRvJyA6ICcxMDAlJztcbiAgICAgICAgdGFyZ2V0LnN0eWxlLmhlaWdodCA9IG92ZXJmbG93ID8gJzEwMCUnIDogJ2F1dG8nO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGFyZ2V0LnN0eWxlLm1heFdpZHRoID0gb3ZlcmZsb3cgPyBgJHsodmlld3BvcnRIZWlnaHQgLyB2aWRlb0hlaWdodCkgKiB2aWRlb1dpZHRofXB4YCA6IG51bGw7XG4gICAgICAgIHRhcmdldC5zdHlsZS5tYXJnaW4gPSBvdmVyZmxvdyA/ICcwIGF1dG8nIDogbnVsbDtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgLy8gSGFuZGxlIHJlc2l6aW5nXG4gICAgY29uc3QgcmVzaXplZCA9ICgpID0+IHtcbiAgICAgIGNsZWFyVGltZW91dCh0aW1lcnMucmVzaXplZCk7XG4gICAgICB0aW1lcnMucmVzaXplZCA9IHNldFRpbWVvdXQoc2V0R3V0dGVyLCA1MCk7XG4gICAgfTtcblxuICAgIG9uLmNhbGwocGxheWVyLCBlbGVtZW50cy5jb250YWluZXIsICdlbnRlcmZ1bGxzY3JlZW4gZXhpdGZ1bGxzY3JlZW4nLCAoZXZlbnQpID0+IHtcbiAgICAgIGNvbnN0IHsgdGFyZ2V0IH0gPSBwbGF5ZXIuZnVsbHNjcmVlbjtcblxuICAgICAgLy8gSWdub3JlIGV2ZW50cyBub3QgZnJvbSB0YXJnZXRcbiAgICAgIGlmICh0YXJnZXQgIT09IGVsZW1lbnRzLmNvbnRhaW5lcikge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vIElmIGl0J3Mgbm90IGFuIGVtYmVkIGFuZCBubyByYXRpbyBzcGVjaWZpZWRcbiAgICAgIGlmICghcGxheWVyLmlzRW1iZWQgJiYgaXMuZW1wdHkocGxheWVyLmNvbmZpZy5yYXRpbykpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICAvLyBTZXQgVmltZW8gZ3V0dGVyXG4gICAgICBzZXRHdXR0ZXIoKTtcblxuICAgICAgLy8gV2F0Y2ggZm9yIHJlc2l6ZXNcbiAgICAgIGNvbnN0IG1ldGhvZCA9IGV2ZW50LnR5cGUgPT09ICdlbnRlcmZ1bGxzY3JlZW4nID8gb24gOiBvZmY7XG4gICAgICBtZXRob2QuY2FsbChwbGF5ZXIsIHdpbmRvdywgJ3Jlc2l6ZScsIHJlc2l6ZWQpO1xuICAgIH0pO1xuICB9O1xuXG4gIC8vIExpc3RlbiBmb3IgbWVkaWEgZXZlbnRzXG4gIG1lZGlhID0gKCkgPT4ge1xuICAgIGNvbnN0IHsgcGxheWVyIH0gPSB0aGlzO1xuICAgIGNvbnN0IHsgZWxlbWVudHMgfSA9IHBsYXllcjtcblxuICAgIC8vIFRpbWUgY2hhbmdlIG9uIG1lZGlhXG4gICAgb24uY2FsbChwbGF5ZXIsIHBsYXllci5tZWRpYSwgJ3RpbWV1cGRhdGUgc2Vla2luZyBzZWVrZWQnLCAoZXZlbnQpID0+IGNvbnRyb2xzLnRpbWVVcGRhdGUuY2FsbChwbGF5ZXIsIGV2ZW50KSk7XG5cbiAgICAvLyBEaXNwbGF5IGR1cmF0aW9uXG4gICAgb24uY2FsbChwbGF5ZXIsIHBsYXllci5tZWRpYSwgJ2R1cmF0aW9uY2hhbmdlIGxvYWRlZGRhdGEgbG9hZGVkbWV0YWRhdGEnLCAoZXZlbnQpID0+XG4gICAgICBjb250cm9scy5kdXJhdGlvblVwZGF0ZS5jYWxsKHBsYXllciwgZXZlbnQpLFxuICAgICk7XG5cbiAgICAvLyBIYW5kbGUgdGhlIG1lZGlhIGZpbmlzaGluZ1xuICAgIG9uLmNhbGwocGxheWVyLCBwbGF5ZXIubWVkaWEsICdlbmRlZCcsICgpID0+IHtcbiAgICAgIC8vIFNob3cgcG9zdGVyIG9uIGVuZFxuICAgICAgaWYgKHBsYXllci5pc0hUTUw1ICYmIHBsYXllci5pc1ZpZGVvICYmIHBsYXllci5jb25maWcucmVzZXRPbkVuZCkge1xuICAgICAgICAvLyBSZXN0YXJ0XG4gICAgICAgIHBsYXllci5yZXN0YXJ0KCk7XG5cbiAgICAgICAgLy8gQ2FsbCBwYXVzZSBvdGhlcndpc2UgSUUxMSB3aWxsIHN0YXJ0IHBsYXlpbmcgdGhlIHZpZGVvIGFnYWluXG4gICAgICAgIHBsYXllci5wYXVzZSgpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gQ2hlY2sgZm9yIGJ1ZmZlciBwcm9ncmVzc1xuICAgIG9uLmNhbGwocGxheWVyLCBwbGF5ZXIubWVkaWEsICdwcm9ncmVzcyBwbGF5aW5nIHNlZWtpbmcgc2Vla2VkJywgKGV2ZW50KSA9PlxuICAgICAgY29udHJvbHMudXBkYXRlUHJvZ3Jlc3MuY2FsbChwbGF5ZXIsIGV2ZW50KSxcbiAgICApO1xuXG4gICAgLy8gSGFuZGxlIHZvbHVtZSBjaGFuZ2VzXG4gICAgb24uY2FsbChwbGF5ZXIsIHBsYXllci5tZWRpYSwgJ3ZvbHVtZWNoYW5nZScsIChldmVudCkgPT4gY29udHJvbHMudXBkYXRlVm9sdW1lLmNhbGwocGxheWVyLCBldmVudCkpO1xuXG4gICAgLy8gSGFuZGxlIHBsYXkvcGF1c2VcbiAgICBvbi5jYWxsKHBsYXllciwgcGxheWVyLm1lZGlhLCAncGxheWluZyBwbGF5IHBhdXNlIGVuZGVkIGVtcHRpZWQgdGltZXVwZGF0ZScsIChldmVudCkgPT5cbiAgICAgIHVpLmNoZWNrUGxheWluZy5jYWxsKHBsYXllciwgZXZlbnQpLFxuICAgICk7XG5cbiAgICAvLyBMb2FkaW5nIHN0YXRlXG4gICAgb24uY2FsbChwbGF5ZXIsIHBsYXllci5tZWRpYSwgJ3dhaXRpbmcgY2FucGxheSBzZWVrZWQgcGxheWluZycsIChldmVudCkgPT4gdWkuY2hlY2tMb2FkaW5nLmNhbGwocGxheWVyLCBldmVudCkpO1xuXG4gICAgLy8gQ2xpY2sgdmlkZW9cbiAgICBpZiAocGxheWVyLnN1cHBvcnRlZC51aSAmJiBwbGF5ZXIuY29uZmlnLmNsaWNrVG9QbGF5ICYmICFwbGF5ZXIuaXNBdWRpbykge1xuICAgICAgLy8gUmUtZmV0Y2ggdGhlIHdyYXBwZXJcbiAgICAgIGNvbnN0IHdyYXBwZXIgPSBnZXRFbGVtZW50LmNhbGwocGxheWVyLCBgLiR7cGxheWVyLmNvbmZpZy5jbGFzc05hbWVzLnZpZGVvfWApO1xuXG4gICAgICAvLyBCYWlsIGlmIHRoZXJlJ3Mgbm8gd3JhcHBlciAodGhpcyBzaG91bGQgbmV2ZXIgaGFwcGVuKVxuICAgICAgaWYgKCFpcy5lbGVtZW50KHdyYXBwZXIpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgLy8gT24gY2xpY2sgcGxheSwgcGF1c2Ugb3IgcmVzdGFydFxuICAgICAgb24uY2FsbChwbGF5ZXIsIGVsZW1lbnRzLmNvbnRhaW5lciwgJ2NsaWNrJywgKGV2ZW50KSA9PiB7XG4gICAgICAgIGNvbnN0IHRhcmdldHMgPSBbZWxlbWVudHMuY29udGFpbmVyLCB3cmFwcGVyXTtcblxuICAgICAgICAvLyBJZ25vcmUgaWYgY2xpY2sgaWYgbm90IGNvbnRhaW5lciBvciBpbiB2aWRlbyB3cmFwcGVyXG4gICAgICAgIGlmICghdGFyZ2V0cy5pbmNsdWRlcyhldmVudC50YXJnZXQpICYmICF3cmFwcGVyLmNvbnRhaW5zKGV2ZW50LnRhcmdldCkpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICAvLyBUb3VjaCBkZXZpY2VzIHdpbGwganVzdCBzaG93IGNvbnRyb2xzIChpZiBoaWRkZW4pXG4gICAgICAgIGlmIChwbGF5ZXIudG91Y2ggJiYgcGxheWVyLmNvbmZpZy5oaWRlQ29udHJvbHMpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAocGxheWVyLmVuZGVkKSB7XG4gICAgICAgICAgdGhpcy5wcm94eShldmVudCwgcGxheWVyLnJlc3RhcnQsICdyZXN0YXJ0Jyk7XG4gICAgICAgICAgdGhpcy5wcm94eShcbiAgICAgICAgICAgIGV2ZW50LFxuICAgICAgICAgICAgKCkgPT4ge1xuICAgICAgICAgICAgICBzaWxlbmNlUHJvbWlzZShwbGF5ZXIucGxheSgpKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAncGxheScsXG4gICAgICAgICAgKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLnByb3h5KFxuICAgICAgICAgICAgZXZlbnQsXG4gICAgICAgICAgICAoKSA9PiB7XG4gICAgICAgICAgICAgIHNpbGVuY2VQcm9taXNlKHBsYXllci50b2dnbGVQbGF5KCkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICdwbGF5JyxcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBEaXNhYmxlIHJpZ2h0IGNsaWNrXG4gICAgaWYgKHBsYXllci5zdXBwb3J0ZWQudWkgJiYgcGxheWVyLmNvbmZpZy5kaXNhYmxlQ29udGV4dE1lbnUpIHtcbiAgICAgIG9uLmNhbGwoXG4gICAgICAgIHBsYXllcixcbiAgICAgICAgZWxlbWVudHMud3JhcHBlcixcbiAgICAgICAgJ2NvbnRleHRtZW51JyxcbiAgICAgICAgKGV2ZW50KSA9PiB7XG4gICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgfSxcbiAgICAgICAgZmFsc2UsXG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIFZvbHVtZSBjaGFuZ2VcbiAgICBvbi5jYWxsKHBsYXllciwgcGxheWVyLm1lZGlhLCAndm9sdW1lY2hhbmdlJywgKCkgPT4ge1xuICAgICAgLy8gU2F2ZSB0byBzdG9yYWdlXG4gICAgICBwbGF5ZXIuc3RvcmFnZS5zZXQoe1xuICAgICAgICB2b2x1bWU6IHBsYXllci52b2x1bWUsXG4gICAgICAgIG11dGVkOiBwbGF5ZXIubXV0ZWQsXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIC8vIFNwZWVkIGNoYW5nZVxuICAgIG9uLmNhbGwocGxheWVyLCBwbGF5ZXIubWVkaWEsICdyYXRlY2hhbmdlJywgKCkgPT4ge1xuICAgICAgLy8gVXBkYXRlIFVJXG4gICAgICBjb250cm9scy51cGRhdGVTZXR0aW5nLmNhbGwocGxheWVyLCAnc3BlZWQnKTtcblxuICAgICAgLy8gU2F2ZSB0byBzdG9yYWdlXG4gICAgICBwbGF5ZXIuc3RvcmFnZS5zZXQoeyBzcGVlZDogcGxheWVyLnNwZWVkIH0pO1xuICAgIH0pO1xuXG4gICAgLy8gUXVhbGl0eSBjaGFuZ2VcbiAgICBvbi5jYWxsKHBsYXllciwgcGxheWVyLm1lZGlhLCAncXVhbGl0eWNoYW5nZScsIChldmVudCkgPT4ge1xuICAgICAgLy8gVXBkYXRlIFVJXG4gICAgICBjb250cm9scy51cGRhdGVTZXR0aW5nLmNhbGwocGxheWVyLCAncXVhbGl0eScsIG51bGwsIGV2ZW50LmRldGFpbC5xdWFsaXR5KTtcbiAgICB9KTtcblxuICAgIC8vIFVwZGF0ZSBkb3dubG9hZCBsaW5rIHdoZW4gcmVhZHkgYW5kIGlmIHF1YWxpdHkgY2hhbmdlc1xuICAgIG9uLmNhbGwocGxheWVyLCBwbGF5ZXIubWVkaWEsICdyZWFkeSBxdWFsaXR5Y2hhbmdlJywgKCkgPT4ge1xuICAgICAgY29udHJvbHMuc2V0RG93bmxvYWRVcmwuY2FsbChwbGF5ZXIpO1xuICAgIH0pO1xuXG4gICAgLy8gUHJveHkgZXZlbnRzIHRvIGNvbnRhaW5lclxuICAgIC8vIEJ1YmJsZSB1cCBrZXkgZXZlbnRzIGZvciBFZGdlXG4gICAgY29uc3QgcHJveHlFdmVudHMgPSBwbGF5ZXIuY29uZmlnLmV2ZW50cy5jb25jYXQoWydrZXl1cCcsICdrZXlkb3duJ10pLmpvaW4oJyAnKTtcblxuICAgIG9uLmNhbGwocGxheWVyLCBwbGF5ZXIubWVkaWEsIHByb3h5RXZlbnRzLCAoZXZlbnQpID0+IHtcbiAgICAgIGxldCB7IGRldGFpbCA9IHt9IH0gPSBldmVudDtcblxuICAgICAgLy8gR2V0IGVycm9yIGRldGFpbHMgZnJvbSBtZWRpYVxuICAgICAgaWYgKGV2ZW50LnR5cGUgPT09ICdlcnJvcicpIHtcbiAgICAgICAgZGV0YWlsID0gcGxheWVyLm1lZGlhLmVycm9yO1xuICAgICAgfVxuXG4gICAgICB0cmlnZ2VyRXZlbnQuY2FsbChwbGF5ZXIsIGVsZW1lbnRzLmNvbnRhaW5lciwgZXZlbnQudHlwZSwgdHJ1ZSwgZGV0YWlsKTtcbiAgICB9KTtcbiAgfTtcblxuICAvLyBSdW4gZGVmYXVsdCBhbmQgY3VzdG9tIGhhbmRsZXJzXG4gIHByb3h5ID0gKGV2ZW50LCBkZWZhdWx0SGFuZGxlciwgY3VzdG9tSGFuZGxlcktleSkgPT4ge1xuICAgIGNvbnN0IHsgcGxheWVyIH0gPSB0aGlzO1xuICAgIGNvbnN0IGN1c3RvbUhhbmRsZXIgPSBwbGF5ZXIuY29uZmlnLmxpc3RlbmVyc1tjdXN0b21IYW5kbGVyS2V5XTtcbiAgICBjb25zdCBoYXNDdXN0b21IYW5kbGVyID0gaXMuZnVuY3Rpb24oY3VzdG9tSGFuZGxlcik7XG4gICAgbGV0IHJldHVybmVkID0gdHJ1ZTtcblxuICAgIC8vIEV4ZWN1dGUgY3VzdG9tIGhhbmRsZXJcbiAgICBpZiAoaGFzQ3VzdG9tSGFuZGxlcikge1xuICAgICAgcmV0dXJuZWQgPSBjdXN0b21IYW5kbGVyLmNhbGwocGxheWVyLCBldmVudCk7XG4gICAgfVxuXG4gICAgLy8gT25seSBjYWxsIGRlZmF1bHQgaGFuZGxlciBpZiBub3QgcHJldmVudGVkIGluIGN1c3RvbSBoYW5kbGVyXG4gICAgaWYgKHJldHVybmVkICE9PSBmYWxzZSAmJiBpcy5mdW5jdGlvbihkZWZhdWx0SGFuZGxlcikpIHtcbiAgICAgIGRlZmF1bHRIYW5kbGVyLmNhbGwocGxheWVyLCBldmVudCk7XG4gICAgfVxuICB9O1xuXG4gIC8vIFRyaWdnZXIgY3VzdG9tIGFuZCBkZWZhdWx0IGhhbmRsZXJzXG4gIGJpbmQgPSAoZWxlbWVudCwgdHlwZSwgZGVmYXVsdEhhbmRsZXIsIGN1c3RvbUhhbmRsZXJLZXksIHBhc3NpdmUgPSB0cnVlKSA9PiB7XG4gICAgY29uc3QgeyBwbGF5ZXIgfSA9IHRoaXM7XG4gICAgY29uc3QgY3VzdG9tSGFuZGxlciA9IHBsYXllci5jb25maWcubGlzdGVuZXJzW2N1c3RvbUhhbmRsZXJLZXldO1xuICAgIGNvbnN0IGhhc0N1c3RvbUhhbmRsZXIgPSBpcy5mdW5jdGlvbihjdXN0b21IYW5kbGVyKTtcblxuICAgIG9uLmNhbGwoXG4gICAgICBwbGF5ZXIsXG4gICAgICBlbGVtZW50LFxuICAgICAgdHlwZSxcbiAgICAgIChldmVudCkgPT4gdGhpcy5wcm94eShldmVudCwgZGVmYXVsdEhhbmRsZXIsIGN1c3RvbUhhbmRsZXJLZXkpLFxuICAgICAgcGFzc2l2ZSAmJiAhaGFzQ3VzdG9tSGFuZGxlcixcbiAgICApO1xuICB9O1xuXG4gIC8vIExpc3RlbiBmb3IgY29udHJvbCBldmVudHNcbiAgY29udHJvbHMgPSAoKSA9PiB7XG4gICAgY29uc3QgeyBwbGF5ZXIgfSA9IHRoaXM7XG4gICAgY29uc3QgeyBlbGVtZW50cyB9ID0gcGxheWVyO1xuICAgIC8vIElFIGRvZXNuJ3Qgc3VwcG9ydCBpbnB1dCBldmVudCwgc28gd2UgZmFsbGJhY2sgdG8gY2hhbmdlXG4gICAgY29uc3QgaW5wdXRFdmVudCA9IGJyb3dzZXIuaXNJRSA/ICdjaGFuZ2UnIDogJ2lucHV0JztcblxuICAgIC8vIFBsYXkvcGF1c2UgdG9nZ2xlXG4gICAgaWYgKGVsZW1lbnRzLmJ1dHRvbnMucGxheSkge1xuICAgICAgQXJyYXkuZnJvbShlbGVtZW50cy5idXR0b25zLnBsYXkpLmZvckVhY2goKGJ1dHRvbikgPT4ge1xuICAgICAgICB0aGlzLmJpbmQoXG4gICAgICAgICAgYnV0dG9uLFxuICAgICAgICAgICdjbGljaycsXG4gICAgICAgICAgKCkgPT4ge1xuICAgICAgICAgICAgc2lsZW5jZVByb21pc2UocGxheWVyLnRvZ2dsZVBsYXkoKSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICAncGxheScsXG4gICAgICAgICk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBQYXVzZVxuICAgIHRoaXMuYmluZChlbGVtZW50cy5idXR0b25zLnJlc3RhcnQsICdjbGljaycsIHBsYXllci5yZXN0YXJ0LCAncmVzdGFydCcpO1xuXG4gICAgLy8gUmV3aW5kXG4gICAgdGhpcy5iaW5kKFxuICAgICAgZWxlbWVudHMuYnV0dG9ucy5yZXdpbmQsXG4gICAgICAnY2xpY2snLFxuICAgICAgKCkgPT4ge1xuICAgICAgICAvLyBSZWNvcmQgc2VlayB0aW1lIHNvIHdlIGNhbiBwcmV2ZW50IGhpZGluZyBjb250cm9scyBmb3IgYSBmZXcgc2Vjb25kcyBhZnRlciByZXdpbmRcbiAgICAgICAgcGxheWVyLmxhc3RTZWVrVGltZSA9IERhdGUubm93KCk7XG4gICAgICAgIHBsYXllci5yZXdpbmQoKTtcbiAgICAgIH0sXG4gICAgICAncmV3aW5kJyxcbiAgICApO1xuXG4gICAgLy8gUmV3aW5kXG4gICAgdGhpcy5iaW5kKFxuICAgICAgZWxlbWVudHMuYnV0dG9ucy5mYXN0Rm9yd2FyZCxcbiAgICAgICdjbGljaycsXG4gICAgICAoKSA9PiB7XG4gICAgICAgIC8vIFJlY29yZCBzZWVrIHRpbWUgc28gd2UgY2FuIHByZXZlbnQgaGlkaW5nIGNvbnRyb2xzIGZvciBhIGZldyBzZWNvbmRzIGFmdGVyIGZhc3QgZm9yd2FyZFxuICAgICAgICBwbGF5ZXIubGFzdFNlZWtUaW1lID0gRGF0ZS5ub3coKTtcbiAgICAgICAgcGxheWVyLmZvcndhcmQoKTtcbiAgICAgIH0sXG4gICAgICAnZmFzdEZvcndhcmQnLFxuICAgICk7XG5cbiAgICAvLyBNdXRlIHRvZ2dsZVxuICAgIHRoaXMuYmluZChcbiAgICAgIGVsZW1lbnRzLmJ1dHRvbnMubXV0ZSxcbiAgICAgICdjbGljaycsXG4gICAgICAoKSA9PiB7XG4gICAgICAgIHBsYXllci5tdXRlZCA9ICFwbGF5ZXIubXV0ZWQ7XG4gICAgICB9LFxuICAgICAgJ211dGUnLFxuICAgICk7XG5cbiAgICAvLyBDYXB0aW9ucyB0b2dnbGVcbiAgICB0aGlzLmJpbmQoZWxlbWVudHMuYnV0dG9ucy5jYXB0aW9ucywgJ2NsaWNrJywgKCkgPT4gcGxheWVyLnRvZ2dsZUNhcHRpb25zKCkpO1xuXG4gICAgLy8gRG93bmxvYWRcbiAgICB0aGlzLmJpbmQoXG4gICAgICBlbGVtZW50cy5idXR0b25zLmRvd25sb2FkLFxuICAgICAgJ2NsaWNrJyxcbiAgICAgICgpID0+IHtcbiAgICAgICAgdHJpZ2dlckV2ZW50LmNhbGwocGxheWVyLCBwbGF5ZXIubWVkaWEsICdkb3dubG9hZCcpO1xuICAgICAgfSxcbiAgICAgICdkb3dubG9hZCcsXG4gICAgKTtcblxuICAgIC8vIEZ1bGxzY3JlZW4gdG9nZ2xlXG4gICAgdGhpcy5iaW5kKFxuICAgICAgZWxlbWVudHMuYnV0dG9ucy5mdWxsc2NyZWVuLFxuICAgICAgJ2NsaWNrJyxcbiAgICAgICgpID0+IHtcbiAgICAgICAgcGxheWVyLmZ1bGxzY3JlZW4udG9nZ2xlKCk7XG4gICAgICB9LFxuICAgICAgJ2Z1bGxzY3JlZW4nLFxuICAgICk7XG5cbiAgICAvLyBQaWN0dXJlLWluLVBpY3R1cmVcbiAgICB0aGlzLmJpbmQoXG4gICAgICBlbGVtZW50cy5idXR0b25zLnBpcCxcbiAgICAgICdjbGljaycsXG4gICAgICAoKSA9PiB7XG4gICAgICAgIHBsYXllci5waXAgPSAndG9nZ2xlJztcbiAgICAgIH0sXG4gICAgICAncGlwJyxcbiAgICApO1xuXG4gICAgLy8gQWlycGxheVxuICAgIHRoaXMuYmluZChlbGVtZW50cy5idXR0b25zLmFpcnBsYXksICdjbGljaycsIHBsYXllci5haXJwbGF5LCAnYWlycGxheScpO1xuXG4gICAgLy8gU2V0dGluZ3MgbWVudSAtIGNsaWNrIHRvZ2dsZVxuICAgIHRoaXMuYmluZChcbiAgICAgIGVsZW1lbnRzLmJ1dHRvbnMuc2V0dGluZ3MsXG4gICAgICAnY2xpY2snLFxuICAgICAgKGV2ZW50KSA9PiB7XG4gICAgICAgIC8vIFByZXZlbnQgdGhlIGRvY3VtZW50IGNsaWNrIGxpc3RlbmVyIGNsb3NpbmcgdGhlIG1lbnVcbiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgY29udHJvbHMudG9nZ2xlTWVudS5jYWxsKHBsYXllciwgZXZlbnQpO1xuICAgICAgfSxcbiAgICAgIG51bGwsXG4gICAgICBmYWxzZSxcbiAgICApOyAvLyBDYW4ndCBiZSBwYXNzaXZlIGFzIHdlJ3JlIHByZXZlbnRpbmcgZGVmYXVsdFxuXG4gICAgLy8gU2V0dGluZ3MgbWVudSAtIGtleWJvYXJkIHRvZ2dsZVxuICAgIC8vIFdlIGhhdmUgdG8gYmluZCB0byBrZXl1cCBvdGhlcndpc2UgRmlyZWZveCB0cmlnZ2VycyBhIGNsaWNrIHdoZW4gYSBrZXlkb3duIGV2ZW50IGhhbmRsZXIgc2hpZnRzIGZvY3VzXG4gICAgLy8gaHR0cHM6Ly9idWd6aWxsYS5tb3ppbGxhLm9yZy9zaG93X2J1Zy5jZ2k/aWQ9MTIyMDE0M1xuICAgIHRoaXMuYmluZChcbiAgICAgIGVsZW1lbnRzLmJ1dHRvbnMuc2V0dGluZ3MsXG4gICAgICAna2V5dXAnLFxuICAgICAgKGV2ZW50KSA9PiB7XG4gICAgICAgIGlmICghWydTcGFjZScsICdFbnRlciddLmluY2x1ZGVzKGV2ZW50LmtleSkpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICAvLyBCZWNhdXNlIHJldHVybiB0cmlnZ2VycyBhIGNsaWNrIGFueXdheSwgYWxsIHdlIG5lZWQgdG8gZG8gaXMgc2V0IGZvY3VzXG4gICAgICAgIGlmIChldmVudC5rZXkgPT09ICdFbnRlcicpIHtcbiAgICAgICAgICBjb250cm9scy5mb2N1c0ZpcnN0TWVudUl0ZW0uY2FsbChwbGF5ZXIsIG51bGwsIHRydWUpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFByZXZlbnQgc2Nyb2xsXG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgLy8gUHJldmVudCBwbGF5aW5nIHZpZGVvIChGaXJlZm94KVxuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcblxuICAgICAgICAvLyBUb2dnbGUgbWVudVxuICAgICAgICBjb250cm9scy50b2dnbGVNZW51LmNhbGwocGxheWVyLCBldmVudCk7XG4gICAgICB9LFxuICAgICAgbnVsbCxcbiAgICAgIGZhbHNlLCAvLyBDYW4ndCBiZSBwYXNzaXZlIGFzIHdlJ3JlIHByZXZlbnRpbmcgZGVmYXVsdFxuICAgICk7XG5cbiAgICAvLyBFc2NhcGUgY2xvc2VzIG1lbnVcbiAgICB0aGlzLmJpbmQoZWxlbWVudHMuc2V0dGluZ3MubWVudSwgJ2tleWRvd24nLCAoZXZlbnQpID0+IHtcbiAgICAgIGlmIChldmVudC5rZXkgPT09ICdFc2NhcGUnKSB7XG4gICAgICAgIGNvbnRyb2xzLnRvZ2dsZU1lbnUuY2FsbChwbGF5ZXIsIGV2ZW50KTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIFNldCByYW5nZSBpbnB1dCBhbHRlcm5hdGl2ZSBcInZhbHVlXCIsIHdoaWNoIG1hdGNoZXMgdGhlIHRvb2x0aXAgdGltZSAoIzk1NClcbiAgICB0aGlzLmJpbmQoZWxlbWVudHMuaW5wdXRzLnNlZWssICdtb3VzZWRvd24gbW91c2Vtb3ZlJywgKGV2ZW50KSA9PiB7XG4gICAgICBjb25zdCByZWN0ID0gZWxlbWVudHMucHJvZ3Jlc3MuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICBjb25zdCBwZXJjZW50ID0gKDEwMCAvIHJlY3Qud2lkdGgpICogKGV2ZW50LnBhZ2VYIC0gcmVjdC5sZWZ0KTtcbiAgICAgIGV2ZW50LmN1cnJlbnRUYXJnZXQuc2V0QXR0cmlidXRlKCdzZWVrLXZhbHVlJywgcGVyY2VudCk7XG4gICAgfSk7XG5cbiAgICAvLyBQYXVzZSB3aGlsZSBzZWVraW5nXG4gICAgdGhpcy5iaW5kKGVsZW1lbnRzLmlucHV0cy5zZWVrLCAnbW91c2Vkb3duIG1vdXNldXAga2V5ZG93biBrZXl1cCB0b3VjaHN0YXJ0IHRvdWNoZW5kJywgKGV2ZW50KSA9PiB7XG4gICAgICBjb25zdCBzZWVrID0gZXZlbnQuY3VycmVudFRhcmdldDtcbiAgICAgIGNvbnN0IGF0dHJpYnV0ZSA9ICdwbGF5LW9uLXNlZWtlZCc7XG5cbiAgICAgIGlmIChpcy5rZXlib2FyZEV2ZW50KGV2ZW50KSAmJiAhWydBcnJvd0xlZnQnLCAnQXJyb3dSaWdodCddLmluY2x1ZGVzKGV2ZW50LmtleSkpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICAvLyBSZWNvcmQgc2VlayB0aW1lIHNvIHdlIGNhbiBwcmV2ZW50IGhpZGluZyBjb250cm9scyBmb3IgYSBmZXcgc2Vjb25kcyBhZnRlciBzZWVrXG4gICAgICBwbGF5ZXIubGFzdFNlZWtUaW1lID0gRGF0ZS5ub3coKTtcblxuICAgICAgLy8gV2FzIHBsYXlpbmcgYmVmb3JlP1xuICAgICAgY29uc3QgcGxheSA9IHNlZWsuaGFzQXR0cmlidXRlKGF0dHJpYnV0ZSk7XG4gICAgICAvLyBEb25lIHNlZWtpbmdcbiAgICAgIGNvbnN0IGRvbmUgPSBbJ21vdXNldXAnLCAndG91Y2hlbmQnLCAna2V5dXAnXS5pbmNsdWRlcyhldmVudC50eXBlKTtcblxuICAgICAgLy8gSWYgd2UncmUgZG9uZSBzZWVraW5nIGFuZCBpdCB3YXMgcGxheWluZywgcmVzdW1lIHBsYXliYWNrXG4gICAgICBpZiAocGxheSAmJiBkb25lKSB7XG4gICAgICAgIHNlZWsucmVtb3ZlQXR0cmlidXRlKGF0dHJpYnV0ZSk7XG4gICAgICAgIHNpbGVuY2VQcm9taXNlKHBsYXllci5wbGF5KCkpO1xuICAgICAgfSBlbHNlIGlmICghZG9uZSAmJiBwbGF5ZXIucGxheWluZykge1xuICAgICAgICBzZWVrLnNldEF0dHJpYnV0ZShhdHRyaWJ1dGUsICcnKTtcbiAgICAgICAgcGxheWVyLnBhdXNlKCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBGaXggcmFuZ2UgaW5wdXRzIG9uIGlPU1xuICAgIC8vIFN1cGVyIHdlaXJkIGlPUyBidWcgd2hlcmUgYWZ0ZXIgeW91IGludGVyYWN0IHdpdGggYW4gPGlucHV0IHR5cGU9XCJyYW5nZVwiPixcbiAgICAvLyBpdCB0YWtlcyBvdmVyIGZ1cnRoZXIgaW50ZXJhY3Rpb25zIG9uIHRoZSBwYWdlLiBUaGlzIGlzIGEgaGFja1xuICAgIGlmIChicm93c2VyLmlzSW9zKSB7XG4gICAgICBjb25zdCBpbnB1dHMgPSBnZXRFbGVtZW50cy5jYWxsKHBsYXllciwgJ2lucHV0W3R5cGU9XCJyYW5nZVwiXScpO1xuICAgICAgQXJyYXkuZnJvbShpbnB1dHMpLmZvckVhY2goKGlucHV0KSA9PiB0aGlzLmJpbmQoaW5wdXQsIGlucHV0RXZlbnQsIChldmVudCkgPT4gcmVwYWludChldmVudC50YXJnZXQpKSk7XG4gICAgfVxuXG4gICAgLy8gU2Vla1xuICAgIHRoaXMuYmluZChcbiAgICAgIGVsZW1lbnRzLmlucHV0cy5zZWVrLFxuICAgICAgaW5wdXRFdmVudCxcbiAgICAgIChldmVudCkgPT4ge1xuICAgICAgICBjb25zdCBzZWVrID0gZXZlbnQuY3VycmVudFRhcmdldDtcbiAgICAgICAgLy8gSWYgaXQgZXhpc3RzLCB1c2Ugc2Vlay12YWx1ZSBpbnN0ZWFkIG9mIFwidmFsdWVcIiBmb3IgY29uc2lzdGVuY3kgd2l0aCB0b29sdGlwIHRpbWUgKCM5NTQpXG4gICAgICAgIGxldCBzZWVrVG8gPSBzZWVrLmdldEF0dHJpYnV0ZSgnc2Vlay12YWx1ZScpO1xuXG4gICAgICAgIGlmIChpcy5lbXB0eShzZWVrVG8pKSB7XG4gICAgICAgICAgc2Vla1RvID0gc2Vlay52YWx1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHNlZWsucmVtb3ZlQXR0cmlidXRlKCdzZWVrLXZhbHVlJyk7XG5cbiAgICAgICAgcGxheWVyLmN1cnJlbnRUaW1lID0gKHNlZWtUbyAvIHNlZWsubWF4KSAqIHBsYXllci5kdXJhdGlvbjtcbiAgICAgIH0sXG4gICAgICAnc2VlaycsXG4gICAgKTtcblxuICAgIC8vIFNlZWsgdG9vbHRpcFxuICAgIHRoaXMuYmluZChlbGVtZW50cy5wcm9ncmVzcywgJ21vdXNlZW50ZXIgbW91c2VsZWF2ZSBtb3VzZW1vdmUnLCAoZXZlbnQpID0+XG4gICAgICBjb250cm9scy51cGRhdGVTZWVrVG9vbHRpcC5jYWxsKHBsYXllciwgZXZlbnQpLFxuICAgICk7XG5cbiAgICAvLyBQcmV2aWV3IHRodW1ibmFpbHMgcGx1Z2luXG4gICAgLy8gVE9ETzogUmVhbGx5IG5lZWQgdG8gd29yayBvbiBzb21lIHNvcnQgb2YgcGx1Zy1pbiB3aWRlIGV2ZW50IGJ1cyBvciBwdWItc3ViIGZvciB0aGlzXG4gICAgdGhpcy5iaW5kKGVsZW1lbnRzLnByb2dyZXNzLCAnbW91c2Vtb3ZlIHRvdWNobW92ZScsIChldmVudCkgPT4ge1xuICAgICAgY29uc3QgeyBwcmV2aWV3VGh1bWJuYWlscyB9ID0gcGxheWVyO1xuXG4gICAgICBpZiAocHJldmlld1RodW1ibmFpbHMgJiYgcHJldmlld1RodW1ibmFpbHMubG9hZGVkKSB7XG4gICAgICAgIHByZXZpZXdUaHVtYm5haWxzLnN0YXJ0TW92ZShldmVudCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBIaWRlIHRodW1ibmFpbCBwcmV2aWV3IC0gb24gbW91c2UgY2xpY2ssIG1vdXNlIGxlYXZlLCBhbmQgdmlkZW8gcGxheS9zZWVrLiBBbGwgZm91ciBhcmUgcmVxdWlyZWQsIGUuZy4sIGZvciBidWZmZXJpbmdcbiAgICB0aGlzLmJpbmQoZWxlbWVudHMucHJvZ3Jlc3MsICdtb3VzZWxlYXZlIHRvdWNoZW5kIGNsaWNrJywgKCkgPT4ge1xuICAgICAgY29uc3QgeyBwcmV2aWV3VGh1bWJuYWlscyB9ID0gcGxheWVyO1xuXG4gICAgICBpZiAocHJldmlld1RodW1ibmFpbHMgJiYgcHJldmlld1RodW1ibmFpbHMubG9hZGVkKSB7XG4gICAgICAgIHByZXZpZXdUaHVtYm5haWxzLmVuZE1vdmUoZmFsc2UsIHRydWUpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gU2hvdyBzY3J1YmJpbmcgcHJldmlld1xuICAgIHRoaXMuYmluZChlbGVtZW50cy5wcm9ncmVzcywgJ21vdXNlZG93biB0b3VjaHN0YXJ0JywgKGV2ZW50KSA9PiB7XG4gICAgICBjb25zdCB7IHByZXZpZXdUaHVtYm5haWxzIH0gPSBwbGF5ZXI7XG5cbiAgICAgIGlmIChwcmV2aWV3VGh1bWJuYWlscyAmJiBwcmV2aWV3VGh1bWJuYWlscy5sb2FkZWQpIHtcbiAgICAgICAgcHJldmlld1RodW1ibmFpbHMuc3RhcnRTY3J1YmJpbmcoZXZlbnQpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgdGhpcy5iaW5kKGVsZW1lbnRzLnByb2dyZXNzLCAnbW91c2V1cCB0b3VjaGVuZCcsIChldmVudCkgPT4ge1xuICAgICAgY29uc3QgeyBwcmV2aWV3VGh1bWJuYWlscyB9ID0gcGxheWVyO1xuXG4gICAgICBpZiAocHJldmlld1RodW1ibmFpbHMgJiYgcHJldmlld1RodW1ibmFpbHMubG9hZGVkKSB7XG4gICAgICAgIHByZXZpZXdUaHVtYm5haWxzLmVuZFNjcnViYmluZyhldmVudCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBQb2x5ZmlsbCBmb3IgbG93ZXIgZmlsbCBpbiA8aW5wdXQgdHlwZT1cInJhbmdlXCI+IGZvciB3ZWJraXRcbiAgICBpZiAoYnJvd3Nlci5pc1dlYmtpdCkge1xuICAgICAgQXJyYXkuZnJvbShnZXRFbGVtZW50cy5jYWxsKHBsYXllciwgJ2lucHV0W3R5cGU9XCJyYW5nZVwiXScpKS5mb3JFYWNoKChlbGVtZW50KSA9PiB7XG4gICAgICAgIHRoaXMuYmluZChlbGVtZW50LCAnaW5wdXQnLCAoZXZlbnQpID0+IGNvbnRyb2xzLnVwZGF0ZVJhbmdlRmlsbC5jYWxsKHBsYXllciwgZXZlbnQudGFyZ2V0KSk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBDdXJyZW50IHRpbWUgaW52ZXJ0XG4gICAgLy8gT25seSBpZiBvbmUgdGltZSBlbGVtZW50IGlzIHVzZWQgZm9yIGJvdGggY3VycmVudFRpbWUgYW5kIGR1cmF0aW9uXG4gICAgaWYgKHBsYXllci5jb25maWcudG9nZ2xlSW52ZXJ0ICYmICFpcy5lbGVtZW50KGVsZW1lbnRzLmRpc3BsYXkuZHVyYXRpb24pKSB7XG4gICAgICB0aGlzLmJpbmQoZWxlbWVudHMuZGlzcGxheS5jdXJyZW50VGltZSwgJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgICAvLyBEbyBub3RoaW5nIGlmIHdlJ3JlIGF0IHRoZSBzdGFydFxuICAgICAgICBpZiAocGxheWVyLmN1cnJlbnRUaW1lID09PSAwKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgcGxheWVyLmNvbmZpZy5pbnZlcnRUaW1lID0gIXBsYXllci5jb25maWcuaW52ZXJ0VGltZTtcblxuICAgICAgICBjb250cm9scy50aW1lVXBkYXRlLmNhbGwocGxheWVyKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIFZvbHVtZVxuICAgIHRoaXMuYmluZChcbiAgICAgIGVsZW1lbnRzLmlucHV0cy52b2x1bWUsXG4gICAgICBpbnB1dEV2ZW50LFxuICAgICAgKGV2ZW50KSA9PiB7XG4gICAgICAgIHBsYXllci52b2x1bWUgPSBldmVudC50YXJnZXQudmFsdWU7XG4gICAgICB9LFxuICAgICAgJ3ZvbHVtZScsXG4gICAgKTtcblxuICAgIC8vIFVwZGF0ZSBjb250cm9scy5ob3ZlciBzdGF0ZSAodXNlZCBmb3IgdWkudG9nZ2xlQ29udHJvbHMgdG8gYXZvaWQgaGlkaW5nIHdoZW4gaW50ZXJhY3RpbmcpXG4gICAgdGhpcy5iaW5kKGVsZW1lbnRzLmNvbnRyb2xzLCAnbW91c2VlbnRlciBtb3VzZWxlYXZlJywgKGV2ZW50KSA9PiB7XG4gICAgICBlbGVtZW50cy5jb250cm9scy5ob3ZlciA9ICFwbGF5ZXIudG91Y2ggJiYgZXZlbnQudHlwZSA9PT0gJ21vdXNlZW50ZXInO1xuICAgIH0pO1xuXG4gICAgLy8gQWxzbyB1cGRhdGUgY29udHJvbHMuaG92ZXIgc3RhdGUgZm9yIGFueSBub24tcGxheWVyIGNoaWxkcmVuIG9mIGZ1bGxzY3JlZW4gZWxlbWVudCAoYXMgYWJvdmUpXG4gICAgaWYgKGVsZW1lbnRzLmZ1bGxzY3JlZW4pIHtcbiAgICAgIEFycmF5LmZyb20oZWxlbWVudHMuZnVsbHNjcmVlbi5jaGlsZHJlbilcbiAgICAgICAgLmZpbHRlcigoYykgPT4gIWMuY29udGFpbnMoZWxlbWVudHMuY29udGFpbmVyKSlcbiAgICAgICAgLmZvckVhY2goKGNoaWxkKSA9PiB7XG4gICAgICAgICAgdGhpcy5iaW5kKGNoaWxkLCAnbW91c2VlbnRlciBtb3VzZWxlYXZlJywgKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICBpZiAoZWxlbWVudHMuY29udHJvbHMpIHtcbiAgICAgICAgICAgICAgZWxlbWVudHMuY29udHJvbHMuaG92ZXIgPSAhcGxheWVyLnRvdWNoICYmIGV2ZW50LnR5cGUgPT09ICdtb3VzZWVudGVyJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gVXBkYXRlIGNvbnRyb2xzLnByZXNzZWQgc3RhdGUgKHVzZWQgZm9yIHVpLnRvZ2dsZUNvbnRyb2xzIHRvIGF2b2lkIGhpZGluZyB3aGVuIGludGVyYWN0aW5nKVxuICAgIHRoaXMuYmluZChlbGVtZW50cy5jb250cm9scywgJ21vdXNlZG93biBtb3VzZXVwIHRvdWNoc3RhcnQgdG91Y2hlbmQgdG91Y2hjYW5jZWwnLCAoZXZlbnQpID0+IHtcbiAgICAgIGVsZW1lbnRzLmNvbnRyb2xzLnByZXNzZWQgPSBbJ21vdXNlZG93bicsICd0b3VjaHN0YXJ0J10uaW5jbHVkZXMoZXZlbnQudHlwZSk7XG4gICAgfSk7XG5cbiAgICAvLyBTaG93IGNvbnRyb2xzIHdoZW4gdGhleSByZWNlaXZlIGZvY3VzIChlLmcuLCB3aGVuIHVzaW5nIGtleWJvYXJkIHRhYiBrZXkpXG4gICAgdGhpcy5iaW5kKGVsZW1lbnRzLmNvbnRyb2xzLCAnZm9jdXNpbicsICgpID0+IHtcbiAgICAgIGNvbnN0IHsgY29uZmlnLCB0aW1lcnMgfSA9IHBsYXllcjtcblxuICAgICAgLy8gU2tpcCB0cmFuc2l0aW9uIHRvIHByZXZlbnQgZm9jdXMgZnJvbSBzY3JvbGxpbmcgdGhlIHBhcmVudCBlbGVtZW50XG4gICAgICB0b2dnbGVDbGFzcyhlbGVtZW50cy5jb250cm9scywgY29uZmlnLmNsYXNzTmFtZXMubm9UcmFuc2l0aW9uLCB0cnVlKTtcblxuICAgICAgLy8gVG9nZ2xlXG4gICAgICB1aS50b2dnbGVDb250cm9scy5jYWxsKHBsYXllciwgdHJ1ZSk7XG5cbiAgICAgIC8vIFJlc3RvcmUgdHJhbnNpdGlvblxuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIHRvZ2dsZUNsYXNzKGVsZW1lbnRzLmNvbnRyb2xzLCBjb25maWcuY2xhc3NOYW1lcy5ub1RyYW5zaXRpb24sIGZhbHNlKTtcbiAgICAgIH0sIDApO1xuXG4gICAgICAvLyBEZWxheSBhIGxpdHRsZSBtb3JlIGZvciBtb3VzZSB1c2Vyc1xuICAgICAgY29uc3QgZGVsYXkgPSB0aGlzLnRvdWNoID8gMzAwMCA6IDQwMDA7XG5cbiAgICAgIC8vIENsZWFyIHRpbWVyXG4gICAgICBjbGVhclRpbWVvdXQodGltZXJzLmNvbnRyb2xzKTtcblxuICAgICAgLy8gSGlkZSBhZ2FpbiBhZnRlciBkZWxheVxuICAgICAgdGltZXJzLmNvbnRyb2xzID0gc2V0VGltZW91dCgoKSA9PiB1aS50b2dnbGVDb250cm9scy5jYWxsKHBsYXllciwgZmFsc2UpLCBkZWxheSk7XG4gICAgfSk7XG5cbiAgICAvLyBNb3VzZSB3aGVlbCBmb3Igdm9sdW1lXG4gICAgdGhpcy5iaW5kKFxuICAgICAgZWxlbWVudHMuaW5wdXRzLnZvbHVtZSxcbiAgICAgICd3aGVlbCcsXG4gICAgICAoZXZlbnQpID0+IHtcbiAgICAgICAgLy8gRGV0ZWN0IFwibmF0dXJhbFwiIHNjcm9sbCAtIHN1cHBvcnRlZCBvbiBPUyBYIFNhZmFyaSBvbmx5XG4gICAgICAgIC8vIE90aGVyIGJyb3dzZXJzIG9uIE9TIFggd2lsbCBiZSBpbnZlcnRlZCB1bnRpbCBzdXBwb3J0IGltcHJvdmVzXG4gICAgICAgIGNvbnN0IGludmVydGVkID0gZXZlbnQud2Via2l0RGlyZWN0aW9uSW52ZXJ0ZWRGcm9tRGV2aWNlO1xuICAgICAgICAvLyBHZXQgZGVsdGEgZnJvbSBldmVudC4gSW52ZXJ0IGlmIGBpbnZlcnRlZGAgaXMgdHJ1ZVxuICAgICAgICBjb25zdCBbeCwgeV0gPSBbZXZlbnQuZGVsdGFYLCAtZXZlbnQuZGVsdGFZXS5tYXAoKHZhbHVlKSA9PiAoaW52ZXJ0ZWQgPyAtdmFsdWUgOiB2YWx1ZSkpO1xuICAgICAgICAvLyBVc2luZyB0aGUgYmlnZ2VzdCBkZWx0YSwgbm9ybWFsaXplIHRvIDEgb3IgLTEgKG9yIDAgaWYgbm8gZGVsdGEpXG4gICAgICAgIGNvbnN0IGRpcmVjdGlvbiA9IE1hdGguc2lnbihNYXRoLmFicyh4KSA+IE1hdGguYWJzKHkpID8geCA6IHkpO1xuXG4gICAgICAgIC8vIENoYW5nZSB0aGUgdm9sdW1lIGJ5IDIlXG4gICAgICAgIHBsYXllci5pbmNyZWFzZVZvbHVtZShkaXJlY3Rpb24gLyA1MCk7XG5cbiAgICAgICAgLy8gRG9uJ3QgYnJlYWsgcGFnZSBzY3JvbGxpbmcgYXQgbWF4IGFuZCBtaW5cbiAgICAgICAgY29uc3QgeyB2b2x1bWUgfSA9IHBsYXllci5tZWRpYTtcbiAgICAgICAgaWYgKChkaXJlY3Rpb24gPT09IDEgJiYgdm9sdW1lIDwgMSkgfHwgKGRpcmVjdGlvbiA9PT0gLTEgJiYgdm9sdW1lID4gMCkpIHtcbiAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgJ3ZvbHVtZScsXG4gICAgICBmYWxzZSxcbiAgICApO1xuICB9O1xufVxuXG5leHBvcnQgZGVmYXVsdCBMaXN0ZW5lcnM7XG4iLCIoZnVuY3Rpb24ocm9vdCwgZmFjdG9yeSkge1xuICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7XG4gICAgZGVmaW5lKFtdLCBmYWN0b3J5KTtcbiAgfSBlbHNlIGlmICh0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcpIHtcbiAgICBtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKTtcbiAgfSBlbHNlIHtcbiAgICByb290LmxvYWRqcyA9IGZhY3RvcnkoKTtcbiAgfVxufSh0aGlzLCBmdW5jdGlvbigpIHtcbi8qKlxuICogR2xvYmFsIGRlcGVuZGVuY2llcy5cbiAqIEBnbG9iYWwge09iamVjdH0gZG9jdW1lbnQgLSBET01cbiAqL1xuXG52YXIgZGV2bnVsbCA9IGZ1bmN0aW9uKCkge30sXG4gICAgYnVuZGxlSWRDYWNoZSA9IHt9LFxuICAgIGJ1bmRsZVJlc3VsdENhY2hlID0ge30sXG4gICAgYnVuZGxlQ2FsbGJhY2tRdWV1ZSA9IHt9O1xuXG5cbi8qKlxuICogU3Vic2NyaWJlIHRvIGJ1bmRsZSBsb2FkIGV2ZW50LlxuICogQHBhcmFtIHtzdHJpbmdbXX0gYnVuZGxlSWRzIC0gQnVuZGxlIGlkc1xuICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2tGbiAtIFRoZSBjYWxsYmFjayBmdW5jdGlvblxuICovXG5mdW5jdGlvbiBzdWJzY3JpYmUoYnVuZGxlSWRzLCBjYWxsYmFja0ZuKSB7XG4gIC8vIGxpc3RpZnlcbiAgYnVuZGxlSWRzID0gYnVuZGxlSWRzLnB1c2ggPyBidW5kbGVJZHMgOiBbYnVuZGxlSWRzXTtcblxuICB2YXIgZGVwc05vdEZvdW5kID0gW10sXG4gICAgICBpID0gYnVuZGxlSWRzLmxlbmd0aCxcbiAgICAgIG51bVdhaXRpbmcgPSBpLFxuICAgICAgZm4sXG4gICAgICBidW5kbGVJZCxcbiAgICAgIHIsXG4gICAgICBxO1xuXG4gIC8vIGRlZmluZSBjYWxsYmFjayBmdW5jdGlvblxuICBmbiA9IGZ1bmN0aW9uIChidW5kbGVJZCwgcGF0aHNOb3RGb3VuZCkge1xuICAgIGlmIChwYXRoc05vdEZvdW5kLmxlbmd0aCkgZGVwc05vdEZvdW5kLnB1c2goYnVuZGxlSWQpO1xuXG4gICAgbnVtV2FpdGluZy0tO1xuICAgIGlmICghbnVtV2FpdGluZykgY2FsbGJhY2tGbihkZXBzTm90Rm91bmQpO1xuICB9O1xuXG4gIC8vIHJlZ2lzdGVyIGNhbGxiYWNrXG4gIHdoaWxlIChpLS0pIHtcbiAgICBidW5kbGVJZCA9IGJ1bmRsZUlkc1tpXTtcblxuICAgIC8vIGV4ZWN1dGUgY2FsbGJhY2sgaWYgaW4gcmVzdWx0IGNhY2hlXG4gICAgciA9IGJ1bmRsZVJlc3VsdENhY2hlW2J1bmRsZUlkXTtcbiAgICBpZiAocikge1xuICAgICAgZm4oYnVuZGxlSWQsIHIpO1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgLy8gYWRkIHRvIGNhbGxiYWNrIHF1ZXVlXG4gICAgcSA9IGJ1bmRsZUNhbGxiYWNrUXVldWVbYnVuZGxlSWRdID0gYnVuZGxlQ2FsbGJhY2tRdWV1ZVtidW5kbGVJZF0gfHwgW107XG4gICAgcS5wdXNoKGZuKTtcbiAgfVxufVxuXG5cbi8qKlxuICogUHVibGlzaCBidW5kbGUgbG9hZCBldmVudC5cbiAqIEBwYXJhbSB7c3RyaW5nfSBidW5kbGVJZCAtIEJ1bmRsZSBpZFxuICogQHBhcmFtIHtzdHJpbmdbXX0gcGF0aHNOb3RGb3VuZCAtIExpc3Qgb2YgZmlsZXMgbm90IGZvdW5kXG4gKi9cbmZ1bmN0aW9uIHB1Ymxpc2goYnVuZGxlSWQsIHBhdGhzTm90Rm91bmQpIHtcbiAgLy8gZXhpdCBpZiBpZCBpc24ndCBkZWZpbmVkXG4gIGlmICghYnVuZGxlSWQpIHJldHVybjtcblxuICB2YXIgcSA9IGJ1bmRsZUNhbGxiYWNrUXVldWVbYnVuZGxlSWRdO1xuXG4gIC8vIGNhY2hlIHJlc3VsdFxuICBidW5kbGVSZXN1bHRDYWNoZVtidW5kbGVJZF0gPSBwYXRoc05vdEZvdW5kO1xuXG4gIC8vIGV4aXQgaWYgcXVldWUgaXMgZW1wdHlcbiAgaWYgKCFxKSByZXR1cm47XG5cbiAgLy8gZW1wdHkgY2FsbGJhY2sgcXVldWVcbiAgd2hpbGUgKHEubGVuZ3RoKSB7XG4gICAgcVswXShidW5kbGVJZCwgcGF0aHNOb3RGb3VuZCk7XG4gICAgcS5zcGxpY2UoMCwgMSk7XG4gIH1cbn1cblxuXG4vKipcbiAqIEV4ZWN1dGUgY2FsbGJhY2tzLlxuICogQHBhcmFtIHtPYmplY3Qgb3IgRnVuY3Rpb259IGFyZ3MgLSBUaGUgY2FsbGJhY2sgYXJnc1xuICogQHBhcmFtIHtzdHJpbmdbXX0gZGVwc05vdEZvdW5kIC0gTGlzdCBvZiBkZXBlbmRlbmNpZXMgbm90IGZvdW5kXG4gKi9cbmZ1bmN0aW9uIGV4ZWN1dGVDYWxsYmFja3MoYXJncywgZGVwc05vdEZvdW5kKSB7XG4gIC8vIGFjY2VwdCBmdW5jdGlvbiBhcyBhcmd1bWVudFxuICBpZiAoYXJncy5jYWxsKSBhcmdzID0ge3N1Y2Nlc3M6IGFyZ3N9O1xuXG4gIC8vIHN1Y2Nlc3MgYW5kIGVycm9yIGNhbGxiYWNrc1xuICBpZiAoZGVwc05vdEZvdW5kLmxlbmd0aCkgKGFyZ3MuZXJyb3IgfHwgZGV2bnVsbCkoZGVwc05vdEZvdW5kKTtcbiAgZWxzZSAoYXJncy5zdWNjZXNzIHx8IGRldm51bGwpKGFyZ3MpO1xufVxuXG5cbi8qKlxuICogTG9hZCBpbmRpdmlkdWFsIGZpbGUuXG4gKiBAcGFyYW0ge3N0cmluZ30gcGF0aCAtIFRoZSBmaWxlIHBhdGhcbiAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrRm4gLSBUaGUgY2FsbGJhY2sgZnVuY3Rpb25cbiAqL1xuZnVuY3Rpb24gbG9hZEZpbGUocGF0aCwgY2FsbGJhY2tGbiwgYXJncywgbnVtVHJpZXMpIHtcbiAgdmFyIGRvYyA9IGRvY3VtZW50LFxuICAgICAgYXN5bmMgPSBhcmdzLmFzeW5jLFxuICAgICAgbWF4VHJpZXMgPSAoYXJncy5udW1SZXRyaWVzIHx8IDApICsgMSxcbiAgICAgIGJlZm9yZUNhbGxiYWNrRm4gPSBhcmdzLmJlZm9yZSB8fCBkZXZudWxsLFxuICAgICAgcGF0aG5hbWUgPSBwYXRoLnJlcGxhY2UoL1tcXD98I10uKiQvLCAnJyksXG4gICAgICBwYXRoU3RyaXBwZWQgPSBwYXRoLnJlcGxhY2UoL14oY3NzfGltZykhLywgJycpLFxuICAgICAgaXNMZWdhY3lJRUNzcyxcbiAgICAgIGU7XG5cbiAgbnVtVHJpZXMgPSBudW1UcmllcyB8fCAwO1xuXG4gIGlmICgvKF5jc3MhfFxcLmNzcyQpLy50ZXN0KHBhdGhuYW1lKSkge1xuICAgIC8vIGNzc1xuICAgIGUgPSBkb2MuY3JlYXRlRWxlbWVudCgnbGluaycpO1xuICAgIGUucmVsID0gJ3N0eWxlc2hlZXQnO1xuICAgIGUuaHJlZiA9IHBhdGhTdHJpcHBlZDtcblxuICAgIC8vIHRhZyBJRTkrXG4gICAgaXNMZWdhY3lJRUNzcyA9ICdoaWRlRm9jdXMnIGluIGU7XG5cbiAgICAvLyB1c2UgcHJlbG9hZCBpbiBJRSBFZGdlICh0byBkZXRlY3QgbG9hZCBlcnJvcnMpXG4gICAgaWYgKGlzTGVnYWN5SUVDc3MgJiYgZS5yZWxMaXN0KSB7XG4gICAgICBpc0xlZ2FjeUlFQ3NzID0gMDtcbiAgICAgIGUucmVsID0gJ3ByZWxvYWQnO1xuICAgICAgZS5hcyA9ICdzdHlsZSc7XG4gICAgfVxuICB9IGVsc2UgaWYgKC8oXmltZyF8XFwuKHBuZ3xnaWZ8anBnfHN2Z3x3ZWJwKSQpLy50ZXN0KHBhdGhuYW1lKSkge1xuICAgIC8vIGltYWdlXG4gICAgZSA9IGRvYy5jcmVhdGVFbGVtZW50KCdpbWcnKTtcbiAgICBlLnNyYyA9IHBhdGhTdHJpcHBlZDsgICAgXG4gIH0gZWxzZSB7XG4gICAgLy8gamF2YXNjcmlwdFxuICAgIGUgPSBkb2MuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7XG4gICAgZS5zcmMgPSBwYXRoO1xuICAgIGUuYXN5bmMgPSBhc3luYyA9PT0gdW5kZWZpbmVkID8gdHJ1ZSA6IGFzeW5jO1xuICB9XG5cbiAgZS5vbmxvYWQgPSBlLm9uZXJyb3IgPSBlLm9uYmVmb3JlbG9hZCA9IGZ1bmN0aW9uIChldikge1xuICAgIHZhciByZXN1bHQgPSBldi50eXBlWzBdO1xuXG4gICAgLy8gdHJlYXQgZW1wdHkgc3R5bGVzaGVldHMgYXMgZmFpbHVyZXMgdG8gZ2V0IGFyb3VuZCBsYWNrIG9mIG9uZXJyb3JcbiAgICAvLyBzdXBwb3J0IGluIElFOS0xMVxuICAgIGlmIChpc0xlZ2FjeUlFQ3NzKSB7XG4gICAgICB0cnkge1xuICAgICAgICBpZiAoIWUuc2hlZXQuY3NzVGV4dC5sZW5ndGgpIHJlc3VsdCA9ICdlJztcbiAgICAgIH0gY2F0Y2ggKHgpIHtcbiAgICAgICAgLy8gc2hlZXRzIG9iamVjdHMgY3JlYXRlZCBmcm9tIGxvYWQgZXJyb3JzIGRvbid0IGFsbG93IGFjY2VzcyB0b1xuICAgICAgICAvLyBgY3NzVGV4dGAgKHVubGVzcyBlcnJvciBpcyBDb2RlOjE4IFNlY3VyaXR5RXJyb3IpXG4gICAgICAgIGlmICh4LmNvZGUgIT0gMTgpIHJlc3VsdCA9ICdlJztcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBoYW5kbGUgcmV0cmllcyBpbiBjYXNlIG9mIGxvYWQgZmFpbHVyZVxuICAgIGlmIChyZXN1bHQgPT0gJ2UnKSB7XG4gICAgICAvLyBpbmNyZW1lbnQgY291bnRlclxuICAgICAgbnVtVHJpZXMgKz0gMTtcblxuICAgICAgLy8gZXhpdCBmdW5jdGlvbiBhbmQgdHJ5IGFnYWluXG4gICAgICBpZiAobnVtVHJpZXMgPCBtYXhUcmllcykge1xuICAgICAgICByZXR1cm4gbG9hZEZpbGUocGF0aCwgY2FsbGJhY2tGbiwgYXJncywgbnVtVHJpZXMpO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoZS5yZWwgPT0gJ3ByZWxvYWQnICYmIGUuYXMgPT0gJ3N0eWxlJykge1xuICAgICAgLy8gYWN0aXZhdGUgcHJlbG9hZGVkIHN0eWxlc2hlZXRzXG4gICAgICByZXR1cm4gZS5yZWwgPSAnc3R5bGVzaGVldCc7IC8vIGpzaGludCBpZ25vcmU6bGluZVxuICAgIH1cbiAgICBcbiAgICAvLyBleGVjdXRlIGNhbGxiYWNrXG4gICAgY2FsbGJhY2tGbihwYXRoLCByZXN1bHQsIGV2LmRlZmF1bHRQcmV2ZW50ZWQpO1xuICB9O1xuXG4gIC8vIGFkZCB0byBkb2N1bWVudCAodW5sZXNzIGNhbGxiYWNrIHJldHVybnMgYGZhbHNlYClcbiAgaWYgKGJlZm9yZUNhbGxiYWNrRm4ocGF0aCwgZSkgIT09IGZhbHNlKSBkb2MuaGVhZC5hcHBlbmRDaGlsZChlKTtcbn1cblxuXG4vKipcbiAqIExvYWQgbXVsdGlwbGUgZmlsZXMuXG4gKiBAcGFyYW0ge3N0cmluZ1tdfSBwYXRocyAtIFRoZSBmaWxlIHBhdGhzXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFja0ZuIC0gVGhlIGNhbGxiYWNrIGZ1bmN0aW9uXG4gKi9cbmZ1bmN0aW9uIGxvYWRGaWxlcyhwYXRocywgY2FsbGJhY2tGbiwgYXJncykge1xuICAvLyBsaXN0aWZ5IHBhdGhzXG4gIHBhdGhzID0gcGF0aHMucHVzaCA/IHBhdGhzIDogW3BhdGhzXTtcblxuICB2YXIgbnVtV2FpdGluZyA9IHBhdGhzLmxlbmd0aCxcbiAgICAgIHggPSBudW1XYWl0aW5nLFxuICAgICAgcGF0aHNOb3RGb3VuZCA9IFtdLFxuICAgICAgZm4sXG4gICAgICBpO1xuXG4gIC8vIGRlZmluZSBjYWxsYmFjayBmdW5jdGlvblxuICBmbiA9IGZ1bmN0aW9uKHBhdGgsIHJlc3VsdCwgZGVmYXVsdFByZXZlbnRlZCkge1xuICAgIC8vIGhhbmRsZSBlcnJvclxuICAgIGlmIChyZXN1bHQgPT0gJ2UnKSBwYXRoc05vdEZvdW5kLnB1c2gocGF0aCk7XG5cbiAgICAvLyBoYW5kbGUgYmVmb3JlbG9hZCBldmVudC4gSWYgZGVmYXVsdFByZXZlbnRlZCB0aGVuIHRoYXQgbWVhbnMgdGhlIGxvYWRcbiAgICAvLyB3aWxsIGJlIGJsb2NrZWQgKGV4LiBHaG9zdGVyeS9BQlAgb24gU2FmYXJpKVxuICAgIGlmIChyZXN1bHQgPT0gJ2InKSB7XG4gICAgICBpZiAoZGVmYXVsdFByZXZlbnRlZCkgcGF0aHNOb3RGb3VuZC5wdXNoKHBhdGgpO1xuICAgICAgZWxzZSByZXR1cm47XG4gICAgfVxuXG4gICAgbnVtV2FpdGluZy0tO1xuICAgIGlmICghbnVtV2FpdGluZykgY2FsbGJhY2tGbihwYXRoc05vdEZvdW5kKTtcbiAgfTtcblxuICAvLyBsb2FkIHNjcmlwdHNcbiAgZm9yIChpPTA7IGkgPCB4OyBpKyspIGxvYWRGaWxlKHBhdGhzW2ldLCBmbiwgYXJncyk7XG59XG5cblxuLyoqXG4gKiBJbml0aWF0ZSBzY3JpcHQgbG9hZCBhbmQgcmVnaXN0ZXIgYnVuZGxlLlxuICogQHBhcmFtIHsoc3RyaW5nfHN0cmluZ1tdKX0gcGF0aHMgLSBUaGUgZmlsZSBwYXRoc1xuICogQHBhcmFtIHsoc3RyaW5nfEZ1bmN0aW9ufE9iamVjdCl9IFthcmcxXSAtIFRoZSAoMSkgYnVuZGxlSWQgb3IgKDIpIHN1Y2Nlc3NcbiAqICAgY2FsbGJhY2sgb3IgKDMpIG9iamVjdCBsaXRlcmFsIHdpdGggc3VjY2Vzcy9lcnJvciBhcmd1bWVudHMsIG51bVJldHJpZXMsXG4gKiAgIGV0Yy5cbiAqIEBwYXJhbSB7KEZ1bmN0aW9ufE9iamVjdCl9IFthcmcyXSAtIFRoZSAoMSkgc3VjY2VzcyBjYWxsYmFjayBvciAoMikgb2JqZWN0XG4gKiAgIGxpdGVyYWwgd2l0aCBzdWNjZXNzL2Vycm9yIGFyZ3VtZW50cywgbnVtUmV0cmllcywgZXRjLlxuICovXG5mdW5jdGlvbiBsb2FkanMocGF0aHMsIGFyZzEsIGFyZzIpIHtcbiAgdmFyIGJ1bmRsZUlkLFxuICAgICAgYXJncztcblxuICAvLyBidW5kbGVJZCAoaWYgc3RyaW5nKVxuICBpZiAoYXJnMSAmJiBhcmcxLnRyaW0pIGJ1bmRsZUlkID0gYXJnMTtcblxuICAvLyBhcmdzIChkZWZhdWx0IGlzIHt9KVxuICBhcmdzID0gKGJ1bmRsZUlkID8gYXJnMiA6IGFyZzEpIHx8IHt9O1xuXG4gIC8vIHRocm93IGVycm9yIGlmIGJ1bmRsZSBpcyBhbHJlYWR5IGRlZmluZWRcbiAgaWYgKGJ1bmRsZUlkKSB7XG4gICAgaWYgKGJ1bmRsZUlkIGluIGJ1bmRsZUlkQ2FjaGUpIHtcbiAgICAgIHRocm93IFwiTG9hZEpTXCI7XG4gICAgfSBlbHNlIHtcbiAgICAgIGJ1bmRsZUlkQ2FjaGVbYnVuZGxlSWRdID0gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBsb2FkRm4ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgbG9hZEZpbGVzKHBhdGhzLCBmdW5jdGlvbiAocGF0aHNOb3RGb3VuZCkge1xuICAgICAgLy8gZXhlY3V0ZSBjYWxsYmFja3NcbiAgICAgIGV4ZWN1dGVDYWxsYmFja3MoYXJncywgcGF0aHNOb3RGb3VuZCk7XG4gICAgICBcbiAgICAgIC8vIHJlc29sdmUgUHJvbWlzZVxuICAgICAgaWYgKHJlc29sdmUpIHtcbiAgICAgICAgZXhlY3V0ZUNhbGxiYWNrcyh7c3VjY2VzczogcmVzb2x2ZSwgZXJyb3I6IHJlamVjdH0sIHBhdGhzTm90Rm91bmQpO1xuICAgICAgfVxuXG4gICAgICAvLyBwdWJsaXNoIGJ1bmRsZSBsb2FkIGV2ZW50XG4gICAgICBwdWJsaXNoKGJ1bmRsZUlkLCBwYXRoc05vdEZvdW5kKTtcbiAgICB9LCBhcmdzKTtcbiAgfVxuICBcbiAgaWYgKGFyZ3MucmV0dXJuUHJvbWlzZSkgcmV0dXJuIG5ldyBQcm9taXNlKGxvYWRGbik7XG4gIGVsc2UgbG9hZEZuKCk7XG59XG5cblxuLyoqXG4gKiBFeGVjdXRlIGNhbGxiYWNrcyB3aGVuIGRlcGVuZGVuY2llcyBoYXZlIGJlZW4gc2F0aXNmaWVkLlxuICogQHBhcmFtIHsoc3RyaW5nfHN0cmluZ1tdKX0gZGVwcyAtIExpc3Qgb2YgYnVuZGxlIGlkc1xuICogQHBhcmFtIHtPYmplY3R9IGFyZ3MgLSBzdWNjZXNzL2Vycm9yIGFyZ3VtZW50c1xuICovXG5sb2FkanMucmVhZHkgPSBmdW5jdGlvbiByZWFkeShkZXBzLCBhcmdzKSB7XG4gIC8vIHN1YnNjcmliZSB0byBidW5kbGUgbG9hZCBldmVudFxuICBzdWJzY3JpYmUoZGVwcywgZnVuY3Rpb24gKGRlcHNOb3RGb3VuZCkge1xuICAgIC8vIGV4ZWN1dGUgY2FsbGJhY2tzXG4gICAgZXhlY3V0ZUNhbGxiYWNrcyhhcmdzLCBkZXBzTm90Rm91bmQpO1xuICB9KTtcblxuICByZXR1cm4gbG9hZGpzO1xufTtcblxuXG4vKipcbiAqIE1hbnVhbGx5IHNhdGlzZnkgYnVuZGxlIGRlcGVuZGVuY2llcy5cbiAqIEBwYXJhbSB7c3RyaW5nfSBidW5kbGVJZCAtIFRoZSBidW5kbGUgaWRcbiAqL1xubG9hZGpzLmRvbmUgPSBmdW5jdGlvbiBkb25lKGJ1bmRsZUlkKSB7XG4gIHB1Ymxpc2goYnVuZGxlSWQsIFtdKTtcbn07XG5cblxuLyoqXG4gKiBSZXNldCBsb2FkanMgZGVwZW5kZW5jaWVzIHN0YXR1c2VzXG4gKi9cbmxvYWRqcy5yZXNldCA9IGZ1bmN0aW9uIHJlc2V0KCkge1xuICBidW5kbGVJZENhY2hlID0ge307XG4gIGJ1bmRsZVJlc3VsdENhY2hlID0ge307XG4gIGJ1bmRsZUNhbGxiYWNrUXVldWUgPSB7fTtcbn07XG5cblxuLyoqXG4gKiBEZXRlcm1pbmUgaWYgYnVuZGxlIGhhcyBhbHJlYWR5IGJlZW4gZGVmaW5lZFxuICogQHBhcmFtIFN0cmluZ30gYnVuZGxlSWQgLSBUaGUgYnVuZGxlIGlkXG4gKi9cbmxvYWRqcy5pc0RlZmluZWQgPSBmdW5jdGlvbiBpc0RlZmluZWQoYnVuZGxlSWQpIHtcbiAgcmV0dXJuIGJ1bmRsZUlkIGluIGJ1bmRsZUlkQ2FjaGU7XG59O1xuXG5cbi8vIGV4cG9ydFxucmV0dXJuIGxvYWRqcztcblxufSkpO1xuIiwiLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIExvYWQgYW4gZXh0ZXJuYWwgc2NyaXB0XG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5pbXBvcnQgbG9hZGpzIGZyb20gJ2xvYWRqcyc7XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGxvYWRTY3JpcHQodXJsKSB7XG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgbG9hZGpzKHVybCwge1xuICAgICAgc3VjY2VzczogcmVzb2x2ZSxcbiAgICAgIGVycm9yOiByZWplY3QsXG4gICAgfSk7XG4gIH0pO1xufVxuIiwiLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFZpbWVvIHBsdWdpblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuaW1wb3J0IGNhcHRpb25zIGZyb20gJy4uL2NhcHRpb25zJztcbmltcG9ydCBjb250cm9scyBmcm9tICcuLi9jb250cm9scyc7XG5pbXBvcnQgdWkgZnJvbSAnLi4vdWknO1xuaW1wb3J0IHsgY3JlYXRlRWxlbWVudCwgcmVwbGFjZUVsZW1lbnQsIHRvZ2dsZUNsYXNzIH0gZnJvbSAnLi4vdXRpbHMvZWxlbWVudHMnO1xuaW1wb3J0IHsgdHJpZ2dlckV2ZW50IH0gZnJvbSAnLi4vdXRpbHMvZXZlbnRzJztcbmltcG9ydCBmZXRjaCBmcm9tICcuLi91dGlscy9mZXRjaCc7XG5pbXBvcnQgaXMgZnJvbSAnLi4vdXRpbHMvaXMnO1xuaW1wb3J0IGxvYWRTY3JpcHQgZnJvbSAnLi4vdXRpbHMvbG9hZC1zY3JpcHQnO1xuaW1wb3J0IHsgZm9ybWF0LCBzdHJpcEhUTUwgfSBmcm9tICcuLi91dGlscy9zdHJpbmdzJztcbmltcG9ydCB7IHJvdW5kQXNwZWN0UmF0aW8sIHNldEFzcGVjdFJhdGlvIH0gZnJvbSAnLi4vdXRpbHMvc3R5bGUnO1xuaW1wb3J0IHsgYnVpbGRVcmxQYXJhbXMgfSBmcm9tICcuLi91dGlscy91cmxzJztcblxuLy8gUGFyc2UgVmltZW8gSUQgZnJvbSBVUkxcbmZ1bmN0aW9uIHBhcnNlSWQodXJsKSB7XG4gIGlmIChpcy5lbXB0eSh1cmwpKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBpZiAoaXMubnVtYmVyKE51bWJlcih1cmwpKSkge1xuICAgIHJldHVybiB1cmw7XG4gIH1cblxuICBjb25zdCByZWdleCA9IC9eLioodmltZW8uY29tXFwvfHZpZGVvXFwvKShcXGQrKS4qLztcbiAgcmV0dXJuIHVybC5tYXRjaChyZWdleCkgPyBSZWdFeHAuJDIgOiB1cmw7XG59XG5cbi8vIFRyeSB0byBleHRyYWN0IGEgaGFzaCBmb3IgcHJpdmF0ZSB2aWRlb3MgZnJvbSB0aGUgVVJMXG5mdW5jdGlvbiBwYXJzZUhhc2godXJsKSB7XG4gIC8qIFRoaXMgcmVnZXggbWF0Y2hlcyBhIGhleGFkZWNpbWFsIGhhc2ggaWYgZ2l2ZW4gaW4gYW55IG9mIHRoZXNlIGZvcm1zOlxuICAgKiAgLSBbaHR0cHM6Ly9wbGF5ZXIuXXZpbWVvLmNvbS92aWRlby97aWR9L3toYXNofVs/cGFyYW1zXVxuICAgKiAgLSBbaHR0cHM6Ly9wbGF5ZXIuXXZpbWVvLmNvbS92aWRlby97aWR9P2g9e2hhc2h9WyZwYXJhbXNdXG4gICAqICAtIFtodHRwczovL3BsYXllci5ddmltZW8uY29tL3ZpZGVvL3tpZH0/W3BhcmFtc10maD17aGFzaH1cbiAgICogIC0gdmlkZW8ve2lkfS97aGFzaH1cbiAgICogSWYgbWF0Y2hlZCwgdGhlIGhhc2ggaXMgYXZhaWxhYmxlIGluIGNhcHR1cmUgZ3JvdXAgNFxuICAgKi9cbiAgY29uc3QgcmVnZXggPSAvXi4qKHZpbWVvLmNvbVxcL3x2aWRlb1xcLykoXFxkKykoXFw/LiomKmg9fFxcLykrKFtcXGQsYS1mXSspLztcbiAgY29uc3QgZm91bmQgPSB1cmwubWF0Y2gocmVnZXgpO1xuXG4gIHJldHVybiBmb3VuZCAmJiBmb3VuZC5sZW5ndGggPT09IDUgPyBmb3VuZFs0XSA6IG51bGw7XG59XG5cbi8vIFNldCBwbGF5YmFjayBzdGF0ZSBhbmQgdHJpZ2dlciBjaGFuZ2UgKG9ubHkgb24gYWN0dWFsIGNoYW5nZSlcbmZ1bmN0aW9uIGFzc3VyZVBsYXliYWNrU3RhdGUocGxheSkge1xuICBpZiAocGxheSAmJiAhdGhpcy5lbWJlZC5oYXNQbGF5ZWQpIHtcbiAgICB0aGlzLmVtYmVkLmhhc1BsYXllZCA9IHRydWU7XG4gIH1cbiAgaWYgKHRoaXMubWVkaWEucGF1c2VkID09PSBwbGF5KSB7XG4gICAgdGhpcy5tZWRpYS5wYXVzZWQgPSAhcGxheTtcbiAgICB0cmlnZ2VyRXZlbnQuY2FsbCh0aGlzLCB0aGlzLm1lZGlhLCBwbGF5ID8gJ3BsYXknIDogJ3BhdXNlJyk7XG4gIH1cbn1cblxuY29uc3QgdmltZW8gPSB7XG4gIHNldHVwKCkge1xuICAgIGNvbnN0IHBsYXllciA9IHRoaXM7XG5cbiAgICAvLyBBZGQgZW1iZWQgY2xhc3MgZm9yIHJlc3BvbnNpdmVcbiAgICB0b2dnbGVDbGFzcyhwbGF5ZXIuZWxlbWVudHMud3JhcHBlciwgcGxheWVyLmNvbmZpZy5jbGFzc05hbWVzLmVtYmVkLCB0cnVlKTtcblxuICAgIC8vIFNldCBzcGVlZCBvcHRpb25zIGZyb20gY29uZmlnXG4gICAgcGxheWVyLm9wdGlvbnMuc3BlZWQgPSBwbGF5ZXIuY29uZmlnLnNwZWVkLm9wdGlvbnM7XG5cbiAgICAvLyBTZXQgaW50aWFsIHJhdGlvXG4gICAgc2V0QXNwZWN0UmF0aW8uY2FsbChwbGF5ZXIpO1xuXG4gICAgLy8gTG9hZCB0aGUgU0RLIGlmIG5vdCBhbHJlYWR5XG4gICAgaWYgKCFpcy5vYmplY3Qod2luZG93LlZpbWVvKSkge1xuICAgICAgbG9hZFNjcmlwdChwbGF5ZXIuY29uZmlnLnVybHMudmltZW8uc2RrKVxuICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgdmltZW8ucmVhZHkuY2FsbChwbGF5ZXIpO1xuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7XG4gICAgICAgICAgcGxheWVyLmRlYnVnLndhcm4oJ1ZpbWVvIFNESyAocGxheWVyLmpzKSBmYWlsZWQgdG8gbG9hZCcsIGVycm9yKTtcbiAgICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHZpbWVvLnJlYWR5LmNhbGwocGxheWVyKTtcbiAgICB9XG4gIH0sXG5cbiAgLy8gQVBJIFJlYWR5XG4gIHJlYWR5KCkge1xuICAgIGNvbnN0IHBsYXllciA9IHRoaXM7XG4gICAgY29uc3QgY29uZmlnID0gcGxheWVyLmNvbmZpZy52aW1lbztcbiAgICBjb25zdCB7IHByZW1pdW0sIHJlZmVycmVyUG9saWN5LCAuLi5mcmFtZVBhcmFtcyB9ID0gY29uZmlnO1xuICAgIC8vIEdldCB0aGUgc291cmNlIFVSTCBvciBJRFxuICAgIGxldCBzb3VyY2UgPSBwbGF5ZXIubWVkaWEuZ2V0QXR0cmlidXRlKCdzcmMnKTtcbiAgICBsZXQgaGFzaCA9ICcnO1xuICAgIC8vIEdldCBmcm9tIDxkaXY+IGlmIG5lZWRlZFxuICAgIGlmIChpcy5lbXB0eShzb3VyY2UpKSB7XG4gICAgICBzb3VyY2UgPSBwbGF5ZXIubWVkaWEuZ2V0QXR0cmlidXRlKHBsYXllci5jb25maWcuYXR0cmlidXRlcy5lbWJlZC5pZCk7XG4gICAgICAvLyBoYXNoIGNhbiBhbHNvIGJlIHNldCBhcyBhdHRyaWJ1dGUgb24gdGhlIDxkaXY+XG4gICAgICBoYXNoID0gcGxheWVyLm1lZGlhLmdldEF0dHJpYnV0ZShwbGF5ZXIuY29uZmlnLmF0dHJpYnV0ZXMuZW1iZWQuaGFzaCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGhhc2ggPSBwYXJzZUhhc2goc291cmNlKTtcbiAgICB9XG4gICAgY29uc3QgaGFzaFBhcmFtID0gaGFzaCA/IHsgaDogaGFzaCB9IDoge307XG5cbiAgICAvLyBJZiB0aGUgb3duZXIgaGFzIGEgcHJvIG9yIHByZW1pdW0gYWNjb3VudCB0aGVuIHdlIGNhbiBoaWRlIGNvbnRyb2xzIGV0Y1xuICAgIGlmIChwcmVtaXVtKSB7XG4gICAgICBPYmplY3QuYXNzaWduKGZyYW1lUGFyYW1zLCB7XG4gICAgICAgIGNvbnRyb2xzOiBmYWxzZSxcbiAgICAgICAgc2lkZWRvY2s6IGZhbHNlLFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gR2V0IFZpbWVvIHBhcmFtcyBmb3IgdGhlIGlmcmFtZVxuICAgIGNvbnN0IHBhcmFtcyA9IGJ1aWxkVXJsUGFyYW1zKHtcbiAgICAgIGxvb3A6IHBsYXllci5jb25maWcubG9vcC5hY3RpdmUsXG4gICAgICBhdXRvcGxheTogcGxheWVyLmF1dG9wbGF5LFxuICAgICAgbXV0ZWQ6IHBsYXllci5tdXRlZCxcbiAgICAgIGdlc3R1cmU6ICdtZWRpYScsXG4gICAgICBwbGF5c2lubGluZTogIXRoaXMuY29uZmlnLmZ1bGxzY3JlZW4uaW9zTmF0aXZlLFxuICAgICAgLy8gaGFzaCBoYXMgdG8gYmUgYWRkZWQgdG8gaWZyYW1lLVVSTFxuICAgICAgLi4uaGFzaFBhcmFtLFxuICAgICAgLi4uZnJhbWVQYXJhbXMsXG4gICAgfSk7XG5cbiAgICBjb25zdCBpZCA9IHBhcnNlSWQoc291cmNlKTtcbiAgICAvLyBCdWlsZCBhbiBpZnJhbWVcbiAgICBjb25zdCBpZnJhbWUgPSBjcmVhdGVFbGVtZW50KCdpZnJhbWUnKTtcbiAgICBjb25zdCBzcmMgPSBmb3JtYXQocGxheWVyLmNvbmZpZy51cmxzLnZpbWVvLmlmcmFtZSwgaWQsIHBhcmFtcyk7XG4gICAgaWZyYW1lLnNldEF0dHJpYnV0ZSgnc3JjJywgc3JjKTtcbiAgICBpZnJhbWUuc2V0QXR0cmlidXRlKCdhbGxvd2Z1bGxzY3JlZW4nLCAnJyk7XG4gICAgaWZyYW1lLnNldEF0dHJpYnV0ZShcbiAgICAgICdhbGxvdycsXG4gICAgICBbJ2F1dG9wbGF5JywgJ2Z1bGxzY3JlZW4nLCAncGljdHVyZS1pbi1waWN0dXJlJywgJ2VuY3J5cHRlZC1tZWRpYScsICdhY2NlbGVyb21ldGVyJywgJ2d5cm9zY29wZSddLmpvaW4oJzsgJyksXG4gICAgKTtcblxuICAgIC8vIFNldCB0aGUgcmVmZXJyZXIgcG9saWN5IGlmIHJlcXVpcmVkXG4gICAgaWYgKCFpcy5lbXB0eShyZWZlcnJlclBvbGljeSkpIHtcbiAgICAgIGlmcmFtZS5zZXRBdHRyaWJ1dGUoJ3JlZmVycmVyUG9saWN5JywgcmVmZXJyZXJQb2xpY3kpO1xuICAgIH1cblxuICAgIC8vIEluamVjdCB0aGUgcGFja2FnZVxuICAgIGlmIChwcmVtaXVtIHx8ICFjb25maWcuY3VzdG9tQ29udHJvbHMpIHtcbiAgICAgIGlmcmFtZS5zZXRBdHRyaWJ1dGUoJ2RhdGEtcG9zdGVyJywgcGxheWVyLnBvc3Rlcik7XG4gICAgICBwbGF5ZXIubWVkaWEgPSByZXBsYWNlRWxlbWVudChpZnJhbWUsIHBsYXllci5tZWRpYSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IHdyYXBwZXIgPSBjcmVhdGVFbGVtZW50KCdkaXYnLCB7XG4gICAgICAgIGNsYXNzOiBwbGF5ZXIuY29uZmlnLmNsYXNzTmFtZXMuZW1iZWRDb250YWluZXIsXG4gICAgICAgICdkYXRhLXBvc3Rlcic6IHBsYXllci5wb3N0ZXIsXG4gICAgICB9KTtcbiAgICAgIHdyYXBwZXIuYXBwZW5kQ2hpbGQoaWZyYW1lKTtcbiAgICAgIHBsYXllci5tZWRpYSA9IHJlcGxhY2VFbGVtZW50KHdyYXBwZXIsIHBsYXllci5tZWRpYSk7XG4gICAgfVxuXG4gICAgLy8gR2V0IHBvc3RlciBpbWFnZVxuICAgIGlmICghY29uZmlnLmN1c3RvbUNvbnRyb2xzKSB7XG4gICAgICBmZXRjaChmb3JtYXQocGxheWVyLmNvbmZpZy51cmxzLnZpbWVvLmFwaSwgc3JjKSkudGhlbigocmVzcG9uc2UpID0+IHtcbiAgICAgICAgaWYgKGlzLmVtcHR5KHJlc3BvbnNlKSB8fCAhcmVzcG9uc2UudGh1bWJuYWlsX3VybCkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFNldCBhbmQgc2hvdyBwb3N0ZXJcbiAgICAgICAgdWkuc2V0UG9zdGVyLmNhbGwocGxheWVyLCByZXNwb25zZS50aHVtYm5haWxfdXJsKS5jYXRjaCgoKSA9PiB7fSk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBTZXR1cCBpbnN0YW5jZVxuICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS92aW1lby9wbGF5ZXIuanNcbiAgICBwbGF5ZXIuZW1iZWQgPSBuZXcgd2luZG93LlZpbWVvLlBsYXllcihpZnJhbWUsIHtcbiAgICAgIGF1dG9wYXVzZTogcGxheWVyLmNvbmZpZy5hdXRvcGF1c2UsXG4gICAgICBtdXRlZDogcGxheWVyLm11dGVkLFxuICAgIH0pO1xuXG4gICAgcGxheWVyLm1lZGlhLnBhdXNlZCA9IHRydWU7XG4gICAgcGxheWVyLm1lZGlhLmN1cnJlbnRUaW1lID0gMDtcblxuICAgIC8vIERpc2FibGUgbmF0aXZlIHRleHQgdHJhY2sgcmVuZGVyaW5nXG4gICAgaWYgKHBsYXllci5zdXBwb3J0ZWQudWkpIHtcbiAgICAgIHBsYXllci5lbWJlZC5kaXNhYmxlVGV4dFRyYWNrKCk7XG4gICAgfVxuXG4gICAgLy8gQ3JlYXRlIGEgZmF1eCBIVE1MNSBBUEkgdXNpbmcgdGhlIFZpbWVvIEFQSVxuICAgIHBsYXllci5tZWRpYS5wbGF5ID0gKCkgPT4ge1xuICAgICAgYXNzdXJlUGxheWJhY2tTdGF0ZS5jYWxsKHBsYXllciwgdHJ1ZSk7XG4gICAgICByZXR1cm4gcGxheWVyLmVtYmVkLnBsYXkoKTtcbiAgICB9O1xuXG4gICAgcGxheWVyLm1lZGlhLnBhdXNlID0gKCkgPT4ge1xuICAgICAgYXNzdXJlUGxheWJhY2tTdGF0ZS5jYWxsKHBsYXllciwgZmFsc2UpO1xuICAgICAgcmV0dXJuIHBsYXllci5lbWJlZC5wYXVzZSgpO1xuICAgIH07XG5cbiAgICBwbGF5ZXIubWVkaWEuc3RvcCA9ICgpID0+IHtcbiAgICAgIHBsYXllci5wYXVzZSgpO1xuICAgICAgcGxheWVyLmN1cnJlbnRUaW1lID0gMDtcbiAgICB9O1xuXG4gICAgLy8gU2Vla2luZ1xuICAgIGxldCB7IGN1cnJlbnRUaW1lIH0gPSBwbGF5ZXIubWVkaWE7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHBsYXllci5tZWRpYSwgJ2N1cnJlbnRUaW1lJywge1xuICAgICAgZ2V0KCkge1xuICAgICAgICByZXR1cm4gY3VycmVudFRpbWU7XG4gICAgICB9LFxuICAgICAgc2V0KHRpbWUpIHtcbiAgICAgICAgLy8gVmltZW8gd2lsbCBhdXRvbWF0aWNhbGx5IHBsYXkgb24gc2VlayBpZiB0aGUgdmlkZW8gaGFzbid0IGJlZW4gcGxheWVkIGJlZm9yZVxuXG4gICAgICAgIC8vIEdldCBjdXJyZW50IHBhdXNlZCBzdGF0ZSBhbmQgdm9sdW1lIGV0Y1xuICAgICAgICBjb25zdCB7IGVtYmVkLCBtZWRpYSwgcGF1c2VkLCB2b2x1bWUgfSA9IHBsYXllcjtcbiAgICAgICAgY29uc3QgcmVzdG9yZVBhdXNlID0gcGF1c2VkICYmICFlbWJlZC5oYXNQbGF5ZWQ7XG5cbiAgICAgICAgLy8gU2V0IHNlZWtpbmcgc3RhdGUgYW5kIHRyaWdnZXIgZXZlbnRcbiAgICAgICAgbWVkaWEuc2Vla2luZyA9IHRydWU7XG4gICAgICAgIHRyaWdnZXJFdmVudC5jYWxsKHBsYXllciwgbWVkaWEsICdzZWVraW5nJyk7XG5cbiAgICAgICAgLy8gSWYgcGF1c2VkLCBtdXRlIHVudGlsIHNlZWsgaXMgY29tcGxldGVcbiAgICAgICAgUHJvbWlzZS5yZXNvbHZlKHJlc3RvcmVQYXVzZSAmJiBlbWJlZC5zZXRWb2x1bWUoMCkpXG4gICAgICAgICAgLy8gU2Vla1xuICAgICAgICAgIC50aGVuKCgpID0+IGVtYmVkLnNldEN1cnJlbnRUaW1lKHRpbWUpKVxuICAgICAgICAgIC8vIFJlc3RvcmUgcGF1c2VkXG4gICAgICAgICAgLnRoZW4oKCkgPT4gcmVzdG9yZVBhdXNlICYmIGVtYmVkLnBhdXNlKCkpXG4gICAgICAgICAgLy8gUmVzdG9yZSB2b2x1bWVcbiAgICAgICAgICAudGhlbigoKSA9PiByZXN0b3JlUGF1c2UgJiYgZW1iZWQuc2V0Vm9sdW1lKHZvbHVtZSkpXG4gICAgICAgICAgLmNhdGNoKCgpID0+IHtcbiAgICAgICAgICAgIC8vIERvIG5vdGhpbmdcbiAgICAgICAgICB9KTtcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICAvLyBQbGF5YmFjayBzcGVlZFxuICAgIGxldCBzcGVlZCA9IHBsYXllci5jb25maWcuc3BlZWQuc2VsZWN0ZWQ7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHBsYXllci5tZWRpYSwgJ3BsYXliYWNrUmF0ZScsIHtcbiAgICAgIGdldCgpIHtcbiAgICAgICAgcmV0dXJuIHNwZWVkO1xuICAgICAgfSxcbiAgICAgIHNldChpbnB1dCkge1xuICAgICAgICBwbGF5ZXIuZW1iZWRcbiAgICAgICAgICAuc2V0UGxheWJhY2tSYXRlKGlucHV0KVxuICAgICAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgICAgIHNwZWVkID0gaW5wdXQ7XG4gICAgICAgICAgICB0cmlnZ2VyRXZlbnQuY2FsbChwbGF5ZXIsIHBsYXllci5tZWRpYSwgJ3JhdGVjaGFuZ2UnKTtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5jYXRjaCgoKSA9PiB7XG4gICAgICAgICAgICAvLyBDYW5ub3Qgc2V0IFBsYXliYWNrIFJhdGUsIFZpZGVvIGlzIHByb2JhYmx5IG5vdCBvbiBQcm8gYWNjb3VudFxuICAgICAgICAgICAgcGxheWVyLm9wdGlvbnMuc3BlZWQgPSBbMV07XG4gICAgICAgICAgfSk7XG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgLy8gVm9sdW1lXG4gICAgbGV0IHsgdm9sdW1lIH0gPSBwbGF5ZXIuY29uZmlnO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwbGF5ZXIubWVkaWEsICd2b2x1bWUnLCB7XG4gICAgICBnZXQoKSB7XG4gICAgICAgIHJldHVybiB2b2x1bWU7XG4gICAgICB9LFxuICAgICAgc2V0KGlucHV0KSB7XG4gICAgICAgIHBsYXllci5lbWJlZC5zZXRWb2x1bWUoaW5wdXQpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgIHZvbHVtZSA9IGlucHV0O1xuICAgICAgICAgIHRyaWdnZXJFdmVudC5jYWxsKHBsYXllciwgcGxheWVyLm1lZGlhLCAndm9sdW1lY2hhbmdlJyk7XG4gICAgICAgIH0pO1xuICAgICAgfSxcbiAgICB9KTtcblxuICAgIC8vIE11dGVkXG4gICAgbGV0IHsgbXV0ZWQgfSA9IHBsYXllci5jb25maWc7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHBsYXllci5tZWRpYSwgJ211dGVkJywge1xuICAgICAgZ2V0KCkge1xuICAgICAgICByZXR1cm4gbXV0ZWQ7XG4gICAgICB9LFxuICAgICAgc2V0KGlucHV0KSB7XG4gICAgICAgIGNvbnN0IHRvZ2dsZSA9IGlzLmJvb2xlYW4oaW5wdXQpID8gaW5wdXQgOiBmYWxzZTtcblxuICAgICAgICBwbGF5ZXIuZW1iZWQuc2V0Vm9sdW1lKHRvZ2dsZSA/IDAgOiBwbGF5ZXIuY29uZmlnLnZvbHVtZSkudGhlbigoKSA9PiB7XG4gICAgICAgICAgbXV0ZWQgPSB0b2dnbGU7XG4gICAgICAgICAgdHJpZ2dlckV2ZW50LmNhbGwocGxheWVyLCBwbGF5ZXIubWVkaWEsICd2b2x1bWVjaGFuZ2UnKTtcbiAgICAgICAgfSk7XG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgLy8gTG9vcFxuICAgIGxldCB7IGxvb3AgfSA9IHBsYXllci5jb25maWc7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHBsYXllci5tZWRpYSwgJ2xvb3AnLCB7XG4gICAgICBnZXQoKSB7XG4gICAgICAgIHJldHVybiBsb29wO1xuICAgICAgfSxcbiAgICAgIHNldChpbnB1dCkge1xuICAgICAgICBjb25zdCB0b2dnbGUgPSBpcy5ib29sZWFuKGlucHV0KSA/IGlucHV0IDogcGxheWVyLmNvbmZpZy5sb29wLmFjdGl2ZTtcblxuICAgICAgICBwbGF5ZXIuZW1iZWQuc2V0TG9vcCh0b2dnbGUpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgIGxvb3AgPSB0b2dnbGU7XG4gICAgICAgIH0pO1xuICAgICAgfSxcbiAgICB9KTtcblxuICAgIC8vIFNvdXJjZVxuICAgIGxldCBjdXJyZW50U3JjO1xuICAgIHBsYXllci5lbWJlZFxuICAgICAgLmdldFZpZGVvVXJsKClcbiAgICAgIC50aGVuKCh2YWx1ZSkgPT4ge1xuICAgICAgICBjdXJyZW50U3JjID0gdmFsdWU7XG4gICAgICAgIGNvbnRyb2xzLnNldERvd25sb2FkVXJsLmNhbGwocGxheWVyKTtcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goKGVycm9yKSA9PiB7XG4gICAgICAgIHRoaXMuZGVidWcud2FybihlcnJvcik7XG4gICAgICB9KTtcblxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwbGF5ZXIubWVkaWEsICdjdXJyZW50U3JjJywge1xuICAgICAgZ2V0KCkge1xuICAgICAgICByZXR1cm4gY3VycmVudFNyYztcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICAvLyBFbmRlZFxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwbGF5ZXIubWVkaWEsICdlbmRlZCcsIHtcbiAgICAgIGdldCgpIHtcbiAgICAgICAgcmV0dXJuIHBsYXllci5jdXJyZW50VGltZSA9PT0gcGxheWVyLmR1cmF0aW9uO1xuICAgICAgfSxcbiAgICB9KTtcblxuICAgIC8vIFNldCBhc3BlY3QgcmF0aW8gYmFzZWQgb24gdmlkZW8gc2l6ZVxuICAgIFByb21pc2UuYWxsKFtwbGF5ZXIuZW1iZWQuZ2V0VmlkZW9XaWR0aCgpLCBwbGF5ZXIuZW1iZWQuZ2V0VmlkZW9IZWlnaHQoKV0pLnRoZW4oKGRpbWVuc2lvbnMpID0+IHtcbiAgICAgIGNvbnN0IFt3aWR0aCwgaGVpZ2h0XSA9IGRpbWVuc2lvbnM7XG4gICAgICBwbGF5ZXIuZW1iZWQucmF0aW8gPSByb3VuZEFzcGVjdFJhdGlvKHdpZHRoLCBoZWlnaHQpO1xuICAgICAgc2V0QXNwZWN0UmF0aW8uY2FsbCh0aGlzKTtcbiAgICB9KTtcblxuICAgIC8vIFNldCBhdXRvcGF1c2VcbiAgICBwbGF5ZXIuZW1iZWQuc2V0QXV0b3BhdXNlKHBsYXllci5jb25maWcuYXV0b3BhdXNlKS50aGVuKChzdGF0ZSkgPT4ge1xuICAgICAgcGxheWVyLmNvbmZpZy5hdXRvcGF1c2UgPSBzdGF0ZTtcbiAgICB9KTtcblxuICAgIC8vIEdldCB0aXRsZVxuICAgIHBsYXllci5lbWJlZC5nZXRWaWRlb1RpdGxlKCkudGhlbigodGl0bGUpID0+IHtcbiAgICAgIHBsYXllci5jb25maWcudGl0bGUgPSB0aXRsZTtcbiAgICAgIHVpLnNldFRpdGxlLmNhbGwodGhpcyk7XG4gICAgfSk7XG5cbiAgICAvLyBHZXQgY3VycmVudCB0aW1lXG4gICAgcGxheWVyLmVtYmVkLmdldEN1cnJlbnRUaW1lKCkudGhlbigodmFsdWUpID0+IHtcbiAgICAgIGN1cnJlbnRUaW1lID0gdmFsdWU7XG4gICAgICB0cmlnZ2VyRXZlbnQuY2FsbChwbGF5ZXIsIHBsYXllci5tZWRpYSwgJ3RpbWV1cGRhdGUnKTtcbiAgICB9KTtcblxuICAgIC8vIEdldCBkdXJhdGlvblxuICAgIHBsYXllci5lbWJlZC5nZXREdXJhdGlvbigpLnRoZW4oKHZhbHVlKSA9PiB7XG4gICAgICBwbGF5ZXIubWVkaWEuZHVyYXRpb24gPSB2YWx1ZTtcbiAgICAgIHRyaWdnZXJFdmVudC5jYWxsKHBsYXllciwgcGxheWVyLm1lZGlhLCAnZHVyYXRpb25jaGFuZ2UnKTtcbiAgICB9KTtcblxuICAgIC8vIEdldCBjYXB0aW9uc1xuICAgIHBsYXllci5lbWJlZC5nZXRUZXh0VHJhY2tzKCkudGhlbigodHJhY2tzKSA9PiB7XG4gICAgICBwbGF5ZXIubWVkaWEudGV4dFRyYWNrcyA9IHRyYWNrcztcbiAgICAgIGNhcHRpb25zLnNldHVwLmNhbGwocGxheWVyKTtcbiAgICB9KTtcblxuICAgIHBsYXllci5lbWJlZC5vbignY3VlY2hhbmdlJywgKHsgY3VlcyA9IFtdIH0pID0+IHtcbiAgICAgIGNvbnN0IHN0cmlwcGVkQ3VlcyA9IGN1ZXMubWFwKChjdWUpID0+IHN0cmlwSFRNTChjdWUudGV4dCkpO1xuICAgICAgY2FwdGlvbnMudXBkYXRlQ3Vlcy5jYWxsKHBsYXllciwgc3RyaXBwZWRDdWVzKTtcbiAgICB9KTtcblxuICAgIHBsYXllci5lbWJlZC5vbignbG9hZGVkJywgKCkgPT4ge1xuICAgICAgLy8gQXNzdXJlIHN0YXRlIGFuZCBldmVudHMgYXJlIHVwZGF0ZWQgb24gYXV0b3BsYXlcbiAgICAgIHBsYXllci5lbWJlZC5nZXRQYXVzZWQoKS50aGVuKChwYXVzZWQpID0+IHtcbiAgICAgICAgYXNzdXJlUGxheWJhY2tTdGF0ZS5jYWxsKHBsYXllciwgIXBhdXNlZCk7XG4gICAgICAgIGlmICghcGF1c2VkKSB7XG4gICAgICAgICAgdHJpZ2dlckV2ZW50LmNhbGwocGxheWVyLCBwbGF5ZXIubWVkaWEsICdwbGF5aW5nJyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICBpZiAoaXMuZWxlbWVudChwbGF5ZXIuZW1iZWQuZWxlbWVudCkgJiYgcGxheWVyLnN1cHBvcnRlZC51aSkge1xuICAgICAgICBjb25zdCBmcmFtZSA9IHBsYXllci5lbWJlZC5lbGVtZW50O1xuXG4gICAgICAgIC8vIEZpeCBrZXlib2FyZCBmb2N1cyBpc3N1ZXNcbiAgICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3NhbXBvdHRzL3BseXIvaXNzdWVzLzMxN1xuICAgICAgICBmcmFtZS5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgLTEpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcGxheWVyLmVtYmVkLm9uKCdidWZmZXJzdGFydCcsICgpID0+IHtcbiAgICAgIHRyaWdnZXJFdmVudC5jYWxsKHBsYXllciwgcGxheWVyLm1lZGlhLCAnd2FpdGluZycpO1xuICAgIH0pO1xuXG4gICAgcGxheWVyLmVtYmVkLm9uKCdidWZmZXJlbmQnLCAoKSA9PiB7XG4gICAgICB0cmlnZ2VyRXZlbnQuY2FsbChwbGF5ZXIsIHBsYXllci5tZWRpYSwgJ3BsYXlpbmcnKTtcbiAgICB9KTtcblxuICAgIHBsYXllci5lbWJlZC5vbigncGxheScsICgpID0+IHtcbiAgICAgIGFzc3VyZVBsYXliYWNrU3RhdGUuY2FsbChwbGF5ZXIsIHRydWUpO1xuICAgICAgdHJpZ2dlckV2ZW50LmNhbGwocGxheWVyLCBwbGF5ZXIubWVkaWEsICdwbGF5aW5nJyk7XG4gICAgfSk7XG5cbiAgICBwbGF5ZXIuZW1iZWQub24oJ3BhdXNlJywgKCkgPT4ge1xuICAgICAgYXNzdXJlUGxheWJhY2tTdGF0ZS5jYWxsKHBsYXllciwgZmFsc2UpO1xuICAgIH0pO1xuXG4gICAgcGxheWVyLmVtYmVkLm9uKCd0aW1ldXBkYXRlJywgKGRhdGEpID0+IHtcbiAgICAgIHBsYXllci5tZWRpYS5zZWVraW5nID0gZmFsc2U7XG4gICAgICBjdXJyZW50VGltZSA9IGRhdGEuc2Vjb25kcztcbiAgICAgIHRyaWdnZXJFdmVudC5jYWxsKHBsYXllciwgcGxheWVyLm1lZGlhLCAndGltZXVwZGF0ZScpO1xuICAgIH0pO1xuXG4gICAgcGxheWVyLmVtYmVkLm9uKCdwcm9ncmVzcycsIChkYXRhKSA9PiB7XG4gICAgICBwbGF5ZXIubWVkaWEuYnVmZmVyZWQgPSBkYXRhLnBlcmNlbnQ7XG4gICAgICB0cmlnZ2VyRXZlbnQuY2FsbChwbGF5ZXIsIHBsYXllci5tZWRpYSwgJ3Byb2dyZXNzJyk7XG5cbiAgICAgIC8vIENoZWNrIGFsbCBsb2FkZWRcbiAgICAgIGlmIChwYXJzZUludChkYXRhLnBlcmNlbnQsIDEwKSA9PT0gMSkge1xuICAgICAgICB0cmlnZ2VyRXZlbnQuY2FsbChwbGF5ZXIsIHBsYXllci5tZWRpYSwgJ2NhbnBsYXl0aHJvdWdoJyk7XG4gICAgICB9XG5cbiAgICAgIC8vIEdldCBkdXJhdGlvbiBhcyBpZiB3ZSBkbyBpdCBiZWZvcmUgbG9hZCwgaXQgZ2l2ZXMgYW4gaW5jb3JyZWN0IHZhbHVlXG4gICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vc2FtcG90dHMvcGx5ci9pc3N1ZXMvODkxXG4gICAgICBwbGF5ZXIuZW1iZWQuZ2V0RHVyYXRpb24oKS50aGVuKCh2YWx1ZSkgPT4ge1xuICAgICAgICBpZiAodmFsdWUgIT09IHBsYXllci5tZWRpYS5kdXJhdGlvbikge1xuICAgICAgICAgIHBsYXllci5tZWRpYS5kdXJhdGlvbiA9IHZhbHVlO1xuICAgICAgICAgIHRyaWdnZXJFdmVudC5jYWxsKHBsYXllciwgcGxheWVyLm1lZGlhLCAnZHVyYXRpb25jaGFuZ2UnKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBwbGF5ZXIuZW1iZWQub24oJ3NlZWtlZCcsICgpID0+IHtcbiAgICAgIHBsYXllci5tZWRpYS5zZWVraW5nID0gZmFsc2U7XG4gICAgICB0cmlnZ2VyRXZlbnQuY2FsbChwbGF5ZXIsIHBsYXllci5tZWRpYSwgJ3NlZWtlZCcpO1xuICAgIH0pO1xuXG4gICAgcGxheWVyLmVtYmVkLm9uKCdlbmRlZCcsICgpID0+IHtcbiAgICAgIHBsYXllci5tZWRpYS5wYXVzZWQgPSB0cnVlO1xuICAgICAgdHJpZ2dlckV2ZW50LmNhbGwocGxheWVyLCBwbGF5ZXIubWVkaWEsICdlbmRlZCcpO1xuICAgIH0pO1xuXG4gICAgcGxheWVyLmVtYmVkLm9uKCdlcnJvcicsIChkZXRhaWwpID0+IHtcbiAgICAgIHBsYXllci5tZWRpYS5lcnJvciA9IGRldGFpbDtcbiAgICAgIHRyaWdnZXJFdmVudC5jYWxsKHBsYXllciwgcGxheWVyLm1lZGlhLCAnZXJyb3InKTtcbiAgICB9KTtcblxuICAgIC8vIFJlYnVpbGQgVUlcbiAgICBpZiAoY29uZmlnLmN1c3RvbUNvbnRyb2xzKSB7XG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHVpLmJ1aWxkLmNhbGwocGxheWVyKSwgMCk7XG4gICAgfVxuICB9LFxufTtcblxuZXhwb3J0IGRlZmF1bHQgdmltZW87XG4iLCIvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gWW91VHViZSBwbHVnaW5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmltcG9ydCB1aSBmcm9tICcuLi91aSc7XG5pbXBvcnQgeyBjcmVhdGVFbGVtZW50LCByZXBsYWNlRWxlbWVudCwgdG9nZ2xlQ2xhc3MgfSBmcm9tICcuLi91dGlscy9lbGVtZW50cyc7XG5pbXBvcnQgeyB0cmlnZ2VyRXZlbnQgfSBmcm9tICcuLi91dGlscy9ldmVudHMnO1xuaW1wb3J0IGZldGNoIGZyb20gJy4uL3V0aWxzL2ZldGNoJztcbmltcG9ydCBpcyBmcm9tICcuLi91dGlscy9pcyc7XG5pbXBvcnQgbG9hZEltYWdlIGZyb20gJy4uL3V0aWxzL2xvYWQtaW1hZ2UnO1xuaW1wb3J0IGxvYWRTY3JpcHQgZnJvbSAnLi4vdXRpbHMvbG9hZC1zY3JpcHQnO1xuaW1wb3J0IHsgZXh0ZW5kIH0gZnJvbSAnLi4vdXRpbHMvb2JqZWN0cyc7XG5pbXBvcnQgeyBmb3JtYXQsIGdlbmVyYXRlSWQgfSBmcm9tICcuLi91dGlscy9zdHJpbmdzJztcbmltcG9ydCB7IHJvdW5kQXNwZWN0UmF0aW8sIHNldEFzcGVjdFJhdGlvIH0gZnJvbSAnLi4vdXRpbHMvc3R5bGUnO1xuXG4vLyBQYXJzZSBZb3VUdWJlIElEIGZyb20gVVJMXG5mdW5jdGlvbiBwYXJzZUlkKHVybCkge1xuICBpZiAoaXMuZW1wdHkodXJsKSkge1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgY29uc3QgcmVnZXggPSAvXi4qKHlvdXR1LmJlXFwvfHZcXC98dVxcL1xcd1xcL3xlbWJlZFxcL3x3YXRjaFxcP3Y9fCZ2PSkoW14jJj9dKikuKi87XG4gIHJldHVybiB1cmwubWF0Y2gocmVnZXgpID8gUmVnRXhwLiQyIDogdXJsO1xufVxuXG4vLyBTZXQgcGxheWJhY2sgc3RhdGUgYW5kIHRyaWdnZXIgY2hhbmdlIChvbmx5IG9uIGFjdHVhbCBjaGFuZ2UpXG5mdW5jdGlvbiBhc3N1cmVQbGF5YmFja1N0YXRlKHBsYXkpIHtcbiAgaWYgKHBsYXkgJiYgIXRoaXMuZW1iZWQuaGFzUGxheWVkKSB7XG4gICAgdGhpcy5lbWJlZC5oYXNQbGF5ZWQgPSB0cnVlO1xuICB9XG4gIGlmICh0aGlzLm1lZGlhLnBhdXNlZCA9PT0gcGxheSkge1xuICAgIHRoaXMubWVkaWEucGF1c2VkID0gIXBsYXk7XG4gICAgdHJpZ2dlckV2ZW50LmNhbGwodGhpcywgdGhpcy5tZWRpYSwgcGxheSA/ICdwbGF5JyA6ICdwYXVzZScpO1xuICB9XG59XG5cbmZ1bmN0aW9uIGdldEhvc3QoY29uZmlnKSB7XG4gIGlmIChjb25maWcubm9Db29raWUpIHtcbiAgICByZXR1cm4gJ2h0dHBzOi8vd3d3LnlvdXR1YmUtbm9jb29raWUuY29tJztcbiAgfVxuXG4gIGlmICh3aW5kb3cubG9jYXRpb24ucHJvdG9jb2wgPT09ICdodHRwOicpIHtcbiAgICByZXR1cm4gJ2h0dHA6Ly93d3cueW91dHViZS5jb20nO1xuICB9XG5cbiAgLy8gVXNlIFlvdVR1YmUncyBkZWZhdWx0XG4gIHJldHVybiB1bmRlZmluZWQ7XG59XG5cbmNvbnN0IHlvdXR1YmUgPSB7XG4gIHNldHVwKCkge1xuICAgIC8vIEFkZCBlbWJlZCBjbGFzcyBmb3IgcmVzcG9uc2l2ZVxuICAgIHRvZ2dsZUNsYXNzKHRoaXMuZWxlbWVudHMud3JhcHBlciwgdGhpcy5jb25maWcuY2xhc3NOYW1lcy5lbWJlZCwgdHJ1ZSk7XG5cbiAgICAvLyBTZXR1cCBBUElcbiAgICBpZiAoaXMub2JqZWN0KHdpbmRvdy5ZVCkgJiYgaXMuZnVuY3Rpb24od2luZG93LllULlBsYXllcikpIHtcbiAgICAgIHlvdXR1YmUucmVhZHkuY2FsbCh0aGlzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gUmVmZXJlbmNlIGN1cnJlbnQgZ2xvYmFsIGNhbGxiYWNrXG4gICAgICBjb25zdCBjYWxsYmFjayA9IHdpbmRvdy5vbllvdVR1YmVJZnJhbWVBUElSZWFkeTtcblxuICAgICAgLy8gU2V0IGNhbGxiYWNrIHRvIHByb2Nlc3MgcXVldWVcbiAgICAgIHdpbmRvdy5vbllvdVR1YmVJZnJhbWVBUElSZWFkeSA9ICgpID0+IHtcbiAgICAgICAgLy8gQ2FsbCBnbG9iYWwgY2FsbGJhY2sgaWYgc2V0XG4gICAgICAgIGlmIChpcy5mdW5jdGlvbihjYWxsYmFjaykpIHtcbiAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICB9XG5cbiAgICAgICAgeW91dHViZS5yZWFkeS5jYWxsKHRoaXMpO1xuICAgICAgfTtcblxuICAgICAgLy8gTG9hZCB0aGUgU0RLXG4gICAgICBsb2FkU2NyaXB0KHRoaXMuY29uZmlnLnVybHMueW91dHViZS5zZGspLmNhdGNoKChlcnJvcikgPT4ge1xuICAgICAgICB0aGlzLmRlYnVnLndhcm4oJ1lvdVR1YmUgQVBJIGZhaWxlZCB0byBsb2FkJywgZXJyb3IpO1xuICAgICAgfSk7XG4gICAgfVxuICB9LFxuXG4gIC8vIEdldCB0aGUgbWVkaWEgdGl0bGVcbiAgZ2V0VGl0bGUodmlkZW9JZCkge1xuICAgIGNvbnN0IHVybCA9IGZvcm1hdCh0aGlzLmNvbmZpZy51cmxzLnlvdXR1YmUuYXBpLCB2aWRlb0lkKTtcblxuICAgIGZldGNoKHVybClcbiAgICAgIC50aGVuKChkYXRhKSA9PiB7XG4gICAgICAgIGlmIChpcy5vYmplY3QoZGF0YSkpIHtcbiAgICAgICAgICBjb25zdCB7IHRpdGxlLCBoZWlnaHQsIHdpZHRoIH0gPSBkYXRhO1xuXG4gICAgICAgICAgLy8gU2V0IHRpdGxlXG4gICAgICAgICAgdGhpcy5jb25maWcudGl0bGUgPSB0aXRsZTtcbiAgICAgICAgICB1aS5zZXRUaXRsZS5jYWxsKHRoaXMpO1xuXG4gICAgICAgICAgLy8gU2V0IGFzcGVjdCByYXRpb1xuICAgICAgICAgIHRoaXMuZW1iZWQucmF0aW8gPSByb3VuZEFzcGVjdFJhdGlvKHdpZHRoLCBoZWlnaHQpO1xuICAgICAgICB9XG5cbiAgICAgICAgc2V0QXNwZWN0UmF0aW8uY2FsbCh0aGlzKTtcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goKCkgPT4ge1xuICAgICAgICAvLyBTZXQgYXNwZWN0IHJhdGlvXG4gICAgICAgIHNldEFzcGVjdFJhdGlvLmNhbGwodGhpcyk7XG4gICAgICB9KTtcbiAgfSxcblxuICAvLyBBUEkgcmVhZHlcbiAgcmVhZHkoKSB7XG4gICAgY29uc3QgcGxheWVyID0gdGhpcztcbiAgICBjb25zdCBjb25maWcgPSBwbGF5ZXIuY29uZmlnLnlvdXR1YmU7XG4gICAgLy8gSWdub3JlIGFscmVhZHkgc2V0dXAgKHJhY2UgY29uZGl0aW9uKVxuICAgIGNvbnN0IGN1cnJlbnRJZCA9IHBsYXllci5tZWRpYSAmJiBwbGF5ZXIubWVkaWEuZ2V0QXR0cmlidXRlKCdpZCcpO1xuICAgIGlmICghaXMuZW1wdHkoY3VycmVudElkKSAmJiBjdXJyZW50SWQuc3RhcnRzV2l0aCgneW91dHViZS0nKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIEdldCB0aGUgc291cmNlIFVSTCBvciBJRFxuICAgIGxldCBzb3VyY2UgPSBwbGF5ZXIubWVkaWEuZ2V0QXR0cmlidXRlKCdzcmMnKTtcblxuICAgIC8vIEdldCBmcm9tIDxkaXY+IGlmIG5lZWRlZFxuICAgIGlmIChpcy5lbXB0eShzb3VyY2UpKSB7XG4gICAgICBzb3VyY2UgPSBwbGF5ZXIubWVkaWEuZ2V0QXR0cmlidXRlKHRoaXMuY29uZmlnLmF0dHJpYnV0ZXMuZW1iZWQuaWQpO1xuICAgIH1cblxuICAgIC8vIFJlcGxhY2UgdGhlIDxpZnJhbWU+IHdpdGggYSA8ZGl2PiBkdWUgdG8gWW91VHViZSBBUEkgaXNzdWVzXG4gICAgY29uc3QgdmlkZW9JZCA9IHBhcnNlSWQoc291cmNlKTtcbiAgICBjb25zdCBpZCA9IGdlbmVyYXRlSWQocGxheWVyLnByb3ZpZGVyKTtcbiAgICAvLyBSZXBsYWNlIG1lZGlhIGVsZW1lbnRcbiAgICBjb25zdCBjb250YWluZXIgPSBjcmVhdGVFbGVtZW50KCdkaXYnLCB7IGlkLCAnZGF0YS1wb3N0ZXInOiBjb25maWcuY3VzdG9tQ29udHJvbHMgPyBwbGF5ZXIucG9zdGVyIDogdW5kZWZpbmVkIH0pO1xuICAgIHBsYXllci5tZWRpYSA9IHJlcGxhY2VFbGVtZW50KGNvbnRhaW5lciwgcGxheWVyLm1lZGlhKTtcblxuICAgIC8vIE9ubHkgbG9hZCB0aGUgcG9zdGVyIHdoZW4gdXNpbmcgY3VzdG9tIGNvbnRyb2xzXG4gICAgaWYgKGNvbmZpZy5jdXN0b21Db250cm9scykge1xuICAgICAgY29uc3QgcG9zdGVyU3JjID0gKHMpID0+IGBodHRwczovL2kueXRpbWcuY29tL3ZpLyR7dmlkZW9JZH0vJHtzfWRlZmF1bHQuanBnYDtcblxuICAgICAgLy8gQ2hlY2sgdGh1bWJuYWlsIGltYWdlcyBpbiBvcmRlciBvZiBxdWFsaXR5LCBidXQgcmVqZWN0IGZhbGxiYWNrIHRodW1ibmFpbHMgKDEyMHB4IHdpZGUpXG4gICAgICBsb2FkSW1hZ2UocG9zdGVyU3JjKCdtYXhyZXMnKSwgMTIxKSAvLyBIaWdlc3QgcXVhbGl0eSBhbmQgdW5wYWRkZWRcbiAgICAgICAgLmNhdGNoKCgpID0+IGxvYWRJbWFnZShwb3N0ZXJTcmMoJ3NkJyksIDEyMSkpIC8vIDQ4MHAgcGFkZGVkIDQ6M1xuICAgICAgICAuY2F0Y2goKCkgPT4gbG9hZEltYWdlKHBvc3RlclNyYygnaHEnKSkpIC8vIDM2MHAgcGFkZGVkIDQ6My4gQWx3YXlzIGV4aXN0c1xuICAgICAgICAudGhlbigoaW1hZ2UpID0+IHVpLnNldFBvc3Rlci5jYWxsKHBsYXllciwgaW1hZ2Uuc3JjKSlcbiAgICAgICAgLnRoZW4oKHNyYykgPT4ge1xuICAgICAgICAgIC8vIElmIHRoZSBpbWFnZSBpcyBwYWRkZWQsIHVzZSBiYWNrZ3JvdW5kLXNpemUgXCJjb3ZlclwiIGluc3RlYWQgKGxpa2UgeW91dHViZSBkb2VzIHRvbyB3aXRoIHRoZWlyIHBvc3RlcnMpXG4gICAgICAgICAgaWYgKCFzcmMuaW5jbHVkZXMoJ21heHJlcycpKSB7XG4gICAgICAgICAgICBwbGF5ZXIuZWxlbWVudHMucG9zdGVyLnN0eWxlLmJhY2tncm91bmRTaXplID0gJ2NvdmVyJztcbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaCgoKSA9PiB7fSk7XG4gICAgfVxuXG4gICAgLy8gU2V0dXAgaW5zdGFuY2VcbiAgICAvLyBodHRwczovL2RldmVsb3BlcnMuZ29vZ2xlLmNvbS95b3V0dWJlL2lmcmFtZV9hcGlfcmVmZXJlbmNlXG4gICAgcGxheWVyLmVtYmVkID0gbmV3IHdpbmRvdy5ZVC5QbGF5ZXIocGxheWVyLm1lZGlhLCB7XG4gICAgICB2aWRlb0lkLFxuICAgICAgaG9zdDogZ2V0SG9zdChjb25maWcpLFxuICAgICAgcGxheWVyVmFyczogZXh0ZW5kKFxuICAgICAgICB7fSxcbiAgICAgICAge1xuICAgICAgICAgIC8vIEF1dG9wbGF5XG4gICAgICAgICAgYXV0b3BsYXk6IHBsYXllci5jb25maWcuYXV0b3BsYXkgPyAxIDogMCxcbiAgICAgICAgICAvLyBpZnJhbWUgaW50ZXJmYWNlIGxhbmd1YWdlXG4gICAgICAgICAgaGw6IHBsYXllci5jb25maWcuaGwsXG4gICAgICAgICAgLy8gT25seSBzaG93IGNvbnRyb2xzIGlmIG5vdCBmdWxseSBzdXBwb3J0ZWQgb3Igb3B0ZWQgb3V0XG4gICAgICAgICAgY29udHJvbHM6IHBsYXllci5zdXBwb3J0ZWQudWkgJiYgY29uZmlnLmN1c3RvbUNvbnRyb2xzID8gMCA6IDEsXG4gICAgICAgICAgLy8gRGlzYWJsZSBrZXlib2FyZCBhcyB3ZSBoYW5kbGUgaXRcbiAgICAgICAgICBkaXNhYmxla2I6IDEsXG4gICAgICAgICAgLy8gQWxsb3cgaU9TIGlubGluZSBwbGF5YmFja1xuICAgICAgICAgIHBsYXlzaW5saW5lOiAhcGxheWVyLmNvbmZpZy5mdWxsc2NyZWVuLmlvc05hdGl2ZSA/IDEgOiAwLFxuICAgICAgICAgIC8vIENhcHRpb25zIGFyZSBmbGFreSBvbiBZb3VUdWJlXG4gICAgICAgICAgY2NfbG9hZF9wb2xpY3k6IHBsYXllci5jYXB0aW9ucy5hY3RpdmUgPyAxIDogMCxcbiAgICAgICAgICBjY19sYW5nX3ByZWY6IHBsYXllci5jb25maWcuY2FwdGlvbnMubGFuZ3VhZ2UsXG4gICAgICAgICAgLy8gVHJhY2tpbmcgZm9yIHN0YXRzXG4gICAgICAgICAgd2lkZ2V0X3JlZmVycmVyOiB3aW5kb3cgPyB3aW5kb3cubG9jYXRpb24uaHJlZiA6IG51bGwsXG4gICAgICAgIH0sXG4gICAgICAgIGNvbmZpZyxcbiAgICAgICksXG4gICAgICBldmVudHM6IHtcbiAgICAgICAgb25FcnJvcihldmVudCkge1xuICAgICAgICAgIC8vIFlvdVR1YmUgbWF5IGZpcmUgb25FcnJvciB0d2ljZSwgc28gb25seSBoYW5kbGUgaXQgb25jZVxuICAgICAgICAgIGlmICghcGxheWVyLm1lZGlhLmVycm9yKSB7XG4gICAgICAgICAgICBjb25zdCBjb2RlID0gZXZlbnQuZGF0YTtcbiAgICAgICAgICAgIC8vIE1lc3NhZ2VzIGNvcGllZCBmcm9tIGh0dHBzOi8vZGV2ZWxvcGVycy5nb29nbGUuY29tL3lvdXR1YmUvaWZyYW1lX2FwaV9yZWZlcmVuY2Ujb25FcnJvclxuICAgICAgICAgICAgY29uc3QgbWVzc2FnZSA9XG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAyOiAnVGhlIHJlcXVlc3QgY29udGFpbnMgYW4gaW52YWxpZCBwYXJhbWV0ZXIgdmFsdWUuIEZvciBleGFtcGxlLCB0aGlzIGVycm9yIG9jY3VycyBpZiB5b3Ugc3BlY2lmeSBhIHZpZGVvIElEIHRoYXQgZG9lcyBub3QgaGF2ZSAxMSBjaGFyYWN0ZXJzLCBvciBpZiB0aGUgdmlkZW8gSUQgY29udGFpbnMgaW52YWxpZCBjaGFyYWN0ZXJzLCBzdWNoIGFzIGV4Y2xhbWF0aW9uIHBvaW50cyBvciBhc3Rlcmlza3MuJyxcbiAgICAgICAgICAgICAgICA1OiAnVGhlIHJlcXVlc3RlZCBjb250ZW50IGNhbm5vdCBiZSBwbGF5ZWQgaW4gYW4gSFRNTDUgcGxheWVyIG9yIGFub3RoZXIgZXJyb3IgcmVsYXRlZCB0byB0aGUgSFRNTDUgcGxheWVyIGhhcyBvY2N1cnJlZC4nLFxuICAgICAgICAgICAgICAgIDEwMDogJ1RoZSB2aWRlbyByZXF1ZXN0ZWQgd2FzIG5vdCBmb3VuZC4gVGhpcyBlcnJvciBvY2N1cnMgd2hlbiBhIHZpZGVvIGhhcyBiZWVuIHJlbW92ZWQgKGZvciBhbnkgcmVhc29uKSBvciBoYXMgYmVlbiBtYXJrZWQgYXMgcHJpdmF0ZS4nLFxuICAgICAgICAgICAgICAgIDEwMTogJ1RoZSBvd25lciBvZiB0aGUgcmVxdWVzdGVkIHZpZGVvIGRvZXMgbm90IGFsbG93IGl0IHRvIGJlIHBsYXllZCBpbiBlbWJlZGRlZCBwbGF5ZXJzLicsXG4gICAgICAgICAgICAgICAgMTUwOiAnVGhlIG93bmVyIG9mIHRoZSByZXF1ZXN0ZWQgdmlkZW8gZG9lcyBub3QgYWxsb3cgaXQgdG8gYmUgcGxheWVkIGluIGVtYmVkZGVkIHBsYXllcnMuJyxcbiAgICAgICAgICAgICAgfVtjb2RlXSB8fCAnQW4gdW5rbm93biBlcnJvciBvY2N1cmVkJztcblxuICAgICAgICAgICAgcGxheWVyLm1lZGlhLmVycm9yID0geyBjb2RlLCBtZXNzYWdlIH07XG5cbiAgICAgICAgICAgIHRyaWdnZXJFdmVudC5jYWxsKHBsYXllciwgcGxheWVyLm1lZGlhLCAnZXJyb3InKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIG9uUGxheWJhY2tSYXRlQ2hhbmdlKGV2ZW50KSB7XG4gICAgICAgICAgLy8gR2V0IHRoZSBpbnN0YW5jZVxuICAgICAgICAgIGNvbnN0IGluc3RhbmNlID0gZXZlbnQudGFyZ2V0O1xuXG4gICAgICAgICAgLy8gR2V0IGN1cnJlbnQgc3BlZWRcbiAgICAgICAgICBwbGF5ZXIubWVkaWEucGxheWJhY2tSYXRlID0gaW5zdGFuY2UuZ2V0UGxheWJhY2tSYXRlKCk7XG5cbiAgICAgICAgICB0cmlnZ2VyRXZlbnQuY2FsbChwbGF5ZXIsIHBsYXllci5tZWRpYSwgJ3JhdGVjaGFuZ2UnKTtcbiAgICAgICAgfSxcbiAgICAgICAgb25SZWFkeShldmVudCkge1xuICAgICAgICAgIC8vIEJhaWwgaWYgb25SZWFkeSBoYXMgYWxyZWFkeSBiZWVuIGNhbGxlZC4gU2VlIGlzc3VlICMxMTA4XG4gICAgICAgICAgaWYgKGlzLmZ1bmN0aW9uKHBsYXllci5tZWRpYS5wbGF5KSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICAvLyBHZXQgdGhlIGluc3RhbmNlXG4gICAgICAgICAgY29uc3QgaW5zdGFuY2UgPSBldmVudC50YXJnZXQ7XG5cbiAgICAgICAgICAvLyBHZXQgdGhlIHRpdGxlXG4gICAgICAgICAgeW91dHViZS5nZXRUaXRsZS5jYWxsKHBsYXllciwgdmlkZW9JZCk7XG5cbiAgICAgICAgICAvLyBDcmVhdGUgYSBmYXV4IEhUTUw1IEFQSSB1c2luZyB0aGUgWW91VHViZSBBUElcbiAgICAgICAgICBwbGF5ZXIubWVkaWEucGxheSA9ICgpID0+IHtcbiAgICAgICAgICAgIGFzc3VyZVBsYXliYWNrU3RhdGUuY2FsbChwbGF5ZXIsIHRydWUpO1xuICAgICAgICAgICAgaW5zdGFuY2UucGxheVZpZGVvKCk7XG4gICAgICAgICAgfTtcblxuICAgICAgICAgIHBsYXllci5tZWRpYS5wYXVzZSA9ICgpID0+IHtcbiAgICAgICAgICAgIGFzc3VyZVBsYXliYWNrU3RhdGUuY2FsbChwbGF5ZXIsIGZhbHNlKTtcbiAgICAgICAgICAgIGluc3RhbmNlLnBhdXNlVmlkZW8oKTtcbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgcGxheWVyLm1lZGlhLnN0b3AgPSAoKSA9PiB7XG4gICAgICAgICAgICBpbnN0YW5jZS5zdG9wVmlkZW8oKTtcbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgcGxheWVyLm1lZGlhLmR1cmF0aW9uID0gaW5zdGFuY2UuZ2V0RHVyYXRpb24oKTtcbiAgICAgICAgICBwbGF5ZXIubWVkaWEucGF1c2VkID0gdHJ1ZTtcblxuICAgICAgICAgIC8vIFNlZWtpbmdcbiAgICAgICAgICBwbGF5ZXIubWVkaWEuY3VycmVudFRpbWUgPSAwO1xuICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwbGF5ZXIubWVkaWEsICdjdXJyZW50VGltZScsIHtcbiAgICAgICAgICAgIGdldCgpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIE51bWJlcihpbnN0YW5jZS5nZXRDdXJyZW50VGltZSgpKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXQodGltZSkge1xuICAgICAgICAgICAgICAvLyBJZiBwYXVzZWQgYW5kIG5ldmVyIHBsYXllZCwgbXV0ZSBhdWRpbyBwcmV2ZW50aXZlbHkgKFlvdVR1YmUgc3RhcnRzIHBsYXlpbmcgb24gc2VlayBpZiB0aGUgdmlkZW8gaGFzbid0IGJlZW4gcGxheWVkIHlldCkuXG4gICAgICAgICAgICAgIGlmIChwbGF5ZXIucGF1c2VkICYmICFwbGF5ZXIuZW1iZWQuaGFzUGxheWVkKSB7XG4gICAgICAgICAgICAgICAgcGxheWVyLmVtYmVkLm11dGUoKTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIC8vIFNldCBzZWVraW5nIHN0YXRlIGFuZCB0cmlnZ2VyIGV2ZW50XG4gICAgICAgICAgICAgIHBsYXllci5tZWRpYS5zZWVraW5nID0gdHJ1ZTtcbiAgICAgICAgICAgICAgdHJpZ2dlckV2ZW50LmNhbGwocGxheWVyLCBwbGF5ZXIubWVkaWEsICdzZWVraW5nJyk7XG5cbiAgICAgICAgICAgICAgLy8gU2VlayBhZnRlciBldmVudHMgc2VudFxuICAgICAgICAgICAgICBpbnN0YW5jZS5zZWVrVG8odGltZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgLy8gUGxheWJhY2sgc3BlZWRcbiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocGxheWVyLm1lZGlhLCAncGxheWJhY2tSYXRlJywge1xuICAgICAgICAgICAgZ2V0KCkge1xuICAgICAgICAgICAgICByZXR1cm4gaW5zdGFuY2UuZ2V0UGxheWJhY2tSYXRlKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0KGlucHV0KSB7XG4gICAgICAgICAgICAgIGluc3RhbmNlLnNldFBsYXliYWNrUmF0ZShpbnB1dCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgLy8gVm9sdW1lXG4gICAgICAgICAgbGV0IHsgdm9sdW1lIH0gPSBwbGF5ZXIuY29uZmlnO1xuICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwbGF5ZXIubWVkaWEsICd2b2x1bWUnLCB7XG4gICAgICAgICAgICBnZXQoKSB7XG4gICAgICAgICAgICAgIHJldHVybiB2b2x1bWU7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0KGlucHV0KSB7XG4gICAgICAgICAgICAgIHZvbHVtZSA9IGlucHV0O1xuICAgICAgICAgICAgICBpbnN0YW5jZS5zZXRWb2x1bWUodm9sdW1lICogMTAwKTtcbiAgICAgICAgICAgICAgdHJpZ2dlckV2ZW50LmNhbGwocGxheWVyLCBwbGF5ZXIubWVkaWEsICd2b2x1bWVjaGFuZ2UnKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICAvLyBNdXRlZFxuICAgICAgICAgIGxldCB7IG11dGVkIH0gPSBwbGF5ZXIuY29uZmlnO1xuICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwbGF5ZXIubWVkaWEsICdtdXRlZCcsIHtcbiAgICAgICAgICAgIGdldCgpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIG11dGVkO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldChpbnB1dCkge1xuICAgICAgICAgICAgICBjb25zdCB0b2dnbGUgPSBpcy5ib29sZWFuKGlucHV0KSA/IGlucHV0IDogbXV0ZWQ7XG4gICAgICAgICAgICAgIG11dGVkID0gdG9nZ2xlO1xuICAgICAgICAgICAgICBpbnN0YW5jZVt0b2dnbGUgPyAnbXV0ZScgOiAndW5NdXRlJ10oKTtcbiAgICAgICAgICAgICAgaW5zdGFuY2Uuc2V0Vm9sdW1lKHZvbHVtZSAqIDEwMCk7XG4gICAgICAgICAgICAgIHRyaWdnZXJFdmVudC5jYWxsKHBsYXllciwgcGxheWVyLm1lZGlhLCAndm9sdW1lY2hhbmdlJyk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgLy8gU291cmNlXG4gICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHBsYXllci5tZWRpYSwgJ2N1cnJlbnRTcmMnLCB7XG4gICAgICAgICAgICBnZXQoKSB7XG4gICAgICAgICAgICAgIHJldHVybiBpbnN0YW5jZS5nZXRWaWRlb1VybCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIC8vIEVuZGVkXG4gICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHBsYXllci5tZWRpYSwgJ2VuZGVkJywge1xuICAgICAgICAgICAgZ2V0KCkge1xuICAgICAgICAgICAgICByZXR1cm4gcGxheWVyLmN1cnJlbnRUaW1lID09PSBwbGF5ZXIuZHVyYXRpb247XG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgLy8gR2V0IGF2YWlsYWJsZSBzcGVlZHNcbiAgICAgICAgICBjb25zdCBzcGVlZHMgPSBpbnN0YW5jZS5nZXRBdmFpbGFibGVQbGF5YmFja1JhdGVzKCk7XG4gICAgICAgICAgLy8gRmlsdGVyIGJhc2VkIG9uIGNvbmZpZ1xuICAgICAgICAgIHBsYXllci5vcHRpb25zLnNwZWVkID0gc3BlZWRzLmZpbHRlcigocykgPT4gcGxheWVyLmNvbmZpZy5zcGVlZC5vcHRpb25zLmluY2x1ZGVzKHMpKTtcblxuICAgICAgICAgIC8vIFNldCB0aGUgdGFiaW5kZXggdG8gYXZvaWQgZm9jdXMgZW50ZXJpbmcgaWZyYW1lXG4gICAgICAgICAgaWYgKHBsYXllci5zdXBwb3J0ZWQudWkgJiYgY29uZmlnLmN1c3RvbUNvbnRyb2xzKSB7XG4gICAgICAgICAgICBwbGF5ZXIubWVkaWEuc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsIC0xKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICB0cmlnZ2VyRXZlbnQuY2FsbChwbGF5ZXIsIHBsYXllci5tZWRpYSwgJ3RpbWV1cGRhdGUnKTtcbiAgICAgICAgICB0cmlnZ2VyRXZlbnQuY2FsbChwbGF5ZXIsIHBsYXllci5tZWRpYSwgJ2R1cmF0aW9uY2hhbmdlJyk7XG5cbiAgICAgICAgICAvLyBSZXNldCB0aW1lclxuICAgICAgICAgIGNsZWFySW50ZXJ2YWwocGxheWVyLnRpbWVycy5idWZmZXJpbmcpO1xuXG4gICAgICAgICAgLy8gU2V0dXAgYnVmZmVyaW5nXG4gICAgICAgICAgcGxheWVyLnRpbWVycy5idWZmZXJpbmcgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICAgICAgICAvLyBHZXQgbG9hZGVkICUgZnJvbSBZb3VUdWJlXG4gICAgICAgICAgICBwbGF5ZXIubWVkaWEuYnVmZmVyZWQgPSBpbnN0YW5jZS5nZXRWaWRlb0xvYWRlZEZyYWN0aW9uKCk7XG5cbiAgICAgICAgICAgIC8vIFRyaWdnZXIgcHJvZ3Jlc3Mgb25seSB3aGVuIHdlIGFjdHVhbGx5IGJ1ZmZlciBzb21ldGhpbmdcbiAgICAgICAgICAgIGlmIChwbGF5ZXIubWVkaWEubGFzdEJ1ZmZlcmVkID09PSBudWxsIHx8IHBsYXllci5tZWRpYS5sYXN0QnVmZmVyZWQgPCBwbGF5ZXIubWVkaWEuYnVmZmVyZWQpIHtcbiAgICAgICAgICAgICAgdHJpZ2dlckV2ZW50LmNhbGwocGxheWVyLCBwbGF5ZXIubWVkaWEsICdwcm9ncmVzcycpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBTZXQgbGFzdCBidWZmZXIgcG9pbnRcbiAgICAgICAgICAgIHBsYXllci5tZWRpYS5sYXN0QnVmZmVyZWQgPSBwbGF5ZXIubWVkaWEuYnVmZmVyZWQ7XG5cbiAgICAgICAgICAgIC8vIEJhaWwgaWYgd2UncmUgYXQgMTAwJVxuICAgICAgICAgICAgaWYgKHBsYXllci5tZWRpYS5idWZmZXJlZCA9PT0gMSkge1xuICAgICAgICAgICAgICBjbGVhckludGVydmFsKHBsYXllci50aW1lcnMuYnVmZmVyaW5nKTtcblxuICAgICAgICAgICAgICAvLyBUcmlnZ2VyIGV2ZW50XG4gICAgICAgICAgICAgIHRyaWdnZXJFdmVudC5jYWxsKHBsYXllciwgcGxheWVyLm1lZGlhLCAnY2FucGxheXRocm91Z2gnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LCAyMDApO1xuXG4gICAgICAgICAgLy8gUmVidWlsZCBVSVxuICAgICAgICAgIGlmIChjb25maWcuY3VzdG9tQ29udHJvbHMpIHtcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gdWkuYnVpbGQuY2FsbChwbGF5ZXIpLCA1MCk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBvblN0YXRlQ2hhbmdlKGV2ZW50KSB7XG4gICAgICAgICAgLy8gR2V0IHRoZSBpbnN0YW5jZVxuICAgICAgICAgIGNvbnN0IGluc3RhbmNlID0gZXZlbnQudGFyZ2V0O1xuXG4gICAgICAgICAgLy8gUmVzZXQgdGltZXJcbiAgICAgICAgICBjbGVhckludGVydmFsKHBsYXllci50aW1lcnMucGxheWluZyk7XG5cbiAgICAgICAgICBjb25zdCBzZWVrZWQgPSBwbGF5ZXIubWVkaWEuc2Vla2luZyAmJiBbMSwgMl0uaW5jbHVkZXMoZXZlbnQuZGF0YSk7XG5cbiAgICAgICAgICBpZiAoc2Vla2VkKSB7XG4gICAgICAgICAgICAvLyBVbnNldCBzZWVraW5nIGFuZCBmaXJlIHNlZWtlZCBldmVudFxuICAgICAgICAgICAgcGxheWVyLm1lZGlhLnNlZWtpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIHRyaWdnZXJFdmVudC5jYWxsKHBsYXllciwgcGxheWVyLm1lZGlhLCAnc2Vla2VkJyk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gSGFuZGxlIGV2ZW50c1xuICAgICAgICAgIC8vIC0xICAgVW5zdGFydGVkXG4gICAgICAgICAgLy8gMCAgICBFbmRlZFxuICAgICAgICAgIC8vIDEgICAgUGxheWluZ1xuICAgICAgICAgIC8vIDIgICAgUGF1c2VkXG4gICAgICAgICAgLy8gMyAgICBCdWZmZXJpbmdcbiAgICAgICAgICAvLyA1ICAgIFZpZGVvIGN1ZWRcbiAgICAgICAgICBzd2l0Y2ggKGV2ZW50LmRhdGEpIHtcbiAgICAgICAgICAgIGNhc2UgLTE6XG4gICAgICAgICAgICAgIC8vIFVwZGF0ZSBzY3J1YmJlclxuICAgICAgICAgICAgICB0cmlnZ2VyRXZlbnQuY2FsbChwbGF5ZXIsIHBsYXllci5tZWRpYSwgJ3RpbWV1cGRhdGUnKTtcblxuICAgICAgICAgICAgICAvLyBHZXQgbG9hZGVkICUgZnJvbSBZb3VUdWJlXG4gICAgICAgICAgICAgIHBsYXllci5tZWRpYS5idWZmZXJlZCA9IGluc3RhbmNlLmdldFZpZGVvTG9hZGVkRnJhY3Rpb24oKTtcbiAgICAgICAgICAgICAgdHJpZ2dlckV2ZW50LmNhbGwocGxheWVyLCBwbGF5ZXIubWVkaWEsICdwcm9ncmVzcycpO1xuXG4gICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgIGFzc3VyZVBsYXliYWNrU3RhdGUuY2FsbChwbGF5ZXIsIGZhbHNlKTtcblxuICAgICAgICAgICAgICAvLyBZb3VUdWJlIGRvZXNuJ3Qgc3VwcG9ydCBsb29wIGZvciBhIHNpbmdsZSB2aWRlbywgc28gbWltaWNrIGl0LlxuICAgICAgICAgICAgICBpZiAocGxheWVyLm1lZGlhLmxvb3ApIHtcbiAgICAgICAgICAgICAgICAvLyBZb3VUdWJlIG5lZWRzIGEgY2FsbCB0byBgc3RvcFZpZGVvYCBiZWZvcmUgcGxheWluZyBhZ2FpblxuICAgICAgICAgICAgICAgIGluc3RhbmNlLnN0b3BWaWRlbygpO1xuICAgICAgICAgICAgICAgIGluc3RhbmNlLnBsYXlWaWRlbygpO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRyaWdnZXJFdmVudC5jYWxsKHBsYXllciwgcGxheWVyLm1lZGlhLCAnZW5kZWQnKTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgIC8vIFJlc3RvcmUgcGF1c2VkIHN0YXRlIChZb3VUdWJlIHN0YXJ0cyBwbGF5aW5nIG9uIHNlZWsgaWYgdGhlIHZpZGVvIGhhc24ndCBiZWVuIHBsYXllZCB5ZXQpXG4gICAgICAgICAgICAgIGlmIChjb25maWcuY3VzdG9tQ29udHJvbHMgJiYgIXBsYXllci5jb25maWcuYXV0b3BsYXkgJiYgcGxheWVyLm1lZGlhLnBhdXNlZCAmJiAhcGxheWVyLmVtYmVkLmhhc1BsYXllZCkge1xuICAgICAgICAgICAgICAgIHBsYXllci5tZWRpYS5wYXVzZSgpO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGFzc3VyZVBsYXliYWNrU3RhdGUuY2FsbChwbGF5ZXIsIHRydWUpO1xuXG4gICAgICAgICAgICAgICAgdHJpZ2dlckV2ZW50LmNhbGwocGxheWVyLCBwbGF5ZXIubWVkaWEsICdwbGF5aW5nJyk7XG5cbiAgICAgICAgICAgICAgICAvLyBQb2xsIHRvIGdldCBwbGF5YmFjayBwcm9ncmVzc1xuICAgICAgICAgICAgICAgIHBsYXllci50aW1lcnMucGxheWluZyA9IHNldEludGVydmFsKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgIHRyaWdnZXJFdmVudC5jYWxsKHBsYXllciwgcGxheWVyLm1lZGlhLCAndGltZXVwZGF0ZScpO1xuICAgICAgICAgICAgICAgIH0sIDUwKTtcblxuICAgICAgICAgICAgICAgIC8vIENoZWNrIGR1cmF0aW9uIGFnYWluIGR1ZSB0byBZb3VUdWJlIGJ1Z1xuICAgICAgICAgICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9zYW1wb3R0cy9wbHlyL2lzc3Vlcy8zNzRcbiAgICAgICAgICAgICAgICAvLyBodHRwczovL2NvZGUuZ29vZ2xlLmNvbS9wL2dkYXRhLWlzc3Vlcy9pc3N1ZXMvZGV0YWlsP2lkPTg2OTBcbiAgICAgICAgICAgICAgICBpZiAocGxheWVyLm1lZGlhLmR1cmF0aW9uICE9PSBpbnN0YW5jZS5nZXREdXJhdGlvbigpKSB7XG4gICAgICAgICAgICAgICAgICBwbGF5ZXIubWVkaWEuZHVyYXRpb24gPSBpbnN0YW5jZS5nZXREdXJhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgdHJpZ2dlckV2ZW50LmNhbGwocGxheWVyLCBwbGF5ZXIubWVkaWEsICdkdXJhdGlvbmNoYW5nZScpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgIC8vIFJlc3RvcmUgYXVkaW8gKFlvdVR1YmUgc3RhcnRzIHBsYXlpbmcgb24gc2VlayBpZiB0aGUgdmlkZW8gaGFzbid0IGJlZW4gcGxheWVkIHlldClcbiAgICAgICAgICAgICAgaWYgKCFwbGF5ZXIubXV0ZWQpIHtcbiAgICAgICAgICAgICAgICBwbGF5ZXIuZW1iZWQudW5NdXRlKCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgYXNzdXJlUGxheWJhY2tTdGF0ZS5jYWxsKHBsYXllciwgZmFsc2UpO1xuXG4gICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgIC8vIFRyaWdnZXIgd2FpdGluZyBldmVudCB0byBhZGQgbG9hZGluZyBjbGFzc2VzIHRvIGNvbnRhaW5lciBhcyB0aGUgdmlkZW8gYnVmZmVycy5cbiAgICAgICAgICAgICAgdHJpZ2dlckV2ZW50LmNhbGwocGxheWVyLCBwbGF5ZXIubWVkaWEsICd3YWl0aW5nJyk7XG5cbiAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHRyaWdnZXJFdmVudC5jYWxsKHBsYXllciwgcGxheWVyLmVsZW1lbnRzLmNvbnRhaW5lciwgJ3N0YXRlY2hhbmdlJywgZmFsc2UsIHtcbiAgICAgICAgICAgIGNvZGU6IGV2ZW50LmRhdGEsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuICB9LFxufTtcblxuZXhwb3J0IGRlZmF1bHQgeW91dHViZTtcbiIsIi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBQbHlyIE1lZGlhXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5pbXBvcnQgaHRtbDUgZnJvbSAnLi9odG1sNSc7XG5pbXBvcnQgdmltZW8gZnJvbSAnLi9wbHVnaW5zL3ZpbWVvJztcbmltcG9ydCB5b3V0dWJlIGZyb20gJy4vcGx1Z2lucy95b3V0dWJlJztcbmltcG9ydCB7IGNyZWF0ZUVsZW1lbnQsIHRvZ2dsZUNsYXNzLCB3cmFwIH0gZnJvbSAnLi91dGlscy9lbGVtZW50cyc7XG5cbmNvbnN0IG1lZGlhID0ge1xuICAvLyBTZXR1cCBtZWRpYVxuICBzZXR1cCgpIHtcbiAgICAvLyBJZiB0aGVyZSdzIG5vIG1lZGlhLCBiYWlsXG4gICAgaWYgKCF0aGlzLm1lZGlhKSB7XG4gICAgICB0aGlzLmRlYnVnLndhcm4oJ05vIG1lZGlhIGVsZW1lbnQgZm91bmQhJyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gQWRkIHR5cGUgY2xhc3NcbiAgICB0b2dnbGVDbGFzcyh0aGlzLmVsZW1lbnRzLmNvbnRhaW5lciwgdGhpcy5jb25maWcuY2xhc3NOYW1lcy50eXBlLnJlcGxhY2UoJ3swfScsIHRoaXMudHlwZSksIHRydWUpO1xuXG4gICAgLy8gQWRkIHByb3ZpZGVyIGNsYXNzXG4gICAgdG9nZ2xlQ2xhc3ModGhpcy5lbGVtZW50cy5jb250YWluZXIsIHRoaXMuY29uZmlnLmNsYXNzTmFtZXMucHJvdmlkZXIucmVwbGFjZSgnezB9JywgdGhpcy5wcm92aWRlciksIHRydWUpO1xuXG4gICAgLy8gQWRkIHZpZGVvIGNsYXNzIGZvciBlbWJlZHNcbiAgICAvLyBUaGlzIHdpbGwgcmVxdWlyZSBjaGFuZ2VzIGlmIGF1ZGlvIGVtYmVkcyBhcmUgYWRkZWRcbiAgICBpZiAodGhpcy5pc0VtYmVkKSB7XG4gICAgICB0b2dnbGVDbGFzcyh0aGlzLmVsZW1lbnRzLmNvbnRhaW5lciwgdGhpcy5jb25maWcuY2xhc3NOYW1lcy50eXBlLnJlcGxhY2UoJ3swfScsICd2aWRlbycpLCB0cnVlKTtcbiAgICB9XG5cbiAgICAvLyBJbmplY3QgdGhlIHBsYXllciB3cmFwcGVyXG4gICAgaWYgKHRoaXMuaXNWaWRlbykge1xuICAgICAgLy8gQ3JlYXRlIHRoZSB3cmFwcGVyIGRpdlxuICAgICAgdGhpcy5lbGVtZW50cy53cmFwcGVyID0gY3JlYXRlRWxlbWVudCgnZGl2Jywge1xuICAgICAgICBjbGFzczogdGhpcy5jb25maWcuY2xhc3NOYW1lcy52aWRlbyxcbiAgICAgIH0pO1xuXG4gICAgICAvLyBXcmFwIHRoZSB2aWRlbyBpbiBhIGNvbnRhaW5lclxuICAgICAgd3JhcCh0aGlzLm1lZGlhLCB0aGlzLmVsZW1lbnRzLndyYXBwZXIpO1xuXG4gICAgICAvLyBQb3N0ZXIgaW1hZ2UgY29udGFpbmVyXG4gICAgICB0aGlzLmVsZW1lbnRzLnBvc3RlciA9IGNyZWF0ZUVsZW1lbnQoJ2RpdicsIHtcbiAgICAgICAgY2xhc3M6IHRoaXMuY29uZmlnLmNsYXNzTmFtZXMucG9zdGVyLFxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuZWxlbWVudHMud3JhcHBlci5hcHBlbmRDaGlsZCh0aGlzLmVsZW1lbnRzLnBvc3Rlcik7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuaXNIVE1MNSkge1xuICAgICAgaHRtbDUuc2V0dXAuY2FsbCh0aGlzKTtcbiAgICB9IGVsc2UgaWYgKHRoaXMuaXNZb3VUdWJlKSB7XG4gICAgICB5b3V0dWJlLnNldHVwLmNhbGwodGhpcyk7XG4gICAgfSBlbHNlIGlmICh0aGlzLmlzVmltZW8pIHtcbiAgICAgIHZpbWVvLnNldHVwLmNhbGwodGhpcyk7XG4gICAgfVxuICB9LFxufTtcblxuZXhwb3J0IGRlZmF1bHQgbWVkaWE7XG4iLCIvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gQWR2ZXJ0aXNlbWVudCBwbHVnaW4gdXNpbmcgR29vZ2xlIElNQSBIVE1MNSBTREtcbi8vIENyZWF0ZSBhbiBhY2NvdW50IHdpdGggb3VyIGFkIHBhcnRuZXIsIHZpIGhlcmU6XG4vLyBodHRwczovL3d3dy52aS5haS9wdWJsaXNoZXItdmlkZW8tbW9uZXRpemF0aW9uL1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLyogZ2xvYmFsIGdvb2dsZSAqL1xuXG5pbXBvcnQgeyBjcmVhdGVFbGVtZW50IH0gZnJvbSAnLi4vdXRpbHMvZWxlbWVudHMnO1xuaW1wb3J0IHsgdHJpZ2dlckV2ZW50IH0gZnJvbSAnLi4vdXRpbHMvZXZlbnRzJztcbmltcG9ydCBpMThuIGZyb20gJy4uL3V0aWxzL2kxOG4nO1xuaW1wb3J0IGlzIGZyb20gJy4uL3V0aWxzL2lzJztcbmltcG9ydCBsb2FkU2NyaXB0IGZyb20gJy4uL3V0aWxzL2xvYWQtc2NyaXB0JztcbmltcG9ydCB7IHNpbGVuY2VQcm9taXNlIH0gZnJvbSAnLi4vdXRpbHMvcHJvbWlzZSc7XG5pbXBvcnQgeyBmb3JtYXRUaW1lIH0gZnJvbSAnLi4vdXRpbHMvdGltZSc7XG5pbXBvcnQgeyBidWlsZFVybFBhcmFtcyB9IGZyb20gJy4uL3V0aWxzL3VybHMnO1xuXG5jb25zdCBkZXN0cm95ID0gKGluc3RhbmNlKSA9PiB7XG4gIC8vIERlc3Ryb3kgb3VyIGFkc01hbmFnZXJcbiAgaWYgKGluc3RhbmNlLm1hbmFnZXIpIHtcbiAgICBpbnN0YW5jZS5tYW5hZ2VyLmRlc3Ryb3koKTtcbiAgfVxuXG4gIC8vIERlc3Ryb3kgb3VyIGFkc01hbmFnZXJcbiAgaWYgKGluc3RhbmNlLmVsZW1lbnRzLmRpc3BsYXlDb250YWluZXIpIHtcbiAgICBpbnN0YW5jZS5lbGVtZW50cy5kaXNwbGF5Q29udGFpbmVyLmRlc3Ryb3koKTtcbiAgfVxuXG4gIGluc3RhbmNlLmVsZW1lbnRzLmNvbnRhaW5lci5yZW1vdmUoKTtcbn07XG5cbmNsYXNzIEFkcyB7XG4gIC8qKlxuICAgKiBBZHMgY29uc3RydWN0b3IuXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBwbGF5ZXJcbiAgICogQHJldHVybiB7QWRzfVxuICAgKi9cbiAgY29uc3RydWN0b3IocGxheWVyKSB7XG4gICAgdGhpcy5wbGF5ZXIgPSBwbGF5ZXI7XG4gICAgdGhpcy5jb25maWcgPSBwbGF5ZXIuY29uZmlnLmFkcztcbiAgICB0aGlzLnBsYXlpbmcgPSBmYWxzZTtcbiAgICB0aGlzLmluaXRpYWxpemVkID0gZmFsc2U7XG4gICAgdGhpcy5lbGVtZW50cyA9IHtcbiAgICAgIGNvbnRhaW5lcjogbnVsbCxcbiAgICAgIGRpc3BsYXlDb250YWluZXI6IG51bGwsXG4gICAgfTtcbiAgICB0aGlzLm1hbmFnZXIgPSBudWxsO1xuICAgIHRoaXMubG9hZGVyID0gbnVsbDtcbiAgICB0aGlzLmN1ZVBvaW50cyA9IG51bGw7XG4gICAgdGhpcy5ldmVudHMgPSB7fTtcbiAgICB0aGlzLnNhZmV0eVRpbWVyID0gbnVsbDtcbiAgICB0aGlzLmNvdW50ZG93blRpbWVyID0gbnVsbDtcblxuICAgIC8vIFNldHVwIGEgcHJvbWlzZSB0byByZXNvbHZlIHdoZW4gdGhlIElNQSBtYW5hZ2VyIGlzIHJlYWR5XG4gICAgdGhpcy5tYW5hZ2VyUHJvbWlzZSA9IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIC8vIFRoZSBhZCBpcyBsb2FkZWQgYW5kIHJlYWR5XG4gICAgICB0aGlzLm9uKCdsb2FkZWQnLCByZXNvbHZlKTtcblxuICAgICAgLy8gQWRzIGZhaWxlZFxuICAgICAgdGhpcy5vbignZXJyb3InLCByZWplY3QpO1xuICAgIH0pO1xuXG4gICAgdGhpcy5sb2FkKCk7XG4gIH1cblxuICBnZXQgZW5hYmxlZCgpIHtcbiAgICBjb25zdCB7IGNvbmZpZyB9ID0gdGhpcztcblxuICAgIHJldHVybiAoXG4gICAgICB0aGlzLnBsYXllci5pc0hUTUw1ICYmXG4gICAgICB0aGlzLnBsYXllci5pc1ZpZGVvICYmXG4gICAgICBjb25maWcuZW5hYmxlZCAmJlxuICAgICAgKCFpcy5lbXB0eShjb25maWcucHVibGlzaGVySWQpIHx8IGlzLnVybChjb25maWcudGFnVXJsKSlcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIExvYWQgdGhlIElNQSBTREtcbiAgICovXG4gIGxvYWQgPSAoKSA9PiB7XG4gICAgaWYgKCF0aGlzLmVuYWJsZWQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBDaGVjayBpZiB0aGUgR29vZ2xlIElNQTMgU0RLIGlzIGxvYWRlZCBvciBsb2FkIGl0IG91cnNlbHZlc1xuICAgIGlmICghaXMub2JqZWN0KHdpbmRvdy5nb29nbGUpIHx8ICFpcy5vYmplY3Qod2luZG93Lmdvb2dsZS5pbWEpKSB7XG4gICAgICBsb2FkU2NyaXB0KHRoaXMucGxheWVyLmNvbmZpZy51cmxzLmdvb2dsZUlNQS5zZGspXG4gICAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgICB0aGlzLnJlYWR5KCk7XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaCgoKSA9PiB7XG4gICAgICAgICAgLy8gU2NyaXB0IGZhaWxlZCB0byBsb2FkIG9yIGlzIGJsb2NrZWRcbiAgICAgICAgICB0aGlzLnRyaWdnZXIoJ2Vycm9yJywgbmV3IEVycm9yKCdHb29nbGUgSU1BIFNESyBmYWlsZWQgdG8gbG9hZCcpKTtcbiAgICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMucmVhZHkoKTtcbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgYWRzIGluc3RhbmNlIHJlYWR5XG4gICAqL1xuICByZWFkeSA9ICgpID0+IHtcbiAgICAvLyBEb3VibGUgY2hlY2sgd2UncmUgZW5hYmxlZFxuICAgIGlmICghdGhpcy5lbmFibGVkKSB7XG4gICAgICBkZXN0cm95KHRoaXMpO1xuICAgIH1cblxuICAgIC8vIFN0YXJ0IHRpY2tpbmcgb3VyIHNhZmV0eSB0aW1lci4gSWYgdGhlIHdob2xlIGFkdmVydGlzZW1lbnRcbiAgICAvLyB0aGluZyBkb2Vzbid0IHJlc29sdmUgd2l0aGluIG91ciBzZXQgdGltZTsgd2UgYmFpbFxuICAgIHRoaXMuc3RhcnRTYWZldHlUaW1lcigxMjAwMCwgJ3JlYWR5KCknKTtcblxuICAgIC8vIENsZWFyIHRoZSBzYWZldHkgdGltZXJcbiAgICB0aGlzLm1hbmFnZXJQcm9taXNlLnRoZW4oKCkgPT4ge1xuICAgICAgdGhpcy5jbGVhclNhZmV0eVRpbWVyKCdvbkFkc01hbmFnZXJMb2FkZWQoKScpO1xuICAgIH0pO1xuXG4gICAgLy8gU2V0IGxpc3RlbmVycyBvbiB0aGUgUGx5ciBpbnN0YW5jZVxuICAgIHRoaXMubGlzdGVuZXJzKCk7XG5cbiAgICAvLyBTZXR1cCB0aGUgSU1BIFNES1xuICAgIHRoaXMuc2V0dXBJTUEoKTtcbiAgfTtcblxuICAvLyBCdWlsZCB0aGUgdGFnIFVSTFxuICBnZXQgdGFnVXJsKCkge1xuICAgIGNvbnN0IHsgY29uZmlnIH0gPSB0aGlzO1xuXG4gICAgaWYgKGlzLnVybChjb25maWcudGFnVXJsKSkge1xuICAgICAgcmV0dXJuIGNvbmZpZy50YWdVcmw7XG4gICAgfVxuXG4gICAgY29uc3QgcGFyYW1zID0ge1xuICAgICAgQVZfUFVCTElTSEVSSUQ6ICc1OGMyNWJiMDA3M2VmNDQ4YjEwODdhZDYnLFxuICAgICAgQVZfQ0hBTk5FTElEOiAnNWEwNDU4ZGMyOGEwNjE0NWU0NTE5ZDIxJyxcbiAgICAgIEFWX1VSTDogd2luZG93LmxvY2F0aW9uLmhvc3RuYW1lLFxuICAgICAgY2I6IERhdGUubm93KCksXG4gICAgICBBVl9XSURUSDogNjQwLFxuICAgICAgQVZfSEVJR0hUOiA0ODAsXG4gICAgICBBVl9DRElNMjogY29uZmlnLnB1Ymxpc2hlcklkLFxuICAgIH07XG5cbiAgICBjb25zdCBiYXNlID0gJ2h0dHBzOi8vZ28uYW5pdmlldy5jb20vYXBpL2Fkc2VydmVyNi92YXN0Lyc7XG5cbiAgICByZXR1cm4gYCR7YmFzZX0/JHtidWlsZFVybFBhcmFtcyhwYXJhbXMpfWA7XG4gIH1cblxuICAvKipcbiAgICogSW4gb3JkZXIgZm9yIHRoZSBTREsgdG8gZGlzcGxheSBhZHMgZm9yIG91ciB2aWRlbywgd2UgbmVlZCB0byB0ZWxsIGl0IHdoZXJlIHRvIHB1dCB0aGVtLFxuICAgKiBzbyBoZXJlIHdlIGRlZmluZSBvdXIgYWQgY29udGFpbmVyLiBUaGlzIGRpdiBpcyBzZXQgdXAgdG8gcmVuZGVyIG9uIHRvcCBvZiB0aGUgdmlkZW8gcGxheWVyLlxuICAgKiBVc2luZyB0aGUgY29kZSBiZWxvdywgd2UgdGVsbCB0aGUgU0RLIHRvIHJlbmRlciBhZHMgd2l0aGluIHRoYXQgZGl2LiBXZSBhbHNvIHByb3ZpZGUgYVxuICAgKiBoYW5kbGUgdG8gdGhlIGNvbnRlbnQgdmlkZW8gcGxheWVyIC0gdGhlIFNESyB3aWxsIHBvbGwgdGhlIGN1cnJlbnQgdGltZSBvZiBvdXIgcGxheWVyIHRvXG4gICAqIHByb3Blcmx5IHBsYWNlIG1pZC1yb2xscy4gQWZ0ZXIgd2UgY3JlYXRlIHRoZSBhZCBkaXNwbGF5IGNvbnRhaW5lciwgd2UgaW5pdGlhbGl6ZSBpdC4gT25cbiAgICogbW9iaWxlIGRldmljZXMsIHRoaXMgaW5pdGlhbGl6YXRpb24gaXMgZG9uZSBhcyB0aGUgcmVzdWx0IG9mIGEgdXNlciBhY3Rpb24uXG4gICAqL1xuICBzZXR1cElNQSA9ICgpID0+IHtcbiAgICAvLyBDcmVhdGUgdGhlIGNvbnRhaW5lciBmb3Igb3VyIGFkdmVydGlzZW1lbnRzXG4gICAgdGhpcy5lbGVtZW50cy5jb250YWluZXIgPSBjcmVhdGVFbGVtZW50KCdkaXYnLCB7XG4gICAgICBjbGFzczogdGhpcy5wbGF5ZXIuY29uZmlnLmNsYXNzTmFtZXMuYWRzLFxuICAgIH0pO1xuXG4gICAgdGhpcy5wbGF5ZXIuZWxlbWVudHMuY29udGFpbmVyLmFwcGVuZENoaWxkKHRoaXMuZWxlbWVudHMuY29udGFpbmVyKTtcblxuICAgIC8vIFNvIHdlIGNhbiBydW4gVlBBSUQyXG4gICAgZ29vZ2xlLmltYS5zZXR0aW5ncy5zZXRWcGFpZE1vZGUoZ29vZ2xlLmltYS5JbWFTZGtTZXR0aW5ncy5WcGFpZE1vZGUuRU5BQkxFRCk7XG5cbiAgICAvLyBTZXQgbGFuZ3VhZ2VcbiAgICBnb29nbGUuaW1hLnNldHRpbmdzLnNldExvY2FsZSh0aGlzLnBsYXllci5jb25maWcuYWRzLmxhbmd1YWdlKTtcblxuICAgIC8vIFNldCBwbGF5YmFjayBmb3IgaU9TMTArXG4gICAgZ29vZ2xlLmltYS5zZXR0aW5ncy5zZXREaXNhYmxlQ3VzdG9tUGxheWJhY2tGb3JJT1MxMFBsdXModGhpcy5wbGF5ZXIuY29uZmlnLnBsYXlzaW5saW5lKTtcblxuICAgIC8vIFdlIGFzc3VtZSB0aGUgYWRDb250YWluZXIgaXMgdGhlIHZpZGVvIGNvbnRhaW5lciBvZiB0aGUgcGx5ciBlbGVtZW50IHRoYXQgd2lsbCBob3VzZSB0aGUgYWRzXG4gICAgdGhpcy5lbGVtZW50cy5kaXNwbGF5Q29udGFpbmVyID0gbmV3IGdvb2dsZS5pbWEuQWREaXNwbGF5Q29udGFpbmVyKHRoaXMuZWxlbWVudHMuY29udGFpbmVyLCB0aGlzLnBsYXllci5tZWRpYSk7XG5cbiAgICAvLyBDcmVhdGUgYWRzIGxvYWRlclxuICAgIHRoaXMubG9hZGVyID0gbmV3IGdvb2dsZS5pbWEuQWRzTG9hZGVyKHRoaXMuZWxlbWVudHMuZGlzcGxheUNvbnRhaW5lcik7XG5cbiAgICAvLyBMaXN0ZW4gYW5kIHJlc3BvbmQgdG8gYWRzIGxvYWRlZCBhbmQgZXJyb3IgZXZlbnRzXG4gICAgdGhpcy5sb2FkZXIuYWRkRXZlbnRMaXN0ZW5lcihcbiAgICAgIGdvb2dsZS5pbWEuQWRzTWFuYWdlckxvYWRlZEV2ZW50LlR5cGUuQURTX01BTkFHRVJfTE9BREVELFxuICAgICAgKGV2ZW50KSA9PiB0aGlzLm9uQWRzTWFuYWdlckxvYWRlZChldmVudCksXG4gICAgICBmYWxzZSxcbiAgICApO1xuICAgIHRoaXMubG9hZGVyLmFkZEV2ZW50TGlzdGVuZXIoZ29vZ2xlLmltYS5BZEVycm9yRXZlbnQuVHlwZS5BRF9FUlJPUiwgKGVycm9yKSA9PiB0aGlzLm9uQWRFcnJvcihlcnJvciksIGZhbHNlKTtcblxuICAgIC8vIFJlcXVlc3QgdmlkZW8gYWRzIHRvIGJlIHByZS1sb2FkZWRcbiAgICB0aGlzLnJlcXVlc3RBZHMoKTtcbiAgfTtcblxuICAvKipcbiAgICogUmVxdWVzdCBhZHZlcnRpc2VtZW50c1xuICAgKi9cbiAgcmVxdWVzdEFkcyA9ICgpID0+IHtcbiAgICBjb25zdCB7IGNvbnRhaW5lciB9ID0gdGhpcy5wbGF5ZXIuZWxlbWVudHM7XG5cbiAgICB0cnkge1xuICAgICAgLy8gUmVxdWVzdCB2aWRlbyBhZHNcbiAgICAgIGNvbnN0IHJlcXVlc3QgPSBuZXcgZ29vZ2xlLmltYS5BZHNSZXF1ZXN0KCk7XG4gICAgICByZXF1ZXN0LmFkVGFnVXJsID0gdGhpcy50YWdVcmw7XG5cbiAgICAgIC8vIFNwZWNpZnkgdGhlIGxpbmVhciBhbmQgbm9ubGluZWFyIHNsb3Qgc2l6ZXMuIFRoaXMgaGVscHMgdGhlIFNES1xuICAgICAgLy8gdG8gc2VsZWN0IHRoZSBjb3JyZWN0IGNyZWF0aXZlIGlmIG11bHRpcGxlIGFyZSByZXR1cm5lZFxuICAgICAgcmVxdWVzdC5saW5lYXJBZFNsb3RXaWR0aCA9IGNvbnRhaW5lci5vZmZzZXRXaWR0aDtcbiAgICAgIHJlcXVlc3QubGluZWFyQWRTbG90SGVpZ2h0ID0gY29udGFpbmVyLm9mZnNldEhlaWdodDtcbiAgICAgIHJlcXVlc3Qubm9uTGluZWFyQWRTbG90V2lkdGggPSBjb250YWluZXIub2Zmc2V0V2lkdGg7XG4gICAgICByZXF1ZXN0Lm5vbkxpbmVhckFkU2xvdEhlaWdodCA9IGNvbnRhaW5lci5vZmZzZXRIZWlnaHQ7XG5cbiAgICAgIC8vIFdlIG9ubHkgb3ZlcmxheSBhZHMgYXMgd2Ugb25seSBzdXBwb3J0IHZpZGVvLlxuICAgICAgcmVxdWVzdC5mb3JjZU5vbkxpbmVhckZ1bGxTbG90ID0gZmFsc2U7XG5cbiAgICAgIC8vIE11dGUgYmFzZWQgb24gY3VycmVudCBzdGF0ZVxuICAgICAgcmVxdWVzdC5zZXRBZFdpbGxQbGF5TXV0ZWQoIXRoaXMucGxheWVyLm11dGVkKTtcblxuICAgICAgdGhpcy5sb2FkZXIucmVxdWVzdEFkcyhyZXF1ZXN0KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5vbkFkRXJyb3IoZXJyb3IpO1xuICAgIH1cbiAgfTtcblxuICAvKipcbiAgICogVXBkYXRlIHRoZSBhZCBjb3VudGRvd25cbiAgICogQHBhcmFtIHtCb29sZWFufSBzdGFydFxuICAgKi9cbiAgcG9sbENvdW50ZG93biA9IChzdGFydCA9IGZhbHNlKSA9PiB7XG4gICAgaWYgKCFzdGFydCkge1xuICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLmNvdW50ZG93blRpbWVyKTtcbiAgICAgIHRoaXMuZWxlbWVudHMuY29udGFpbmVyLnJlbW92ZUF0dHJpYnV0ZSgnZGF0YS1iYWRnZS10ZXh0Jyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgdXBkYXRlID0gKCkgPT4ge1xuICAgICAgY29uc3QgdGltZSA9IGZvcm1hdFRpbWUoTWF0aC5tYXgodGhpcy5tYW5hZ2VyLmdldFJlbWFpbmluZ1RpbWUoKSwgMCkpO1xuICAgICAgY29uc3QgbGFiZWwgPSBgJHtpMThuLmdldCgnYWR2ZXJ0aXNlbWVudCcsIHRoaXMucGxheWVyLmNvbmZpZyl9IC0gJHt0aW1lfWA7XG4gICAgICB0aGlzLmVsZW1lbnRzLmNvbnRhaW5lci5zZXRBdHRyaWJ1dGUoJ2RhdGEtYmFkZ2UtdGV4dCcsIGxhYmVsKTtcbiAgICB9O1xuXG4gICAgdGhpcy5jb3VudGRvd25UaW1lciA9IHNldEludGVydmFsKHVwZGF0ZSwgMTAwKTtcbiAgfTtcblxuICAvKipcbiAgICogVGhpcyBtZXRob2QgaXMgY2FsbGVkIHdoZW5ldmVyIHRoZSBhZHMgYXJlIHJlYWR5IGluc2lkZSB0aGUgQWREaXNwbGF5Q29udGFpbmVyXG4gICAqIEBwYXJhbSB7RXZlbnR9IGV2ZW50IC0gYWRzTWFuYWdlckxvYWRlZEV2ZW50XG4gICAqL1xuICBvbkFkc01hbmFnZXJMb2FkZWQgPSAoZXZlbnQpID0+IHtcbiAgICAvLyBMb2FkIGNvdWxkIG9jY3VyIGFmdGVyIGEgc291cmNlIGNoYW5nZSAocmFjZSBjb25kaXRpb24pXG4gICAgaWYgKCF0aGlzLmVuYWJsZWQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBHZXQgdGhlIGFkcyBtYW5hZ2VyXG4gICAgY29uc3Qgc2V0dGluZ3MgPSBuZXcgZ29vZ2xlLmltYS5BZHNSZW5kZXJpbmdTZXR0aW5ncygpO1xuXG4gICAgLy8gVGVsbCB0aGUgU0RLIHRvIHNhdmUgYW5kIHJlc3RvcmUgY29udGVudCB2aWRlbyBzdGF0ZSBvbiBvdXIgYmVoYWxmXG4gICAgc2V0dGluZ3MucmVzdG9yZUN1c3RvbVBsYXliYWNrU3RhdGVPbkFkQnJlYWtDb21wbGV0ZSA9IHRydWU7XG4gICAgc2V0dGluZ3MuZW5hYmxlUHJlbG9hZGluZyA9IHRydWU7XG5cbiAgICAvLyBUaGUgU0RLIGlzIHBvbGxpbmcgY3VycmVudFRpbWUgb24gdGhlIGNvbnRlbnRQbGF5YmFjay4gQW5kIG5lZWRzIGEgZHVyYXRpb25cbiAgICAvLyBzbyBpdCBjYW4gZGV0ZXJtaW5lIHdoZW4gdG8gc3RhcnQgdGhlIG1pZC0gYW5kIHBvc3Qtcm9sbFxuICAgIHRoaXMubWFuYWdlciA9IGV2ZW50LmdldEFkc01hbmFnZXIodGhpcy5wbGF5ZXIsIHNldHRpbmdzKTtcblxuICAgIC8vIEdldCB0aGUgY3VlIHBvaW50cyBmb3IgYW55IG1pZC1yb2xscyBieSBmaWx0ZXJpbmcgb3V0IHRoZSBwcmUtIGFuZCBwb3N0LXJvbGxcbiAgICB0aGlzLmN1ZVBvaW50cyA9IHRoaXMubWFuYWdlci5nZXRDdWVQb2ludHMoKTtcblxuICAgIC8vIEFkZCBsaXN0ZW5lcnMgdG8gdGhlIHJlcXVpcmVkIGV2ZW50c1xuICAgIC8vIEFkdmVydGlzZW1lbnQgZXJyb3IgZXZlbnRzXG4gICAgdGhpcy5tYW5hZ2VyLmFkZEV2ZW50TGlzdGVuZXIoZ29vZ2xlLmltYS5BZEVycm9yRXZlbnQuVHlwZS5BRF9FUlJPUiwgKGVycm9yKSA9PiB0aGlzLm9uQWRFcnJvcihlcnJvcikpO1xuXG4gICAgLy8gQWR2ZXJ0aXNlbWVudCByZWd1bGFyIGV2ZW50c1xuICAgIE9iamVjdC5rZXlzKGdvb2dsZS5pbWEuQWRFdmVudC5UeXBlKS5mb3JFYWNoKCh0eXBlKSA9PiB7XG4gICAgICB0aGlzLm1hbmFnZXIuYWRkRXZlbnRMaXN0ZW5lcihnb29nbGUuaW1hLkFkRXZlbnQuVHlwZVt0eXBlXSwgKGUpID0+IHRoaXMub25BZEV2ZW50KGUpKTtcbiAgICB9KTtcblxuICAgIC8vIFJlc29sdmUgb3VyIGFkc01hbmFnZXJcbiAgICB0aGlzLnRyaWdnZXIoJ2xvYWRlZCcpO1xuICB9O1xuXG4gIGFkZEN1ZVBvaW50cyA9ICgpID0+IHtcbiAgICAvLyBBZGQgYWR2ZXJ0aXNlbWVudCBjdWUncyB3aXRoaW4gdGhlIHRpbWUgbGluZSBpZiBhdmFpbGFibGVcbiAgICBpZiAoIWlzLmVtcHR5KHRoaXMuY3VlUG9pbnRzKSkge1xuICAgICAgdGhpcy5jdWVQb2ludHMuZm9yRWFjaCgoY3VlUG9pbnQpID0+IHtcbiAgICAgICAgaWYgKGN1ZVBvaW50ICE9PSAwICYmIGN1ZVBvaW50ICE9PSAtMSAmJiBjdWVQb2ludCA8IHRoaXMucGxheWVyLmR1cmF0aW9uKSB7XG4gICAgICAgICAgY29uc3Qgc2Vla0VsZW1lbnQgPSB0aGlzLnBsYXllci5lbGVtZW50cy5wcm9ncmVzcztcblxuICAgICAgICAgIGlmIChpcy5lbGVtZW50KHNlZWtFbGVtZW50KSkge1xuICAgICAgICAgICAgY29uc3QgY3VlUGVyY2VudGFnZSA9ICgxMDAgLyB0aGlzLnBsYXllci5kdXJhdGlvbikgKiBjdWVQb2ludDtcbiAgICAgICAgICAgIGNvbnN0IGN1ZSA9IGNyZWF0ZUVsZW1lbnQoJ3NwYW4nLCB7XG4gICAgICAgICAgICAgIGNsYXNzOiB0aGlzLnBsYXllci5jb25maWcuY2xhc3NOYW1lcy5jdWVzLFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGN1ZS5zdHlsZS5sZWZ0ID0gYCR7Y3VlUGVyY2VudGFnZS50b1N0cmluZygpfSVgO1xuICAgICAgICAgICAgc2Vla0VsZW1lbnQuYXBwZW5kQ2hpbGQoY3VlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfTtcblxuICAvKipcbiAgICogVGhpcyBpcyB3aGVyZSBhbGwgdGhlIGV2ZW50IGhhbmRsaW5nIHRha2VzIHBsYWNlLiBSZXRyaWV2ZSB0aGUgYWQgZnJvbSB0aGUgZXZlbnQuIFNvbWVcbiAgICogZXZlbnRzIChlLmcuIEFMTF9BRFNfQ09NUExFVEVEKSBkb24ndCBoYXZlIHRoZSBhZCBvYmplY3QgYXNzb2NpYXRlZFxuICAgKiBodHRwczovL2RldmVsb3BlcnMuZ29vZ2xlLmNvbS9pbnRlcmFjdGl2ZS1tZWRpYS1hZHMvZG9jcy9zZGtzL2h0bWw1L3YzL2FwaXMjaW1hLkFkRXZlbnQuVHlwZVxuICAgKiBAcGFyYW0ge0V2ZW50fSBldmVudFxuICAgKi9cbiAgb25BZEV2ZW50ID0gKGV2ZW50KSA9PiB7XG4gICAgY29uc3QgeyBjb250YWluZXIgfSA9IHRoaXMucGxheWVyLmVsZW1lbnRzO1xuICAgIC8vIFJldHJpZXZlIHRoZSBhZCBmcm9tIHRoZSBldmVudC4gU29tZSBldmVudHMgKGUuZy4gQUxMX0FEU19DT01QTEVURUQpXG4gICAgLy8gZG9uJ3QgaGF2ZSBhZCBvYmplY3QgYXNzb2NpYXRlZFxuICAgIGNvbnN0IGFkID0gZXZlbnQuZ2V0QWQoKTtcbiAgICBjb25zdCBhZERhdGEgPSBldmVudC5nZXRBZERhdGEoKTtcblxuICAgIC8vIFByb3h5IGV2ZW50XG4gICAgY29uc3QgZGlzcGF0Y2hFdmVudCA9ICh0eXBlKSA9PiB7XG4gICAgICB0cmlnZ2VyRXZlbnQuY2FsbCh0aGlzLnBsYXllciwgdGhpcy5wbGF5ZXIubWVkaWEsIGBhZHMke3R5cGUucmVwbGFjZSgvXy9nLCAnJykudG9Mb3dlckNhc2UoKX1gKTtcbiAgICB9O1xuXG4gICAgLy8gQnViYmxlIHRoZSBldmVudFxuICAgIGRpc3BhdGNoRXZlbnQoZXZlbnQudHlwZSk7XG5cbiAgICBzd2l0Y2ggKGV2ZW50LnR5cGUpIHtcbiAgICAgIGNhc2UgZ29vZ2xlLmltYS5BZEV2ZW50LlR5cGUuTE9BREVEOlxuICAgICAgICAvLyBUaGlzIGlzIHRoZSBmaXJzdCBldmVudCBzZW50IGZvciBhbiBhZCAtIGl0IGlzIHBvc3NpYmxlIHRvIGRldGVybWluZSB3aGV0aGVyIHRoZVxuICAgICAgICAvLyBhZCBpcyBhIHZpZGVvIGFkIG9yIGFuIG92ZXJsYXlcbiAgICAgICAgdGhpcy50cmlnZ2VyKCdsb2FkZWQnKTtcblxuICAgICAgICAvLyBTdGFydCBjb3VudGRvd25cbiAgICAgICAgdGhpcy5wb2xsQ291bnRkb3duKHRydWUpO1xuXG4gICAgICAgIGlmICghYWQuaXNMaW5lYXIoKSkge1xuICAgICAgICAgIC8vIFBvc2l0aW9uIEFkRGlzcGxheUNvbnRhaW5lciBjb3JyZWN0bHkgZm9yIG92ZXJsYXlcbiAgICAgICAgICBhZC53aWR0aCA9IGNvbnRhaW5lci5vZmZzZXRXaWR0aDtcbiAgICAgICAgICBhZC5oZWlnaHQgPSBjb250YWluZXIub2Zmc2V0SGVpZ2h0O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gY29uc29sZS5pbmZvKCdBZCB0eXBlOiAnICsgZXZlbnQuZ2V0QWQoKS5nZXRBZFBvZEluZm8oKS5nZXRQb2RJbmRleCgpKTtcbiAgICAgICAgLy8gY29uc29sZS5pbmZvKCdBZCB0aW1lOiAnICsgZXZlbnQuZ2V0QWQoKS5nZXRBZFBvZEluZm8oKS5nZXRUaW1lT2Zmc2V0KCkpO1xuXG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlIGdvb2dsZS5pbWEuQWRFdmVudC5UeXBlLlNUQVJURUQ6XG4gICAgICAgIC8vIFNldCB2b2x1bWUgdG8gbWF0Y2ggcGxheWVyXG4gICAgICAgIHRoaXMubWFuYWdlci5zZXRWb2x1bWUodGhpcy5wbGF5ZXIudm9sdW1lKTtcblxuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSBnb29nbGUuaW1hLkFkRXZlbnQuVHlwZS5BTExfQURTX0NPTVBMRVRFRDpcbiAgICAgICAgLy8gQWxsIGFkcyBmb3IgdGhlIGN1cnJlbnQgdmlkZW9zIGFyZSBkb25lLiBXZSBjYW4gbm93IHJlcXVlc3QgbmV3IGFkdmVydGlzZW1lbnRzXG4gICAgICAgIC8vIGluIGNhc2UgdGhlIHZpZGVvIGlzIHJlLXBsYXllZFxuXG4gICAgICAgIC8vIFRPRE86IEV4YW1wbGUgZm9yIHdoYXQgaGFwcGVucyB3aGVuIGEgbmV4dCB2aWRlbyBpbiBhIHBsYXlsaXN0IHdvdWxkIGJlIGxvYWRlZC5cbiAgICAgICAgLy8gU28gaGVyZSB3ZSBsb2FkIGEgbmV3IHZpZGVvIHdoZW4gYWxsIGFkcyBhcmUgZG9uZS5cbiAgICAgICAgLy8gVGhlbiB3ZSBsb2FkIG5ldyBhZHMgd2l0aGluIGEgbmV3IGFkc01hbmFnZXIuIFdoZW4gdGhlIHZpZGVvXG4gICAgICAgIC8vIElzIHN0YXJ0ZWQgLSBhZnRlciAtIHRoZSBhZHMgYXJlIGxvYWRlZCwgdGhlbiB3ZSBnZXQgYWRzLlxuICAgICAgICAvLyBZb3UgY2FuIGFsc28gZWFzaWx5IHRlc3QgY2FuY2VsbGluZyBhbmQgcmVsb2FkaW5nIGJ5IHJ1bm5pbmdcbiAgICAgICAgLy8gcGxheWVyLmFkcy5jYW5jZWwoKSBhbmQgcGxheWVyLmFkcy5wbGF5IGZyb20gdGhlIGNvbnNvbGUgSSBndWVzcy5cbiAgICAgICAgLy8gdGhpcy5wbGF5ZXIuc291cmNlID0ge1xuICAgICAgICAvLyAgICAgdHlwZTogJ3ZpZGVvJyxcbiAgICAgICAgLy8gICAgIHRpdGxlOiAnVmlldyBGcm9tIEEgQmx1ZSBNb29uJyxcbiAgICAgICAgLy8gICAgIHNvdXJjZXM6IFt7XG4gICAgICAgIC8vICAgICAgICAgc3JjOlxuICAgICAgICAvLyAnaHR0cHM6Ly9jZG4ucGx5ci5pby9zdGF0aWMvZGVtby9WaWV3X0Zyb21fQV9CbHVlX01vb25fVHJhaWxlci1IRC5tcDQnLCB0eXBlOlxuICAgICAgICAvLyAndmlkZW8vbXA0JywgfV0sIHBvc3RlcjpcbiAgICAgICAgLy8gJ2h0dHBzOi8vY2RuLnBseXIuaW8vc3RhdGljL2RlbW8vVmlld19Gcm9tX0FfQmx1ZV9Nb29uX1RyYWlsZXItSEQuanBnJywgdHJhY2tzOlxuICAgICAgICAvLyBbIHsga2luZDogJ2NhcHRpb25zJywgbGFiZWw6ICdFbmdsaXNoJywgc3JjbGFuZzogJ2VuJywgc3JjOlxuICAgICAgICAvLyAnaHR0cHM6Ly9jZG4ucGx5ci5pby9zdGF0aWMvZGVtby9WaWV3X0Zyb21fQV9CbHVlX01vb25fVHJhaWxlci1IRC5lbi52dHQnLFxuICAgICAgICAvLyBkZWZhdWx0OiB0cnVlLCB9LCB7IGtpbmQ6ICdjYXB0aW9ucycsIGxhYmVsOiAnRnJlbmNoJywgc3JjbGFuZzogJ2ZyJywgc3JjOlxuICAgICAgICAvLyAnaHR0cHM6Ly9jZG4ucGx5ci5pby9zdGF0aWMvZGVtby9WaWV3X0Zyb21fQV9CbHVlX01vb25fVHJhaWxlci1IRC5mci52dHQnLCB9LCBdLFxuICAgICAgICAvLyB9O1xuXG4gICAgICAgIC8vIFRPRE86IFNvIHRoZXJlIGlzIHN0aWxsIHRoaXMgdGhpbmcgd2hlcmUgYSB2aWRlbyBzaG91bGQgb25seSBiZSBhbGxvd2VkIHRvIHN0YXJ0XG4gICAgICAgIC8vIHBsYXlpbmcgd2hlbiB0aGUgSU1BIFNESyBpcyByZWFkeSBvciBoYXMgZmFpbGVkXG5cbiAgICAgICAgaWYgKHRoaXMucGxheWVyLmVuZGVkKSB7XG4gICAgICAgICAgdGhpcy5sb2FkQWRzKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gVGhlIFNESyB3b24ndCBhbGxvdyBuZXcgYWRzIHRvIGJlIGNhbGxlZCB3aXRob3V0IHJlY2VpdmluZyBhIGNvbnRlbnRDb21wbGV0ZSgpXG4gICAgICAgICAgdGhpcy5sb2FkZXIuY29udGVudENvbXBsZXRlKCk7XG4gICAgICAgIH1cblxuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSBnb29nbGUuaW1hLkFkRXZlbnQuVHlwZS5DT05URU5UX1BBVVNFX1JFUVVFU1RFRDpcbiAgICAgICAgLy8gVGhpcyBldmVudCBpbmRpY2F0ZXMgdGhlIGFkIGhhcyBzdGFydGVkIC0gdGhlIHZpZGVvIHBsYXllciBjYW4gYWRqdXN0IHRoZSBVSSxcbiAgICAgICAgLy8gZm9yIGV4YW1wbGUgZGlzcGxheSBhIHBhdXNlIGJ1dHRvbiBhbmQgcmVtYWluaW5nIHRpbWUuIEZpcmVkIHdoZW4gY29udGVudCBzaG91bGRcbiAgICAgICAgLy8gYmUgcGF1c2VkLiBUaGlzIHVzdWFsbHkgaGFwcGVucyByaWdodCBiZWZvcmUgYW4gYWQgaXMgYWJvdXQgdG8gY292ZXIgdGhlIGNvbnRlbnRcblxuICAgICAgICB0aGlzLnBhdXNlQ29udGVudCgpO1xuXG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlIGdvb2dsZS5pbWEuQWRFdmVudC5UeXBlLkNPTlRFTlRfUkVTVU1FX1JFUVVFU1RFRDpcbiAgICAgICAgLy8gVGhpcyBldmVudCBpbmRpY2F0ZXMgdGhlIGFkIGhhcyBmaW5pc2hlZCAtIHRoZSB2aWRlbyBwbGF5ZXIgY2FuIHBlcmZvcm1cbiAgICAgICAgLy8gYXBwcm9wcmlhdGUgVUkgYWN0aW9ucywgc3VjaCBhcyByZW1vdmluZyB0aGUgdGltZXIgZm9yIHJlbWFpbmluZyB0aW1lIGRldGVjdGlvbi5cbiAgICAgICAgLy8gRmlyZWQgd2hlbiBjb250ZW50IHNob3VsZCBiZSByZXN1bWVkLiBUaGlzIHVzdWFsbHkgaGFwcGVucyB3aGVuIGFuIGFkIGZpbmlzaGVzXG4gICAgICAgIC8vIG9yIGNvbGxhcHNlc1xuXG4gICAgICAgIHRoaXMucG9sbENvdW50ZG93bigpO1xuXG4gICAgICAgIHRoaXMucmVzdW1lQ29udGVudCgpO1xuXG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlIGdvb2dsZS5pbWEuQWRFdmVudC5UeXBlLkxPRzpcbiAgICAgICAgaWYgKGFkRGF0YS5hZEVycm9yKSB7XG4gICAgICAgICAgdGhpcy5wbGF5ZXIuZGVidWcud2FybihgTm9uLWZhdGFsIGFkIGVycm9yOiAke2FkRGF0YS5hZEVycm9yLmdldE1lc3NhZ2UoKX1gKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBkZWZhdWx0OlxuICAgICAgICBicmVhaztcbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICAqIEFueSBhZCBlcnJvciBoYW5kbGluZyBjb21lcyB0aHJvdWdoIGhlcmVcbiAgICogQHBhcmFtIHtFdmVudH0gZXZlbnRcbiAgICovXG4gIG9uQWRFcnJvciA9IChldmVudCkgPT4ge1xuICAgIHRoaXMuY2FuY2VsKCk7XG4gICAgdGhpcy5wbGF5ZXIuZGVidWcud2FybignQWRzIGVycm9yJywgZXZlbnQpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBTZXR1cCBob29rcyBmb3IgUGx5ciBhbmQgd2luZG93IGV2ZW50cy4gVGhpcyBlbnN1cmVzXG4gICAqIHRoZSBtaWQtIGFuZCBwb3N0LXJvbGwgbGF1bmNoIGF0IHRoZSBjb3JyZWN0IHRpbWUuIEFuZFxuICAgKiByZXNpemUgdGhlIGFkdmVydGlzZW1lbnQgd2hlbiB0aGUgcGxheWVyIHJlc2l6ZXNcbiAgICovXG4gIGxpc3RlbmVycyA9ICgpID0+IHtcbiAgICBjb25zdCB7IGNvbnRhaW5lciB9ID0gdGhpcy5wbGF5ZXIuZWxlbWVudHM7XG4gICAgbGV0IHRpbWU7XG5cbiAgICB0aGlzLnBsYXllci5vbignY2FucGxheScsICgpID0+IHtcbiAgICAgIHRoaXMuYWRkQ3VlUG9pbnRzKCk7XG4gICAgfSk7XG5cbiAgICB0aGlzLnBsYXllci5vbignZW5kZWQnLCAoKSA9PiB7XG4gICAgICB0aGlzLmxvYWRlci5jb250ZW50Q29tcGxldGUoKTtcbiAgICB9KTtcblxuICAgIHRoaXMucGxheWVyLm9uKCd0aW1ldXBkYXRlJywgKCkgPT4ge1xuICAgICAgdGltZSA9IHRoaXMucGxheWVyLmN1cnJlbnRUaW1lO1xuICAgIH0pO1xuXG4gICAgdGhpcy5wbGF5ZXIub24oJ3NlZWtlZCcsICgpID0+IHtcbiAgICAgIGNvbnN0IHNlZWtlZFRpbWUgPSB0aGlzLnBsYXllci5jdXJyZW50VGltZTtcblxuICAgICAgaWYgKGlzLmVtcHR5KHRoaXMuY3VlUG9pbnRzKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHRoaXMuY3VlUG9pbnRzLmZvckVhY2goKGN1ZVBvaW50LCBpbmRleCkgPT4ge1xuICAgICAgICBpZiAodGltZSA8IGN1ZVBvaW50ICYmIGN1ZVBvaW50IDwgc2Vla2VkVGltZSkge1xuICAgICAgICAgIHRoaXMubWFuYWdlci5kaXNjYXJkQWRCcmVhaygpO1xuICAgICAgICAgIHRoaXMuY3VlUG9pbnRzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgLy8gTGlzdGVuIHRvIHRoZSByZXNpemluZyBvZiB0aGUgd2luZG93LiBBbmQgcmVzaXplIGFkIGFjY29yZGluZ2x5XG4gICAgLy8gVE9ETzogZXZlbnR1YWxseSBpbXBsZW1lbnQgUmVzaXplT2JzZXJ2ZXJcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgKCkgPT4ge1xuICAgICAgaWYgKHRoaXMubWFuYWdlcikge1xuICAgICAgICB0aGlzLm1hbmFnZXIucmVzaXplKGNvbnRhaW5lci5vZmZzZXRXaWR0aCwgY29udGFpbmVyLm9mZnNldEhlaWdodCwgZ29vZ2xlLmltYS5WaWV3TW9kZS5OT1JNQUwpO1xuICAgICAgfVxuICAgIH0pO1xuICB9O1xuXG4gIC8qKlxuICAgKiBJbml0aWFsaXplIHRoZSBhZHNNYW5hZ2VyIGFuZCBzdGFydCBwbGF5aW5nIGFkdmVydGlzZW1lbnRzXG4gICAqL1xuICBwbGF5ID0gKCkgPT4ge1xuICAgIGNvbnN0IHsgY29udGFpbmVyIH0gPSB0aGlzLnBsYXllci5lbGVtZW50cztcblxuICAgIGlmICghdGhpcy5tYW5hZ2VyUHJvbWlzZSkge1xuICAgICAgdGhpcy5yZXN1bWVDb250ZW50KCk7XG4gICAgfVxuXG4gICAgLy8gUGxheSB0aGUgcmVxdWVzdGVkIGFkdmVydGlzZW1lbnQgd2hlbmV2ZXIgdGhlIGFkc01hbmFnZXIgaXMgcmVhZHlcbiAgICB0aGlzLm1hbmFnZXJQcm9taXNlXG4gICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgIC8vIFNldCB2b2x1bWUgdG8gbWF0Y2ggcGxheWVyXG4gICAgICAgIHRoaXMubWFuYWdlci5zZXRWb2x1bWUodGhpcy5wbGF5ZXIudm9sdW1lKTtcblxuICAgICAgICAvLyBJbml0aWFsaXplIHRoZSBjb250YWluZXIuIE11c3QgYmUgZG9uZSB2aWEgYSB1c2VyIGFjdGlvbiBvbiBtb2JpbGUgZGV2aWNlc1xuICAgICAgICB0aGlzLmVsZW1lbnRzLmRpc3BsYXlDb250YWluZXIuaW5pdGlhbGl6ZSgpO1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgaWYgKCF0aGlzLmluaXRpYWxpemVkKSB7XG4gICAgICAgICAgICAvLyBJbml0aWFsaXplIHRoZSBhZHMgbWFuYWdlci4gQWQgcnVsZXMgcGxheWxpc3Qgd2lsbCBzdGFydCBhdCB0aGlzIHRpbWVcbiAgICAgICAgICAgIHRoaXMubWFuYWdlci5pbml0KGNvbnRhaW5lci5vZmZzZXRXaWR0aCwgY29udGFpbmVyLm9mZnNldEhlaWdodCwgZ29vZ2xlLmltYS5WaWV3TW9kZS5OT1JNQUwpO1xuXG4gICAgICAgICAgICAvLyBDYWxsIHBsYXkgdG8gc3RhcnQgc2hvd2luZyB0aGUgYWQuIFNpbmdsZSB2aWRlbyBhbmQgb3ZlcmxheSBhZHMgd2lsbFxuICAgICAgICAgICAgLy8gc3RhcnQgYXQgdGhpcyB0aW1lOyB0aGUgY2FsbCB3aWxsIGJlIGlnbm9yZWQgZm9yIGFkIHJ1bGVzXG4gICAgICAgICAgICB0aGlzLm1hbmFnZXIuc3RhcnQoKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICB0aGlzLmluaXRpYWxpemVkID0gdHJ1ZTtcbiAgICAgICAgfSBjYXRjaCAoYWRFcnJvcikge1xuICAgICAgICAgIC8vIEFuIGVycm9yIG1heSBiZSB0aHJvd24gaWYgdGhlcmUgd2FzIGEgcHJvYmxlbSB3aXRoIHRoZVxuICAgICAgICAgIC8vIFZBU1QgcmVzcG9uc2VcbiAgICAgICAgICB0aGlzLm9uQWRFcnJvcihhZEVycm9yKTtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICAgIC5jYXRjaCgoKSA9PiB7fSk7XG4gIH07XG5cbiAgLyoqXG4gICAqIFJlc3VtZSBvdXIgdmlkZW9cbiAgICovXG4gIHJlc3VtZUNvbnRlbnQgPSAoKSA9PiB7XG4gICAgLy8gSGlkZSB0aGUgYWR2ZXJ0aXNlbWVudCBjb250YWluZXJcbiAgICB0aGlzLmVsZW1lbnRzLmNvbnRhaW5lci5zdHlsZS56SW5kZXggPSAnJztcblxuICAgIC8vIEFkIGlzIHN0b3BwZWRcbiAgICB0aGlzLnBsYXlpbmcgPSBmYWxzZTtcblxuICAgIC8vIFBsYXkgdmlkZW9cbiAgICBzaWxlbmNlUHJvbWlzZSh0aGlzLnBsYXllci5tZWRpYS5wbGF5KCkpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBQYXVzZSBvdXIgdmlkZW9cbiAgICovXG4gIHBhdXNlQ29udGVudCA9ICgpID0+IHtcbiAgICAvLyBTaG93IHRoZSBhZHZlcnRpc2VtZW50IGNvbnRhaW5lclxuICAgIHRoaXMuZWxlbWVudHMuY29udGFpbmVyLnN0eWxlLnpJbmRleCA9IDM7XG5cbiAgICAvLyBBZCBpcyBwbGF5aW5nXG4gICAgdGhpcy5wbGF5aW5nID0gdHJ1ZTtcblxuICAgIC8vIFBhdXNlIG91ciB2aWRlby5cbiAgICB0aGlzLnBsYXllci5tZWRpYS5wYXVzZSgpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBEZXN0cm95IHRoZSBhZHNNYW5hZ2VyIHNvIHdlIGNhbiBncmFiIG5ldyBhZHMgYWZ0ZXIgdGhpcy4gSWYgd2UgZG9uJ3QgdGhlbiB3ZSdyZSBub3RcbiAgICogYWxsb3dlZCB0byBjYWxsIG5ldyBhZHMgYmFzZWQgb24gZ29vZ2xlIHBvbGljaWVzLCBhcyB0aGV5IGludGVycHJldCB0aGlzIGFzIGFuIGFjY2lkZW50YWxcbiAgICogdmlkZW8gcmVxdWVzdHMuIGh0dHBzOi8vZGV2ZWxvcGVycy5nb29nbGUuY29tL2ludGVyYWN0aXZlLVxuICAgKiBtZWRpYS1hZHMvZG9jcy9zZGtzL2FuZHJvaWQvZmFxIzhcbiAgICovXG4gIGNhbmNlbCA9ICgpID0+IHtcbiAgICAvLyBQYXVzZSBvdXIgdmlkZW9cbiAgICBpZiAodGhpcy5pbml0aWFsaXplZCkge1xuICAgICAgdGhpcy5yZXN1bWVDb250ZW50KCk7XG4gICAgfVxuXG4gICAgLy8gVGVsbCBvdXIgaW5zdGFuY2UgdGhhdCB3ZSdyZSBkb25lIGZvciBub3dcbiAgICB0aGlzLnRyaWdnZXIoJ2Vycm9yJyk7XG5cbiAgICAvLyBSZS1jcmVhdGUgb3VyIGFkc01hbmFnZXJcbiAgICB0aGlzLmxvYWRBZHMoKTtcbiAgfTtcblxuICAvKipcbiAgICogUmUtY3JlYXRlIG91ciBhZHNNYW5hZ2VyXG4gICAqL1xuICBsb2FkQWRzID0gKCkgPT4ge1xuICAgIC8vIFRlbGwgb3VyIGFkc01hbmFnZXIgdG8gZ28gYnllIGJ5ZVxuICAgIHRoaXMubWFuYWdlclByb21pc2VcbiAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgLy8gRGVzdHJveSBvdXIgYWRzTWFuYWdlclxuICAgICAgICBpZiAodGhpcy5tYW5hZ2VyKSB7XG4gICAgICAgICAgdGhpcy5tYW5hZ2VyLmRlc3Ryb3koKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFJlLXNldCBvdXIgYWRzTWFuYWdlciBwcm9taXNlc1xuICAgICAgICB0aGlzLm1hbmFnZXJQcm9taXNlID0gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgICAgICB0aGlzLm9uKCdsb2FkZWQnLCByZXNvbHZlKTtcbiAgICAgICAgICB0aGlzLnBsYXllci5kZWJ1Zy5sb2codGhpcy5tYW5hZ2VyKTtcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIE5vdyB0aGF0IHRoZSBtYW5hZ2VyIGhhcyBiZWVuIGRlc3Ryb3llZCBzZXQgaXQgdG8gYWxzbyBiZSB1bi1pbml0aWFsaXplZFxuICAgICAgICB0aGlzLmluaXRpYWxpemVkID0gZmFsc2U7XG5cbiAgICAgICAgLy8gTm93IHJlcXVlc3Qgc29tZSBuZXcgYWR2ZXJ0aXNlbWVudHNcbiAgICAgICAgdGhpcy5yZXF1ZXN0QWRzKCk7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKCgpID0+IHt9KTtcbiAgfTtcblxuICAvKipcbiAgICogSGFuZGxlcyBjYWxsYmFja3MgYWZ0ZXIgYW4gYWQgZXZlbnQgd2FzIGludm9rZWRcbiAgICogQHBhcmFtIHtTdHJpbmd9IGV2ZW50IC0gRXZlbnQgdHlwZVxuICAgKiBAcGFyYW0gYXJnc1xuICAgKi9cbiAgdHJpZ2dlciA9IChldmVudCwgLi4uYXJncykgPT4ge1xuICAgIGNvbnN0IGhhbmRsZXJzID0gdGhpcy5ldmVudHNbZXZlbnRdO1xuXG4gICAgaWYgKGlzLmFycmF5KGhhbmRsZXJzKSkge1xuICAgICAgaGFuZGxlcnMuZm9yRWFjaCgoaGFuZGxlcikgPT4ge1xuICAgICAgICBpZiAoaXMuZnVuY3Rpb24oaGFuZGxlcikpIHtcbiAgICAgICAgICBoYW5kbGVyLmFwcGx5KHRoaXMsIGFyZ3MpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICAqIEFkZCBldmVudCBsaXN0ZW5lcnNcbiAgICogQHBhcmFtIHtTdHJpbmd9IGV2ZW50IC0gRXZlbnQgdHlwZVxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayAtIENhbGxiYWNrIGZvciB3aGVuIGV2ZW50IG9jY3Vyc1xuICAgKiBAcmV0dXJuIHtBZHN9XG4gICAqL1xuICBvbiA9IChldmVudCwgY2FsbGJhY2spID0+IHtcbiAgICBpZiAoIWlzLmFycmF5KHRoaXMuZXZlbnRzW2V2ZW50XSkpIHtcbiAgICAgIHRoaXMuZXZlbnRzW2V2ZW50XSA9IFtdO1xuICAgIH1cblxuICAgIHRoaXMuZXZlbnRzW2V2ZW50XS5wdXNoKGNhbGxiYWNrKTtcblxuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIC8qKlxuICAgKiBTZXR1cCBhIHNhZmV0eSB0aW1lciBmb3Igd2hlbiB0aGUgYWQgbmV0d29yayBkb2Vzbid0IHJlc3BvbmQgZm9yIHdoYXRldmVyIHJlYXNvbi5cbiAgICogVGhlIGFkdmVydGlzZW1lbnQgaGFzIDEyIHNlY29uZHMgdG8gZ2V0IGl0cyB0aGluZ3MgdG9nZXRoZXIuIFdlIHN0b3AgdGhpcyB0aW1lciB3aGVuIHRoZVxuICAgKiBhZHZlcnRpc2VtZW50IGlzIHBsYXlpbmcsIG9yIHdoZW4gYSB1c2VyIGFjdGlvbiBpcyByZXF1aXJlZCB0byBzdGFydCwgdGhlbiB3ZSBjbGVhciB0aGVcbiAgICogdGltZXIgb24gYWQgcmVhZHlcbiAgICogQHBhcmFtIHtOdW1iZXJ9IHRpbWVcbiAgICogQHBhcmFtIHtTdHJpbmd9IGZyb21cbiAgICovXG4gIHN0YXJ0U2FmZXR5VGltZXIgPSAodGltZSwgZnJvbSkgPT4ge1xuICAgIHRoaXMucGxheWVyLmRlYnVnLmxvZyhgU2FmZXR5IHRpbWVyIGludm9rZWQgZnJvbTogJHtmcm9tfWApO1xuXG4gICAgdGhpcy5zYWZldHlUaW1lciA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgdGhpcy5jYW5jZWwoKTtcbiAgICAgIHRoaXMuY2xlYXJTYWZldHlUaW1lcignc3RhcnRTYWZldHlUaW1lcigpJyk7XG4gICAgfSwgdGltZSk7XG4gIH07XG5cbiAgLyoqXG4gICAqIENsZWFyIG91ciBzYWZldHkgdGltZXIocylcbiAgICogQHBhcmFtIHtTdHJpbmd9IGZyb21cbiAgICovXG4gIGNsZWFyU2FmZXR5VGltZXIgPSAoZnJvbSkgPT4ge1xuICAgIGlmICghaXMubnVsbE9yVW5kZWZpbmVkKHRoaXMuc2FmZXR5VGltZXIpKSB7XG4gICAgICB0aGlzLnBsYXllci5kZWJ1Zy5sb2coYFNhZmV0eSB0aW1lciBjbGVhcmVkIGZyb206ICR7ZnJvbX1gKTtcblxuICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuc2FmZXR5VGltZXIpO1xuICAgICAgdGhpcy5zYWZldHlUaW1lciA9IG51bGw7XG4gICAgfVxuICB9O1xufVxuXG5leHBvcnQgZGVmYXVsdCBBZHM7XG4iLCIvKipcbiAqIFJldHVybnMgYSBudW1iZXIgd2hvc2UgdmFsdWUgaXMgbGltaXRlZCB0byB0aGUgZ2l2ZW4gcmFuZ2UuXG4gKlxuICogRXhhbXBsZTogbGltaXQgdGhlIG91dHB1dCBvZiB0aGlzIGNvbXB1dGF0aW9uIHRvIGJldHdlZW4gMCBhbmQgMjU1XG4gKiAoeCAqIDI1NSkuY2xhbXAoMCwgMjU1KVxuICpcbiAqIEBwYXJhbSB7TnVtYmVyfSBpbnB1dFxuICogQHBhcmFtIHtOdW1iZXJ9IG1pbiBUaGUgbG93ZXIgYm91bmRhcnkgb2YgdGhlIG91dHB1dCByYW5nZVxuICogQHBhcmFtIHtOdW1iZXJ9IG1heCBUaGUgdXBwZXIgYm91bmRhcnkgb2YgdGhlIG91dHB1dCByYW5nZVxuICogQHJldHVybnMgQSBudW1iZXIgd2l0aGluIHRoZSBib3VuZHMgb2YgbWluIGFuZCBtYXhcbiAqIEB0eXBlIE51bWJlclxuICovXG5leHBvcnQgZnVuY3Rpb24gY2xhbXAoaW5wdXQgPSAwLCBtaW4gPSAwLCBtYXggPSAyNTUpIHtcbiAgcmV0dXJuIE1hdGgubWluKE1hdGgubWF4KGlucHV0LCBtaW4pLCBtYXgpO1xufVxuXG5leHBvcnQgZGVmYXVsdCB7IGNsYW1wIH07XG4iLCJpbXBvcnQgeyBjcmVhdGVFbGVtZW50IH0gZnJvbSAnLi4vdXRpbHMvZWxlbWVudHMnO1xuaW1wb3J0IHsgb25jZSB9IGZyb20gJy4uL3V0aWxzL2V2ZW50cyc7XG5pbXBvcnQgZmV0Y2ggZnJvbSAnLi4vdXRpbHMvZmV0Y2gnO1xuaW1wb3J0IGlzIGZyb20gJy4uL3V0aWxzL2lzJztcbmltcG9ydCB7IGNsYW1wIH0gZnJvbSAnLi4vdXRpbHMvbnVtYmVycyc7XG5pbXBvcnQgeyBmb3JtYXRUaW1lIH0gZnJvbSAnLi4vdXRpbHMvdGltZSc7XG5cbi8vIEFyZzogdnR0RGF0YVN0cmluZyBleGFtcGxlOiBcIldFQlZUVFxcblxcbjFcXG4wMDowMDowNS4wMDAgLS0+IDAwOjAwOjEwLjAwMFxcbjEwODBwLTAwMDAxLmpwZ1wiXG5jb25zdCBwYXJzZVZ0dCA9ICh2dHREYXRhU3RyaW5nKSA9PiB7XG4gIGNvbnN0IHByb2Nlc3NlZExpc3QgPSBbXTtcbiAgY29uc3QgZnJhbWVzID0gdnR0RGF0YVN0cmluZy5zcGxpdCgvXFxyXFxuXFxyXFxufFxcblxcbnxcXHJcXHIvKTtcblxuICBmcmFtZXMuZm9yRWFjaCgoZnJhbWUpID0+IHtcbiAgICBjb25zdCByZXN1bHQgPSB7fTtcbiAgICBjb25zdCBsaW5lcyA9IGZyYW1lLnNwbGl0KC9cXHJcXG58XFxufFxcci8pO1xuXG4gICAgbGluZXMuZm9yRWFjaCgobGluZSkgPT4ge1xuICAgICAgaWYgKCFpcy5udW1iZXIocmVzdWx0LnN0YXJ0VGltZSkpIHtcbiAgICAgICAgLy8gVGhlIGxpbmUgd2l0aCBzdGFydCBhbmQgZW5kIHRpbWVzIG9uIGl0IGlzIHRoZSBmaXJzdCBsaW5lIG9mIGludGVyZXN0XG4gICAgICAgIGNvbnN0IG1hdGNoVGltZXMgPSBsaW5lLm1hdGNoKFxuICAgICAgICAgIC8oWzAtOV17Mn0pPzo/KFswLTldezJ9KTooWzAtOV17Mn0pLihbMC05XXsyLDN9KSggPy0tPiA/KShbMC05XXsyfSk/Oj8oWzAtOV17Mn0pOihbMC05XXsyfSkuKFswLTldezIsM30pLyxcbiAgICAgICAgKTsgLy8gTm90ZSB0aGF0IHRoaXMgY3VycmVudGx5IGlnbm9yZXMgY2FwdGlvbiBmb3JtYXR0aW5nIGRpcmVjdGl2ZXMgdGhhdCBhcmUgb3B0aW9uYWxseSBvbiB0aGUgZW5kIG9mIHRoaXMgbGluZSAtIGZpbmUgZm9yIG5vbi1jYXB0aW9ucyBWVFRcblxuICAgICAgICBpZiAobWF0Y2hUaW1lcykge1xuICAgICAgICAgIHJlc3VsdC5zdGFydFRpbWUgPVxuICAgICAgICAgICAgTnVtYmVyKG1hdGNoVGltZXNbMV0gfHwgMCkgKiA2MCAqIDYwICtcbiAgICAgICAgICAgIE51bWJlcihtYXRjaFRpbWVzWzJdKSAqIDYwICtcbiAgICAgICAgICAgIE51bWJlcihtYXRjaFRpbWVzWzNdKSArXG4gICAgICAgICAgICBOdW1iZXIoYDAuJHttYXRjaFRpbWVzWzRdfWApO1xuICAgICAgICAgIHJlc3VsdC5lbmRUaW1lID1cbiAgICAgICAgICAgIE51bWJlcihtYXRjaFRpbWVzWzZdIHx8IDApICogNjAgKiA2MCArXG4gICAgICAgICAgICBOdW1iZXIobWF0Y2hUaW1lc1s3XSkgKiA2MCArXG4gICAgICAgICAgICBOdW1iZXIobWF0Y2hUaW1lc1s4XSkgK1xuICAgICAgICAgICAgTnVtYmVyKGAwLiR7bWF0Y2hUaW1lc1s5XX1gKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmICghaXMuZW1wdHkobGluZS50cmltKCkpICYmIGlzLmVtcHR5KHJlc3VsdC50ZXh0KSkge1xuICAgICAgICAvLyBJZiB3ZSBhbHJlYWR5IGhhdmUgdGhlIHN0YXJ0VGltZSwgdGhlbiB3ZSdyZSBkZWZpbml0ZWx5IHVwIHRvIHRoZSB0ZXh0IGxpbmUocylcbiAgICAgICAgY29uc3QgbGluZVNwbGl0ID0gbGluZS50cmltKCkuc3BsaXQoJyN4eXdoPScpO1xuICAgICAgICBbcmVzdWx0LnRleHRdID0gbGluZVNwbGl0O1xuXG4gICAgICAgIC8vIElmIHRoZXJlJ3MgY29udGVudCBpbiBsaW5lU3BsaXRbMV0sIHRoZW4gd2UgaGF2ZSBzcHJpdGVzLiBJZiBub3QsIHRoZW4gaXQncyBqdXN0IG9uZSBmcmFtZSBwZXIgaW1hZ2VcbiAgICAgICAgaWYgKGxpbmVTcGxpdFsxXSkge1xuICAgICAgICAgIFtyZXN1bHQueCwgcmVzdWx0LnksIHJlc3VsdC53LCByZXN1bHQuaF0gPSBsaW5lU3BsaXRbMV0uc3BsaXQoJywnKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaWYgKHJlc3VsdC50ZXh0KSB7XG4gICAgICBwcm9jZXNzZWRMaXN0LnB1c2gocmVzdWx0KTtcbiAgICB9XG4gIH0pO1xuXG4gIHJldHVybiBwcm9jZXNzZWRMaXN0O1xufTtcblxuLyoqXG4gKiBQcmV2aWV3IHRodW1ibmFpbHMgZm9yIHNlZWsgaG92ZXIgYW5kIHNjcnViYmluZ1xuICogU2Vla2luZzogSG92ZXIgb3ZlciB0aGUgc2VlayBiYXIgKGRlc2t0b3Agb25seSk6IHNob3dzIGEgc21hbGwgcHJldmlldyBjb250YWluZXIgYWJvdmUgdGhlIHNlZWsgYmFyXG4gKiBTY3J1YmJpbmc6IENsaWNrIGFuZCBkcmFnIHRoZSBzZWVrIGJhciAoZGVza3RvcCBhbmQgbW9iaWxlKTogc2hvd3MgdGhlIHByZXZpZXcgaW1hZ2Ugb3ZlciB0aGUgZW50aXJlIHZpZGVvLCBhcyBpZiB0aGUgdmlkZW8gaXMgc2NydWJiaW5nIGF0IHZlcnkgaGlnaCBzcGVlZFxuICpcbiAqIE5vdGVzOlxuICogLSBUaHVtYnMgYXJlIHNldCB2aWEgSlMgc2V0dGluZ3Mgb24gUGx5ciBpbml0LCBub3QgSFRNTDUgJ3RyYWNrJyBwcm9wZXJ0eS4gVXNpbmcgdGhlIHRyYWNrIHByb3BlcnR5IHdvdWxkIGJlIGEgYml0IGdyb3NzLCBiZWNhdXNlIGl0IGRvZXNuJ3Qgc3VwcG9ydCBjdXN0b20gJ2tpbmRzJy4ga2luZD1tZXRhZGF0YSBtaWdodCBiZSB1c2VkIGZvciBzb21ldGhpbmcgZWxzZSwgYW5kIHdlIHdhbnQgdG8gYWxsb3cgbXVsdGlwbGUgdGh1bWJuYWlscyB0cmFja3MuIFRyYWNrcyBtdXN0IGhhdmUgYSB1bmlxdWUgY29tYmluYXRpb24gb2YgJ2tpbmQnIGFuZCAnbGFiZWwnLiBXZSB3b3VsZCBoYXZlIHRvIGRvIHNvbWV0aGluZyBsaWtlIGtpbmQ9bWV0YWRhdGEsbGFiZWw9dGh1bWJuYWlsczEgLyBraW5kPW1ldGFkYXRhLGxhYmVsPXRodW1ibmFpbHMyLiBTcXVhcmUgcGVnLCByb3VuZCBob2xlXG4gKiAtIFZUVCBpbmZvOiB0aGUgaW1hZ2UgVVJMIGlzIHJlbGF0aXZlIHRvIHRoZSBWVFQsIG5vdCB0aGUgY3VycmVudCBkb2N1bWVudC4gQnV0IGlmIHRoZSB1cmwgc3RhcnRzIHdpdGggYSBzbGFzaCwgaXQgd2lsbCBuYXR1cmFsbHkgYmUgcmVsYXRpdmUgdG8gdGhlIGN1cnJlbnQgZG9tYWluLiBodHRwczovL3N1cHBvcnQuandwbGF5ZXIuY29tL2FydGljbGVzL2hvdy10by1hZGQtcHJldmlldy10aHVtYm5haWxzXG4gKiAtIFRoaXMgaW1wbGVtZW50YXRpb24gdXNlcyBtdWx0aXBsZSBzZXBhcmF0ZSBpbWcgZWxlbWVudHMuIE90aGVyIGltcGxlbWVudGF0aW9ucyB1c2UgYmFja2dyb3VuZC1pbWFnZSBvbiBvbmUgZWxlbWVudC4gVGhpcyB3b3VsZCBiZSBuaWNlIGFuZCBzaW1wbGUsIGJ1dCBGaXJlZm94IGFuZCBTYWZhcmkgaGF2ZSBmbGlja2VyaW5nIGlzc3VlcyB3aXRoIHJlcGxhY2luZyBiYWNrZ3JvdW5kcyBvZiBsYXJnZXIgaW1hZ2VzLiBJdCBzZWVtcyB0aGF0IFlvdVR1YmUgcGVyaGFwcyBvbmx5IGF2b2lkcyB0aGlzIGJlY2F1c2UgdGhleSBkb24ndCBoYXZlIHRoZSBvcHRpb24gZm9yIGhpZ2gtcmVzIHByZXZpZXdzIChldmVuIHRoZSBmdWxsc2NyZWVuIG9uZXMsIHdoZW4gbW91c2Vkb3duL3NlZWtpbmcpLiBJbWFnZXMgYXBwZWFyIG92ZXIgdGhlIHRvcCBvZiBlYWNoIG90aGVyLCBhbmQgcHJldmlvdXMgb25lcyBhcmUgZGlzY2FyZGVkIG9uY2UgdGhlIG5ldyBvbmVzIGhhdmUgYmVlbiByZW5kZXJlZFxuICovXG5cbmNvbnN0IGZpdFJhdGlvID0gKHJhdGlvLCBvdXRlcikgPT4ge1xuICBjb25zdCB0YXJnZXRSYXRpbyA9IG91dGVyLndpZHRoIC8gb3V0ZXIuaGVpZ2h0O1xuICBjb25zdCByZXN1bHQgPSB7fTtcbiAgaWYgKHJhdGlvID4gdGFyZ2V0UmF0aW8pIHtcbiAgICByZXN1bHQud2lkdGggPSBvdXRlci53aWR0aDtcbiAgICByZXN1bHQuaGVpZ2h0ID0gKDEgLyByYXRpbykgKiBvdXRlci53aWR0aDtcbiAgfSBlbHNlIHtcbiAgICByZXN1bHQuaGVpZ2h0ID0gb3V0ZXIuaGVpZ2h0O1xuICAgIHJlc3VsdC53aWR0aCA9IHJhdGlvICogb3V0ZXIuaGVpZ2h0O1xuICB9XG5cbiAgcmV0dXJuIHJlc3VsdDtcbn07XG5cbmNsYXNzIFByZXZpZXdUaHVtYm5haWxzIHtcbiAgLyoqXG4gICAqIFByZXZpZXdUaHVtYm5haWxzIGNvbnN0cnVjdG9yLlxuICAgKiBAcGFyYW0ge1BseXJ9IHBsYXllclxuICAgKiBAcmV0dXJuIHtQcmV2aWV3VGh1bWJuYWlsc31cbiAgICovXG4gIGNvbnN0cnVjdG9yKHBsYXllcikge1xuICAgIHRoaXMucGxheWVyID0gcGxheWVyO1xuICAgIHRoaXMudGh1bWJuYWlscyA9IFtdO1xuICAgIHRoaXMubG9hZGVkID0gZmFsc2U7XG4gICAgdGhpcy5sYXN0TW91c2VNb3ZlVGltZSA9IERhdGUubm93KCk7XG4gICAgdGhpcy5tb3VzZURvd24gPSBmYWxzZTtcbiAgICB0aGlzLmxvYWRlZEltYWdlcyA9IFtdO1xuXG4gICAgdGhpcy5lbGVtZW50cyA9IHtcbiAgICAgIHRodW1iOiB7fSxcbiAgICAgIHNjcnViYmluZzoge30sXG4gICAgfTtcblxuICAgIHRoaXMubG9hZCgpO1xuICB9XG5cbiAgZ2V0IGVuYWJsZWQoKSB7XG4gICAgcmV0dXJuIHRoaXMucGxheWVyLmlzSFRNTDUgJiYgdGhpcy5wbGF5ZXIuaXNWaWRlbyAmJiB0aGlzLnBsYXllci5jb25maWcucHJldmlld1RodW1ibmFpbHMuZW5hYmxlZDtcbiAgfVxuXG4gIGxvYWQgPSAoKSA9PiB7XG4gICAgLy8gVG9nZ2xlIHRoZSByZWd1bGFyIHNlZWsgdG9vbHRpcFxuICAgIGlmICh0aGlzLnBsYXllci5lbGVtZW50cy5kaXNwbGF5LnNlZWtUb29sdGlwKSB7XG4gICAgICB0aGlzLnBsYXllci5lbGVtZW50cy5kaXNwbGF5LnNlZWtUb29sdGlwLmhpZGRlbiA9IHRoaXMuZW5hYmxlZDtcbiAgICB9XG5cbiAgICBpZiAoIXRoaXMuZW5hYmxlZCkgcmV0dXJuO1xuXG4gICAgdGhpcy5nZXRUaHVtYm5haWxzKCkudGhlbigoKSA9PiB7XG4gICAgICBpZiAoIXRoaXMuZW5hYmxlZCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vIFJlbmRlciBET00gZWxlbWVudHNcbiAgICAgIHRoaXMucmVuZGVyKCk7XG5cbiAgICAgIC8vIENoZWNrIHRvIHNlZSBpZiB0aHVtYiBjb250YWluZXIgc2l6ZSB3YXMgc3BlY2lmaWVkIG1hbnVhbGx5IGluIENTU1xuICAgICAgdGhpcy5kZXRlcm1pbmVDb250YWluZXJBdXRvU2l6aW5nKCk7XG5cbiAgICAgIHRoaXMubG9hZGVkID0gdHJ1ZTtcbiAgICB9KTtcbiAgfTtcblxuICAvLyBEb3dubG9hZCBWVFQgZmlsZXMgYW5kIHBhcnNlIHRoZW1cbiAgZ2V0VGh1bWJuYWlscyA9ICgpID0+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgIGNvbnN0IHsgc3JjIH0gPSB0aGlzLnBsYXllci5jb25maWcucHJldmlld1RodW1ibmFpbHM7XG5cbiAgICAgIGlmIChpcy5lbXB0eShzcmMpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignTWlzc2luZyBwcmV2aWV3VGh1bWJuYWlscy5zcmMgY29uZmlnIGF0dHJpYnV0ZScpO1xuICAgICAgfVxuXG4gICAgICAvLyBSZXNvbHZlIHByb21pc2VcbiAgICAgIGNvbnN0IHNvcnRBbmRSZXNvbHZlID0gKCkgPT4ge1xuICAgICAgICAvLyBTb3J0IHNtYWxsZXN0IHRvIGJpZ2dlc3QgKGUuZy4sIFsxMjBwLCA0ODBwLCAxMDgwcF0pXG4gICAgICAgIHRoaXMudGh1bWJuYWlscy5zb3J0KCh4LCB5KSA9PiB4LmhlaWdodCAtIHkuaGVpZ2h0KTtcblxuICAgICAgICB0aGlzLnBsYXllci5kZWJ1Zy5sb2coJ1ByZXZpZXcgdGh1bWJuYWlscycsIHRoaXMudGh1bWJuYWlscyk7XG5cbiAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgfTtcblxuICAgICAgLy8gVmlhIGNhbGxiYWNrKClcbiAgICAgIGlmIChpcy5mdW5jdGlvbihzcmMpKSB7XG4gICAgICAgIHNyYygodGh1bWJuYWlscykgPT4ge1xuICAgICAgICAgIHRoaXMudGh1bWJuYWlscyA9IHRodW1ibmFpbHM7XG4gICAgICAgICAgc29ydEFuZFJlc29sdmUoKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICAvLyBWVFQgdXJsc1xuICAgICAgZWxzZSB7XG4gICAgICAgIC8vIElmIHN0cmluZywgY29udmVydCBpbnRvIHNpbmdsZS1lbGVtZW50IGxpc3RcbiAgICAgICAgY29uc3QgdXJscyA9IGlzLnN0cmluZyhzcmMpID8gW3NyY10gOiBzcmM7XG4gICAgICAgIC8vIExvb3AgdGhyb3VnaCBlYWNoIHNyYyBVUkwuIERvd25sb2FkIGFuZCBwcm9jZXNzIHRoZSBWVFQgZmlsZSwgc3RvcmluZyB0aGUgcmVzdWx0aW5nIGRhdGEgaW4gdGhpcy50aHVtYm5haWxzXG4gICAgICAgIGNvbnN0IHByb21pc2VzID0gdXJscy5tYXAoKHUpID0+IHRoaXMuZ2V0VGh1bWJuYWlsKHUpKTtcbiAgICAgICAgLy8gUmVzb2x2ZVxuICAgICAgICBQcm9taXNlLmFsbChwcm9taXNlcykudGhlbihzb3J0QW5kUmVzb2x2ZSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH07XG5cbiAgLy8gUHJvY2VzcyBpbmRpdmlkdWFsIFZUVCBmaWxlXG4gIGdldFRodW1ibmFpbCA9ICh1cmwpID0+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgIGZldGNoKHVybCkudGhlbigocmVzcG9uc2UpID0+IHtcbiAgICAgICAgY29uc3QgdGh1bWJuYWlsID0ge1xuICAgICAgICAgIGZyYW1lczogcGFyc2VWdHQocmVzcG9uc2UpLFxuICAgICAgICAgIGhlaWdodDogbnVsbCxcbiAgICAgICAgICB1cmxQcmVmaXg6ICcnLFxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIElmIHRoZSBVUkxzIGRvbid0IHN0YXJ0IHdpdGggJy8nLCB0aGVuIHdlIG5lZWQgdG8gc2V0IHRoZWlyIHJlbGF0aXZlIHBhdGggdG8gYmUgdGhlIGxvY2F0aW9uIG9mIHRoZSBWVFQgZmlsZVxuICAgICAgICAvLyBJZiB0aGUgVVJMcyBkbyBzdGFydCB3aXRoICcvJywgdGhlbiB0aGV5IG9idmlvdXNseSBkb24ndCBuZWVkIGEgcHJlZml4LCBzbyBpdCB3aWxsIHJlbWFpbiBibGFua1xuICAgICAgICAvLyBJZiB0aGUgdGh1bWJuYWlsIFVSTHMgc3RhcnQgd2l0aCB3aXRoIG5vbmUgb2YgJy8nLCAnaHR0cDovLycgb3IgJ2h0dHBzOi8vJywgdGhlbiB3ZSBuZWVkIHRvIHNldCB0aGVpciByZWxhdGl2ZSBwYXRoIHRvIGJlIHRoZSBsb2NhdGlvbiBvZiB0aGUgVlRUIGZpbGVcbiAgICAgICAgaWYgKFxuICAgICAgICAgICF0aHVtYm5haWwuZnJhbWVzWzBdLnRleHQuc3RhcnRzV2l0aCgnLycpICYmXG4gICAgICAgICAgIXRodW1ibmFpbC5mcmFtZXNbMF0udGV4dC5zdGFydHNXaXRoKCdodHRwOi8vJykgJiZcbiAgICAgICAgICAhdGh1bWJuYWlsLmZyYW1lc1swXS50ZXh0LnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJylcbiAgICAgICAgKSB7XG4gICAgICAgICAgdGh1bWJuYWlsLnVybFByZWZpeCA9IHVybC5zdWJzdHJpbmcoMCwgdXJsLmxhc3RJbmRleE9mKCcvJykgKyAxKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIERvd25sb2FkIHRoZSBmaXJzdCBmcmFtZSwgc28gdGhhdCB3ZSBjYW4gZGV0ZXJtaW5lL3NldCB0aGUgaGVpZ2h0IG9mIHRoaXMgdGh1bWJuYWlsc0RlZlxuICAgICAgICBjb25zdCB0ZW1wSW1hZ2UgPSBuZXcgSW1hZ2UoKTtcblxuICAgICAgICB0ZW1wSW1hZ2Uub25sb2FkID0gKCkgPT4ge1xuICAgICAgICAgIHRodW1ibmFpbC5oZWlnaHQgPSB0ZW1wSW1hZ2UubmF0dXJhbEhlaWdodDtcbiAgICAgICAgICB0aHVtYm5haWwud2lkdGggPSB0ZW1wSW1hZ2UubmF0dXJhbFdpZHRoO1xuXG4gICAgICAgICAgdGhpcy50aHVtYm5haWxzLnB1c2godGh1bWJuYWlsKTtcblxuICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgfTtcblxuICAgICAgICB0ZW1wSW1hZ2Uuc3JjID0gdGh1bWJuYWlsLnVybFByZWZpeCArIHRodW1ibmFpbC5mcmFtZXNbMF0udGV4dDtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9O1xuXG4gIHN0YXJ0TW92ZSA9IChldmVudCkgPT4ge1xuICAgIGlmICghdGhpcy5sb2FkZWQpIHJldHVybjtcblxuICAgIGlmICghaXMuZXZlbnQoZXZlbnQpIHx8ICFbJ3RvdWNobW92ZScsICdtb3VzZW1vdmUnXS5pbmNsdWRlcyhldmVudC50eXBlKSkgcmV0dXJuO1xuXG4gICAgLy8gV2FpdCB1bnRpbCBtZWRpYSBoYXMgYSBkdXJhdGlvblxuICAgIGlmICghdGhpcy5wbGF5ZXIubWVkaWEuZHVyYXRpb24pIHJldHVybjtcblxuICAgIGlmIChldmVudC50eXBlID09PSAndG91Y2htb3ZlJykge1xuICAgICAgLy8gQ2FsY3VsYXRlIHNlZWsgaG92ZXIgcG9zaXRpb24gYXMgYXBwcm94IHZpZGVvIHNlY29uZHNcbiAgICAgIHRoaXMuc2Vla1RpbWUgPSB0aGlzLnBsYXllci5tZWRpYS5kdXJhdGlvbiAqICh0aGlzLnBsYXllci5lbGVtZW50cy5pbnB1dHMuc2Vlay52YWx1ZSAvIDEwMCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIENhbGN1bGF0ZSBzZWVrIGhvdmVyIHBvc2l0aW9uIGFzIGFwcHJveCB2aWRlbyBzZWNvbmRzXG4gICAgICBjb25zdCBjbGllbnRSZWN0ID0gdGhpcy5wbGF5ZXIuZWxlbWVudHMucHJvZ3Jlc3MuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICBjb25zdCBwZXJjZW50YWdlID0gKDEwMCAvIGNsaWVudFJlY3Qud2lkdGgpICogKGV2ZW50LnBhZ2VYIC0gY2xpZW50UmVjdC5sZWZ0KTtcbiAgICAgIHRoaXMuc2Vla1RpbWUgPSB0aGlzLnBsYXllci5tZWRpYS5kdXJhdGlvbiAqIChwZXJjZW50YWdlIC8gMTAwKTtcblxuICAgICAgaWYgKHRoaXMuc2Vla1RpbWUgPCAwKSB7XG4gICAgICAgIC8vIFRoZSBtb3VzZW1vdmUgZmlyZXMgZm9yIDEwK3B4IG91dCB0byB0aGUgbGVmdFxuICAgICAgICB0aGlzLnNlZWtUaW1lID0gMDtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMuc2Vla1RpbWUgPiB0aGlzLnBsYXllci5tZWRpYS5kdXJhdGlvbiAtIDEpIHtcbiAgICAgICAgLy8gVG9vayAxIHNlY29uZCBvZmYgdGhlIGR1cmF0aW9uIGZvciBzYWZldHksIGJlY2F1c2UgZGlmZmVyZW50IHBsYXllcnMgY2FuIGRpc2FncmVlIG9uIHRoZSByZWFsIGR1cmF0aW9uIG9mIGEgdmlkZW9cbiAgICAgICAgdGhpcy5zZWVrVGltZSA9IHRoaXMucGxheWVyLm1lZGlhLmR1cmF0aW9uIC0gMTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5tb3VzZVBvc1ggPSBldmVudC5wYWdlWDtcblxuICAgICAgLy8gU2V0IHRpbWUgdGV4dCBpbnNpZGUgaW1hZ2UgY29udGFpbmVyXG4gICAgICB0aGlzLmVsZW1lbnRzLnRodW1iLnRpbWUuaW5uZXJUZXh0ID0gZm9ybWF0VGltZSh0aGlzLnNlZWtUaW1lKTtcblxuICAgICAgLy8gR2V0IG1hcmtlciBwb2ludCBmb3IgdGltZVxuICAgICAgY29uc3QgcG9pbnQgPSB0aGlzLnBsYXllci5jb25maWcubWFya2Vycz8ucG9pbnRzPy5maW5kKCh7IHRpbWU6IHQgfSkgPT4gdCA9PT0gTWF0aC5yb3VuZCh0aGlzLnNlZWtUaW1lKSk7XG5cbiAgICAgIC8vIEFwcGVuZCB0aGUgcG9pbnQgbGFiZWwgdG8gdGhlIHRvb2x0aXBcbiAgICAgIGlmIChwb2ludCkge1xuICAgICAgICAvLyB0aGlzLmVsZW1lbnRzLnRodW1iLnRpbWUuaW5uZXJUZXh0LmNvbmNhdCgnXFxuJyk7XG4gICAgICAgIHRoaXMuZWxlbWVudHMudGh1bWIudGltZS5pbnNlcnRBZGphY2VudEhUTUwoJ2FmdGVyYmVnaW4nLCBgJHtwb2ludC5sYWJlbH08YnI+YCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gRG93bmxvYWQgYW5kIHNob3cgaW1hZ2VcbiAgICB0aGlzLnNob3dJbWFnZUF0Q3VycmVudFRpbWUoKTtcbiAgfTtcblxuICBlbmRNb3ZlID0gKCkgPT4ge1xuICAgIHRoaXMudG9nZ2xlVGh1bWJDb250YWluZXIoZmFsc2UsIHRydWUpO1xuICB9O1xuXG4gIHN0YXJ0U2NydWJiaW5nID0gKGV2ZW50KSA9PiB7XG4gICAgLy8gT25seSBhY3Qgb24gbGVmdCBtb3VzZSBidXR0b24gKDApLCBvciB0b3VjaCBkZXZpY2UgKGV2ZW50LmJ1dHRvbiBkb2VzIG5vdCBleGlzdCBvciBpcyBmYWxzZSlcbiAgICBpZiAoaXMubnVsbE9yVW5kZWZpbmVkKGV2ZW50LmJ1dHRvbikgfHwgZXZlbnQuYnV0dG9uID09PSBmYWxzZSB8fCBldmVudC5idXR0b24gPT09IDApIHtcbiAgICAgIHRoaXMubW91c2VEb3duID0gdHJ1ZTtcblxuICAgICAgLy8gV2FpdCB1bnRpbCBtZWRpYSBoYXMgYSBkdXJhdGlvblxuICAgICAgaWYgKHRoaXMucGxheWVyLm1lZGlhLmR1cmF0aW9uKSB7XG4gICAgICAgIHRoaXMudG9nZ2xlU2NydWJiaW5nQ29udGFpbmVyKHRydWUpO1xuICAgICAgICB0aGlzLnRvZ2dsZVRodW1iQ29udGFpbmVyKGZhbHNlLCB0cnVlKTtcblxuICAgICAgICAvLyBEb3dubG9hZCBhbmQgc2hvdyBpbWFnZVxuICAgICAgICB0aGlzLnNob3dJbWFnZUF0Q3VycmVudFRpbWUoKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgZW5kU2NydWJiaW5nID0gKCkgPT4ge1xuICAgIHRoaXMubW91c2VEb3duID0gZmFsc2U7XG5cbiAgICAvLyBIaWRlIHNjcnViYmluZyBwcmV2aWV3LiBCdXQgd2FpdCB1bnRpbCB0aGUgdmlkZW8gaGFzIHN1Y2Nlc3NmdWxseSBzZWVrZWQgYmVmb3JlIGhpZGluZyB0aGUgc2NydWJiaW5nIHByZXZpZXdcbiAgICBpZiAoTWF0aC5jZWlsKHRoaXMubGFzdFRpbWUpID09PSBNYXRoLmNlaWwodGhpcy5wbGF5ZXIubWVkaWEuY3VycmVudFRpbWUpKSB7XG4gICAgICAvLyBUaGUgdmlkZW8gd2FzIGFscmVhZHkgc2Vla2VkL2xvYWRlZCBhdCB0aGUgY2hvc2VuIHRpbWUgLSBoaWRlIGltbWVkaWF0ZWx5XG4gICAgICB0aGlzLnRvZ2dsZVNjcnViYmluZ0NvbnRhaW5lcihmYWxzZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIFRoZSB2aWRlbyBoYXNuJ3Qgc2Vla2VkIHlldC4gV2FpdCBmb3IgdGhhdFxuICAgICAgb25jZS5jYWxsKHRoaXMucGxheWVyLCB0aGlzLnBsYXllci5tZWRpYSwgJ3RpbWV1cGRhdGUnLCAoKSA9PiB7XG4gICAgICAgIC8vIFJlLWNoZWNrIG1vdXNlZG93biAtIHdlIG1pZ2h0IGhhdmUgYWxyZWFkeSBzdGFydGVkIHNjcnViYmluZyBhZ2FpblxuICAgICAgICBpZiAoIXRoaXMubW91c2VEb3duKSB7XG4gICAgICAgICAgdGhpcy50b2dnbGVTY3J1YmJpbmdDb250YWluZXIoZmFsc2UpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICAqIFNldHVwIGhvb2tzIGZvciBQbHlyIGFuZCB3aW5kb3cgZXZlbnRzXG4gICAqL1xuICBsaXN0ZW5lcnMgPSAoKSA9PiB7XG4gICAgLy8gSGlkZSB0aHVtYm5haWwgcHJldmlldyAtIG9uIG1vdXNlIGNsaWNrLCBtb3VzZSBsZWF2ZSAoaW4gbGlzdGVuZXJzLmpzIGZvciBub3cpLCBhbmQgdmlkZW8gcGxheS9zZWVrLiBBbGwgZm91ciBhcmUgcmVxdWlyZWQsIGUuZy4sIGZvciBidWZmZXJpbmdcbiAgICB0aGlzLnBsYXllci5vbigncGxheScsICgpID0+IHtcbiAgICAgIHRoaXMudG9nZ2xlVGh1bWJDb250YWluZXIoZmFsc2UsIHRydWUpO1xuICAgIH0pO1xuXG4gICAgdGhpcy5wbGF5ZXIub24oJ3NlZWtlZCcsICgpID0+IHtcbiAgICAgIHRoaXMudG9nZ2xlVGh1bWJDb250YWluZXIoZmFsc2UpO1xuICAgIH0pO1xuXG4gICAgdGhpcy5wbGF5ZXIub24oJ3RpbWV1cGRhdGUnLCAoKSA9PiB7XG4gICAgICB0aGlzLmxhc3RUaW1lID0gdGhpcy5wbGF5ZXIubWVkaWEuY3VycmVudFRpbWU7XG4gICAgfSk7XG4gIH07XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBIVE1MIGVsZW1lbnRzIGZvciBpbWFnZSBjb250YWluZXJzXG4gICAqL1xuICByZW5kZXIgPSAoKSA9PiB7XG4gICAgLy8gQ3JlYXRlIEhUTUwgZWxlbWVudDogcGx5cl9fcHJldmlldy10aHVtYm5haWwtY29udGFpbmVyXG4gICAgdGhpcy5lbGVtZW50cy50aHVtYi5jb250YWluZXIgPSBjcmVhdGVFbGVtZW50KCdkaXYnLCB7XG4gICAgICBjbGFzczogdGhpcy5wbGF5ZXIuY29uZmlnLmNsYXNzTmFtZXMucHJldmlld1RodW1ibmFpbHMudGh1bWJDb250YWluZXIsXG4gICAgfSk7XG5cbiAgICAvLyBXcmFwcGVyIGZvciB0aGUgaW1hZ2UgZm9yIHN0eWxpbmdcbiAgICB0aGlzLmVsZW1lbnRzLnRodW1iLmltYWdlQ29udGFpbmVyID0gY3JlYXRlRWxlbWVudCgnZGl2Jywge1xuICAgICAgY2xhc3M6IHRoaXMucGxheWVyLmNvbmZpZy5jbGFzc05hbWVzLnByZXZpZXdUaHVtYm5haWxzLmltYWdlQ29udGFpbmVyLFxuICAgIH0pO1xuICAgIHRoaXMuZWxlbWVudHMudGh1bWIuY29udGFpbmVyLmFwcGVuZENoaWxkKHRoaXMuZWxlbWVudHMudGh1bWIuaW1hZ2VDb250YWluZXIpO1xuXG4gICAgLy8gQ3JlYXRlIEhUTUwgZWxlbWVudCwgcGFyZW50K3NwYW46IHRpbWUgdGV4dCAoZS5nLiwgMDE6MzI6MDApXG4gICAgY29uc3QgdGltZUNvbnRhaW5lciA9IGNyZWF0ZUVsZW1lbnQoJ2RpdicsIHtcbiAgICAgIGNsYXNzOiB0aGlzLnBsYXllci5jb25maWcuY2xhc3NOYW1lcy5wcmV2aWV3VGh1bWJuYWlscy50aW1lQ29udGFpbmVyLFxuICAgIH0pO1xuXG4gICAgdGhpcy5lbGVtZW50cy50aHVtYi50aW1lID0gY3JlYXRlRWxlbWVudCgnc3BhbicsIHt9LCAnMDA6MDAnKTtcbiAgICB0aW1lQ29udGFpbmVyLmFwcGVuZENoaWxkKHRoaXMuZWxlbWVudHMudGh1bWIudGltZSk7XG5cbiAgICB0aGlzLmVsZW1lbnRzLnRodW1iLmltYWdlQ29udGFpbmVyLmFwcGVuZENoaWxkKHRpbWVDb250YWluZXIpO1xuXG4gICAgLy8gSW5qZWN0IHRoZSB3aG9sZSB0aHVtYlxuICAgIGlmIChpcy5lbGVtZW50KHRoaXMucGxheWVyLmVsZW1lbnRzLnByb2dyZXNzKSkge1xuICAgICAgdGhpcy5wbGF5ZXIuZWxlbWVudHMucHJvZ3Jlc3MuYXBwZW5kQ2hpbGQodGhpcy5lbGVtZW50cy50aHVtYi5jb250YWluZXIpO1xuICAgIH1cblxuICAgIC8vIENyZWF0ZSBIVE1MIGVsZW1lbnQ6IHBseXJfX3ByZXZpZXctc2NydWJiaW5nLWNvbnRhaW5lclxuICAgIHRoaXMuZWxlbWVudHMuc2NydWJiaW5nLmNvbnRhaW5lciA9IGNyZWF0ZUVsZW1lbnQoJ2RpdicsIHtcbiAgICAgIGNsYXNzOiB0aGlzLnBsYXllci5jb25maWcuY2xhc3NOYW1lcy5wcmV2aWV3VGh1bWJuYWlscy5zY3J1YmJpbmdDb250YWluZXIsXG4gICAgfSk7XG5cbiAgICB0aGlzLnBsYXllci5lbGVtZW50cy53cmFwcGVyLmFwcGVuZENoaWxkKHRoaXMuZWxlbWVudHMuc2NydWJiaW5nLmNvbnRhaW5lcik7XG4gIH07XG5cbiAgZGVzdHJveSA9ICgpID0+IHtcbiAgICBpZiAodGhpcy5lbGVtZW50cy50aHVtYi5jb250YWluZXIpIHtcbiAgICAgIHRoaXMuZWxlbWVudHMudGh1bWIuY29udGFpbmVyLnJlbW92ZSgpO1xuICAgIH1cbiAgICBpZiAodGhpcy5lbGVtZW50cy5zY3J1YmJpbmcuY29udGFpbmVyKSB7XG4gICAgICB0aGlzLmVsZW1lbnRzLnNjcnViYmluZy5jb250YWluZXIucmVtb3ZlKCk7XG4gICAgfVxuICB9O1xuXG4gIHNob3dJbWFnZUF0Q3VycmVudFRpbWUgPSAoKSA9PiB7XG4gICAgaWYgKHRoaXMubW91c2VEb3duKSB7XG4gICAgICB0aGlzLnNldFNjcnViYmluZ0NvbnRhaW5lclNpemUoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zZXRUaHVtYkNvbnRhaW5lclNpemVBbmRQb3MoKTtcbiAgICB9XG5cbiAgICAvLyBGaW5kIHRoZSBkZXNpcmVkIHRodW1ibmFpbCBpbmRleFxuICAgIC8vIFRPRE86IEhhbmRsZSBhIHZpZGVvIGxvbmdlciB0aGFuIHRoZSB0aHVtYnMgd2hlcmUgdGh1bWJOdW0gaXMgbnVsbFxuICAgIGNvbnN0IHRodW1iTnVtID0gdGhpcy50aHVtYm5haWxzWzBdLmZyYW1lcy5maW5kSW5kZXgoXG4gICAgICAoZnJhbWUpID0+IHRoaXMuc2Vla1RpbWUgPj0gZnJhbWUuc3RhcnRUaW1lICYmIHRoaXMuc2Vla1RpbWUgPD0gZnJhbWUuZW5kVGltZSxcbiAgICApO1xuICAgIGNvbnN0IGhhc1RodW1iID0gdGh1bWJOdW0gPj0gMDtcbiAgICBsZXQgcXVhbGl0eUluZGV4ID0gMDtcblxuICAgIC8vIFNob3cgdGhlIHRodW1iIGNvbnRhaW5lciBpZiB3ZSdyZSBub3Qgc2NydWJiaW5nXG4gICAgaWYgKCF0aGlzLm1vdXNlRG93bikge1xuICAgICAgdGhpcy50b2dnbGVUaHVtYkNvbnRhaW5lcihoYXNUaHVtYik7XG4gICAgfVxuXG4gICAgLy8gTm8gbWF0Y2hpbmcgdGh1bWIgZm91bmRcbiAgICBpZiAoIWhhc1RodW1iKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgdG8gc2VlIGlmIHdlJ3ZlIGFscmVhZHkgZG93bmxvYWRlZCBoaWdoZXIgcXVhbGl0eSB2ZXJzaW9ucyBvZiB0aGlzIGltYWdlXG4gICAgdGhpcy50aHVtYm5haWxzLmZvckVhY2goKHRodW1ibmFpbCwgaW5kZXgpID0+IHtcbiAgICAgIGlmICh0aGlzLmxvYWRlZEltYWdlcy5pbmNsdWRlcyh0aHVtYm5haWwuZnJhbWVzW3RodW1iTnVtXS50ZXh0KSkge1xuICAgICAgICBxdWFsaXR5SW5kZXggPSBpbmRleDtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIE9ubHkgcHJvY2VlZCBpZiBlaXRoZXIgdGh1bWIgbnVtIG9yIHRodW1iZmlsZW5hbWUgaGFzIGNoYW5nZWRcbiAgICBpZiAodGh1bWJOdW0gIT09IHRoaXMuc2hvd2luZ1RodW1iKSB7XG4gICAgICB0aGlzLnNob3dpbmdUaHVtYiA9IHRodW1iTnVtO1xuICAgICAgdGhpcy5sb2FkSW1hZ2UocXVhbGl0eUluZGV4KTtcbiAgICB9XG4gIH07XG5cbiAgLy8gU2hvdyB0aGUgaW1hZ2UgdGhhdCdzIGN1cnJlbnRseSBzcGVjaWZpZWQgaW4gdGhpcy5zaG93aW5nVGh1bWJcbiAgbG9hZEltYWdlID0gKHF1YWxpdHlJbmRleCA9IDApID0+IHtcbiAgICBjb25zdCB0aHVtYk51bSA9IHRoaXMuc2hvd2luZ1RodW1iO1xuICAgIGNvbnN0IHRodW1ibmFpbCA9IHRoaXMudGh1bWJuYWlsc1txdWFsaXR5SW5kZXhdO1xuICAgIGNvbnN0IHsgdXJsUHJlZml4IH0gPSB0aHVtYm5haWw7XG4gICAgY29uc3QgZnJhbWUgPSB0aHVtYm5haWwuZnJhbWVzW3RodW1iTnVtXTtcbiAgICBjb25zdCB0aHVtYkZpbGVuYW1lID0gdGh1bWJuYWlsLmZyYW1lc1t0aHVtYk51bV0udGV4dDtcbiAgICBjb25zdCB0aHVtYlVybCA9IHVybFByZWZpeCArIHRodW1iRmlsZW5hbWU7XG5cbiAgICBpZiAoIXRoaXMuY3VycmVudEltYWdlRWxlbWVudCB8fCB0aGlzLmN1cnJlbnRJbWFnZUVsZW1lbnQuZGF0YXNldC5maWxlbmFtZSAhPT0gdGh1bWJGaWxlbmFtZSkge1xuICAgICAgLy8gSWYgd2UncmUgYWxyZWFkeSBsb2FkaW5nIGEgcHJldmlvdXMgaW1hZ2UsIHJlbW92ZSBpdHMgb25sb2FkIGhhbmRsZXIgLSB3ZSBkb24ndCB3YW50IGl0IHRvIGxvYWQgYWZ0ZXIgdGhpcyBvbmVcbiAgICAgIC8vIE9ubHkgZG8gdGhpcyBpZiBub3QgdXNpbmcgc3ByaXRlcy4gV2l0aG91dCBzcHJpdGVzIHdlIHJlYWxseSB3YW50IHRvIHNob3cgYXMgbWFueSBpbWFnZXMgYXMgcG9zc2libGUsIGFzIGEgYmVzdC1lZmZvcnRcbiAgICAgIGlmICh0aGlzLmxvYWRpbmdJbWFnZSAmJiB0aGlzLnVzaW5nU3ByaXRlcykge1xuICAgICAgICB0aGlzLmxvYWRpbmdJbWFnZS5vbmxvYWQgPSBudWxsO1xuICAgICAgfVxuXG4gICAgICAvLyBXZSdyZSBidWlsZGluZyBhbmQgYWRkaW5nIGEgbmV3IGltYWdlLiBJbiBvdGhlciBpbXBsZW1lbnRhdGlvbnMgb2Ygc2ltaWxhciBmdW5jdGlvbmFsaXR5IChZb3VUdWJlKSwgYmFja2dyb3VuZCBpbWFnZVxuICAgICAgLy8gaXMgaW5zdGVhZCB1c2VkLiBCdXQgdGhpcyBjYXVzZXMgaXNzdWVzIHdpdGggbGFyZ2VyIGltYWdlcyBpbiBGaXJlZm94IGFuZCBTYWZhcmkgLSBzd2l0Y2hpbmcgYmV0d2VlbiBiYWNrZ3JvdW5kXG4gICAgICAvLyBpbWFnZXMgY2F1c2VzIGEgZmxpY2tlci4gUHV0dGluZyBhIG5ldyBpbWFnZSBvdmVyIHRoZSB0b3AgZG9lcyBub3RcbiAgICAgIGNvbnN0IHByZXZpZXdJbWFnZSA9IG5ldyBJbWFnZSgpO1xuICAgICAgcHJldmlld0ltYWdlLnNyYyA9IHRodW1iVXJsO1xuICAgICAgcHJldmlld0ltYWdlLmRhdGFzZXQuaW5kZXggPSB0aHVtYk51bTtcbiAgICAgIHByZXZpZXdJbWFnZS5kYXRhc2V0LmZpbGVuYW1lID0gdGh1bWJGaWxlbmFtZTtcbiAgICAgIHRoaXMuc2hvd2luZ1RodW1iRmlsZW5hbWUgPSB0aHVtYkZpbGVuYW1lO1xuXG4gICAgICB0aGlzLnBsYXllci5kZWJ1Zy5sb2coYExvYWRpbmcgaW1hZ2U6ICR7dGh1bWJVcmx9YCk7XG5cbiAgICAgIC8vIEZvciBzb21lIHJlYXNvbiwgcGFzc2luZyB0aGUgbmFtZWQgZnVuY3Rpb24gZGlyZWN0bHkgY2F1c2VzIGl0IHRvIGV4ZWN1dGUgaW1tZWRpYXRlbHkuIFNvIEkndmUgd3JhcHBlZCBpdCBpbiBhbiBhbm9ueW1vdXMgZnVuY3Rpb24uLi5cbiAgICAgIHByZXZpZXdJbWFnZS5vbmxvYWQgPSAoKSA9PiB0aGlzLnNob3dJbWFnZShwcmV2aWV3SW1hZ2UsIGZyYW1lLCBxdWFsaXR5SW5kZXgsIHRodW1iTnVtLCB0aHVtYkZpbGVuYW1lLCB0cnVlKTtcbiAgICAgIHRoaXMubG9hZGluZ0ltYWdlID0gcHJldmlld0ltYWdlO1xuICAgICAgdGhpcy5yZW1vdmVPbGRJbWFnZXMocHJldmlld0ltYWdlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gVXBkYXRlIHRoZSBleGlzdGluZyBpbWFnZVxuICAgICAgdGhpcy5zaG93SW1hZ2UodGhpcy5jdXJyZW50SW1hZ2VFbGVtZW50LCBmcmFtZSwgcXVhbGl0eUluZGV4LCB0aHVtYk51bSwgdGh1bWJGaWxlbmFtZSwgZmFsc2UpO1xuICAgICAgdGhpcy5jdXJyZW50SW1hZ2VFbGVtZW50LmRhdGFzZXQuaW5kZXggPSB0aHVtYk51bTtcbiAgICAgIHRoaXMucmVtb3ZlT2xkSW1hZ2VzKHRoaXMuY3VycmVudEltYWdlRWxlbWVudCk7XG4gICAgfVxuICB9O1xuXG4gIHNob3dJbWFnZSA9IChwcmV2aWV3SW1hZ2UsIGZyYW1lLCBxdWFsaXR5SW5kZXgsIHRodW1iTnVtLCB0aHVtYkZpbGVuYW1lLCBuZXdJbWFnZSA9IHRydWUpID0+IHtcbiAgICB0aGlzLnBsYXllci5kZWJ1Zy5sb2coXG4gICAgICBgU2hvd2luZyB0aHVtYjogJHt0aHVtYkZpbGVuYW1lfS4gbnVtOiAke3RodW1iTnVtfS4gcXVhbDogJHtxdWFsaXR5SW5kZXh9LiBuZXdpbWc6ICR7bmV3SW1hZ2V9YCxcbiAgICApO1xuICAgIHRoaXMuc2V0SW1hZ2VTaXplQW5kT2Zmc2V0KHByZXZpZXdJbWFnZSwgZnJhbWUpO1xuXG4gICAgaWYgKG5ld0ltYWdlKSB7XG4gICAgICB0aGlzLmN1cnJlbnRJbWFnZUNvbnRhaW5lci5hcHBlbmRDaGlsZChwcmV2aWV3SW1hZ2UpO1xuICAgICAgdGhpcy5jdXJyZW50SW1hZ2VFbGVtZW50ID0gcHJldmlld0ltYWdlO1xuXG4gICAgICBpZiAoIXRoaXMubG9hZGVkSW1hZ2VzLmluY2x1ZGVzKHRodW1iRmlsZW5hbWUpKSB7XG4gICAgICAgIHRoaXMubG9hZGVkSW1hZ2VzLnB1c2godGh1bWJGaWxlbmFtZSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gUHJlbG9hZCBpbWFnZXMgYmVmb3JlIGFuZCBhZnRlciB0aGUgY3VycmVudCBvbmVcbiAgICAvLyBTaG93IGhpZ2hlciBxdWFsaXR5IG9mIHRoZSBzYW1lIGZyYW1lXG4gICAgLy8gRWFjaCBzdGVwIGhlcmUgaGFzIGEgc2hvcnQgdGltZSBkZWxheSwgYW5kIG9ubHkgY29udGludWVzIGlmIHN0aWxsIGhvdmVyaW5nL3NlZWtpbmcgdGhlIHNhbWUgc3BvdC4gVGhpcyBpcyB0byBwcm90ZWN0IHNsb3cgY29ubmVjdGlvbnMgZnJvbSBvdmVybG9hZGluZ1xuICAgIHRoaXMucHJlbG9hZE5lYXJieSh0aHVtYk51bSwgdHJ1ZSlcbiAgICAgIC50aGVuKHRoaXMucHJlbG9hZE5lYXJieSh0aHVtYk51bSwgZmFsc2UpKVxuICAgICAgLnRoZW4odGhpcy5nZXRIaWdoZXJRdWFsaXR5KHF1YWxpdHlJbmRleCwgcHJldmlld0ltYWdlLCBmcmFtZSwgdGh1bWJGaWxlbmFtZSkpO1xuICB9O1xuXG4gIC8vIFJlbW92ZSBhbGwgcHJldmlldyBpbWFnZXMgdGhhdCBhcmVuJ3QgdGhlIGRlc2lnbmF0ZWQgY3VycmVudCBpbWFnZVxuICByZW1vdmVPbGRJbWFnZXMgPSAoY3VycmVudEltYWdlKSA9PiB7XG4gICAgLy8gR2V0IGEgbGlzdCBvZiBhbGwgaW1hZ2VzLCBjb252ZXJ0IGl0IGZyb20gYSBET00gbGlzdCB0byBhbiBhcnJheVxuICAgIEFycmF5LmZyb20odGhpcy5jdXJyZW50SW1hZ2VDb250YWluZXIuY2hpbGRyZW4pLmZvckVhY2goKGltYWdlKSA9PiB7XG4gICAgICBpZiAoaW1hZ2UudGFnTmFtZS50b0xvd2VyQ2FzZSgpICE9PSAnaW1nJykge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJlbW92ZURlbGF5ID0gdGhpcy51c2luZ1Nwcml0ZXMgPyA1MDAgOiAxMDAwO1xuXG4gICAgICBpZiAoaW1hZ2UuZGF0YXNldC5pbmRleCAhPT0gY3VycmVudEltYWdlLmRhdGFzZXQuaW5kZXggJiYgIWltYWdlLmRhdGFzZXQuZGVsZXRpbmcpIHtcbiAgICAgICAgLy8gV2FpdCAyMDBtcywgYXMgdGhlIG5ldyBpbWFnZSBjYW4gdGFrZSBzb21lIHRpbWUgdG8gc2hvdyBvbiBjZXJ0YWluIGJyb3dzZXJzIChldmVuIHRob3VnaCBpdCB3YXMgZG93bmxvYWRlZCBiZWZvcmUgc2hvd2luZykuIFRoaXMgd2lsbCBwcmV2ZW50IGZsaWNrZXIsIGFuZCBzaG93IHNvbWUgZ2VuZXJvc2l0eSB0b3dhcmRzIHNsb3dlciBjbGllbnRzXG4gICAgICAgIC8vIEZpcnN0IHNldCBhdHRyaWJ1dGUgJ2RlbGV0aW5nJyB0byBwcmV2ZW50IG11bHRpLWhhbmRsaW5nIG9mIHRoaXMgb24gcmVwZWF0IGZpcmluZyBvZiB0aGlzIGZ1bmN0aW9uXG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1wYXJhbS1yZWFzc2lnblxuICAgICAgICBpbWFnZS5kYXRhc2V0LmRlbGV0aW5nID0gdHJ1ZTtcblxuICAgICAgICAvLyBUaGlzIGhhcyB0byBiZSBzZXQgYmVmb3JlIHRoZSB0aW1lb3V0IC0gdG8gcHJldmVudCBpc3N1ZXMgc3dpdGNoaW5nIGJldHdlZW4gaG92ZXIgYW5kIHNjcnViXG4gICAgICAgIGNvbnN0IHsgY3VycmVudEltYWdlQ29udGFpbmVyIH0gPSB0aGlzO1xuXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgIGN1cnJlbnRJbWFnZUNvbnRhaW5lci5yZW1vdmVDaGlsZChpbWFnZSk7XG4gICAgICAgICAgdGhpcy5wbGF5ZXIuZGVidWcubG9nKGBSZW1vdmluZyB0aHVtYjogJHtpbWFnZS5kYXRhc2V0LmZpbGVuYW1lfWApO1xuICAgICAgICB9LCByZW1vdmVEZWxheSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH07XG5cbiAgLy8gUHJlbG9hZCBpbWFnZXMgYmVmb3JlIGFuZCBhZnRlciB0aGUgY3VycmVudCBvbmUuIE9ubHkgaWYgdGhlIHVzZXIgaXMgc3RpbGwgaG92ZXJpbmcvc2Vla2luZyB0aGUgc2FtZSBmcmFtZVxuICAvLyBUaGlzIHdpbGwgb25seSBwcmVsb2FkIHRoZSBsb3dlc3QgcXVhbGl0eVxuICBwcmVsb2FkTmVhcmJ5ID0gKHRodW1iTnVtLCBmb3J3YXJkID0gdHJ1ZSkgPT4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIGNvbnN0IG9sZFRodW1iRmlsZW5hbWUgPSB0aGlzLnRodW1ibmFpbHNbMF0uZnJhbWVzW3RodW1iTnVtXS50ZXh0O1xuXG4gICAgICAgIGlmICh0aGlzLnNob3dpbmdUaHVtYkZpbGVuYW1lID09PSBvbGRUaHVtYkZpbGVuYW1lKSB7XG4gICAgICAgICAgLy8gRmluZCB0aGUgbmVhcmVzdCB0aHVtYnMgd2l0aCBkaWZmZXJlbnQgZmlsZW5hbWVzLiBTb21ldGltZXMgaXQnbGwgYmUgdGhlIG5leHQgaW5kZXgsIGJ1dCBpbiB0aGUgY2FzZSBvZiBzcHJpdGVzLCBpdCBtaWdodCBiZSAxMDArIGF3YXlcbiAgICAgICAgICBsZXQgdGh1bWJuYWlsc0Nsb25lO1xuICAgICAgICAgIGlmIChmb3J3YXJkKSB7XG4gICAgICAgICAgICB0aHVtYm5haWxzQ2xvbmUgPSB0aGlzLnRodW1ibmFpbHNbMF0uZnJhbWVzLnNsaWNlKHRodW1iTnVtKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGh1bWJuYWlsc0Nsb25lID0gdGhpcy50aHVtYm5haWxzWzBdLmZyYW1lcy5zbGljZSgwLCB0aHVtYk51bSkucmV2ZXJzZSgpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGxldCBmb3VuZE9uZSA9IGZhbHNlO1xuXG4gICAgICAgICAgdGh1bWJuYWlsc0Nsb25lLmZvckVhY2goKGZyYW1lKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBuZXdUaHVtYkZpbGVuYW1lID0gZnJhbWUudGV4dDtcblxuICAgICAgICAgICAgaWYgKG5ld1RodW1iRmlsZW5hbWUgIT09IG9sZFRodW1iRmlsZW5hbWUpIHtcbiAgICAgICAgICAgICAgLy8gRm91bmQgb25lIHdpdGggYSBkaWZmZXJlbnQgZmlsZW5hbWUuIE1ha2Ugc3VyZSBpdCBoYXNuJ3QgYWxyZWFkeSBiZWVuIGxvYWRlZCBvbiB0aGlzIHBhZ2UgdmlzaXRcbiAgICAgICAgICAgICAgaWYgKCF0aGlzLmxvYWRlZEltYWdlcy5pbmNsdWRlcyhuZXdUaHVtYkZpbGVuYW1lKSkge1xuICAgICAgICAgICAgICAgIGZvdW5kT25lID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLnBsYXllci5kZWJ1Zy5sb2coYFByZWxvYWRpbmcgdGh1bWIgZmlsZW5hbWU6ICR7bmV3VGh1bWJGaWxlbmFtZX1gKTtcblxuICAgICAgICAgICAgICAgIGNvbnN0IHsgdXJsUHJlZml4IH0gPSB0aGlzLnRodW1ibmFpbHNbMF07XG4gICAgICAgICAgICAgICAgY29uc3QgdGh1bWJVUkwgPSB1cmxQcmVmaXggKyBuZXdUaHVtYkZpbGVuYW1lO1xuICAgICAgICAgICAgICAgIGNvbnN0IHByZXZpZXdJbWFnZSA9IG5ldyBJbWFnZSgpO1xuICAgICAgICAgICAgICAgIHByZXZpZXdJbWFnZS5zcmMgPSB0aHVtYlVSTDtcbiAgICAgICAgICAgICAgICBwcmV2aWV3SW1hZ2Uub25sb2FkID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5ZXIuZGVidWcubG9nKGBQcmVsb2FkZWQgdGh1bWIgZmlsZW5hbWU6ICR7bmV3VGh1bWJGaWxlbmFtZX1gKTtcbiAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5sb2FkZWRJbWFnZXMuaW5jbHVkZXMobmV3VGh1bWJGaWxlbmFtZSkpIHRoaXMubG9hZGVkSW1hZ2VzLnB1c2gobmV3VGh1bWJGaWxlbmFtZSk7XG5cbiAgICAgICAgICAgICAgICAgIC8vIFdlIGRvbid0IHJlc29sdmUgdW50aWwgdGhlIHRodW1iIGlzIGxvYWRlZFxuICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIC8vIElmIHRoZXJlIGFyZSBub25lIHRvIHByZWxvYWQgdGhlbiB3ZSB3YW50IHRvIHJlc29sdmUgaW1tZWRpYXRlbHlcbiAgICAgICAgICBpZiAoIWZvdW5kT25lKSB7XG4gICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9LCAzMDApO1xuICAgIH0pO1xuICB9O1xuXG4gIC8vIElmIHVzZXIgaGFzIGJlZW4gaG92ZXJpbmcgY3VycmVudCBpbWFnZSBmb3IgaGFsZiBhIHNlY29uZCwgbG9vayBmb3IgYSBoaWdoZXIgcXVhbGl0eSBvbmVcbiAgZ2V0SGlnaGVyUXVhbGl0eSA9IChjdXJyZW50UXVhbGl0eUluZGV4LCBwcmV2aWV3SW1hZ2UsIGZyYW1lLCB0aHVtYkZpbGVuYW1lKSA9PiB7XG4gICAgaWYgKGN1cnJlbnRRdWFsaXR5SW5kZXggPCB0aGlzLnRodW1ibmFpbHMubGVuZ3RoIC0gMSkge1xuICAgICAgLy8gT25seSB1c2UgdGhlIGhpZ2hlciBxdWFsaXR5IHZlcnNpb24gaWYgaXQncyBnb2luZyB0byBsb29rIGFueSBiZXR0ZXIgLSBpZiB0aGUgY3VycmVudCB0aHVtYiBpcyBvZiBhIGxvd2VyIHBpeGVsIGRlbnNpdHkgdGhhbiB0aGUgdGh1bWJuYWlsIGNvbnRhaW5lclxuICAgICAgbGV0IHByZXZpZXdJbWFnZUhlaWdodCA9IHByZXZpZXdJbWFnZS5uYXR1cmFsSGVpZ2h0O1xuXG4gICAgICBpZiAodGhpcy51c2luZ1Nwcml0ZXMpIHtcbiAgICAgICAgcHJldmlld0ltYWdlSGVpZ2h0ID0gZnJhbWUuaDtcbiAgICAgIH1cblxuICAgICAgaWYgKHByZXZpZXdJbWFnZUhlaWdodCA8IHRoaXMudGh1bWJDb250YWluZXJIZWlnaHQpIHtcbiAgICAgICAgLy8gUmVjdXJzZSBiYWNrIHRvIHRoZSBsb2FkSW1hZ2UgZnVuY3Rpb24gLSBzaG93IGEgaGlnaGVyIHF1YWxpdHkgb25lLCBidXQgb25seSBpZiB0aGUgdmlld2VyIGlzIG9uIHRoaXMgZnJhbWUgZm9yIGEgd2hpbGVcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgLy8gTWFrZSBzdXJlIHRoZSBtb3VzZSBoYXNuJ3QgYWxyZWFkeSBtb3ZlZCBvbiBhbmQgc3RhcnRlZCBob3ZlcmluZyBhdCBhbm90aGVyIGltYWdlXG4gICAgICAgICAgaWYgKHRoaXMuc2hvd2luZ1RodW1iRmlsZW5hbWUgPT09IHRodW1iRmlsZW5hbWUpIHtcbiAgICAgICAgICAgIHRoaXMucGxheWVyLmRlYnVnLmxvZyhgU2hvd2luZyBoaWdoZXIgcXVhbGl0eSB0aHVtYiBmb3I6ICR7dGh1bWJGaWxlbmFtZX1gKTtcbiAgICAgICAgICAgIHRoaXMubG9hZEltYWdlKGN1cnJlbnRRdWFsaXR5SW5kZXggKyAxKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sIDMwMCk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIGdldCBjdXJyZW50SW1hZ2VDb250YWluZXIoKSB7XG4gICAgcmV0dXJuIHRoaXMubW91c2VEb3duID8gdGhpcy5lbGVtZW50cy5zY3J1YmJpbmcuY29udGFpbmVyIDogdGhpcy5lbGVtZW50cy50aHVtYi5pbWFnZUNvbnRhaW5lcjtcbiAgfVxuXG4gIGdldCB1c2luZ1Nwcml0ZXMoKSB7XG4gICAgcmV0dXJuIE9iamVjdC5rZXlzKHRoaXMudGh1bWJuYWlsc1swXS5mcmFtZXNbMF0pLmluY2x1ZGVzKCd3Jyk7XG4gIH1cblxuICBnZXQgdGh1bWJBc3BlY3RSYXRpbygpIHtcbiAgICBpZiAodGhpcy51c2luZ1Nwcml0ZXMpIHtcbiAgICAgIHJldHVybiB0aGlzLnRodW1ibmFpbHNbMF0uZnJhbWVzWzBdLncgLyB0aGlzLnRodW1ibmFpbHNbMF0uZnJhbWVzWzBdLmg7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMudGh1bWJuYWlsc1swXS53aWR0aCAvIHRoaXMudGh1bWJuYWlsc1swXS5oZWlnaHQ7XG4gIH1cblxuICBnZXQgdGh1bWJDb250YWluZXJIZWlnaHQoKSB7XG4gICAgaWYgKHRoaXMubW91c2VEb3duKSB7XG4gICAgICBjb25zdCB7IGhlaWdodCB9ID0gZml0UmF0aW8odGhpcy50aHVtYkFzcGVjdFJhdGlvLCB7XG4gICAgICAgIHdpZHRoOiB0aGlzLnBsYXllci5tZWRpYS5jbGllbnRXaWR0aCxcbiAgICAgICAgaGVpZ2h0OiB0aGlzLnBsYXllci5tZWRpYS5jbGllbnRIZWlnaHQsXG4gICAgICB9KTtcbiAgICAgIHJldHVybiBoZWlnaHQ7XG4gICAgfVxuXG4gICAgLy8gSWYgY3NzIGlzIHVzZWQgdGhpcyBuZWVkcyB0byByZXR1cm4gdGhlIGNzcyBoZWlnaHQgZm9yIHNwcml0ZXMgdG8gd29yayAoc2VlIHNldEltYWdlU2l6ZUFuZE9mZnNldClcbiAgICBpZiAodGhpcy5zaXplU3BlY2lmaWVkSW5DU1MpIHtcbiAgICAgIHJldHVybiB0aGlzLmVsZW1lbnRzLnRodW1iLmltYWdlQ29udGFpbmVyLmNsaWVudEhlaWdodDtcbiAgICB9XG5cbiAgICByZXR1cm4gTWF0aC5mbG9vcih0aGlzLnBsYXllci5tZWRpYS5jbGllbnRXaWR0aCAvIHRoaXMudGh1bWJBc3BlY3RSYXRpbyAvIDQpO1xuICB9XG5cbiAgZ2V0IGN1cnJlbnRJbWFnZUVsZW1lbnQoKSB7XG4gICAgcmV0dXJuIHRoaXMubW91c2VEb3duID8gdGhpcy5jdXJyZW50U2NydWJiaW5nSW1hZ2VFbGVtZW50IDogdGhpcy5jdXJyZW50VGh1bWJuYWlsSW1hZ2VFbGVtZW50O1xuICB9XG5cbiAgc2V0IGN1cnJlbnRJbWFnZUVsZW1lbnQoZWxlbWVudCkge1xuICAgIGlmICh0aGlzLm1vdXNlRG93bikge1xuICAgICAgdGhpcy5jdXJyZW50U2NydWJiaW5nSW1hZ2VFbGVtZW50ID0gZWxlbWVudDtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5jdXJyZW50VGh1bWJuYWlsSW1hZ2VFbGVtZW50ID0gZWxlbWVudDtcbiAgICB9XG4gIH1cblxuICB0b2dnbGVUaHVtYkNvbnRhaW5lciA9ICh0b2dnbGUgPSBmYWxzZSwgY2xlYXJTaG93aW5nID0gZmFsc2UpID0+IHtcbiAgICBjb25zdCBjbGFzc05hbWUgPSB0aGlzLnBsYXllci5jb25maWcuY2xhc3NOYW1lcy5wcmV2aWV3VGh1bWJuYWlscy50aHVtYkNvbnRhaW5lclNob3duO1xuICAgIHRoaXMuZWxlbWVudHMudGh1bWIuY29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoY2xhc3NOYW1lLCB0b2dnbGUpO1xuXG4gICAgaWYgKCF0b2dnbGUgJiYgY2xlYXJTaG93aW5nKSB7XG4gICAgICB0aGlzLnNob3dpbmdUaHVtYiA9IG51bGw7XG4gICAgICB0aGlzLnNob3dpbmdUaHVtYkZpbGVuYW1lID0gbnVsbDtcbiAgICB9XG4gIH07XG5cbiAgdG9nZ2xlU2NydWJiaW5nQ29udGFpbmVyID0gKHRvZ2dsZSA9IGZhbHNlKSA9PiB7XG4gICAgY29uc3QgY2xhc3NOYW1lID0gdGhpcy5wbGF5ZXIuY29uZmlnLmNsYXNzTmFtZXMucHJldmlld1RodW1ibmFpbHMuc2NydWJiaW5nQ29udGFpbmVyU2hvd247XG4gICAgdGhpcy5lbGVtZW50cy5zY3J1YmJpbmcuY29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoY2xhc3NOYW1lLCB0b2dnbGUpO1xuXG4gICAgaWYgKCF0b2dnbGUpIHtcbiAgICAgIHRoaXMuc2hvd2luZ1RodW1iID0gbnVsbDtcbiAgICAgIHRoaXMuc2hvd2luZ1RodW1iRmlsZW5hbWUgPSBudWxsO1xuICAgIH1cbiAgfTtcblxuICBkZXRlcm1pbmVDb250YWluZXJBdXRvU2l6aW5nID0gKCkgPT4ge1xuICAgIGlmICh0aGlzLmVsZW1lbnRzLnRodW1iLmltYWdlQ29udGFpbmVyLmNsaWVudEhlaWdodCA+IDIwIHx8IHRoaXMuZWxlbWVudHMudGh1bWIuaW1hZ2VDb250YWluZXIuY2xpZW50V2lkdGggPiAyMCkge1xuICAgICAgLy8gVGhpcyB3aWxsIHByZXZlbnQgYXV0byBzaXppbmcgaW4gdGhpcy5zZXRUaHVtYkNvbnRhaW5lclNpemVBbmRQb3MoKVxuICAgICAgdGhpcy5zaXplU3BlY2lmaWVkSW5DU1MgPSB0cnVlO1xuICAgIH1cbiAgfTtcblxuICAvLyBTZXQgdGhlIHNpemUgdG8gYmUgYWJvdXQgYSBxdWFydGVyIG9mIHRoZSBzaXplIG9mIHZpZGVvLiBVbmxlc3Mgb3B0aW9uIGR5bmFtaWNTaXplID09PSBmYWxzZSwgaW4gd2hpY2ggY2FzZSBpdCBuZWVkcyB0byBiZSBzZXQgaW4gQ1NTXG4gIHNldFRodW1iQ29udGFpbmVyU2l6ZUFuZFBvcyA9ICgpID0+IHtcbiAgICBjb25zdCB7IGltYWdlQ29udGFpbmVyIH0gPSB0aGlzLmVsZW1lbnRzLnRodW1iO1xuXG4gICAgaWYgKCF0aGlzLnNpemVTcGVjaWZpZWRJbkNTUykge1xuICAgICAgY29uc3QgdGh1bWJXaWR0aCA9IE1hdGguZmxvb3IodGhpcy50aHVtYkNvbnRhaW5lckhlaWdodCAqIHRoaXMudGh1bWJBc3BlY3RSYXRpbyk7XG4gICAgICBpbWFnZUNvbnRhaW5lci5zdHlsZS5oZWlnaHQgPSBgJHt0aGlzLnRodW1iQ29udGFpbmVySGVpZ2h0fXB4YDtcbiAgICAgIGltYWdlQ29udGFpbmVyLnN0eWxlLndpZHRoID0gYCR7dGh1bWJXaWR0aH1weGA7XG4gICAgfSBlbHNlIGlmIChpbWFnZUNvbnRhaW5lci5jbGllbnRIZWlnaHQgPiAyMCAmJiBpbWFnZUNvbnRhaW5lci5jbGllbnRXaWR0aCA8IDIwKSB7XG4gICAgICBjb25zdCB0aHVtYldpZHRoID0gTWF0aC5mbG9vcihpbWFnZUNvbnRhaW5lci5jbGllbnRIZWlnaHQgKiB0aGlzLnRodW1iQXNwZWN0UmF0aW8pO1xuICAgICAgaW1hZ2VDb250YWluZXIuc3R5bGUud2lkdGggPSBgJHt0aHVtYldpZHRofXB4YDtcbiAgICB9IGVsc2UgaWYgKGltYWdlQ29udGFpbmVyLmNsaWVudEhlaWdodCA8IDIwICYmIGltYWdlQ29udGFpbmVyLmNsaWVudFdpZHRoID4gMjApIHtcbiAgICAgIGNvbnN0IHRodW1iSGVpZ2h0ID0gTWF0aC5mbG9vcihpbWFnZUNvbnRhaW5lci5jbGllbnRXaWR0aCAvIHRoaXMudGh1bWJBc3BlY3RSYXRpbyk7XG4gICAgICBpbWFnZUNvbnRhaW5lci5zdHlsZS5oZWlnaHQgPSBgJHt0aHVtYkhlaWdodH1weGA7XG4gICAgfVxuXG4gICAgdGhpcy5zZXRUaHVtYkNvbnRhaW5lclBvcygpO1xuICB9O1xuXG4gIHNldFRodW1iQ29udGFpbmVyUG9zID0gKCkgPT4ge1xuICAgIGNvbnN0IHNjcnViYmVyUmVjdCA9IHRoaXMucGxheWVyLmVsZW1lbnRzLnByb2dyZXNzLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIGNvbnN0IGNvbnRhaW5lclJlY3QgPSB0aGlzLnBsYXllci5lbGVtZW50cy5jb250YWluZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgY29uc3QgeyBjb250YWluZXIgfSA9IHRoaXMuZWxlbWVudHMudGh1bWI7XG4gICAgLy8gRmluZCB0aGUgbG93ZXN0IGFuZCBoaWdoZXN0IGRlc2lyZWQgbGVmdC1wb3NpdGlvbiwgc28gd2UgZG9uJ3Qgc2xpZGUgb3V0IHRoZSBzaWRlIG9mIHRoZSB2aWRlbyBjb250YWluZXJcbiAgICBjb25zdCBtaW4gPSBjb250YWluZXJSZWN0LmxlZnQgLSBzY3J1YmJlclJlY3QubGVmdCArIDEwO1xuICAgIGNvbnN0IG1heCA9IGNvbnRhaW5lclJlY3QucmlnaHQgLSBzY3J1YmJlclJlY3QubGVmdCAtIGNvbnRhaW5lci5jbGllbnRXaWR0aCAtIDEwO1xuICAgIC8vIFNldCBwcmV2aWV3IGNvbnRhaW5lciBwb3NpdGlvbiB0bzogbW91c2Vwb3MsIG1pbnVzIHNlZWtiYXIubGVmdCwgbWludXMgaGFsZiBvZiBwcmV2aWV3Q29udGFpbmVyLmNsaWVudFdpZHRoXG4gICAgY29uc3QgcG9zaXRpb24gPSB0aGlzLm1vdXNlUG9zWCAtIHNjcnViYmVyUmVjdC5sZWZ0IC0gY29udGFpbmVyLmNsaWVudFdpZHRoIC8gMjtcbiAgICBjb25zdCBjbGFtcGVkID0gY2xhbXAocG9zaXRpb24sIG1pbiwgbWF4KTtcblxuICAgIC8vIE1vdmUgdGhlIHBvcG92ZXIgcG9zaXRpb25cbiAgICBjb250YWluZXIuc3R5bGUubGVmdCA9IGAke2NsYW1wZWR9cHhgO1xuXG4gICAgLy8gVGhlIGFycm93IGNhbiBmb2xsb3cgdGhlIGN1cnNvclxuICAgIGNvbnRhaW5lci5zdHlsZS5zZXRQcm9wZXJ0eSgnLS1wcmV2aWV3LWFycm93LW9mZnNldCcsIGAke3Bvc2l0aW9uIC0gY2xhbXBlZH1weGApO1xuICB9O1xuXG4gIC8vIENhbid0IHVzZSAxMDAlIHdpZHRoLCBpbiBjYXNlIHRoZSB2aWRlbyBpcyBhIGRpZmZlcmVudCBhc3BlY3QgcmF0aW8gdG8gdGhlIHZpZGVvIGNvbnRhaW5lclxuICBzZXRTY3J1YmJpbmdDb250YWluZXJTaXplID0gKCkgPT4ge1xuICAgIGNvbnN0IHsgd2lkdGgsIGhlaWdodCB9ID0gZml0UmF0aW8odGhpcy50aHVtYkFzcGVjdFJhdGlvLCB7XG4gICAgICB3aWR0aDogdGhpcy5wbGF5ZXIubWVkaWEuY2xpZW50V2lkdGgsXG4gICAgICBoZWlnaHQ6IHRoaXMucGxheWVyLm1lZGlhLmNsaWVudEhlaWdodCxcbiAgICB9KTtcbiAgICB0aGlzLmVsZW1lbnRzLnNjcnViYmluZy5jb250YWluZXIuc3R5bGUud2lkdGggPSBgJHt3aWR0aH1weGA7XG4gICAgdGhpcy5lbGVtZW50cy5zY3J1YmJpbmcuY29udGFpbmVyLnN0eWxlLmhlaWdodCA9IGAke2hlaWdodH1weGA7XG4gIH07XG5cbiAgLy8gU3ByaXRlcyBuZWVkIHRvIGJlIG9mZnNldCB0byB0aGUgY29ycmVjdCBsb2NhdGlvblxuICBzZXRJbWFnZVNpemVBbmRPZmZzZXQgPSAocHJldmlld0ltYWdlLCBmcmFtZSkgPT4ge1xuICAgIGlmICghdGhpcy51c2luZ1Nwcml0ZXMpIHJldHVybjtcblxuICAgIC8vIEZpbmQgZGlmZmVyZW5jZSBiZXR3ZWVuIGhlaWdodCBhbmQgcHJldmlldyBjb250YWluZXIgaGVpZ2h0XG4gICAgY29uc3QgbXVsdGlwbGllciA9IHRoaXMudGh1bWJDb250YWluZXJIZWlnaHQgLyBmcmFtZS5oO1xuXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXBhcmFtLXJlYXNzaWduXG4gICAgcHJldmlld0ltYWdlLnN0eWxlLmhlaWdodCA9IGAke3ByZXZpZXdJbWFnZS5uYXR1cmFsSGVpZ2h0ICogbXVsdGlwbGllcn1weGA7XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXBhcmFtLXJlYXNzaWduXG4gICAgcHJldmlld0ltYWdlLnN0eWxlLndpZHRoID0gYCR7cHJldmlld0ltYWdlLm5hdHVyYWxXaWR0aCAqIG11bHRpcGxpZXJ9cHhgO1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1wYXJhbS1yZWFzc2lnblxuICAgIHByZXZpZXdJbWFnZS5zdHlsZS5sZWZ0ID0gYC0ke2ZyYW1lLnggKiBtdWx0aXBsaWVyfXB4YDtcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcGFyYW0tcmVhc3NpZ25cbiAgICBwcmV2aWV3SW1hZ2Uuc3R5bGUudG9wID0gYC0ke2ZyYW1lLnkgKiBtdWx0aXBsaWVyfXB4YDtcbiAgfTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgUHJldmlld1RodW1ibmFpbHM7XG4iLCIvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUGx5ciBzb3VyY2UgdXBkYXRlXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5pbXBvcnQgeyBwcm92aWRlcnMgfSBmcm9tICcuL2NvbmZpZy90eXBlcyc7XG5pbXBvcnQgaHRtbDUgZnJvbSAnLi9odG1sNSc7XG5pbXBvcnQgbWVkaWEgZnJvbSAnLi9tZWRpYSc7XG5pbXBvcnQgUHJldmlld1RodW1ibmFpbHMgZnJvbSAnLi9wbHVnaW5zL3ByZXZpZXctdGh1bWJuYWlscyc7XG5pbXBvcnQgc3VwcG9ydCBmcm9tICcuL3N1cHBvcnQnO1xuaW1wb3J0IHVpIGZyb20gJy4vdWknO1xuaW1wb3J0IHsgY3JlYXRlRWxlbWVudCwgaW5zZXJ0RWxlbWVudCwgcmVtb3ZlRWxlbWVudCB9IGZyb20gJy4vdXRpbHMvZWxlbWVudHMnO1xuaW1wb3J0IGlzIGZyb20gJy4vdXRpbHMvaXMnO1xuaW1wb3J0IHsgZ2V0RGVlcCB9IGZyb20gJy4vdXRpbHMvb2JqZWN0cyc7XG5cbmNvbnN0IHNvdXJjZSA9IHtcbiAgLy8gQWRkIGVsZW1lbnRzIHRvIEhUTUw1IG1lZGlhIChzb3VyY2UsIHRyYWNrcywgZXRjKVxuICBpbnNlcnRFbGVtZW50cyh0eXBlLCBhdHRyaWJ1dGVzKSB7XG4gICAgaWYgKGlzLnN0cmluZyhhdHRyaWJ1dGVzKSkge1xuICAgICAgaW5zZXJ0RWxlbWVudCh0eXBlLCB0aGlzLm1lZGlhLCB7XG4gICAgICAgIHNyYzogYXR0cmlidXRlcyxcbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAoaXMuYXJyYXkoYXR0cmlidXRlcykpIHtcbiAgICAgIGF0dHJpYnV0ZXMuZm9yRWFjaCgoYXR0cmlidXRlKSA9PiB7XG4gICAgICAgIGluc2VydEVsZW1lbnQodHlwZSwgdGhpcy5tZWRpYSwgYXR0cmlidXRlKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfSxcblxuICAvLyBVcGRhdGUgc291cmNlXG4gIC8vIFNvdXJjZXMgYXJlIG5vdCBjaGVja2VkIGZvciBzdXBwb3J0IHNvIGJlIGNhcmVmdWxcbiAgY2hhbmdlKGlucHV0KSB7XG4gICAgaWYgKCFnZXREZWVwKGlucHV0LCAnc291cmNlcy5sZW5ndGgnKSkge1xuICAgICAgdGhpcy5kZWJ1Zy53YXJuKCdJbnZhbGlkIHNvdXJjZSBmb3JtYXQnKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBDYW5jZWwgY3VycmVudCBuZXR3b3JrIHJlcXVlc3RzXG4gICAgaHRtbDUuY2FuY2VsUmVxdWVzdHMuY2FsbCh0aGlzKTtcblxuICAgIC8vIERlc3Ryb3kgaW5zdGFuY2UgYW5kIHJlLXNldHVwXG4gICAgdGhpcy5kZXN0cm95LmNhbGwoXG4gICAgICB0aGlzLFxuICAgICAgKCkgPT4ge1xuICAgICAgICAvLyBSZXNldCBxdWFsaXR5IG9wdGlvbnNcbiAgICAgICAgdGhpcy5vcHRpb25zLnF1YWxpdHkgPSBbXTtcblxuICAgICAgICAvLyBSZW1vdmUgZWxlbWVudHNcbiAgICAgICAgcmVtb3ZlRWxlbWVudCh0aGlzLm1lZGlhKTtcbiAgICAgICAgdGhpcy5tZWRpYSA9IG51bGw7XG5cbiAgICAgICAgLy8gUmVzZXQgY2xhc3MgbmFtZVxuICAgICAgICBpZiAoaXMuZWxlbWVudCh0aGlzLmVsZW1lbnRzLmNvbnRhaW5lcikpIHtcbiAgICAgICAgICB0aGlzLmVsZW1lbnRzLmNvbnRhaW5lci5yZW1vdmVBdHRyaWJ1dGUoJ2NsYXNzJyk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBTZXQgdGhlIHR5cGUgYW5kIHByb3ZpZGVyXG4gICAgICAgIGNvbnN0IHsgc291cmNlcywgdHlwZSB9ID0gaW5wdXQ7XG4gICAgICAgIGNvbnN0IFt7IHByb3ZpZGVyID0gcHJvdmlkZXJzLmh0bWw1LCBzcmMgfV0gPSBzb3VyY2VzO1xuICAgICAgICBjb25zdCB0YWdOYW1lID0gcHJvdmlkZXIgPT09ICdodG1sNScgPyB0eXBlIDogJ2Rpdic7XG4gICAgICAgIGNvbnN0IGF0dHJpYnV0ZXMgPSBwcm92aWRlciA9PT0gJ2h0bWw1JyA/IHt9IDogeyBzcmMgfTtcblxuICAgICAgICBPYmplY3QuYXNzaWduKHRoaXMsIHtcbiAgICAgICAgICBwcm92aWRlcixcbiAgICAgICAgICB0eXBlLFxuICAgICAgICAgIC8vIENoZWNrIGZvciBzdXBwb3J0XG4gICAgICAgICAgc3VwcG9ydGVkOiBzdXBwb3J0LmNoZWNrKHR5cGUsIHByb3ZpZGVyLCB0aGlzLmNvbmZpZy5wbGF5c2lubGluZSksXG4gICAgICAgICAgLy8gQ3JlYXRlIG5ldyBlbGVtZW50XG4gICAgICAgICAgbWVkaWE6IGNyZWF0ZUVsZW1lbnQodGFnTmFtZSwgYXR0cmlidXRlcyksXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIEluamVjdCB0aGUgbmV3IGVsZW1lbnRcbiAgICAgICAgdGhpcy5lbGVtZW50cy5jb250YWluZXIuYXBwZW5kQ2hpbGQodGhpcy5tZWRpYSk7XG5cbiAgICAgICAgLy8gQXV0b3BsYXkgdGhlIG5ldyBzb3VyY2U/XG4gICAgICAgIGlmIChpcy5ib29sZWFuKGlucHV0LmF1dG9wbGF5KSkge1xuICAgICAgICAgIHRoaXMuY29uZmlnLmF1dG9wbGF5ID0gaW5wdXQuYXV0b3BsYXk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBTZXQgYXR0cmlidXRlcyBmb3IgYXVkaW8gYW5kIHZpZGVvXG4gICAgICAgIGlmICh0aGlzLmlzSFRNTDUpIHtcbiAgICAgICAgICBpZiAodGhpcy5jb25maWcuY3Jvc3NvcmlnaW4pIHtcbiAgICAgICAgICAgIHRoaXMubWVkaWEuc2V0QXR0cmlidXRlKCdjcm9zc29yaWdpbicsICcnKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHRoaXMuY29uZmlnLmF1dG9wbGF5KSB7XG4gICAgICAgICAgICB0aGlzLm1lZGlhLnNldEF0dHJpYnV0ZSgnYXV0b3BsYXknLCAnJyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICghaXMuZW1wdHkoaW5wdXQucG9zdGVyKSkge1xuICAgICAgICAgICAgdGhpcy5wb3N0ZXIgPSBpbnB1dC5wb3N0ZXI7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICh0aGlzLmNvbmZpZy5sb29wLmFjdGl2ZSkge1xuICAgICAgICAgICAgdGhpcy5tZWRpYS5zZXRBdHRyaWJ1dGUoJ2xvb3AnLCAnJyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICh0aGlzLmNvbmZpZy5tdXRlZCkge1xuICAgICAgICAgICAgdGhpcy5tZWRpYS5zZXRBdHRyaWJ1dGUoJ211dGVkJywgJycpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAodGhpcy5jb25maWcucGxheXNpbmxpbmUpIHtcbiAgICAgICAgICAgIHRoaXMubWVkaWEuc2V0QXR0cmlidXRlKCdwbGF5c2lubGluZScsICcnKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBSZXN0b3JlIGNsYXNzIGhvb2tcbiAgICAgICAgdWkuYWRkU3R5bGVIb29rLmNhbGwodGhpcyk7XG5cbiAgICAgICAgLy8gU2V0IG5ldyBzb3VyY2VzIGZvciBodG1sNVxuICAgICAgICBpZiAodGhpcy5pc0hUTUw1KSB7XG4gICAgICAgICAgc291cmNlLmluc2VydEVsZW1lbnRzLmNhbGwodGhpcywgJ3NvdXJjZScsIHNvdXJjZXMpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gU2V0IHZpZGVvIHRpdGxlXG4gICAgICAgIHRoaXMuY29uZmlnLnRpdGxlID0gaW5wdXQudGl0bGU7XG5cbiAgICAgICAgLy8gU2V0IHVwIGZyb20gc2NyYXRjaFxuICAgICAgICBtZWRpYS5zZXR1cC5jYWxsKHRoaXMpO1xuXG4gICAgICAgIC8vIEhUTUw1IHN0dWZmXG4gICAgICAgIGlmICh0aGlzLmlzSFRNTDUpIHtcbiAgICAgICAgICAvLyBTZXR1cCBjYXB0aW9uc1xuICAgICAgICAgIGlmIChPYmplY3Qua2V5cyhpbnB1dCkuaW5jbHVkZXMoJ3RyYWNrcycpKSB7XG4gICAgICAgICAgICBzb3VyY2UuaW5zZXJ0RWxlbWVudHMuY2FsbCh0aGlzLCAndHJhY2snLCBpbnB1dC50cmFja3MpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIElmIEhUTUw1IG9yIGVtYmVkIGJ1dCBub3QgZnVsbHkgc3VwcG9ydGVkLCBzZXR1cEludGVyZmFjZSBhbmQgY2FsbCByZWFkeSBub3dcbiAgICAgICAgaWYgKHRoaXMuaXNIVE1MNSB8fCAodGhpcy5pc0VtYmVkICYmICF0aGlzLnN1cHBvcnRlZC51aSkpIHtcbiAgICAgICAgICAvLyBTZXR1cCBpbnRlcmZhY2VcbiAgICAgICAgICB1aS5idWlsZC5jYWxsKHRoaXMpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gTG9hZCBIVE1MNSBzb3VyY2VzXG4gICAgICAgIGlmICh0aGlzLmlzSFRNTDUpIHtcbiAgICAgICAgICB0aGlzLm1lZGlhLmxvYWQoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFVwZGF0ZSBwcmV2aWV3VGh1bWJuYWlscyBjb25maWcgJiByZWxvYWQgcGx1Z2luXG4gICAgICAgIGlmICghaXMuZW1wdHkoaW5wdXQucHJldmlld1RodW1ibmFpbHMpKSB7XG4gICAgICAgICAgT2JqZWN0LmFzc2lnbih0aGlzLmNvbmZpZy5wcmV2aWV3VGh1bWJuYWlscywgaW5wdXQucHJldmlld1RodW1ibmFpbHMpO1xuXG4gICAgICAgICAgLy8gQ2xlYW51cCBwcmV2aWV3VGh1bWJuYWlscyBwbHVnaW4gaWYgaXQgd2FzIGxvYWRlZFxuICAgICAgICAgIGlmICh0aGlzLnByZXZpZXdUaHVtYm5haWxzICYmIHRoaXMucHJldmlld1RodW1ibmFpbHMubG9hZGVkKSB7XG4gICAgICAgICAgICB0aGlzLnByZXZpZXdUaHVtYm5haWxzLmRlc3Ryb3koKTtcbiAgICAgICAgICAgIHRoaXMucHJldmlld1RodW1ibmFpbHMgPSBudWxsO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIENyZWF0ZSBuZXcgaW5zdGFuY2UgaWYgaXQgaXMgc3RpbGwgZW5hYmxlZFxuICAgICAgICAgIGlmICh0aGlzLmNvbmZpZy5wcmV2aWV3VGh1bWJuYWlscy5lbmFibGVkKSB7XG4gICAgICAgICAgICB0aGlzLnByZXZpZXdUaHVtYm5haWxzID0gbmV3IFByZXZpZXdUaHVtYm5haWxzKHRoaXMpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFVwZGF0ZSB0aGUgZnVsbHNjcmVlbiBzdXBwb3J0XG4gICAgICAgIHRoaXMuZnVsbHNjcmVlbi51cGRhdGUoKTtcbiAgICAgIH0sXG4gICAgICB0cnVlLFxuICAgICk7XG4gIH0sXG59O1xuXG5leHBvcnQgZGVmYXVsdCBzb3VyY2U7XG4iLCIvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUGx5clxuLy8gcGx5ci5qcyB2My43LjJcbi8vIGh0dHBzOi8vZ2l0aHViLmNvbS9zYW1wb3R0cy9wbHlyXG4vLyBMaWNlbnNlOiBUaGUgTUlUIExpY2Vuc2UgKE1JVClcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmltcG9ydCBjYXB0aW9ucyBmcm9tICcuL2NhcHRpb25zJztcbmltcG9ydCBkZWZhdWx0cyBmcm9tICcuL2NvbmZpZy9kZWZhdWx0cyc7XG5pbXBvcnQgeyBwaXAgfSBmcm9tICcuL2NvbmZpZy9zdGF0ZXMnO1xuaW1wb3J0IHsgZ2V0UHJvdmlkZXJCeVVybCwgcHJvdmlkZXJzLCB0eXBlcyB9IGZyb20gJy4vY29uZmlnL3R5cGVzJztcbmltcG9ydCBDb25zb2xlIGZyb20gJy4vY29uc29sZSc7XG5pbXBvcnQgY29udHJvbHMgZnJvbSAnLi9jb250cm9scyc7XG5pbXBvcnQgRnVsbHNjcmVlbiBmcm9tICcuL2Z1bGxzY3JlZW4nO1xuaW1wb3J0IGh0bWw1IGZyb20gJy4vaHRtbDUnO1xuaW1wb3J0IExpc3RlbmVycyBmcm9tICcuL2xpc3RlbmVycyc7XG5pbXBvcnQgbWVkaWEgZnJvbSAnLi9tZWRpYSc7XG5pbXBvcnQgQWRzIGZyb20gJy4vcGx1Z2lucy9hZHMnO1xuaW1wb3J0IFByZXZpZXdUaHVtYm5haWxzIGZyb20gJy4vcGx1Z2lucy9wcmV2aWV3LXRodW1ibmFpbHMnO1xuaW1wb3J0IHNvdXJjZSBmcm9tICcuL3NvdXJjZSc7XG5pbXBvcnQgU3RvcmFnZSBmcm9tICcuL3N0b3JhZ2UnO1xuaW1wb3J0IHN1cHBvcnQgZnJvbSAnLi9zdXBwb3J0JztcbmltcG9ydCB1aSBmcm9tICcuL3VpJztcbmltcG9ydCB7IGNsb3Nlc3QgfSBmcm9tICcuL3V0aWxzL2FycmF5cyc7XG5pbXBvcnQgeyBjcmVhdGVFbGVtZW50LCBoYXNDbGFzcywgcmVtb3ZlRWxlbWVudCwgcmVwbGFjZUVsZW1lbnQsIHRvZ2dsZUNsYXNzLCB3cmFwIH0gZnJvbSAnLi91dGlscy9lbGVtZW50cyc7XG5pbXBvcnQgeyBvZmYsIG9uLCBvbmNlLCB0cmlnZ2VyRXZlbnQsIHVuYmluZExpc3RlbmVycyB9IGZyb20gJy4vdXRpbHMvZXZlbnRzJztcbmltcG9ydCBpcyBmcm9tICcuL3V0aWxzL2lzJztcbmltcG9ydCBsb2FkU3ByaXRlIGZyb20gJy4vdXRpbHMvbG9hZC1zcHJpdGUnO1xuaW1wb3J0IHsgY2xhbXAgfSBmcm9tICcuL3V0aWxzL251bWJlcnMnO1xuaW1wb3J0IHsgY2xvbmVEZWVwLCBleHRlbmQgfSBmcm9tICcuL3V0aWxzL29iamVjdHMnO1xuaW1wb3J0IHsgc2lsZW5jZVByb21pc2UgfSBmcm9tICcuL3V0aWxzL3Byb21pc2UnO1xuaW1wb3J0IHsgZ2V0QXNwZWN0UmF0aW8sIHJlZHVjZUFzcGVjdFJhdGlvLCBzZXRBc3BlY3RSYXRpbywgdmFsaWRhdGVBc3BlY3RSYXRpbyB9IGZyb20gJy4vdXRpbHMvc3R5bGUnO1xuaW1wb3J0IHsgcGFyc2VVcmwgfSBmcm9tICcuL3V0aWxzL3VybHMnO1xuXG4vLyBQcml2YXRlIHByb3BlcnRpZXNcbi8vIFRPRE86IFVzZSBhIFdlYWtNYXAgZm9yIHByaXZhdGUgZ2xvYmFsc1xuLy8gY29uc3QgZ2xvYmFscyA9IG5ldyBXZWFrTWFwKCk7XG5cbi8vIFBseXIgaW5zdGFuY2VcbmNsYXNzIFBseXIge1xuICBjb25zdHJ1Y3Rvcih0YXJnZXQsIG9wdGlvbnMpIHtcbiAgICB0aGlzLnRpbWVycyA9IHt9O1xuXG4gICAgLy8gU3RhdGVcbiAgICB0aGlzLnJlYWR5ID0gZmFsc2U7XG4gICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7XG4gICAgdGhpcy5mYWlsZWQgPSBmYWxzZTtcblxuICAgIC8vIFRvdWNoIGRldmljZVxuICAgIHRoaXMudG91Y2ggPSBzdXBwb3J0LnRvdWNoO1xuXG4gICAgLy8gU2V0IHRoZSBtZWRpYSBlbGVtZW50XG4gICAgdGhpcy5tZWRpYSA9IHRhcmdldDtcblxuICAgIC8vIFN0cmluZyBzZWxlY3RvciBwYXNzZWRcbiAgICBpZiAoaXMuc3RyaW5nKHRoaXMubWVkaWEpKSB7XG4gICAgICB0aGlzLm1lZGlhID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCh0aGlzLm1lZGlhKTtcbiAgICB9XG5cbiAgICAvLyBqUXVlcnksIE5vZGVMaXN0IG9yIEFycmF5IHBhc3NlZCwgdXNlIGZpcnN0IGVsZW1lbnRcbiAgICBpZiAoKHdpbmRvdy5qUXVlcnkgJiYgdGhpcy5tZWRpYSBpbnN0YW5jZW9mIGpRdWVyeSkgfHwgaXMubm9kZUxpc3QodGhpcy5tZWRpYSkgfHwgaXMuYXJyYXkodGhpcy5tZWRpYSkpIHtcbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZVxuICAgICAgdGhpcy5tZWRpYSA9IHRoaXMubWVkaWFbMF07XG4gICAgfVxuXG4gICAgLy8gU2V0IGNvbmZpZ1xuICAgIHRoaXMuY29uZmlnID0gZXh0ZW5kKFxuICAgICAge30sXG4gICAgICBkZWZhdWx0cyxcbiAgICAgIFBseXIuZGVmYXVsdHMsXG4gICAgICBvcHRpb25zIHx8IHt9LFxuICAgICAgKCgpID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICByZXR1cm4gSlNPTi5wYXJzZSh0aGlzLm1lZGlhLmdldEF0dHJpYnV0ZSgnZGF0YS1wbHlyLWNvbmZpZycpKTtcbiAgICAgICAgfSBjYXRjaCAoXykge1xuICAgICAgICAgIHJldHVybiB7fTtcbiAgICAgICAgfVxuICAgICAgfSkoKSxcbiAgICApO1xuXG4gICAgLy8gRWxlbWVudHMgY2FjaGVcbiAgICB0aGlzLmVsZW1lbnRzID0ge1xuICAgICAgY29udGFpbmVyOiBudWxsLFxuICAgICAgZnVsbHNjcmVlbjogbnVsbCxcbiAgICAgIGNhcHRpb25zOiBudWxsLFxuICAgICAgYnV0dG9uczoge30sXG4gICAgICBkaXNwbGF5OiB7fSxcbiAgICAgIHByb2dyZXNzOiB7fSxcbiAgICAgIGlucHV0czoge30sXG4gICAgICBzZXR0aW5nczoge1xuICAgICAgICBwb3B1cDogbnVsbCxcbiAgICAgICAgbWVudTogbnVsbCxcbiAgICAgICAgcGFuZWxzOiB7fSxcbiAgICAgICAgYnV0dG9uczoge30sXG4gICAgICB9LFxuICAgIH07XG5cbiAgICAvLyBDYXB0aW9uc1xuICAgIHRoaXMuY2FwdGlvbnMgPSB7XG4gICAgICBhY3RpdmU6IG51bGwsXG4gICAgICBjdXJyZW50VHJhY2s6IC0xLFxuICAgICAgbWV0YTogbmV3IFdlYWtNYXAoKSxcbiAgICB9O1xuXG4gICAgLy8gRnVsbHNjcmVlblxuICAgIHRoaXMuZnVsbHNjcmVlbiA9IHtcbiAgICAgIGFjdGl2ZTogZmFsc2UsXG4gICAgfTtcblxuICAgIC8vIE9wdGlvbnNcbiAgICB0aGlzLm9wdGlvbnMgPSB7XG4gICAgICBzcGVlZDogW10sXG4gICAgICBxdWFsaXR5OiBbXSxcbiAgICB9O1xuXG4gICAgLy8gRGVidWdnaW5nXG4gICAgLy8gVE9ETzogbW92ZSB0byBnbG9iYWxzXG4gICAgdGhpcy5kZWJ1ZyA9IG5ldyBDb25zb2xlKHRoaXMuY29uZmlnLmRlYnVnKTtcblxuICAgIC8vIExvZyBjb25maWcgb3B0aW9ucyBhbmQgc3VwcG9ydFxuICAgIHRoaXMuZGVidWcubG9nKCdDb25maWcnLCB0aGlzLmNvbmZpZyk7XG4gICAgdGhpcy5kZWJ1Zy5sb2coJ1N1cHBvcnQnLCBzdXBwb3J0KTtcblxuICAgIC8vIFdlIG5lZWQgYW4gZWxlbWVudCB0byBzZXR1cFxuICAgIGlmIChpcy5udWxsT3JVbmRlZmluZWQodGhpcy5tZWRpYSkgfHwgIWlzLmVsZW1lbnQodGhpcy5tZWRpYSkpIHtcbiAgICAgIHRoaXMuZGVidWcuZXJyb3IoJ1NldHVwIGZhaWxlZDogbm8gc3VpdGFibGUgZWxlbWVudCBwYXNzZWQnKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBCYWlsIGlmIHRoZSBlbGVtZW50IGlzIGluaXRpYWxpemVkXG4gICAgaWYgKHRoaXMubWVkaWEucGx5cikge1xuICAgICAgdGhpcy5kZWJ1Zy53YXJuKCdUYXJnZXQgYWxyZWFkeSBzZXR1cCcpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIEJhaWwgaWYgbm90IGVuYWJsZWRcbiAgICBpZiAoIXRoaXMuY29uZmlnLmVuYWJsZWQpIHtcbiAgICAgIHRoaXMuZGVidWcuZXJyb3IoJ1NldHVwIGZhaWxlZDogZGlzYWJsZWQgYnkgY29uZmlnJyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gQmFpbCBpZiBkaXNhYmxlZCBvciBubyBiYXNpYyBzdXBwb3J0XG4gICAgLy8gWW91IG1heSB3YW50IHRvIGRpc2FibGUgY2VydGFpbiBVQXMgZXRjXG4gICAgaWYgKCFzdXBwb3J0LmNoZWNrKCkuYXBpKSB7XG4gICAgICB0aGlzLmRlYnVnLmVycm9yKCdTZXR1cCBmYWlsZWQ6IG5vIHN1cHBvcnQnKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBDYWNoZSBvcmlnaW5hbCBlbGVtZW50IHN0YXRlIGZvciAuZGVzdHJveSgpXG4gICAgY29uc3QgY2xvbmUgPSB0aGlzLm1lZGlhLmNsb25lTm9kZSh0cnVlKTtcbiAgICBjbG9uZS5hdXRvcGxheSA9IGZhbHNlO1xuICAgIHRoaXMuZWxlbWVudHMub3JpZ2luYWwgPSBjbG9uZTtcblxuICAgIC8vIFNldCBtZWRpYSB0eXBlIGJhc2VkIG9uIHRhZyBvciBkYXRhIGF0dHJpYnV0ZVxuICAgIC8vIFN1cHBvcnRlZDogdmlkZW8sIGF1ZGlvLCB2aW1lbywgeW91dHViZVxuICAgIGNvbnN0IHR5cGUgPSB0aGlzLm1lZGlhLnRhZ05hbWUudG9Mb3dlckNhc2UoKTtcbiAgICAvLyBFbWJlZCBwcm9wZXJ0aWVzXG4gICAgbGV0IGlmcmFtZSA9IG51bGw7XG4gICAgbGV0IHVybCA9IG51bGw7XG5cbiAgICAvLyBEaWZmZXJlbnQgc2V0dXAgYmFzZWQgb24gdHlwZVxuICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgY2FzZSAnZGl2JzpcbiAgICAgICAgLy8gRmluZCB0aGUgZnJhbWVcbiAgICAgICAgaWZyYW1lID0gdGhpcy5tZWRpYS5xdWVyeVNlbGVjdG9yKCdpZnJhbWUnKTtcblxuICAgICAgICAvLyA8aWZyYW1lPiB0eXBlXG4gICAgICAgIGlmIChpcy5lbGVtZW50KGlmcmFtZSkpIHtcbiAgICAgICAgICAvLyBEZXRlY3QgcHJvdmlkZXJcbiAgICAgICAgICB1cmwgPSBwYXJzZVVybChpZnJhbWUuZ2V0QXR0cmlidXRlKCdzcmMnKSk7XG4gICAgICAgICAgdGhpcy5wcm92aWRlciA9IGdldFByb3ZpZGVyQnlVcmwodXJsLnRvU3RyaW5nKCkpO1xuXG4gICAgICAgICAgLy8gUmV3b3JrIGVsZW1lbnRzXG4gICAgICAgICAgdGhpcy5lbGVtZW50cy5jb250YWluZXIgPSB0aGlzLm1lZGlhO1xuICAgICAgICAgIHRoaXMubWVkaWEgPSBpZnJhbWU7XG5cbiAgICAgICAgICAvLyBSZXNldCBjbGFzc25hbWVcbiAgICAgICAgICB0aGlzLmVsZW1lbnRzLmNvbnRhaW5lci5jbGFzc05hbWUgPSAnJztcblxuICAgICAgICAgIC8vIEdldCBhdHRyaWJ1dGVzIGZyb20gVVJMIGFuZCBzZXQgY29uZmlnXG4gICAgICAgICAgaWYgKHVybC5zZWFyY2gubGVuZ3RoKSB7XG4gICAgICAgICAgICBjb25zdCB0cnV0aHkgPSBbJzEnLCAndHJ1ZSddO1xuXG4gICAgICAgICAgICBpZiAodHJ1dGh5LmluY2x1ZGVzKHVybC5zZWFyY2hQYXJhbXMuZ2V0KCdhdXRvcGxheScpKSkge1xuICAgICAgICAgICAgICB0aGlzLmNvbmZpZy5hdXRvcGxheSA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodHJ1dGh5LmluY2x1ZGVzKHVybC5zZWFyY2hQYXJhbXMuZ2V0KCdsb29wJykpKSB7XG4gICAgICAgICAgICAgIHRoaXMuY29uZmlnLmxvb3AuYWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gVE9ETzogcmVwbGFjZSBmdWxsc2NyZWVuLmlvc05hdGl2ZSB3aXRoIHRoaXMgcGxheXNpbmxpbmUgY29uZmlnIG9wdGlvblxuICAgICAgICAgICAgLy8gWW91VHViZSByZXF1aXJlcyB0aGUgcGxheXNpbmxpbmUgaW4gdGhlIFVSTFxuICAgICAgICAgICAgaWYgKHRoaXMuaXNZb3VUdWJlKSB7XG4gICAgICAgICAgICAgIHRoaXMuY29uZmlnLnBsYXlzaW5saW5lID0gdHJ1dGh5LmluY2x1ZGVzKHVybC5zZWFyY2hQYXJhbXMuZ2V0KCdwbGF5c2lubGluZScpKTtcbiAgICAgICAgICAgICAgdGhpcy5jb25maWcueW91dHViZS5obCA9IHVybC5zZWFyY2hQYXJhbXMuZ2V0KCdobCcpOyAvLyBUT0RPOiBTaG91bGQgdGhpcyBiZSBzZXR0aW5nIGxhbmd1YWdlP1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdGhpcy5jb25maWcucGxheXNpbmxpbmUgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyA8ZGl2PiB3aXRoIGF0dHJpYnV0ZXNcbiAgICAgICAgICB0aGlzLnByb3ZpZGVyID0gdGhpcy5tZWRpYS5nZXRBdHRyaWJ1dGUodGhpcy5jb25maWcuYXR0cmlidXRlcy5lbWJlZC5wcm92aWRlcik7XG5cbiAgICAgICAgICAvLyBSZW1vdmUgYXR0cmlidXRlXG4gICAgICAgICAgdGhpcy5tZWRpYS5yZW1vdmVBdHRyaWJ1dGUodGhpcy5jb25maWcuYXR0cmlidXRlcy5lbWJlZC5wcm92aWRlcik7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBVbnN1cHBvcnRlZCBvciBtaXNzaW5nIHByb3ZpZGVyXG4gICAgICAgIGlmIChpcy5lbXB0eSh0aGlzLnByb3ZpZGVyKSB8fCAhT2JqZWN0LnZhbHVlcyhwcm92aWRlcnMpLmluY2x1ZGVzKHRoaXMucHJvdmlkZXIpKSB7XG4gICAgICAgICAgdGhpcy5kZWJ1Zy5lcnJvcignU2V0dXAgZmFpbGVkOiBJbnZhbGlkIHByb3ZpZGVyJyk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQXVkaW8gd2lsbCBjb21lIGxhdGVyIGZvciBleHRlcm5hbCBwcm92aWRlcnNcbiAgICAgICAgdGhpcy50eXBlID0gdHlwZXMudmlkZW87XG5cbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgJ3ZpZGVvJzpcbiAgICAgIGNhc2UgJ2F1ZGlvJzpcbiAgICAgICAgdGhpcy50eXBlID0gdHlwZTtcbiAgICAgICAgdGhpcy5wcm92aWRlciA9IHByb3ZpZGVycy5odG1sNTtcblxuICAgICAgICAvLyBHZXQgY29uZmlnIGZyb20gYXR0cmlidXRlc1xuICAgICAgICBpZiAodGhpcy5tZWRpYS5oYXNBdHRyaWJ1dGUoJ2Nyb3Nzb3JpZ2luJykpIHtcbiAgICAgICAgICB0aGlzLmNvbmZpZy5jcm9zc29yaWdpbiA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMubWVkaWEuaGFzQXR0cmlidXRlKCdhdXRvcGxheScpKSB7XG4gICAgICAgICAgdGhpcy5jb25maWcuYXV0b3BsYXkgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLm1lZGlhLmhhc0F0dHJpYnV0ZSgncGxheXNpbmxpbmUnKSB8fCB0aGlzLm1lZGlhLmhhc0F0dHJpYnV0ZSgnd2Via2l0LXBsYXlzaW5saW5lJykpIHtcbiAgICAgICAgICB0aGlzLmNvbmZpZy5wbGF5c2lubGluZSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMubWVkaWEuaGFzQXR0cmlidXRlKCdtdXRlZCcpKSB7XG4gICAgICAgICAgdGhpcy5jb25maWcubXV0ZWQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLm1lZGlhLmhhc0F0dHJpYnV0ZSgnbG9vcCcpKSB7XG4gICAgICAgICAgdGhpcy5jb25maWcubG9vcC5hY3RpdmUgPSB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHRoaXMuZGVidWcuZXJyb3IoJ1NldHVwIGZhaWxlZDogdW5zdXBwb3J0ZWQgdHlwZScpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgZm9yIHN1cHBvcnQgYWdhaW4gYnV0IHdpdGggdHlwZVxuICAgIHRoaXMuc3VwcG9ydGVkID0gc3VwcG9ydC5jaGVjayh0aGlzLnR5cGUsIHRoaXMucHJvdmlkZXIsIHRoaXMuY29uZmlnLnBsYXlzaW5saW5lKTtcblxuICAgIC8vIElmIG5vIHN1cHBvcnQgZm9yIGV2ZW4gQVBJLCBiYWlsXG4gICAgaWYgKCF0aGlzLnN1cHBvcnRlZC5hcGkpIHtcbiAgICAgIHRoaXMuZGVidWcuZXJyb3IoJ1NldHVwIGZhaWxlZDogbm8gc3VwcG9ydCcpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuZXZlbnRMaXN0ZW5lcnMgPSBbXTtcblxuICAgIC8vIENyZWF0ZSBsaXN0ZW5lcnNcbiAgICB0aGlzLmxpc3RlbmVycyA9IG5ldyBMaXN0ZW5lcnModGhpcyk7XG5cbiAgICAvLyBTZXR1cCBsb2NhbCBzdG9yYWdlIGZvciB1c2VyIHNldHRpbmdzXG4gICAgdGhpcy5zdG9yYWdlID0gbmV3IFN0b3JhZ2UodGhpcyk7XG5cbiAgICAvLyBTdG9yZSByZWZlcmVuY2VcbiAgICB0aGlzLm1lZGlhLnBseXIgPSB0aGlzO1xuXG4gICAgLy8gV3JhcCBtZWRpYVxuICAgIGlmICghaXMuZWxlbWVudCh0aGlzLmVsZW1lbnRzLmNvbnRhaW5lcikpIHtcbiAgICAgIHRoaXMuZWxlbWVudHMuY29udGFpbmVyID0gY3JlYXRlRWxlbWVudCgnZGl2JywgeyB0YWJpbmRleDogMCB9KTtcbiAgICAgIHdyYXAodGhpcy5tZWRpYSwgdGhpcy5lbGVtZW50cy5jb250YWluZXIpO1xuICAgIH1cblxuICAgIC8vIE1pZ3JhdGUgY3VzdG9tIHByb3BlcnRpZXMgZnJvbSBtZWRpYSB0byBjb250YWluZXIgKHNvIHRoZXkgd29yayDwn5iJKVxuICAgIHVpLm1pZ3JhdGVTdHlsZXMuY2FsbCh0aGlzKTtcblxuICAgIC8vIEFkZCBzdHlsZSBob29rXG4gICAgdWkuYWRkU3R5bGVIb29rLmNhbGwodGhpcyk7XG5cbiAgICAvLyBTZXR1cCBtZWRpYVxuICAgIG1lZGlhLnNldHVwLmNhbGwodGhpcyk7XG5cbiAgICAvLyBMaXN0ZW4gZm9yIGV2ZW50cyBpZiBkZWJ1Z2dpbmdcbiAgICBpZiAodGhpcy5jb25maWcuZGVidWcpIHtcbiAgICAgIG9uLmNhbGwodGhpcywgdGhpcy5lbGVtZW50cy5jb250YWluZXIsIHRoaXMuY29uZmlnLmV2ZW50cy5qb2luKCcgJyksIChldmVudCkgPT4ge1xuICAgICAgICB0aGlzLmRlYnVnLmxvZyhgZXZlbnQ6ICR7ZXZlbnQudHlwZX1gKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIFNldHVwIGZ1bGxzY3JlZW5cbiAgICB0aGlzLmZ1bGxzY3JlZW4gPSBuZXcgRnVsbHNjcmVlbih0aGlzKTtcblxuICAgIC8vIFNldHVwIGludGVyZmFjZVxuICAgIC8vIElmIGVtYmVkIGJ1dCBub3QgZnVsbHkgc3VwcG9ydGVkLCBidWlsZCBpbnRlcmZhY2Ugbm93IHRvIGF2b2lkIGZsYXNoIG9mIGNvbnRyb2xzXG4gICAgaWYgKHRoaXMuaXNIVE1MNSB8fCAodGhpcy5pc0VtYmVkICYmICF0aGlzLnN1cHBvcnRlZC51aSkpIHtcbiAgICAgIHVpLmJ1aWxkLmNhbGwodGhpcyk7XG4gICAgfVxuXG4gICAgLy8gQ29udGFpbmVyIGxpc3RlbmVyc1xuICAgIHRoaXMubGlzdGVuZXJzLmNvbnRhaW5lcigpO1xuXG4gICAgLy8gR2xvYmFsIGxpc3RlbmVyc1xuICAgIHRoaXMubGlzdGVuZXJzLmdsb2JhbCgpO1xuXG4gICAgLy8gU2V0dXAgYWRzIGlmIHByb3ZpZGVkXG4gICAgaWYgKHRoaXMuY29uZmlnLmFkcy5lbmFibGVkKSB7XG4gICAgICB0aGlzLmFkcyA9IG5ldyBBZHModGhpcyk7XG4gICAgfVxuXG4gICAgLy8gQXV0b3BsYXkgaWYgcmVxdWlyZWRcbiAgICBpZiAodGhpcy5pc0hUTUw1ICYmIHRoaXMuY29uZmlnLmF1dG9wbGF5KSB7XG4gICAgICB0aGlzLm9uY2UoJ2NhbnBsYXknLCAoKSA9PiBzaWxlbmNlUHJvbWlzZSh0aGlzLnBsYXkoKSkpO1xuICAgIH1cblxuICAgIC8vIFNlZWsgdGltZSB3aWxsIGJlIHJlY29yZGVkIChpbiBsaXN0ZW5lcnMuanMpIHNvIHdlIGNhbiBwcmV2ZW50IGhpZGluZyBjb250cm9scyBmb3IgYSBmZXcgc2Vjb25kcyBhZnRlciBzZWVrXG4gICAgdGhpcy5sYXN0U2Vla1RpbWUgPSAwO1xuXG4gICAgLy8gU2V0dXAgcHJldmlldyB0aHVtYm5haWxzIGlmIGVuYWJsZWRcbiAgICBpZiAodGhpcy5jb25maWcucHJldmlld1RodW1ibmFpbHMuZW5hYmxlZCkge1xuICAgICAgdGhpcy5wcmV2aWV3VGh1bWJuYWlscyA9IG5ldyBQcmV2aWV3VGh1bWJuYWlscyh0aGlzKTtcbiAgICB9XG4gIH1cblxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gQVBJXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gIC8qKlxuICAgKiBUeXBlcyBhbmQgcHJvdmlkZXIgaGVscGVyc1xuICAgKi9cbiAgZ2V0IGlzSFRNTDUoKSB7XG4gICAgcmV0dXJuIHRoaXMucHJvdmlkZXIgPT09IHByb3ZpZGVycy5odG1sNTtcbiAgfVxuXG4gIGdldCBpc0VtYmVkKCkge1xuICAgIHJldHVybiB0aGlzLmlzWW91VHViZSB8fCB0aGlzLmlzVmltZW87XG4gIH1cblxuICBnZXQgaXNZb3VUdWJlKCkge1xuICAgIHJldHVybiB0aGlzLnByb3ZpZGVyID09PSBwcm92aWRlcnMueW91dHViZTtcbiAgfVxuXG4gIGdldCBpc1ZpbWVvKCkge1xuICAgIHJldHVybiB0aGlzLnByb3ZpZGVyID09PSBwcm92aWRlcnMudmltZW87XG4gIH1cblxuICBnZXQgaXNWaWRlbygpIHtcbiAgICByZXR1cm4gdGhpcy50eXBlID09PSB0eXBlcy52aWRlbztcbiAgfVxuXG4gIGdldCBpc0F1ZGlvKCkge1xuICAgIHJldHVybiB0aGlzLnR5cGUgPT09IHR5cGVzLmF1ZGlvO1xuICB9XG5cbiAgLyoqXG4gICAqIFBsYXkgdGhlIG1lZGlhLCBvciBwbGF5IHRoZSBhZHZlcnRpc2VtZW50IChpZiB0aGV5IGFyZSBub3QgYmxvY2tlZClcbiAgICovXG4gIHBsYXkgPSAoKSA9PiB7XG4gICAgaWYgKCFpcy5mdW5jdGlvbih0aGlzLm1lZGlhLnBsYXkpKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICAvLyBJbnRlY2VwdCBwbGF5IHdpdGggYWRzXG4gICAgaWYgKHRoaXMuYWRzICYmIHRoaXMuYWRzLmVuYWJsZWQpIHtcbiAgICAgIHRoaXMuYWRzLm1hbmFnZXJQcm9taXNlLnRoZW4oKCkgPT4gdGhpcy5hZHMucGxheSgpKS5jYXRjaCgoKSA9PiBzaWxlbmNlUHJvbWlzZSh0aGlzLm1lZGlhLnBsYXkoKSkpO1xuICAgIH1cblxuICAgIC8vIFJldHVybiB0aGUgcHJvbWlzZSAoZm9yIEhUTUw1KVxuICAgIHJldHVybiB0aGlzLm1lZGlhLnBsYXkoKTtcbiAgfTtcblxuICAvKipcbiAgICogUGF1c2UgdGhlIG1lZGlhXG4gICAqL1xuICBwYXVzZSA9ICgpID0+IHtcbiAgICBpZiAoIXRoaXMucGxheWluZyB8fCAhaXMuZnVuY3Rpb24odGhpcy5tZWRpYS5wYXVzZSkpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLm1lZGlhLnBhdXNlKCk7XG4gIH07XG5cbiAgLyoqXG4gICAqIEdldCBwbGF5aW5nIHN0YXRlXG4gICAqL1xuICBnZXQgcGxheWluZygpIHtcbiAgICByZXR1cm4gQm9vbGVhbih0aGlzLnJlYWR5ICYmICF0aGlzLnBhdXNlZCAmJiAhdGhpcy5lbmRlZCk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHBhdXNlZCBzdGF0ZVxuICAgKi9cbiAgZ2V0IHBhdXNlZCgpIHtcbiAgICByZXR1cm4gQm9vbGVhbih0aGlzLm1lZGlhLnBhdXNlZCk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHN0b3BwZWQgc3RhdGVcbiAgICovXG4gIGdldCBzdG9wcGVkKCkge1xuICAgIHJldHVybiBCb29sZWFuKHRoaXMucGF1c2VkICYmIHRoaXMuY3VycmVudFRpbWUgPT09IDApO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBlbmRlZCBzdGF0ZVxuICAgKi9cbiAgZ2V0IGVuZGVkKCkge1xuICAgIHJldHVybiBCb29sZWFuKHRoaXMubWVkaWEuZW5kZWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIFRvZ2dsZSBwbGF5YmFjayBiYXNlZCBvbiBjdXJyZW50IHN0YXR1c1xuICAgKiBAcGFyYW0ge0Jvb2xlYW59IGlucHV0XG4gICAqL1xuICB0b2dnbGVQbGF5ID0gKGlucHV0KSA9PiB7XG4gICAgLy8gVG9nZ2xlIGJhc2VkIG9uIGN1cnJlbnQgc3RhdGUgaWYgbm90aGluZyBwYXNzZWRcbiAgICBjb25zdCB0b2dnbGUgPSBpcy5ib29sZWFuKGlucHV0KSA/IGlucHV0IDogIXRoaXMucGxheWluZztcblxuICAgIGlmICh0b2dnbGUpIHtcbiAgICAgIHJldHVybiB0aGlzLnBsYXkoKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5wYXVzZSgpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBTdG9wIHBsYXliYWNrXG4gICAqL1xuICBzdG9wID0gKCkgPT4ge1xuICAgIGlmICh0aGlzLmlzSFRNTDUpIHtcbiAgICAgIHRoaXMucGF1c2UoKTtcbiAgICAgIHRoaXMucmVzdGFydCgpO1xuICAgIH0gZWxzZSBpZiAoaXMuZnVuY3Rpb24odGhpcy5tZWRpYS5zdG9wKSkge1xuICAgICAgdGhpcy5tZWRpYS5zdG9wKCk7XG4gICAgfVxuICB9O1xuXG4gIC8qKlxuICAgKiBSZXN0YXJ0IHBsYXliYWNrXG4gICAqL1xuICByZXN0YXJ0ID0gKCkgPT4ge1xuICAgIHRoaXMuY3VycmVudFRpbWUgPSAwO1xuICB9O1xuXG4gIC8qKlxuICAgKiBSZXdpbmRcbiAgICogQHBhcmFtIHtOdW1iZXJ9IHNlZWtUaW1lIC0gaG93IGZhciB0byByZXdpbmQgaW4gc2Vjb25kcy4gRGVmYXVsdHMgdG8gdGhlIGNvbmZpZy5zZWVrVGltZVxuICAgKi9cbiAgcmV3aW5kID0gKHNlZWtUaW1lKSA9PiB7XG4gICAgdGhpcy5jdXJyZW50VGltZSAtPSBpcy5udW1iZXIoc2Vla1RpbWUpID8gc2Vla1RpbWUgOiB0aGlzLmNvbmZpZy5zZWVrVGltZTtcbiAgfTtcblxuICAvKipcbiAgICogRmFzdCBmb3J3YXJkXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBzZWVrVGltZSAtIGhvdyBmYXIgdG8gZmFzdCBmb3J3YXJkIGluIHNlY29uZHMuIERlZmF1bHRzIHRvIHRoZSBjb25maWcuc2Vla1RpbWVcbiAgICovXG4gIGZvcndhcmQgPSAoc2Vla1RpbWUpID0+IHtcbiAgICB0aGlzLmN1cnJlbnRUaW1lICs9IGlzLm51bWJlcihzZWVrVGltZSkgPyBzZWVrVGltZSA6IHRoaXMuY29uZmlnLnNlZWtUaW1lO1xuICB9O1xuXG4gIC8qKlxuICAgKiBTZWVrIHRvIGEgdGltZVxuICAgKiBAcGFyYW0ge051bWJlcn0gaW5wdXQgLSB3aGVyZSB0byBzZWVrIHRvIGluIHNlY29uZHMuIERlZmF1bHRzIHRvIDAgKHRoZSBzdGFydClcbiAgICovXG4gIHNldCBjdXJyZW50VGltZShpbnB1dCkge1xuICAgIC8vIEJhaWwgaWYgbWVkaWEgZHVyYXRpb24gaXNuJ3QgYXZhaWxhYmxlIHlldFxuICAgIGlmICghdGhpcy5kdXJhdGlvbikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIFZhbGlkYXRlIGlucHV0XG4gICAgY29uc3QgaW5wdXRJc1ZhbGlkID0gaXMubnVtYmVyKGlucHV0KSAmJiBpbnB1dCA+IDA7XG5cbiAgICAvLyBTZXRcbiAgICB0aGlzLm1lZGlhLmN1cnJlbnRUaW1lID0gaW5wdXRJc1ZhbGlkID8gTWF0aC5taW4oaW5wdXQsIHRoaXMuZHVyYXRpb24pIDogMDtcblxuICAgIC8vIExvZ2dpbmdcbiAgICB0aGlzLmRlYnVnLmxvZyhgU2Vla2luZyB0byAke3RoaXMuY3VycmVudFRpbWV9IHNlY29uZHNgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgY3VycmVudCB0aW1lXG4gICAqL1xuICBnZXQgY3VycmVudFRpbWUoKSB7XG4gICAgcmV0dXJuIE51bWJlcih0aGlzLm1lZGlhLmN1cnJlbnRUaW1lKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgYnVmZmVyZWRcbiAgICovXG4gIGdldCBidWZmZXJlZCgpIHtcbiAgICBjb25zdCB7IGJ1ZmZlcmVkIH0gPSB0aGlzLm1lZGlhO1xuXG4gICAgLy8gWW91VHViZSAvIFZpbWVvIHJldHVybiBhIGZsb2F0IGJldHdlZW4gMC0xXG4gICAgaWYgKGlzLm51bWJlcihidWZmZXJlZCkpIHtcbiAgICAgIHJldHVybiBidWZmZXJlZDtcbiAgICB9XG5cbiAgICAvLyBIVE1MNVxuICAgIC8vIFRPRE86IEhhbmRsZSBidWZmZXJlZCBjaHVua3Mgb2YgdGhlIG1lZGlhXG4gICAgLy8gKGkuZS4gc2VlayB0byBhbm90aGVyIHNlY3Rpb24gYnVmZmVycyBvbmx5IHRoYXQgc2VjdGlvbilcbiAgICBpZiAoYnVmZmVyZWQgJiYgYnVmZmVyZWQubGVuZ3RoICYmIHRoaXMuZHVyYXRpb24gPiAwKSB7XG4gICAgICByZXR1cm4gYnVmZmVyZWQuZW5kKDApIC8gdGhpcy5kdXJhdGlvbjtcbiAgICB9XG5cbiAgICByZXR1cm4gMDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgc2Vla2luZyBzdGF0dXNcbiAgICovXG4gIGdldCBzZWVraW5nKCkge1xuICAgIHJldHVybiBCb29sZWFuKHRoaXMubWVkaWEuc2Vla2luZyk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSBkdXJhdGlvbiBvZiB0aGUgY3VycmVudCBtZWRpYVxuICAgKi9cbiAgZ2V0IGR1cmF0aW9uKCkge1xuICAgIC8vIEZhdXggZHVyYXRpb24gc2V0IHZpYSBjb25maWdcbiAgICBjb25zdCBmYXV4RHVyYXRpb24gPSBwYXJzZUZsb2F0KHRoaXMuY29uZmlnLmR1cmF0aW9uKTtcbiAgICAvLyBNZWRpYSBkdXJhdGlvbiBjYW4gYmUgTmFOIG9yIEluZmluaXR5IGJlZm9yZSB0aGUgbWVkaWEgaGFzIGxvYWRlZFxuICAgIGNvbnN0IHJlYWxEdXJhdGlvbiA9ICh0aGlzLm1lZGlhIHx8IHt9KS5kdXJhdGlvbjtcbiAgICBjb25zdCBkdXJhdGlvbiA9ICFpcy5udW1iZXIocmVhbER1cmF0aW9uKSB8fCByZWFsRHVyYXRpb24gPT09IEluZmluaXR5ID8gMCA6IHJlYWxEdXJhdGlvbjtcblxuICAgIC8vIElmIGNvbmZpZyBkdXJhdGlvbiBpcyBmdW5reSwgdXNlIHJlZ3VsYXIgZHVyYXRpb25cbiAgICByZXR1cm4gZmF1eER1cmF0aW9uIHx8IGR1cmF0aW9uO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCB0aGUgcGxheWVyIHZvbHVtZVxuICAgKiBAcGFyYW0ge051bWJlcn0gdmFsdWUgLSBtdXN0IGJlIGJldHdlZW4gMCBhbmQgMS4gRGVmYXVsdHMgdG8gdGhlIHZhbHVlIGZyb20gbG9jYWwgc3RvcmFnZSBhbmQgY29uZmlnLnZvbHVtZSBpZiBub3Qgc2V0IGluIHN0b3JhZ2VcbiAgICovXG4gIHNldCB2b2x1bWUodmFsdWUpIHtcbiAgICBsZXQgdm9sdW1lID0gdmFsdWU7XG4gICAgY29uc3QgbWF4ID0gMTtcbiAgICBjb25zdCBtaW4gPSAwO1xuXG4gICAgaWYgKGlzLnN0cmluZyh2b2x1bWUpKSB7XG4gICAgICB2b2x1bWUgPSBOdW1iZXIodm9sdW1lKTtcbiAgICB9XG5cbiAgICAvLyBMb2FkIHZvbHVtZSBmcm9tIHN0b3JhZ2UgaWYgbm8gdmFsdWUgc3BlY2lmaWVkXG4gICAgaWYgKCFpcy5udW1iZXIodm9sdW1lKSkge1xuICAgICAgdm9sdW1lID0gdGhpcy5zdG9yYWdlLmdldCgndm9sdW1lJyk7XG4gICAgfVxuXG4gICAgLy8gVXNlIGNvbmZpZyBpZiBhbGwgZWxzZSBmYWlsc1xuICAgIGlmICghaXMubnVtYmVyKHZvbHVtZSkpIHtcbiAgICAgICh7IHZvbHVtZSB9ID0gdGhpcy5jb25maWcpO1xuICAgIH1cblxuICAgIC8vIE1heGltdW0gaXMgdm9sdW1lTWF4XG4gICAgaWYgKHZvbHVtZSA+IG1heCkge1xuICAgICAgdm9sdW1lID0gbWF4O1xuICAgIH1cbiAgICAvLyBNaW5pbXVtIGlzIHZvbHVtZU1pblxuICAgIGlmICh2b2x1bWUgPCBtaW4pIHtcbiAgICAgIHZvbHVtZSA9IG1pbjtcbiAgICB9XG5cbiAgICAvLyBVcGRhdGUgY29uZmlnXG4gICAgdGhpcy5jb25maWcudm9sdW1lID0gdm9sdW1lO1xuXG4gICAgLy8gU2V0IHRoZSBwbGF5ZXIgdm9sdW1lXG4gICAgdGhpcy5tZWRpYS52b2x1bWUgPSB2b2x1bWU7XG5cbiAgICAvLyBJZiBtdXRlZCwgYW5kIHdlJ3JlIGluY3JlYXNpbmcgdm9sdW1lIG1hbnVhbGx5LCByZXNldCBtdXRlZCBzdGF0ZVxuICAgIGlmICghaXMuZW1wdHkodmFsdWUpICYmIHRoaXMubXV0ZWQgJiYgdm9sdW1lID4gMCkge1xuICAgICAgdGhpcy5tdXRlZCA9IGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIGN1cnJlbnQgcGxheWVyIHZvbHVtZVxuICAgKi9cbiAgZ2V0IHZvbHVtZSgpIHtcbiAgICByZXR1cm4gTnVtYmVyKHRoaXMubWVkaWEudm9sdW1lKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBJbmNyZWFzZSB2b2x1bWVcbiAgICogQHBhcmFtIHtCb29sZWFufSBzdGVwIC0gSG93IG11Y2ggdG8gZGVjcmVhc2UgYnkgKGJldHdlZW4gMCBhbmQgMSlcbiAgICovXG4gIGluY3JlYXNlVm9sdW1lID0gKHN0ZXApID0+IHtcbiAgICBjb25zdCB2b2x1bWUgPSB0aGlzLm1lZGlhLm11dGVkID8gMCA6IHRoaXMudm9sdW1lO1xuICAgIHRoaXMudm9sdW1lID0gdm9sdW1lICsgKGlzLm51bWJlcihzdGVwKSA/IHN0ZXAgOiAwKTtcbiAgfTtcblxuICAvKipcbiAgICogRGVjcmVhc2Ugdm9sdW1lXG4gICAqIEBwYXJhbSB7Qm9vbGVhbn0gc3RlcCAtIEhvdyBtdWNoIHRvIGRlY3JlYXNlIGJ5IChiZXR3ZWVuIDAgYW5kIDEpXG4gICAqL1xuICBkZWNyZWFzZVZvbHVtZSA9IChzdGVwKSA9PiB7XG4gICAgdGhpcy5pbmNyZWFzZVZvbHVtZSgtc3RlcCk7XG4gIH07XG5cbiAgLyoqXG4gICAqIFNldCBtdXRlZCBzdGF0ZVxuICAgKiBAcGFyYW0ge0Jvb2xlYW59IG11dGVcbiAgICovXG4gIHNldCBtdXRlZChtdXRlKSB7XG4gICAgbGV0IHRvZ2dsZSA9IG11dGU7XG5cbiAgICAvLyBMb2FkIG11dGVkIHN0YXRlIGZyb20gc3RvcmFnZVxuICAgIGlmICghaXMuYm9vbGVhbih0b2dnbGUpKSB7XG4gICAgICB0b2dnbGUgPSB0aGlzLnN0b3JhZ2UuZ2V0KCdtdXRlZCcpO1xuICAgIH1cblxuICAgIC8vIFVzZSBjb25maWcgaWYgYWxsIGVsc2UgZmFpbHNcbiAgICBpZiAoIWlzLmJvb2xlYW4odG9nZ2xlKSkge1xuICAgICAgdG9nZ2xlID0gdGhpcy5jb25maWcubXV0ZWQ7XG4gICAgfVxuXG4gICAgLy8gVXBkYXRlIGNvbmZpZ1xuICAgIHRoaXMuY29uZmlnLm11dGVkID0gdG9nZ2xlO1xuXG4gICAgLy8gU2V0IG11dGUgb24gdGhlIHBsYXllclxuICAgIHRoaXMubWVkaWEubXV0ZWQgPSB0b2dnbGU7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGN1cnJlbnQgbXV0ZWQgc3RhdGVcbiAgICovXG4gIGdldCBtdXRlZCgpIHtcbiAgICByZXR1cm4gQm9vbGVhbih0aGlzLm1lZGlhLm11dGVkKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayBpZiB0aGUgbWVkaWEgaGFzIGF1ZGlvXG4gICAqL1xuICBnZXQgaGFzQXVkaW8oKSB7XG4gICAgLy8gQXNzdW1lIHllcyBmb3IgYWxsIG5vbiBIVE1MNSAoYXMgd2UgY2FuJ3QgdGVsbC4uLilcbiAgICBpZiAoIXRoaXMuaXNIVE1MNSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuaXNBdWRpbykge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgLy8gR2V0IGF1ZGlvIHRyYWNrc1xuICAgIHJldHVybiAoXG4gICAgICBCb29sZWFuKHRoaXMubWVkaWEubW96SGFzQXVkaW8pIHx8XG4gICAgICBCb29sZWFuKHRoaXMubWVkaWEud2Via2l0QXVkaW9EZWNvZGVkQnl0ZUNvdW50KSB8fFxuICAgICAgQm9vbGVhbih0aGlzLm1lZGlhLmF1ZGlvVHJhY2tzICYmIHRoaXMubWVkaWEuYXVkaW9UcmFja3MubGVuZ3RoKVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogU2V0IHBsYXliYWNrIHNwZWVkXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBpbnB1dCAtIHRoZSBzcGVlZCBvZiBwbGF5YmFjayAoMC41LTIuMClcbiAgICovXG4gIHNldCBzcGVlZChpbnB1dCkge1xuICAgIGxldCBzcGVlZCA9IG51bGw7XG5cbiAgICBpZiAoaXMubnVtYmVyKGlucHV0KSkge1xuICAgICAgc3BlZWQgPSBpbnB1dDtcbiAgICB9XG5cbiAgICBpZiAoIWlzLm51bWJlcihzcGVlZCkpIHtcbiAgICAgIHNwZWVkID0gdGhpcy5zdG9yYWdlLmdldCgnc3BlZWQnKTtcbiAgICB9XG5cbiAgICBpZiAoIWlzLm51bWJlcihzcGVlZCkpIHtcbiAgICAgIHNwZWVkID0gdGhpcy5jb25maWcuc3BlZWQuc2VsZWN0ZWQ7XG4gICAgfVxuXG4gICAgLy8gQ2xhbXAgdG8gbWluL21heFxuICAgIGNvbnN0IHsgbWluaW11bVNwZWVkOiBtaW4sIG1heGltdW1TcGVlZDogbWF4IH0gPSB0aGlzO1xuICAgIHNwZWVkID0gY2xhbXAoc3BlZWQsIG1pbiwgbWF4KTtcblxuICAgIC8vIFVwZGF0ZSBjb25maWdcbiAgICB0aGlzLmNvbmZpZy5zcGVlZC5zZWxlY3RlZCA9IHNwZWVkO1xuXG4gICAgLy8gU2V0IG1lZGlhIHNwZWVkXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBpZiAodGhpcy5tZWRpYSkge1xuICAgICAgICB0aGlzLm1lZGlhLnBsYXliYWNrUmF0ZSA9IHNwZWVkO1xuICAgICAgfVxuICAgIH0sIDApO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjdXJyZW50IHBsYXliYWNrIHNwZWVkXG4gICAqL1xuICBnZXQgc3BlZWQoKSB7XG4gICAgcmV0dXJuIE51bWJlcih0aGlzLm1lZGlhLnBsYXliYWNrUmF0ZSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSBtaW5pbXVtIGFsbG93ZWQgc3BlZWRcbiAgICovXG4gIGdldCBtaW5pbXVtU3BlZWQoKSB7XG4gICAgaWYgKHRoaXMuaXNZb3VUdWJlKSB7XG4gICAgICAvLyBodHRwczovL2RldmVsb3BlcnMuZ29vZ2xlLmNvbS95b3V0dWJlL2lmcmFtZV9hcGlfcmVmZXJlbmNlI3NldFBsYXliYWNrUmF0ZVxuICAgICAgcmV0dXJuIE1hdGgubWluKC4uLnRoaXMub3B0aW9ucy5zcGVlZCk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuaXNWaW1lbykge1xuICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3ZpbWVvL3BsYXllci5qcy8jc2V0cGxheWJhY2tyYXRlcGxheWJhY2tyYXRlLW51bWJlci1wcm9taXNlbnVtYmVyLXJhbmdlZXJyb3JlcnJvclxuICAgICAgcmV0dXJuIDAuNTtcbiAgICB9XG5cbiAgICAvLyBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL2EvMzIzMjAwMjAvMTE5MTMxOVxuICAgIHJldHVybiAwLjA2MjU7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSBtYXhpbXVtIGFsbG93ZWQgc3BlZWRcbiAgICovXG4gIGdldCBtYXhpbXVtU3BlZWQoKSB7XG4gICAgaWYgKHRoaXMuaXNZb3VUdWJlKSB7XG4gICAgICAvLyBodHRwczovL2RldmVsb3BlcnMuZ29vZ2xlLmNvbS95b3V0dWJlL2lmcmFtZV9hcGlfcmVmZXJlbmNlI3NldFBsYXliYWNrUmF0ZVxuICAgICAgcmV0dXJuIE1hdGgubWF4KC4uLnRoaXMub3B0aW9ucy5zcGVlZCk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuaXNWaW1lbykge1xuICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3ZpbWVvL3BsYXllci5qcy8jc2V0cGxheWJhY2tyYXRlcGxheWJhY2tyYXRlLW51bWJlci1wcm9taXNlbnVtYmVyLXJhbmdlZXJyb3JlcnJvclxuICAgICAgcmV0dXJuIDI7XG4gICAgfVxuXG4gICAgLy8gaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9hLzMyMzIwMDIwLzExOTEzMTlcbiAgICByZXR1cm4gMTY7XG4gIH1cblxuICAvKipcbiAgICogU2V0IHBsYXliYWNrIHF1YWxpdHlcbiAgICogQ3VycmVudGx5IEhUTUw1ICYgWW91VHViZSBvbmx5XG4gICAqIEBwYXJhbSB7TnVtYmVyfSBpbnB1dCAtIFF1YWxpdHkgbGV2ZWxcbiAgICovXG4gIHNldCBxdWFsaXR5KGlucHV0KSB7XG4gICAgY29uc3QgY29uZmlnID0gdGhpcy5jb25maWcucXVhbGl0eTtcbiAgICBjb25zdCBvcHRpb25zID0gdGhpcy5vcHRpb25zLnF1YWxpdHk7XG5cbiAgICBpZiAoIW9wdGlvbnMubGVuZ3RoKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgbGV0IHF1YWxpdHkgPSBbXG4gICAgICAhaXMuZW1wdHkoaW5wdXQpICYmIE51bWJlcihpbnB1dCksXG4gICAgICB0aGlzLnN0b3JhZ2UuZ2V0KCdxdWFsaXR5JyksXG4gICAgICBjb25maWcuc2VsZWN0ZWQsXG4gICAgICBjb25maWcuZGVmYXVsdCxcbiAgICBdLmZpbmQoaXMubnVtYmVyKTtcblxuICAgIGxldCB1cGRhdGVTdG9yYWdlID0gdHJ1ZTtcblxuICAgIGlmICghb3B0aW9ucy5pbmNsdWRlcyhxdWFsaXR5KSkge1xuICAgICAgY29uc3QgdmFsdWUgPSBjbG9zZXN0KG9wdGlvbnMsIHF1YWxpdHkpO1xuICAgICAgdGhpcy5kZWJ1Zy53YXJuKGBVbnN1cHBvcnRlZCBxdWFsaXR5IG9wdGlvbjogJHtxdWFsaXR5fSwgdXNpbmcgJHt2YWx1ZX0gaW5zdGVhZGApO1xuICAgICAgcXVhbGl0eSA9IHZhbHVlO1xuXG4gICAgICAvLyBEb24ndCB1cGRhdGUgc3RvcmFnZSBpZiBxdWFsaXR5IGlzIG5vdCBzdXBwb3J0ZWRcbiAgICAgIHVwZGF0ZVN0b3JhZ2UgPSBmYWxzZTtcbiAgICB9XG5cbiAgICAvLyBVcGRhdGUgY29uZmlnXG4gICAgY29uZmlnLnNlbGVjdGVkID0gcXVhbGl0eTtcblxuICAgIC8vIFNldCBxdWFsaXR5XG4gICAgdGhpcy5tZWRpYS5xdWFsaXR5ID0gcXVhbGl0eTtcblxuICAgIC8vIFNhdmUgdG8gc3RvcmFnZVxuICAgIGlmICh1cGRhdGVTdG9yYWdlKSB7XG4gICAgICB0aGlzLnN0b3JhZ2Uuc2V0KHsgcXVhbGl0eSB9KTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0IGN1cnJlbnQgcXVhbGl0eSBsZXZlbFxuICAgKi9cbiAgZ2V0IHF1YWxpdHkoKSB7XG4gICAgcmV0dXJuIHRoaXMubWVkaWEucXVhbGl0eTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUb2dnbGUgbG9vcFxuICAgKiBUT0RPOiBGaW5pc2ggZmFuY3kgbmV3IGxvZ2ljLiBTZXQgdGhlIGluZGljYXRvciBvbiBsb2FkIGFzIHVzZXIgbWF5IHBhc3MgbG9vcCBhcyBjb25maWdcbiAgICogQHBhcmFtIHtCb29sZWFufSBpbnB1dCAtIFdoZXRoZXIgdG8gbG9vcCBvciBub3RcbiAgICovXG4gIHNldCBsb29wKGlucHV0KSB7XG4gICAgY29uc3QgdG9nZ2xlID0gaXMuYm9vbGVhbihpbnB1dCkgPyBpbnB1dCA6IHRoaXMuY29uZmlnLmxvb3AuYWN0aXZlO1xuICAgIHRoaXMuY29uZmlnLmxvb3AuYWN0aXZlID0gdG9nZ2xlO1xuICAgIHRoaXMubWVkaWEubG9vcCA9IHRvZ2dsZTtcblxuICAgIC8vIFNldCBkZWZhdWx0IHRvIGJlIGEgdHJ1ZSB0b2dnbGVcbiAgICAvKiBjb25zdCB0eXBlID0gWydzdGFydCcsICdlbmQnLCAnYWxsJywgJ25vbmUnLCAndG9nZ2xlJ10uaW5jbHVkZXMoaW5wdXQpID8gaW5wdXQgOiAndG9nZ2xlJztcblxuICAgICAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgJ3N0YXJ0JzpcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jb25maWcubG9vcC5lbmQgJiYgdGhpcy5jb25maWcubG9vcC5lbmQgPD0gdGhpcy5jdXJyZW50VGltZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZy5sb29wLmVuZCA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuY29uZmlnLmxvb3Auc3RhcnQgPSB0aGlzLmN1cnJlbnRUaW1lO1xuICAgICAgICAgICAgICAgIC8vIHRoaXMuY29uZmlnLmxvb3AuaW5kaWNhdG9yLnN0YXJ0ID0gdGhpcy5lbGVtZW50cy5kaXNwbGF5LnBsYXllZC52YWx1ZTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSAnZW5kJzpcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jb25maWcubG9vcC5zdGFydCA+PSB0aGlzLmN1cnJlbnRUaW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZy5sb29wLmVuZCA9IHRoaXMuY3VycmVudFRpbWU7XG4gICAgICAgICAgICAgICAgLy8gdGhpcy5jb25maWcubG9vcC5pbmRpY2F0b3IuZW5kID0gdGhpcy5lbGVtZW50cy5kaXNwbGF5LnBsYXllZC52YWx1ZTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSAnYWxsJzpcbiAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZy5sb29wLnN0YXJ0ID0gMDtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZy5sb29wLmVuZCA9IHRoaXMuZHVyYXRpb24gLSAyO1xuICAgICAgICAgICAgICAgIHRoaXMuY29uZmlnLmxvb3AuaW5kaWNhdG9yLnN0YXJ0ID0gMDtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZy5sb29wLmluZGljYXRvci5lbmQgPSAxMDA7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgJ3RvZ2dsZSc6XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY29uZmlnLmxvb3AuYWN0aXZlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29uZmlnLmxvb3Auc3RhcnQgPSAwO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZy5sb29wLmVuZCA9IG51bGw7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25maWcubG9vcC5zdGFydCA9IDA7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29uZmlnLmxvb3AuZW5kID0gdGhpcy5kdXJhdGlvbiAtIDI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHRoaXMuY29uZmlnLmxvb3Auc3RhcnQgPSAwO1xuICAgICAgICAgICAgICAgIHRoaXMuY29uZmlnLmxvb3AuZW5kID0gbnVsbDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfSAqL1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjdXJyZW50IGxvb3Agc3RhdGVcbiAgICovXG4gIGdldCBsb29wKCkge1xuICAgIHJldHVybiBCb29sZWFuKHRoaXMubWVkaWEubG9vcCk7XG4gIH1cblxuICAvKipcbiAgICogU2V0IG5ldyBtZWRpYSBzb3VyY2VcbiAgICogQHBhcmFtIHtPYmplY3R9IGlucHV0IC0gVGhlIG5ldyBzb3VyY2Ugb2JqZWN0IChzZWUgZG9jcylcbiAgICovXG4gIHNldCBzb3VyY2UoaW5wdXQpIHtcbiAgICBzb3VyY2UuY2hhbmdlLmNhbGwodGhpcywgaW5wdXQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjdXJyZW50IHNvdXJjZVxuICAgKi9cbiAgZ2V0IHNvdXJjZSgpIHtcbiAgICByZXR1cm4gdGhpcy5tZWRpYS5jdXJyZW50U3JjO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBhIGRvd25sb2FkIFVSTCAoZWl0aGVyIHNvdXJjZSBvciBjdXN0b20pXG4gICAqL1xuICBnZXQgZG93bmxvYWQoKSB7XG4gICAgY29uc3QgeyBkb3dubG9hZCB9ID0gdGhpcy5jb25maWcudXJscztcblxuICAgIHJldHVybiBpcy51cmwoZG93bmxvYWQpID8gZG93bmxvYWQgOiB0aGlzLnNvdXJjZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgdGhlIGRvd25sb2FkIFVSTFxuICAgKi9cbiAgc2V0IGRvd25sb2FkKGlucHV0KSB7XG4gICAgaWYgKCFpcy51cmwoaW5wdXQpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5jb25maWcudXJscy5kb3dubG9hZCA9IGlucHV0O1xuXG4gICAgY29udHJvbHMuc2V0RG93bmxvYWRVcmwuY2FsbCh0aGlzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgdGhlIHBvc3RlciBpbWFnZSBmb3IgYSB2aWRlb1xuICAgKiBAcGFyYW0ge1N0cmluZ30gaW5wdXQgLSB0aGUgVVJMIGZvciB0aGUgbmV3IHBvc3RlciBpbWFnZVxuICAgKi9cbiAgc2V0IHBvc3RlcihpbnB1dCkge1xuICAgIGlmICghdGhpcy5pc1ZpZGVvKSB7XG4gICAgICB0aGlzLmRlYnVnLndhcm4oJ1Bvc3RlciBjYW4gb25seSBiZSBzZXQgZm9yIHZpZGVvJyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdWkuc2V0UG9zdGVyLmNhbGwodGhpcywgaW5wdXQsIGZhbHNlKS5jYXRjaCgoKSA9PiB7fSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSBjdXJyZW50IHBvc3RlciBpbWFnZVxuICAgKi9cbiAgZ2V0IHBvc3RlcigpIHtcbiAgICBpZiAoIXRoaXMuaXNWaWRlbykge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMubWVkaWEuZ2V0QXR0cmlidXRlKCdwb3N0ZXInKSB8fCB0aGlzLm1lZGlhLmdldEF0dHJpYnV0ZSgnZGF0YS1wb3N0ZXInKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIGN1cnJlbnQgYXNwZWN0IHJhdGlvIGluIHVzZVxuICAgKi9cbiAgZ2V0IHJhdGlvKCkge1xuICAgIGlmICghdGhpcy5pc1ZpZGVvKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBjb25zdCByYXRpbyA9IHJlZHVjZUFzcGVjdFJhdGlvKGdldEFzcGVjdFJhdGlvLmNhbGwodGhpcykpO1xuXG4gICAgcmV0dXJuIGlzLmFycmF5KHJhdGlvKSA/IHJhdGlvLmpvaW4oJzonKSA6IHJhdGlvO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCB2aWRlbyBhc3BlY3QgcmF0aW9cbiAgICovXG4gIHNldCByYXRpbyhpbnB1dCkge1xuICAgIGlmICghdGhpcy5pc1ZpZGVvKSB7XG4gICAgICB0aGlzLmRlYnVnLndhcm4oJ0FzcGVjdCByYXRpbyBjYW4gb25seSBiZSBzZXQgZm9yIHZpZGVvJyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKCFpcy5zdHJpbmcoaW5wdXQpIHx8ICF2YWxpZGF0ZUFzcGVjdFJhdGlvKGlucHV0KSkge1xuICAgICAgdGhpcy5kZWJ1Zy5lcnJvcihgSW52YWxpZCBhc3BlY3QgcmF0aW8gc3BlY2lmaWVkICgke2lucHV0fSlgKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmNvbmZpZy5yYXRpbyA9IHJlZHVjZUFzcGVjdFJhdGlvKGlucHV0KTtcblxuICAgIHNldEFzcGVjdFJhdGlvLmNhbGwodGhpcyk7XG4gIH1cblxuICAvKipcbiAgICogU2V0IHRoZSBhdXRvcGxheSBzdGF0ZVxuICAgKiBAcGFyYW0ge0Jvb2xlYW59IGlucHV0IC0gV2hldGhlciB0byBhdXRvcGxheSBvciBub3RcbiAgICovXG4gIHNldCBhdXRvcGxheShpbnB1dCkge1xuICAgIHRoaXMuY29uZmlnLmF1dG9wbGF5ID0gaXMuYm9vbGVhbihpbnB1dCkgPyBpbnB1dCA6IHRoaXMuY29uZmlnLmF1dG9wbGF5O1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgY3VycmVudCBhdXRvcGxheSBzdGF0ZVxuICAgKi9cbiAgZ2V0IGF1dG9wbGF5KCkge1xuICAgIHJldHVybiBCb29sZWFuKHRoaXMuY29uZmlnLmF1dG9wbGF5KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUb2dnbGUgY2FwdGlvbnNcbiAgICogQHBhcmFtIHtCb29sZWFufSBpbnB1dCAtIFdoZXRoZXIgdG8gZW5hYmxlIGNhcHRpb25zXG4gICAqL1xuICB0b2dnbGVDYXB0aW9ucyhpbnB1dCkge1xuICAgIGNhcHRpb25zLnRvZ2dsZS5jYWxsKHRoaXMsIGlucHV0LCBmYWxzZSk7XG4gIH1cblxuICAvKipcbiAgICogU2V0IHRoZSBjYXB0aW9uIHRyYWNrIGJ5IGluZGV4XG4gICAqIEBwYXJhbSB7TnVtYmVyfSBpbnB1dCAtIENhcHRpb24gaW5kZXhcbiAgICovXG4gIHNldCBjdXJyZW50VHJhY2soaW5wdXQpIHtcbiAgICBjYXB0aW9ucy5zZXQuY2FsbCh0aGlzLCBpbnB1dCwgZmFsc2UpO1xuICAgIGNhcHRpb25zLnNldHVwLmNhbGwodGhpcyk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSBjdXJyZW50IGNhcHRpb24gdHJhY2sgaW5kZXggKC0xIGlmIGRpc2FibGVkKVxuICAgKi9cbiAgZ2V0IGN1cnJlbnRUcmFjaygpIHtcbiAgICBjb25zdCB7IHRvZ2dsZWQsIGN1cnJlbnRUcmFjayB9ID0gdGhpcy5jYXB0aW9ucztcbiAgICByZXR1cm4gdG9nZ2xlZCA/IGN1cnJlbnRUcmFjayA6IC0xO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCB0aGUgd2FudGVkIGxhbmd1YWdlIGZvciBjYXB0aW9uc1xuICAgKiBTaW5jZSB0cmFja3MgY2FuIGJlIGFkZGVkIGxhdGVyIGl0IHdvbid0IHVwZGF0ZSB0aGUgYWN0dWFsIGNhcHRpb24gdHJhY2sgdW50aWwgdGhlcmUgaXMgYSBtYXRjaGluZyB0cmFja1xuICAgKiBAcGFyYW0ge1N0cmluZ30gaW5wdXQgLSBUd28gY2hhcmFjdGVyIElTTyBsYW5ndWFnZSBjb2RlIChlLmcuIEVOLCBGUiwgUFQsIGV0YylcbiAgICovXG4gIHNldCBsYW5ndWFnZShpbnB1dCkge1xuICAgIGNhcHRpb25zLnNldExhbmd1YWdlLmNhbGwodGhpcywgaW5wdXQsIGZhbHNlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIGN1cnJlbnQgdHJhY2sncyBsYW5ndWFnZVxuICAgKi9cbiAgZ2V0IGxhbmd1YWdlKCkge1xuICAgIHJldHVybiAoY2FwdGlvbnMuZ2V0Q3VycmVudFRyYWNrLmNhbGwodGhpcykgfHwge30pLmxhbmd1YWdlO1xuICB9XG5cbiAgLyoqXG4gICAqIFRvZ2dsZSBwaWN0dXJlLWluLXBpY3R1cmUgcGxheWJhY2sgb24gV2ViS2l0L01hY09TXG4gICAqIFRPRE86IHVwZGF0ZSBwbGF5ZXIgd2l0aCBzdGF0ZSwgc3VwcG9ydCwgZW5hYmxlZFxuICAgKiBUT0RPOiBkZXRlY3Qgb3V0c2lkZSBjaGFuZ2VzXG4gICAqL1xuICBzZXQgcGlwKGlucHV0KSB7XG4gICAgLy8gQmFpbCBpZiBubyBzdXBwb3J0XG4gICAgaWYgKCFzdXBwb3J0LnBpcCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIFRvZ2dsZSBiYXNlZCBvbiBjdXJyZW50IHN0YXRlIGlmIG5vdCBwYXNzZWRcbiAgICBjb25zdCB0b2dnbGUgPSBpcy5ib29sZWFuKGlucHV0KSA/IGlucHV0IDogIXRoaXMucGlwO1xuXG4gICAgLy8gVG9nZ2xlIGJhc2VkIG9uIGN1cnJlbnQgc3RhdGVcbiAgICAvLyBTYWZhcmlcbiAgICBpZiAoaXMuZnVuY3Rpb24odGhpcy5tZWRpYS53ZWJraXRTZXRQcmVzZW50YXRpb25Nb2RlKSkge1xuICAgICAgdGhpcy5tZWRpYS53ZWJraXRTZXRQcmVzZW50YXRpb25Nb2RlKHRvZ2dsZSA/IHBpcC5hY3RpdmUgOiBwaXAuaW5hY3RpdmUpO1xuICAgIH1cblxuICAgIC8vIENocm9tZVxuICAgIGlmIChpcy5mdW5jdGlvbih0aGlzLm1lZGlhLnJlcXVlc3RQaWN0dXJlSW5QaWN0dXJlKSkge1xuICAgICAgaWYgKCF0aGlzLnBpcCAmJiB0b2dnbGUpIHtcbiAgICAgICAgdGhpcy5tZWRpYS5yZXF1ZXN0UGljdHVyZUluUGljdHVyZSgpO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLnBpcCAmJiAhdG9nZ2xlKSB7XG4gICAgICAgIGRvY3VtZW50LmV4aXRQaWN0dXJlSW5QaWN0dXJlKCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgY3VycmVudCBwaWN0dXJlLWluLXBpY3R1cmUgc3RhdGVcbiAgICovXG4gIGdldCBwaXAoKSB7XG4gICAgaWYgKCFzdXBwb3J0LnBpcCkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgLy8gU2FmYXJpXG4gICAgaWYgKCFpcy5lbXB0eSh0aGlzLm1lZGlhLndlYmtpdFByZXNlbnRhdGlvbk1vZGUpKSB7XG4gICAgICByZXR1cm4gdGhpcy5tZWRpYS53ZWJraXRQcmVzZW50YXRpb25Nb2RlID09PSBwaXAuYWN0aXZlO1xuICAgIH1cblxuICAgIC8vIENocm9tZVxuICAgIHJldHVybiB0aGlzLm1lZGlhID09PSBkb2N1bWVudC5waWN0dXJlSW5QaWN0dXJlRWxlbWVudDtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXRzIHRoZSBwcmV2aWV3IHRodWJtbmFpbHMgZm9yIHRoZSBjdXJyZW50IHNvdXJjZVxuICAgKi9cbiAgc2V0UHJldmlld1RodW1ibmFpbHModGh1bWJuYWlsU291cmNlKSB7XG4gICAgaWYgKHRoaXMucHJldmlld1RodW1ibmFpbHMgJiYgdGhpcy5wcmV2aWV3VGh1bWJuYWlscy5sb2FkZWQpIHtcbiAgICAgIHRoaXMucHJldmlld1RodW1ibmFpbHMuZGVzdHJveSgpO1xuICAgICAgdGhpcy5wcmV2aWV3VGh1bWJuYWlscyA9IG51bGw7XG4gICAgfVxuXG4gICAgT2JqZWN0LmFzc2lnbih0aGlzLmNvbmZpZy5wcmV2aWV3VGh1bWJuYWlscywgdGh1bWJuYWlsU291cmNlKTtcblxuICAgIC8vIENyZWF0ZSBuZXcgaW5zdGFuY2UgaWYgaXQgaXMgc3RpbGwgZW5hYmxlZFxuICAgIGlmICh0aGlzLmNvbmZpZy5wcmV2aWV3VGh1bWJuYWlscy5lbmFibGVkKSB7XG4gICAgICB0aGlzLnByZXZpZXdUaHVtYm5haWxzID0gbmV3IFByZXZpZXdUaHVtYm5haWxzKHRoaXMpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBUcmlnZ2VyIHRoZSBhaXJwbGF5IGRpYWxvZ1xuICAgKiBUT0RPOiB1cGRhdGUgcGxheWVyIHdpdGggc3RhdGUsIHN1cHBvcnQsIGVuYWJsZWRcbiAgICovXG4gIGFpcnBsYXkgPSAoKSA9PiB7XG4gICAgLy8gU2hvdyBkaWFsb2cgaWYgc3VwcG9ydGVkXG4gICAgaWYgKHN1cHBvcnQuYWlycGxheSkge1xuICAgICAgdGhpcy5tZWRpYS53ZWJraXRTaG93UGxheWJhY2tUYXJnZXRQaWNrZXIoKTtcbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICAqIFRvZ2dsZSB0aGUgcGxheWVyIGNvbnRyb2xzXG4gICAqIEBwYXJhbSB7Qm9vbGVhbn0gW3RvZ2dsZV0gLSBXaGV0aGVyIHRvIHNob3cgdGhlIGNvbnRyb2xzXG4gICAqL1xuICB0b2dnbGVDb250cm9scyA9ICh0b2dnbGUpID0+IHtcbiAgICAvLyBEb24ndCB0b2dnbGUgaWYgbWlzc2luZyBVSSBzdXBwb3J0IG9yIGlmIGl0J3MgYXVkaW9cbiAgICBpZiAodGhpcy5zdXBwb3J0ZWQudWkgJiYgIXRoaXMuaXNBdWRpbykge1xuICAgICAgLy8gR2V0IHN0YXRlIGJlZm9yZSBjaGFuZ2VcbiAgICAgIGNvbnN0IGlzSGlkZGVuID0gaGFzQ2xhc3ModGhpcy5lbGVtZW50cy5jb250YWluZXIsIHRoaXMuY29uZmlnLmNsYXNzTmFtZXMuaGlkZUNvbnRyb2xzKTtcbiAgICAgIC8vIE5lZ2F0ZSB0aGUgYXJndW1lbnQgaWYgbm90IHVuZGVmaW5lZCBzaW5jZSBhZGRpbmcgdGhlIGNsYXNzIHRvIGhpZGVzIHRoZSBjb250cm9sc1xuICAgICAgY29uc3QgZm9yY2UgPSB0eXBlb2YgdG9nZ2xlID09PSAndW5kZWZpbmVkJyA/IHVuZGVmaW5lZCA6ICF0b2dnbGU7XG4gICAgICAvLyBBcHBseSBhbmQgZ2V0IHVwZGF0ZWQgc3RhdGVcbiAgICAgIGNvbnN0IGhpZGluZyA9IHRvZ2dsZUNsYXNzKHRoaXMuZWxlbWVudHMuY29udGFpbmVyLCB0aGlzLmNvbmZpZy5jbGFzc05hbWVzLmhpZGVDb250cm9scywgZm9yY2UpO1xuXG4gICAgICAvLyBDbG9zZSBtZW51XG4gICAgICBpZiAoXG4gICAgICAgIGhpZGluZyAmJlxuICAgICAgICBpcy5hcnJheSh0aGlzLmNvbmZpZy5jb250cm9scykgJiZcbiAgICAgICAgdGhpcy5jb25maWcuY29udHJvbHMuaW5jbHVkZXMoJ3NldHRpbmdzJykgJiZcbiAgICAgICAgIWlzLmVtcHR5KHRoaXMuY29uZmlnLnNldHRpbmdzKVxuICAgICAgKSB7XG4gICAgICAgIGNvbnRyb2xzLnRvZ2dsZU1lbnUuY2FsbCh0aGlzLCBmYWxzZSk7XG4gICAgICB9XG5cbiAgICAgIC8vIFRyaWdnZXIgZXZlbnQgb24gY2hhbmdlXG4gICAgICBpZiAoaGlkaW5nICE9PSBpc0hpZGRlbikge1xuICAgICAgICBjb25zdCBldmVudE5hbWUgPSBoaWRpbmcgPyAnY29udHJvbHNoaWRkZW4nIDogJ2NvbnRyb2xzc2hvd24nO1xuICAgICAgICB0cmlnZ2VyRXZlbnQuY2FsbCh0aGlzLCB0aGlzLm1lZGlhLCBldmVudE5hbWUpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gIWhpZGluZztcbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG5cbiAgLyoqXG4gICAqIEFkZCBldmVudCBsaXN0ZW5lcnNcbiAgICogQHBhcmFtIHtTdHJpbmd9IGV2ZW50IC0gRXZlbnQgdHlwZVxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayAtIENhbGxiYWNrIGZvciB3aGVuIGV2ZW50IG9jY3Vyc1xuICAgKi9cbiAgb24gPSAoZXZlbnQsIGNhbGxiYWNrKSA9PiB7XG4gICAgb24uY2FsbCh0aGlzLCB0aGlzLmVsZW1lbnRzLmNvbnRhaW5lciwgZXZlbnQsIGNhbGxiYWNrKTtcbiAgfTtcblxuICAvKipcbiAgICogQWRkIGV2ZW50IGxpc3RlbmVycyBvbmNlXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBldmVudCAtIEV2ZW50IHR5cGVcbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgLSBDYWxsYmFjayBmb3Igd2hlbiBldmVudCBvY2N1cnNcbiAgICovXG4gIG9uY2UgPSAoZXZlbnQsIGNhbGxiYWNrKSA9PiB7XG4gICAgb25jZS5jYWxsKHRoaXMsIHRoaXMuZWxlbWVudHMuY29udGFpbmVyLCBldmVudCwgY2FsbGJhY2spO1xuICB9O1xuXG4gIC8qKlxuICAgKiBSZW1vdmUgZXZlbnQgbGlzdGVuZXJzXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBldmVudCAtIEV2ZW50IHR5cGVcbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgLSBDYWxsYmFjayBmb3Igd2hlbiBldmVudCBvY2N1cnNcbiAgICovXG4gIG9mZiA9IChldmVudCwgY2FsbGJhY2spID0+IHtcbiAgICBvZmYodGhpcy5lbGVtZW50cy5jb250YWluZXIsIGV2ZW50LCBjYWxsYmFjayk7XG4gIH07XG5cbiAgLyoqXG4gICAqIERlc3Ryb3kgYW4gaW5zdGFuY2VcbiAgICogRXZlbnQgbGlzdGVuZXJzIGFyZSByZW1vdmVkIHdoZW4gZWxlbWVudHMgYXJlIHJlbW92ZWRcbiAgICogaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8xMjUyODA0OS9pZi1hLWRvbS1lbGVtZW50LWlzLXJlbW92ZWQtYXJlLWl0cy1saXN0ZW5lcnMtYWxzby1yZW1vdmVkLWZyb20tbWVtb3J5XG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIC0gQ2FsbGJhY2sgZm9yIHdoZW4gZGVzdHJveSBpcyBjb21wbGV0ZVxuICAgKiBAcGFyYW0ge0Jvb2xlYW59IHNvZnQgLSBXaGV0aGVyIGl0J3MgYSBzb2Z0IGRlc3Ryb3kgKGZvciBzb3VyY2UgY2hhbmdlcyBldGMpXG4gICAqL1xuICBkZXN0cm95ID0gKGNhbGxiYWNrLCBzb2Z0ID0gZmFsc2UpID0+IHtcbiAgICBpZiAoIXRoaXMucmVhZHkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBkb25lID0gKCkgPT4ge1xuICAgICAgLy8gUmVzZXQgb3ZlcmZsb3cgKGluY2FzZSBkZXN0cm95ZWQgd2hpbGUgaW4gZnVsbHNjcmVlbilcbiAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUub3ZlcmZsb3cgPSAnJztcblxuICAgICAgLy8gR0MgZm9yIGVtYmVkXG4gICAgICB0aGlzLmVtYmVkID0gbnVsbDtcblxuICAgICAgLy8gSWYgaXQncyBhIHNvZnQgZGVzdHJveSwgbWFrZSBtaW5pbWFsIGNoYW5nZXNcbiAgICAgIGlmIChzb2Z0KSB7XG4gICAgICAgIGlmIChPYmplY3Qua2V5cyh0aGlzLmVsZW1lbnRzKS5sZW5ndGgpIHtcbiAgICAgICAgICAvLyBSZW1vdmUgZWxlbWVudHNcbiAgICAgICAgICByZW1vdmVFbGVtZW50KHRoaXMuZWxlbWVudHMuYnV0dG9ucy5wbGF5KTtcbiAgICAgICAgICByZW1vdmVFbGVtZW50KHRoaXMuZWxlbWVudHMuY2FwdGlvbnMpO1xuICAgICAgICAgIHJlbW92ZUVsZW1lbnQodGhpcy5lbGVtZW50cy5jb250cm9scyk7XG4gICAgICAgICAgcmVtb3ZlRWxlbWVudCh0aGlzLmVsZW1lbnRzLndyYXBwZXIpO1xuXG4gICAgICAgICAgLy8gQ2xlYXIgZm9yIEdDXG4gICAgICAgICAgdGhpcy5lbGVtZW50cy5idXR0b25zLnBsYXkgPSBudWxsO1xuICAgICAgICAgIHRoaXMuZWxlbWVudHMuY2FwdGlvbnMgPSBudWxsO1xuICAgICAgICAgIHRoaXMuZWxlbWVudHMuY29udHJvbHMgPSBudWxsO1xuICAgICAgICAgIHRoaXMuZWxlbWVudHMud3JhcHBlciA9IG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDYWxsYmFja1xuICAgICAgICBpZiAoaXMuZnVuY3Rpb24oY2FsbGJhY2spKSB7XG4gICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gVW5iaW5kIGxpc3RlbmVyc1xuICAgICAgICB1bmJpbmRMaXN0ZW5lcnMuY2FsbCh0aGlzKTtcblxuICAgICAgICAvLyBDYW5jZWwgY3VycmVudCBuZXR3b3JrIHJlcXVlc3RzXG4gICAgICAgIGh0bWw1LmNhbmNlbFJlcXVlc3RzLmNhbGwodGhpcyk7XG5cbiAgICAgICAgLy8gUmVwbGFjZSB0aGUgY29udGFpbmVyIHdpdGggdGhlIG9yaWdpbmFsIGVsZW1lbnQgcHJvdmlkZWRcbiAgICAgICAgcmVwbGFjZUVsZW1lbnQodGhpcy5lbGVtZW50cy5vcmlnaW5hbCwgdGhpcy5lbGVtZW50cy5jb250YWluZXIpO1xuXG4gICAgICAgIC8vIEV2ZW50XG4gICAgICAgIHRyaWdnZXJFdmVudC5jYWxsKHRoaXMsIHRoaXMuZWxlbWVudHMub3JpZ2luYWwsICdkZXN0cm95ZWQnLCB0cnVlKTtcblxuICAgICAgICAvLyBDYWxsYmFja1xuICAgICAgICBpZiAoaXMuZnVuY3Rpb24oY2FsbGJhY2spKSB7XG4gICAgICAgICAgY2FsbGJhY2suY2FsbCh0aGlzLmVsZW1lbnRzLm9yaWdpbmFsKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFJlc2V0IHN0YXRlXG4gICAgICAgIHRoaXMucmVhZHkgPSBmYWxzZTtcblxuICAgICAgICAvLyBDbGVhciBmb3IgZ2FyYmFnZSBjb2xsZWN0aW9uXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgIHRoaXMuZWxlbWVudHMgPSBudWxsO1xuICAgICAgICAgIHRoaXMubWVkaWEgPSBudWxsO1xuICAgICAgICB9LCAyMDApO1xuICAgICAgfVxuICAgIH07XG5cbiAgICAvLyBTdG9wIHBsYXliYWNrXG4gICAgdGhpcy5zdG9wKCk7XG5cbiAgICAvLyBDbGVhciB0aW1lb3V0c1xuICAgIGNsZWFyVGltZW91dCh0aGlzLnRpbWVycy5sb2FkaW5nKTtcbiAgICBjbGVhclRpbWVvdXQodGhpcy50aW1lcnMuY29udHJvbHMpO1xuICAgIGNsZWFyVGltZW91dCh0aGlzLnRpbWVycy5yZXNpemVkKTtcblxuICAgIC8vIFByb3ZpZGVyIHNwZWNpZmljIHN0dWZmXG4gICAgaWYgKHRoaXMuaXNIVE1MNSkge1xuICAgICAgLy8gUmVzdG9yZSBuYXRpdmUgdmlkZW8gY29udHJvbHNcbiAgICAgIHVpLnRvZ2dsZU5hdGl2ZUNvbnRyb2xzLmNhbGwodGhpcywgdHJ1ZSk7XG5cbiAgICAgIC8vIENsZWFuIHVwXG4gICAgICBkb25lKCk7XG4gICAgfSBlbHNlIGlmICh0aGlzLmlzWW91VHViZSkge1xuICAgICAgLy8gQ2xlYXIgdGltZXJzXG4gICAgICBjbGVhckludGVydmFsKHRoaXMudGltZXJzLmJ1ZmZlcmluZyk7XG4gICAgICBjbGVhckludGVydmFsKHRoaXMudGltZXJzLnBsYXlpbmcpO1xuXG4gICAgICAvLyBEZXN0cm95IFlvdVR1YmUgQVBJXG4gICAgICBpZiAodGhpcy5lbWJlZCAhPT0gbnVsbCAmJiBpcy5mdW5jdGlvbih0aGlzLmVtYmVkLmRlc3Ryb3kpKSB7XG4gICAgICAgIHRoaXMuZW1iZWQuZGVzdHJveSgpO1xuICAgICAgfVxuXG4gICAgICAvLyBDbGVhbiB1cFxuICAgICAgZG9uZSgpO1xuICAgIH0gZWxzZSBpZiAodGhpcy5pc1ZpbWVvKSB7XG4gICAgICAvLyBEZXN0cm95IFZpbWVvIEFQSVxuICAgICAgLy8gdGhlbiBjbGVhbiB1cCAod2FpdCwgdG8gcHJldmVudCBwb3N0bWVzc2FnZSBlcnJvcnMpXG4gICAgICBpZiAodGhpcy5lbWJlZCAhPT0gbnVsbCkge1xuICAgICAgICB0aGlzLmVtYmVkLnVubG9hZCgpLnRoZW4oZG9uZSk7XG4gICAgICB9XG5cbiAgICAgIC8vIFZpbWVvIGRvZXMgbm90IGFsd2F5cyByZXR1cm5cbiAgICAgIHNldFRpbWVvdXQoZG9uZSwgMjAwKTtcbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICAqIENoZWNrIGZvciBzdXBwb3J0IGZvciBhIG1pbWUgdHlwZSAoSFRNTDUgb25seSlcbiAgICogQHBhcmFtIHtTdHJpbmd9IHR5cGUgLSBNaW1lIHR5cGVcbiAgICovXG4gIHN1cHBvcnRzID0gKHR5cGUpID0+IHN1cHBvcnQubWltZS5jYWxsKHRoaXMsIHR5cGUpO1xuXG4gIC8qKlxuICAgKiBDaGVjayBmb3Igc3VwcG9ydFxuICAgKiBAcGFyYW0ge1N0cmluZ30gdHlwZSAtIFBsYXllciB0eXBlIChhdWRpby92aWRlbylcbiAgICogQHBhcmFtIHtTdHJpbmd9IHByb3ZpZGVyIC0gUHJvdmlkZXIgKGh0bWw1L3lvdXR1YmUvdmltZW8pXG4gICAqIEBwYXJhbSB7Qm9vbGVhbn0gaW5saW5lIC0gV2hlcmUgcGxheWVyIGhhcyBgcGxheXNpbmxpbmVgIHN0dHJpYnV0ZVxuICAgKi9cbiAgc3RhdGljIHN1cHBvcnRlZCh0eXBlLCBwcm92aWRlciwgaW5saW5lKSB7XG4gICAgcmV0dXJuIHN1cHBvcnQuY2hlY2sodHlwZSwgcHJvdmlkZXIsIGlubGluZSk7XG4gIH1cblxuICAvKipcbiAgICogTG9hZCBhbiBTVkcgc3ByaXRlIGludG8gdGhlIHBhZ2VcbiAgICogQHBhcmFtIHtTdHJpbmd9IHVybCAtIFVSTCBmb3IgdGhlIFNWRyBzcHJpdGVcbiAgICogQHBhcmFtIHtTdHJpbmd9IFtpZF0gLSBVbmlxdWUgSURcbiAgICovXG4gIHN0YXRpYyBsb2FkU3ByaXRlKHVybCwgaWQpIHtcbiAgICByZXR1cm4gbG9hZFNwcml0ZSh1cmwsIGlkKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXR1cCBtdWx0aXBsZSBpbnN0YW5jZXNcbiAgICogQHBhcmFtIHsqfSBzZWxlY3RvclxuICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9uc1xuICAgKi9cbiAgc3RhdGljIHNldHVwKHNlbGVjdG9yLCBvcHRpb25zID0ge30pIHtcbiAgICBsZXQgdGFyZ2V0cyA9IG51bGw7XG5cbiAgICBpZiAoaXMuc3RyaW5nKHNlbGVjdG9yKSkge1xuICAgICAgdGFyZ2V0cyA9IEFycmF5LmZyb20oZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChzZWxlY3RvcikpO1xuICAgIH0gZWxzZSBpZiAoaXMubm9kZUxpc3Qoc2VsZWN0b3IpKSB7XG4gICAgICB0YXJnZXRzID0gQXJyYXkuZnJvbShzZWxlY3Rvcik7XG4gICAgfSBlbHNlIGlmIChpcy5hcnJheShzZWxlY3RvcikpIHtcbiAgICAgIHRhcmdldHMgPSBzZWxlY3Rvci5maWx0ZXIoaXMuZWxlbWVudCk7XG4gICAgfVxuXG4gICAgaWYgKGlzLmVtcHR5KHRhcmdldHMpKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICByZXR1cm4gdGFyZ2V0cy5tYXAoKHQpID0+IG5ldyBQbHlyKHQsIG9wdGlvbnMpKTtcbiAgfVxufVxuXG5QbHlyLmRlZmF1bHRzID0gY2xvbmVEZWVwKGRlZmF1bHRzKTtcblxuZXhwb3J0IGRlZmF1bHQgUGx5cjtcbiIsIlwidXNlIGN0cmljdFwiO1xuXG5leHBvcnQgY29uc3QgU3dpcGVycyA9ICgpID0+IHtcbiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIiwgZnVuY3Rpb24gKCkge1xuICAgIFxuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4gICAgdmFyIHN3aXBlciA9IG5ldyBTd2lwZXIoXCIuc2xpZGVyLWpzLTJcIiwge1xuICAgICAgc2xpZGVzUGVyVmlldzogNCxcbiAgICAgIGRpcmVjdGlvbjogXCJ2ZXJ0aWNhbFwiLFxuICAgICAgZnJlZU1vZGU6IHRydWUsXG4gICAgICB3YXRjaFNsaWRlc1Byb2dyZXNzOiB0cnVlLFxuICAgICAgLy8gIG5hdmlnYXRpb246IHtcbiAgICAgIC8vICAgICAgcHJldkVsOiBcIi5qcy0xLXByZXZcIixcbiAgICAgIC8vICAgICAgbmV4dEVsOiBcIi5qcy0xLW5leHRcIixcbiAgICAgIC8vICAgIH0sXG4gICAgfSk7XG4gICAgdmFyIHN3aXBlcjIgPSBuZXcgU3dpcGVyKFwiLnNsaWRlci1qcy0xXCIsIHtcbiAgICAgIHNwYWNlQmV0d2VlbjogMTAsXG4gICAgICBuYXZpZ2F0aW9uOiB7XG4gICAgICAgIG5leHRFbDogXCIuc3dpcGVyLWJ1dHRvbi1uZXh0XCIsXG4gICAgICAgIHByZXZFbDogXCIuc3dpcGVyLWJ1dHRvbi1wcmV2XCIsXG4gICAgICB9LFxuICAgICAgdGh1bWJzOiB7XG4gICAgICAgIHN3aXBlcjogc3dpcGVyLFxuICAgICAgfSxcbiAgICAgIGVmZmVjdDogXCJmYWRlXCIsXG4gICAgICBmYWRlRWZmZWN0OiB7XG4gICAgICAgIGNyb3NzRmFkZTogdHJ1ZSxcbiAgICAgIH0sXG4gICAgfSk7XG4gICBcbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBjb25zdCBzd2lwZXJGdWxsID0gbmV3IFN3aXBlcihcIi5zbGlkZXItZnVsbC1qc1wiLCB7XG4gICAgICBzbGlkZXNQZXJWaWV3OiA0LFxuICAgICAgbG9vcDogXCJ0cnVlXCIsXG4gICAgICBzcGVlZDogMzAwLFxuICAgICAgc3BhY2VCZXR3ZWVuOiAxNCxcbiAgICAgIC8vIGNlbnRlcmVkU2xpZGVzOiB0cnVlLFxuICAgICAgZ3JhYkN1cnNvcjogdHJ1ZSxcbiAgICAgIC8vIGVmZmVjdDogXCJjb3ZlcmZsb3dcIixcbiAgICAgIC8vIGNvdmVyZmxvd0VmZmVjdDoge1xuICAgICAgLy8gICByb3RhdGU6IDAsXG4gICAgICAvLyAgIHN0cmV0Y2g6IDAsXG4gICAgICAvLyAgIGRlcHRoOiAwLFxuICAgICAgLy8gICAvLyBtb2RpZmllcjogMSxcbiAgICAgIC8vICAgLy8gc2xpZGVTaGFkb3dzOiB0cnVlLFxuICAgICAgLy8gfSxcbiAgICAgIC8vIHdhdGNoU2xpZGVzUHJvZ3Jlc3M6IHRydWUsXG5cbiAgICAgIHBhZ2luYXRpb246IHtcbiAgICAgICAgZWw6IFwiLnN3aXBlci1wYWdpbmF0aW9uLXJld1wiLFxuICAgICAgICBjbGlja2FibGU6IHRydWUsXG4gICAgICB9LFxuICAgICAgbmF2aWdhdGlvbjoge1xuICAgICAgICBwcmV2RWw6IFwiLmpzLXJldy1wcmV2XCIsXG4gICAgICAgIG5leHRFbDogXCIuanMtcmV3LW5leHRcIixcbiAgICAgIH0sXG5cbiAgICAgIGJyZWFrcG9pbnRzOiB7XG4gICAgICAgIDkwMDoge1xuICAgICAgICAgIHNwYWNlQmV0d2VlbjogMjIsXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgXG4gIH0pO1xufTtcbiIsIlwidXNlIGN0cmljdFwiO1xyXG5cclxuXHJcbmV4cG9ydCBjb25zdCBBbmltID0gKCkgPT4ge1xyXG4gIGZ1bmN0aW9uIEFuaW1Gb3JTY3JvbGxUb3AoY2VsbCwgcmVjKSB7XHJcbiAgICBpZiAocmVjLnRvcCA8IGRvY3VtZW50LmJvZHkub2Zmc2V0SGVpZ2h0IC0gMjAwKSB7XHJcbiAgICAgIGNlbGwuY2xhc3NMaXN0LmFkZChcIl9pcy1hY3RpdmVcIik7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBBbmltRm9yU2Nyb2xsbGVmdChjZWxsLCByZWMpIHtcclxuICAgIGlmIChyZWMudG9wIDwgZG9jdW1lbnQuYm9keS5vZmZzZXRIZWlnaHQgLSAyMDApIHtcclxuICAgICAgY2VsbC5jbGFzc0xpc3QuYWRkKFwiX2lzLWFjdGl2ZVwiKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIEFuaW1Gb3JTY3JvbGxSaWdodChjZWxsLCByZWMpIHtcclxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwic2Nyb2xsXCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgaWYgKHJlYy50b3AgPCBkb2N1bWVudC5ib2R5Lm9mZnNldEhlaWdodCAtIDIwMCkge1xyXG4gICAgICAgIGNlbGwuY2xhc3NMaXN0LmFkZChcIl9pcy1hY3RpdmVcIik7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcblxyXG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsIGZ1bmN0aW9uICgpIHtcclxuICAgIGxldCBhbmltVG9wID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5fYW5pbS10b3BcIik7XHJcbiAgICBsZXQgYW5pbWxlZnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLl9hbmltLWxlZnRcIik7XHJcbiAgICBsZXQgYW5pbVJpZ2h0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5fYW5pbS1yaWdodFwiKTtcclxuICAgIGxldCBzaW5nbGVzVG9wID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYW5pbVRvcCk7XHJcbiAgICBsZXQgc2luZ2xlc2xlZnQgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhbmltbGVmdCk7XHJcbiAgICBsZXQgc2luZ2xlc1JpZ2h0ID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYW5pbVJpZ2h0KTtcclxuXHJcblxyXG5cclxuICAgIGlmIChzaW5nbGVzVG9wLmxlbmd0aCA+IDApIHtcclxuICAgICAgc2luZ2xlc1RvcC5mb3JFYWNoKChjZWxsKSA9PiB7XHJcblxyXG4gICAgICAgICBsZXQgcmVjID0gY2VsbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcInNjcm9sbFwiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgaWYgKHJlYy50b3AgPCBkb2N1bWVudC5ib2R5Lm9mZnNldEhlaWdodCAtIDIwMCkge1xyXG4gICAgICAgICAgICAgY2VsbC5jbGFzc0xpc3QuYWRkKFwiX2lzLWFjdGl2ZVwiKTtcclxuICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChzaW5nbGVzbGVmdC5sZW5ndGggPiAwKSB7XHJcbiAgICAgIHNpbmdsZXNsZWZ0LmZvckVhY2goKGNlbGwxKSA9PiB7XHJcbiAgICAgICAgIGxldCByZWMgPSBjZWxsMS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJzY3JvbGxcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgIGlmIChyZWMudG9wIDwgZG9jdW1lbnQuYm9keS5vZmZzZXRIZWlnaHQgLSAyMDApIHtcclxuICAgICAgICAgICAgIGNlbGwxLmNsYXNzTGlzdC5hZGQoXCJfaXMtYWN0aXZlXCIpO1xyXG4gICAgICAgICAgIH1cclxuICAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChzaW5nbGVzUmlnaHQubGVuZ3RoID4gMCkge1xyXG4gICAgICBzaW5nbGVzUmlnaHQuZm9yRWFjaCgoY2VsbDIpID0+IHtcclxuICAgICAgICAgbGV0IHJlYyA9IGNlbGwyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwic2Nyb2xsXCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICBpZiAocmVjLnRvcCA8IGRvY3VtZW50LmJvZHkub2Zmc2V0SGVpZ2h0IC0gMjAwKSB7XHJcbiAgICAgICAgICAgICBjZWxsMi5jbGFzc0xpc3QuYWRkKFwiX2lzLWFjdGl2ZVwiKTtcclxuICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIFxyXG4gIH0pO1xyXG5cclxuXHJcbn07XHJcblxyXG5cclxuXHJcblxyXG4iLCJcInVzZSBjdHJpY3RcIjtcclxuXHJcbmV4cG9ydCBjb25zdCBCdXR0b24gPSAoZSkgPT4ge1xyXG4gIGxldCB0YXJnZXQgPSAgZS50YXJnZXQuY2xvc2VzdCgnLmJ1dC13YXZlJyk7XHJcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICBsZXQgbVZhbHVlID0gTWF0aC5tYXgodGFyZ2V0LmNsaWVudFdpZHRoLCB0YXJnZXQuY2xpZW50SGVpZ2h0KSxcclxuICAgICAgYWRkRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKSxcclxuICAgICAgcmVjdCA9IHRhcmdldC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgIGFkZERpdi5jbGFzc0xpc3QuYWRkKFwiYWRkRGl2XCIpO1xyXG4gICAgYWRkRGl2LnN0eWxlLndpZHRoID0gYWRkRGl2LnN0eWxlLmhlaWdodCA9IG1WYWx1ZSArIFwicHhcIjtcclxuICAgIGFkZERpdi5zdHlsZS5sZWZ0ID0gZS5jbGllbnRYIC0gcmVjdC5sZWZ0IC0gbVZhbHVlIC8gMiArIFwicHhcIjtcclxuICAgIGFkZERpdi5zdHlsZS50b3AgPSBlLmNsaWVudFkgLSByZWN0LnRvcCAtIG1WYWx1ZSAvIDIgKyBcInB4XCI7XHJcbiAgICB0YXJnZXQuY2xvc2VzdChcIi5idXQtd2F2ZVwiKS5hcHBlbmQoYWRkRGl2KTtcclxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICBhZGREaXYucmVtb3ZlKCk7XHJcbiAgICB9LCAzMDApO1xyXG59O1xyXG5cclxuIiwiLy8gaW1wb3J0IGF4aW9zIGZyb20gJ2F4aW9zJztcclxuaW1wb3J0IFBseXIgZnJvbSBcInBseXJcIjtcclxuXHJcbmV4cG9ydCBjb25zdCBib2R5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImJvZHlcIik7XHJcbmV4cG9ydCBjb25zdCB3YXZlcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuYnV0LXdhdmVcIik7XHJcbmV4cG9ydCBjb25zdCBwb3B1cHNJbml0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5wb3B1cHMtaW5pdC1qc1wiKTtcclxuZXhwb3J0IGNvbnN0IGhlYWRlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJoZWFkZXJcIik7XHJcbmV4cG9ydCBjb25zdCB0b3lzUGx5ciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIudG95c19fcGx5clwiKTtcclxuXHJcbi8vIGV4cG9ydCBjb25zdCBwbGF5ZXJGdWxsVG95cyA9IG5ldyBQbHlyKFwiLnBsYXllckZ1bGxUb3lzXCIpO1xyXG4vLyBleHBvcnQgY29uc3QgcGxheWVyUmV2MSA9IG5ldyBQbHlyKFwiLnBsYXllci1yZXctMVwiKTtcclxuLy8gZXhwb3J0IGNvbnN0IHBsYXllclJldjIgPSBuZXcgUGx5cihcIi5wbGF5ZXItcmV3LTJcIik7XHJcbi8vIGV4cG9ydCBjb25zdCBwbGF5ZXJSZXYzID0gbmV3IFBseXIoXCIucGxheWVyLXJldy0zXCIpO1xyXG4vLyBleHBvcnQgY29uc3QgcGxheWVyUmV2NCA9IG5ldyBQbHlyKFwiLnBsYXllci1yZXctNFwiKTtcclxuXHJcbiIsIlwidXNlIGN0cmljdFwiO1xyXG5cclxuZXhwb3J0IGNvbnN0IEdhbCA9IChpdGVtKSA9PiB7XHJcbiAgdmFyIHMyID0gbmV3IFN3aXBlcihcIi5zMnN3aXBlclwiLCB7XHJcbiAgICBzcGVlZDogMzAwLFxyXG4gICAgY2VudGVyZWRTbGlkZXM6IHRydWUsXHJcbiAgICBzcGFjZUJldHdlZW46IDExLFxyXG4gICAgZWZmZWN0OiBcImNvdmVyZmxvd1wiLFxyXG4gICAgY292ZXJmbG93RWZmZWN0OiB7XHJcbiAgICAgIHJvdGF0ZTogMCxcclxuICAgICAgc3RyZXRjaDogMCxcclxuICAgICAgZGVwdGg6IDAsXHJcbiAgICAgIC8vIG1vZGlmaWVyOiAxLFxyXG4gICAgICAvLyBzbGlkZVNoYWRvd3M6IHRydWUsXHJcbiAgICB9LFxyXG4gICAgbmF2aWdhdGlvbjoge1xyXG4gICAgICBwcmV2RWw6IFwiLnMyLXByZXZcIixcclxuICAgICAgbmV4dEVsOiBcIi5zMi1uZXh0XCIsXHJcbiAgICB9LFxyXG4gICAgLy8gc2xpZGVzUGVyVmlldzogXCJhdXRvXCIsXHJcbiAgICAvLyBpbml0OiBmYWxzZSxcclxuICAgIGxvb3A6IHRydWUsXHJcbiAgICAvLyBzbGlkZXNQZXJHcm91cDogMyxcclxuICAgIHNsaWRlc1BlclZpZXc6IFwiYXV0b1wiLFxyXG4gICAgc2xpZGVUb0NsaWNrZWRTbGlkZTogJ3RydWUnLFxyXG4gICAgZ3JhYkN1cnNvcjogdHJ1ZSxcclxuXHJcbiAgfSk7XHJcblxyXG4gIGxldCB0ZW1wO1xyXG5cclxuICBpZiAoczIpIHtcclxuICAgIHMyLm9uKFwiYmVmb3JlVHJhbnNpdGlvblN0YXJ0XCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgLy8gczIub24oXCJzbGlkZUNoYW5nZVRyYW5zaXRpb25TdGFydFwiLCBmdW5jdGlvbiAoKSB7XHJcblxyXG4gICAgICBjb25zdCBoZWFkID0gWy4uLmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuczIgIC5zd2lwZXItc2xpZGVcIildLFxyXG4gICAgICAgIHMxSXRlbXMgPSBbLi4uZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5zMSAgLnNsaWRlXCIpXTtcclxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzMUl0ZW1zLmxlbmd0aDsgKytpKSB7XHJcbiAgICAgICAgaWYgKHMxSXRlbXNbaV0uY2xhc3NMaXN0LmNvbnRhaW5zKFwiX2lzLXN0YXJ0XCIpKSB7XHJcbiAgICAgICAgICBzMUl0ZW1zW2ldLmNsYXNzTGlzdC5yZW1vdmUoXCJfaXMtc3RhcnRcIik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoczFJdGVtc1tpXS5jbGFzc0xpc3QuY29udGFpbnMoXCJfaXMtYWN0aXZlXCIpKSB7XHJcbiAgICAgICAgICBzMUl0ZW1zW2ldLmNsYXNzTGlzdC5yZW1vdmUoXCJfaXMtYWN0aXZlXCIpO1xyXG4gICAgICAgICAgczFJdGVtc1tpXS5jbGFzc0xpc3QuYWRkKFwiX25vdC1hY3RpdmVcIik7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaGVhZC5sZW5ndGg7ICsraSkge1xyXG4gICAgICAgICAgaWYgKGhlYWRbaV0uY2xhc3NMaXN0LmNvbnRhaW5zKFwic3dpcGVyLXNsaWRlLWFjdGl2ZVwiKSkge1xyXG4gICAgICAgICAgICB0ZW1wID0gaGVhZFtpXS5nZXRBdHRyaWJ1dGUoXCJkYXRhLWlkXCIpO1xyXG4gICAgICAgICAgICBzMUl0ZW1zW3RlbXBdLmNsYXNzTGlzdC5yZW1vdmUoXCJfbm90LWFjdGl2ZVwiKTtcclxuICAgICAgICAgICAgczFJdGVtc1t0ZW1wXS5jbGFzc0xpc3QuYWRkKFwiX2lzLWFjdGl2ZVwiKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH0sIDEwKTtcclxuICAgIH0pO1xyXG4gIH1cclxufTtcclxuIiwiXCJ1c2UgY3RyaWN0XCI7XG5cbmV4cG9ydCBjb25zdCBIZWFkZXJzID0gKCkgPT4ge1xuICAvLyBjb25zdCBidXJnZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmhlYWRlcl9fYnVyZ2VyXCIpO1xuICAvLyBjb25zdCBtZW51ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tZW51XCIpO1xuICAvLyBjb25zdCBpbmZvID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblxuICAvLyBidXJnZXIuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChldmVudCkge1xuICAvLyAgIG1lbnUuY2xhc3NMaXN0LmFkZChcIm1lbnUtYWN0aXZlXCIpO1xuICAvLyAgIGluZm8uY2xhc3NMaXN0LmFkZChcImhlYWRlcl9faW5mb1wiLCBcImluZm9cIik7XG4gIC8vICAgaW5mby5pbm5lckhUTUwgPVxuICAvLyAgICAgXCI8YSBjbGFzcz0naW5mb19fcGhvbmUnIGhyZWY9JyMhJz4rNygwMDApIDEyMyA0NSA2NTwvYT48Zm9ybSBjbGFzcz0naW5mb19fc2VhcmNoICc+PGlucHV0IHR5cGU9J3RleHQnIHBsYWNlaG9sZGVyPSfQn9C+0LjRgdC6JyAvPjxzdmc+IDx1c2UgeGxpbms6aHJlZj0nI3NlYXJjaCc+PC91c2U+PC9zdmc+PGlucHV0IHR5cGU9J3N1Ym1pdCcvPjwvZm9ybT5cIjtcbiAgLy8gICBtZW51LmFwcGVuZChpbmZvKTtcbiAgLy8gICBmdW5jdGlvbiBhY3RpdmVJbmZvKCkge1xuICAvLyAgICAgaW5mby5jbGFzc0xpc3QuYWRkKFwiaW5mby1hY3RpdmVcIik7XG4gIC8vICAgfVxuICAvLyAgIHNldFRpbWVvdXQoYWN0aXZlSW5mbywgMjAwKTtcbiAgLy8gICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiYm9keVwiKS5jbGFzc0xpc3QuYWRkKFwibG9ja1wiKTtcbiAgLy8gfSk7XG5cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICAvLyBkb2N1bWVudFxuICAvLyAgIC5xdWVyeVNlbGVjdG9yKFwiLmhlYWRlcl9fY2xvc2VcIilcbiAgLy8gICAuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChldmVudCkge1xuICAvLyAgICAgbWVudS5jbGFzc0xpc3QucmVtb3ZlKFwibWVudS1hY3RpdmVcIik7XG4gIC8vICAgICBtZW51LnF1ZXJ5U2VsZWN0b3IoXCIuaW5mb1wiKS5yZW1vdmUoKTtcbiAgLy8gICAgIGluZm8uY2xhc3NMaXN0LnJlbW92ZShcImluZm8tYWN0aXZlXCIpO1xuICAvLyAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImJvZHlcIikuY2xhc3NMaXN0LnJlbW92ZShcImxvY2tcIik7XG4gIC8vICAgfSk7XG5cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcInNjcm9sbFwiLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICBpZiAod2luZG93LnBhZ2VZT2Zmc2V0ID4gMTAwKSB7XG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmRvcF9oZWFkZXJcIikuY2xhc3NMaXN0LmFkZChcInJlc3BvbmNpdmVIZWFkZXJcIik7XG4gICAgfSBlbHNlIHtcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZG9wX2hlYWRlclwiKS5jbGFzc0xpc3QucmVtb3ZlKFwicmVzcG9uY2l2ZUhlYWRlclwiKTtcbiAgICB9XG4gIH0pO1xuXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICB3aW5kb3cub25yZXNpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKHdpbmRvdy5pbm5lcldpZHRoID49IDk5OSkge1xuICAgICAgaWYgKG1lbnUucXVlcnlTZWxlY3RvcihcIi5oZWFkZXJfX2luZm9cIikpIHtcbiAgICAgICAgbWVudS5xdWVyeVNlbGVjdG9yKFwiLmhlYWRlcl9faW5mb1wiKS5yZW1vdmUoKTtcbiAgICAgIH1cblxuICAgICAgbWVudS5jbGFzc0xpc3QucmVtb3ZlKFwibWVudS1hY3RpdmVcIik7XG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmluZm9cIikuY2xhc3NMaXN0LnJlbW92ZShcImluZm8tYWN0aXZlXCIpO1xuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImJvZHlcIikuY2xhc3NMaXN0LnJlbW92ZShcImxvY2tcIik7XG4gICAgfVxuICB9O1xuXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG59O1xuXG4iLCJcInVzZSBzdHJpY3RcIjtcbmltcG9ydCBQbHlyIGZyb20gXCJwbHlyXCI7XG5pbXBvcnQgeyBib2R5IH0gZnJvbSBcIi4vY29uc3RhbnRzXCI7XG5cbmV4cG9ydCBjb25zdCBQb3B1cHMgPSAoKSA9PiB7XG4gIGNvbnN0IHBvcHVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cC1qc1wiKSxcbiAgICBjb250ZW50cyA9IHBvcHVwLnF1ZXJ5U2VsZWN0b3JBbGwoXCIucG9wdXBfX2NvbnRlbnRcIiksXG4gICAgUGxlZXJzID0gW107XG5cbiAgbGV0IHRlbXBvciA9IFsuLi5kb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnNsaWRlci12aWRlb1wiKV07XG5cbiAgdGVtcG9yLmZvckVhY2goKGNlbGwpID0+IHtcbiAgICBsZXQgaWQgPSBjZWxsLmdldEF0dHJpYnV0ZShcImlkXCIpO1xuICAgIGlmIChpZCkge1xuICAgICAgbGV0IHIgPSBgIyR7aWR9YDtcbiAgICAgIGNvbnN0IGUgPSBuZXcgUGx5cihyKTtcbiAgICAgIFBsZWVycy5wdXNoKHsgaWQ6IGlkLCBlOiBlIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgY29uc3QgdGFyZ2V0ID0gZS50YXJnZXQ7XG4gICAgLy8gICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIGNvbnN0IG9wZW5Qb3AgPSAoKSA9PiB7XG4gICAgICBjb25zdCBpbml0VGFyZ2V0ID0gcG9wdXAucXVlcnlTZWxlY3RvcihcbiAgICAgICAgdGFyZ2V0LmNsb3Nlc3QoXCIucG9wdXBzLWluaXQtanNcIikuZ2V0QXR0cmlidXRlKFwicmVsXCIpXG4gICAgICApO1xuXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgcG9wdXAuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcbiAgICAgICAgcG9wdXAuY2xhc3NMaXN0LnJlbW92ZShcIl9ub3QtYWN0aXZlXCIpO1xuICAgICAgICBwb3B1cC5jbGFzc0xpc3QuYWRkKFwiX2lzLWFjdGl2ZVwiKTtcblxuICAgICAgICBjb250ZW50cy5mb3JFYWNoKChjZWxsKSA9PiB7XG4gICAgICAgICAgaWYgKGNlbGwgPT0gaW5pdFRhcmdldCkge1xuICAgICAgICAgICAgaW5pdFRhcmdldC5zdHlsZS5kaXNwbGF5ID0gXCJncmlkXCI7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNlbGwuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9LCAyMDApO1xuXG4gICAgICBsZXQgbGlua1BseXIgPSBpbml0VGFyZ2V0LnF1ZXJ5U2VsZWN0b3IoXCJ2aWRlb1wiKS5nZXRBdHRyaWJ1dGUoXCJpZFwiKTtcblxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0ZW1wb3IubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgaWYgKFBsZWVyc1tpXS5pZCA9PT0gbGlua1BseXIpIHtcbiAgICAgICAgICBQbGVlcnNbaV0uZS5wbGF5KCk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgYm9keS5zdHlsZS5jc3NUZXh0ID0gXCJvdmVyZmxvdzogaGlkZGVuXCI7XG4gICAgfTtcbiAgICAvLyAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgY29uc3QgY2xvc2VQb3AgPSAoKSA9PiB7XG4gICAgICBwb3B1cC5jbGFzc0xpc3QucmVtb3ZlKFwiX2lzLWFjdGl2ZVwiKTtcbiAgICAgIHBvcHVwLmNsYXNzTGlzdC5hZGQoXCJfbm90LWFjdGl2ZVwiKTtcblxuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIHBvcHVwLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgICAgY29udGVudHMuZm9yRWFjaCgoY2VsbCkgPT4ge1xuICAgICAgICAgIGNlbGwuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgICAgICB9KTtcbiAgICAgIH0sIDMwMCk7XG5cbiAgICAgIGJvZHkuc3R5bGUuY3NzVGV4dCA9IFwib3ZlcmZsb3c6IHZpc2libGVcIjtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgUGxlZXJzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgIFBsZWVyc1tpXS5lLnN0b3AoKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIC8vICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICAgIGlmIChcbiAgICAgIHRhcmdldC5jbG9zZXN0KFwiLnBvcHVwcy1pbml0LWpzXCIpXG4gICAgICAvLyAgJiZcbiAgICAgIC8vIHRhcmdldC5jbG9zZXN0KFwiLnNsaWRlcl9faXRlbVwiKS5jbGFzc0xpc3QuY29udGFpbnMoXCJzd2lwZXItc2xpZGUtYWN0aXZlXCIpXG4gICAgKSB7XG4gICAgICBvcGVuUG9wKCk7XG4gICAgfSBlbHNlIGlmIChcbiAgICAgIHRhcmdldC5tYXRjaGVzKFwiLnBvcHVwLW92ZXJsYXktanNcIikgfHxcbiAgICAgIHRhcmdldC5jbG9zZXN0KFwiLnBvcHVwLWNsb3NlLWpzXCIpXG4gICAgKSB7XG4gICAgICBjbG9zZVBvcCgpO1xuICAgIH1cbiAgfSk7XG59O1xuIiwiXCJ1c2UgY3RyaWN0XCI7XHJcblxyXG4vLyBleHBvcnQgY29uc3QgU3dpcGVyMSA9ICgpID0+IHtcclxuLy8gICBpZiAoZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNzbGlkZXItanMtMVwiKSkge1xyXG5leHBvcnQgY29uc3QgRG91YmxlID0gKCk9PntcclxuXHJcblxyXG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsIGZ1bmN0aW9uICgpIHtcclxuXHJcblxyXG4gICBjb25zdCBEb3VibGVUb3AgID0gbmV3IFN3aXBlcihcIi5teVN3aXBlclwiLCB7XHJcbiAgICAgbG9vcDogdHJ1ZSxcclxuICAgICBzcGFjZUJldHdlZW46IDEwLFxyXG4gICAgIHNsaWRlc1BlclZpZXc6IDMsXHJcbiAgICAgLy8gZnJlZU1vZGU6IHRydWUsXHJcbiAgICAgd2F0Y2hTbGlkZXNQcm9ncmVzczogdHJ1ZSxcclxuICAgICBuYXZpZ2F0aW9uOiB7XHJcbiAgICAgICBuZXh0RWw6IFwiLnN3aXBlci1idXR0b24tbmV4dFwiLFxyXG4gICAgICAgcHJldkVsOiBcIi5zd2lwZXItYnV0dG9uLXByZXZcIixcclxuICAgICB9LFxyXG4gICB9KTtcclxuICAgdmFyIERvdWJsZUJvdHRvbSA9IG5ldyBTd2lwZXIoXCIubXlTd2lwZXIyXCIsIHtcclxuICAgICBsb29wOiB0cnVlLFxyXG4gICAgIHNwYWNlQmV0d2VlbjogMTAsXHJcbiAgICAgc2xpZGVUb0NsaWNrZWRTbGlkZTogXCJ0cnVlXCIsXHJcbiAgICAgcGFnaW5hdGlvbjoge1xyXG4gICAgICAgZWw6IFwiLnN3aXBlci1wYWdpbmF0aW9uLW15U3dpcGVyXCIsXHJcbiAgICAgICBjbGlja2FibGU6IHRydWUsXHJcbiAgICAgfSxcclxuICAgICAvLyBlZmZlY3Q6IFwiZmFkZVwiLFxyXG4gICAgIHRodW1iczoge1xyXG4gICAgICAgc3dpcGVyOiBEb3VibGVUb3AsXHJcbiAgICAgfSxcclxuICAgICAvLyBicmVha3BvaW50czoge1xyXG4gICAgIC8vICAgNzY4OiB7XHJcbiAgICAgLy8gICAgICB0aHVtYnM6IHtcclxuICAgICAvLyAgICAgICBzd2lwZXI6IHN3aXBlcixcclxuICAgICAvLyAgICAgfSxcclxuICAgICAvLyAgIH1cclxuICAgICAvLyB9LFxyXG4gICB9KTtcclxuXHJcblxyXG5cclxuXHJcbiAgICAvLyBjb25zdCBEb3VibGVUb3AgPSBuZXcgU3dpcGVyKFwiLnNsaWRlci1kb3VibGUxLWpzXCIsIHtcclxuICAgIC8vICAgbG9vcDogXCJ0cnVlXCIsXHJcbiAgICAvLyAgIHNwZWVkOiA1MDAsXHJcbiAgICAvLyAgIHNsaWRlc1BlclZpZXc6IFwiYXV0b1wiLFxyXG4gICAgLy8gICBncmFiQ3Vyc29yOiBcInRydWVcIixcclxuICAgIC8vICAgc3BhY2VCZXR3ZWVuOiAyMCxcclxuICAgIC8vICAgdGh1bWJzOiB7IHN3aXBlcjogRG91YmxlQm90dG9tIH0sXHJcbiAgICAvLyAgIC8vIGJyZWFrcG9pbnRzOiB7XHJcbiAgICAvLyAgIC8vICAgNzY4OiB7XHJcbiAgICAvLyAgIC8vICAgICBzcGFjZUJldHdlZW46IDAsXHJcbiAgICAvLyAgIC8vICAgfSxcclxuICAgIC8vICAgLy8gfSxcclxuICAgIC8vIH0pO1xyXG4gICAgLy8gY29uc3QgRG91YmxlQm90dG9tID0gbmV3IFN3aXBlcihcIi5zbGlkZXItZG91YmxlMi1qc1wiLCB7XHJcbiAgICAvLyAgIHNsaWRlc1BlclZpZXc6IFwiYXV0b1wiLFxyXG4gICAgLy8gICBzbGlkZVRvQ2xpY2tlZFNsaWRlOiBcInRydWVcIixcclxuICAgIC8vICAgc3BhY2VCZXR3ZWVuOiAxMCxcclxuICAgIC8vICAgbG9vcDogXCJ0cnVlXCIsXHJcbiAgICAvLyAgIHNwZWVkOiA1MDAsXHJcbiAgICAvLyAgIG5hdmlnYXRpb246IHtcclxuICAgIC8vICAgICBuZXh0RWw6IFwiLmpzLWRvdWJsZTItbmV4dFwiLFxyXG4gICAgLy8gICAgIHByZXZFbDogXCIuanMtZG91YmxlMi1wcmV2XCIsXHJcbiAgICAvLyAgIH0sXHJcbiAgICAvLyAgIGdyYWJDdXJzb3I6IHRydWUsXHJcbiAgICAvLyAgIHdhdGNoU2xpZGVzUHJvZ3Jlc3M6IHRydWUsXHJcbiAgICAvLyAgICBjZW50ZXJlZFNsaWRlczogdHJ1ZSxcclxuXHJcbiAgICAvLyAgIC8vICBlZmZlY3Q6IFwiZmFkZVwiLFxyXG4gICAgLy8gICAvLyAgZmFkZUVmZmVjdDoge1xyXG4gICAgLy8gICAvLyAgICBjcm9zc0ZhZGU6IHRydWUsXHJcbiAgICAvLyAgIC8vICB9LFxyXG4gICAgLy8gfSk7XHJcblxyXG4gICAgLy8gRG91YmxlVG9wLmNvbnRyb2xsZXIuY29udHJvbCA9IERvdWJsZUJvdHRvbTtcclxuICAgIC8vIERvdWJsZUJvdHRvbS5jb250cm9sbGVyLmNvbnRyb2wgPSBEb3VibGVUb3A7XHJcbiAgfSk7XHJcbn1cclxuIiwiLy8gVGhlIG1vZHVsZSBjYWNoZVxudmFyIF9fd2VicGFja19tb2R1bGVfY2FjaGVfXyA9IHt9O1xuXG4vLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcblx0dmFyIGNhY2hlZE1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF07XG5cdGlmIChjYWNoZWRNb2R1bGUgIT09IHVuZGVmaW5lZCkge1xuXHRcdHJldHVybiBjYWNoZWRNb2R1bGUuZXhwb3J0cztcblx0fVxuXHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuXHR2YXIgbW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXSA9IHtcblx0XHQvLyBubyBtb2R1bGUuaWQgbmVlZGVkXG5cdFx0Ly8gbm8gbW9kdWxlLmxvYWRlZCBuZWVkZWRcblx0XHRleHBvcnRzOiB7fVxuXHR9O1xuXG5cdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuXHRfX3dlYnBhY2tfbW9kdWxlc19fW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuXHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuXHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG59XG5cbiIsIi8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcblx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG5cdFx0ZnVuY3Rpb24oKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG5cdFx0ZnVuY3Rpb24oKSB7IHJldHVybiBtb2R1bGU7IH07XG5cdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsIHsgYTogZ2V0dGVyIH0pO1xuXHRyZXR1cm4gZ2V0dGVyO1xufTsiLCIvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9ucyBmb3IgaGFybW9ueSBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBkZWZpbml0aW9uKSB7XG5cdGZvcih2YXIga2V5IGluIGRlZmluaXRpb24pIHtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZGVmaW5pdGlvbiwga2V5KSAmJiAhX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIGtleSkpIHtcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBkZWZpbml0aW9uW2tleV0gfSk7XG5cdFx0fVxuXHR9XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18uZyA9IChmdW5jdGlvbigpIHtcblx0aWYgKHR5cGVvZiBnbG9iYWxUaGlzID09PSAnb2JqZWN0JykgcmV0dXJuIGdsb2JhbFRoaXM7XG5cdHRyeSB7XG5cdFx0cmV0dXJuIHRoaXMgfHwgbmV3IEZ1bmN0aW9uKCdyZXR1cm4gdGhpcycpKCk7XG5cdH0gY2F0Y2ggKGUpIHtcblx0XHRpZiAodHlwZW9mIHdpbmRvdyA9PT0gJ29iamVjdCcpIHJldHVybiB3aW5kb3c7XG5cdH1cbn0pKCk7IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqLCBwcm9wKSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKTsgfSIsIi8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uciA9IGZ1bmN0aW9uKGV4cG9ydHMpIHtcblx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG5cdH1cblx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbn07IiwiLy8gaW1wb3J0IGF4aW9zIGZyb20gXCJheGlvc1wiO1xyXG5pbXBvcnQgeyBBbmltIH0gZnJvbSBcIi4vYXNzZXRzL2pzL2FuaW1hdGlvblwiO1xyXG5pbXBvcnQgeyBCdXR0b24gfSBmcm9tIFwiLi9hc3NldHMvanMvYnV0dG9uXCI7XHJcbmltcG9ydCB7IEhlYWRlcnMgfSBmcm9tIFwiLi9hc3NldHMvanMvaGVhZGVyXCI7XHJcbmltcG9ydCB7IFN3aXBlcnMgfSBmcm9tIFwiLi9hc3NldHMvanMvTXlTd2lwZXJcIjtcclxuaW1wb3J0IHsgUG9wdXBzIH0gZnJvbSBcIi4vYXNzZXRzL2pzL3BvcHVwXCI7XHJcbmltcG9ydCB7IEdhbCB9IGZyb20gXCIuL2Fzc2V0cy9qcy9nYWxTd2lwZXJcIjtcclxuaW1wb3J0IHsgRG91YmxlIH0gZnJvbSBcIi4vYXNzZXRzL2pzL3Nkb3VibGVcIjtcclxuaW1wb3J0IHtcclxuICB3YXZlcyxcclxuICBwb3B1cHNJbml0LFxyXG4gIGhlYWRlcixcclxuICB0b3lzUGx5cixcclxuICAvLyBwbGF5ZXIxLFxyXG4gIC8vIHBsYXllclJldjEsXHJcbn0gZnJvbSBcIi4vYXNzZXRzL2pzL2NvbnN0YW50cy5qc1wiO1xyXG5cclxuLy8gLS0tLS0tLS1zdHlsZXMtLS0tLS0tLS0tLS0tXHJcbmltcG9ydCBcIi4vYXNzZXRzL3Njc3MvYXBwLnNjc3NcIjtcclxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG5BbmltKCk7XHJcblN3aXBlcnMoKTtcclxuR2FsKCk7XHJcbkRvdWJsZSgpO1xyXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiRE9NQ29udGVudExvYWRlZFwiLCBmdW5jdGlvbiAoKSB7XHJcbiAgaWYgKHBvcHVwc0luaXQubGVuZ3RoID4gMCkge1xyXG4gICAgUG9wdXBzKCk7XHJcbiAgfVxyXG5cclxuICBpZiAoaGVhZGVyKSB7XHJcbiAgICBIZWFkZXJzKCk7XHJcbiAgfVxyXG5cclxuICB3YXZlcy5mb3JFYWNoKChjZWxsKSA9PiB7XHJcbiAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBCdXR0b24pO1xyXG4gIH0pO1xyXG5cclxuICBjb25zdCBwbHlyUGxheSA9ICgpID0+IHtcclxuICAgIC8vIGxldCBwbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIudG95cyAucGx5cl9fY29udHJvbHNcIik7XHJcbiAgICBpZiAocGxheWVyRnVsbFRveXMpIHtcclxuICAgICAgbGV0IHRlcnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYXllckZ1bGxUb3lzXCIpLFxyXG4gICAgICAgIHNoZWFwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi50b3lzX192aWRlbyAudG95c19fc2hlYXBcIik7XHJcblxyXG4gICAgICBzaGVhcC5pbm5lckhUTUwgPSBcIjA6MDBcIjtcclxuICAgICAgdGVydC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcclxuICAgICAgICAvLyBwbC5jbGFzc0xpc3QuYWRkKFwiX2lzLWFjdGl2ZVwiKTtcclxuICAgICAgICBsZXQgdHIgPSBwbGF5ZXJGdWxsVG95cy5jdXJyZW50VGltZS50b0ZpeGVkKDIpO1xyXG4gICAgICAgIHRyID0gdHIucmVwbGFjZShcIi5cIiwgXCI6XCIpO1xyXG4gICAgICAgIHNoZWFwLmlubmVySFRNTCA9IHRyO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICBwbHlyUGxheSgpO1xyXG5cclxufSk7XHJcbiJdLCJuYW1lcyI6WyJuYXZpZ2F0b3IiLCJtb2R1bGUiLCJleHBvcnRzIiwiX2RlZmluZVByb3BlcnR5JDEiLCJvYmoiLCJrZXkiLCJ2YWx1ZSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImNvbmZpZ3VyYWJsZSIsIndyaXRhYmxlIiwiX2RlZmluZVByb3BlcnRpZXMiLCJlIiwidCIsIm4iLCJsZW5ndGgiLCJyIiwiX2RlZmluZVByb3BlcnR5Iiwib3duS2V5cyIsImtleXMiLCJnZXRPd25Qcm9wZXJ0eVN5bWJvbHMiLCJmaWx0ZXIiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJwdXNoIiwiYXBwbHkiLCJfb2JqZWN0U3ByZWFkMiIsImFyZ3VtZW50cyIsImZvckVhY2giLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzIiwiZGVmaW5lUHJvcGVydGllcyIsImRlZmF1bHRzIiwiYWRkQ1NTIiwidGh1bWJXaWR0aCIsIndhdGNoIiwibWF0Y2hlcyIsIkFycmF5IiwiZnJvbSIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvckFsbCIsImluY2x1ZGVzIiwidGhpcyIsImNhbGwiLCJnZXRDb25zdHJ1Y3RvciIsImNvbnN0cnVjdG9yIiwiaW5zdGFuY2VPZiIsImlzU3RyaW5nIiwiU3RyaW5nIiwiaXNBcnJheSIsImlzTm9kZUxpc3QiLCJOb2RlTGlzdCIsImlzIiwiRWxlbWVudCIsIkV2ZW50IiwiaXNOdWxsT3JVbmRlZmluZWQiLCJpc09iamVjdCIsIlJhbmdlVG91Y2giLCJUeXBlRXJyb3IiLCJlbGVtZW50IiwicXVlcnlTZWxlY3RvciIsInJhbmdlVG91Y2giLCJjb25maWciLCJpbml0IiwicHJvdG90eXBlIiwiX2NyZWF0ZUNsYXNzIiwiZW5hYmxlZCIsInN0eWxlIiwidXNlclNlbGVjdCIsIndlYktpdFVzZXJTZWxlY3QiLCJ0b3VjaEFjdGlvbiIsImxpc3RlbmVycyIsInNldCIsInRhcmdldCIsImkiLCJjaGFuZ2VkVG91Y2hlcyIsIm8iLCJwYXJzZUZsb2F0IiwiZ2V0QXR0cmlidXRlIiwicyIsInUiLCJjIiwiZ2V0Qm91bmRpbmdDbGllbnRSZWN0IiwiYSIsIndpZHRoIiwiY2xpZW50WCIsImxlZnQiLCJjb25jYXQiLCJtYXRjaCIsIk1hdGgiLCJtYXgiLCJnZXREZWNpbWFsUGxhY2VzIiwidG9GaXhlZCIsInJvdW5kIiwiZGlzYWJsZWQiLCJwcmV2ZW50RGVmYXVsdCIsImdldCIsImJ1YmJsZXMiLCJkaXNwYXRjaEV2ZW50IiwidHJpZ2dlciIsInR5cGUiLCJNdXRhdGlvbk9ic2VydmVyIiwiYWRkZWROb2RlcyIsIm9ic2VydmUiLCJib2R5IiwiY2hpbGRMaXN0Iiwic3VidHJlZSIsIm1hcCIsImRvY3VtZW50RWxlbWVudCIsImlucHV0IiwiQm9vbGVhbiIsImlzRnVuY3Rpb24iLCJGdW5jdGlvbiIsImlzRW1wdHkiLCJOdW1iZXIiLCJpc05hTiIsIm5vZGVUeXBlIiwib3duZXJEb2N1bWVudCIsIktleWJvYXJkRXZlbnQiLCJUZXh0VHJhY2siLCJraW5kIiwid2luZG93IiwiVVJMIiwic3RyaW5nIiwic3RhcnRzV2l0aCIsImhvc3RuYW1lIiwiXyIsInRyYW5zaXRpb25FbmRFdmVudCIsImNyZWF0ZUVsZW1lbnQiLCJldmVudHMiLCJXZWJraXRUcmFuc2l0aW9uIiwiTW96VHJhbnNpdGlvbiIsIk9UcmFuc2l0aW9uIiwidHJhbnNpdGlvbiIsImZpbmQiLCJldmVudCIsInJlcGFpbnQiLCJkZWxheSIsInNldFRpbWVvdXQiLCJoaWRkZW4iLCJvZmZzZXRIZWlnaHQiLCJicm93c2VyIiwiaXNJRSIsImRvY3VtZW50TW9kZSIsImlzRWRnZSIsInVzZXJBZ2VudCIsImlzV2Via2l0IiwidGVzdCIsImlzSVBob25lIiwicGxhdGZvcm0iLCJpc0lvcyIsIm1heFRvdWNoUG9pbnRzIiwiZ2V0RGVlcCIsIm9iamVjdCIsInBhdGgiLCJzcGxpdCIsInJlZHVjZSIsImV4dGVuZCIsInNvdXJjZXMiLCJzb3VyY2UiLCJzaGlmdCIsImFzc2lnbiIsIndyYXAiLCJlbGVtZW50cyIsIndyYXBwZXIiLCJ0YXJnZXRzIiwicmV2ZXJzZSIsImluZGV4IiwiY2hpbGQiLCJjbG9uZU5vZGUiLCJwYXJlbnQiLCJwYXJlbnROb2RlIiwic2libGluZyIsIm5leHRTaWJsaW5nIiwiYXBwZW5kQ2hpbGQiLCJpbnNlcnRCZWZvcmUiLCJzZXRBdHRyaWJ1dGVzIiwiYXR0cmlidXRlcyIsImVudHJpZXMiLCJzZXRBdHRyaWJ1dGUiLCJ0ZXh0IiwiaW5uZXJUZXh0IiwiaW5zZXJ0RWxlbWVudCIsInJlbW92ZUVsZW1lbnQiLCJyZW1vdmVDaGlsZCIsImVtcHR5RWxlbWVudCIsImNoaWxkTm9kZXMiLCJsYXN0Q2hpbGQiLCJyZXBsYWNlRWxlbWVudCIsIm5ld0NoaWxkIiwib2xkQ2hpbGQiLCJyZXBsYWNlQ2hpbGQiLCJnZXRBdHRyaWJ1dGVzRnJvbVNlbGVjdG9yIiwic2VsIiwiZXhpc3RpbmdBdHRyaWJ1dGVzIiwiZXhpc3RpbmciLCJzZWxlY3RvciIsInRyaW0iLCJjbGFzc05hbWUiLCJyZXBsYWNlIiwicGFydHMiLCJjaGFyQXQiLCJjbGFzcyIsImlkIiwidG9nZ2xlSGlkZGVuIiwiaGlkZSIsInRvZ2dsZUNsYXNzIiwiZm9yY2UiLCJtZXRob2QiLCJjbGFzc0xpc3QiLCJjb250YWlucyIsImhhc0NsYXNzIiwid2Via2l0TWF0Y2hlc1NlbGVjdG9yIiwibW96TWF0Y2hlc1NlbGVjdG9yIiwibXNNYXRjaGVzU2VsZWN0b3IiLCJnZXRFbGVtZW50cyIsImNvbnRhaW5lciIsImdldEVsZW1lbnQiLCJzZXRGb2N1cyIsInRhYkZvY3VzIiwiZm9jdXMiLCJwcmV2ZW50U2Nyb2xsIiwiY2xhc3NOYW1lcyIsImRlZmF1bHRDb2RlY3MiLCJzdXBwb3J0IiwiYXVkaW8iLCJ2aWRlbyIsImNoZWNrIiwicHJvdmlkZXIiLCJwbGF5c2lubGluZSIsImNhblBsYXlJbmxpbmUiLCJhcGkiLCJ1aSIsInJhbmdlSW5wdXQiLCJwaXAiLCJ3ZWJraXRTZXRQcmVzZW50YXRpb25Nb2RlIiwicGljdHVyZUluUGljdHVyZUVuYWJsZWQiLCJkaXNhYmxlUGljdHVyZUluUGljdHVyZSIsImFpcnBsYXkiLCJXZWJLaXRQbGF5YmFja1RhcmdldEF2YWlsYWJpbGl0eUV2ZW50IiwibWltZSIsIm1lZGlhVHlwZSIsImlzSFRNTDUiLCJtZWRpYSIsImNhblBsYXlUeXBlIiwidGV4dFRyYWNrcyIsInJhbmdlIiwidG91Y2giLCJ0cmFuc2l0aW9ucyIsInJlZHVjZWRNb3Rpb24iLCJtYXRjaE1lZGlhIiwic3VwcG9ydHNQYXNzaXZlTGlzdGVuZXJzIiwic3VwcG9ydGVkIiwib3B0aW9ucyIsImFkZEV2ZW50TGlzdGVuZXIiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwidG9nZ2xlTGlzdGVuZXIiLCJjYWxsYmFjayIsInRvZ2dsZSIsInBhc3NpdmUiLCJjYXB0dXJlIiwiZXZlbnRMaXN0ZW5lcnMiLCJvbiIsIm9mZiIsIm9uY2UiLCJvbmNlQ2FsbGJhY2siLCJhcmdzIiwidHJpZ2dlckV2ZW50IiwiZGV0YWlsIiwiQ3VzdG9tRXZlbnQiLCJwbHlyIiwidW5iaW5kTGlzdGVuZXJzIiwiaXRlbSIsInJlYWR5IiwiUHJvbWlzZSIsInJlc29sdmUiLCJ0aGVuIiwic2lsZW5jZVByb21pc2UiLCJkZWR1cGUiLCJhcnJheSIsImluZGV4T2YiLCJjbG9zZXN0IiwicHJldiIsImN1cnIiLCJhYnMiLCJzdXBwb3J0c0NTUyIsImRlY2xhcmF0aW9uIiwiQ1NTIiwic3VwcG9ydHMiLCJzdGFuZGFyZFJhdGlvcyIsIm91dCIsIngiLCJ5IiwidmFsaWRhdGVBc3BlY3RSYXRpbyIsImV2ZXJ5IiwicmVkdWNlQXNwZWN0UmF0aW8iLCJyYXRpbyIsImhlaWdodCIsImRpdmlkZXIiLCJnZXREaXZpZGVyIiwidyIsImgiLCJnZXRBc3BlY3RSYXRpbyIsInBhcnNlIiwiZW1iZWQiLCJzZXRBc3BlY3RSYXRpbyIsImlzVmlkZW8iLCJwYWRkaW5nIiwiYXNwZWN0UmF0aW8iLCJwYWRkaW5nQm90dG9tIiwiaXNWaW1lbyIsInZpbWVvIiwicHJlbWl1bSIsIm9mZnNldFdpZHRoIiwicGFyc2VJbnQiLCJnZXRDb21wdXRlZFN0eWxlIiwib2Zmc2V0IiwiZnVsbHNjcmVlbiIsImFjdGl2ZSIsInRyYW5zZm9ybSIsImFkZCIsInZpZGVvRml4ZWRSYXRpbyIsInJvdW5kQXNwZWN0UmF0aW8iLCJ0b2xlcmFuY2UiLCJjbG9zZXN0UmF0aW8iLCJodG1sNSIsImdldFNvdXJjZXMiLCJnZXRRdWFsaXR5T3B0aW9ucyIsInF1YWxpdHkiLCJmb3JjZWQiLCJzZXR1cCIsInBsYXllciIsInNwZWVkIiwib25DaGFuZ2UiLCJjdXJyZW50VGltZSIsInBhdXNlZCIsInByZWxvYWQiLCJyZWFkeVN0YXRlIiwicGxheWJhY2tSYXRlIiwic3JjIiwicGxheSIsImxvYWQiLCJjYW5jZWxSZXF1ZXN0cyIsImJsYW5rVmlkZW8iLCJkZWJ1ZyIsImxvZyIsImZvcm1hdCIsInRvU3RyaW5nIiwicmVwbGFjZUFsbCIsIlJlZ0V4cCIsInRvVGl0bGVDYXNlIiwidG9VcHBlckNhc2UiLCJzbGljZSIsInRvTG93ZXJDYXNlIiwiZ2V0SFRNTCIsImlubmVySFRNTCIsInJlc291cmNlcyIsInlvdXR1YmUiLCJpMThuIiwic2Vla1RpbWUiLCJ0aXRsZSIsInYiLCJrIiwiU3RvcmFnZSIsInN0b3JlIiwibG9jYWxTdG9yYWdlIiwiZ2V0SXRlbSIsImpzb24iLCJKU09OIiwic3RvcmFnZSIsInNldEl0ZW0iLCJzdHJpbmdpZnkiLCJyZW1vdmVJdGVtIiwiZmV0Y2giLCJ1cmwiLCJyZXNwb25zZVR5cGUiLCJyZWplY3QiLCJyZXF1ZXN0IiwiWE1MSHR0cFJlcXVlc3QiLCJyZXNwb25zZVRleHQiLCJyZXNwb25zZSIsIkVycm9yIiwic3RhdHVzIiwib3BlbiIsInNlbmQiLCJlcnJvciIsImxvYWRTcHJpdGUiLCJwcmVmaXgiLCJoYXNJZCIsImV4aXN0cyIsImdldEVsZW1lbnRCeUlkIiwidXBkYXRlIiwiZGF0YSIsImluc2VydEFkamFjZW50RWxlbWVudCIsInVzZVN0b3JhZ2UiLCJjYWNoZWQiLCJjb250ZW50IiwicmVzdWx0IiwiY2F0Y2giLCJnZXRIb3VycyIsInRydW5jIiwiZm9ybWF0VGltZSIsInRpbWUiLCJkaXNwbGF5SG91cnMiLCJpbnZlcnRlZCIsImhvdXJzIiwibWlucyIsInNlY3MiLCJjb250cm9scyIsImdldEljb25VcmwiLCJpY29uVXJsIiwibG9jYXRpb24iLCJob3N0IiwidG9wIiwiY29ycyIsInN2ZzRldmVyeWJvZHkiLCJmaW5kRWxlbWVudHMiLCJzZWxlY3RvcnMiLCJidXR0b25zIiwicGF1c2UiLCJyZXN0YXJ0IiwicmV3aW5kIiwiZmFzdEZvcndhcmQiLCJtdXRlIiwic2V0dGluZ3MiLCJjYXB0aW9ucyIsInByb2dyZXNzIiwiaW5wdXRzIiwic2VlayIsInZvbHVtZSIsImRpc3BsYXkiLCJidWZmZXIiLCJkdXJhdGlvbiIsInNlZWtUb29sdGlwIiwidG9vbHRpcCIsIndhcm4iLCJ0b2dnbGVOYXRpdmVDb250cm9scyIsImNyZWF0ZUljb24iLCJuYW1lc3BhY2UiLCJpY29uUGF0aCIsImljb25QcmVmaXgiLCJpY29uIiwiY3JlYXRlRWxlbWVudE5TIiwiZm9jdXNhYmxlIiwidXNlIiwic2V0QXR0cmlidXRlTlMiLCJjcmVhdGVMYWJlbCIsImF0dHIiLCJqb2luIiwiY3JlYXRlQmFkZ2UiLCJiYWRnZSIsIm1lbnUiLCJjcmVhdGVCdXR0b24iLCJidXR0b25UeXBlIiwidG9QYXNjYWxDYXNlIiwidG9DYW1lbENhc2UiLCJwcm9wcyIsImxhYmVsIiwibGFiZWxQcmVzc2VkIiwiaWNvblByZXNzZWQiLCJzb21lIiwiY29udHJvbCIsImJ1dHRvbiIsImNyZWF0ZVJhbmdlIiwibWluIiwic3RlcCIsImF1dG9jb21wbGV0ZSIsInJvbGUiLCJ1cGRhdGVSYW5nZUZpbGwiLCJjcmVhdGVQcm9ncmVzcyIsInN1ZmZpeEtleSIsInBsYXllZCIsInN1ZmZpeCIsImNyZWF0ZVRpbWUiLCJhdHRycyIsImJpbmRNZW51SXRlbVNob3J0Y3V0cyIsIm1lbnVJdGVtIiwic3RvcFByb3BhZ2F0aW9uIiwiaXNSYWRpb0J1dHRvbiIsInNob3dNZW51UGFuZWwiLCJuZXh0RWxlbWVudFNpYmxpbmciLCJmaXJzdEVsZW1lbnRDaGlsZCIsInByZXZpb3VzRWxlbWVudFNpYmxpbmciLCJsYXN0RWxlbWVudENoaWxkIiwiZm9jdXNGaXJzdE1lbnVJdGVtIiwiY3JlYXRlTWVudUl0ZW0iLCJsaXN0IiwiY2hlY2tlZCIsImZsZXgiLCJjaGlsZHJlbiIsIm5vZGUiLCJiaW5kIiwiY3VycmVudFRyYWNrIiwidXBkYXRlVGltZURpc3BsYXkiLCJ1cGRhdGVWb2x1bWUiLCJzZXRSYW5nZSIsIm11dGVkIiwicHJlc3NlZCIsInVwZGF0ZVByb2dyZXNzIiwiY3VycmVudCIsInZhbCIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwibm9kZVZhbHVlIiwic2V0UHJvZ3Jlc3MiLCJidWZmZXJlZCIsInBlcmNlbnQiLCJzZXRQcm9wZXJ0eSIsInVwZGF0ZVNlZWtUb29sdGlwIiwidG9vbHRpcHMiLCJ0aXBFbGVtZW50IiwidmlzaWJsZSIsInNob3ciLCJjbGllbnRSZWN0IiwicGFnZVgiLCJwb2ludCIsIl90aGlzJGNvbmZpZyRtYXJrZXJzIiwibWFya2VycyIsIl90aGlzJGNvbmZpZyRtYXJrZXJzJCIsInBvaW50cyIsImluc2VydEFkamFjZW50SFRNTCIsInRpbWVVcGRhdGUiLCJpbnZlcnQiLCJpbnZlcnRUaW1lIiwic2Vla2luZyIsImR1cmF0aW9uVXBkYXRlIiwiaGFzRHVyYXRpb24iLCJkaXNwbGF5RHVyYXRpb24iLCJzZXRNYXJrZXJzIiwidG9nZ2xlTWVudUJ1dHRvbiIsInNldHRpbmciLCJ1cGRhdGVTZXR0aW5nIiwicGFuZSIsInBhbmVscyIsImRlZmF1bHQiLCJnZXRMYWJlbCIsInNldFF1YWxpdHlNZW51IiwiY2hlY2tNZW51IiwiZ2V0QmFkZ2UiLCJzb3J0IiwiYiIsInNvcnRpbmciLCJzZXRDYXB0aW9uc01lbnUiLCJ0cmFja3MiLCJnZXRUcmFja3MiLCJ0cmFjayIsInRvZ2dsZWQiLCJsYW5ndWFnZSIsInVuc2hpZnQiLCJzZXRTcGVlZE1lbnUiLCJtaW5pbXVtU3BlZWQiLCJtYXhpbXVtU3BlZWQiLCJ2YWx1ZXMiLCJwb3B1cCIsInAiLCJmaXJzdEl0ZW0iLCJ0b2dnbGVNZW51IiwiY29tcG9zZWRQYXRoIiwiaXNNZW51SXRlbSIsImdldE1lbnVTaXplIiwidGFiIiwiY2xvbmUiLCJwb3NpdGlvbiIsIm9wYWNpdHkiLCJyZW1vdmVBdHRyaWJ1dGUiLCJzY3JvbGxXaWR0aCIsInNjcm9sbEhlaWdodCIsInNpemUiLCJyZXN0b3JlIiwicHJvcGVydHlOYW1lIiwic2V0RG93bmxvYWRVcmwiLCJkb3dubG9hZCIsImNyZWF0ZSIsImRlZmF1bHRBdHRyaWJ1dGVzIiwicHJvZ3Jlc3NDb250YWluZXIiLCJpbm5lciIsImhvbWUiLCJiYWNrQnV0dG9uIiwiaHJlZiIsInVybHMiLCJpc0VtYmVkIiwiaW5qZWN0IiwiZmxvb3IiLCJyYW5kb20iLCJzZWVrdGltZSIsImFkZFByb3BlcnR5IiwiY29udHJvbFByZXNzZWQiLCJsYWJlbHMiLCJzZXRNZWRpYU1ldGFkYXRhIiwibWVkaWFTZXNzaW9uIiwibWV0YWRhdGEiLCJNZWRpYU1ldGFkYXRhIiwibWVkaWFNZXRhZGF0YSIsImFydGlzdCIsImFsYnVtIiwiYXJ0d29yayIsIl90aGlzJGNvbmZpZyRtYXJrZXJzMiIsIl90aGlzJGNvbmZpZyRtYXJrZXJzMyIsImNvbnRhaW5lckZyYWdtZW50IiwiY3JlYXRlRG9jdW1lbnRGcmFnbWVudCIsInBvaW50c0ZyYWdtZW50IiwidGlwVmlzaWJsZSIsInRvZ2dsZVRpcCIsIm1hcmtlckVsZW1lbnQiLCJtYXJrZXIiLCJ0aXAiLCJwYXJzZVVybCIsInBhcnNlciIsImJ1aWxkVXJsUGFyYW1zIiwicGFyYW1zIiwiVVJMU2VhcmNoUGFyYW1zIiwiaXNZb3VUdWJlIiwicHJvdG9jb2wiLCJibG9iIiwiY3JlYXRlT2JqZWN0VVJMIiwibGFuZ3VhZ2VzIiwidXNlckxhbmd1YWdlIiwidHJhY2tFdmVudHMiLCJtZXRhIiwiY3VycmVudFRyYWNrTm9kZSIsImxhbmd1YWdlRXhpc3RzIiwibW9kZSIsInVwZGF0ZUN1ZXMiLCJzZXRMYW5ndWFnZSIsImFjdGl2ZUNsYXNzIiwiZmluZFRyYWNrIiwiZW5hYmxlVGV4dFRyYWNrIiwiaGFzIiwic29ydElzRGVmYXVsdCIsInNvcnRlZCIsInVuZGVmaW5lZCIsImdldEN1cnJlbnRUcmFjayIsImN1ZXMiLCJhY3RpdmVDdWVzIiwiY3VlIiwiZ2V0Q3VlQXNIVE1MIiwiY3VlVGV4dCIsImNhcHRpb24iLCJhdXRvcGxheSIsImF1dG9wYXVzZSIsInRvZ2dsZUludmVydCIsImNsaWNrVG9QbGF5IiwiaGlkZUNvbnRyb2xzIiwicmVzZXRPbkVuZCIsImRpc2FibGVDb250ZXh0TWVudSIsImxvb3AiLCJzZWxlY3RlZCIsImtleWJvYXJkIiwiZm9jdXNlZCIsImdsb2JhbCIsImZhbGxiYWNrIiwiaW9zTmF0aXZlIiwic2Vla0xhYmVsIiwidW5tdXRlIiwiZW5hYmxlQ2FwdGlvbnMiLCJkaXNhYmxlQ2FwdGlvbnMiLCJlbnRlckZ1bGxzY3JlZW4iLCJleGl0RnVsbHNjcmVlbiIsImZyYW1lVGl0bGUiLCJtZW51QmFjayIsIm5vcm1hbCIsInN0YXJ0IiwiZW5kIiwiYWxsIiwicmVzZXQiLCJhZHZlcnRpc2VtZW50IiwicXVhbGl0eUJhZGdlIiwic2RrIiwiaWZyYW1lIiwiZ29vZ2xlSU1BIiwiZWRpdGFibGUiLCJlbWJlZENvbnRhaW5lciIsInBvc3RlciIsInBvc3RlckVuYWJsZWQiLCJhZHMiLCJwbGF5aW5nIiwic3RvcHBlZCIsImxvYWRpbmciLCJob3ZlciIsImlzVG91Y2giLCJ1aVN1cHBvcnRlZCIsIm5vVHJhbnNpdGlvbiIsInByZXZpZXdUaHVtYm5haWxzIiwidGh1bWJDb250YWluZXIiLCJ0aHVtYkNvbnRhaW5lclNob3duIiwiaW1hZ2VDb250YWluZXIiLCJ0aW1lQ29udGFpbmVyIiwic2NydWJiaW5nQ29udGFpbmVyIiwic2NydWJiaW5nQ29udGFpbmVyU2hvd24iLCJoYXNoIiwicHVibGlzaGVySWQiLCJ0YWdVcmwiLCJieWxpbmUiLCJwb3J0cmFpdCIsInRyYW5zcGFyZW50IiwiY3VzdG9tQ29udHJvbHMiLCJyZWZlcnJlclBvbGljeSIsInJlbCIsInNob3dpbmZvIiwiaXZfbG9hZF9wb2xpY3kiLCJtb2Rlc3RicmFuZGluZyIsIm5vQ29va2llIiwicHJvdmlkZXJzIiwidHlwZXMiLCJub29wIiwiQ29uc29sZSIsImNvbnNvbGUiLCJGdWxsc2NyZWVuIiwic2Nyb2xsUG9zaXRpb24iLCJzY3JvbGxYIiwic2Nyb2xsWSIsInNjcm9sbFRvIiwib3ZlcmZsb3ciLCJ2aWV3cG9ydCIsImhlYWQiLCJwcm9wZXJ0eSIsImhhc1Byb3BlcnR5IiwiY2xlYW51cFZpZXdwb3J0IiwicGFydCIsImFjdGl2ZUVsZW1lbnQiLCJmaXJzdCIsImxhc3QiLCJzaGlmdEtleSIsImZvcmNlRmFsbGJhY2siLCJuYXRpdmUiLCJyZXF1ZXN0RnVsbHNjcmVlbiIsIndlYmtpdEVudGVyRnVsbHNjcmVlbiIsInRvZ2dsZUZhbGxiYWNrIiwibmF2aWdhdGlvblVJIiwid2Via2l0RXhpdEZ1bGxzY3JlZW4iLCJhY3Rpb24iLCJjYW5jZWxGdWxsU2NyZWVuIiwiZXhpdCIsImVudGVyIiwiZWwiLCJwYXJlbnRFbGVtZW50IiwicHJveHkiLCJ0cmFwRm9jdXMiLCJ1c2luZ05hdGl2ZSIsImdldFJvb3ROb2RlIiwiZnVsbHNjcmVlbkVsZW1lbnQiLCJzaGFkb3dSb290IiwiZnVsbHNjcmVlbkVuYWJsZWQiLCJ3ZWJraXRGdWxsc2NyZWVuRW5hYmxlZCIsIm1vekZ1bGxTY3JlZW5FbmFibGVkIiwibXNGdWxsc2NyZWVuRW5hYmxlZCIsInByZSIsImxvYWRJbWFnZSIsIm1pbldpZHRoIiwiaW1hZ2UiLCJJbWFnZSIsImhhbmRsZXIiLCJvbmxvYWQiLCJvbmVycm9yIiwibmF0dXJhbFdpZHRoIiwiYWRkU3R5bGVIb29rIiwiYnVpbGQiLCJjaGVja1BsYXlpbmciLCJzZXRUaXRsZSIsInNldFBvc3RlciIsInRvZ2dsZVBvc3RlciIsImVuYWJsZSIsImJhY2tncm91bmRJbWFnZSIsImJhY2tncm91bmRTaXplIiwidG9nZ2xlQ29udHJvbHMiLCJjaGVja0xvYWRpbmciLCJjbGVhclRpbWVvdXQiLCJ0aW1lcnMiLCJjb250cm9sc0VsZW1lbnQiLCJyZWNlbnRUb3VjaFNlZWsiLCJsYXN0U2Vla1RpbWUiLCJEYXRlIiwibm93IiwibWlncmF0ZVN0eWxlcyIsImdldFByb3BlcnR5VmFsdWUiLCJyZW1vdmVQcm9wZXJ0eSIsIkxpc3RlbmVycyIsInRpbWVTdGFtcCIsImZvY3VzVGltZXIiLCJsYXN0S2V5RG93biIsInJlbW92ZUN1cnJlbnQiLCJ3YXNLZXlEb3duIiwiaGFuZGxlS2V5IiwiZmlyc3RUb3VjaCIsInNldFRhYkZvY3VzIiwic2V0R3V0dGVyIiwidmlkZW9XaWR0aCIsInZpZGVvSGVpZ2h0IiwidXNlTmF0aXZlQXNwZWN0UmF0aW8iLCJjbGllbnRXaWR0aCIsImlubmVyV2lkdGgiLCJjbGllbnRIZWlnaHQiLCJpbm5lckhlaWdodCIsInZpZXdwb3J0SGVpZ2h0IiwibWF4V2lkdGgiLCJtYXJnaW4iLCJyZXNpemVkIiwiaXNBdWRpbyIsImVuZGVkIiwidG9nZ2xlUGxheSIsInByb3h5RXZlbnRzIiwiZGVmYXVsdEhhbmRsZXIiLCJjdXN0b21IYW5kbGVyS2V5IiwiY3VzdG9tSGFuZGxlciIsInJldHVybmVkIiwiaGFzQ3VzdG9tSGFuZGxlciIsImlucHV0RXZlbnQiLCJmb3J3YXJkIiwidG9nZ2xlQ2FwdGlvbnMiLCJyZWN0IiwiY3VycmVudFRhcmdldCIsImF0dHJpYnV0ZSIsImhhc0F0dHJpYnV0ZSIsImRvbmUiLCJzZWVrVG8iLCJsb2FkZWQiLCJzdGFydE1vdmUiLCJlbmRNb3ZlIiwic3RhcnRTY3J1YmJpbmciLCJlbmRTY3J1YmJpbmciLCJ3ZWJraXREaXJlY3Rpb25JbnZlcnRlZEZyb21EZXZpY2UiLCJkZWx0YVgiLCJkZWx0YVkiLCJkaXJlY3Rpb24iLCJzaWduIiwiaW5jcmVhc2VWb2x1bWUiLCJsYXN0S2V5IiwiaW5jcmVtZW50IiwiYWx0S2V5IiwiY3RybEtleSIsIm1ldGFLZXkiLCJyZXBlYXQiLCJkZWNyZWFzZVZvbHVtZSIsImdsb2JhbFRoaXMiLCJzZWxmIiwibG9hZGpzX3VtZCIsImZuIiwiZGV2bnVsbCIsImJ1bmRsZUlkQ2FjaGUiLCJidW5kbGVSZXN1bHRDYWNoZSIsImJ1bmRsZUNhbGxiYWNrUXVldWUiLCJzdWJzY3JpYmUiLCJidW5kbGVJZHMiLCJjYWxsYmFja0ZuIiwiZGVwc05vdEZvdW5kIiwiYnVuZGxlSWQiLCJudW1XYWl0aW5nIiwicGF0aHNOb3RGb3VuZCIsInB1Ymxpc2giLCJxIiwic3BsaWNlIiwiZXhlY3V0ZUNhbGxiYWNrcyIsInN1Y2Nlc3MiLCJsb2FkRmlsZSIsIm51bVRyaWVzIiwiZG9jIiwiaXNMZWdhY3lJRUNzcyIsImFzeW5jIiwibWF4VHJpZXMiLCJudW1SZXRyaWVzIiwiYmVmb3JlQ2FsbGJhY2tGbiIsImJlZm9yZSIsInBhdGhuYW1lIiwicGF0aFN0cmlwcGVkIiwicmVsTGlzdCIsImFzIiwib25iZWZvcmVsb2FkIiwiZXYiLCJzaGVldCIsImNzc1RleHQiLCJjb2RlIiwiZGVmYXVsdFByZXZlbnRlZCIsImxvYWRGaWxlcyIsInBhdGhzIiwibG9hZGpzIiwiYXJnMSIsImFyZzIiLCJsb2FkRm4iLCJyZXR1cm5Qcm9taXNlIiwiZGVwcyIsImlzRGVmaW5lZCIsImZhY3RvcnkiLCJjcmVhdGVDb21tb25qc01vZHVsZSIsImxvYWRTY3JpcHQiLCJhc3N1cmVQbGF5YmFja1N0YXRlIiwiaGFzUGxheWVkIiwiVmltZW8iLCJmcmFtZVBhcmFtcyIsInJlZ2V4IiwiZm91bmQiLCJwYXJzZUhhc2giLCJoYXNoUGFyYW0iLCJzaWRlZG9jayIsImdlc3R1cmUiLCIkMiIsInRodW1ibmFpbF91cmwiLCJQbGF5ZXIiLCJkaXNhYmxlVGV4dFRyYWNrIiwic3RvcCIsInJlc3RvcmVQYXVzZSIsInNldFZvbHVtZSIsInNldEN1cnJlbnRUaW1lIiwic2V0UGxheWJhY2tSYXRlIiwiY3VycmVudFNyYyIsInNldExvb3AiLCJnZXRWaWRlb1VybCIsImdldFZpZGVvV2lkdGgiLCJnZXRWaWRlb0hlaWdodCIsImRpbWVuc2lvbnMiLCJzZXRBdXRvcGF1c2UiLCJzdGF0ZSIsImdldFZpZGVvVGl0bGUiLCJnZXRDdXJyZW50VGltZSIsImdldER1cmF0aW9uIiwiZ2V0VGV4dFRyYWNrcyIsInN0cmlwcGVkQ3VlcyIsImZyYWdtZW50IiwiZmlyc3RDaGlsZCIsInN0cmlwSFRNTCIsImdldFBhdXNlZCIsInNlY29uZHMiLCJnZXRIb3N0IiwiWVQiLCJvbllvdVR1YmVJZnJhbWVBUElSZWFkeSIsImdldFRpdGxlIiwidmlkZW9JZCIsImN1cnJlbnRJZCIsInBvc3RlclNyYyIsInBsYXllclZhcnMiLCJobCIsImRpc2FibGVrYiIsImNjX2xvYWRfcG9saWN5IiwiY2NfbGFuZ19wcmVmIiwid2lkZ2V0X3JlZmVycmVyIiwib25FcnJvciIsIm1lc3NhZ2UiLCJvblBsYXliYWNrUmF0ZUNoYW5nZSIsImluc3RhbmNlIiwiZ2V0UGxheWJhY2tSYXRlIiwib25SZWFkeSIsInBsYXlWaWRlbyIsInBhdXNlVmlkZW8iLCJzdG9wVmlkZW8iLCJzcGVlZHMiLCJnZXRBdmFpbGFibGVQbGF5YmFja1JhdGVzIiwiY2xlYXJJbnRlcnZhbCIsImJ1ZmZlcmluZyIsInNldEludGVydmFsIiwiZ2V0VmlkZW9Mb2FkZWRGcmFjdGlvbiIsImxhc3RCdWZmZXJlZCIsIm9uU3RhdGVDaGFuZ2UiLCJ1bk11dGUiLCJBZHMiLCJnb29nbGUiLCJpbWEiLCJtYW5hZ2VyIiwiZGVzdHJveSIsImRpc3BsYXlDb250YWluZXIiLCJyZW1vdmUiLCJzdGFydFNhZmV0eVRpbWVyIiwibWFuYWdlclByb21pc2UiLCJjbGVhclNhZmV0eVRpbWVyIiwic2V0dXBJTUEiLCJzZXRWcGFpZE1vZGUiLCJJbWFTZGtTZXR0aW5ncyIsIlZwYWlkTW9kZSIsIkVOQUJMRUQiLCJzZXRMb2NhbGUiLCJzZXREaXNhYmxlQ3VzdG9tUGxheWJhY2tGb3JJT1MxMFBsdXMiLCJBZERpc3BsYXlDb250YWluZXIiLCJsb2FkZXIiLCJBZHNMb2FkZXIiLCJBZHNNYW5hZ2VyTG9hZGVkRXZlbnQiLCJUeXBlIiwiQURTX01BTkFHRVJfTE9BREVEIiwib25BZHNNYW5hZ2VyTG9hZGVkIiwiQWRFcnJvckV2ZW50IiwiQURfRVJST1IiLCJvbkFkRXJyb3IiLCJyZXF1ZXN0QWRzIiwiQWRzUmVxdWVzdCIsImFkVGFnVXJsIiwibGluZWFyQWRTbG90V2lkdGgiLCJsaW5lYXJBZFNsb3RIZWlnaHQiLCJub25MaW5lYXJBZFNsb3RXaWR0aCIsIm5vbkxpbmVhckFkU2xvdEhlaWdodCIsImZvcmNlTm9uTGluZWFyRnVsbFNsb3QiLCJzZXRBZFdpbGxQbGF5TXV0ZWQiLCJjb3VudGRvd25UaW1lciIsImdldFJlbWFpbmluZ1RpbWUiLCJBZHNSZW5kZXJpbmdTZXR0aW5ncyIsInJlc3RvcmVDdXN0b21QbGF5YmFja1N0YXRlT25BZEJyZWFrQ29tcGxldGUiLCJlbmFibGVQcmVsb2FkaW5nIiwiZ2V0QWRzTWFuYWdlciIsImN1ZVBvaW50cyIsImdldEN1ZVBvaW50cyIsIkFkRXZlbnQiLCJvbkFkRXZlbnQiLCJjdWVQb2ludCIsInNlZWtFbGVtZW50IiwiY3VlUGVyY2VudGFnZSIsImFkIiwiZ2V0QWQiLCJhZERhdGEiLCJnZXRBZERhdGEiLCJMT0FERUQiLCJwb2xsQ291bnRkb3duIiwiaXNMaW5lYXIiLCJTVEFSVEVEIiwiQUxMX0FEU19DT01QTEVURUQiLCJsb2FkQWRzIiwiY29udGVudENvbXBsZXRlIiwiQ09OVEVOVF9QQVVTRV9SRVFVRVNURUQiLCJwYXVzZUNvbnRlbnQiLCJDT05URU5UX1JFU1VNRV9SRVFVRVNURUQiLCJyZXN1bWVDb250ZW50IiwiTE9HIiwiYWRFcnJvciIsImdldE1lc3NhZ2UiLCJjYW5jZWwiLCJhZGRDdWVQb2ludHMiLCJzZWVrZWRUaW1lIiwiZGlzY2FyZEFkQnJlYWsiLCJyZXNpemUiLCJWaWV3TW9kZSIsIk5PUk1BTCIsImluaXRpYWxpemUiLCJpbml0aWFsaXplZCIsInpJbmRleCIsImhhbmRsZXJzIiwic2FmZXR5VGltZXIiLCJBVl9QVUJMSVNIRVJJRCIsIkFWX0NIQU5ORUxJRCIsIkFWX1VSTCIsImNiIiwiQVZfV0lEVEgiLCJBVl9IRUlHSFQiLCJBVl9DRElNMiIsImNsYW1wIiwicGFyc2VWdHQiLCJ2dHREYXRhU3RyaW5nIiwicHJvY2Vzc2VkTGlzdCIsImZyYW1lIiwibGluZSIsInN0YXJ0VGltZSIsImxpbmVTcGxpdCIsIm1hdGNoVGltZXMiLCJlbmRUaW1lIiwiZml0UmF0aW8iLCJvdXRlciIsInRhcmdldFJhdGlvIiwiUHJldmlld1RodW1ibmFpbHMiLCJnZXRUaHVtYm5haWxzIiwicmVuZGVyIiwiZGV0ZXJtaW5lQ29udGFpbmVyQXV0b1NpemluZyIsInNvcnRBbmRSZXNvbHZlIiwidGh1bWJuYWlscyIsInByb21pc2VzIiwiZ2V0VGh1bWJuYWlsIiwidGh1bWJuYWlsIiwiZnJhbWVzIiwidXJsUHJlZml4Iiwic3Vic3RyaW5nIiwibGFzdEluZGV4T2YiLCJ0ZW1wSW1hZ2UiLCJuYXR1cmFsSGVpZ2h0IiwicGVyY2VudGFnZSIsIm1vdXNlUG9zWCIsInRodW1iIiwiX3RoaXMkcGxheWVyJGNvbmZpZyRtIiwiX3RoaXMkcGxheWVyJGNvbmZpZyRtMiIsInNob3dJbWFnZUF0Q3VycmVudFRpbWUiLCJ0b2dnbGVUaHVtYkNvbnRhaW5lciIsIm1vdXNlRG93biIsInRvZ2dsZVNjcnViYmluZ0NvbnRhaW5lciIsImNlaWwiLCJsYXN0VGltZSIsInNjcnViYmluZyIsInNldFNjcnViYmluZ0NvbnRhaW5lclNpemUiLCJzZXRUaHVtYkNvbnRhaW5lclNpemVBbmRQb3MiLCJ0aHVtYk51bSIsImZpbmRJbmRleCIsImhhc1RodW1iIiwicXVhbGl0eUluZGV4IiwibG9hZGVkSW1hZ2VzIiwic2hvd2luZ1RodW1iIiwidGh1bWJGaWxlbmFtZSIsInRodW1iVXJsIiwiY3VycmVudEltYWdlRWxlbWVudCIsImRhdGFzZXQiLCJmaWxlbmFtZSIsInNob3dJbWFnZSIsInJlbW92ZU9sZEltYWdlcyIsImxvYWRpbmdJbWFnZSIsInVzaW5nU3ByaXRlcyIsInByZXZpZXdJbWFnZSIsInNob3dpbmdUaHVtYkZpbGVuYW1lIiwibmV3SW1hZ2UiLCJzZXRJbWFnZVNpemVBbmRPZmZzZXQiLCJjdXJyZW50SW1hZ2VDb250YWluZXIiLCJwcmVsb2FkTmVhcmJ5IiwiZ2V0SGlnaGVyUXVhbGl0eSIsImN1cnJlbnRJbWFnZSIsInRhZ05hbWUiLCJyZW1vdmVEZWxheSIsImRlbGV0aW5nIiwib2xkVGh1bWJGaWxlbmFtZSIsInRodW1ibmFpbHNDbG9uZSIsImZvdW5kT25lIiwibmV3VGh1bWJGaWxlbmFtZSIsInRodW1iVVJMIiwiY3VycmVudFF1YWxpdHlJbmRleCIsInByZXZpZXdJbWFnZUhlaWdodCIsInRodW1iQ29udGFpbmVySGVpZ2h0IiwiY2xlYXJTaG93aW5nIiwic2l6ZVNwZWNpZmllZEluQ1NTIiwidGh1bWJBc3BlY3RSYXRpbyIsInRodW1iSGVpZ2h0Iiwic2V0VGh1bWJDb250YWluZXJQb3MiLCJzY3J1YmJlclJlY3QiLCJjb250YWluZXJSZWN0IiwicmlnaHQiLCJjbGFtcGVkIiwibXVsdGlwbGllciIsImxhc3RNb3VzZU1vdmVUaW1lIiwiY3VycmVudFNjcnViYmluZ0ltYWdlRWxlbWVudCIsImN1cnJlbnRUaHVtYm5haWxJbWFnZUVsZW1lbnQiLCJpbnNlcnRFbGVtZW50cyIsImNoYW5nZSIsImNyb3Nzb3JpZ2luIiwiUGx5ciIsIndlYmtpdFNob3dQbGF5YmFja1RhcmdldFBpY2tlciIsImlzSGlkZGVuIiwiaGlkaW5nIiwiZXZlbnROYW1lIiwic29mdCIsIm9yaWdpbmFsIiwidW5sb2FkIiwiZmFpbGVkIiwialF1ZXJ5IiwiV2Vha01hcCIsImdldFByb3ZpZGVyQnlVcmwiLCJzZWFyY2giLCJ0cnV0aHkiLCJzZWFyY2hQYXJhbXMiLCJ0YWJpbmRleCIsImlucHV0SXNWYWxpZCIsImZhdXhEdXJhdGlvbiIsInJlYWxEdXJhdGlvbiIsIkluZmluaXR5IiwiaGFzQXVkaW8iLCJtb3pIYXNBdWRpbyIsIndlYmtpdEF1ZGlvRGVjb2RlZEJ5dGVDb3VudCIsImF1ZGlvVHJhY2tzIiwidXBkYXRlU3RvcmFnZSIsIndlYmtpdFByZXNlbnRhdGlvbk1vZGUiLCJwaWN0dXJlSW5QaWN0dXJlRWxlbWVudCIsInNldFByZXZpZXdUaHVtYm5haWxzIiwicmVxdWVzdFBpY3R1cmVJblBpY3R1cmUiLCJleGl0UGljdHVyZUluUGljdHVyZSIsInRodW1ibmFpbFNvdXJjZSIsInN0YXRpYyIsImlubGluZSIsIlN3aXBlcnMiLCJzd2lwZXIiLCJTd2lwZXIiLCJzbGlkZXNQZXJWaWV3IiwiZnJlZU1vZGUiLCJ3YXRjaFNsaWRlc1Byb2dyZXNzIiwic3BhY2VCZXR3ZWVuIiwibmF2aWdhdGlvbiIsIm5leHRFbCIsInByZXZFbCIsInRodW1icyIsImVmZmVjdCIsImZhZGVFZmZlY3QiLCJjcm9zc0ZhZGUiLCJncmFiQ3Vyc29yIiwicGFnaW5hdGlvbiIsImNsaWNrYWJsZSIsImJyZWFrcG9pbnRzIiwiQW5pbSIsImFuaW1Ub3AiLCJhbmltbGVmdCIsImFuaW1SaWdodCIsInNpbmdsZXNUb3AiLCJzaW5nbGVzbGVmdCIsInNpbmdsZXNSaWdodCIsImNlbGwiLCJyZWMiLCJjZWxsMSIsImNlbGwyIiwiQnV0dG9uIiwibVZhbHVlIiwiYWRkRGl2IiwiY2xpZW50WSIsImFwcGVuZCIsIndhdmVzIiwicG9wdXBzSW5pdCIsImhlYWRlciIsInRveXNQbHlyIiwiR2FsIiwidGVtcCIsInMyIiwiY2VudGVyZWRTbGlkZXMiLCJjb3ZlcmZsb3dFZmZlY3QiLCJyb3RhdGUiLCJzdHJldGNoIiwiZGVwdGgiLCJzbGlkZVRvQ2xpY2tlZFNsaWRlIiwiczFJdGVtcyIsIkhlYWRlcnMiLCJwYWdlWU9mZnNldCIsIm9ucmVzaXplIiwiUG9wdXBzIiwiY29udGVudHMiLCJQbGVlcnMiLCJ0ZW1wb3IiLCJpbml0VGFyZ2V0IiwibGlua1BseXIiLCJvcGVuUG9wIiwiY2xvc2VQb3AiLCJEb3VibGUiLCJEb3VibGVUb3AiLCJfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18iLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJjYWNoZWRNb2R1bGUiLCJfX3dlYnBhY2tfbW9kdWxlc19fIiwiZ2V0dGVyIiwiX19lc01vZHVsZSIsImQiLCJkZWZpbml0aW9uIiwiZyIsInByb3AiLCJoYXNPd25Qcm9wZXJ0eSIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwicGxheWVyRnVsbFRveXMiLCJ0ZXJ0Iiwic2hlYXAiLCJ0ciIsInBseXJQbGF5Il0sInNvdXJjZVJvb3QiOiIifQ==


const observer1 = new IntersectionObserver((entries) => {
  entries.forEach((entry) => {
    if (entry.isIntersecting) {
      entry.target.classList.add("top-animation");
    }
  });
});

const et = document.querySelectorAll("._enter-top");
et.forEach((ent) => {
observer1.observe(ent);
});

const observer2 = new IntersectionObserver((entries) => {
  entries.forEach((entry) => {
    if (entry.isIntersecting) {
      entry.target.classList.add("left-animation");
    }
  });
});

const left = document.querySelectorAll("._enter-left");
left.forEach((ent) => {
  observer2.observe(ent);
});

const observer3 = new IntersectionObserver((entries) => {
  entries.forEach((entry) => {
    if (entry.isIntersecting) {
      entry.target.classList.add("right-animation");
    }
  });
});

const right = document.querySelectorAll("._enter-right");
right.forEach((ent) => {
  observer3.observe(ent);
});
